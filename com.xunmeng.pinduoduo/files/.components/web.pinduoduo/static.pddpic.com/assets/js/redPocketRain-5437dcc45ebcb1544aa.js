(window.webpackJsonp_name_chunkhash_5_=window.webpackJsonp_name_chunkhash_5_||[]).push([["redPocketRain"],{hW4I:function(e,t,i){"use strict";i.r(t);var n=i("lSNA"),a=i.n(n),r=i("RIqP"),o=i.n(r),c=i("yG8O"),s=i.n(c),d=i("lwsE"),l=i.n(d),u=i("W8MJ"),h=i.n(u),p=i("a1gu"),m=i.n(p),g=i("Nsbk"),f=i.n(g),w=i("PJYZ"),v=i.n(w),b=i("7W2i"),y=i.n(b),C=i("U+yc"),k=i.n(C),x=(i("1ABj"),i("QILm"),i("8BX1")),P=x.loader.resources,A=(x.utils.TextureCache,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=P[e];if(!n)return{};var a=new x.Sprite(n.texture);return Object.keys(t).forEach(function(e){var i=t[e];a[e]=i}),i&&i.addChild(a),a}),R=375,S=function e(t){var i=this;l()(this,e),a()(this,"app",null),a()(this,"stage",null),a()(this,"store",null),a()(this,"root",null),a()(this,"containers",{}),a()(this,"animate",{}),a()(this,"scale",1),a()(this,"size",{}),a()(this,"addAnimate",function(e,t){i.animate[e]=t,i.app.ticker.add(i.animate[e])}),a()(this,"removeAnimate",function(e){"string"==typeof e?i.app.ticker.remove(i.animate[e]):e.forEach(function(e){i.app.ticker.remove(i.animate[e])})}),a()(this,"loadStage",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.app.stage;if(i.root&&i.app)return i.destoryStage(),i.stage=e,i.scale(i.stage),i.root.appendChild(i.app.view),i.loadContainer("preLoadContainer"),i.loadContainer("bgContainer"),i.loadContainer("meterContainer",!1),i.loadContainer("countDownCtn"),i.stage}),a()(this,"loadContainer",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new x.particles.ParticleContainer:new x.Container;return i.containers[e]=t,i.stage.addChild(t),t}),a()(this,"destoryStage",function(){i.stage&&i.stage.destory&&(i.stage.destory(),i.stage=null),i.root&&i.root.childNodes.length>0&&i.root.removeChild(i.root.childNodes[0])}),a()(this,"scale",function(e){var t=document.documentElement.clientWidth;i.scale=t/R,e.scale.x=i.scale,e.scale.y=i.scale}),a()(this,"loadImages",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.imageLoaderStartTime=Date.now(),e.forEach(function(e){var t=e.alias,i=e.src;x.loader.add(t,i,{crossOrigin:!0})}),x.loader});var n={width:t.width||0,height:t.height||0,resolution:t.resolution||!0,antialias:!0,transparent:!0,autoResize:!0};!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("canvas");try{return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?(this.forceCanvas=!0,this.app=new x.Application(Object.assign(n,{forceCanvas:!0}))):this.app=new x.Application(n),this.store=t.store||{},this.store.redPocketRainLogger({stage:this.forceCanvas?"webgl_to_canvas":"pixi_webgl"}),this.root=t.root,this.size={width:t.width,height:t.height}},D=i("kMCw"),O=i("DMz3"),E=i("6AjA"),T={x:.5,y:.5},N=0,_=[{},{x:7,y:8},{x:-8,y:-7},{x:4,y:5},{x:-5,y:-4},{x:2,y:-2}],F={wholeMeteor1:{width:2,height:109},wholeMeteor2:{width:1.5,height:88},wholeMeteor3:{width:1,height:63},wholeMeteor4:{width:1,height:88},wholeMeteor5:{width:9,height:9},wholeMeteor6:{width:5,height:5}},L=function(e,t,i){var n=Math.random()*E.m,a=Object(D.f)(E.l,E.j),r=7*a/3,o=Object(D.f)(E.k,E.i),c="wholeMeteor".concat(Math.max(1,Math.ceil(6*Math.random()))),s=A(c,{y:-o,x:n,width:F[c].width,height:F[c].height,vx:a,vy:r,anchor:T,rotation:a/r},e);s.updateParticle=function(){s.visible&&(s.y+=s.vy,s.x-=s.vx,s.y>i.height+100&&(e.removeChild(s),t.splice(t.indexOf(s),1)))},t.push(s)},M=function(e,t,i,n,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){},o=A(e,{x:t,y:i+30,width:375,height:667,framwNum:0,scale:{x:4,y:4},anchor:T},n);o.updateParticle=function(){if(o.scale.x>.6)return o.scale.x-=.2,void(o.scale.y-=.2);!o.dustLock&&function(e,t,i,n){N++;var a={x:e,y:t+30,width:375,height:396,anchor:T},r=1,o=A("dust0",a,i),c=0,s=0;requestAnimationFrame(function e(){if(8==++c){if(c=0,o.visible=!1,o=A("dust".concat(r),a,i),r<=5&&(i.x+=_[r].x,i.y+=_[r].y),8===r)return void(4===N&&requestAnimationFrame(function e(){6==++s&&(s=0,i.alpha-=.2,i.alpha<=0)?n():requestAnimationFrame(e)}));r++}requestAnimationFrame(e)})}(t,i,n,r),o.dustLock=!0,o.framwNum++,o.framwNum<38||(o.alpha-=.05,o.alpha<.2&&(o&&(n.removeChild(o),a.splice(a.indexOf(o),1)),o=null))},a.push(o)},j=function(e,t,i,n){var a={x:e,y:t,width:300,height:300,anchor:T,rotation:.16},r=72,o=0,c=A("aniPng".concat(r),a,n);requestAnimationFrame(function e(){if(3==++o){if(c.visible=!1,!(r<E.r.length+71))return;c=A("aniPng".concat(++r),a,n),o=0}requestAnimationFrame(e)})};function q(e,t,i){e.forEach(function(e){return function(e,t,i){var n;e&&t.removeChild(e),(n=i.indexOf(e))>=0&&i.splice(n,1)}(e,t,i)})}var z,H,I,W=null,X=null,G=null,Y={5:"sayGreat",10:"sayPerfect",12:"sayWonderful"},B=function(e,t,i,n,a){if([5,10,12].includes(e)){q([W,X,G],n,a),W=null,X=null,G=null,X=A("sayAddPacket",{x:t-70,y:i+12,width:92,height:34},n),G=A(Y[e],{x:t-90,y:i+52,width:180,height:83},n),W=A("thresholdHit".concat(e),{x:t+47,y:i+24,width:54,height:47,anchor:T,scale:{x:.5,y:.5}},n);var r=0;W.updateParticle=function(){(r+=1)<=10||r>20&&r<=30?(W.scale.x+=.01,W.scale.y+=.01):(r>10&&r<=20||r>30&&r<=40)&&(W.scale.x-=.01,W.scale.y-=.01),r>=60&&(q([W,X,G],n,a),W=null,X=null,G=null)},a.push(W)}};var J=0,U=0,Z=0,K=0,Q=(z=Object(O.a)(1e4),H=function(e){function t(){var e,i;l()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=m()(this,(e=f()(t)).call.apply(e,[this].concat(r))),a()(v()(i),"redClicked",0),a()(v()(i),"awardClicked",0),a()(v()(i),"score",0),a()(v()(i),"createdRedNum",0),a()(v()(i),"createdAwardNum",0),a()(v()(i),"redpocketTotal",E.d.RedPocket.amount),a()(v()(i),"currentLevel",1),a()(v()(i),"useCarousel",!1),a()(v()(i),"useEffect",!0),a()(v()(i),"useDoubleHit",!0),a()(v()(i),"globalSprite",[]),a()(v()(i),"fps",[]),a()(v()(i),"stopTimer",null),a()(v()(i),"visibleSpriteNum",0),a()(v()(i),"loadProgressHandler",function(e){return i.store.changeLoadingPercent(e.progress)}),a()(v()(i),"init",function(){i.useCarousel=Date.now()-i.imageLoaderStartTime<2500,i.store.toggleLoading(!1),i.loadStage(),i.rpAlias="rp",i.apAlias="ap",i.middleX=i.size.width/(2*i.scale),i.middleY=i.size.height/(2*i.scale);var e=i.size.width>E.n;i.RED_START_MIN_X=e?i.size.width/4:E.q,i.RED_START_MAX_X=e?i.size.width/2-50:i.size.width-100}),a()(v()(i),"addBgSprite",function(){var e=A("bg",{width:i.size.width||375,height:i.size.height||603},i.containers.bgContainer);e.on("tap",function(e){e&&(e.stopPropagationHint=!0),i.store.pixiSpriteClick++});var t=e.width,n=e.height,a=375/t,r=603/n,o=Math.max(a,r);e.width=t*o,e.height=n*o}),s()(v()(i),"addStartCount",I,v()(i)),a()(v()(i),"loadMeteors",function(){var e=0;requestAnimationFrame(function t(){i.useEffect&&(15==++e&&(e=0,L(i.containers.meterContainer,i.globalSprite,i.size)),requestAnimationFrame(t))}),i.gameLoop(),i.checkIfDegradation()}),a()(v()(i),"checkIfDegradation",function(){setTimeout(function(){var e=Math.round(1e3*(Z-1)/(U-J));i.fps.push(e),e<=E.e&&(i.useEffect=!1),e<=E.s&&(i.useDoubleHit=!1)},800)}),a()(v()(i),"gameDegradation",function(){clearInterval(i.meteorTimer),clearInterval(i.fireworksTimer),i.lamps&&i.lamps.map(function(e){i.stage.removeChild(e),i.globalSprite.splice(i.globalSprite.indexOf(e),1)})}),a()(v()(i),"gameLoop",function(){if(i.store.gameContainer){Z<=30&&i.recordFpsTimeStamp(),i.checkGameEnding(),requestAnimationFrame(i.gameLoop);for(var e=i.globalSprite.length-1;e>=0;e--)i.globalSprite[e].updateParticle()}}),a()(v()(i),"addCountCarousel",function(){var e={x:i.middleX-152,y:i.middleY-230,width:298,height:127};return new Promise(function(t){A("logo",e,i.containers.countDownCtn),M("3",i.middleX,i.middleY,i.containers.countDownCtn,i.globalSprite);var n=2,a=0;requestAnimationFrame(function e(){if(60==++a){if(a=0,M(n,i.middleX,i.middleY,i.containers.countDownCtn,i.globalSprite,t),0===n)return;n--}requestAnimationFrame(e)})}).catch(function(e){return console.log(e)})}),a()(v()(i),"addDefaultCount",function(){return new Promise(function(e){var t=2,n={x:i.middleX,y:i.middleY,anchor:E.b,scale:{x:.7,y:.7}},a=A("3",n,i.stage),r=0;requestAnimationFrame(function o(){if(60==++r){if(r=0,a.visible=!1,-1===t)return void e();a=A(t.toString(),n,i.stage),t--}requestAnimationFrame(o)})}).catch(function(e){return console.log(e)})}),a()(v()(i),"start",function(){K=Date.now(),i.loadRedPocketRain(),i.loadGoldPocketRain(),i.addProcess(),setTimeout(function(){i.store.redPocketRainLogger({stage:"degradation_status",degradationStatus:i.degradationStatus},{},{entryFps:i.fps[0],firstLoadFps:i.fps[1],firstClickFps:i.fps[2]})},5e3)}),a()(v()(i),"caclRedClickNum",function(){var e=E.h,t=Object(D.f)(.8,1);return 0===i.score?1:i.score===e?28:Math.floor(28*i.score*t/e)+1}),a()(v()(i),"stop",function(){var e=E.d[E.o.AWARD].amount;i.store.calcScore({redNum:i.caclRedClickNum(),awardNum:Math.floor(2*i.awardClicked/e),amount:i.redClicked+i.awardClicked,currentLevel:i.currentLevel,score:i.score,forceCanvas:i.forceCanvas})}),a()(v()(i),"loadRedPocketRain",function(){requestAnimationFrame(function e(){var t=Date.now()-K,n=E.d.RedPocket.amount;t>=i.createdRedNum*(1e3*E.a/n)&&(i.createRedPocketSprite(i.rpAlias,E.o.RED),i.visibleSpriteNum++,i.createdRedNum++,i.createdRedNum>=n)||requestAnimationFrame(e)})}),a()(v()(i),"loadGoldPocketRain",function(){requestAnimationFrame(function e(){var t=Date.now()-K,n=E.d.AwardPocket.amount;t>=(i.createdAwardNum+1)*(1e3*E.a/n)&&(i.createRedPocketSprite(i.apAlias,E.o.AWARD),i.visibleSpriteNum++,i.createdAwardNum++),i.createdAwardNum>=n||requestAnimationFrame(e)})}),a()(v()(i),"addProcess",function(){i.star=[],A("process0",{y:-32,x:90,width:265,height:105},i.stage),i.process=A("process2",{y:52,x:98,width:0,height:13},i.stage),[162,249,335].map(function(e){A("ss0",{y:40,x:e,width:30,height:32},i.stage),i.star.push(A("ss1",{y:40,x:e,width:30,height:32,alpha:0},i.stage))}),i.process.updateParticle=function(){if(i.process.visible&&!(i.currentLevel>=4)){var e=i.redClicked+i.awardClicked;i.process.width+=E.g[i.currentLevel].width,e>=E.g[i.currentLevel].num&&(i.star[i.currentLevel-1].alpha=1,i.currentLevel+=1,i.process.x-=2)}}}),a()(v()(i),"createRedPocketSprite",function(e,t){var n=Object(D.f)(i.RED_START_MIN_X,i.RED_START_MAX_X),a=E.d[t],r=a.width,o=a.height,c=Object(D.f)(.008,.012),s=c>.01?c:-1*c,d="AwardPocket"===t?1.3*E.p:E.p,l=A(e,{y:-100,x:n,width:r,height:o,pxPeerMs:(d/16.6).toFixed(2),anchor:E.b,interactive:!0,rotation:c,createTimeStamp:Date.now()},i.stage);l.updateParticle=function(){l.visible&&("frame"===i.store.vyType?l.y=function(e,t){return e*((arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now())-t)-100}(l.pxPeerMs,l.createTimeStamp):l.y+=d,l.rotation+=s,l.y>i.size.height+110/i.scale&&(i.stage.removeChild(l),i.visibleSpriteNum--,i.globalSprite.splice(i.globalSprite.indexOf(l),1)))},i.globalSprite.push(l),l.on("tap",function(e){return i.onRpClick(e,l,t)})}),a()(v()(i),"checkGameEnding",function(){i.createdRedNum>=E.d.RedPocket.amount&&i.createdAwardNum>=E.d.AwardPocket.amount&&(i.visibleSpriteNum<=0&&(clearTimeout(i.stopTimer),i.checkGameEnding=function(){},i.stopTimer=setTimeout(function(){i.stop()},100)),!i.stopTimer&&(i.stopTimer=setTimeout(function(){i.stop()},1.5*E.d.RedPocket.duration)))}),a()(v()(i),"onRpClick",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.o.RED;e&&(e.stopPropagationHint=!0);var a=t.x,r=t.y;switch(i.removeRedPocket(t),i.visibleSpriteNum--,i.useEffect&&j(a,r,n,i.stage),n){case E.o.RED:i.redClicked++,i.score++;break;case E.o.AWARD:i.awardClicked++,i.score+=3;break;case E.o.LUCKYBAG:i.redClicked++,i.score++,i.store.toggleContainGoods(!0)}i.useDoubleHit&&B(i.redClicked+i.awardClicked,.5*i.size.width/i.scale,.53*i.size.height/i.scale,i.containers.bgContainer,i.globalSprite),i.store.pixiSpriteClick++,i.redClicked+i.awardClicked===1&&(i.store.redPocketRainLogger({stage:"sprite_click"}),i.startRecordFps(),i.checkIfDegradation()),i.process.updateParticle()}),a()(v()(i),"removeRedPocket",function(e){i.stage&&i.stage.removeChild(e),e&&(e.visible=!1),i.globalSprite.splice(i.globalSprite.indexOf(e),1)}),i}return y()(t,e),h()(t,[{key:"startRecordFps",value:function(){Z=0}},{key:"recordFpsTimeStamp",value:function(){1!==++Z?U=Date.now():J=Date.now()}},{key:"degradationStatus",get:function(){return this.useDoubleHit?this.useEffect?E.c.NORMAL:E.c.HIDE_EFFECT:E.c.HIDE_DOUBLE_HIT}}]),t}(S),I=k()(H.prototype,"addStartCount",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){return e.store.postHideGifMessage(),e.store.redPocketRainLogger({stage:"send_hide_notification"}),e.loadMeteors(),e.useCarousel?e.addCountCarousel():e.addDefaultCount()}}}),H),V=i("mlqF"),$=i("ez7s");function ee(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}t.default={setup:function(e,t){var i=new Q({root:t,store:e,width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight,resolution:window.devicePixelRatio>2?2:window.devicePixelRatio});return i.loadImages([].concat(o()(E.f),o()(E.r)).map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(i),!0).forEach(function(t){a()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ee(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},e,{src:Object($.a)(e.src,e.noZip?{webpEnable:V.b}:{resizeWidth:e.resizeWidth||200,quality:80,webpEnable:V.b})})})).on("progress",i.loadProgressHandler).load(i.init),i}}}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/mobile-layer/js/../js/redPocketRain-5437dcc45ebcb1544aa.js.map