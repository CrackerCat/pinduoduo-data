(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[22],{"3Wbp":function(e,t,a){"use strict";a.r(t);var r=a("MVZn"),n=a.n(r),i=a("QILm"),s=a.n(i),o=a("lwsE"),h=a.n(o),c=a("W8MJ"),_=a.n(c),p=a("a1gu"),u=a.n(p),E=a("Nsbk"),S=a.n(E),l=a("iWIM"),d=a.n(l),I=a("7W2i"),f=a.n(I),m=a("KoDT"),A=a("h3qu"),O=a("MpJ2"),T=a("dKgK"),v=a("a/1V"),y=function(e){return Object(m.a)().version},g=60006;function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],y());return Object(m.a)().platform===A.a.PddIOS&&Object(A.c)(a,e)>=0||Object(m.a)().platform===A.a.PddAndroid&&Object(A.c)(a,t)>=0||Object(m.a)().platform===A.a.PDDTinyAndorid}var R=function(){var e=y();return Object(m.a)().platform===A.a.PddIOS&&Object(A.c)(e,"5.80.0")>=0},b=function(){return C("4.85.0","4.85.0")},N=function(){return C("5.41.0","5.41.0")},L=function(){return"JSShare"},D=a("/bZk"),P=a("chhR"),H=a("EECB"),M=a("o0o1"),k=a.n(M),j=a("cDf5"),U=a.n(j),w=a("yXPU"),W=a.n(w),x=a("YSLc"),G=a("W9H9"),B=a("gfNA"),Y=a("Ne86"),K=a("7sJ8"),Q=a("8l/m"),V=a("rIj9"),F="api/flow/audience/share/types",Z=a("v1av"),q=a("z4CT"),X=a("dp2P"),z=D.b.ShareErrorCode,J=function(){function e(){h()(this,e),this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}return _()(e,[{key:"build",value:function(){var e=this;return this._inited?Promise.resolve():(this._queryShareTypePromise||(this._queryShareTypePromise=this.loadRules(),this._queryShareTypePromise.then(function(t){return e._inited=!0,e._processRules(t),Z.a.getInstance().build({magicTrace:t.magic_trace})}).catch(function(t){Object(q.a)({errorCode:0,message:"分享规则初始化失败",options:{message:t&&t.message,errorCode:t&&t.errorCode}}),e._inited=!0})),this._queryShareTypePromise)}},{key:"reset",value:function(){this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}},{key:"getAppOptional",value:function(){return this.appOptional}},{key:"getRules",value:function(){var e=this;return this.build().then(function(){return e._rules},function(){return Promise.resolve(e._rules)})}},{key:"loadRules",value:function(){return Object(m.a)().isNativePlatform?Object(O.g)(L(),"queryShareTypes",{page_sn:Object(Q.c)()+"",page_info:{page_name:Object(Q.b)(),page_url:location&&location.href}}):function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(V.a)({pageInfo:{pageId:Object(Q.a)()}},{defaultErrorHandler:function(e){}}),r={};return r.page_sn=t.pageSn||"",r.page_info=t.pageInfo||{},r.platform="h5","post"===e.toLowerCase()?a.post(F,r):a.get(F,{params:r})}("post",{pageSn:Object(Q.c)()+"",pageInfo:{page_name:Object(Q.b)(),page_url:location&&location.href}})}},{key:"_processRules",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.share_types||[];this.appOptional=e.app_optional,this._rom=e.rom,this._matchedPkgId=e.matched_pkg_id,this._enableSilentMode=e.is_weird,e.degrade&&this.setCipherDowngrade(!0);var a=[];return this._rules=t.reduce(function(e,t){var r=t.share_type;return r&&(e[r]=t,a.push(parseInt(r,10))),e},{}),this._innerShareTypes=e.inner_share_types||[],this._innerShareTypes.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.push(parseInt(e.share_type,10))}),this._enableShareTypes=a,this._rules}},{key:"getRuleByType",value:function(e){return(this._rules||{})[e]}},{key:"checkSync",value:function(e,t){if(!this._rules)return z.SHARE_LIMITER_NOT_INIT;if(this._enableShareTypes.indexOf(e)<0)return z.SHARE_TYPE_DISABLED;var a=t.getShareForm(e),r=(this.getRuleByType(e)||{}).share_methods||[];return[G.a.COMMAND,G.a.TEXT].indexOf(a)>=0?Object(X.c)(t.urlWrapType)&&t.marketActivityID&&(t.shortURLApi&&r.indexOf(K.a.LINK)>=0||t.shortCommandApi&&r.indexOf(K.a.CIPHER)>=0||t.urlWrapType===X.a.CATEGORY_PROCEDURE||t.urlWrapType===X.a.CATEGORY_PROCEDURE_CUSTOM)?0:r.indexOf(K.a.NORMAL)>=0?0:z.SHARE_TYPE_DISABLED:[v.a.WECHAT_SESSION,v.a.WECHAT_TIMELINE].indexOf(e)>=0?Object(X.d)(t.urlWrapType)&&t.marketActivityID&&r.indexOf(K.a.DOMAIN)<0?z.SHARE_TYPE_DISABLED:r.indexOf(K.a.NORMAL)>=0?0:z.SHARE_TYPE_DISABLED:0}},{key:"setCipherDowngrade",value:function(e){this._isCipherDowngrade=e}},{key:"isCipherDowngrade",get:function(){return this._isCipherDowngrade}},{key:"rom",get:function(){return this._rom}},{key:"matchedPkgId",get:function(){return this._matchedPkgId}},{key:"isSilentMode",get:function(){return this._enableSilentMode}}]),e}(),$=null;function ee(){return $||($=new J),$}var te=a("bbLm"),ae=a("rUjM"),re="api/flow/walrus/inquire/confusion/info",ne="api/flow/chron/share/card",ie={MAIN:0,GENERAL:1,TP:2};function se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae.a.TP_FIRST,[]),a=[],r=[],n=[];return e.forEach(function(e){if(e)switch(e.dev_type){case ie.GENERAL:t.push(e);break;case ie.TP:a.push(e);break;case ie.MAIN:r.push(e);break;default:n.push(e)}}),b()||(t=a=[]),a[0]||t[0]||r[0]}function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=Object(V.a)({pageInfo:{pageId:Object(Q.a)()}},{defaultErrorHandler:function(e){}}),r=n()({scene_id:e.activitySceneSn,long_url:e.shareURL||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,param:{},page_sn:Object(Q.c)()},Object(te.b)(e));return e.payloadMixin&&"object"===U()(e.payloadMixin)&&(r=Object.assign({},e.payloadMixin.param_map,r)),"string"!=typeof r.param&&(r.param=JSON.stringify(r.param)),a.post(ne,{param_map:r}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(e.infos||[]).filter(function(e){return Object.keys(e).length>0});return{raw:e,info:se(a,t),tpInfos:a,tpDowngrade:a.length<=0}})}var he=a("Qm63"),ce=a("2Goq"),_e=a("T8QY"),pe=a("J4zp"),ue=a.n(pe),Ee=a("6wpZ"),Se={QUERY_CODE:0,QUERY_TEXT:1,POP_CIPHER:2};var le={};function de(e){var t=e.consumeMode,a=e.scene;if("number"!=typeof t||[Ee.a.CONSUME_RAW,Ee.a.RECYCLE_RAW].indexOf(t)>=0)return Promise.resolve();var r=function(e){if(e&&!(e.length<=0)){if([Ee.a.CONSUME_TIME_DIVIDE,Ee.a.RECYCLE_TIME_DIVIDE].indexOf(t)>=0){var a=new Date,r=a.getMinutes(),n=a.getSeconds();return e[Math.floor(e.length*(60*r+n)/3600)]}if(Ee.a.RECYCLE_TIME_DIVIDE_MULTI===t){var i=e.length,s=Math.min(Math.max(parseInt(window.__SHARE_CIPHER_PARALLEL_SIZE__,10)||0,2),i),o=Math.max(Math.floor(i/s),1),h=Math.floor(Math.random()*s),c=new Date,_=c.getMinutes(),p=c.getSeconds(),u=Math.floor(o*(60*_+p)/3600);return e[Math.max(h*o+u,i-1)]}return e[0]}},n=(le[a]||{}).texts;return n?Promise.resolve(r(n)):function(e){return Object(O.g)(L(),"getLocalCipherInfo",{action:Se.QUERY_TEXT,page_sn:Object(Q.c)()+"",scene:e}).then(function(){var t=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).texts||[]).map(function(e){if(e)return e.version&&Object(A.c)(e.version,window.__SHARE_CIPHER_VER__||"0.0.1")>=0?e.text:e.version?void 0:e.text}).filter(function(e){return!!e});return le[e]=le[e]||{},le[e].texts=t,t},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(q.a)({errorCode:e.errorCode,message:"本地获取口令文本失败",options:e.data}),null})}(a).then(r)}function Ie(e){var t=e.consumeMode,a=e.scene;return"number"!=typeof t?Promise.resolve():[Ee.a.CONSUME,Ee.a.CONSUME_TIME_DIVIDE,Ee.a.CONSUME_RAW].indexOf(t)>=0?function(e){return Object(O.g)(L(),"getLocalCipherInfo",{action:Se.POP_CIPHER,page_sn:Object(Q.c)()+"",scene:e}).then(function(e){return e.cipher},function(e){return Object(q.a)({errorCode:e.errorCode,message:"本地消费口令码失败",options:e.data}),null})}(a):function(e){return Object(O.g)(L(),"getLocalCipherInfo",{action:Se.QUERY_CODE,page_sn:Object(Q.c)()+"",scene:e}).then(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ciphers||[]},function(e){return Object(q.a)({errorCode:e.errorCode,message:"本地获取口令码失败",options:e.data}),null})}(a).then(function(e){if(e&&!(e.length<=0))return e[0]})}var fe=a("q8Ib");function me(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Object(m.a)().isNativePlatform?Ae.apply(void 0,t).then(function(e){return e.missed?Y.d.apply(void 0,t):e}):Y.d.apply(void 0,t)}var Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shareURL||"",a=e.urlWrapType;if(e.marketActivityID&&e.activitySceneSn&&a===X.a.CATEGORY_PROCEDURE){var r=ee().matchedPkgId;return oe(Object.assign({rom:ee().rom,matchedPkgId:r},e),e.tpSelectCategory).then(function(e){var a=e.info,r=e.tpInfos,n=e.tpDowngrade,i={raw:e.raw,tpDowngrade:n,tpInfo:a,tpInfos:r,realShareURL:(a||r[0]||{}).link_url||t,targetShareURL:t},s=new Error("category procedure");return s.data=i,Promise.reject(s)})}if(e.marketActivityID&&a===X.a.CATEGORY_PROCEDURE_CUSTOM){var n=Object(X.d)(a)?fe.b.WEIXIN_TINY_DOMAIN:fe.b.SHORT_LINK,i=t.replace(/^(\w+:)?\/\//,"");return Object(fe.c)(e.requestUsePost?"post":"get",{shareURL:i,marketActivityID:e.marketActivityID,platform:Object(Y.c)(),shareDomainType:n,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin}).then(function(e){var t=new Error("category procedure custom");return t.data=e,Promise.reject(t)})}if(e.marketActivityID&&e.activitySceneSn&&a===X.a.SERVER_TP_APP){var s=ee().matchedPkgId;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=Object(V.a)({pageInfo:{pageId:Object(Q.a)()}},{defaultErrorHandler:function(e){}}),r={long_url:e.shareURL||"",activity_code:(e.marketActivityID||0)+"",scene_sn:e.activitySceneSn||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,params:{}};return e.payloadMixin&&"object"===U()(e.payloadMixin)&&(r=Object.assign(r,e.payloadMixin)),"string"!=typeof r.params&&(r.params=JSON.stringify(r.params)),a.post(re,r).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(e.infos||[]).filter(function(e){return Object.keys(e).length>0});return{raw:e,info:se(a,t),tpInfos:a,tpDowngrade:a.length<=0}})}(Object.assign({rom:ee().rom,matchedPkgId:s},e),e.tpSelectCategory).then(function(e){var a=e.info,r=e.tpInfos;return{tpInfo:a,tpDowngrade:e.tpDowngrade,tpInfos:r,realShareURL:(a||r[0]||{}).link_url||t,targetShareURL:t}},function(e){return Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})})}if(e.marketActivityID&&Object(X.b)(a)){var o=Object(X.d)(a)?fe.b.WEIXIN_TINY_DOMAIN:fe.b.SHORT_LINK,h=t.replace(/^(\w+:)?\/\//,""),c=Object(he.a)(e),_=e.cipherScene,p=e.consumeMode,u=Object(ce.a)(),E=function(){var r=new Promise(function(r,n){Object(fe.c)(e.requestUsePost?"post":"get",{shareURL:h,marketActivityID:e.marketActivityID,platform:Object(Y.c)(),shareDomainType:o,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin}).then(function(e){if(e){var i=e.domain,s=void 0===i?"":i,h=e.shortURL,c=e.shareText,_=e.raw;if(o===fe.b.WEIXIN_TINY_DOMAIN)a===X.a.DOMAIN_REPLACE&&r(Object(Y.a)(t,s));else if(o===fe.b.SHORT_LINK){if(!h&&!c){var p=new Error("empty short_url with empty share_text");return p.data=_,p.extraInfo=_,void n(p)}return void r({useShortURL:!0,realShareURL:h||t,targetShareURL:t,shareText:c,rawResponse:_})}}r({realShareURL:t,targetShareURL:t})}).catch(function(e){n(e)})});return o===fe.b.SHORT_LINK&&r.then(function(e){e&&e.useShortURL&&(u.cacheResponseByHash(c,e),u.setShareID(c,(new _e.a(t).query||{}).refer_share_id))}),r};if(a===X.a.SERVER_SHORT_URL_WITH_CACHE){var S=u.getResponseByHash(_);return S?(u.increaseCount(_),Promise.resolve(S)):(S=u.getResponseByHash(c))?(u.increaseCount(c),Promise.resolve(S)):_&&ee().isCipherDowngrade?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.scene,a=e.consumeMode;return Object(m.a)().isNativePlatform&&N()&&t&&"number"==typeof a?Promise.all([Ie(e),de(e)]).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=ue()(e,2),r=t[0],n=t[1];return r&&[Ee.a.CONSUME_RAW,Ee.a.RECYCLE_RAW].indexOf(a)>=0?r:r&&n?Object.assign({text:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.replace(/%s/g,t)}(n,r.cipher)},r):void 0}):Promise.resolve()}({scene:_,consumeMode:p}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&e.share_id){var t={cipher:e.cipher,shareText:e.text,shareID:e.share_id};return u.cacheResponseByHash(_,t),u.setShareID(_,e.shareID),t}return E()},function(e){return E()}):E()}return E()}if(e.activitySceneSn&&a===X.a.SERVER_TP_APP_CARD){var l=ee().matchedPkgId;return oe(Object.assign({rom:ee().rom,matchedPkgId:l},e),e.tpSelectCategory).then(function(e){var a=e.info,r=e.tpInfos,n=e.tpDowngrade,i=e.raw;return{tpInfo:a,tpDowngrade:n,tpInfos:r,realShareURL:(a||r[0]||{}).link_url||t,categoryShareInfo:{thumbnailURL:(a||r[0]||{}).thumb_img_url},targetShareURL:t,rawResponse:i}},function(e){return Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})})}return Promise.resolve({missed:!0,realShareURL:t,targetShareURL:t})},Oe=a("XfDS"),Te=a("Upw4");function ve(){return ye.apply(this,arguments)}function ye(){return(ye=W()(k.a.mark(function e(){var t,a,r,n=arguments;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},"function"==typeof(a=n.length>1?n[1]:void 0).cipherProcessor){e.next=4;break}return e.abrupt("return",t);case 4:return e.prev=4,e.next=7,a.cipherProcessor({cipherText:t.title,cipherCode:t.cipher,shareEntity:a});case 7:"string"==typeof(r=e.sent)&&(t.title=t.desc=r),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}},e,null,[[4,11]])}))).apply(this,arguments)}var ge="static",Ce="dynamic",Re=function(e){return e?Array.isArray(e)&&e.length>0?e[0]:"object"===U()(e)?e:null:null},be=function(e){return e?Array.isArray(e)&&e.length>0?e.map(function(e,t){return e?"string"==typeof e?{type:ge,data:e}:"object"===U()(e)?e.type?e:{type:Ce,options:e}:void 0:null}).filter(function(e){return!!e}):"object"===U()(e)?[{type:Ce,options:e}]:[]:[]};function Ne(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.drawImageOptions;return"function"==typeof r?r(a=n()({shareRefer:Object(te.b)(e)},a||{})):"object"===U()(r)?t?Promise.resolve(be(r)):Promise.resolve(Re(r)):Promise.resolve({})}var Le=a("1dcj"),De=function(e){function t(e){var a;return h()(this,t),(a=u()(this,S()(t).call(this,e))).drawImageOptions=e.drawImageOptions,a.redirectURI=e.redirectURI||"",a.miniObjectPath=e.miniObjectPath||"",a.miniObjectID=e.miniObjectID,a.useWxAppShare=e.useWxAppShare||!1,a.forceDowngrade=e.forceDowngrade||!1,a.excludeShareChoices=e.excludeShareChoices||[],a.thirdPartyOpenType=e.thirdPartyOpenType,a.drawImageClass=e.drawImageClass,a.needSharedAmount=e.needSharedAmount||!1,a.cipherScene=e.cipherScene,a.consumeMode=e.consumeMode,a.activitySceneSn=e.activitySceneSn,a.tpSelectCategory=e.tpSelectCategory,a.pinTimelineParams=e.pinTimelineParams,a.withShareTicket=e.withShareTicket,a.systemShareMode=e.systemShareMode||Le.a.DEFAULT,a.wechatMaskConfig=e.wechatMaskConfig,a}return f()(t,e),_()(t,[{key:"normalize",value:function(){var e=W()(k.a.mark(function e(t){var a,r,i,o,h,c,_,p,u,E,S,l,d=this;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==v.a.COPY_CIPHER){e.next=2;break}return e.abrupt("return",this.processCipher());case 2:if(a=Object.assign({},this),t!==v.a.PIN_TIMELINE){e.next=5;break}return e.abrupt("return",a.pinTimelineParams);case 5:r={title:a.title,desc:a.message,thumbnail:a.thumbnailURL,share_url:a.shareURL,share_id:a.shareID,with_share_ticket:!!a.withShareTicket,system_share_mode:a.systemShareMode},(i=a.wechatMaskConfig)&&"object"===U()(i)&&(o=i.share_rec_mask,h=s()(i,["share_rec_mask"]),c=n()({},h),o&&(c.share_rec_mask=n()({share_type:t,activity_code:a.marketActivityID,share_id:a.shareID},o)),r.wechat_mask_config=c),a.payloadMixin&&(_=a.payloadMixin.extra,"object"===U()(_)&&void 0!==_.share_prefer&&(r.share_prefer=_.share_prefer)),p=!1,e.t0=t,e.next=e.t0===v.a.WECHAT_SESSION?13:e.t0===v.a.WECHAT_TIMELINE_IMAGE?16:e.t0===v.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK?16:e.t0===v.a.WECHAT_SESSION_IMAGE?16:e.t0===v.a.QQ_CHAT_SESSION_IMAGE?16:e.t0===v.a.QQ_ZONE_IMAGE?16:e.t0===v.a.WEIBO_IMAGE?16:e.t0===v.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK?16:e.t0===v.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK?21:e.t0===v.a.SHARE_IMAGE_PASSIVELY?26:e.t0===v.a.IOS_SYSTEM_SHARE_CARD?32:e.t0===v.a.WECHAT_SESSION_CARD_WITH_NO_SDK?32:e.t0===v.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK?32:34;break;case 13:if(a.miniObjectPath&&"string"==typeof a.miniObjectPath)r.mini_object_path=Object(te.a)(a);else if("function"==typeof a.miniObjectPath)try{r.mini_object_path=a.miniObjectPath(a.shareURL)}catch(e){}return a.miniObjectID&&(r.mini_object_id=a.miniObjectID),e.abrupt("break",35);case 16:return p=!0,e.next=19,Ne(a);case 19:return r.options=e.sent,e.abrupt("break",35);case 21:return p=!0,e.next=24,Ne(a,!0);case 24:return r.multi_image_options=e.sent,e.abrupt("break",35);case 26:return p=!0,e.next=29,Ne(a);case 29:return r.options=e.sent,a.thirdPartyOpenType&&(r.open_type=a.thirdPartyOpenType),e.abrupt("break",35);case 32:return r.excluded_types=a.excludeShareChoices,e.abrupt("break",35);case 34:return e.abrupt("break",35);case 35:if(u=this.getShareForm.call(a,t),E=[G.a.COMMAND,G.a.TEXT].indexOf(u)>=0,this.targetShareURL=a.shareURL,this.realShareURL=a.shareURL,this.useShortURL=!1,t===v.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=r.mini_object_path),Object(Te.a)(t)&&(S=Object(Y.b)(t,a.shareURL),r.share_url=S,this.shareURL=S,this.realShareURL=S,this.targetShareURL=S),t===v.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=this.targetShareURL=r.mini_object_path),u!==G.a.CARD&&u!==G.a.WXAPP_CARD||!a.urlWrapType){e.next=47;break}return e.abrupt("return",me(a).then(function(e){var t=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,s=e.tpDowngrade,o=e.tpInfo,h=e.tpInfos,c=e.appendQuery,_=e.categoryShareInfo,p=e.useCipher,u=e.missed,E=e.rawResponse,S=void 0===E?{}:E;return p?Promise.reject(new Error("operation refused")):(u||(d.useShortURL=i,d.realShareURL=t,d.targetShareURL=n),r.share_url=t,o&&(r.title=o.title||r.title,r.desc=o.message||r.desc),_&&(r.title=_.title||r.title,r.thumbnail=_.thumbnailURL||r.thumbnail),r.tpInfo=o,r.tpInfos=h,r.tpDowngrade=s,r.rawResponse=S,a.urlWrapType===X.a.SERVER_QUERY_APPEND&&"string"==typeof r.mini_object_path&&r.mini_object_path&&(r.mini_object_path=Object(te.a)({miniObjectPath:r.mini_object_path,shareURL:t},{appendQuery:c}),d.realShareURL=r.mini_object_path),r)}));case 47:if(!p||!Object(X.c)(a.urlWrapType)&&a.urlWrapType!==X.a.MAGIC_TRACE&&a.urlWrapType!==X.a.MAGIC_TRACE_DYNAMIC){e.next=51;break}return e.abrupt("return",me(a).then(function(){var e=W()(k.a.mark(function e(){var t,n,i,s,o,h=arguments;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},n=t.realShareURL,i=t.targetShareURL,s=t.useShortURL,o=t.shareText,d.targetShareURL=i,a.shortCommandApi?(d.pcode=o,r.share_url=o):(d.useShortURL=s,d.realShareURL=n,r.share_url=s?Object(Oe.a)(n):n),!s){e.next=16;break}if(!r.multi_image_options){e.next=11;break}return e.next=8,Ne(a,!0,t);case 8:r.multi_image_options=e.sent,e.next=16;break;case 11:if(!r.options){e.next=16;break}return e.next=14,Ne(a,!1,t);case 14:r.options=e.sent,r.options&&"object"===U()(r.options)&&r.options.$params&&(Object.assign(r,r.options.$params),delete r.options.$params);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()));case 51:if(!E){e.next=62;break}if(l=r.title||"",!Object(X.c)(a.urlWrapType)){e.next=57;break}return e.abrupt("return",me(a).then(function(e){var t=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,s=e.shareText,o=e.shareID,h=e.cipher,c=e.tpInfo,_=e.tpInfos,p=e.tpDowngrade,u=e.rawResponse,E=void 0===u?{}:u;if(o&&(r.shareID=o),h&&(r.cipher=h),c&&(r.title=c.link_url||r.title,r.desc=c.link_url||r.desc,l=r.title),r.tpInfo=c,r.tpInfos=_,r.tpDowngrade=p,r.rawResponse=E,d.targetShareURL=n,a.shortCommandApi){var S=i||h?s:"",I=S||n;l=Object(B.b)(l,I,n,S),r.title=r.desc=l,d.pcode=l}else{var f=i?t:"",m=f||n;l=Object(B.b)(l,m,n,f),r.title=r.desc=l,d.useShortURL=i,d.realShareURL=m}return ve(r,a)}));case 57:return l=Object(B.b)(l,a.shareURL),r.title=r.desc=l,e.abrupt("return",ve(r,a));case 60:e.next=63;break;case 62:return e.abrupt("return",Promise.resolve(r));case 63:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getShareForm",value:function(e){return e===v.a.WECHAT_SESSION?this.miniObjectPath||this.useWxAppShare?G.a.WXAPP_CARD:G.a.CARD:[4,2,5,6,24,25,18,9996,9997].includes(e)?G.a.CARD:[8,9,10,11,12,13,15,19,20,22].includes(e)?G.a.IMAGE:[3,16,17,21,v.a.COPY_CIPHER].includes(e)?this.shortCommandApi?G.a.COMMAND:G.a.TEXT:e===v.a.COPY_LINK?G.a.COPY_LINK:G.a.DEFAULT}},{key:"getShareMethod",value:function(e){return[9,16,19,20,18,9996,9997].includes(e)?x.a.SYSTEM:[1,2,3,4,5,8,10,11,12,13,15,17,21,24,25].includes(e)?x.a.SDK:e===v.a.SHARE_IMAGE_PASSIVELY?this.thirdPartyOpenType?x.a.MANUAL:x.a.DEFAULT:e===v.a.COPY_CIPHER?x.a.MANUAL:x.a.DEFAULT}}]),t}(B.a),Pe=a("A4fa"),He=a("WiBJ");var Me=a("KxTr"),ke=Object.keys(v.a).map(function(e){return v.a[e]}).filter(function(e){return[v.a.WECHAT_BIG_IMAGE].indexOf(e)<=0}),je=function(e){function t(e){var a;return h()(this,t),(a=u()(this,S()(t).call(this,e))).ShareEntityClass=De,a._enableShareTypes=ke.concat(),a.shareLimiter=ee(),a._isEnableShareCheck=!1,a.setShareCheck(!0),a}return f()(t,e),_()(t,[{key:"setShareCheck",value:function(e){Object(m.a)().isTinyNativePlatform?this._isEnableShareCheck=!0:this._isEnableShareCheck=!!e&&C("4.51.0","4.51.0")}},{key:"checkShareTypeEnable",value:function(e){var t=this.getShareEntityByShareType(e);if(!this.validateShareParams(e,t))return D.a.SHARE_PARAMS_NOT_VALID;if(!function(e){var t=!1;if("number"!=typeof e)return!1;switch(e){case v.a.WECHAT_SESSION:case v.a.WECHAT_TIMELINE:case v.a.WECHAT_SESSION_APP:case v.a.QQ_CHAT_SESSION:case v.a.QQ_ZONE:case v.a.WECHAT_TIMELINE_IMAGE:case v.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK:case v.a.WECHAT_SESSION_IMAGE:case v.a.QQ_CHAT_SESSION_IMAGE:case v.a.QQ_ZONE_IMAGE:case v.a.WECHAT_SESSION_TEXT_WITH_NO_SDK:case v.a.WECHAT_SESSION_TEXT:t=!0;break;case v.a.WEIBO:case v.a.WEIBO_IMAGE:t=C("4.81.0","4.81.0");break;case v.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK:case v.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK:t=C("4.37.0","4.36.0");break;case v.a.WECHAT_TIMELINE_TEXT:t=C("4.39.0","4.39.0");break;case v.a.IOS_SYSTEM_SHARE_CARD:case v.a.WECHAT_SESSION_CARD_WITH_NO_SDK:case v.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK:t=R();break;case v.a.SHARE_IMAGE_PASSIVELY:t=C("4.49.0","4.49.0");break;case v.a.COPY_LINK:case v.a.COPY_CIPHER:t=!0;break;case v.a.WECHAT_SESSION_MUSIC:case v.a.WECHAT_SESSION_VIDEO:t=C("4.86.0","4.86.0");break;case v.a.FRIENDS:case v.a.WECHAT_BIG_IMAGE:t=!0;break;case v.a.PIN_TIMELINE:t=C("5.6.0","5.6.0")}return t}(e)||this._enableShareTypes.indexOf(e)<0)return D.a.SHARE_TYPE_DISABLED;if(this._isEnableShareCheck&&[v.a.COPY_LINK,v.a.COPY_CIPHER].indexOf(e)<0){var a=this.shareLimiter.checkSync(e,t);if(a)return a}return 0}},{key:"share",value:function(e){var t=this.checkShareTypeEnable(e);return t||(e===v.a.PIN_TIMELINE?this._sharePinTimeline(e):e===v.a.WECHAT_BIG_IMAGE?this._nativeShareBigImage(e):[v.a.WECHAT_SESSION,v.a.WECHAT_TIMELINE,v.a.WEIBO,v.a.QQ_CHAT_SESSION,v.a.QQ_ZONE,v.a.TENCENT_WEIBO,v.a.WECHAT_SESSION_APP,v.a.FRIENDS,v.a.WECHAT_SESSION_MUSIC,v.a.WECHAT_SESSION_VIDEO].indexOf(e)>=0?this._nativeShareCard(e):[v.a.IOS_SYSTEM_SHARE_CARD,v.a.WECHAT_SESSION_CARD_WITH_NO_SDK,v.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK].indexOf(e)>=0?this._nativeShareCardSpecial(e):[v.a.WECHAT_TIMELINE_IMAGE,v.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK,v.a.WECHAT_SESSION_IMAGE,v.a.QQ_CHAT_SESSION_IMAGE,v.a.QQ_ZONE_IMAGE,v.a.WEIBO_IMAGE,v.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK,v.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK,v.a.SHARE_IMAGE_PASSIVELY].indexOf(e)>=0?this._nativeShareImage(e):[v.a.WECHAT_SESSION_TEXT_WITH_NO_SDK,v.a.WECHAT_SESSION_TEXT,v.a.WECHAT_TIMELINE_TEXT].indexOf(e)>=0?this._nativeShareText(e):v.a.COPY_LINK===e?this._nativeShareClipboard(e):v.a.COPY_CIPHER===e?this.copyCipher():D.a.SHARE_TYPE_NOT_FOUND)}},{key:"validateShareParams",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0}},{key:"_setupShareTypes",value:function(){}},{key:"resetLimiter",value:function(){return this.shareLimiter.reset(),this._queryShareTypePromise=null,this.waitShareLimiter()}},{key:"refreshShare",value:function(e,a){var r=d()(S()(t.prototype),"refreshShare",this).call(this,e,a);return this.emit(P.a.ON_SHARE_PREPARE,{shareType:a}),r}},{key:"_setupPlatformShareSDK",value:function(){return this.waitShareLimiter()}},{key:"waitShareLimiter",value:function(){var e=this;return this._isEnableShareCheck?(this._queryShareTypePromise||(this._queryShareTypePromise=this.shareLimiter.build().catch(function(t){return e.emit(P.a.SHARE_LIMIT_LOAD_FAIL),Promise.resolve()})),this._queryShareTypePromise):Promise.resolve()}},{key:"_nativeShareCard",value:function(e){var t=this;this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e});var a=this.getShareEntityByShareType(e);return a.normalize(e).then(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tpInfo,i=r.tpInfos,o=r.tpDowngrade,h=r.wechat_mask_config,c=r.rawResponse,_=void 0===c?{}:c,p=s()(r,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config","rawResponse"]);if(o)t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.FAIL,tpDowngrade:!0,tpInfo:n});else{var u=_.sdk_type,E=Object.assign({type:e,redirect_uri:a.redirectURI||"",share_params:p,share_method:Object(He.a)(a,e),sdk_type:u});a.needSharedAmount&&(E.show_check_detail=1),h&&(E.wechat_mask_config=h),n&&n.dev_type&&(E.dev_app=n.dev_app,E.dev_type=n.dev_type),i&&(E.dev_infos=i),t._invokeNativeShare(E,function(a){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,responseData:a,tpInfo:n})},function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=parseInt(a.errorCode,10)||0,i=r===g?H.a.CANCEL:H.a.FAIL;t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:i,nativeShareErrorCode:r,responseData:a.data,tpInfo:n})})}},this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareCardSpecial",value:function(e){var t=this;this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e});var a=this.getShareEntityByShareType(e);return a.normalize(e).then(function(r){var n=Object.assign({type:v.a.IOS_SYSTEM_SHARE_CARD,share_params:r,share_method:Object(He.a)(a,e)});t._invokeNativeShare(n,function(a){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,responseData:a})},function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=parseInt(a.errorCode,10)||0,n=r===g?H.a.CANCEL:H.a.FAIL;t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:r,responseData:a.data})})},this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareImage",value:function(e){var t=this;this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e});var a=this.getShareEntityByShareType(e),r=e;return a.normalize(e).then(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.share_code,o=n.system_share_mode,h=n.wechat_mask_config,c=s()(n,["share_code","system_share_mode","wechat_mask_config"]),_={type:r,share_params:c,share_method:Object(He.a)(a,e),share_code:i,system_share_mode:o};h&&(_.wechat_mask_config=h);t._invokeNativeShare(_,function(a){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,responseData:a})},function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=parseInt(a.errorCode,10),n=r===g?H.a.CANCEL:H.a.FAIL;t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:r,responseData:a.data})})},this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareText",value:function(e){var t=this,a=this.getShareEntityByShareType(e),r=a.cipherScene&&"string"==typeof a.cipher;!r&&this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e});var n=e;return a.normalize(e).then(function(i){var o=i.tpInfo,h=i.tpInfos,c=i.tpDowngrade,_=i.wechat_mask_config,p=s()(i,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config"]);if(r&&(t.emit(P.a.ON_SHARE_TRIGGER,{shareType:e,shareID:p.shareID}),delete p.shareID),c)t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.FAIL,tpDowngrade:!0,tpInfo:o});else{var u=Object.assign({type:n,share_params:p,share_method:Object(He.a)(a,e)});o&&o.dev_type&&(u.dev_app=o.dev_app,u.dev_type=o.dev_type),h&&(u.dev_infos=h),_&&(u.wechat_mask_config=_);if(a.forceDowngrade||Object(m.a)().system===A.b.IOS&&n===v.a.WECHAT_SESSION_TEXT_WITH_NO_SDK)return t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.FAIL,shareParams:i}),0;t._invokeNativeShare(u,function(a){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,responseData:a})},function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=parseInt(a.errorCode,10)||0,n=r===g?H.a.CANCEL:H.a.FAIL;t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:r,responseData:a.data})})}},this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareBigImage",value:function(e){return D.a.SHARE_TYPE_DISABLED}},{key:"_nativeShareClipboard",value:function(e){var t=this;this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e});var a=this.getShareEntityByShareType(e);return a.normalize(e).then(function(){var r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).share_url||a.shareURL;(function(e){return"string"!=typeof e?Promise.reject():Object(m.a)().isNativePlatform?Object(O.g)("AMStorage","setPasteboard",{text:e}):Promise.reject()})(r).then(function(){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,content:r,originContent:""})},function(){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.FAIL,content:r,originContent:""})})},this.getNormalizeErrorHandler(e)),0}},{key:"_sharePinTimeline",value:function(e){var t=this;return this.emit(P.a.ON_SHARE_TRIGGER,{shareType:e}),this.getShareEntityByShareType(e).normalize(e).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.assign({type:e,share_params:a});t._invokeNativeShare(r,function(a){t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.SUCCESS,responseData:a})},function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=parseInt(a.errorCode,10)||0;t.emit(P.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:H.a.FAIL,nativeShareErrorCode:r,responseData:a.data})})},this.getNormalizeErrorHandler(e)),0}},{key:"setupNativeShareButton",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.shareIcon,r=void 0===a?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAM1BMVEUAAABmZmZmZmZlZWVmZmZmZmZlZWVlZWVoaGhlZWVkZGRmZmZlZWVlZWVlZWVmZmZmZmauFdI/AAAAEHRSTlMAhnjzbtHHEBrfJrGXRzZXUNTSwgAAAPRJREFUWMPt1+sKgzAMBWC71NbLLuf9n3a6sxFYN2vq/gxyEBSFz9pGaLpdOYucuyPJCUtSbheGHo/0Q6swjXhmnNqEqwCYHwfk2iJcFkEuJyDwyi7c+O6V4HhuViFyBkhwVqJNCFwHEq+1CTaB1UCCFWI0BJiXkxJLZkAso2BVK8FaD509SjB/QcQkWBO2iYA1kuLHn5KRbQKvFL8vhT2jUKOs55j3z0WORcUnvVEj9EF6/8JsIzKAd8K6qE444cTviNNBYhrHqZnQOOGEE0444USdyDYhA1Lsfs1dRqrtwTXVPTjTw5y+6EfMwvCtK6pHu6I7B+8m1re+k3UAAAAASUVORK5CYII=":a,n=t.shareIconSize,i=void 0===n?22:n;return"string"!=typeof r||"number"!=typeof i?D.a.SHARE_PARAMS_NOT_VALID:(Object(O.g)("JSUIControl","setRightBarButtons",{buttons:[{icons:{normal:r},callback:function(){e.emit(P.a.ON_SHARE_BUTTON_CLICKED)},size:i}]}).catch(function(e){}),0)}},{key:"_invokeNativeShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=L(),n="share",i=Object(Q.c)()+"";this._isEnableShareCheck?(e=Object.assign({origin:"h5",page_sn:i,page_info:{page_name:Object(Q.b)(),page_url:location&&location.href}},e),this.shareLimiter.getAppOptional()&&(e.app_optional=this.shareLimiter.getAppOptional()),n="performShare"):e.page_sn=i,Object(O.g)(r,n,e).then(t,a)}},{key:"shareCipherManually",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pe.a.OPEN_WECHAT,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me.a.DEFAULT,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e&&"string"==typeof e?C("4.74.0","4.74.0","4.80.0")?(t!==Pe.a.OPEN_WECHAT&&t!==Pe.a.OPEN_WECHAT_IOS_SILENT&&t!==Pe.a.OPEN_WECHAT_ANDROID_SILENT||(t=Object(m.a)().platform!==A.a.PDDTinyAndorid&&C("4.88.0","4.88.0")&&this.shareLimiter.isSilentMode?Object(m.a)().system===A.b.IOS?Pe.a.OPEN_WECHAT_IOS_SILENT:Pe.a.OPEN_WECHAT_ANDROID_SILENT:Pe.a.OPEN_WECHAT),Object(O.g)(L(),"shareCipher",n()({cipher:e,open_type:t,paste_type:a,share_code:r},i))):Promise.reject(new Error("not support")):Promise.reject(new Error("invalid cipher"))}}]),t}(T.a);t.default=je}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/mobile-eve-spike/js/ms_native_c_9ac03b9c132958a14503.js.map