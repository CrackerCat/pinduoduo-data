(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[20],{"3Wbp":function(e,t,r){"use strict";r.r(t);var a=r("MVZn"),n=r.n(a),i=r("QILm"),s=r.n(i),o=r("lwsE"),h=r.n(o),c=r("W8MJ"),_=r.n(c),u=r("iWIM"),p=r.n(u),S=r("7W2i"),l=r.n(S),E=r("a1gu"),d=r.n(E),f=r("Nsbk"),I=r.n(f),m=r("KoDT"),A=r("h3qu"),O=r("MpJ2"),T=r("dKgK"),y=r("a/1V"),v=function(e){return Object(m.a)().version},g=60006;function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=v();return Object(m.a)().platform===A.a.PddIOS&&Object(A.c)(r,e)>=0||Object(m.a)().platform===A.a.PddAndroid&&Object(A.c)(r,t)>=0||Object(m.a)().platform===A.a.PDDTinyAndorid}var C=function(){var e=v();return Object(m.a)().platform===A.a.PddIOS&&Object(A.c)(e,"5.80.0")>=0},b=function(){return R("4.74.0","4.74.0","4.80.0")},N=function(){return R("4.85.0","4.85.0")},L=function(){return Object(m.a)().platform!==A.a.PDDTinyAndorid&&R("4.88.0","4.88.0")},D=function(){return R("5.41.0","5.41.0")},P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAM1BMVEUAAABmZmZmZmZlZWVmZmZmZmZlZWVlZWVoaGhlZWVkZGRmZmZlZWVlZWVlZWVmZmZmZmauFdI/AAAAEHRSTlMAhnjzbtHHEBrfJrGXRzZXUNTSwgAAAPRJREFUWMPt1+sKgzAMBWC71NbLLuf9n3a6sxFYN2vq/gxyEBSFz9pGaLpdOYucuyPJCUtSbheGHo/0Q6swjXhmnNqEqwCYHwfk2iJcFkEuJyDwyi7c+O6V4HhuViFyBkhwVqJNCFwHEq+1CTaB1UCCFWI0BJiXkxJLZkAso2BVK8FaD509SjB/QcQkWBO2iYA1kuLHn5KRbQKvFL8vhT2jUKOs55j3z0WORcUnvVEj9EF6/8JsIzKAd8K6qE444cTviNNBYhrHqZnQOOGEE0444USdyDYhA1Lsfs1dRqrtwTXVPTjTw5y+6EfMwvCtK6pHu6I7B+8m1re+k3UAAAAASUVORK5CYII=",H=r("/bZk"),M=r("chhR"),k=r("EECB"),j=r("o0o1"),U=r.n(j),w=r("cDf5"),W=r.n(w),x=r("yXPU"),G=r.n(x),B=r("YSLc"),Y=r("W9H9"),K=r("gfNA"),V=r("Ne86"),F=r("7sJ8"),Z=r("8l/m"),Q=r("rIj9"),q="api/flow/audience/share/types",z=r("v1av"),J=r("z4CT"),X=r("dp2P"),$=H.b.ShareErrorCode,ee=function(){function e(){h()(this,e),this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}return _()(e,[{key:"build",value:function(){var e=this;return this._inited?Promise.resolve():(this._queryShareTypePromise||(this._queryShareTypePromise=this.loadRules(),this._queryShareTypePromise.then((function(t){return e._inited=!0,e._processRules(t),z.a.getInstance().build({magicTrace:t.magic_trace})})).catch((function(t){Object(J.a)({errorCode:0,message:"分享规则初始化失败",options:{message:t&&t.message,errorCode:t&&t.errorCode}}),e._inited=!0}))),this._queryShareTypePromise)}},{key:"reset",value:function(){this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}},{key:"getAppOptional",value:function(){return this.appOptional}},{key:"getRules",value:function(){var e=this;return this.build().then((function(){return e._rules}),(function(){return Promise.resolve(e._rules)}))}},{key:"loadRules",value:function(){return Object(m.a)().isNativePlatform?Object(O.e)("JSShare","queryShareTypes",{page_sn:Object(Z.c)()+"",page_info:{page_name:Object(Z.b)(),page_url:location&&location.href}}):function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object(Q.a)({pageInfo:{pageId:Object(Z.a)()}},{defaultErrorHandler:function(e){}}),a={};return a.page_sn=t.pageSn||"",a.page_info=t.pageInfo||{},a.platform="h5","post"===e.toLowerCase()?r.post(q,a):r.get(q,{params:a})}("post",{pageSn:Object(Z.c)()+"",pageInfo:{page_name:Object(Z.b)(),page_url:location&&location.href}})}},{key:"_processRules",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.share_types||[];this.appOptional=e.app_optional,this._rom=e.rom,this._matchedPkgId=e.matched_pkg_id,this._enableSilentMode=e.is_weird,e.degrade&&this.setCipherDowngrade(!0);var r=[];return this._rules=t.reduce((function(e,t){var a=t.share_type;return a&&(e[a]=t,r.push(parseInt(a,10))),e}),{}),this._innerShareTypes=e.inner_share_types||[],this._innerShareTypes.forEach((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.push(parseInt(e.share_type,10))})),this._enableShareTypes=r,this._rules}},{key:"getRuleByType",value:function(e){return(this._rules||{})[e]}},{key:"checkSync",value:function(e,t){if(!this._rules)return $.SHARE_LIMITER_NOT_INIT;if(this._enableShareTypes.indexOf(e)<0)return $.SHARE_TYPE_DISABLED;var r=t.getShareForm(e),a=(this.getRuleByType(e)||{}).share_methods||[];return[Y.a.COMMAND,Y.a.TEXT].indexOf(r)>=0?Object(X.c)(t.urlWrapType)&&t.marketActivityID&&(t.shortURLApi&&a.indexOf(F.a.LINK)>=0||t.shortCommandApi&&a.indexOf(F.a.CIPHER)>=0||t.urlWrapType===X.a.CATEGORY_PROCEDURE||t.urlWrapType===X.a.CATEGORY_PROCEDURE_CUSTOM)||a.indexOf(F.a.NORMAL)>=0?0:$.SHARE_TYPE_DISABLED:[y.a.WECHAT_SESSION,y.a.WECHAT_TIMELINE].indexOf(e)>=0?Object(X.d)(t.urlWrapType)&&t.marketActivityID&&a.indexOf(F.a.DOMAIN)<0?$.SHARE_TYPE_DISABLED:a.indexOf(F.a.NORMAL)>=0?0:$.SHARE_TYPE_DISABLED:0}},{key:"setCipherDowngrade",value:function(e){this._isCipherDowngrade=e}},{key:"isCipherDowngrade",get:function(){return this._isCipherDowngrade}},{key:"rom",get:function(){return this._rom}},{key:"matchedPkgId",get:function(){return this._matchedPkgId}},{key:"isSilentMode",get:function(){return this._enableSilentMode}}]),e}(),te=null;function re(){return te||(te=new ee),te}var ae=r("bbLm"),ne=r("rUjM"),ie=0,se=1,oe=2;function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(arguments.length>1&&void 0!==arguments[1]||ne.a.TP_FIRST,[]),r=[],a=[],n=[];return e.forEach((function(e){if(e)switch(e.dev_type){case se:t.push(e);break;case oe:r.push(e);break;case ie:a.push(e);break;default:n.push(e)}})),N()||(t=r=[]),r[0]||t[0]||a[0]}function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object(Q.a)({pageInfo:{pageId:Object(Z.a)()}},{defaultErrorHandler:function(e){}}),a=n()({scene_id:e.activitySceneSn,long_url:e.shareURL||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,param:{},page_sn:Object(Z.c)()},Object(ae.b)(e));e.payloadMixin&&"object"===W()(e.payloadMixin)&&(a=Object.assign({},e.payloadMixin.param_map,a)),"string"!=typeof a.param&&(a.param=JSON.stringify(a.param));var i=r.post("api/flow/chron/share/card",{param_map:a});return i.then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(e.infos||[]).filter((function(e){return Object.keys(e).length>0})),a=he(r,t);return{raw:e,info:a,tpInfos:r,tpDowngrade:r.length<=0}}))}function _e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object(Q.a)({pageInfo:{pageId:Object(Z.a)()}},{defaultErrorHandler:function(e){}}),a={long_url:e.shareURL||"",activity_code:(e.marketActivityID||0)+"",scene_sn:e.activitySceneSn||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,params:{}};e.payloadMixin&&"object"===W()(e.payloadMixin)&&(a=Object.assign(a,e.payloadMixin)),"string"!=typeof a.params&&(a.params=JSON.stringify(a.params));var n=r.post("api/flow/walrus/inquire/confusion/info",a);return n.then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(e.infos||[]).filter((function(e){return Object.keys(e).length>0})),a=he(r,t);return{raw:e,info:a,tpInfos:r,tpDowngrade:r.length<=0}}))}var ue=r("Qm63"),pe=r("2Goq"),Se=r("T8QY"),le=r("J4zp"),Ee=r.n(le),de=r("6wpZ"),fe=0,Ie=1,me=2;function Ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.replace(/%s/g,t)}var Oe={};function Te(e){var t=e.consumeMode,r=e.scene;if("number"!=typeof t||[de.a.CONSUME_RAW,de.a.RECYCLE_RAW].indexOf(t)>=0)return Promise.resolve();var a=function(e){if(e&&!(e.length<=0)){if([de.a.CONSUME_TIME_DIVIDE,de.a.RECYCLE_TIME_DIVIDE].indexOf(t)>=0){var r=new Date,a=r.getMinutes(),n=r.getSeconds();return e[Math.floor(e.length*(60*a+n)/3600)]}if(de.a.RECYCLE_TIME_DIVIDE_MULTI===t){var i=e.length,s=Math.min(Math.max(parseInt(window.__SHARE_CIPHER_PARALLEL_SIZE__,10)||0,2),i),o=Math.max(Math.floor(i/s),1),h=Math.floor(Math.random()*s),c=new Date,_=c.getMinutes(),u=c.getSeconds(),p=Math.floor(o*(60*_+u)/3600);return e[Math.max(h*o+p,i-1)]}return e[0]}},n=(Oe[r]||{}).texts;return n?Promise.resolve(a(n)):function(e){return Object(O.e)("JSShare","getLocalCipherInfo",{action:Ie,page_sn:Object(Z.c)()+"",scene:e}).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(t.texts||[]).map((function(e){if(e)return e.version&&Object(A.c)(e.version,window.__SHARE_CIPHER_VER__||"0.0.1")>=0?e.text:e.version?void 0:e.text})).filter((function(e){return!!e}));return Oe[e]=Oe[e]||{},Oe[e].texts=r,r}),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(J.a)({errorCode:e.errorCode,message:"本地获取口令文本失败",options:e.data}),null}))}(r).then(a)}function ye(e){var t=e.consumeMode,r=e.scene;return"number"!=typeof t?Promise.resolve():[de.a.CONSUME,de.a.CONSUME_TIME_DIVIDE,de.a.CONSUME_RAW].indexOf(t)>=0?function(e){return Object(O.e)("JSShare","getLocalCipherInfo",{action:me,page_sn:Object(Z.c)()+"",scene:e}).then((function(e){return e.cipher}),(function(e){return Object(J.a)({errorCode:e.errorCode,message:"本地消费口令码失败",options:e.data}),null}))}(r):function(e){return Object(O.e)("JSShare","getLocalCipherInfo",{action:fe,page_sn:Object(Z.c)()+"",scene:e}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.ciphers||[]}),(function(e){return Object(J.a)({errorCode:e.errorCode,message:"本地获取口令码失败",options:e.data}),null}))}(r).then((function(e){if(e&&!(e.length<=0))return e[0]}))}function ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.scene,r=e.consumeMode;return Object(m.a)().isNativePlatform&&D()&&t&&"number"==typeof r?Promise.all([ye(e),Te(e)]).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Ee()(e,2),a=t[0],n=t[1];return a&&[de.a.CONSUME_RAW,de.a.RECYCLE_RAW].indexOf(r)>=0?a:a&&n?Object.assign({text:Ae(n,a.cipher)},a):void 0})):Promise.resolve()}var ge=r("q8Ib");function Re(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object(m.a)().isNativePlatform?Ce.apply(void 0,t).then((function(e){return e.missed?V.d.apply(void 0,t):e})):V.d.apply(void 0,t)}var Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shareURL||"",r=e.urlWrapType;if(e.marketActivityID&&e.activitySceneSn&&r===X.a.CATEGORY_PROCEDURE){var a=re().matchedPkgId;return ce(Object.assign({rom:re().rom,matchedPkgId:a},e),e.tpSelectCategory).then((function(e){var r=e.info,a=e.tpInfos,n=e.tpDowngrade,i={raw:e.raw,tpDowngrade:n,tpInfo:r,tpInfos:a,realShareURL:(r||a[0]||{}).link_url||t,targetShareURL:t},s=new Error("category procedure");return s.data=i,Promise.reject(s)}))}if(e.marketActivityID&&r===X.a.CATEGORY_PROCEDURE_CUSTOM){var n=Object(X.d)(r)?ge.b.WEIXIN_TINY_DOMAIN:ge.b.SHORT_LINK,i=t.replace(/^(\w+:)?\/\//,""),s=Object(ge.c)(e.requestUsePost?"post":"get",{shareURL:i,marketActivityID:e.marketActivityID,platform:Object(V.c)(),shareDomainType:n,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin});return s.then((function(e){var t=new Error("category procedure custom");return t.data=e,Promise.reject(t)}))}if(e.marketActivityID&&e.activitySceneSn&&r===X.a.SERVER_TP_APP){var o=re().matchedPkgId;return _e(Object.assign({rom:re().rom,matchedPkgId:o},e),e.tpSelectCategory).then((function(e){var r=e.info,a=e.tpInfos;return{tpInfo:r,tpDowngrade:e.tpDowngrade,tpInfos:a,realShareURL:(r||a[0]||{}).link_url||t,targetShareURL:t}}),(function(e){return Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})}))}if(e.marketActivityID&&Object(X.b)(r)){var h=Object(X.d)(r)?ge.b.WEIXIN_TINY_DOMAIN:ge.b.SHORT_LINK,c=t.replace(/^(\w+:)?\/\//,""),_=Object(ue.a)(e),u=e.cipherScene,p=e.consumeMode,S=Object(pe.a)(),l=function(){var a=new Promise((function(a,n){Object(ge.c)(e.requestUsePost?"post":"get",{shareURL:c,marketActivityID:e.marketActivityID,platform:Object(V.c)(),shareDomainType:h,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin}).then((function(e){if(e){var i=e.domain,s=void 0===i?"":i,o=e.shortURL,c=e.shareText,_=e.raw;if(h===ge.b.WEIXIN_TINY_DOMAIN)r===X.a.DOMAIN_REPLACE&&a(Object(V.a)(t,s));else if(h===ge.b.SHORT_LINK){if(!o&&!c){var u=new Error("empty short_url with empty share_text");return u.data=_,u.extraInfo=_,void n(u)}return void a({useShortURL:!0,realShareURL:o||t,targetShareURL:t,shareText:c,rawResponse:_})}}a({realShareURL:t,targetShareURL:t})})).catch((function(e){n(e)}))}));return h===ge.b.SHORT_LINK&&a.then((function(e){e&&e.useShortURL&&(S.cacheResponseByHash(_,e),S.setShareID(_,(new Se.a(t).query||{}).refer_share_id))})),a};if(r===X.a.SERVER_SHORT_URL_WITH_CACHE){var E=S.getResponseByHash(u);return E?(S.increaseCount(u),Promise.resolve(E)):(E=S.getResponseByHash(_))?(S.increaseCount(_),Promise.resolve(E)):u&&re().isCipherDowngrade?ve({scene:u,consumeMode:p}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&e.share_id){var t={cipher:e.cipher,shareText:e.text,shareID:e.share_id};return S.cacheResponseByHash(u,t),S.setShareID(u,e.shareID),t}return l()}),(function(e){return l()})):l()}return l()}if(e.activitySceneSn&&r===X.a.SERVER_TP_APP_CARD){var d=re().matchedPkgId;return ce(Object.assign({rom:re().rom,matchedPkgId:d},e),e.tpSelectCategory).then((function(e){var r=e.info,a=e.tpInfos,n=e.tpDowngrade,i=e.raw;return{tpInfo:r,tpDowngrade:n,tpInfos:a,realShareURL:(r||a[0]||{}).link_url||t,categoryShareInfo:{thumbnailURL:(r||a[0]||{}).thumb_img_url},targetShareURL:t,rawResponse:i}}),(function(e){return Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})}))}return Promise.resolve({missed:!0,realShareURL:t,targetShareURL:t})},be=r("XfDS"),Ne=r("Upw4");function Le(){return De.apply(this,arguments)}function De(){return(De=G()(U.a.mark((function e(){var t,r,a,n=arguments;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},"function"==typeof(r=n.length>1?n[1]:void 0).cipherProcessor){e.next=4;break}return e.abrupt("return",t);case 4:return e.prev=4,e.next=7,r.cipherProcessor({cipherText:t.title,cipherCode:t.cipher,shareEntity:r});case 7:"string"==typeof(a=e.sent)&&(t.title=t.desc=a),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}var Pe="static",He="dynamic",Me=function(e){return e?Array.isArray(e)&&e.length>0?e[0]:"object"===W()(e)?e:null:null},ke=function(e){return e?Array.isArray(e)&&e.length>0?e.map((function(e,t){return e?"string"==typeof e?{type:Pe,data:e}:"object"===W()(e)?e.type?e:{type:He,options:e}:void 0:null})).filter((function(e){return!!e})):"object"===W()(e)?[{type:He,options:e}]:[]:[]};function je(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.drawImageOptions;return"function"==typeof a?a(r=n()({shareRefer:Object(ae.b)(e)},r||{})):"object"===W()(a)?t?Promise.resolve(ke(a)):Promise.resolve(Me(a)):Promise.resolve({})}var Ue=r("1dcj");var we=function(e){l()(a,e);var t,r=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var r,a=I()(e);if(t()){var n=I()(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return d()(this,r)}}(a);function a(e){var t;return h()(this,a),(t=r.call(this,e)).drawImageOptions=e.drawImageOptions,t.redirectURI=e.redirectURI||"",t.miniObjectPath=e.miniObjectPath||"",t.miniObjectID=e.miniObjectID,t.useWxAppShare=e.useWxAppShare||!1,t.forceDowngrade=e.forceDowngrade||!1,t.excludeShareChoices=e.excludeShareChoices||[],t.thirdPartyOpenType=e.thirdPartyOpenType,t.drawImageClass=e.drawImageClass,t.needSharedAmount=e.needSharedAmount||!1,t.cipherScene=e.cipherScene,t.consumeMode=e.consumeMode,t.activitySceneSn=e.activitySceneSn,t.tpSelectCategory=e.tpSelectCategory,t.pinTimelineParams=e.pinTimelineParams,t.withShareTicket=e.withShareTicket,t.systemShareMode=e.systemShareMode||Ue.a.DEFAULT,t.wechatMaskConfig=e.wechatMaskConfig,t}return _()(a,[{key:"normalize",value:(t=G()(U.a.mark((function e(t){var r,a,i,o,h,c,_,u,p,S,l,E,d=this;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==y.a.COPY_CIPHER){e.next=2;break}return e.abrupt("return",this.processCipher());case 2:if(r=Object.assign({},this),t!==y.a.PIN_TIMELINE){e.next=5;break}return e.abrupt("return",r.pinTimelineParams);case 5:a={title:r.title,desc:r.message,thumbnail:r.thumbnailURL,share_url:r.shareURL,share_id:r.shareID,with_share_ticket:!!r.withShareTicket,system_share_mode:r.systemShareMode},(i=r.wechatMaskConfig)&&"object"===W()(i)&&(o=i.share_rec_mask,h=s()(i,["share_rec_mask"]),c=n()({},h),o&&(c.share_rec_mask=n()({share_type:t,activity_code:r.marketActivityID,share_id:r.shareID},o)),a.wechat_mask_config=c),r.payloadMixin&&(_=r.payloadMixin.extra,"object"===W()(_)&&void 0!==_.share_prefer&&(a.share_prefer=_.share_prefer)),u=!1,e.t0=t,e.next=e.t0===y.a.WECHAT_SESSION?13:e.t0===y.a.WECHAT_TIMELINE_IMAGE||e.t0===y.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK||e.t0===y.a.WECHAT_SESSION_IMAGE||e.t0===y.a.QQ_CHAT_SESSION_IMAGE||e.t0===y.a.QQ_ZONE_IMAGE||e.t0===y.a.WEIBO_IMAGE||e.t0===y.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK?16:e.t0===y.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK?21:e.t0===y.a.SHARE_IMAGE_PASSIVELY?26:e.t0===y.a.IOS_SYSTEM_SHARE_CARD||e.t0===y.a.WECHAT_SESSION_CARD_WITH_NO_SDK||e.t0===y.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK?32:34;break;case 13:if(r.miniObjectPath&&"string"==typeof r.miniObjectPath)a.mini_object_path=Object(ae.a)(r);else if("function"==typeof r.miniObjectPath)try{a.mini_object_path=r.miniObjectPath(r.shareURL)}catch(e){}return r.miniObjectID&&(a.mini_object_id=r.miniObjectID),e.abrupt("break",35);case 16:return u=!0,e.next=19,je(r);case 19:return a.options=e.sent,e.abrupt("break",35);case 21:return u=!0,e.next=24,je(r,!0);case 24:return a.multi_image_options=e.sent,e.abrupt("break",35);case 26:return u=!0,e.next=29,je(r);case 29:return a.options=e.sent,r.thirdPartyOpenType&&(a.open_type=r.thirdPartyOpenType),e.abrupt("break",35);case 32:return a.excluded_types=r.excludeShareChoices,e.abrupt("break",35);case 34:return e.abrupt("break",35);case 35:if(p=this.getShareForm.call(r,t),S=[Y.a.COMMAND,Y.a.TEXT].indexOf(p)>=0,this.targetShareURL=r.shareURL,this.realShareURL=r.shareURL,this.useShortURL=!1,t===y.a.WECHAT_SESSION&&a.mini_object_path&&(this.realShareURL=a.mini_object_path),Object(Ne.a)(t)&&(l=Object(V.b)(t,r.shareURL),a.share_url=l,this.shareURL=l,this.realShareURL=l,this.targetShareURL=l),t===y.a.WECHAT_SESSION&&a.mini_object_path&&(this.realShareURL=this.targetShareURL=a.mini_object_path),p!==Y.a.CARD&&p!==Y.a.WXAPP_CARD||!r.urlWrapType){e.next=47;break}return e.abrupt("return",Re(r).then((function(e){var t=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,s=e.tpDowngrade,o=e.tpInfo,h=e.tpInfos,c=e.appendQuery,_=e.categoryShareInfo,u=e.useCipher,p=e.missed,S=e.rawResponse,l=void 0===S?{}:S;return u?Promise.reject(new Error("operation refused")):(p||(d.useShortURL=i,d.realShareURL=t,d.targetShareURL=n),a.share_url=t,o&&(a.title=o.title||a.title,a.desc=o.message||a.desc),_&&(a.title=_.title||a.title,a.thumbnail=_.thumbnailURL||a.thumbnail),a.tpInfo=o,a.tpInfos=h,a.tpDowngrade=s,a.rawResponse=l,r.urlWrapType===X.a.SERVER_QUERY_APPEND&&"string"==typeof a.mini_object_path&&a.mini_object_path&&(a.mini_object_path=Object(ae.a)({miniObjectPath:a.mini_object_path,shareURL:t},{appendQuery:c}),d.realShareURL=a.mini_object_path),a)})));case 47:if(!u||!Object(X.c)(r.urlWrapType)&&r.urlWrapType!==X.a.MAGIC_TRACE&&r.urlWrapType!==X.a.MAGIC_TRACE_DYNAMIC){e.next=51;break}return e.abrupt("return",Re(r).then(G()(U.a.mark((function e(){var t,n,i,s,o,h=arguments;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},n=t.realShareURL,i=t.targetShareURL,s=t.useShortURL,o=t.shareText,d.targetShareURL=i,r.shortCommandApi?(d.pcode=o,a.share_url=o):(d.useShortURL=s,d.realShareURL=n,a.share_url=s?Object(be.a)(n):n),!s){e.next=16;break}if(!a.multi_image_options){e.next=11;break}return e.next=8,je(r,!0,t);case 8:a.multi_image_options=e.sent,e.next=16;break;case 11:if(!a.options){e.next=16;break}return e.next=14,je(r,!1,t);case 14:a.options=e.sent,a.options&&"object"===W()(a.options)&&a.options.$params&&(Object.assign(a,a.options.$params),delete a.options.$params);case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e)})))));case 51:if(!S){e.next=62;break}if(E=a.title||"",!Object(X.c)(r.urlWrapType)){e.next=57;break}return e.abrupt("return",Re(r).then((function(e){var t=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,s=e.shareText,o=e.shareID,h=e.cipher,c=e.tpInfo,_=e.tpInfos,u=e.tpDowngrade,p=e.rawResponse,S=void 0===p?{}:p;if(o&&(a.shareID=o),h&&(a.cipher=h),c&&(a.title=c.link_url||a.title,a.desc=c.link_url||a.desc,E=a.title),a.tpInfo=c,a.tpInfos=_,a.tpDowngrade=u,a.rawResponse=S,d.targetShareURL=n,r.shortCommandApi){var l=i||h?s:"",f=l||n;E=Object(K.b)(E,f,n,l),a.title=a.desc=E,d.pcode=E}else{var I=i?t:"",m=I||n;E=Object(K.b)(E,m,n,I),a.title=a.desc=E,d.useShortURL=i,d.realShareURL=m}return Le(a,r)})));case 57:return E=Object(K.b)(E,r.shareURL),a.title=a.desc=E,e.abrupt("return",Le(a,r));case 60:e.next=63;break;case 62:return e.abrupt("return",Promise.resolve(a));case 63:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getShareForm",value:function(e){return e===y.a.WECHAT_SESSION?this.miniObjectPath||this.useWxAppShare?Y.a.WXAPP_CARD:Y.a.CARD:[4,2,5,6,24,25,18,9996,9997].includes(e)?Y.a.CARD:[8,9,10,11,12,13,15,19,20,22].includes(e)?Y.a.IMAGE:[3,16,17,21,y.a.COPY_CIPHER].includes(e)?this.shortCommandApi?Y.a.COMMAND:Y.a.TEXT:e===y.a.COPY_LINK?Y.a.COPY_LINK:Y.a.DEFAULT}},{key:"getShareMethod",value:function(e){return[9,16,19,20,18,9996,9997].includes(e)?B.a.SYSTEM:[1,2,3,4,5,8,10,11,12,13,15,17,21,24,25].includes(e)?B.a.SDK:e===y.a.SHARE_IMAGE_PASSIVELY?this.thirdPartyOpenType?B.a.MANUAL:B.a.DEFAULT:e===y.a.COPY_CIPHER?B.a.MANUAL:B.a.DEFAULT}}]),a}(K.a),We=r("A4fa"),xe=r("WiBJ");function Ge(e){return"string"!=typeof e?Promise.reject():Object(m.a)().isNativePlatform?Object(O.e)("AMStorage","setPasteboard",{text:e}):Promise.reject()}var Be=r("KxTr");var Ye=Object.keys(y.a).map((function(e){return y.a[e]})).filter((function(e){return[y.a.WECHAT_BIG_IMAGE].indexOf(e)<=0})),Ke=function(e){l()(r,e);var t=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var r,a=I()(e);if(t()){var n=I()(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return d()(this,r)}}(r);function r(e){var a;return h()(this,r),(a=t.call(this,e)).ShareEntityClass=we,a._enableShareTypes=Ye.concat(),a.shareLimiter=re(),a._isEnableShareCheck=!1,a.setShareCheck(!0),a}return _()(r,[{key:"setShareCheck",value:function(e){Object(m.a)().isTinyNativePlatform?this._isEnableShareCheck=!0:this._isEnableShareCheck=!!e&&R("4.51.0","4.51.0")}},{key:"checkShareTypeEnable",value:function(e){var t=this.getShareEntityByShareType(e);if(!this.validateShareParams(e,t))return H.a.SHARE_PARAMS_NOT_VALID;if(!function(e){var t=!1;if("number"!=typeof e)return!1;switch(e){case y.a.WECHAT_SESSION:case y.a.WECHAT_TIMELINE:case y.a.WECHAT_SESSION_APP:case y.a.QQ_CHAT_SESSION:case y.a.QQ_ZONE:case y.a.WECHAT_TIMELINE_IMAGE:case y.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK:case y.a.WECHAT_SESSION_IMAGE:case y.a.QQ_CHAT_SESSION_IMAGE:case y.a.QQ_ZONE_IMAGE:case y.a.WECHAT_SESSION_TEXT_WITH_NO_SDK:case y.a.WECHAT_SESSION_TEXT:t=!0;break;case y.a.WEIBO:case y.a.WEIBO_IMAGE:t=R("4.81.0","4.81.0");break;case y.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK:case y.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK:t=R("4.37.0","4.36.0");break;case y.a.WECHAT_TIMELINE_TEXT:t=R("4.39.0","4.39.0");break;case y.a.IOS_SYSTEM_SHARE_CARD:case y.a.WECHAT_SESSION_CARD_WITH_NO_SDK:case y.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK:t=C();break;case y.a.SHARE_IMAGE_PASSIVELY:t=R("4.49.0","4.49.0");break;case y.a.COPY_LINK:case y.a.COPY_CIPHER:t=!0;break;case y.a.WECHAT_SESSION_MUSIC:case y.a.WECHAT_SESSION_VIDEO:t=R("4.86.0","4.86.0");break;case y.a.FRIENDS:case y.a.WECHAT_BIG_IMAGE:t=!0;break;case y.a.PIN_TIMELINE:t=R("5.6.0","5.6.0")}return t}(e)||this._enableShareTypes.indexOf(e)<0)return H.a.SHARE_TYPE_DISABLED;if(this._isEnableShareCheck&&[y.a.COPY_LINK,y.a.COPY_CIPHER].indexOf(e)<0){var r=this.shareLimiter.checkSync(e,t);if(r)return r}return 0}},{key:"share",value:function(e){var t=this.checkShareTypeEnable(e);return t||(e===y.a.PIN_TIMELINE?this._sharePinTimeline(e):e===y.a.WECHAT_BIG_IMAGE?this._nativeShareBigImage(e):[y.a.WECHAT_SESSION,y.a.WECHAT_TIMELINE,y.a.WEIBO,y.a.QQ_CHAT_SESSION,y.a.QQ_ZONE,y.a.TENCENT_WEIBO,y.a.WECHAT_SESSION_APP,y.a.FRIENDS,y.a.WECHAT_SESSION_MUSIC,y.a.WECHAT_SESSION_VIDEO].indexOf(e)>=0?this._nativeShareCard(e):[y.a.IOS_SYSTEM_SHARE_CARD,y.a.WECHAT_SESSION_CARD_WITH_NO_SDK,y.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK].indexOf(e)>=0?this._nativeShareCardSpecial(e):[y.a.WECHAT_TIMELINE_IMAGE,y.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK,y.a.WECHAT_SESSION_IMAGE,y.a.QQ_CHAT_SESSION_IMAGE,y.a.QQ_ZONE_IMAGE,y.a.WEIBO_IMAGE,y.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK,y.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK,y.a.SHARE_IMAGE_PASSIVELY].indexOf(e)>=0?this._nativeShareImage(e):[y.a.WECHAT_SESSION_TEXT_WITH_NO_SDK,y.a.WECHAT_SESSION_TEXT,y.a.WECHAT_TIMELINE_TEXT].indexOf(e)>=0?this._nativeShareText(e):y.a.COPY_LINK===e?this._nativeShareClipboard(e):y.a.COPY_CIPHER===e?this.copyCipher():H.a.SHARE_TYPE_NOT_FOUND)}},{key:"validateShareParams",value:function(e){return!0}},{key:"_setupShareTypes",value:function(){}},{key:"resetLimiter",value:function(){return this.shareLimiter.reset(),this._queryShareTypePromise=null,this.waitShareLimiter()}},{key:"refreshShare",value:function(e,t){var a=p()(I()(r.prototype),"refreshShare",this).call(this,e,t);return this.emit(M.a.ON_SHARE_PREPARE,{shareType:t}),a}},{key:"_setupPlatformShareSDK",value:function(){return this.waitShareLimiter()}},{key:"waitShareLimiter",value:function(){var e=this;return this._isEnableShareCheck?(this._queryShareTypePromise||(this._queryShareTypePromise=this.shareLimiter.build().catch((function(t){return e.emit(M.a.SHARE_LIMIT_LOAD_FAIL),Promise.resolve()}))),this._queryShareTypePromise):Promise.resolve()}},{key:"_nativeShareCard",value:function(e){var t=this;this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e});var r=this.getShareEntityByShareType(e);return r.normalize(e).then((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.tpInfo,i=a.tpInfos,o=a.tpDowngrade,h=a.wechat_mask_config,c=a.rawResponse,_=void 0===c?{}:c,u=s()(a,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config","rawResponse"]);if(o)t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.FAIL,tpDowngrade:!0,tpInfo:n});else{var p=_.sdk_type,S=Object.assign({type:e,redirect_uri:r.redirectURI||"",share_params:u,share_method:Object(xe.a)(r,e),sdk_type:p});r.needSharedAmount&&(S.show_check_detail=1),h&&(S.wechat_mask_config=h),n&&n.dev_type&&(S.dev_app=n.dev_app,S.dev_type=n.dev_type),i&&(S.dev_infos=i),t._invokeNativeShare(S,(function(r){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,responseData:r,tpInfo:n})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0,i=a===g?k.a.CANCEL:k.a.FAIL;t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:i,nativeShareErrorCode:a,responseData:r.data,tpInfo:n})}))}}),this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareCardSpecial",value:function(e){var t=this;this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e});var r=this.getShareEntityByShareType(e);return r.normalize(e).then((function(a){var n=Object.assign({type:y.a.IOS_SYSTEM_SHARE_CARD,share_params:a,share_method:Object(xe.a)(r,e)});t._invokeNativeShare(n,(function(r){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,responseData:r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0,n=a===g?k.a.CANCEL:k.a.FAIL;t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:a,responseData:r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareImage",value:function(e){var t=this;this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e});var r=this.getShareEntityByShareType(e),a=e;return r.normalize(e).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.share_code,o=n.system_share_mode,h=n.wechat_mask_config,c=s()(n,["share_code","system_share_mode","wechat_mask_config"]),_={type:a,share_params:c,share_method:Object(xe.a)(r,e),share_code:i,system_share_mode:o};h&&(_.wechat_mask_config=h);var u=!1;t._invokeNativeShare(_,(function(r){!u&&t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,responseData:r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10),n=a===g?k.a.CANCEL:k.a.FAIL;!u&&t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:a,responseData:r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareText",value:function(e){var t=this,r=this.getShareEntityByShareType(e),a=r.cipherScene&&"string"==typeof r.cipher;!a&&this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e});var n=e;return r.normalize(e).then((function(i){var o=i.tpInfo,h=i.tpInfos,c=i.tpDowngrade,_=i.wechat_mask_config,u=s()(i,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config"]);if(a&&(t.emit(M.a.ON_SHARE_TRIGGER,{shareType:e,shareID:u.shareID}),delete u.shareID),c)t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.FAIL,tpDowngrade:!0,tpInfo:o});else{var p=Object.assign({type:n,share_params:u,share_method:Object(xe.a)(r,e)});o&&o.dev_type&&(p.dev_app=o.dev_app,p.dev_type=o.dev_type),h&&(p.dev_infos=h),_&&(p.wechat_mask_config=_);if(r.forceDowngrade||Object(m.a)().system===A.b.IOS&&n===y.a.WECHAT_SESSION_TEXT_WITH_NO_SDK)return t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.FAIL,shareParams:i}),0;t._invokeNativeShare(p,(function(r){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,responseData:r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0,n=a===g?k.a.CANCEL:k.a.FAIL;t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:n,nativeShareErrorCode:a,responseData:r.data})}))}}),this.getNormalizeErrorHandler(e)),0}},{key:"_nativeShareBigImage",value:function(e){return H.a.SHARE_TYPE_DISABLED}},{key:"_nativeShareClipboard",value:function(e){var t=this;this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e});var r=this.getShareEntityByShareType(e);return r.normalize(e).then((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.share_url||r.shareURL;Ge(n).then((function(){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,content:n,originContent:""})}),(function(){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.FAIL,content:n,originContent:""})}))}),this.getNormalizeErrorHandler(e)),0}},{key:"_sharePinTimeline",value:function(e){var t=this;return this.emit(M.a.ON_SHARE_TRIGGER,{shareType:e}),this.getShareEntityByShareType(e).normalize(e).then((function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({type:e,share_params:r});t._invokeNativeShare(a,(function(r){t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.SUCCESS,responseData:r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0;t.emit(M.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:k.a.FAIL,nativeShareErrorCode:a,responseData:r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{key:"setupNativeShareButton",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.shareIcon,a=void 0===r?P:r,n=t.shareIconSize,i=void 0===n?22:n;return"string"!=typeof a||"number"!=typeof i?H.a.SHARE_PARAMS_NOT_VALID:(Object(O.e)("JSUIControl","setRightBarButtons",{buttons:[{icons:{normal:a},callback:function(){e.emit(M.a.ON_SHARE_BUTTON_CLICKED)},size:i}]}).catch((function(e){})),0)}},{key:"_invokeNativeShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a="JSShare",n="share",i=Object(Z.c)()+"";this._isEnableShareCheck?(e=Object.assign({origin:"h5",page_sn:i,page_info:{page_name:Object(Z.b)(),page_url:location&&location.href}},e),this.shareLimiter.getAppOptional()&&(e.app_optional=this.shareLimiter.getAppOptional()),n="performShare"):e.page_sn=i,Object(O.e)(a,n,e).then(t,r)}},{key:"shareCipherManually",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:We.a.OPEN_WECHAT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Be.a.DEFAULT,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e&&"string"==typeof e?b()?(t!==We.a.OPEN_WECHAT&&t!==We.a.OPEN_WECHAT_IOS_SILENT&&t!==We.a.OPEN_WECHAT_ANDROID_SILENT||(t=L()&&this.shareLimiter.isSilentMode?Object(m.a)().system===A.b.IOS?We.a.OPEN_WECHAT_IOS_SILENT:We.a.OPEN_WECHAT_ANDROID_SILENT:We.a.OPEN_WECHAT),Object(O.e)("JSShare","shareCipher",n()({cipher:e,open_type:t,paste_type:r,share_code:a},i))):Promise.reject(new Error("not support")):Promise.reject(new Error("invalid cipher"))}}]),r}(T.a);t.default=Ke}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/msf/js/ms_native_c_45197773282c62e284fd.js.map