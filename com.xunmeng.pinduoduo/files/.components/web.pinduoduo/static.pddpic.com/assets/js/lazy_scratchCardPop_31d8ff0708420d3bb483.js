(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{"4XXp":function(t,e,a){},"6EGJ":function(t,e,a){"use strict";a.r(e);var c=a("1OyB"),n=a("vuIU"),r=a("JX7q"),o=a("Ji7U"),i=a("LK+K"),s=a("brQG"),l=a("p5LO"),h=a("rePB"),d=a("q1tI"),u=a.n(d),v=a("TyAF"),f=a("TSYQ"),p=a.n(f),m=a("/7YU"),b=a("PS6B"),E=a("bdvc"),g=(a("pB7B"),function(t){Object(o.default)(ScratchWeapp,t);var e=Object(i.default)(ScratchWeapp);function ScratchWeapp(){var t;Object(c.default)(this,ScratchWeapp);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),Object(h.default)(Object(r.default)(t),"start",void 0),Object(h.default)(Object(r.default)(t),"end",void 0),Object(h.default)(Object(r.default)(t),"state",{"opened":!1}),Object(h.default)(Object(r.default)(t),"touchStart",(function(e){t.start=e.touches[0]})),Object(h.default)(Object(r.default)(t),"touchMove",(function(e){t.end=e.touches[0]})),Object(h.default)(Object(r.default)(t),"touchEnd",(function(){var e=2e3;t.start&&t.end&&(e=Math.pow(t.start.clientX-t.end.clientX,2)+Math.pow(t.start.clientY-t.end.clientY,2)),e>1e3&&(t.setState({"opened":!0}),t.props.onClear&&t.props.onClear())})),t}return Object(n.default)(ScratchWeapp,[{"key":"render","value":function render(){return u.a.createElement(l.a,{"className":Object(E.b)("scratch-card absolute inset-0",{"opened":this.state.opened})},u.a.createElement(l.a,{"className":"scratch-card-overlay h-full fl-xy text-24","onTouchStart":this.touchStart,"onTouchMove":this.touchMove,"onTouchEnd":this.touchEnd},"手指左右滑动刮奖"))}}]),ScratchWeapp}(d.Component)),y=a("U8pU"),C=a("VTBJ");function LuckyCard(t,e){this.cover=null,this.ctx=null,this.scratchDiv=null,this.cardDiv=null,this.cHeight=0,this.cWidth=0,this.supportTouch=!1,this.events=[],this.startEventHandler=null,this.moveEventHandler=null,this.endEventHandler=null,this.opt=Object(C.default)({"coverColor":"#C5C5C5","coverImg":"","ratio":.8,"callback":null,"text":null},t),this.init(t,e)}function _calcArea(t,e,a){var c=t.getImageData(0,0,this.cWidth,this.cHeight),n=[];_forEach(c.data,(function(t,e){var a=c.data[e+3];0===a&&n.push(a)})),n.length/c.data.length>a&&e&&e()}function _forEach(t,e){return Array.prototype.forEach.call(t,(function(t,a){e(t,a)}))}function _isCanvasSupported(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}function _startEventHandler(t){t.preventDefault(),this.moveEventHandler=_moveEventHandler.bind(this),this.cover.addEventListener(this.events[1],this.moveEventHandler,!1),this.endEventHandler=_endEventHandler.bind(this),document.addEventListener(this.events[2],this.endEventHandler,!1)}function _moveEventHandler(t){t.preventDefault();var e=this.supportTouch?t.touches[0]:t,a=this.cover.getBoundingClientRect(),c=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft,r=e.pageX-a.left-n,o=e.pageY-a.top-c;this.ctx.beginPath(),this.ctx.fillStyle="#FFFFFF",this.ctx.globalCompositeOperation="destination-out",this.ctx.arc(r,o,10,0,2*Math.PI),this.ctx.fill()}function _endEventHandler(t){if(t.preventDefault(),this.opt.callback&&"function"==typeof this.opt.callback)try{_calcArea.call(this,this.ctx,this.opt.callback,this.opt.ratio)}catch(t){this.opt.callback()}this.cover.removeEventListener(this.events[1],this.moveEventHandler,!1),document.removeEventListener(this.events[2],this.endEventHandler,!1)}LuckyCard.prototype.createCanvas=function(){if(this.cover=document.createElement("canvas"),this.cover.id="cover",this.cover.height=2*this.cHeight,this.cover.width=2*this.cWidth,this.cover.style.height=this.cHeight+1+"px",this.cover.style.width=this.cWidth+1+"px",this.ctx=this.cover.getContext("2d"),this.ctx.scale(2,2),this.opt.coverImg){var t=this,e=new Image;e.src=this.opt.coverImg,e.onload=function(){t.ctx.drawImage(e,0,0,t.cover.width/2,t.cover.height/2)},e.crossOrigin="anonymous"}else if(this.opt.fillStyle){var a=this.opt.fillStyle(this.ctx,this.cWidth,this.cHeight);this.ctx.fillStyle=a,this.ctx.fillRect(0,0,this.cover.width,this.cover.height)}else{var c=this.ctx.createLinearGradient(0,0,this.cWidth,0);c.addColorStop(0,"#CDCDCD"),c.addColorStop(.5,"#EAEAEA"),c.addColorStop(1,"#BABABA"),this.ctx.fillStyle=c,this.ctx.fillRect(0,0,this.cover.width,this.cover.height)}this.opt.renderText?this.opt.renderText(this.ctx,this.cWidth,this.cHeight):this.opt.text&&(this.ctx.font="12px Georgia",this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.fillStyle="#58595B",this.ctx.fillText(this.opt.text,this.cWidth/2,this.cHeight/2)),this.scratchDiv.appendChild(this.cover),this.cardDiv.style.opacity=1},LuckyCard.prototype.eventDetect=function(){"ontouchstart"in window&&(this.supportTouch=!0),this.events=this.supportTouch?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],this.addEvent()},LuckyCard.prototype.addEvent=function(){this.startEventHandler=_startEventHandler.bind(this),this.cover.addEventListener(this.events[0],this.startEventHandler,!1)},LuckyCard.prototype.clearCover=function(){this.cover.removeEventListener(this.events[0],this.startEventHandler),this.cover.removeEventListener(this.events[1],this.moveEventHandler),this.cover.removeEventListener(this.events[2],this.endEventHandler),document.getElementById("cover")&&this.scratchDiv.removeChild(this.cover)},LuckyCard.prototype.init=function(t,e){var a=this;_isCanvasSupported()&&(_forEach(arguments,(function(t){if("object"===Object(y.default)(t))for(var e in t)"callback"===e&&"function"==typeof t[e]?a.opt.callback=t[e].bind(a):e in a.opt&&(a.opt[e]=t[e]);else"function"==typeof t&&(a.opt.callback=t.bind(a))})),this.scratchDiv=document.getElementById("scratch"),this.cardDiv=document.getElementById("card"),this.scratchDiv&&this.cardDiv&&(this.cHeight=this.cardDiv.clientHeight,this.cWidth=this.cardDiv.clientWidth,this.cardDiv.style.opacity=0,this.createCanvas(),this.eventDetect()))},LuckyCard.case=function(t,e){return new LuckyCard(t,e)};var O,x,j=LuckyCard,S=(a("4XXp"),function(t){Object(o.default)(ScratchH5,t);var e=Object(i.default)(ScratchH5);function ScratchH5(){var t;Object(c.default)(this,ScratchH5);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),Object(h.default)(Object(r.default)(t),"card",void 0),t}return Object(n.default)(ScratchH5,[{"key":"componentDidMount","value":function componentDidMount(){var t=this,e=(this.props.data||{}).coverImg,a=void 0===e?"":e;this.card=j.case({"ratio":.15,"text":"手指左右滑动刮奖","coverImg":a},(function(){t.props.onClear&&t.props.onClear(),t.card.clearCover()}))}},{"key":"componentWillUnmount","value":function componentWillUnmount(){this.card&&this.card.clearCover()}},{"key":"render","value":function render(){return u.a.createElement(l.a,{"className":"scrach-h5 absolute inset-0"},u.a.createElement(l.a,{"className":"scratch","id":"scratch"},u.a.createElement(l.a,{"className":"card","id":"card"})))}}]),ScratchH5}(d.Component)),w=function(t){Object(o.default)(Scratch,t);var e=Object(i.default)(Scratch);function Scratch(){return Object(c.default)(this,Scratch),e.apply(this,arguments)}return Object(n.default)(Scratch,[{"key":"render","value":function render(){return Object(E.q)()?u.a.createElement(S,{"onClear":this.props.onClear,"data":this.props.data}):u.a.createElement(g,{"onClear":this.props.onClear,"data":this.props.data})}}]),Scratch}(d.Component),H=a("hMlE"),N=a("VPsH"),_=a.n(N),D=a("fCYF"),I=a("/1Zt"),k=a("q0O3"),B=a("k/Ow"),L=a("tbnE"),A=a("lzTv"),T=(O={},Object(h.default)(O,B.c.FOOD,Object(b.g)("scratch_food_bg")),Object(h.default)(O,B.c.COUPON,Object(b.g)("scratch_coupon_bg")),O);function CardItem(t){var e=t||{},a=e.info,c=void 0===a?{}:a,n=e.goFeed,r=void 0===n?function(){}:n,o=c.status,i=void 0===o?I.i.LOCKED:o,h=c.needFeedCount,d=void 0===h?0:h,v=c.rewards,f=void 0===v?[]:v,m=!1;if(i===I.i.CAN_DRAW)return u.a.createElement(l.a,{"className":p()(_.a.cardItemBox,"fl-xy")},u.a.createElement(l.a,{"className":p()(_.a.cardItem)},u.a.createElement(D.a,{"className":p()(_.a.scratchPointer,"absolute left-40 top-60"),"bg":Object(b.g)("scratch_pointer")}),u.a.createElement(w,{"onClear":function handleScratchDown(){m||H.b.gainReward(H.a.SCRATCH_CARD).then((function(t){t&&(k.default.updateFoodAmount(t),m=!0)}))},"data":{"coverImg":Object(b.g)("scratch_cover")}})));if(i===I.i.ONGOING)return u.a.createElement(l.a,{"className":p()(_.a.cardItemBox,"fl-xy")},u.a.createElement(l.a,{"className":p()(_.a.cardItem)},u.a.createElement(D.a,{"className":"w-full h-full fl-xy","bg":Object(b.g)("scratch_cover")},u.a.createElement(l.a,{"className":"text-32 ff-s text-d71"},"喂食",d,"次开启"))));if(i===I.i.LOCKED)return u.a.createElement(l.a,{"className":p()(_.a.cardItemBox,"fl-xy")},u.a.createElement(l.a,{"className":p()(_.a.cardItem)},u.a.createElement(D.a,{"className":"w-full h-full fl-xy","bg":Object(b.g)("scratch_cover")},u.a.createElement(l.a,{"className":"text-32 ff-s text-d71"},"即将开启"))));if(i===I.i.HAS_GAIN){var E=f[0]||{},g=E.rewardAmount,y=void 0===g?0:g,C=E.rewardType,O=void 0===C?0:C;return u.a.createElement(l.a,{"className":p()(_.a.cardItemBox,"fl-xy")},u.a.createElement(l.a,{"className":p()(_.a.cardItem)},u.a.createElement(D.a,{"className":"w-full h-full fl-xy flex-col","bg":T[O]},O===B.c.FOOD&&u.a.createElement(u.a.Fragment,null,u.a.createElement(l.a,{"className":"text-8b5 text-36 ff-m mb-18"},y,"g",u.a.createElement(L.a,{"rewardType":O,"size":46})),u.a.createElement(l.a,{"className":p()(_.a.feedBtn,"text-white text-28 ff-m"),"onClick":r},"去喂食")),O===B.c.COUPON&&u.a.createElement(u.a.Fragment,null,u.a.createElement(D.a,{"bg":Object(b.g)("icon_empty_coupon"),"className":p()(_.a.smallCoupon,"relative fl-xy -mt-14")},u.a.createElement(l.a,{"className":"text-28 text-white ff-s"},"¥",u.a.createElement(s.a,{"className":"text-40 ml-4"},Object(A.b)(y,2)))),u.a.createElement(l.a,{"className":p()(_.a.feedBtn,"text-white text-28 ff-m")},"开心收下")))))}return u.a.createElement(l.a,null)}var W=Object(v.observer)(x=function(t){Object(o.default)(ScratchCardPop,t);var e=Object(i.default)(ScratchCardPop);function ScratchCardPop(){var t;Object(c.default)(this,ScratchCardPop);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),Object(h.default)(Object(r.default)(t),"handleClose",(function(){H.b.toggleScratchPop.iconClose()})),Object(h.default)(Object(r.default)(t),"handleFeed",(function(){H.b.toggleScratchPop.close(),k.default.feedStore.feed()})),t}return Object(n.default)(ScratchCardPop,[{"key":"render","value":function render(){var t=this,e=H.b.scratchCardInfo,a=(void 0===e?{}:e).subMsnInfo,c=void 0===a?{}:a;return u.a.createElement(m.a,{"isShow":!0,"bgImg":"scratch_wrapper_v3","close":this.handleClose,"cls":_.a.scratchCardPop},u.a.createElement(D.a,{"bg":Object(b.g)("title_scratch_card_v2"),"className":p()(_.a.scratchTitle,"absolute")}),u.a.createElement(l.a,{"className":p()(_.a.scratchBox,"absolute fl-y justify-evenly flex-wrap")},Object.keys(c).map((function(e,a){return u.a.createElement(CardItem,{"info":c[e],"goFeed":t.handleFeed,"key":a})}))))}}]),ScratchCardPop}(d.Component))||x;e.default=W},"pB7B":function(t,e,a){}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/mobile-ranch/js/lazy_scratchCardPop_31d8ff0708420d3bb483.js.map