(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[8],{"3Wbp":function(e,t,a){"use strict";a.r(t);var r=a("MVZn"),s=a.n(r),i=a("QILm"),n=a.n(i),o=a("KoDT"),h=a("h3qu"),_=a("MpJ2"),c=a("dKgK"),p=a("a/1V");const S=e=>Object(o.a)().version,E=60006;function I(e="",t="",a=""){const r=S();return Object(o.a)().platform===h.a.PddIOS&&Object(h.c)(r,e)>=0||Object(o.a)().platform===h.a.PddAndroid&&Object(h.c)(r,t)>=0||Object(o.a)().platform===h.a.PDDTinyAndorid}const l=()=>{const e=S();return Object(o.a)().platform===h.a.PddIOS&&Object(h.c)(e,"5.80.0")>=0},m=22,d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAM1BMVEUAAABmZmZmZmZlZWVmZmZmZmZlZWVlZWVoaGhlZWVkZGRmZmZlZWVlZWVlZWVmZmZmZmauFdI/AAAAEHRSTlMAhnjzbtHHEBrfJrGXRzZXUNTSwgAAAPRJREFUWMPt1+sKgzAMBWC71NbLLuf9n3a6sxFYN2vq/gxyEBSFz9pGaLpdOYucuyPJCUtSbheGHo/0Q6swjXhmnNqEqwCYHwfk2iJcFkEuJyDwyi7c+O6V4HhuViFyBkhwVqJNCFwHEq+1CTaB1UCCFWI0BJiXkxJLZkAso2BVK8FaD509SjB/QcQkWBO2iYA1kuLHn5KRbQKvFL8vhT2jUKOs55j3z0WORcUnvVEj9EF6/8JsIzKAd8K6qE444cTviNNBYhrHqZnQOOGEE0444USdyDYhA1Lsfs1dRqrtwTXVPTjTw5y+6EfMwvCtK6pHu6I7B+8m1re+k3UAAAAASUVORK5CYII=";var O=a("/bZk"),A=a("chhR"),T=a("EECB"),u=a("YSLc"),C=a("W9H9"),y=a("gfNA"),R=a("Ne86"),g=a("7sJ8"),f=a("8l/m"),b=a("rIj9");const L="api/flow/audience/share/types";var N=a("v1av"),D=a("z4CT"),P=a("dp2P");const{ShareErrorCode:H}=O.b;class M{constructor(){this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}build(){return this._inited?Promise.resolve():(this._queryShareTypePromise||(this._queryShareTypePromise=this.loadRules(),this._queryShareTypePromise.then((e=>(this._inited=!0,this._processRules(e),N.a.getInstance().build({magicTrace:e.magic_trace})))).catch((e=>{Object(D.a)({errorCode:0,message:"分享规则初始化失败",options:{message:e&&e.message,errorCode:e&&e.errorCode}}),this._inited=!0}))),this._queryShareTypePromise)}reset(){this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._matchedPkgId=void 0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}getAppOptional(){return this.appOptional}getRules(){return this.build().then((()=>this._rules),(()=>Promise.resolve(this._rules)))}loadRules(){return Object(o.a)().isNativePlatform?Object(_.g)("JSShare","queryShareTypes",{page_sn:Object(f.c)()+"",page_info:{page_name:Object(f.b)(),page_url:location&&location.href}}):function(e="",t={}){const a=Object(b.a)({pageInfo:{pageId:Object(f.a)()}},{defaultErrorHandler:e=>{}});let r=null;const s={};return s.page_sn=t.pageSn||"",s.page_info=t.pageInfo||{},s.platform="h5",r="post"===e.toLowerCase()?a.post(L,s):a.get(L,{params:s}),r}("post",{pageSn:Object(f.c)()+"",pageInfo:{page_name:Object(f.b)(),page_url:location&&location.href}})}_processRules(e={}){const t=e.share_types||[];this.appOptional=e.app_optional,this._rom=e.rom,this._matchedPkgId=e.matched_pkg_id,this._enableSilentMode=e.is_weird,e.degrade&&this.setCipherDowngrade(!0);const a=[];return this._rules=t.reduce(((e,t)=>{const r=t.share_type;return r&&(e[r]=t,a.push(parseInt(r,10))),e}),{}),this._innerShareTypes=e.inner_share_types||[],this._innerShareTypes.forEach(((e={})=>{a.push(parseInt(e.share_type,10))})),this._enableShareTypes=a,this._rules}getRuleByType(e){return(this._rules||{})[e]}checkSync(e,t){if(!this._rules)return H.SHARE_LIMITER_NOT_INIT;if(this._enableShareTypes.indexOf(e)<0)return H.SHARE_TYPE_DISABLED;const a=t.getShareForm(e),r=(this.getRuleByType(e)||{}).share_methods||[];if([C.a.COMMAND,C.a.TEXT].indexOf(a)>=0){return Object(P.c)(t.urlWrapType)&&t.marketActivityID&&(t.shortURLApi&&r.indexOf(g.a.LINK)>=0||t.shortCommandApi&&r.indexOf(g.a.CIPHER)>=0||t.urlWrapType===P.a.CATEGORY_PROCEDURE||t.urlWrapType===P.a.CATEGORY_PROCEDURE_CUSTOM)||r.indexOf(g.a.NORMAL)>=0?0:H.SHARE_TYPE_DISABLED}if([p.a.WECHAT_SESSION,p.a.WECHAT_TIMELINE].indexOf(e)>=0){return Object(P.d)(t.urlWrapType)&&t.marketActivityID&&r.indexOf(g.a.DOMAIN)<0?H.SHARE_TYPE_DISABLED:r.indexOf(g.a.NORMAL)>=0?0:H.SHARE_TYPE_DISABLED}return 0}get isCipherDowngrade(){return this._isCipherDowngrade}get rom(){return this._rom}get matchedPkgId(){return this._matchedPkgId}get isSilentMode(){return this._enableSilentMode}setCipherDowngrade(e){this._isCipherDowngrade=e}}let j=null;function U(){return j||(j=new M),j}var v=a("bbLm"),W=a("rUjM");const w=0,k=1,x=2;function G(e=[],t=W.a.TP_FIRST){let a=[],r=[],s=[],i=[];return e.forEach((e=>{if(e)switch(e.dev_type){case k:a.push(e);break;case x:r.push(e);break;case w:s.push(e);break;default:i.push(e)}})),I("4.85.0","4.85.0")||(a=r=[]),r[0]||a[0]||s[0]}function B(e={},t){const a=Object(b.a)({pageInfo:{pageId:Object(f.a)()}},{defaultErrorHandler:e=>{}});let r=s()({scene_id:e.activitySceneSn,long_url:e.shareURL||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,param:{},page_sn:Object(f.c)()},Object(v.b)(e));e.payloadMixin&&"object"==typeof e.payloadMixin&&(r=Object.assign({},e.payloadMixin.param_map,r)),"string"!=typeof r.param&&(r.param=JSON.stringify(r.param));return a.post("api/flow/chron/share/card",{param_map:r}).then(((e={})=>{const a=(e.infos||[]).filter((e=>Object.keys(e).length>0));return{raw:e,info:G(a,t),tpInfos:a,tpDowngrade:a.length<=0}}))}var Y=a("Qm63"),K=a("2Goq"),V=a("T8QY"),F=a("6wpZ");const Z=0,Q=1,q=2;function z(e="",t=""){return e.replace(/%s/g,t)}let J={};function X({consumeMode:e,scene:t}){if("number"!=typeof e||[F.a.CONSUME_RAW,F.a.RECYCLE_RAW].indexOf(e)>=0)return Promise.resolve();const a=t=>{if(t&&!(t.length<=0)){if([F.a.CONSUME_TIME_DIVIDE,F.a.RECYCLE_TIME_DIVIDE].indexOf(e)>=0){const e=new Date,a=e.getMinutes(),r=e.getSeconds();return t[Math.floor(t.length*(60*a+r)/3600)]}if(F.a.RECYCLE_TIME_DIVIDE_MULTI===e){const e=t.length,a=Math.min(Math.max(parseInt(window.__SHARE_CIPHER_PARALLEL_SIZE__,10)||0,2),e),r=Math.max(Math.floor(e/a),1),s=Math.floor(Math.random()*a),i=new Date,n=i.getMinutes(),o=i.getSeconds(),h=Math.floor(r*(60*n+o)/3600);return t[Math.max(s*r+h,e-1)]}return t[0]}},r=(J[t]||{}).texts;return r?Promise.resolve(a(r)):function(e){return Object(_.g)("JSShare","getLocalCipherInfo",{action:Q,page_sn:Object(f.c)()+"",scene:e}).then(((t={})=>{const a=(t.texts||[]).map((e=>{if(e)return e.version&&Object(h.c)(e.version,window.__SHARE_CIPHER_VER__||"0.0.1")>=0?e.text:e.version?void 0:e.text})).filter((e=>!!e));return J[e]=J[e]||{},J[e].texts=a,a}),((e={})=>(Object(D.a)({errorCode:e.errorCode,message:"本地获取口令文本失败",options:e.data}),null)))}(t).then(a)}function $({consumeMode:e,scene:t}){return"number"!=typeof e?Promise.resolve():[F.a.CONSUME,F.a.CONSUME_TIME_DIVIDE,F.a.CONSUME_RAW].indexOf(e)>=0?function(e){return Object(_.g)("JSShare","getLocalCipherInfo",{action:q,page_sn:Object(f.c)()+"",scene:e}).then((e=>e.cipher),(e=>(Object(D.a)({errorCode:e.errorCode,message:"本地消费口令码失败",options:e.data}),null)))}(t):function(e){return Object(_.g)("JSShare","getLocalCipherInfo",{action:Z,page_sn:Object(f.c)()+"",scene:e}).then(((e={})=>e.ciphers||[]),(e=>(Object(D.a)({errorCode:e.errorCode,message:"本地获取口令码失败",options:e.data}),null)))}(t).then((e=>{if(e&&!(e.length<=0))return e[0]}))}function ee(e={}){const{scene:t,consumeMode:a}=e;return Object(o.a)().isNativePlatform&&I("5.41.0","5.41.0")&&t&&"number"==typeof a?Promise.all([$(e),X(e)]).then(((e=[])=>{const[t,r]=e;return t&&[F.a.CONSUME_RAW,F.a.RECYCLE_RAW].indexOf(a)>=0?t:t&&r?Object.assign({text:z(r,t.cipher)},t):void 0})):Promise.resolve()}var te=a("q8Ib");function ae(...e){return Object(o.a)().isNativePlatform?re(...e).then((t=>{const{missed:a}=t;return a?Object(R.d)(...e):t})):Object(R.d)(...e)}const re=(e={})=>{const t=e.shareURL||"",a=e.urlWrapType;if(e.marketActivityID&&e.activitySceneSn&&a===P.a.CATEGORY_PROCEDURE){const a=U().matchedPkgId;return B(Object.assign({rom:U().rom,matchedPkgId:a},e),e.tpSelectCategory).then((({info:e,tpInfos:a,tpDowngrade:r,raw:s})=>{const i={raw:s,tpDowngrade:r,tpInfo:e,tpInfos:a,realShareURL:(e||a[0]||{}).link_url||t,targetShareURL:t},n=new Error("category procedure");return n.data=i,Promise.reject(n)}))}if(e.marketActivityID&&a===P.a.CATEGORY_PROCEDURE_CUSTOM){const r=Object(P.d)(a)?te.b.WEIXIN_TINY_DOMAIN:te.b.SHORT_LINK,s=t.replace(/^(\w+:)?\/\//,"");return Object(te.c)(e.requestUsePost?"post":"get",{shareURL:s,marketActivityID:e.marketActivityID,platform:Object(R.c)(),shareDomainType:r,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin}).then((e=>{const t=new Error("category procedure custom");return t.data=e,Promise.reject(t)}))}if(e.marketActivityID&&e.activitySceneSn&&a===P.a.SERVER_TP_APP){const a=U().matchedPkgId;return function(e={},t){const a=Object(b.a)({pageInfo:{pageId:Object(f.a)()}},{defaultErrorHandler:e=>{}});let r={long_url:e.shareURL||"",activity_code:(e.marketActivityID||0)+"",scene_sn:e.activitySceneSn||"",rom:e.rom||0,matched_pkg_id:e.matchedPkgId,params:{}};return e.payloadMixin&&"object"==typeof e.payloadMixin&&(r=Object.assign(r,e.payloadMixin)),"string"!=typeof r.params&&(r.params=JSON.stringify(r.params)),a.post("api/flow/walrus/inquire/confusion/info",r).then(((e={})=>{const a=(e.infos||[]).filter((e=>Object.keys(e).length>0));return{raw:e,info:G(a,t),tpInfos:a,tpDowngrade:a.length<=0}}))}(Object.assign({rom:U().rom,matchedPkgId:a},e),e.tpSelectCategory).then((({info:e,tpInfos:a,tpDowngrade:r})=>({tpInfo:e,tpDowngrade:r,tpInfos:a,realShareURL:(e||a[0]||{}).link_url||t,targetShareURL:t})),(e=>Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})))}if(e.marketActivityID&&Object(P.b)(a)){const r=Object(P.d)(a)?te.b.WEIXIN_TINY_DOMAIN:te.b.SHORT_LINK,s=t.replace(/^(\w+:)?\/\//,""),i=Object(Y.a)(e),n=e.cipherScene,o=e.consumeMode,h=Object(K.a)(),_=()=>{const n=new Promise(((i,n)=>{Object(te.c)(e.requestUsePost?"post":"get",{shareURL:s,marketActivityID:e.marketActivityID,platform:Object(R.c)(),shareDomainType:r,shortURLApi:e.shortURLApi,shortCommandApi:e.shortCommandApi,domainURLApi:e.domainURLApi,payloadMixin:e.payloadMixin}).then((e=>{if(e){const{domain:s="",shortURL:o,shareText:h,raw:_}=e;if(r===te.b.WEIXIN_TINY_DOMAIN)a===P.a.DOMAIN_REPLACE&&i(Object(R.a)(t,s));else if(r===te.b.SHORT_LINK){if(!o&&!h){const e=new Error("empty short_url with empty share_text");return e.data=_,void n(e)}return void i({useShortURL:!0,realShareURL:o||t,targetShareURL:t,shareText:h,rawResponse:_})}}i({realShareURL:t,targetShareURL:t})})).catch((e=>{n(e)}))}));return r===te.b.SHORT_LINK&&n.then((e=>{e&&e.useShortURL&&(h.cacheResponseByHash(i,e),h.setShareID(i,(new V.a(t).query||{}).refer_share_id))})),n};if(a===P.a.SERVER_SHORT_URL_WITH_CACHE){let e=h.getResponseByHash(n);return e?(h.increaseCount(n),Promise.resolve(e)):(e=h.getResponseByHash(i),e?(h.increaseCount(i),Promise.resolve(e)):n&&U().isCipherDowngrade?ee({scene:n,consumeMode:o}).then(((e={})=>{if(e&&e.share_id){const t={cipher:e.cipher,shareText:e.text,shareID:e.share_id};return h.cacheResponseByHash(n,t),h.setShareID(n,e.shareID),t}return _()}),(e=>_())):_())}return _()}if(e.activitySceneSn&&a===P.a.SERVER_TP_APP_CARD){const a=U().matchedPkgId;return B(Object.assign({rom:U().rom,matchedPkgId:a},e),e.tpSelectCategory).then((({info:e,tpInfos:a,tpDowngrade:r})=>({tpInfo:e,tpDowngrade:r,tpInfos:a,realShareURL:(e||a[0]||{}).link_url||t,categoryShareInfo:{thumbnailURL:(e||a[0]||{}).thumb_img_url},targetShareURL:t})),(e=>Promise.resolve({tpDowngrade:!0,realShareURL:t,targetShareURL:t})))}return Promise.resolve({missed:!0,realShareURL:t,targetShareURL:t})};var se=a("XfDS"),ie=a("Upw4");async function ne(e={},t){if("function"!=typeof t.cipherProcessor)return e;try{const a=await t.cipherProcessor({cipherText:e.title,cipherCode:e.cipher,shareEntity:t});"string"==typeof a&&(e.title=e.desc=a)}catch(a){}return e}const oe="static",he="dynamic";function _e(e,t,a={}){const r=e.drawImageOptions;return"function"==typeof r?r(a=s()({shareRefer:Object(v.b)(e)},a||{})):"object"==typeof r?t?Promise.resolve((e=>e?Array.isArray(e)&&e.length>0?e.map(((e,t)=>e?"string"==typeof e?{type:oe,data:e}:"object"==typeof e?e.type?e:{type:he,options:e}:void 0:null)).filter((e=>!!e)):"object"==typeof e?[{type:he,options:e}]:[]:[])(r)):Promise.resolve((e=>e?Array.isArray(e)&&e.length>0?e[0]:"object"==typeof e?e:null:null)(r)):Promise.resolve({})}var ce=a("1dcj");class pe extends y.a{constructor(e){super(e),this.drawImageOptions=e.drawImageOptions,this.redirectURI=e.redirectURI||"",this.miniObjectPath=e.miniObjectPath||"",this.miniObjectID=e.miniObjectID,this.useWxAppShare=e.useWxAppShare||!1,this.forceDowngrade=e.forceDowngrade||!1,this.excludeShareChoices=e.excludeShareChoices||[],this.thirdPartyOpenType=e.thirdPartyOpenType,this.drawImageClass=e.drawImageClass,this.needSharedAmount=e.needSharedAmount||!1,this.cipherScene=e.cipherScene,this.consumeMode=e.consumeMode,this.activitySceneSn=e.activitySceneSn,this.tpSelectCategory=e.tpSelectCategory,this.pinTimelineParams=e.pinTimelineParams,this.withShareTicket=e.withShareTicket,this.systemShareMode=e.systemShareMode||ce.a.DEFAULT,this.wechatMaskConfig=e.wechatMaskConfig}async normalize(e){var t=this;if(e===p.a.COPY_CIPHER)return this.processCipher();const a=Object.assign({},this);if(e===p.a.PIN_TIMELINE)return a.pinTimelineParams;const r={title:a.title,desc:a.message,thumbnail:a.thumbnailURL,share_url:a.shareURL,share_id:a.shareID,with_share_ticket:!!a.withShareTicket,system_share_mode:a.systemShareMode},i=a.wechatMaskConfig;if(i&&"object"==typeof i){const{share_rec_mask:t}=i,o=n()(i,["share_rec_mask"]),h=s()({},o);t&&(h.share_rec_mask=s()({share_type:e,activity_code:a.marketActivityID,share_id:a.shareID},t)),r.wechat_mask_config=h}if(a.payloadMixin){const e=a.payloadMixin.extra;"object"==typeof e&&void 0!==e.share_prefer&&(r.share_prefer=e.share_prefer)}let o=!1;switch(e){case p.a.WECHAT_SESSION:if(a.miniObjectPath&&"string"==typeof a.miniObjectPath)r.mini_object_path=Object(v.a)(a);else if("function"==typeof a.miniObjectPath)try{r.mini_object_path=a.miniObjectPath(a.shareURL)}catch(c){}a.miniObjectID&&(r.mini_object_id=a.miniObjectID);break;case p.a.WECHAT_TIMELINE_IMAGE:case p.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK:case p.a.WECHAT_SESSION_IMAGE:case p.a.QQ_CHAT_SESSION_IMAGE:case p.a.QQ_ZONE_IMAGE:case p.a.WEIBO_IMAGE:case p.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK:o=!0,r.options=await _e(a);break;case p.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK:o=!0,r.multi_image_options=await _e(a,!0);break;case p.a.SHARE_IMAGE_PASSIVELY:o=!0,r.options=await _e(a),a.thirdPartyOpenType&&(r.open_type=a.thirdPartyOpenType);break;case p.a.IOS_SYSTEM_SHARE_CARD:case p.a.WECHAT_SESSION_CARD_WITH_NO_SDK:case p.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK:r.excluded_types=a.excludeShareChoices}const h=this.getShareForm.call(a,e),_=[C.a.COMMAND,C.a.TEXT].indexOf(h)>=0;if(this.targetShareURL=a.shareURL,this.realShareURL=a.shareURL,this.useShortURL=!1,e===p.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=r.mini_object_path),Object(ie.a)(e)){const t=Object(R.b)(e,a.shareURL);r.share_url=t,this.shareURL=t,this.realShareURL=t,this.targetShareURL=t}if(e===p.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=this.targetShareURL=r.mini_object_path),h!==C.a.CARD&&h!==C.a.WXAPP_CARD||!a.urlWrapType){if(o&&(Object(P.c)(a.urlWrapType)||a.urlWrapType===P.a.MAGIC_TRACE||a.urlWrapType===P.a.MAGIC_TRACE_DYNAMIC))return ae(a).then((async function(e={}){const{realShareURL:s,targetShareURL:i,useShortURL:n,shareText:o}=e;return t.targetShareURL=i,a.shortCommandApi?(t.pcode=o,r.share_url=o):(t.useShortURL=n,t.realShareURL=s,r.share_url=n?Object(se.a)(s):s),n&&(r.multi_image_options?r.multi_image_options=await _e(a,!0,e):r.options&&(r.options=await _e(a,!1,e),r.options&&"object"==typeof r.options&&r.options.$params&&(Object.assign(r,r.options.$params),delete r.options.$params))),r}));if(_){let e=r.title||"";return Object(P.c)(a.urlWrapType)?ae(a).then((({realShareURL:t,targetShareURL:s,useShortURL:i,shareText:n,shareID:o,cipher:h,tpInfo:_,tpInfos:c,tpDowngrade:p,rawResponse:S={}})=>{if(o&&(r.shareID=o),h&&(r.cipher=h),_&&(r.title=_.link_url||r.title,r.desc=_.link_url||r.desc,e=r.title),r.tpInfo=_,r.tpInfos=c,r.tpDowngrade=p,r.rawResponse=S,this.targetShareURL=s,a.shortCommandApi){const t=i||h?n:"",a=t||s;e=Object(y.b)(e,a,s,t),r.title=r.desc=e,this.pcode=e}else{const a=i?t:"",n=a||s;e=Object(y.b)(e,n,s,a),r.title=r.desc=e,this.useShortURL=i,this.realShareURL=n}return ne(r,a)})):(e=Object(y.b)(e,a.shareURL),r.title=r.desc=e,ne(r,a))}return Promise.resolve(r)}return ae(a).then((({realShareURL:e,targetShareURL:t,useShortURL:s,tpDowngrade:i,tpInfo:n,tpInfos:o,appendQuery:h,categoryShareInfo:_,useCipher:c,missed:p})=>c?Promise.reject(new Error("operation refused")):(p||(this.useShortURL=s,this.realShareURL=e,this.targetShareURL=t),r.share_url=e,n&&(r.title=n.title||r.title,r.desc=n.message||r.desc),_&&(r.title=_.title||r.title,r.thumbnail=_.thumbnailURL||r.thumbnail),r.tpInfo=n,r.tpInfos=o,r.tpDowngrade=i,a.urlWrapType===P.a.SERVER_QUERY_APPEND&&"string"==typeof r.mini_object_path&&r.mini_object_path&&(r.mini_object_path=Object(v.a)({miniObjectPath:r.mini_object_path,shareURL:e},{appendQuery:h}),this.realShareURL=r.mini_object_path),r)))}getShareForm(e){return e===p.a.WECHAT_SESSION?this.miniObjectPath||this.useWxAppShare?C.a.WXAPP_CARD:C.a.CARD:[4,2,5,6,24,25,18,9996,9997].includes(e)?C.a.CARD:[8,9,10,11,12,13,15,19,20,22].includes(e)?C.a.IMAGE:[3,16,17,21,p.a.COPY_CIPHER].includes(e)?this.shortCommandApi?C.a.COMMAND:C.a.TEXT:e===p.a.COPY_LINK?C.a.COPY_LINK:C.a.DEFAULT}getShareMethod(e){return[9,16,19,20,18,9996,9997].includes(e)?u.a.SYSTEM:[1,2,3,4,5,8,10,11,12,13,15,17,21,24,25].includes(e)?u.a.SDK:e===p.a.SHARE_IMAGE_PASSIVELY?this.thirdPartyOpenType?u.a.MANUAL:u.a.DEFAULT:e===p.a.COPY_CIPHER?u.a.MANUAL:u.a.DEFAULT}}var Se=pe,Ee=a("A4fa"),Ie=a("WiBJ");var le=a("KxTr");const me=Object.keys(p.a).map((e=>p.a[e])).filter((e=>[p.a.WECHAT_BIG_IMAGE].indexOf(e)<=0));class de extends c.a{constructor(e){super(e),this.ShareEntityClass=Se,this._enableShareTypes=me.concat(),this.shareLimiter=U(),this._isEnableShareCheck=!1,this.setShareCheck(!0)}setShareCheck(e){Object(o.a)().isTinyNativePlatform?this._isEnableShareCheck=!0:this._isEnableShareCheck=!!e&&I("4.51.0","4.51.0")}checkShareTypeEnable(e){const t=this.getShareEntityByShareType(e);if(!this.validateShareParams(e,t))return O.a.SHARE_PARAMS_NOT_VALID;if(!(e=>{let t=!1;if("number"!=typeof e)return!1;switch(e){case p.a.WECHAT_SESSION:case p.a.WECHAT_TIMELINE:case p.a.WECHAT_SESSION_APP:case p.a.QQ_CHAT_SESSION:case p.a.QQ_ZONE:case p.a.WECHAT_TIMELINE_IMAGE:case p.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK:case p.a.WECHAT_SESSION_IMAGE:case p.a.QQ_CHAT_SESSION_IMAGE:case p.a.QQ_ZONE_IMAGE:case p.a.WECHAT_SESSION_TEXT_WITH_NO_SDK:case p.a.WECHAT_SESSION_TEXT:t=!0;break;case p.a.WEIBO:case p.a.WEIBO_IMAGE:t=I("4.81.0","4.81.0");break;case p.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK:case p.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK:t=I("4.37.0","4.36.0");break;case p.a.WECHAT_TIMELINE_TEXT:t=I("4.39.0","4.39.0");break;case p.a.IOS_SYSTEM_SHARE_CARD:case p.a.WECHAT_SESSION_CARD_WITH_NO_SDK:case p.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK:t=l();break;case p.a.SHARE_IMAGE_PASSIVELY:t=I("4.49.0","4.49.0");break;case p.a.COPY_LINK:case p.a.COPY_CIPHER:t=!0;break;case p.a.WECHAT_SESSION_MUSIC:case p.a.WECHAT_SESSION_VIDEO:t=I("4.86.0","4.86.0");break;case p.a.FRIENDS:case p.a.WECHAT_BIG_IMAGE:t=!0;break;case p.a.PIN_TIMELINE:t=I("5.6.0","5.6.0")}return t})(e)||this._enableShareTypes.indexOf(e)<0)return O.a.SHARE_TYPE_DISABLED;if(this._isEnableShareCheck&&[p.a.COPY_LINK,p.a.COPY_CIPHER].indexOf(e)<0){const a=this.shareLimiter.checkSync(e,t);if(a)return a}return 0}share(e){const t=this.checkShareTypeEnable(e);return t||(e===p.a.PIN_TIMELINE?this._sharePinTimeline(e):e===p.a.WECHAT_BIG_IMAGE?this._nativeShareBigImage(e):[p.a.WECHAT_SESSION,p.a.WECHAT_TIMELINE,p.a.WEIBO,p.a.QQ_CHAT_SESSION,p.a.QQ_ZONE,p.a.TENCENT_WEIBO,p.a.WECHAT_SESSION_APP,p.a.FRIENDS,p.a.WECHAT_SESSION_MUSIC,p.a.WECHAT_SESSION_VIDEO].indexOf(e)>=0?this._nativeShareCard(e):[p.a.IOS_SYSTEM_SHARE_CARD,p.a.WECHAT_SESSION_CARD_WITH_NO_SDK,p.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK].indexOf(e)>=0?this._nativeShareCardSpecial(e):[p.a.WECHAT_TIMELINE_IMAGE,p.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK,p.a.WECHAT_SESSION_IMAGE,p.a.QQ_CHAT_SESSION_IMAGE,p.a.QQ_ZONE_IMAGE,p.a.WEIBO_IMAGE,p.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK,p.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK,p.a.SHARE_IMAGE_PASSIVELY].indexOf(e)>=0?this._nativeShareImage(e):[p.a.WECHAT_SESSION_TEXT_WITH_NO_SDK,p.a.WECHAT_SESSION_TEXT,p.a.WECHAT_TIMELINE_TEXT].indexOf(e)>=0?this._nativeShareText(e):p.a.COPY_LINK===e?this._nativeShareClipboard(e):p.a.COPY_CIPHER===e?this.copyCipher():O.a.SHARE_TYPE_NOT_FOUND)}validateShareParams(e,t={}){return!0}_setupShareTypes(){}resetLimiter(){return this.shareLimiter.reset(),this._queryShareTypePromise=null,this.waitShareLimiter()}refreshShare(e,t){const a=super.refreshShare(e,t);return this.emit(A.a.ON_SHARE_PREPARE,{shareType:t}),a}_setupPlatformShareSDK(){return this.waitShareLimiter()}waitShareLimiter(){return this._isEnableShareCheck?(this._queryShareTypePromise||(this._queryShareTypePromise=this.shareLimiter.build().catch((e=>(this.emit(A.a.SHARE_LIMIT_LOAD_FAIL),Promise.resolve())))),this._queryShareTypePromise):Promise.resolve()}_nativeShareCard(e){this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});const t=this.getShareEntityByShareType(e);return t.normalize(e).then(((a={})=>{const{tpInfo:r,tpInfos:s,tpDowngrade:i,wechat_mask_config:o}=a,h=n()(a,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config"]);if(i)return void this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.FAIL,tpDowngrade:!0,tpInfo:r});const _=Object.assign({type:e,redirect_uri:t.redirectURI||"",share_params:h,share_method:Object(Ie.a)(t,e)});t.needSharedAmount&&(_.show_check_detail=1),o&&(_.wechat_mask_config=o),r&&r.dev_type&&(_.dev_app=r.dev_app,_.dev_type=r.dev_type),s&&(_.dev_infos=s),this._invokeNativeShare(_,(t=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,responseData:t,tpInfo:r})}),((t={})=>{const a=parseInt(t.errorCode,10)||0,s=a===E?T.a.CANCEL:T.a.FAIL;this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:s,nativeShareErrorCode:a,responseData:t.data,tpInfo:r})}))}),this.getNormalizeErrorHandler(e)),0}_nativeShareCardSpecial(e){this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});const t=this.getShareEntityByShareType(e);return t.normalize(e).then((a=>{const r=Object.assign({type:p.a.IOS_SYSTEM_SHARE_CARD,share_params:a,share_method:Object(Ie.a)(t,e)});this._invokeNativeShare(r,(t=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,responseData:t})}),((t={})=>{const a=parseInt(t.errorCode,10)||0,r=a===E?T.a.CANCEL:T.a.FAIL;this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:r,nativeShareErrorCode:a,responseData:t.data})}))}),this.getNormalizeErrorHandler(e)),0}_nativeShareImage(e){this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});const t=this.getShareEntityByShareType(e);let a=e;return t.normalize(e).then(((r={})=>{const{share_code:s,system_share_mode:i,wechat_mask_config:o}=r,h=n()(r,["share_code","system_share_mode","wechat_mask_config"]),_={type:a,share_params:h,share_method:Object(Ie.a)(t,e),share_code:s,system_share_mode:i};o&&(_.wechat_mask_config=o);this._invokeNativeShare(_,(t=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,responseData:t})}),((t={})=>{const a=parseInt(t.errorCode,10),r=a===E?T.a.CANCEL:T.a.FAIL;this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:r,nativeShareErrorCode:a,responseData:t.data})}))}),this.getNormalizeErrorHandler(e)),0}_nativeShareText(e){const t=this.getShareEntityByShareType(e),a=t.cipherScene&&"string"==typeof t.cipher;!a&&this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});let r=e;return t.normalize(e).then((s=>{const{tpInfo:i,tpInfos:_,tpDowngrade:c,wechat_mask_config:S}=s,I=n()(s,["tpInfo","tpInfos","tpDowngrade","wechat_mask_config"]);if(a&&(this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e,shareID:I.shareID}),delete I.shareID),c)return void this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.FAIL,tpDowngrade:!0,tpInfo:i});const l=Object.assign({type:r,share_params:I,share_method:Object(Ie.a)(t,e)});i&&i.dev_type&&(l.dev_app=i.dev_app,l.dev_type=i.dev_type),_&&(l.dev_infos=_),S&&(l.wechat_mask_config=S);if(t.forceDowngrade||Object(o.a)().system===h.b.IOS&&r===p.a.WECHAT_SESSION_TEXT_WITH_NO_SDK)return this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.FAIL,shareParams:s}),0;this._invokeNativeShare(l,(t=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,responseData:t})}),((t={})=>{const a=parseInt(t.errorCode,10)||0,r=a===E?T.a.CANCEL:T.a.FAIL;this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:r,nativeShareErrorCode:a,responseData:t.data})}))}),this.getNormalizeErrorHandler(e)),0}_nativeShareBigImage(e){return O.a.SHARE_TYPE_DISABLED}_nativeShareClipboard(e){this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});const t=this.getShareEntityByShareType(e);return t.normalize(e).then(((a={})=>{const r=a.share_url||t.shareURL;var s;(s=r,"string"!=typeof s?Promise.reject():Object(o.a)().isNativePlatform?Object(_.g)("AMStorage","setPasteboard",{text:s}):Promise.reject()).then((()=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,content:r,originContent:""})}),(()=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.FAIL,content:r,originContent:""})}))}),this.getNormalizeErrorHandler(e)),0}_sharePinTimeline(e){this.emit(A.a.ON_SHARE_TRIGGER,{shareType:e});return this.getShareEntityByShareType(e).normalize(e).then(((t={})=>{const a=Object.assign({type:e,share_params:t});this._invokeNativeShare(a,(t=>{this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.SUCCESS,responseData:t})}),((t={})=>{const a=parseInt(t.errorCode,10)||0;this.emit(A.a.ON_SHARE_COMPLETED,{shareType:e,shareResultType:T.a.FAIL,nativeShareErrorCode:a,responseData:t.data})}))}),this.getNormalizeErrorHandler(e)),0}setupNativeShareButton(e={}){const{shareIcon:t=d,shareIconSize:a=m}=e;return"string"!=typeof t||"number"!=typeof a?O.a.SHARE_PARAMS_NOT_VALID:(Object(_.g)("JSUIControl","setRightBarButtons",{buttons:[{icons:{normal:t},callback:()=>{this.emit(A.a.ON_SHARE_BUTTON_CLICKED)},size:a}]}).catch((e=>{})),0)}_invokeNativeShare(e={},t,a){let r="share";const s=Object(f.c)()+"";this._isEnableShareCheck?(e=Object.assign({origin:"h5",page_sn:s,page_info:{page_name:Object(f.b)(),page_url:location&&location.href}},e),this.shareLimiter.getAppOptional()&&(e.app_optional=this.shareLimiter.getAppOptional()),r="performShare"):e.page_sn=s,Object(_.g)("JSShare",r,e).then(t,a)}shareCipherManually(e,t=Ee.a.OPEN_WECHAT,a=le.a.DEFAULT,r,i={}){return e&&"string"==typeof e?I("4.74.0","4.74.0","4.80.0")?(t!==Ee.a.OPEN_WECHAT&&t!==Ee.a.OPEN_WECHAT_IOS_SILENT&&t!==Ee.a.OPEN_WECHAT_ANDROID_SILENT||(t=Object(o.a)().platform!==h.a.PDDTinyAndorid&&I("4.88.0","4.88.0")&&this.shareLimiter.isSilentMode?Object(o.a)().system===h.b.IOS?Ee.a.OPEN_WECHAT_IOS_SILENT:Ee.a.OPEN_WECHAT_ANDROID_SILENT:Ee.a.OPEN_WECHAT),Object(_.g)("JSShare","shareCipher",s()({cipher:e,open_type:t,paste_type:a,share_code:r},i))):Promise.reject(new Error("not support")):Promise.reject(new Error("invalid cipher"))}}t.default=de}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/mobile-best-goods/js/ms_native_c_0b7a1cc1b6ed2386dc1c.module.js.map