(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"3Wbp":function(e,t,r){"use strict";r.r(t);var a=r("1OyB"),n=r("vuIU"),i=r("ReuC"),o=r("foSv"),s=r("Ji7U"),h=r("LK+K"),c=r("KoDT"),p=r("h3qu"),u=r("MpJ2"),l=r("dKgK"),_=r("a/1V"),S=r("qxQD"),E=r("/bZk"),f=r("chhR"),d=r("EECB"),O=r("o0o1"),m=r.n(O),I=r("U8pU"),v=r("HaE+"),y=r("YSLc"),g=r("W9H9"),T=r("gfNA"),b=r("Ne86"),C=r("7sJ8"),A=r("uf4C"),R=r("rIj9"),L="api/flow/audience/share/types",N=r("v1av"),P=r("z4CT"),j=r("dp2P"),D=E.b.ShareErrorCode,M=function(){function ShareLimiter(){Object(a.a)(this,ShareLimiter),this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}return Object(n.a)(ShareLimiter,[{"key":"build","value":function build(){var e=this;return this._inited?Promise.resolve():(this._queryShareTypePromise||(this._queryShareTypePromise=this.loadRules(),this._queryShareTypePromise.then((function(t){return e._inited=!0,e._processRules(t),N.a.getInstance().build({"magicTrace":t.magic_trace})})).catch((function(t){Object(P.a)({"errorCode":0,"message":"分享规则初始化失败","options":{"message":t&&t.message,"errorCode":t&&t.errorCode}}),e._inited=!0}))),this._queryShareTypePromise)}},{"key":"reset","value":function reset(){this._inited=!1,this._queryShareTypePromise=null,this._rules=null,this._enableShareTypes=[],this.appOptional=null,this._rom=0,this._isCipherDowngrade=!1,this._enableSilentMode=!1}},{"key":"getAppOptional","value":function getAppOptional(){return this.appOptional}},{"key":"getRules","value":function getRules(){var e=this;return this.build().then((function(){return e._rules}),(function(){return Promise.resolve(e._rules)}))}},{"key":"loadRules","value":function loadRules(){return Object(c.a)().isNativePlatform?Object(u.z)(Object(S.g)(),"queryShareTypes",{"page_sn":Object(A.e)()+"","page_info":{"page_name":Object(A.d)(),"page_url":location&&location.href}}):function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object(R.a)({"pageInfo":{"pageId":Object(A.c)()}},{"defaultErrorHandler":function defaultErrorHandler(e){}}),a={};return a.page_sn=t.pageSn||"",a.page_info=t.pageInfo||{},a.platform="h5","post"===e.toLowerCase()?r.post(L,a):r.get(L,{"params":a})}("post",{"pageSn":Object(A.e)()+"","pageInfo":{"page_name":Object(A.d)(),"page_url":location&&location.href}})}},{"key":"_processRules","value":function _processRules(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.share_types||[];this.appOptional=e.app_optional,this._rom=e.rom,this._enableSilentMode=e.is_weird,e.degrade&&this.setCipherDowngrade(!0);var r=[];return this._rules=t.reduce((function(e,t){var a=t.share_type;return a&&(e[a]=t,r.push(parseInt(a,10))),e}),{}),this._innerShareTypes=e.inner_share_types||[],this._innerShareTypes.forEach((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.push(parseInt(e.share_type,10))})),this._enableShareTypes=r,this._rules}},{"key":"getRuleByType","value":function getRuleByType(e){return(this._rules||{})[e]}},{"key":"checkSync","value":function checkSync(e,t){if(!this._rules)return D.SHARE_LIMITER_NOT_INIT;if(this._enableShareTypes.indexOf(e)<0)return D.SHARE_TYPE_DISABLED;var r=t.getShareForm(e),a=(this.getRuleByType(e)||{}).share_methods||[];return[g.a.COMMAND,g.a.TEXT].indexOf(r)>=0?Object(j.c)(t.urlWrapType)&&t.marketActivityID&&(t.shortURLApi&&a.indexOf(C.a.LINK)>=0||t.shortCommandApi&&a.indexOf(C.a.CIPHER)>=0)||a.indexOf(C.a.NORMAL)>=0?0:D.SHARE_TYPE_DISABLED:[_.a.WECHAT_SESSION,_.a.WECHAT_TIMELINE].indexOf(e)>=0?Object(j.d)(t.urlWrapType)&&t.marketActivityID&&a.indexOf(C.a.DOMAIN)<0?D.SHARE_TYPE_DISABLED:a.indexOf(C.a.NORMAL)>=0?0:D.SHARE_TYPE_DISABLED:0}},{"key":"setCipherDowngrade","value":function setCipherDowngrade(e){this._isCipherDowngrade=e}},{"key":"isCipherDowngrade","get":function get(){return this._isCipherDowngrade}},{"key":"rom","get":function get(){return this._rom}},{"key":"isSilentMode","get":function get(){return this._enableSilentMode}}]),ShareLimiter}(),H=null;function getInstance(){return H||(H=new M),H}var U=r("VTBJ"),k=r("bbLm"),x=r("rUjM"),W=0,w=1,B=2;function selectInfoByCategory(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(arguments.length>1&&void 0!==arguments[1]||x.a.TP_FIRST,[]),r=[],a=[],n=[];return e.forEach((function(e){if(e)switch(e.dev_type){case w:t.push(e);break;case B:r.push(e);break;case W:a.push(e);break;default:n.push(e)}})),Object(S.j)()||(t=r=[]),r[0]||t[0]||a[0]}function translateTPAppCard(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object(R.a)({"pageInfo":{"pageId":Object(A.c)()}},{"defaultErrorHandler":function defaultErrorHandler(e){}}),a=Object(U.a)({"scene_id":e.activitySceneSn,"long_url":e.shareURL||"","rom":e.rom||0,"param":{},"page_sn":Object(A.e)()},Object(k.b)(e));e.payloadMixin&&"object"===Object(I.a)(e.payloadMixin)&&(a=Object.assign({},e.payloadMixin.param_map,a)),"string"!=typeof a.param&&(a.param=JSON.stringify(a.param));var n=r.post("api/flow/chron/share/card",{"param_map":a});return n.then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(e.infos||[]).filter((function(e){return Object.keys(e).length>0})),a=selectInfoByCategory(r,t);return{"info":a,"tpInfos":r,"tpDowngrade":r.length<=0}}))}function translateTPApp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object(R.a)({"pageInfo":{"pageId":Object(A.c)()}},{"defaultErrorHandler":function defaultErrorHandler(e){}}),a={"long_url":e.shareURL||"","activity_code":(e.marketActivityID||0)+"","scene_sn":e.activitySceneSn||"","rom":e.rom||0,"params":{}};e.payloadMixin&&"object"===Object(I.a)(e.payloadMixin)&&(a=Object.assign(a,e.payloadMixin)),"string"!=typeof a.params&&(a.params=JSON.stringify(a.params));var n=r.post("api/flow/walrus/inquire/confusion/info",a);return n.then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(e.infos||[]).filter((function(e){return Object.keys(e).length>0})),a=selectInfoByCategory(r,t);return{"info":a,"tpInfos":r,"tpDowngrade":r.length<=0}}))}var G=r("Qm63"),Y=r("2Goq"),K=r("T8QY"),z=r("ODXe"),q=r("6wpZ"),F=0,Q=1,V=2;function formatCipher(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.replace(/%s/g,t)}var X={};function getCipherTemplate(e){var t=e.consumeMode,r=e.scene;if("number"!=typeof t||[q.a.CONSUME_RAW,q.a.RECYCLE_RAW].indexOf(t)>=0)return Promise.resolve();var a=function processText(e){if(e&&!(e.length<=0)){if([q.a.CONSUME_TIME_DIVIDE,q.a.RECYCLE_TIME_DIVIDE].indexOf(t)>=0){var r=new Date,a=r.getMinutes(),n=r.getSeconds();return e[Math.floor(e.length*(60*a+n)/3600)]}if(q.a.RECYCLE_TIME_DIVIDE_MULTI===t){var i=e.length,o=Math.min(Math.max(parseInt(window.__SHARE_CIPHER_PARALLEL_SIZE__,10)||0,2),i),s=Math.max(Math.floor(i/o),1),h=Math.floor(Math.random()*o),c=new Date,p=c.getMinutes(),u=c.getSeconds(),l=Math.floor(s*(60*p+u)/3600);return e[Math.max(h*s+l,i-1)]}return e[0]}},n=(X[r]||{}).texts;return n?Promise.resolve(a(n)):function loadCipherText(e){return Object(u.z)(Object(S.g)(),"getLocalCipherInfo",{"action":Q,"page_sn":Object(A.e)()+"","scene":e}).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(t.texts||[]).map((function(e){if(e)return e.version&&Object(p.c)(e.version,window.__SHARE_CIPHER_VER__||"0.0.1")>=0?e.text:e.version?void 0:e.text})).filter((function(e){return!!e}));return X[e]=X[e]||{},X[e].texts=r,r}),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(P.a)({"errorCode":e.errorCode,"message":"本地获取口令文本失败","options":e.data}),null}))}(r).then(a)}function getCipherCode(e){var t=e.consumeMode,r=e.scene;return"number"!=typeof t?Promise.resolve():[q.a.CONSUME,q.a.CONSUME_TIME_DIVIDE,q.a.CONSUME_RAW].indexOf(t)>=0?function popCipherCode(e){return Object(u.z)(Object(S.g)(),"getLocalCipherInfo",{"action":V,"page_sn":Object(A.e)()+"","scene":e}).then((function(e){return e.cipher}),(function(e){return Object(P.a)({"errorCode":e.errorCode,"message":"本地消费口令码失败","options":e.data}),null}))}(r):function loadCipherCode(e){return Object(u.z)(Object(S.g)(),"getLocalCipherInfo",{"action":F,"page_sn":Object(A.e)()+"","scene":e}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.ciphers||[]}),(function(e){return Object(P.a)({"errorCode":e.errorCode,"message":"本地获取口令码失败","options":e.data}),null}))}(r).then((function(e){if(e&&!(e.length<=0))return e[0]}))}function popLocalCipher(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.scene,r=e.consumeMode;return Object(c.a)().isNativePlatform&&Object(S.i)()&&t&&"number"==typeof r?Promise.all([getCipherCode(e),getCipherTemplate(e)]).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object(z.a)(e,2),a=t[0],n=t[1];return a&&[q.a.CONSUME_RAW,q.a.RECYCLE_RAW].indexOf(r)>=0?a:a&&n?Object.assign({"text":formatCipher(n,a.cipher)},a):void 0})):Promise.resolve()}var J=r("q8Ib");function getWrappedShareURLInfo(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object(c.a)().isNativePlatform?Z.apply(void 0,t).then((function(e){return e.missed?b.d.apply(void 0,t):e})):b.d.apply(void 0,t)}var Z=function getNativeOnlyWrappedShareURLInfo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shareURL||"",r=e.urlWrapType;if(e.marketActivityID&&e.activitySceneSn&&r===j.a.SERVER_TP_APP)return translateTPApp(Object.assign({"rom":getInstance().rom},e),e.tpSelectCategory).then((function(e){var r=e.info,a=e.tpInfos;return{"tpInfo":r,"tpDowngrade":e.tpDowngrade,"tpInfos":a,"realShareURL":(r||a[0]||{}).link_url||t,"targetShareURL":t}}),(function(e){return Promise.resolve({"tpDowngrade":!0,"realShareURL":t,"targetShareURL":t})}));if(e.marketActivityID&&Object(j.b)(r)){var a=Object(j.d)(r)?J.b.WEIXIN_TINY_DOMAIN:J.b.SHORT_LINK,n=t.replace(/^(\w+:)?\/\//,""),i=Object(G.a)(e),o=e.cipherScene,s=e.consumeMode,h=Object(Y.a)(),c=function remoteRequest(){var o=new Promise((function(i,o){Object(J.c)(e.requestUsePost?"post":"get",{"shareURL":n,"marketActivityID":e.marketActivityID,"platform":Object(b.c)(),"shareDomainType":a,"shortURLApi":e.shortURLApi,"shortCommandApi":e.shortCommandApi,"domainURLApi":e.domainURLApi,"payloadMixin":e.payloadMixin}).then((function(e){if(e){var n=e.domain,o=void 0===n?"":n,s=e.shortURL,h=e.shareText,c=e.raw;if(a===J.b.WEIXIN_TINY_DOMAIN)r===j.a.DOMAIN_REPLACE&&i(Object(b.a)(t,o));else if(a===J.b.SHORT_LINK)return void i({"useShortURL":!0,"realShareURL":s||t,"targetShareURL":t,"shareText":h,"rawResponse":c})}i({"realShareURL":t,"targetShareURL":t})})).catch((function(e){o(e)}))}));return a===J.b.SHORT_LINK&&o.then((function(e){e&&e.useShortURL&&(h.cacheResponseByHash(i,e),h.setShareID(i,(new K.a(t).query||{}).refer_share_id))})),o};if(r===j.a.SERVER_SHORT_URL_WITH_CACHE){var p=h.getResponseByHash(o);return p?(h.increaseCount(o),Promise.resolve(p)):(p=h.getResponseByHash(i))?(h.increaseCount(i),Promise.resolve(p)):o&&getInstance().isCipherDowngrade?popLocalCipher({"scene":o,"consumeMode":s}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&e.share_id){var t={"cipher":e.cipher,"shareText":e.text,"shareID":e.share_id};return h.cacheResponseByHash(o,t),h.setShareID(o,e.shareID),t}return c()}),(function(e){return c()})):c()}return c()}return e.activitySceneSn&&r===j.a.SERVER_TP_APP_CARD?translateTPAppCard(Object.assign({"rom":getInstance().rom},e),e.tpSelectCategory).then((function(e){var r=e.info,a=e.tpInfos;return{"tpInfo":r,"tpDowngrade":e.tpDowngrade,"tpInfos":a,"realShareURL":(r||a[0]||{}).link_url||t,"targetShareURL":t}}),(function(e){return Promise.resolve({"tpDowngrade":!0,"realShareURL":t,"targetShareURL":t})})):Promise.resolve({"missed":!0,"realShareURL":t,"targetShareURL":t})},$=r("XfDS"),ee=r("Upw4");function cipherProcess(){return _cipherProcess.apply(this,arguments)}function _cipherProcess(){return(_cipherProcess=Object(v.a)(m.a.mark((function _callee(){var e,t,r,a=arguments;return m.a.wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(e=a.length>0&&void 0!==a[0]?a[0]:{},"function"==typeof(t=a.length>1?a[1]:void 0).cipherProcessor){n.next=4;break}return n.abrupt("return",e);case 4:return n.prev=4,n.next=7,t.cipherProcessor({"cipherText":e.title,"cipherCode":e.cipher,"shareEntity":t});case 7:"string"==typeof(r=n.sent)&&(e.title=e.desc=r),n.next=13;break;case 11:n.prev=11,n.t0=n.catch(4);case 13:return n.abrupt("return",e);case 14:case"end":return n.stop()}}),_callee,null,[[4,11]])})))).apply(this,arguments)}var te="static",re="dynamic",ae=function processDrawImageOptions(e){return e?Array.isArray(e)&&e.length>0?e[0]:"object"===Object(I.a)(e)?e:null:null},ne=function processDrawImageOptionsMuti(e){return e?Array.isArray(e)&&e.length>0?e.map((function(e,t){return e?"string"==typeof e?{"type":te,"data":e}:"object"===Object(I.a)(e)?e.type?e:{"type":re,"options":e}:void 0:null})).filter((function(e){return!!e})):"object"===Object(I.a)(e)?[{"type":re,"options":e}]:[]:[]};function processDrawImage(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.drawImageOptions;return"function"==typeof a?a(r):"object"===Object(I.a)(a)?t?Promise.resolve(ne(a)):Promise.resolve(ae(a)):Promise.resolve({})}var ie=function(e){Object(s.a)(NativeShareEntity,e);var t,r=Object(h.a)(NativeShareEntity);function NativeShareEntity(e){var t;return Object(a.a)(this,NativeShareEntity),(t=r.call(this,e)).drawImageOptions=e.drawImageOptions,t.redirectURI=e.redirectURI||"",t.miniObjectPath=e.miniObjectPath||"",t.miniObjectID=e.miniObjectID,t.useWxAppShare=e.useWxAppShare||!1,t.forceDowngrade=e.forceDowngrade||!1,t.excludeShareChoices=e.excludeShareChoices||[],t.thirdPartyOpenType=e.thirdPartyOpenType,t.drawImageClass=e.drawImageClass,t.needSharedAmount=e.needSharedAmount||!1,t.cipherScene=e.cipherScene,t.consumeMode=e.consumeMode,t.activitySceneSn=e.activitySceneSn,t.tpSelectCategory=e.tpSelectCategory,t.pinTimelineParams=e.pinTimelineParams,t}return Object(n.a)(NativeShareEntity,[{"key":"normalize","value":(t=Object(v.a)(m.a.mark((function _callee2(e){var t,r,a,n,i,o,s,h,c=this;return m.a.wrap((function _callee2$(p){for(;;)switch(p.prev=p.next){case 0:if(e!==_.a.COPY_CIPHER){p.next=2;break}return p.abrupt("return",this.processCipher());case 2:if(t=Object.assign({},this),e!==_.a.PIN_TIMELINE){p.next=5;break}return p.abrupt("return",t.pinTimelineParams);case 5:r={"title":t.title,"desc":t.message,"thumbnail":t.thumbnailURL,"share_url":t.shareURL,"share_id":t.shareID},t.payloadMixin&&(a=t.payloadMixin.extra,"object"===Object(I.a)(a)&&void 0!==a.share_prefer&&(r.share_prefer=a.share_prefer)),n=!1,p.t0=e,p.next=p.t0===_.a.WECHAT_SESSION?11:p.t0===_.a.WECHAT_TIMELINE_IMAGE||p.t0===_.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK||p.t0===_.a.WECHAT_SESSION_IMAGE||p.t0===_.a.QQ_CHAT_SESSION_IMAGE||p.t0===_.a.QQ_ZONE_IMAGE||p.t0===_.a.WEIBO_IMAGE||p.t0===_.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK?14:p.t0===_.a.WECHAT_SESSION_IMAGES_WITH_NO_SDK?19:p.t0===_.a.SHARE_IMAGE_PASSIVELY?24:p.t0===_.a.IOS_SYSTEM_SHARE_CARD||p.t0===_.a.WECHAT_SESSION_CARD_WITH_NO_SDK||p.t0===_.a.WECHAT_TIMELINE_CARD_WITH_NO_SDK?30:32;break;case 11:if(t.miniObjectPath&&"string"==typeof t.miniObjectPath)r.mini_object_path=Object(k.a)(t);else if("function"==typeof t.miniObjectPath)try{r.mini_object_path=t.miniObjectPath(t.shareURL)}catch(e){}return t.miniObjectID&&(r.mini_object_id=t.miniObjectID),p.abrupt("break",33);case 14:return n=!0,p.next=17,processDrawImage(t);case 17:return r.options=p.sent,p.abrupt("break",33);case 19:return n=!0,p.next=22,processDrawImage(t,!0);case 22:return r.multi_image_options=p.sent,p.abrupt("break",33);case 24:return n=!0,p.next=27,processDrawImage(t);case 27:return r.options=p.sent,t.thirdPartyOpenType&&(r.open_type=t.thirdPartyOpenType),p.abrupt("break",33);case 30:return r.excluded_types=t.excludeShareChoices,p.abrupt("break",33);case 32:return p.abrupt("break",33);case 33:if(i=this.getShareForm.call(t,e),o=[g.a.COMMAND,g.a.TEXT].indexOf(i)>=0,this.targetShareURL=t.shareURL,this.realShareURL=t.shareURL,this.useShortURL=!1,e===_.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=r.mini_object_path),Object(ee.a)(e)&&(s=Object(b.b)(e,t.shareURL),r.share_url=s,this.shareURL=s,this.realShareURL=s,this.targetShareURL=s),e===_.a.WECHAT_SESSION&&r.mini_object_path&&(this.realShareURL=this.targetShareURL=r.mini_object_path),i!==g.a.CARD&&i!==g.a.WXAPP_CARD||!t.urlWrapType){p.next=45;break}return p.abrupt("return",getWrappedShareURLInfo(t).then((function(e){var a=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,o=e.tpDowngrade,s=e.tpInfo,h=e.tpInfos,p=e.appendQuery,u=e.categoryShareInfo,l=e.useCipher,_=e.missed;return l?Promise.reject(new Error("operation refused")):(_||(c.useShortURL=i,c.realShareURL=a,c.targetShareURL=n),r.share_url=a,s&&(r.title=s.title||r.title,r.desc=s.message||r.desc),u&&(r.title=u.title||r.title,r.thumbnail=u.thumbnailURL||r.thumbnail),r.tpInfo=s,r.tpInfos=h,r.tpDowngrade=o,t.urlWrapType===j.a.SERVER_QUERY_APPEND&&"string"==typeof r.mini_object_path&&r.mini_object_path&&(r.mini_object_path=Object(k.a)({"miniObjectPath":r.mini_object_path,"shareURL":a},{"appendQuery":p}),c.realShareURL=r.mini_object_path),r)})));case 45:if(!n||!Object(j.c)(t.urlWrapType)&&t.urlWrapType!==j.a.MAGIC_TRACE&&t.urlWrapType!==j.a.MAGIC_TRACE_DYNAMIC){p.next=49;break}return p.abrupt("return",getWrappedShareURLInfo(t).then(Object(v.a)(m.a.mark((function _callee(){var e,a,n,i,o,s=arguments;return m.a.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:{},a=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,o=e.shareText,c.targetShareURL=n,t.shortCommandApi?(c.pcode=o,r.share_url=o):(c.useShortURL=i,c.realShareURL=a,r.share_url=i?Object($.a)(a):a),!i){h.next=16;break}if(!r.multi_image_options){h.next=11;break}return h.next=8,processDrawImage(t,!0,e);case 8:r.multi_image_options=h.sent,h.next=16;break;case 11:if(!r.options){h.next=16;break}return h.next=14,processDrawImage(t,!1,e);case 14:r.options=h.sent,r.options&&"object"===Object(I.a)(r.options)&&r.options.$params&&(Object.assign(r,r.options.$params),delete r.options.$params);case 16:return h.abrupt("return",r);case 17:case"end":return h.stop()}}),_callee)})))));case 49:if(!o){p.next=60;break}if(h=r.title||"",!Object(j.c)(t.urlWrapType)){p.next=55;break}return p.abrupt("return",getWrappedShareURLInfo(t).then((function(e){var a=e.realShareURL,n=e.targetShareURL,i=e.useShortURL,o=e.shareText,s=e.shareID,p=e.cipher;if(s&&(r.shareID=s),p&&(r.cipher=p),c.targetShareURL=n,t.shortCommandApi){var u=i||p?o:"",l=u||n;h=Object(T.b)(h,l,n,u),r.title=r.desc=h,c.pcode=h}else{var _=i?a:"",S=_||n;h=Object(T.b)(h,S,n,_),r.title=r.desc=h,c.useShortURL=i,c.realShareURL=S}return cipherProcess(r,t)})));case 55:return h=Object(T.b)(h,t.shareURL),r.title=r.desc=h,p.abrupt("return",cipherProcess(r,t));case 58:p.next=61;break;case 60:return p.abrupt("return",Promise.resolve(r));case 61:case"end":return p.stop()}}),_callee2,this)}))),function normalize(e){return t.apply(this,arguments)})},{"key":"getShareForm","value":function getShareForm(e){return e===_.a.WECHAT_SESSION?this.miniObjectPath||this.useWxAppShare?g.a.WXAPP_CARD:g.a.CARD:[4,2,5,6,24,25].includes(e)?g.a.CARD:[8,9,10,11,12,13,15,19,20,22].includes(e)?g.a.IMAGE:[3,16,17,21,_.a.COPY_CIPHER].includes(e)?this.shortCommandApi?g.a.COMMAND:g.a.TEXT:e===_.a.COPY_LINK?g.a.COPY_LINK:g.a.DEFAULT}},{"key":"getShareMethod","value":function getShareMethod(e){return[9,16,19,20].includes(e)?y.a.SYSTEM:[1,2,3,4,5,8,10,11,12,13,15,17,21,24,25].includes(e)?y.a.SDK:e===_.a.SHARE_IMAGE_PASSIVELY?this.thirdPartyOpenType?y.a.MANUAL:y.a.DEFAULT:e===_.a.COPY_CIPHER?y.a.MANUAL:y.a.DEFAULT}}]),NativeShareEntity}(T.a),oe=r("A4fa"),se=r("WiBJ");function getContent(){return Object(c.a)().isNativePlatform?new Promise((function(e,t){Object(u.z)("JSStorage","getPasteboard",null).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(t.text)}))})):Promise.reject()}function setContent(e){return"string"!=typeof e?Promise.reject():Object(c.a)().isNativePlatform?Object(u.z)("JSStorage","setPasteboard",{"text":e}):Promise.reject()}var he=r("KxTr"),ce=Object.keys(_.a).map((function(e){return _.a[e]})).filter((function(e){return[_.a.WECHAT_BIG_IMAGE].indexOf(e)<=0})),pe=function(e){Object(s.a)(NativeShareController,e);var t=Object(h.a)(NativeShareController);function NativeShareController(e){var r;return Object(a.a)(this,NativeShareController),(r=t.call(this,e)).ShareEntityClass=ie,r._enableShareTypes=ce.concat(),r.shareLimiter=getInstance(),r._isEnableShareCheck=!1,r.setShareCheck(!0),r}return Object(n.a)(NativeShareController,[{"key":"setShareCheck","value":function setShareCheck(e){Object(c.a)().isTinyNativePlatform?this._isEnableShareCheck=!0:this._isEnableShareCheck=!!e&&Object(S.h)()}},{"key":"checkShareTypeEnable","value":function checkShareTypeEnable(e){var t=this.getShareEntityByShareType(e);if(!this.validateShareParams(e,t))return E.a.SHARE_PARAMS_NOT_VALID;if(!Object(S.d)(e)||this._enableShareTypes.indexOf(e)<0)return E.a.SHARE_TYPE_DISABLED;if(this._isEnableShareCheck&&[_.a.COPY_LINK,_.a.COPY_CIPHER].indexOf(e)<0){var r=this.shareLimiter.checkSync(e,t);if(r)return r}return 0}},{"key":"share","value":function share(e){var t=this.checkShareTypeEnable(e);return t||(e===_.a.PIN_TIMELINE?this._sharePinTimeline(e):e===_.a.WECHAT_BIG_IMAGE?this._nativeShareBigImage(e):[_.a.WECHAT_SESSION,_.a.WECHAT_TIMELINE,_.a.WEIBO,_.a.QQ_CHAT_SESSION,_.a.QQ_ZONE,_.a.TENCENT_WEIBO,_.a.WECHAT_SESSION_APP,_.a.FRIENDS,_.a.WECHAT_SESSION_MUSIC,_.a.WECHAT_SESSION_VIDEO].indexOf(e)>=0?this._nativeShareCard(e):[_.a.WECHAT_TIMELINE_IMAGE,_.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK,_.a.WECHAT_SESSION_IMAGE,_.a.QQ_CHAT_SESSION_IMAGE,_.a.QQ_ZONE_IMAGE,_.a.WEIBO_IMAGE,_.a.WECHAT_SESSION_IMAGE_WITH_NO_SDK,_.a.SHARE_IMAGE_PASSIVELY].indexOf(e)>=0?this._nativeShareImage(e):[_.a.WECHAT_SESSION_TEXT_WITH_NO_SDK,_.a.WECHAT_SESSION_TEXT,_.a.WECHAT_TIMELINE_TEXT].indexOf(e)>=0?this._nativeShareText(e):_.a.COPY_LINK===e?this._nativeShareClipboard(e):_.a.COPY_CIPHER===e?this.copyCipher():E.a.SHARE_TYPE_NOT_FOUND)}},{"key":"validateShareParams","value":function validateShareParams(e){return!0}},{"key":"_setupShareTypes","value":function _setupShareTypes(){}},{"key":"resetLimiter","value":function resetLimiter(){return this.shareLimiter.reset(),this._queryShareTypePromise=null,this.waitShareLimiter()}},{"key":"refreshShare","value":function refreshShare(e,t){var r=Object(i.a)(Object(o.a)(NativeShareController.prototype),"refreshShare",this).call(this,e,t);return this.emit(f.a.ON_SHARE_PREPARE,{"shareType":t}),r}},{"key":"_setupPlatformShareSDK","value":function _setupPlatformShareSDK(){return this.waitShareLimiter()}},{"key":"waitShareLimiter","value":function waitShareLimiter(){var e=this;return this._isEnableShareCheck?(this._queryShareTypePromise||(this._queryShareTypePromise=this.shareLimiter.build().catch((function(t){return e.emit(f.a.SHARE_LIMIT_LOAD_FAIL),Promise.resolve()}))),this._queryShareTypePromise):Promise.resolve()}},{"key":"_nativeShareCard","value":function _nativeShareCard(e){var t=this;this.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e});var r=this.getShareEntityByShareType(e);return r.normalize(e).then((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.tpInfo,i=a.tpInfos,o=a.tpDowngrade;if(delete a.tpInfo,delete a.tpInfos,delete a.tpDowngrade,o)t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.FAIL,"tpDowngrade":!0,"tpInfo":n});else{var s=Object.assign({"type":e,"redirect_uri":r.redirectURI||"","share_params":a,"share_method":Object(se.a)(r,e)});r.needSharedAmount&&(s.show_check_detail=1),n&&n.dev_type&&(s.dev_app=n.dev_app,s.dev_type=n.dev_type),i&&(s.dev_infos=i),t._invokeNativeShare(s,(function(r){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.SUCCESS,"responseData":r,"tpInfo":n})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0,i=a===S.c.USER_CANCEL?d.a.CANCEL:d.a.FAIL;t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":i,"nativeShareErrorCode":a,"responseData":r.data,"tpInfo":n})}))}}),this.getNormalizeErrorHandler(e)),0}},{"key":"_nativeShareImage","value":function _nativeShareImage(e){var t=this;this.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e});var r=this.getShareEntityByShareType(e),a=e;return r.normalize(e).then((function(n){var i={"type":a,"share_params":n,"share_method":Object(se.a)(r,e)},o=!1;a===_.a.WECHAT_TIMELINE_IMAGE_WITH_NO_SDK&&(i.complete=function(){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"useComplete":!0,"shareResultType":d.a.SUCCESS})},o=!0),t._invokeNativeShare(i,(function(r){!o&&t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.SUCCESS,"responseData":r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10),n=a===S.c.USER_CANCEL?d.a.CANCEL:d.a.FAIL;!o&&t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":n,"nativeShareErrorCode":a,"responseData":r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{"key":"_nativeShareText","value":function _nativeShareText(e){var t=this,r=this.getShareEntityByShareType(e),a=r.cipherScene&&"string"==typeof r.cipher;!a&&this.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e});var n=e;return r.normalize(e).then((function(i){a&&(t.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e,"shareID":i.shareID}),delete i.shareID);var o=Object.assign({"type":n,"share_params":i,"share_method":Object(se.a)(r,e)}),s=!1;if(r.forceDowngrade||Object(c.a)().system===p.b.IOS&&n===_.a.WECHAT_SESSION_TEXT_WITH_NO_SDK)return t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.FAIL,"shareParams":i}),0;Object(c.a)().system===p.b.Android&&n===_.a.WECHAT_SESSION_TEXT_WITH_NO_SDK&&(o.complete=function(){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"useComplete":!0,"shareResultType":d.a.SUCCESS})},s=!0),t._invokeNativeShare(o,(function(r){!s&&t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.SUCCESS,"responseData":r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0,n=a===S.c.USER_CANCEL?d.a.CANCEL:d.a.FAIL;!s&&t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":n,"nativeShareErrorCode":a,"responseData":r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{"key":"_nativeShareBigImage","value":function _nativeShareBigImage(e){return E.a.SHARE_TYPE_DISABLED}},{"key":"_nativeShareClipboard","value":function _nativeShareClipboard(e){var t=this;this.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e});var r=this.getShareEntityByShareType(e);return r.normalize(e).then((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.share_url||r.shareURL;getContent().then(null,(function(){return Promise.resolve("")})).then((function(r){setContent(n).then((function(){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.SUCCESS,"content":n,"originContent":r})}),(function(){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.FAIL,"content":n,"originContent":r})}))}))}),this.getNormalizeErrorHandler(e)),0}},{"key":"_sharePinTimeline","value":function _sharePinTimeline(e){var t=this;return this.emit(f.a.ON_SHARE_TRIGGER,{"shareType":e}),this.getShareEntityByShareType(e).normalize(e).then((function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({"type":e,"share_params":r});t._invokeNativeShare(a,(function(r){t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.SUCCESS,"responseData":r})}),(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=parseInt(r.errorCode,10)||0;t.emit(f.a.ON_SHARE_COMPLETED,{"shareType":e,"shareResultType":d.a.FAIL,"nativeShareErrorCode":a,"responseData":r.data})}))}),this.getNormalizeErrorHandler(e)),0}},{"key":"setupNativeShareButton","value":function setupNativeShareButton(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.shareIcon,a=void 0===r?S.a:r,n=t.shareIconSize,i=void 0===n?S.b:n;return"string"!=typeof a||"number"!=typeof i?E.a.SHARE_PARAMS_NOT_VALID:(Object(u.z)("JSUIControl","setRightBarButtons",{"buttons":[{"icons":{"normal":a},"callback":function callback(){e.emit(f.a.ON_SHARE_BUTTON_CLICKED)},"size":i}]}).catch((function(e){})),0)}},{"key":"_invokeNativeShare","value":function _invokeNativeShare(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=Object(S.g)(),n="share",i=Object(A.e)()+"";this._isEnableShareCheck?(e=Object.assign({"origin":"h5","page_sn":i,"page_info":{"page_name":Object(A.d)(),"page_url":location&&location.href}},e),this.shareLimiter.getAppOptional()&&(e.app_optional=this.shareLimiter.getAppOptional()),n="performShare"):e.page_sn=i,Object(u.z)(a,n,e).then(t,r)}},{"key":"shareCipherManually","value":function shareCipherManually(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:oe.a.OPEN_WECHAT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.a.DEFAULT;return e&&"string"==typeof e?Object(S.e)()?(t!==oe.a.OPEN_WECHAT&&t!==oe.a.OPEN_WECHAT_IOS_SILENT&&t!==oe.a.OPEN_WECHAT_ANDROID_SILENT||(t=Object(S.f)()&&this.shareLimiter.isSilentMode?Object(c.a)().system===p.b.IOS?oe.a.OPEN_WECHAT_IOS_SILENT:oe.a.OPEN_WECHAT_ANDROID_SILENT:oe.a.OPEN_WECHAT),Object(u.z)(Object(S.g)(),"shareCipher",{"cipher":e,"open_type":t,"paste_type":r})):Promise.reject(new Error("not support")):Promise.reject(new Error("invalid cipher"))}}]),NativeShareController}(l.a);t.default=pe}}]);
//# sourceMappingURL=http://vgunxpkt.com/sourcemaps/mobile-farm/js/ms_native_c_b8a41dd76f398cb9e1ec.js.map