function GetResultBySquareFormula(e,t,i,n){var o=1-e,a=e*e,s=o*o,r=s*t+2*o*e*i+a*n;return r}function GetResultByCubicFormula(e,t,i,n,o){var a=1-e,s=t*Mathf.Pow(a,3)+3*i*e*Mathf.Pow(a,2)+3*n*Mathf.Pow(e,2)*a+o*Mathf.Pow(e,3);return s}function CalculateSquareBezierPoint(e,t,i,n){var o=GetResultBySquareFormula(e,t.x,i.x,n.x),a=GetResultBySquareFormula(e,t.y,i.y,n.y);return Vector2.New(o,a)}function CalculateCubicBezierPoint(e,t,i,n,o){var a=GetResultByCubicFormula(e,t.x,i.x,n.x,o.x),s=GetResultByCubicFormula(e,t.y,i.y,n.y,o.y);return Vector2.New(a,s)}function __(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=xyd.__.apply(this,e);return i}var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n["throw"](e))}catch(t){a(t)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,r)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(s=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(n){i=[6,n],a=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,a,s,r,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},DPack=function(){function e(e,t,i){this._isDone=!1,this._isInstant=!1,this._numFrames=0,this._allElements=[],this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[],this._shouldRefuelToRocket=!1,this._board=e,this._initElement=t,this._swap=i,this._type=MatchConstants.DP_NONE}return e.prototype.setup=function(){this._initCol=this._initElement.col,this._initRow=this._initElement.row},e.prototype.update=function(){},e.prototype.getElementsToRemove=function(){return this._affectedElements},e.prototype.getBlockersToRemove=function(){return this._affectedBlockers},e.prototype.getAffectedLocs=function(){return this._affectedLocs},e.prototype.getAllElements=function(){return this._allElements},e.prototype.isDone=function(){return this._isDone},e.prototype.isInstant=function(){return this._isInstant},e.prototype.getNextElement=function(){return this._nextEle},e.prototype.setSwap=function(e){this._swap=e},e.prototype.getSwap=function(){return this._swap},e.prototype.getType=function(){return this._type},e.prototype.shouldRefuelToRocket=function(){return this._shouldRefuelToRocket},e}();__reflect(DPack.prototype,"DPack",["IDPack"]);var BaseClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;if(!i._instance){var n=e.length;0==n?i._instance=new i:1==n?i._instance=new i(e[0]):2==n?i._instance=new i(e[0],e[1]):3==n?i._instance=new i(e[0],e[1],e[2]):4==n?i._instance=new i(e[0],e[1],e[2],e[3]):5==n&&(i._instance=new i(e[0],e[1],e[2],e[3],e[4]))}return i._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var BitmapNumber=function(e){function t(){var t=e.call(this)||this;return t._imgPool=[],t._containerPool=[],t}return __extends(t,e),t.prototype.createNumPic=function(e,t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var o=this.getContainer(),a=e.toString();i&&(a=this.getDisplayNumber(e)),n&&(a=e>=0?"+"+a:a);var s,r=0;for(r;r<a.length;r++)s=this.getSingleNumPic(a.charAt(r),t),o.addChild(s);return this.repositionNumPic(o),o},t.prototype.createNumPicWithPunctuation=function(e,t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var o=this.getContainer(),a=e;i&&(a=this.getDisplayNumber(e));var s,r=0;for(r;r<a.length;r++)s=this.getSingleNumPic(a.charAt(r),t),o.addChild(s);return this.repositionNumPic(o),o},t.prototype.getDisplayNumber=function(e){if(null==e||e==1/0)return"";for(var t="";e>=1e3;)t=","+(e%1e3+1e3).toString().substr(1,3)+t,e=Math.floor(e/1e3);return e+t},t.prototype.setNumGap=function(e,t){for(var i,n=0;n<e.numChildren;n++)i=e.getChildAt(n),i.x+=n*t},t.prototype.destroyNumPic=function(e){void 0!=e&&(e.scaleX=1,e.scaleY=1,e.alpha=1,this.clearContainer(e),e.parent&&e.parent.removeChild(e))},t.prototype.changeNum=function(e,t,i,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=!1),void 0!=e){var a=t.toString();n&&(a=this.getDisplayNumber(t)),o&&(a=t>=0?"+"+a:a);if(e.numChildren>a.length)for(;e.numChildren>a.length;)this.recycleBM(e.getChildAt(e.numChildren-1));var s,r=0;for(r;r<a.length;r++)r>=e.numChildren&&e.addChild(this.getBitmap()),s=a.charAt(r),this.setSingleNumPic(e.getChildAt(r),s,i);this.repositionNumPic(e)}},t.prototype.changeNumWithPunctuation=function(e,t,i,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var a=t;n&&(a=this.getDisplayNumber(t));if(e.numChildren>a.length)for(;e.numChildren>a.length;)this.recycleBM(e.getChildAt(e.numChildren-1));var s,r=0;for(r;r<a.length;r++)r>=e.numChildren&&e.addChild(this.getBitmap()),s=a.charAt(r),s="."==s?"dot":s,s=":"==s?"colon":s,e.getChildAt(r).texture=this.getTexture(s,i);this.repositionNumPic(e)},t.prototype.repositionNumPic=function(e){var t,i=0,n=0;for(i;i<e.numChildren;i++)t=e.getChildAt(i),t.x=n,n=t.x+t.width},t.prototype.clearContainer=function(e){for(;e.numChildren;)this.recycleBM(e.removeChildAt(0))},t.prototype.recycleBM=function(e){e&&e.parent&&(e.parent.removeChild(e),e.texture=null,this._imgPool.push(e))},t.prototype.getContainer=function(){return this._containerPool.length?this._containerPool.shift():new egret.DisplayObjectContainer},t.prototype.setSingleNumPic=function(e,t,i){"."==t?t="dot":","==t?t="comma":"+"==t?t="positive":"-"==t?t="negative":":"==t&&(t="colon"),e.texture=this.getTexture(t,i)},t.prototype.getSingleNumPic=function(e,t){"."==e?e="dot":","==e?e="comma":"+"==e?e="positive":"-"==e?e="negative":":"==e&&(e="colon");var i=this.getBitmap();return i.texture=this.getTexture(e,t),i},t.prototype.getTexture=function(e,t){var i=t+e+"_png";return RES.getRes(i)},t.prototype.getBitmap=function(){return this._imgPool.length?this._imgPool.shift():new egret.Bitmap},t.prototype.getWidth=function(e){return e.width*e.scaleX},t.prototype.getHeight=function(e){return e.height*e.scaleY},t}(BaseClass);__reflect(BitmapNumber.prototype,"BitmapNumber");var GameMode=function(){function e(){this._autoWin=!1,this._movesUsed=0,this._modeplugins=[],this._gameEndInfo={},this._initMissionHandler()}return e.prototype._initMissionHandler=function(){var e=SelfInfo.get(),t=e.getGatherTaskInfo();void 0!=t&&(this._collectMissionHandler=new CollectMissionHandler,this._collectMissionHandler.initSaveData())},e.prototype.saveModeInfo=function(e,t,i,n){this._gameEndInfo[GameEndInfo.CHAPTER]=e,this._gameEndInfo[GameEndInfo.LEVEL]=t,this._gameEndInfo[GameEndInfo.TOTAL_LEVEL]=i,this._gameEndInfo[GameEndInfo.MODE]=n},e.prototype.setBoard=function(e){this._board=e,this._gameCountHandler=new GameCountHandler(this._board)},e.prototype.setMovesLeft=function(e){this._movesLeft=e},e.prototype.setMovesUsed=function(e){this._movesUsed=e},e.prototype.setAutoWin=function(){this._autoWin=!0,this._gameEndInfo[GameEndInfo.END_REASON]=GameEndReason.Victory},e.prototype.addModePlugins=function(){},e.prototype.checkIfGameEnd=function(){if(this._autoWin)return!0;for(var e=!0,t=0,i=this._modeplugins;t<i.length;t++){var n=i[t];n.checkIfGameEnd()||(e=!1)}if(e&&this._modeplugins.length>0)return!0;if(0==this._modeplugins.length){var o=this._scoreHandler.getScore(),a=this._scoreHandler.getScoreTargets(),s=a[2];if(o>=s)return!0}return this._movesLeft<=0?!0:!1},e.prototype.modeName=function(){},e.prototype.isMixedMode=function(){return this._modeplugins&&this._modeplugins.length>1?!0:!1},e.prototype.createGameView=function(e){var t=new GameView(this,e);return t},e.prototype.getMovesLeft=function(){return this._movesLeft},e.prototype.getMovesUsed=function(){return this._movesUsed},e.prototype.addExtraMoves=function(e){this._movesLeft+=e,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STEP,!0,!1,{step:this._movesLeft})),this.checkWandHint()},e.prototype.removeMoves=function(){this._movesLeft--,this._movesUsed++,this._movesLeft>=0&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STEP,!0,!1,{step:this._movesLeft}))},e.prototype.checkGameStatus=function(){if(this.isStable()){if(this._autoWin)return GameEndReason.Victory;for(var e=this._scoreHandler,t=0,i=this._modeplugins;t<i.length;t++){var n=i[t],o=n.checkGameEndStatus();if(o!=GameEndReason.Victory)return this._gameEndInfo[GameEndInfo.END_REASON]=o,o}return 0==this._modeplugins.length&&e.getScore()<e.getLowestScoreTarget()?(this._gameEndInfo[GameEndInfo.END_REASON]=GameEndReason.ScoreTooLow,GameEndReason.ScoreTooLow):(this._gameEndInfo[GameEndInfo.END_REASON]=GameEndReason.Victory,GameEndReason.Victory)}},e.prototype.setScoreHandler=function(e){this._scoreHandler=e},e.prototype.setGameCountHandler=function(e){this._gameCountHandler=e},e.prototype.initPlugins=function(e){for(var t=0,i=this._modeplugins;t<i.length;t++){var n=i[t];n.init(e)}},e.prototype.createElementsView=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.createElementsView()}},e.prototype.updateElementsInPlugin=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.updateElements()}},e.prototype.calculateElementScore=function(e){for(var t=0,i=0,n=this._modeplugins;i<n.length;i++)for(var o=n[i],a=0,s=e;a<s.length;a++){var r=s[a];t+=o.calculateElementScore(r.col,r.row)}return t},e.prototype._saveMoveInfo=function(){this._gameEndInfo[GameEndInfo.MOVES_LEFT]=this._movesLeft,this._gameEndInfo[GameEndInfo.MOVES_USED]=this._movesUsed},e.prototype._saveMonthCardInfo=function(){void 0!=this._gameCountHandler&&(this._gameEndInfo[GameEndInfo.GAME_COUNT]=this._gameCountHandler.getGameCountInfo())},e.prototype._saveSpecialDrops=function(){void 0!=this._gameCountHandler&&(this._gameEndInfo[GameEndInfo.SPECIAL_DROPS]=this._gameCountHandler.getGameCountInfo().special_drops)},e.prototype.saveScoreInfo=function(e){var t=this._scoreHandler;this._gameEndInfo[GameEndInfo.SCORE]=t.getScore();var i=t.getScore(),n=t.getScoreTargets(),o=n[0];i<n[0]?e?(this._gameEndInfo[GameEndInfo.SCORE]=o,this._gameEndInfo[GameEndInfo.STARS]=1,t.setScore(o)):this._gameEndInfo[GameEndInfo.STARS]=0:i<n[1]?this._gameEndInfo[GameEndInfo.STARS]=1:i<n[2]?this._gameEndInfo[GameEndInfo.STARS]=2:this._gameEndInfo[GameEndInfo.STARS]=3,this._gameEndInfo[GameEndInfo.LOWEST_SCORE_TARGET]=o,this._saveMoveInfo(),this._saveMissionInfo(),this._savePluginInfo(),this._saveMonthCardInfo(),this._saveSpecialDrops()},e.prototype._saveMissionInfo=function(){var e=SelfInfo.get().getGatherTaskInfo();if(void 0!=e){var t=e.target_item;if(void 0!=this._collectMissionHandler&&void 0!=t){var i=this._collectMissionHandler.getGatheredNum(t)||0;this._gameEndInfo[GameEndInfo.GATHER_TASK]={target_item:t,gathered_num:i}}}},e.prototype.getGameEndInfo=function(){return this._gameEndInfo},e.prototype.dispose=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.dispose()}void 0!=this._collectMissionHandler&&this._collectMissionHandler.dispose(),void 0!=this._gameCountHandler&&this._gameCountHandler.dispose()},e.prototype.isStable=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];if(!i.isStable())return!1}return!0},e.prototype.getSaveData=function(e){for(var t={},i=0,n=this._modeplugins;i<n.length;i++){var o=n[i];o.getSaveData(t,e)}return this._collectMissionHandler&&this._collectMissionHandler.getSaveData(t,e),this._gameCountHandler&&this._gameCountHandler.getSaveData(t,e),t},e.prototype.setSaveData=function(e){if(e){for(var t=0,i=this._modeplugins;t<i.length;t++){var n=i[t];n.setSaveData(e)}this._collectMissionHandler&&this._collectMissionHandler.setSaveData(e),this._gameCountHandler&&(this._gameCountHandler.setSaveData(e),this._gameCountHandler.initSaveData())}},e.prototype._savePluginInfo=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.savePluginData()}},e.prototype.getCollectNum=function(e){return this._collectMissionHandler?this._collectMissionHandler.getGatheredNum(e):0},e.prototype.checkHammerHint=function(){if(this._movesLeft<=3)for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.checkHammerHint()}},e.prototype.checkWandHint=function(){if(this._movesLeft<=5&&!this.isMixedMode()&&!this.checkIfGameEnd()){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];i.checkWandHint()}this._modeplugins&&0==this._modeplugins.length&&this._checkWandHintForClassicMoves()}},e.prototype._checkWandHintForClassicMoves=function(){var e=this._board.getScoreTargets();if(e&&0!=e.length){var t=e[0];if(!(this._scoreHandler.getScore()>=t)){for(var i=new WandTargetManager(this._board,!0).getWandTargets(),n={},o={},a=[{col:1,row:0},{col:1,row:1},{col:1,row:-1},{col:-1,row:0},{col:-1,row:1},{col:-1,row:-1},{col:0,row:1},{col:0,row:-1}],s=0;s<i.length;++s){var r=i[s],l=r.getGridContainer(),_=l.getCol(),h=l.getRow(),c=void 0,d=!1,p=[-1,0,1];if(h+1<=this._board.getBoardRows())for(var u=0,m=p;u<m.length;u++){var g=m[u],f=this._board.getElementAtGrid(_+g,h+1),y=this._board.getBlockerAtGrid(_+g,h+1),E=this._board.isVoidCell(_+g,h+1);E||null!=f||null!=y||(d=!0)}if(!d){o["col"+_.toString()+"row"+h.toString()]=ScoreConstants.ELEMENET_IN_DP_LINE;for(var v=0,T=a;v<T.length;v++){var C=T[v];c=this._board.getElementAtGrid(_+C.col,h+C.row),c&&(n["col"+(_+C.col).toString()+"row"+(h+C.row).toString()]=ScoreConstants.ELEMENET_IN_DP_LINE)}}}var L=0;for(var b in o)L+=o[b];for(var b in n)L+=n[b];this._scoreHandler.getScore()+L>=t&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_WAND_HINT))}}},e.prototype.hasLeaf=function(){return this.modeName()==GameModeConstants.LEAF||this.modeName()==GameModeConstants.LEAF_OBJECTIVE||this.modeName()==GameModeConstants.LEAF_LAMP},e.prototype.hasObjectiveMode=function(){return this.modeName()==GameModeConstants.OBJECTIVE||this.modeName()==GameModeConstants.LEAF_OBJECTIVE},e.prototype.ModePlugins=function(){return this._modeplugins},e}();__reflect(GameMode.prototype,"GameMode",["IGameMode"]);var SpecialSwap=function(){function e(e){this._board=e}return e.prototype.doSwap=function(e){},e.prototype.setDPack=function(e,t){e.destructionPack=t},e.prototype.getName=function(){return this.name},e}();__reflect(SpecialSwap.prototype,"SpecialSwap");var DPackColor=function(e){function t(i,n,o){var a=e.call(this,i,n,o)||this;return a._lastOffset=0,a._color=0,a._framesPerRemove=-1,a._framesPostDone=-1,a._framestoRemove=7*xyd.frameScale,a._framesPostDoneMax=7*xyd.frameScale+9*xyd.frameScale,a._minNumToRemove=-1,a._maxNumToRemove=-1,a._framesToSwatchRemoveNum=-1,a._removalTimes=Math.floor(7*xyd.frameScale),a._initHoldFrames=Math.floor(17*xyd.frameScale),a._changeType=0,a._type=MatchConstants.DP_COLOR,a._changeType=t.CHANGE_TYPE.NORMAL,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);this._initCol,this._initRow;this._swap?(this._fromEle=this._board.getElementAtGrid(this._swap.fromColRow.x,this._swap.fromColRow.y),this._toEle=this._board.getElementAtGrid(this._swap.toColRow.x,this._swap.toColRow.y),this.sourceColor=this._fromEle.color,this._fromEle.type==ElementTypeConstants.BOMB_COLOR&&(this.sourceColor=this._toEle.color)):(this.sourceColor=this.getRandomColorInBoard(),this._initElement.shouldNotFall=!0),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_INIT,!1,{x:this._initCol,y:this._initRow,id:this._initElement.id})},t.prototype.getRandomColorInBoard=function(){for(var e=this._board.getAllElements(),t=e.length,i=e[this._board.random(0,t-1)],n=0;i.busy||0==i.color;)if(i=e[this._board.random(0,t-1)],n++,n>100)for(var o=0;t>o;o++)return!e[o].busy&&e[o].color>0?e[o].color:1;return i.color},t.prototype.update=function(){if(this._numFrames+=1,this._numFrames==this._initHoldFrames){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_BEGIN);for(var e=0;e<this._board.getBoardCols();e++)for(var i=0;i<this._board.getBoardRows();i++){var n=this._board.getIntergratedElementAt(e,i);!n||n.busy||n.inDpack||n.color!=this.sourceColor||n.col==this._initCol&&n.row==this._initRow||n.hasGiftWrapper()||(this._allElements.push(n),n.inDpack=!0,n.type==ElementTypeConstants.ROCKET&&(this._shouldRefuelToRocket=!0,n.inDpack=!1,this._board.hitEmptyCell(n.col,n.row)),this._changeType!=t.CHANGE_TYPE.NORMAL&&(n.shouldNotFall=!0))}this._allElements.sort(function(e,t){return e.y!=t.y?e.y-t.y:e.x-t.x});var o=this._allElements.length;this._framesPerRemove=Math.floor(3*xyd.frameScale),this._minNumToRemove=Math.floor(o/this._removalTimes),this._maxNumToRemove=this._minNumToRemove+1,this._framesToSwatchRemoveNum=(o-o%this._removalTimes*this._maxNumToRemove)*this._framesPerRemove+this._initHoldFrames,0==this._allElements.length&&(this._framesPostDone=this._framestoRemove,this._initElement.setDestroyFrames(this._framestoRemove),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_END,!1,{ele:this._initElement}))}if(!(this._numFrames<=this._initHoldFrames)){this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var a={},s=0;if(this._allElements.length>0&&this._numFrames%this._framesPerRemove==0){for(s=this._numFrames<this._framesToSwatchRemoveNum?this._minNumToRemove:this._maxNumToRemove;s>0&&this._allElements.length>0;){var n=this._allElements[0];if(this._affectedLocs.push({x:n.col,y:n.row}),n.type!=ElementTypeConstants.ROCKET)this._changeType==t.CHANGE_TYPE.NORMAL&&this.doNoramlChange(n,a);else{var r=n;r.isRegular()||r.rocketType==RocketConstants.SPECIAL_COLOR_BOMBED||r.consumeSpecialPower(),this._rocket=r}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:this._initCol,fromY:this._initRow,toX:n.x,toY:n.y}),this._allElements.splice(0,1),s-=1}0==this._allElements.length&&(this._framesPostDone=this._framesPostDoneMax)}this._framesPostDone>0?(this._framesPostDone-=1,this._framesPostDone==this._framestoRemove&&(this._initElement.setDestroyFrames(this._framestoRemove),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_END,!1,{ele:this._initElement}))):0==this._framesPostDone&&(this._isDone=!0)}},t.prototype.checkIsSwapElement=function(e){return this._fromEle.type==ElementTypeConstants.BOMB_COLOR?e==this._toEle?!0:!1:e==this._fromEle?!0:!1},t.prototype.changeRocket=function(e){this._changeType==t.CHANGE_TYPE.BMOB_LINE?0==this._board.random(0,1)?e.setSpecialPower(RocketConstants.SPECIAL_STRIPED_COLUMN):e.setSpecialPower(RocketConstants.SPECIAL_STRIPED_LINE):this._changeType==t.CHANGE_TYPE.BOMB_SQURE&&e.setSpecialPower(RocketConstants.SPECIAL_WRAPPED)},t.prototype.doNoramlChange=function(e,t){this._affectedElements.push(e);var i=this._board.getCellEdgesAtGrid(e.col,e.row);if(i)for(var n=0;n<xyd.directions.length;n++){var o=this._board.getCellFenceAtGridInDir(i.Col,i.Row,n);void 0!=o&&this._affectedBlockers.push(o)}if(!e.isLocked())for(var a=0,s=this._board.getBlockerAroundGrid(e.col,e.row);a<s.length;a++){var r=s[a];if(r.isLocked()){var l=r.getLock();if(l.type!=LOCK_TYPE.ICE)continue}r.col>e.col&&this._board.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.RIGHT)||r.col<e.col&&this._board.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.LEFT)||r.row<e.row&&this._board.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.UP)||r.row>e.row&&this._board.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.DOWN)||t[r.id]||r.type!=BlockerConstant.PUZZLE&&(t[r.id]=!0,this._affectedBlockers.push(r))}},t.prototype.doLineChange=function(e){var t;if(this._board.removeLock(e),0==this._board.random(0,1)){t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_ROW),t.id=e.id;var i=new DPackRow(this._board,t,this._swap);t.destructionPack=i,this._board.replaceBoardElement(t)}else{t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_COL),t.id=e.id;var i=new DPackCol(this._board,t,this._swap);t.destructionPack=i,this._board.replaceBoardElement(t)}return t},t.prototype.doSqureChange=function(e){var t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_SQUARE);t.id=e.id,this._board.removeLock(e);var i=this._board.getElementFactory().create(t.col,t.row,t.color,ElementTypeConstants.NORMAL);return i.setUnstable(),i.destructionPack=new DPackBomb(this._board,i,void 0,3),t.destructionPack=new DPackBomb(this._board,t,i,3),this._board.replaceBoardElement(t),t},t.prototype.doTornadoChange=function(e){var t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.TORNADO);return t.id=e.id,this._board.removeLock(e),this._board.replaceBoardElement(t),t},t.CHANGE_TYPE={NORMAL:1,BMOB_LINE:2,BOMB_SQURE:3,BOMB_TORNADO:4},t}(DPack);__reflect(DPackColor.prototype,"DPackColor");var Blocker=function(){function e(e,t,i){this._busy=!1,this._isDead=!1,this._health=1,this._removeFrames=-1,this._shieldFrames=0,this._isCreatedByColorMixer=!1,this._col=e,this._row=t,this._type=i}return e.prototype.update=function(){this._removeFrames>0?this._removeFrames-=1:(this._busy=!1,this._isDead=!1),this._shieldFrames>0&&this._shieldFrames--},e.prototype.canBeAffectByNearElement=function(){return!0},e.prototype.canBeAffectedByMatch=function(){return!0},e.prototype.canBeDestroyed=function(){return!0},e.prototype.canBeDestroyedByItem=function(){return!0},e.prototype.shouldRemove=function(){return this._health<=0&&0==this._removeFrames},e.prototype.prepareForRemoval=function(){this._removeFrames=0,this._busy=!0},Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return this._busy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"health",{get:function(){return this._health},set:function(e){this._health=e},enumerable:!0,configurable:!0}),e.prototype.applyDamage=function(e,t){this.canBeDestroyed()&&(this._health>0&&(this._health-=e),this._health<0&&(this._health=0))},Object.defineProperty(e.prototype,"isDead",{get:function(){return this._isDead},set:function(e){this._isDead=e},enumerable:!0,configurable:!0}),e.prototype.addLock=function(e){e.col=this._col,e.row=this._row,this._lock=e},e.prototype.isLocked=function(){return void 0==this._lock?!1:this._lock.isLocked()},e.prototype.breakLock=function(){return this._lock&&(this._lock["break"](),!this._lock.isLocked())?(this._lock=void 0,!0):!1},e.prototype.hasGiftWrapper=function(){return void 0==this._lock?!1:this._lock.type==LOCK_TYPE.GIFT_WRAPPER&&this._lock.isLocked()},e.prototype.cutGiftWrapper=function(){this._lock&&(this._lock.cutGiftWrapper(),this._lock.isLocked()||(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,this._lock),this._lock=void 0))},e.prototype.getLock=function(){return this._lock},e.prototype.getNextElement=function(){return this._nextElement},e.prototype.setNextElement=function(e){this._nextElement=e},e.prototype.dataToCell=function(e){e.setProperty(TypeConverter.getCellPropertyForBlocker(this))},e.prototype.canBeAttackedByRocket=function(){return!1},e.prototype.hasShield=function(){return this._shieldFrames>0},Object.defineProperty(e.prototype,"shieldFrames",{set:function(e){this._shieldFrames=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCreatedByColorMixer",{get:function(){return this._isCreatedByColorMixer},set:function(e){this._isCreatedByColorMixer=e},enumerable:!0,configurable:!0}),e}();__reflect(Blocker.prototype,"Blocker",["IBlocker"]);var starlingswf;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getTextField=function(e){return this.getChildByName(e)},t.prototype.getMovie=function(e){return this.getChildByName(e)},t.prototype.getSprite=function(e){return this.getChildByName(e)},t.prototype.getImage=function(e){return this.getChildByName(e)},t}(egret.DisplayObjectContainer);e.SwfSprite=t,__reflect(t.prototype,"starlingswf.SwfSprite")}(starlingswf||(starlingswf={}));var ColorLineSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_LINE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=t.color;t.type==ElementTypeConstants.BOMB_COLOR?(n=i.color,t.destructionPack=new DPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BMOB_LINE),t.setDestroyFrames(60*xyd.frameScale),t.shouldNotFall=!0,this._board.addForRemoval(t),i.setMatchable(!1)):(i.destructionPack=new DPackColorSpecial(this._board,i,e,DPackColor.CHANGE_TYPE.BMOB_LINE),i.setDestroyFrames(60*xyd.frameScale),i.shouldNotFall=!0,this._board.addForRemoval(i),t.setMatchable(!1))},t}(SpecialSwap);__reflect(ColorLineSwap.prototype,"ColorLineSwap");var starlingswf;!function(e){var t=function(t){function i(e,i,n,o){var a=t.call(this)||this;return a._isPlay=!1,a.loop=!0,a._completeFunction=null,a._frames=e,a._labels=i,a._displayObjects=n,a._startFrame=0,a._endFrame=a._frames.length-1,a._ownerSwf=o,a.setCurrentFrame(0),a.play(),a}return __extends(i,t),i.prototype.update=function(){if(this._isPlay)if(this._currentFrame>this._endFrame){if(this.hasCompleteListener()&&this.dispatchEventWith(egret.Event.COMPLETE),this._currentFrame=this._startFrame,!this.loop)return void(this._ownerSwf&&this.stop(!1));if(this._startFrame==this._endFrame)return void(this._ownerSwf&&this.stop(!1));this.setCurrentFrame(this._startFrame)}else this.setCurrentFrame(this._currentFrame),this._currentFrame+=1},i.prototype.setCurrentFrame=function(t){this.$children.length=0,this._currentFrame=t,this.__frameInfos=this._frames[this._currentFrame];for(var i,n,o,a,s=this.__frameInfos.length,r=0;s>r;r++)i=this.__frameInfos[r],a=i[10],n=this._displayObjects[i[0]][a],n.skewX=i[6],n.skewY=i[7],n.alpha=i[8],n.name=i[9],n.x=i[2],n.y=i[3],i[1]==e.Swf.dataKey_Scale9?(n.width=i[11],n.height=i[12]):(n.scaleX=i[4],n.scaleY=i[5]),this.$children.push(n),n.$parent=this,i[1]==e.Swf.dataKey_TextField&&(o=n,o.width=i[11],o.height=i[12],o.textColor=i[14],o.size=i[15],o.textAlign=i[16],i[19]&&"\r"!=i[19]&&""!=i[19]&&(o.text=i[19]))},i.prototype.getCurrentFrame=function(){return this._currentFrame},i.prototype.play=function(){this._isPlay=!0,this._ownerSwf.swfUpdateManager.addSwfAnimation(this);var t,i,n;for(t in this._displayObjects)if(0==t.indexOf(e.Swf.dataKey_MovieClip)){i=this._displayObjects[t],n=i.length;for(var o=0;n>o;o++)i[o].play()}},i.prototype.stop=function(t){if(void 0===t&&(t=!0),this._isPlay=!1,this._ownerSwf.swfUpdateManager.removeSwfAnimation(this),t){var i,n,o;for(i in this._displayObjects)if(0==i.indexOf(e.Swf.dataKey_MovieClip)){n=this._displayObjects[i],o=n.length;for(var a=0;o>a;a++)n[a].stop(t)}}},i.prototype.gotoAndStop=function(e,t){void 0===t&&(t=!0),this.goTo(e),this.stop(t)},i.prototype.gotoAndPlay=function(e){this.goTo(e),this.play()},i.prototype.goTo=function(e){if("string"==typeof e){var t=this.getLabelData(e);this._currentLabel=t[0],this._currentFrame=this._startFrame=t[1],this._endFrame=t[2]}else"number"==typeof e&&(this._currentFrame=this._startFrame=e,this._endFrame=this._frames.length-1);this.setCurrentFrame(this._currentFrame)},i.prototype.getLabelData=function(e){for(var t,i=this._labels.length,n=0;i>n;n++)if(t=this._labels[n],t[0]==e)return t;return null},i.prototype.isPlay=function(){return this._isPlay},i.prototype.totalFrames=function(){return this._frames.length},i.prototype.currentLabel=function(){return this._currentLabel},i.prototype.labels=function(){for(var e=this._labels.length,t=[],i=0;e>i;i++)t.push(this._labels[i][0]);return t},i.prototype.hasCompleteListener=function(){return this.hasEventListener(egret.Event.COMPLETE)},i.prototype.hasLabel=function(e){var t=this.labels();return!(-1==t.indexOf(e))},i.prototype.getLabelStartFrame=function(e){return this.getLabelData(e)[1]},i.prototype.getLabelEndFrame=function(e){return this.getLabelData(e)[2]},i}(e.SwfSprite);e.SwfMovieClip=t,__reflect(t.prototype,"starlingswf.SwfMovieClip",["starlingswf.ISwfAnimation"])}(starlingswf||(starlingswf={}));var Mathf=function(){function e(){}return e.Approximately=function(e,t){return abs(t-e)<Math.max(1e-6*Math.max(abs(e),abs(t)),1.121039e-44)},e.Clamp=function(e,t,i){return t>e?e=t:e>i&&(e=i),e},e.Clamp01=function(e){return 0>e?0:e>1?1:e},e.DeltaAngle=function(t,i){var n=e.Repeat(i-t,360);return n>180&&(n-=360),n},e.Gamma=function(e,t,i){var n=!1;0>e&&(n=!0);var o=abs(e);if(o>t)return!n&&o||-o;var a=Math.pow(o/t,i)*t;return!n&&a||-a},e.InverseLerp=function(e,t,i){return t>e?e>i?0:i>t?1:(i-=e,i/=t-e):t>=e?0:t>i?1:i>e?0:1-(i-t)/(e-t)},e.Lerp=function(t,i,n){return t+(i-t)*e.Clamp01(n)},e.LerpAngle=function(t,i,n){var o=e.Repeat(i-t,360);return o>180&&(o-=360),t+o*e.Clamp01(n)},e.LerpUnclamped=function(e,t,i){return e+(t-e)*i},e.MoveTowards=function(t,i,n){return abs(i-t)<=n?i:t+e.Sign(i-t)*n},e.MoveTowardsAngle=function(t,i,n){return i=t+e.DeltaAngle(t,i),e.MoveTowards(t,i,n)},e.PingPong=function(t,i){return t=e.Repeat(t,2*i),i-abs(t-i)},e.Repeat=function(e,t){return e-floor(e/t)*t},e.Round=function(e){return floor(e+.5)},e.Sign=function(e){return e=e>0?1:0>e?-1:0},e.SmoothDamp=function(t,i,n,o,a,s){void 0===a&&(a=null),void 0===s&&(s=null),a=a||1/0,s=s||xyd.DeltaTime,o=e.Max(1e-4,o);var r=2/o,l=r*s,_=1/(1+l+.48*l*l+.235*l*l*l),h=t-i,c=i,d=a*o;h=e.Clamp(h,-d,d),i=t-h;var p=(n+r*h)*s;n=(n-r*p)*_;var u=i+(h+p)*_;return c>t==u>c&&(u=c,n=(u-c)/s),[u,n]},e.SmoothDampAngle=function(t,i,n,o,a,s){return s=s||xyd.DeltaTime,a=a||e.Infinity,i=t+e.DeltaAngle(t,i),e.SmoothDamp(t,i,n,o,a,s)},e.deg=function(e){return 180*e/Math.PI},e.SmoothStep=function(t,i,n){return n=e.Clamp01(n),n=-2*n*n*n+3*n*n,i*n+t*(1-n)},e.HorizontalAngle=function(t){return e.deg(Math.atan2(t.x,t.z))},e.IsNan=function(e){return!(e==e)},e.Epsilon=1.4013e-45,e.PI=Math.PI,e.Abs=Math.abs,e.Acos=Math.acos,e.Asin=Math.asin,e.Atan=Math.atan,e.Atan2=Math.atan2,e.Ceil=Math.ceil,e.Cos=Math.cos,e.Exp=Math.exp,e.Floor=Math.floor,e.Log=Math.log,e.Log10=Math.LOG10E,e.Max=Math.max,e.Min=Math.min,e.Pow=Math.pow,e.Sin=Math.sin,e.Sqrt=Math.sqrt,e.Tan=Math.tan,e.Random=Math.random,e.Infinity=1/0,e.Deg2Rad=e.deg(1),e.NegativeInfinity=-(1/0),e}();__reflect(Mathf.prototype,"Mathf");var BaseScene=function(){function e(){this._layers=new Array}return e.prototype.onEnter=function(){},e.prototype.onExit=function(){App.WindowManager.closeAllWindows([]),this.removeAllLayer()},e.prototype.addLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(e,0),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChild(e),this._layers.push(e))
},e.prototype.addLayerAt=function(e,t){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(e,t),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChildAt(e,t),this._layers.push(e))},e.prototype.removeLayer=function(e){e instanceof BaseSpriteLayer?(e.parent&&App.StageUtils.getStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)):e instanceof BaseEuiLayer&&(e.parent&&App.StageUtils.getUIStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)),App.WindowManager.removeLayer(e)},e.prototype.layerRemoveAllChild=function(e){e instanceof BaseSpriteLayer?e.removeChildren():e instanceof BaseEuiLayer&&e.removeChildren()},e.prototype.removeAllLayer=function(){for(;this._layers.length;){var e=this._layers[0];this.layerRemoveAllChild(e),this.removeLayer(e)}},e}();__reflect(BaseScene.prototype,"BaseScene");var LOCK_TYPE;!function(e){e[e.SHACKLE=1]="SHACKLE",e[e.ICE=2]="ICE",e[e.GIFT_WRAPPER=3]="GIFT_WRAPPER"}(LOCK_TYPE||(LOCK_TYPE={}));var Lock=function(){function e(e){this._isCreatedByColorMixer=!1,this._type=e,this._row=0,this._col=0,this._health=1}return e.prototype.cutGiftWrapper=function(){},e.prototype.isLocked=function(){return this._health>0},e.prototype["break"]=function(){this._health>0&&(this._health-=1)},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"health",{get:function(){return this._health},set:function(e){this._health=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),e.prototype.addBottomBitmap=function(e){this._bottomBitmap=e},e.prototype.removeBottomBitmap=function(){this._bottomBitmap&&this._bottomBitmap.parent&&this._bottomBitmap.parent.removeChild(this._bottomBitmap),this._bottomBitmap=void 0},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),e.prototype.dataToCell=function(e){switch(this.type){case LOCK_TYPE.SHACKLE:e.setProperty(CellConstants.SHACKLE);break;case LOCK_TYPE.ICE:e.setProperty(CellConstants.ICE);break;case LOCK_TYPE.GIFT_WRAPPER:e.setProperty(CellConstants.GIFT_WRAPPER_1-1+this._health)}},Object.defineProperty(e.prototype,"isCreatedByColorMixer",{get:function(){return this._isCreatedByColorMixer},set:function(e){this._isCreatedByColorMixer=e},enumerable:!0,configurable:!0}),e}();__reflect(Lock.prototype,"Lock");var Cloud=function(e){function t(t,i){return e.call(this,t,i,BlockerConstant.CLOUD)||this}return __extends(t,e),t}(Blocker);__reflect(Cloud.prototype,"Cloud");var BoardElement=function(){function e(t,i,n,o){this._xa=0,this._ya=0,this._isInFallingPath=!1,this._shouldNotFall=!1,this._shouldNotPreventSlide=!1,this._shouldRemove=!1,this._busy=!1,this._locked=!1,this._moveFrames=-1,this._removeFrames=-1,this._destroyFrames=e.DEFAULT_DESTORY_FRAMES*xyd.frameScale,this._createFrames=-1,this._state=BoardElementState.IDLE_STATE,this._destructionTriggered=!1,this._inDpack=!1,this._score=0,this._specialScore=0,this._bombState=0,this._isUnstable=!1,this._isDead=!1,this._isTeleporting=!1,this._isEnteringBoard=!1,this._enteringY=0,this._isSpecial=!1,this._removeTime=0,this._canBeDestroyed=!0,this._affectAdjacentBlockerOnRemove=!0,this._framesInPath=0,this._matchable=!0,this._isMovingOnBelt=!1,this._activeInLastExplode=!1,this._shieldFrames=0,this._isCreatedByColorMixer=!1,this._isSpecialDrop=!1,this.x=t,this.y=i,this.color=n,this.type=o,this._destructionTriggered=!1,this._removeTime=Math.floor(5*xyd.frameScale)}return e.prototype.update=function(){switch(this._state){case BoardElementState.MOVE_STATE:--this._moveFrames,this._moveFrames<=0&&(this.busy=!1,this.xa=0,this.ya=xyd.MAX_YA,this._shouldNotFall=!1,this._isMovingOnBelt&&(this.ya=0,this._isMovingOnBelt=!1),this._setState(BoardElementState.IDLE_STATE,-1));break;case BoardElementState.REMOVE_STATE:this._isUnstable||(--this._removeFrames,this._removeFrames<=0&&(this._busy=!1)),this._isDead&&--this._destroyFrames;break;case BoardElementState.CREATE_STATE:--this._createFrames,this._createFrames<=0&&(this.busy=!1,this._setState(BoardElementState.IDLE_STATE,-1));break;case BoardElementState.IDLE_STATE:break;default:console.log("unknow board element state")}this._isInFallingPath&&++this._framesInPath,this._shieldFrames>0&&this._shieldFrames--},e.prototype._setState=function(e,t){if(this._state!=e)switch(this._state=e,e){case BoardElementState.MOVE_STATE:this._moveFrames=t,this.busy=!0;break;case BoardElementState.REMOVE_STATE:this._removeFrames=t,this._busy=!0;break;case BoardElementState.CREATE_STATE:this._createFrames=t,this._busy=!0;break;case BoardElementState.IDLE_STATE:break;default:console.log("unknown board element state")}},e.prototype.move=function(){var e=!1;this.ya<=xyd.G?this.ya>0&&(this.ya=.15):e=!0,this._y=this._y+this._ya,this._view.updatePos(this.x,this.y,e),this._ya=Math.min(xyd.MAX_YA,this._ya+xyd.G),this._isTeleporting&&this._teleportExitY<this._y&&(this._teleportExitY=-1,this._isTeleporting=!1),this._isEnteringBoard&&this.y>this.enteringY-.01&&(this._isEnteringBoard=!1,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ENTER_COMPELETE,!1,this))},e.prototype.createSpecial=function(e){this._setState(BoardElementState.CREATE_STATE,e)},e.prototype.slideTo=function(e,t,i,n){this._posBeforeSlide=new egret.Point(this.x,this.y);var o=this.col,a=this.row;this._moveFrames=i*xyd.frameScale,this._setState(BoardElementState.MOVE_STATE,this._moveFrames),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ELEMENT_SLIDE_TO,!0,!1,{fromCol:o,fromRow:a,toCol:e,toRow:t,frames:i,element:this}))},e.prototype.isSliding=function(){return this._state==BoardElementState.MOVE_STATE},e.prototype.prepareForRemoval=function(e,t,i){this._removeMatch=i,this._damageSource=t,this._setState(BoardElementState.REMOVE_STATE,e)},e.prototype.cancelRemove=function(){this._state==BoardElementState.REMOVE_STATE&&(this._state=BoardElementState.IDLE_STATE,this._removeFrames=-1,this._removeMatch=void 0,this._damageSource=void 0,this._busy=!1)},Object.defineProperty(e.prototype,"row",{get:function(){return Math.floor(this._y+1e-4)},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return Math.floor(this._x+1e-4)},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xa",{get:function(){return this._xa},set:function(e){this._xa=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ya",{get:function(){return this._ya},set:function(e){this._ya=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMovingOnBelt",{get:function(){return this._isMovingOnBelt},set:function(e){this._isMovingOnBelt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInFallingPath",{get:function(){return this._isInFallingPath},set:function(e){this._framesInPath=0,this._isInFallingPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldNotFall",{get:function(){return this._shouldNotFall},set:function(e){this._shouldNotFall=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldNotPreventSlide",{get:function(){return this._shouldNotPreventSlide},set:function(e){this._shouldNotPreventSlide=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldRemove",{get:function(){return this._isUnstable?(this._destroyFrames>0&&(this._destroyFrames>3*xyd.frameScale?this._board.isPartialStable()&&(this._destroyFrames-=1):this._destroyFrames-=1),0!=this._destroyFrames||this._isDead||(this._isDead=!0,this._board.hitEmptyCell(this.col,this.row),this._board.addToDestructionPlanList(this)),this._destroyFrames<=0):this.type==ElementTypeConstants.BOMB_COLOR&&this._destructionPack&&this._destructionPack.isDone()?!0:this._state==BoardElementState.REMOVE_STATE&&this._removeFrames<=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return this._busy},set:function(e){this._busy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locked",{get:function(){return this.isLocked()},set:function(e){this._locked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destructionPack",{get:function(){return this._destructionPack},set:function(e){this._destructionPack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destructionTriggered",{get:function(){return this._destructionTriggered},set:function(e){this._destructionTriggered=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inDpack",{get:function(){return this._inDpack},set:function(e){this._inDpack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specialScore",{get:function(){return this._specialScore},set:function(e){this._specialScore=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enteringBoard",{get:function(){return this._isEnteringBoard},set:function(e){this._isEnteringBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enteringY",{get:function(){return this._enteringY},set:function(e){this._enteringY=e},enumerable:!0,configurable:!0}),e.prototype.setUnstable=function(){this._removeTime=Math.floor(10*xyd.frameScale),this._isUnstable=!0,this._canBeDestroyed=!1,this._removeFrames=this._removeTime},e.prototype.setStable=function(){this._isUnstable=!1},e.prototype.setBoard=function(e){this._board=e},e.prototype.isPreventingStability=function(){return this._state!=BoardElementState.IDLE_STATE||this._busy||this._isInFallingPath||this._isUnstable||this._isDead},e.prototype.isMatchable=function(){return this._matchable&&!this._busy&&!this._isDead&&this._state==BoardElementState.IDLE_STATE&&!this._isUnstable},e.prototype.setMatchable=function(e){this._matchable=e},e.prototype.addLock=function(e){e.col=this.col,e.row=this.row,this._lock=e,this._lock.type==LOCK_TYPE.GIFT_WRAPPER&&this.setMatchable(!1)},e.prototype.isLocked=function(){return void 0==this._lock?!1:this._lock.isLocked()},e.prototype.hasGiftWrapper=function(){return void 0==this._lock?!1:this._lock.type==LOCK_TYPE.GIFT_WRAPPER&&this._lock.isLocked()},e.prototype.cutGiftWrapper=function(){this._lock&&(this._lock.cutGiftWrapper(),this._lock.isLocked()||(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,this._lock),this._lock=void 0,this.setMatchable(!0),this._board.rebuildPathForColumn(this.col)))},e.prototype.breakLock=function(){return this._lock&&(this._lock["break"](),!this._lock.isLocked())?(this._lock=void 0,!0):!1},e.prototype.getLock=function(){return this._lock},e.prototype.canBeTransformedToPowerUpByMatch=function(){return!0},e.prototype.canBeDestroyed=function(){return this._canBeDestroyed},e.prototype.isDead=function(){return this._isDead},e.prototype.isSpecial=function(){return this._isSpecial},e.prototype.setSpecial=function(){this._isSpecial=!0},e.prototype.canBeMoved=function(){return!0},e.prototype.teleportTo=function(e){this.ya=xyd.G,this._teleportExitY=e,this._isTeleporting=!0},e.prototype.isTeleporting=function(){return this._isTeleporting},e.prototype.setRemoveTime=function(e){this._removeTime=0},e.prototype.canBeCoveredByCloud=function(){return this.isLocked()||this._busy||this._isDead?!1:!0},Object.defineProperty(e.prototype,"affectAdjacentBlockerOnRemove",{get:function(){return this._affectAdjacentBlockerOnRemove},set:function(e){this._affectAdjacentBlockerOnRemove=e},enumerable:!0,configurable:!0}),e.prototype.dataToCell=function(e){ElementTypeConstants.COLORFUL_ELEMENTS.indexOf(this.type)>-1&&this.color<=CellConstants.CELL_COLOR_F&&this.color>=CellConstants.CELL_COLOR_A&&e.setProperty(this.color),e.setProperty(TypeConverter.getCellPropertyForELement(this))},e.prototype.canBeColorBombReplace=function(){return this.type==ElementTypeConstants.LUCKY_BAG?!1:!0},e.prototype.isDestroyed=function(){return this._destroyFrames<=0},e.prototype.setDead=function(){this._isDead=!0},e.prototype.getRemoveMatch=function(){return this._removeMatch},e.prototype.setDestroyFrames=function(e){this._destroyFrames=e},e.prototype.getFramesInPath=function(){return this._framesInPath},e.prototype.getDamageSource=function(){return this._damageSource},e.prototype.setDamageSource=function(e){this._damageSource=e},e.prototype.beginBeltMove=function(e,t,i,n){this._conveyorBeltMove(e,t,i,n)},e.prototype.isActiveInLastExplode=function(){return this._activeInLastExplode},e.prototype.setActiveInLastExplode=function(e){this._activeInLastExplode=e},e.prototype._conveyorBeltMove=function(e,t,i,n){this._moveFrames=BeltConstants.ANIMATION_TICKS*xyd.frameScale,this._shouldNotFall=!0,this.x=i,this.y=n,this._isMovingOnBelt=!0,this._setState(BoardElementState.MOVE_STATE,this._moveFrames)},e.prototype.isSticky=function(){return!1},e.prototype.canBeAttackedByRocket=function(){return!0},e.prototype.setAffectAdjacentBlockerOnRemove=function(e){this._affectAdjacentBlockerOnRemove=e},e.prototype.hasShield=function(){return this._shieldFrames>0},e.prototype.setSpecialDrop=function(e){this._isSpecialDrop=e},e.prototype.getSpecialDrop=function(){return this._isSpecialDrop},Object.defineProperty(e.prototype,"isCreatedByColorMixer",{get:function(){return this._isCreatedByColorMixer},set:function(e){this._isCreatedByColorMixer=e},enumerable:!0,configurable:!0}),e.DEFAULT_DESTORY_FRAMES=7,e}();__reflect(BoardElement.prototype,"BoardElement",["IBoardElement"]);var CellEdgesDirection;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(CellEdgesDirection||(CellEdgesDirection={}));var CellVerticesDirection;!function(e){e[e.LEFTUP=0]="LEFTUP",e[e.RIGHTUP=1]="RIGHTUP",e[e.RIGHTDOWN=2]="RIGHTDOWN",e[e.LEFTDOWN=3]="LEFTDOWN"}(CellVerticesDirection||(CellVerticesDirection={}));var CellEdges=function(){function e(e,t,i){this._edges=new Array(4),this._vertices=new Array(4),this._isEmpty=!0,this._col=e,this._row=t,this._cell=i}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._isEmpty},set:function(e){this._isEmpty=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Edges",{get:function(){return this._edges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),e.prototype.getVertice=function(e){return this._vertices[e]},e.prototype.getEdge=function(e){return this._edges[e]},e.prototype.hasUpEdge=function(){return void 0!=this._edges[0]},e.prototype.hasDownEdge=function(){return void 0!=this._edges[1]},e.prototype.hasLeftEdge=function(){return void 0!=this._edges[2]},e.prototype.hasRightEdge=function(){return void 0!=this._edges[3]},e}();__reflect(CellEdges.prototype,"CellEdges");var LuckyBagElement=function(){function e(e,t,i){void 0===i&&(i=!1),this._type=e,this._weight=t,this._hasIce=i,this._isBlocker=!1}return e.prototype.getType=function(){return this._type},e.prototype.getWeight=function(){return this._weight},e.prototype.hasIce=function(){return this._hasIce},e.prototype.isBlocker=function(){return this._isBlocker},e.prototype.isNotAllowedOnBelt=function(){return this._isBlocker||this._hasIce},e}();__reflect(LuckyBagElement.prototype,"LuckyBagElement",["ILuckyBag"]);var GeneratorHandler=function(){function e(e,t,i){this._board=i,this._movesNeedToGenerate=e||0,this._maxNumOnBoard=t||0,this._curMove=0}return e.prototype.dispose=function(){},e}();__reflect(GeneratorHandler.prototype,"GeneratorHandler");var MatchPattern=function(){function e(e,t,i,n){this._type=e,this._width=t,this._height=i,this._direction=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),e.prototype.setMatch=function(e){return e.width>=this._width&&e.height>=this._height?(e.patternType=this._type,(this._type==MatchConstants.MATCH_5||this._type==MatchConstants.MATCH_4)&&(e.up=0,e.down=0),!0):1==this._direction&&e.width>=this._height&&e.height>=this._width?(e.patternType=this._type,(this._type==MatchConstants.MATCH_5||this._type==MatchConstants.MATCH_4)&&(e.left=0,e.right=0),!0):!1},e}();__reflect(MatchPattern.prototype,"MatchPattern");var UTFMsg=function(){function e(){}return e.prototype.receive=function(e){var t=e.readUTF(),i=this.decode(t);i&&App.MessageCenter.dispatch(i.key,i.body)},e.prototype.send=function(e,t){var i=this.encode(t);i&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(i))},e.prototype.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]);var DPackCrayonBase=function(e){function t(t,i,n,o){var a=e.call(this,t,i,o)||this;return a._numFrames=0,a._intelvalFrame=10,a._replaceType=0,a._unchangedElemnts=[],a._changedElements=[],a._initX=0,a._initY=0,a._dir=n,a._initEle=i,a._initX=i.col,a._initY=i.row,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this)},t.prototype.update=function(){if(this._numFrames++,this._numFrames%this._intelvalFrame==0){var e=this._unchangedElemnts[0];xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_EFFECT,!1,{ele:e,dir:this._dir}),e.type=this._replaceType,this._board.replaceBoardElement(e),this._unchangedElemnts.splice(0,1),this._changedElements.push(e)}if(0==this._unchangedElemnts.length){this._isDone=!0;for(var t=0;t<this._changedElements.length;t++){var e=this._changedElements[t];e.setDestroyFrames(1),this._affectedElements.push(e)}}},t}(DPack);__reflect(DPackCrayonBase.prototype,"DPackCrayonBase");var DPackLine=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._direction=0,o._lastOffset=0,o._lastBlockerOffset=0,o._lastPosOffset=0,o._color=0,o._showAnimation=!0,o._isBlocked=[!1,!1],o._hasHitEdges=!1,o._type=MatchConstants.DP_ROW,o._color=o._initElement.color,o}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=0==this._direction?this._initCol:this._initRow,i=(0==this._direction?this._board.getBoardCols():this._board.getBoardRows())-t-1,n=t;n>0;n--){var o=this._getBoardElement(-n);o&&this._allElements.push(o)}for(var n=i;n>0;n--){var o=this._getBoardElement(n);o&&this._allElements.push(o)}},t.prototype._getBoardElement=function(e){return 0==this._direction?this._board.getIntergratedElementAt(this._initCol+e,this._initRow):this._board.getIntergratedElementAt(this._initCol,this._initRow+e)},t.prototype._getBoardBlocker=function(e){return 0==this._direction?this._board.getBlockerAtGrid(this._initCol+e,this._initRow):this._board.getBlockerAtGrid(this._initCol,this._initRow+e)},t.prototype._getBoardPos=function(e){if(0==this._direction){if(this._board.isValidGridPos(this._initCol+e,this._initRow))return{x:this._initCol+e,y:this._initRow}}else if(this._board.isValidGridPos(this._initCol,this._initRow+e))return{x:this._initCol,y:this._initRow+e}},t.prototype.update=function(){if(this._numFrames+=1,1==this._numFrames&&this._showAnimation&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_LINE,!1,{x:this._initCol,y:this._initRow,direction:this._direction,color:this._color}),this._numFrames>Math.floor(30*xyd.frameScale))return void(this._isDone=!0);this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var e=0==this._direction?.7/xyd.frameScale:.7/xyd.frameScale,t=Math.floor(this._numFrames*e),i=[-1,1],n=[2,3],o=[0,1];if(!this._hasHitEdges)if(this._hasHitEdges=!0,0==this._direction)for(var a=0;a<this._board.getBoardCols();a++){var s=this._board.getCellEdgesAtGrid(a,this._initRow);if(s)for(var r=0;r<n.length;r++){var l=s.getEdge(n[r]);void 0!=l&&this._affectedBlockers.push(l)}}else for(var a=0;a<this._board.getBoardRows();a++){var s=this._board.getCellEdgesAtGrid(this._initCol,a);if(s)for(var _=0;_<o.length;_++){var l=s.getEdge(o[_]);void 0!=l&&this._affectedBlockers.push(l)}}for(var a=this._lastOffset+1;t>=a;a++)for(var h=0;h<i.length;h++)if(1!=this._isBlocked[h]){var c=i[h],d=a*c,p=this._getBoardPos(d);p&&this._affectedLocs.push(p);var u=this._getBoardBlocker(d);if(u)this._affectedBlockers.push(u);else{var m=this._getBoardElement(d);m&&(this._affectedElements.push(m),m.inDpack=!0,m.type==ElementTypeConstants.ROCKET&&(this._shouldRefuelToRocket=!0,m.inDpack=!1,this._board.hitEmptyCell(m.col,m.row)),(m.type==ElementTypeConstants.LAMP_1||m.type==ElementTypeConstants.LAMP_2)&&this._board.hitEmptyCell(m.col,m.row),(m.type==ElementTypeConstants.BOX||m.type==ElementTypeConstants.BALLOON)&&(this._isBlocked[h]=!0))}}this._lastOffset=t},t.prototype.setShowAnimation=function(e){this._showAnimation=e},t}(DPack);__reflect(DPackLine.prototype,"DPackLine");var RocketDPackColor=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initHoldFrames=Math.floor(7*xyd.frameScale),o._type=MatchConstants.DP_COLOR,o._changeType=DPackColor.CHANGE_TYPE.NORMAL,o}return __extends(t,e),t.prototype.setup=function(){if(this._initCol=this._initElement.col,this._initRow=this._initElement.row,this._shouldRefuelToRocket=!0,this._swap){this._fromEle=this._board.getElementAtGrid(this._swap.fromColRow.x,this._swap.fromColRow.y),this._toEle=this._board.getElementAtGrid(this._swap.toColRow.x,this._swap.toColRow.y);var e=void 0,t=void 0;this._fromEle.type==ElementTypeConstants.ROCKET?(e=this._fromEle,t=this._toEle):(e=this._toEle,t=this._fromEle),this.sourceColor=t.color}else this.sourceColor=this.getRandomColorInBoard(),this._initElement.shouldNotFall=!0},t.prototype.update=function(){if(this._numFrames+=1,this._numFrames==this._initHoldFrames){for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getIntergratedElementAt(e,t);!i||i.busy||i.color!=this.sourceColor||i.col==this._initCol&&i.row==this._initRow||i.hasGiftWrapper()||(this._allElements.push(i),this._changeType!=DPackColor.CHANGE_TYPE.NORMAL&&(i.shouldNotFall=!0))}this._allElements.sort(function(e,t){return e.y!=t.y?e.y-t.y:e.x-t.x});var n=this._allElements.length;this._framesPerRemove=Math.floor(3*xyd.frameScale),this._minNumToRemove=Math.floor(n/this._removalTimes),this._maxNumToRemove=this._minNumToRemove+1,this._framesToSwatchRemoveNum=(n-n%this._removalTimes*this._maxNumToRemove)*this._framesPerRemove+this._initHoldFrames,0==this._allElements.length&&(this._framesPostDone=0)}if(!(this._numFrames<=this._initHoldFrames)){this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var o={},a=0;if(this._allElements.length>0&&this._numFrames%this._framesPerRemove==0){for(a=this._numFrames<this._framesToSwatchRemoveNum?this._minNumToRemove:this._maxNumToRemove;a>0&&this._allElements.length>0;){var i=this._allElements[0];this._affectedLocs.push({x:i.col,y:i.row}),this._changeType==DPackColor.CHANGE_TYPE.NORMAL&&this.doNoramlChange(i,o),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:this._initCol,fromY:this._initRow,toX:i.x,toY:i.y}),this._allElements.splice(0,1),a-=1}0==this._allElements.length&&(this._framesPostDone=this._framesPostDoneMax)}this._framesPostDone>0?this._framesPostDone-=1:0==this._framesPostDone&&(this._initElement.setMatchable(!0),this._isDone=!0)}},t}(DPackColor);__reflect(RocketDPackColor.prototype,"RocketDPackColor");var BaseSound=function(){function e(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}return e.prototype.dealSoundTimer=function(){for(var e=egret.getTimer(),t=Object.keys(this._cache),i=0,n=t.length;n>i;i++){var o=t[i];this.checkCanClear(o)&&e-this._cache[o]>=SoundManager.CLEAR_TIME&&(delete this._cache[o],RES.destroyRes(o))}},e.prototype.getSound=function(e){var t=RES.getRes(e);if(t)this._cache[e]&&(this._cache[e]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(e))return null;this._loadingCache.push(e),RES.getResAsync(e,this.onResourceLoadComplete,this)}return t},e.prototype.onResourceLoadComplete=function(e,t){var i=this._loadingCache.indexOf(t);-1!=i&&(this._loadingCache.splice(i,1),this._cache[t]=egret.getTimer(),this.loadedPlay(t))},e.prototype.loadedPlay=function(e){},e.prototype.checkCanClear=function(e){return!0},e}();__reflect(BaseSound.prototype,"BaseSound");var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray}return e.prototype.receive=function(e){e.readBytes(this._msgBuffer);var t=this.decode(this._msgBuffer);t&&App.MessageCenter.dispatch(SocketConst.SOCKET_MESSAGE,t),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},e.prototype.send=function(e,t){var i=this.encode(t);i&&(i.position=0,e.writeBytes(i,0,i.bytesAvailable))},e.prototype.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]);var BaseController=function(){function e(){this.eventProxy_=new EventProxy(xyd.EventDispatcher.inner(),this),this.eventProxyOut_=new EventProxy(xyd.EventDispatcher.outer(),this)}return e.prototype.onRegister=function(){},e.prototype.registerEvent=function(e,t,i){this.eventProxy_.addEventListener(e,t,i)},e.prototype.registerEventOut=function(e,t,i){this.eventProxyOut_.addEventListener(e,t,i)},e.prototype.reset=function(){this.eventProxy_.removeAllEventListeners(),this.eventProxyOut_.removeAllEventListeners()},e}();__reflect(BaseController.prototype,"BaseController");var ModePlugin=function(){function e(e,t){this._board=e,this._gameEndInfo=t,this._isStable=!0}return e.prototype.init=function(e){},e.prototype.createElementsView=function(){},e.prototype.updateElements=function(){},e.prototype.calculateElementScore=function(e,t){return 0},e.prototype.checkIfGameEnd=function(){return!0},e.prototype.checkGameEndStatus=function(){return 0},e.prototype.savePluginData=function(){},e.prototype.isStable=function(){return!0},e.prototype.dispose=function(){},e.prototype.getSaveData=function(e,t){},e.prototype.setSaveData=function(e){},e.prototype.isLeafPlugin=function(){return!1},e.prototype.isLampPlugin=function(){return!1},e.prototype.isObjectivePlugin=function(){return!1},e.prototype.checkHammerHint=function(){},e.prototype.checkWandHint=function(){},e}();__reflect(ModePlugin.prototype,"ModePlugin",["IModePlugin"]);var LeafMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.LEAF},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t.prototype.addModePlugins=function(){var e=new LeafPlugin(this._board,this._gameEndInfo);this._leafFacade=new LeafFacade(e),this._modeplugins.push(e)},t.prototype.getLeafFacade=function(){return this._leafFacade},t.prototype.leafLight=function(){for(var e=0,t=this._modeplugins;e<t.length;e++){var i=t[e];if(i.isLeafPlugin()){var n=i;n.leafLight()}}},t}(GameMode);__reflect(LeafMode.prototype,"LeafMode");var IngameItem=function(){function e(e,t,i){this._canUse=!0,this._tempNum=0,this._board=e,this._window=t,this._gameView=i}return Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(e){this._count=e},enumerable:!0,configurable:!0}),e.prototype.activate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.onOpDown=function(e){},e.prototype.onOpUp=function(e){},e.prototype.onDragOnMainField=function(e){},e.prototype.addTempNum=function(e){this._tempNum+=e},e.prototype.getTotalNum=function(){if(void 0!=this._itemId){var e=SelfInfo.get();return e.getItemNumByID(""+this._itemId)+e.getItemNumByID(""+(this._itemId+ItemConstants.LIMITED_TIME_OFFSET))+e.getItemNumByID(""+(this._itemId+ItemConstants.UNLIMITED_TIME_OFFSET))+this._tempNum}},e.prototype.isInUnLimitedTime=function(){if(void 0!=this._itemId){var e=SelfInfo.get(),t=e.getItemNumByID(""+(this._itemId+ItemConstants.UNLIMITED_TIME_OFFSET));return void 0!=t&&t>0}},e.prototype.consumeOne=function(){if(this._tempNum>0)this._tempNum-=1;else{var e=SelfInfo.get();e.useItemNumByID(""+this._itemId)}},e.prototype.inUse=function(){this._gameView.clearPossibleMove();var e=this._window;this._canUse=!1,this._count--,e.setCanTouch(!1),this.consumeOne(),e.useItemById(this._itemId),this._count<=0&&(e.useItemReachLimitById(this._itemId),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION))),e.unuseItemMask()},e}();__reflect(IngameItem.prototype,"IngameItem",["IIngameItem"]);var PregameItem=function(){function e(e,t,i){this._movesToGenerate=e,this._board=t,this._isFromStreak=i}return e.prototype.checkIfGenerate=function(){var e=100*this._board.randomDouble();return e<=this._movesToGenerate},e.prototype.setOnBoard=function(){},e.prototype.dispose=function(){},e}();__reflect(PregameItem.prototype,"PregameItem",["IPregameItem"]);var BlockerConstant=function(){function e(){}return e.SLATE=1,e.CLOUD=2,e.CLOUD_MAKER=3,e.CLOUD_ROCKET=4,e.LAYED_SLATE=5,e.PUZZLE=6,e.SNOW=7,e.COLOR_MIXER=8,e.FAN=9,e.FENCE=10,e.CURLS=11,e}();__reflect(BlockerConstant.prototype,"BlockerConstant");var CellConstants=function(){function e(){}return e.CELL_COLOR_A=2,e.CELL_COLOR_B=3,e.CELL_COLOR_C=4,e.CELL_COLOR_D=5,e.CELL_COLOR_E=6,e.CELL_COLOR_F=7,e.CELL_COLOR_RANDOM=0,e.COLOR_RED=e.CELL_COLOR_C,e.COLOR_ORANGE=e.CELL_COLOR_E,e.COLOR_PINK=e.CELL_COLOR_B,e.COLOR_GREEN=e.CELL_COLOR_D,e.COLOR_BLUE=e.CELL_COLOR_F,e.COLOR_PURPLE=e.CELL_COLOR_A,e.NUM_OF_CELL_PROPERTIES=106,e.VOID=0,e.NORMAL_ELEMENT=1,e.ELEMENT_COLOR_RED=e.COLOR_RED,e.ELEMENT_COLOR_ORANGE=e.COLOR_PINK,e.ELEMENT_COLOR_PINK=e.COLOR_ORANGE,e.ELEMENT_COLOR_GREEN=e.COLOR_GREEN,e.ELEMENT_COLOR_BLUE=e.COLOR_BLUE,e.ELEMENT_COLOR_PURPLE=e.COLOR_PURPLE,e.ELEMENT_COLOR_RANDOM=8,e.ELEMENET_GENERATOR=9,e.BOMB_ROW=10,e.BOMB_COL=11,e.BOMB_SQUARE=12,e.BOMB_COLOR=13,e.LEAF_1=14,e.LEAF_2=15,e.STATIONARY=16,e.SLATE=17,e.SHACKLE=18,e.LAMP_OUT=19,e.LAMP=20,e.PORTAL=21,e.PORTAL_ENTER_POINT=22,e.PORTAL_EXIT_POINT=23,e.PORTAL_VISIBLE=24,e.PORTAL_VISIBLE_ENTER_POINT=25,e.PORTAL_VISIBLE_EXIT_POINT=26,e.CLOUD=27,e.ICE=28,e.BOX=29,e.GENERATOR_ELEMENT=30,e.GENERATOR_LAMP=31,e.GENERATOR_BOX=32,e.LAYED_SLATE_1=33,e.LAYED_SLATE_2=34,e.LAYED_SLATE_3=35,e.LAYED_SLATE_4=36,e.LAYED_SLATE_5=37,e.LAMP1=38,e.LAMP2=39,e.EMPTY=40,e.TIME_BOMB=41,e.CLOUD_MAKER=42,e.LUCKY_BAG=43,e.CRAYON=44,e.TORNADO=45,e.BLACK_HOLE=46,e.GENERATOR_TIME_BOMB=47,e.GENERATOR_LUCKY_BAG=48,e.GENERATOR_BOMB_LINE=49,e.GENERATOR_BOMB_SQUARE=50,e.GENERATOR_BLACK_HOLE=51,e.GENERATOR_BOMB_ROW=52,e.GENERATOR_BOMB_COL=53,e.PUZZLE=54,e.PUZZLE_1=55,e.PUZZLE_2=56,e.PUZZLE_3=57,e.CAKE_1=58,e.CAKE_2=59,e.CAKE_3=60,e.CAKE_4=61,e.CAKE_5=62,e.GOLDEN_EGG=63,e.WAND=64,e.GENERATOR_GOLDEN_EGG=65,e.ROCKET=66,e.CLOUD_ROCKET=67,e.GENERATOR_SCISSOR=68,e.SCISSOR=69,e.GIFT_WRAPPER_1=70,e.GIFT_WRAPPER_2=71,e.GIFT_WRAPPER_3=72,e.GIFT_WRAPPER_4=73,e.GIFT_WRAPPER_5=74,e.GENERATOR_CAKE=75,e.BALLOON_1=76,e.BALLOON_2=77,e.BALLOON_3=78,e.SNOW_1=79,e.SNOW_2=80,e.SNOW_3=81,e.COLOR_MIXER_1=82,e.COLOR_MIXER_2=83,e.COLOR_MIXER_3=84,e.COLOR_MIXER_4=85,e.COLOR_MIXER_5=86,e.FAN=87,e.FENCE_UP=88,e.FENCE_DOWN=89,e.FENCE_LEFT=90,e.FENCE_RIGHT=91,e.CURLS_UP_1=92,e.CURLS_DOWN_1=93,e.CURLS_LEFT_1=94,e.CURLS_RIGHT_1=95,e.CURLS_UP_2=96,e.CURLS_DOWN_2=97,e.CURLS_LEFT_2=98,e.CURLS_RIGHT_2=99,e.CURLS_UP_3=100,e.CURLS_DOWN_3=101,e.CURLS_LEFT_3=102,e.CURLS_RIGHT_3=103,e.GENERATOR_COLOR_BOMB=104,e.GENERATOR_TORNADO=105,e.EDGE_BLOCKER_SET=[[e.FENCE_UP,e.CURLS_UP_1,e.CURLS_UP_2,e.CURLS_UP_3],[e.FENCE_DOWN,e.CURLS_DOWN_1,e.CURLS_DOWN_2,e.CURLS_DOWN_3],[e.FENCE_LEFT,e.CURLS_LEFT_1,e.CURLS_LEFT_2,e.CURLS_LEFT_3],[e.FENCE_RIGHT,e.CURLS_RIGHT_1,e.CURLS_RIGHT_2,e.CURLS_RIGHT_3]],e.COLOR_SET=[e.CELL_COLOR_C,e.CELL_COLOR_D,e.CELL_COLOR_E,e.CELL_COLOR_F,e.CELL_COLOR_A,e.CELL_COLOR_B],e.GENERATOR_SET=[e.GENERATOR_ELEMENT,e.GENERATOR_LAMP,e.GENERATOR_BOX,e.GENERATOR_TIME_BOMB,e.GENERATOR_LUCKY_BAG,e.GENERATOR_BOMB_LINE,e.GENERATOR_BOMB_SQUARE,e.GENERATOR_BLACK_HOLE,e.GENERATOR_BOMB_COL,e.GENERATOR_BOMB_ROW,e.GENERATOR_SCISSOR,e.GENERATOR_CAKE,e.GENERATOR_GOLDEN_EGG,e.GENERATOR_COLOR_BOMB,e.GENERATOR_TORNADO],e.STATIONARY_SET=[e.SLATE,e.SHACKLE,e.CLOUD,e.ICE,e.BOX],e.LOCK_SET=[e.SHACKLE,e.ICE,e.GIFT_WRAPPER_1,e.GIFT_WRAPPER_2,e.GIFT_WRAPPER_3,e.GIFT_WRAPPER_4,e.GIFT_WRAPPER_5],e.LAMP_SET=[e.LAMP,e.LAMP1,e.LAMP2],e
}();__reflect(CellConstants.prototype,"CellConstants");var xyd;!function(e){e.DeltaTime=.033,e.TweenDeltaTime=.033,e.frameRate=30,e.frameScale=1,e.G=.067,e.MAX_YA=.6,e.stageWidth=1080,e.stageHeight=1920,e.statusBarHeight=0,e.isiPhoneX=!1,e.system="",e.mapWidth=1080,e.IPHONEX_CUTOUT_HEIGHT=90,e.ANDROID_CUTOUT_HEIGHT=94,e.TILE_WIDTH=118,e.TILE_HEIGHT=124,e.TILE_WIDTH_HALF=59,e.TILE_HEIGHT_HALF=62,e.BOARD_MAX_WIDTH=1062,e.BOARD_MAX_HEIGHT=1116,e.greyFilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),e.darkFilter=new egret.ColorMatrixFilter([1,0,0,0,-30,0,1,0,0,-30,0,0,1,0,-30,0,0,0,1,0]),e.lightFilter=new egret.ColorMatrixFilter([1,0,0,0,50,0,1,0,0,50,0,0,1,0,50,0,0,0,1,0]),e.light7Filter=new egret.ColorMatrixFilter([1,0,0,0,70,0,1,0,0,70,0,0,1,0,70,0,0,0,1,0]),e.unlockFilter=new egret.ColorMatrixFilter([1,0,0,0,-60,0,1,0,0,-60,0,0,1,0,-60,0,0,0,1,0]),e.useItemFilter=new egret.ColorMatrixFilter([.7,0,0,0,-40,0,.7,0,0,-40,0,0,.7,0,-40,0,0,0,1,0]),e.bitmapNumber=new BitmapNumber,e.GENDER_ICONS=["icon_nv_png","icon_nan_png","icon_nv_png"],e.elementWidth=118,e.elementHeight=124,e.isApp=!1,e.isiOS8=!1,e.isLowEndDevice=!0,e.DIRECTION={RIGHT:2,LEFT:3,UP:1,DOWN:0},e.directions=[[0,1],[0,-1],[1,0],[-1,0]],e.MAX_ITEM_USED_COUNT=4,e.TEST_LEVEL=3587,e.MAX_STAGE=3587,e.SAVE_DATA_VER=10004,e.AUTO_TEST_LEVEL=334,e.AUTO_TEST_FAIL_TIMES=0,e.AUTO_TEST_FAIL_MAX_TIMES=3,e.START_RANDOM_ACTION=0,e.FIRST_QUEST=101010,e.TEST_QUEST=101020,e.FINAL_QUEST=405250,e.STAR=200,e.SHOW_GRID_LINES=!0,e.SHOW_MOMENTS=!1,e.BUBBLE_CONVERSATION_SCALE=.7,e.frameLightFilter=[new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,10,0,1,0,0,10,0,0,1,0,10,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,30,0,1,0,0,30,0,0,1,0,30,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,40,0,1,0,0,40,0,0,1,0,40,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,50,0,1,0,0,50,0,0,1,0,50,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,40,0,1,0,0,40,0,0,1,0,40,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,30,0,1,0,0,30,0,0,1,0,30,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,20,0,1,0,0,20,0,0,1,0,20,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,10,0,1,0,0,10,0,0,1,0,10,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])],e.renderMode="webgl"}(xyd||(xyd={}));var ElementTypeConstants=function(){function e(){}return e.BLANK=0,e.NORMAL=1,e.BOMB_ROW=2,e.BOMB_COL=3,e.BOMB_SQUARE=4,e.BOMB_COLOR=5,e.LAMP_1=6,e.LAMP_2=7,e.BOX=8,e.TIME_BOMB=9,e.LUCKY_BAG=10,e.CRAYON=11,e.TORNADO=12,e.BLACK_HOLE=13,e.CAKE=14,e.WAND=15,e.GOLDEN_EGG=16,e.ROCKET=17,e.SCISSOR=18,e.BALLOON=19,e.COLORFUL_ELEMENTS=[e.NORMAL,e.BOMB_ROW,e.BOMB_COL,e.BOMB_SQUARE,e.TIME_BOMB,e.LUCKY_BAG,e.BLACK_HOLE,e.TORNADO,e.GOLDEN_EGG,e.ROCKET,e.SCISSOR],e.NORMAL_ELEMENTS=[e.NORMAL,e.TIME_BOMB],e.LAMP_SET=[e.LAMP_1,e.LAMP_2],e}();__reflect(ElementTypeConstants.prototype,"ElementTypeConstants");var MatchConstants=function(){function e(){}return e.MATCH_L=2,e.MATCH_3=3,e.MATCH_4=4,e.MATCH_5=5,e.DP_NONE=1,e.DP_COL=2,e.DP_ROW=3,e.DP_BOMB=4,e.DP_COLOR=5,e.DP_COL_ROW_THREE=6,e.DP_COLOR_COLOR=7,e}();__reflect(MatchConstants.prototype,"MatchConstants");var BaseTable=function(){function e(e){this.tableJson=null,this.tableJson=allJsons[e]}return e.prototype.getAny=function(e,t){var i=this.tableJson.keys[t];if(void 0!=this.tableJson.rows[e])return this.tableJson.rows[e][i]},e.prototype.getString=function(e,t){var i=this.tableJson.keys[t];if(void 0!=this.tableJson.rows[e])return String(this.tableJson.rows[e][i])},e.prototype.getNumber=function(e,t){var i=this.tableJson.keys[t];if(void 0!=this.tableJson.rows[e])return Number(this.tableJson.rows[e][i])},e}();__reflect(BaseTable.prototype,"BaseTable");var GameView=function(){function e(e,t){this.labeTarget=[],this.effectMap={},this.blockerMap={},this.elementMap={},this.baseBoardMap={},this.protalEnterMap={},this.protalOutMap={},this.beltProtalEnterMap={},this.beltProtalOutMap={},this.beltCellViewList=[],this.fakeElementView={},this.maxFakeElement=1,this.beltPortalColorMap={},this.generatorMap={},this.BOUNDARY_OFFSET=16,this.TILE_HEIGHT=xyd.TILE_HEIGHT,this.TILE_WIDTH=xyd.TILE_WIDTH,this.TILE_BOUNDARY=8,this.BASKET_RECOVER_FRAME=40,this.REMOVE_MOVE_PIXEL=30,this.MAX_FAKE_VIEW_FRAME=30,this._targetkeys=[],this._scoreTargets=[],this._lastScore=0,this._comboEffect=void 0,this._displayTargetLabel=[],this._displayTargetGroup=[],this._waitingFrams=-1,this._possibleMoveEle=[],this._possibleMoveTween=[],this.MAX_STAR_LEN=310,this._baseMap=[],this._level=-1,this._currenGuideID=-1,this._isFirstStable=!0,this._receivedPossibleMoveRequest=!1,this._isGuideComplete=!1,this._doTestMoves=platform.inAutoMode(),this._dpSoundCount=0,this._usingTimelines=[],this._colorElementEffects=[],this._targetImgScale=.9,this._bombExplodeCovers=[],this._crayonEffects={},this._dpColorTargetEffMap={},this._dpColorTargetCoverMap={},this._dpColorColorEffectMap=[],this._crayonNeedDelEffects={},this._colorNeedDelEffects={},this._leafLightEffects={},this._wandEffects={},this._wandNeedDelEffects={},this._rocketClear=!1,this._shouldLogGuideLoss=!1,this._movesUsed=0,this._isDisposed=!1,this._belt_state=!1,this._lockToViewMap={},this._fakeViews=[],this._changeSlateToStone=!1,this._listeningEvents={},this._gameMode=e,this._board=t,this._level=this._board.getGameConf().totalLevel}return e.prototype.update=function(){for(var e in this.fakeElementView){var t=this.fakeElementView[e];t.ya=Math.min(t.ya+xyd.G,xyd.MAX_YA);var i=t.ya*xyd.TILE_HEIGHT;t.y+=i,void 0!=t.displayGroup.mask&&(t.displayGroup.mask.y-=i),t.moveFrame++,t.moveFrame>=this.MAX_FAKE_VIEW_FRAME&&(this.elementLayer.removeChild(t),delete this.fakeElementView[e])}var n=function(e){var t=o.generatorMap[e].effect;o.generatorMap[e].frame++;var i=o.generatorMap[e].frame,n=o.generatorMap[e].state,a=o.generatorMap[e].group;if(1==n&&i>o.BASKET_RECOVER_FRAME){t.animation.play("texiao03",1),o.generatorMap[e].state=0;var s=function(e){a.visible=!0,t.removeDBEventListener("complete",s,this)};return t.addDBEventListener("complete",s,o),"break"}},o=this;for(var a in this.generatorMap){var s=n(a);if("break"===s)break}},e.prototype.setWindow=function(e){this._win=e,this.boardLayer=e.boardLayer,this.blockerLayer=e.blockerLayer,this.elementLayer=e.elementLayer,this.leafLayer=e.leafLayer,this.beltLayer=e.beltLayer,this.effectLayer=e.effectLayer,this.edgeLayer=e.effectLayer,this.lockLayer=e.lockLayer,this.debugLayer=e.debugLayer,this.bottomLayer=e.bottomLayer,this.group_target=e.group_target,this.group_start_target=e.group_start_target,this.group_tips=e.group_tips,this.star_1=e.star_1,this.star_2=e.star_2,this.star_3=e.star_3,this.step_=e.step_,this.group_shuffle=e.group_shuffle,this.group_mode1=e.group_mode1,this.group_mode2=e.group_mode2,this.group_mode3=e.group_mode3,this.group_mode4=e.group_mode4,this.charEffHolder1=e.charEffHolder1,this.charEffHolder2=e.charEffHolder2,this.charEffHolder3=e.charEffHolder3,this.charEffHolder4=e.charEffHolder4,this.charImg1=e.charImg1,this.charImg2=e.charImg2,this.charImg3=e.charImg3,this.charImg4=e.charImg4,this.mode1_score1=e.mode1_score1,this.mode1_score2=e.mode1_score2,this.mode1_score3=e.mode1_score3,this.group_bottom=e.group_bottom,this.star_group=e.star_group,this.group_skip=e.group_skip,this.group_bg=e.group_bg,this._bgImg=e._bgImg,this._itemMask=e._itemMask,this.setting_group=e.setting_group,this.group_newuser_redpacket=e.group_newuser_redpacket,this.target_mode2_1=e.target_mode2_1,this.target_mode3_1=e.target_mode3_1,this.target_mode3_2=e.target_mode3_2},e.prototype.init=function(){if(DisplayConstants.get(),!this._board)return void console.log("board is undefined");for(var e=0;81>e;e++)this._baseMap[e]=void 0;this.initEvents()},e.prototype.useItemMask=function(e){this._itemMask.visible=e},e.prototype.initEvents=function(){this._addEvent(xyd.event.BOARD_COLLECT_COIN,this.playFlySpecialDropAniamtion,this),this._addEvent(xyd.event.BOARD_ADD_BASE,this.addBase,this),this._addEvent(xyd.event.BOARD_ADD_ELEMENT,this.addElement,this),this._addEvent(xyd.event.BOARD_ADD_BLOCKER,this.addBlocker,this),this._addEvent(xyd.event.BOARD_ADD_EDGES,this.addEdges,this),this._addEvent(xyd.event.BOARD_ADD_LEAF,this.addLeaf,this),this._addEvent(xyd.event.BOARD_ADD_LOCK,this.addLock,this),this._addEvent(xyd.event.BOARD_REMOVE_ELEMENT,this.removeElement,this),this._addEvent(xyd.event.BOARD_REMOVE_BLOCKER,this.removeBlocker,this),this._addEvent(xyd.event.BOARD_HIDE_BLOCKER,this.hideBlocker,this),this._addEvent(xyd.event.BOARD_REMOVE_LEAF,this.removeLeaf,this),this._addEvent(xyd.event.BOARD_REMOVE_LOCK,this.removeLock,this),this._addEvent(xyd.event.BOARD_REPLACE_ELEMENT,this.replaceElement,this),this._addEvent(xyd.event.BOARD_REPLACE_LEAF,this.replaceLeaf,this),this._addEvent(xyd.event.BOARD_REPLACE_BLOCK,this.replaceBlock,this),this._addEvent(xyd.event.BOARD_REPLACE_LOCK,this.replaceLock,this),this._addEvent(xyd.event.BOARD_REPLACE_ROCKET,this.replaceRocket,this),this._addEvent(xyd.event.BOARD_ENTER,this.boardEnter,this),this._addEvent(xyd.event.BOARD_ENTER_COMPELETE,this.boardEnterCompelete,this),this._addEvent(xyd.event.BOARD_FAKE_ELEMENT_PORTAL,this.boardFakeElementPortal,this),this._addEvent(xyd.event.UPDATE_TIME_BOMB,this.upateTimeBomb,this),this._addEvent(xyd.event.TIME_BOMB_EXPLODE,this.timeBombExplode,this),this._addEvent(xyd.event.BOARD_ADD_GENERATOR,this.addGenerator,this),this._addEvent(xyd.event.BOARD_ADD_PUZZLE,this.addPuzzle,this),this._addEvent(xyd.event.BOARD_REMOVE_PUZZLE,this.removePuzzle,this),this._addEvent(xyd.event.ROCKET_LAUNCH,this.rocketLaunch,this),this._addEvent(xyd.event.COLORMIXER_LAUNCH,this.colorMixerLaunch,this),this._addEvent(xyd.event.COLORMIXER_ADD_COLOR,this.colorMixerAddColor,this),this._addEvent(xyd.event.BOARD_SIZE,this.boardSize,this),this._addEvent(xyd.event.BOARD_ACTIVE_ELEMENT,this.activeElement,this),this._addEvent(xyd.event.ELEMENT_SLIDE_TO,this.elementSlideTo,this),this._addEvent(xyd.event.BOARD_LEAVE_BOARD,this.elementLeave,this),this._addEvent(xyd.event.GAME_VIEW_SET_STAGE,this.gameStage,this),this._addEvent(xyd.event.BOARD_REMOVE_ANIMATION_ELEMENT,this.playRemoveElementAnimation,this),this._addEvent(xyd.event.BOARD_REMOVE_ANIMATION_ELEMENT_BY_PUZZLE,this.playRemoveElementAnimationByPuzzle,this),this._addEvent(xyd.event.BOARD_REMOVE_ANIMATION_SPECIAL,this.playRemoveElementSpecial,this),this._addEvent(xyd.event.BOARD_REMOVE_ANIMATION_ROCKET,this.playRemoveElementRocket,this),this._addEvent(xyd.event.BOARD_UNSTABLE,this.boardUnstable,this),this._addEvent(xyd.event.BOARD_STABLE,this.boardStable,this),this._addEvent(xyd.event.BOARD_STEP,this.gameStep,this),this._addEvent(xyd.event.BOARD_SCORE,this.gameScore,this),this._addEvent(xyd.event.BOARD_SCORE_TARGET,this.gameScoreTarget,this),this._addEvent(xyd.event.BOARD_TARGET,this.boardTarget,this),this._addEvent(xyd.event.DP_SOUND_NORMAL,this.dpSoundNormal,this),this._addEvent(xyd.event.DP_LINE,this.dpLine,this),this._addEvent(xyd.event.DP_BOMB,this.dpBomb,this),this._addEvent(xyd.event.DP_COLOR_INIT,this.dpColorInit,this),this._addEvent(xyd.event.DP_COLOR_BEGIN,this.dpColorBegin,this),this._addEvent(xyd.event.DP_COLOR_THUNDER,this.dpColorThunder,this),this._addEvent(xyd.event.DP_COLOR_COLOR_TARGET,this.dpColorColorTarget,this),this._addEvent(xyd.event.DP_COLOR_COLOR_INIT,this.dpColorColorInit,this),this._addEvent(xyd.event.DP_COLOR_COLOR_INIT_EFFECT,this.dpColorColorInitEffect,this),this._addEvent(xyd.event.DP_COLOR_COLOR_INIT_EXPLOSION,this.dpColorColorInitExplosion,this),this._addEvent(xyd.event.DP_COLOR_END,this.dpColorEnd,this),this._addEvent(xyd.event.DP_COLOR_COLOR_END,this.dpColorColorEnd,this),this._addEvent(xyd.event.DP_COL_ROW_THREE,this.dpColRowThree,this),this._addEvent(xyd.event.SHAKE_BOARD,this._shakeBoard,this),this._addEvent(xyd.event.CLOUD_MAKER,this.cloudMaker,this),this._addEvent(xyd.event.BLACK_HOLE_CHANGE_EFFECT,this.blackHoleChangeEffect,this),this._addEvent(xyd.event.BOARD_LEAF_LIGHT,this.leafLight,this),this._addEvent(xyd.event.GAME_PRE_END,this.gameEnd,this),this._addEvent(xyd.event.GAME_RESUME,this.gameResume,this),this._addEvent(xyd.event.BOARD_SHUFFLE,this.reshuffle,this),this._addEvent(xyd.event.BOARD_SHUFFLE_TIPS,this.reshuffleTips,this),this._addEvent(xyd.event.BOARD_ADD_PORTAL,this.addPortal,this),this._addEvent(xyd.event.BOARD_ENTER_PORTAL,this.enterPortal,this),this._addEvent(xyd.event.BOARD_EXIT_PORTAL,this.exitPortal,this),this._addEvent(xyd.event.BOARD_ADD_BELT_PORTAL,this.addBeltPortal,this),this._addEvent(xyd.event.BOARD_ADD_BELT_CELL,this.addBeltCell,this),this._addEvent(xyd.event.BOARD_ELEMENT_REACH_END,this.element_reach_end,this),this._addEvent(xyd.event.BOARD_SET_BELT_STATE,this.set_belt_state,this),this._addEvent(xyd.event.BOARD_SHOW_POSSIBLE_MOVE,this._updatePossibleMove,this),this._addEvent(xyd.event.CREATE_SPECIAL,this.createSpecial,this),this._addEvent(xyd.event.SHOW_SKIP_BTN,this.showSkipBtn,this),this._addEvent(xyd.event.BONUS_TIME,this.bonusTime,this),this._addEvent(xyd.event.BONUS_TIME_START,this.bonusTimeStart,this),this._addEvent(xyd.event.TORNADO_SWING,this.tornadoEffect,this),this._addEvent(xyd.event.CRAYON_EFFECT,this.crayonEffect,this),this._addEvent(xyd.event.CRAYON_INIT_EFFECT,this.crayonInitEffect,this),this._addEvent(xyd.event.CRAYON_CHANGE_EFFECT,this.crayonChangeEffect,this),this._addEvent(xyd.event.MATCH_COMBO_EFFECT,this.matchComboEffect,this),this._addEvent(xyd.event.ACTIVATE_WAND_EFFECT,this._activateWand,this),this._addEvent(xyd.event.WAND_INIT_EFFECT,this._initWandEffect,this),this._addEvent(xyd.event.WAND_DISAPPEAR_EFFECT,this._wandDisappearEffect,this),this._addEvent(xyd.event.BELT_ELEMENT_MOVE,this._beltElementMove,this),this._addEvent(xyd.event.UPDATE_FPS,this._updateFPS,this),this._addEvent(xyd.event.EFFECT_PRESSURE_TEST,this._effectPressureTest,this),this._addEvent(xyd.event.DP_COLOR_TARGET_START,this._dpColorTargetStart,this),this._addEvent(xyd.event.DP_COLOR_TARGET_END,this._dpColorTargetEnd,this),this._addEvent(xyd.event.UPDATE_SNOW,this._updateSnow,this)},e.prototype._addEvent=function(e,t,i){xyd.EventDispatcher.inner().addEventListener(e,t,i),this._listeningEvents[e]=t},e.prototype._beltElementMove=function(e){var t=e.data.element,i=e.data.beltCell,n=(i.getPosition(),i.getTarget());if(t.view.clearDisplayTween(),i.isNeedTeleport())return void this._teleportElementOnBelt(t,i);var o=BeltConstants.ANIMATION_TICKS,a=new TimelineLite,s=this.logicToviewSimpleX(n.x),r=this.logicToviewSimpleY(n.y);a.add(TweenLite.to(t.view,o*xyd.TweenDeltaTime,{x:s,y:r,ease:Linear.easeNone})),t.view.setMoveTween(a)},e.prototype._teleportElementOnBelt=function(e,t){var i=this,n=t.getTarget(),o=t.getPosition(),a=n.x-BeltConstants.DX[t.nextBeltCell.getDirection()],s=n.y-BeltConstants.DY[t.nextBeltCell.getDirection()],r=28,l=this.logicToviewSimpleX(a),_=this.logicToviewSimpleY(s),h=this.logicToviewSimpleX(n.x),c=this.logicToviewSimpleY(n.y),d=h-l,p=c-_,u=new TimelineLite;u.add(TweenLite.fromTo(e.view,r*xyd.TweenDeltaTime,{x:l,y:_},{x:h,y:c,ease:Linear.easeNone})),e.view.setMoveTween(u);var m=new ElementView,g=this.logicToviewSimpleX(o.x),f=this.logicToviewSimpleY(o.y),y=o.x+BeltConstants.DX[t.getDirection()],E=o.y+BeltConstants.DY[t.getDirection()],v=this.logicToviewSimpleX(y),T=this.logicToviewSimpleY(E),C=g-v,L=f-T;if(m.setProp(g,f,e.color,e.type),m.setGameView(this),e.type==ElementTypeConstants.TIME_BOMB){var b=e;m.initTimeBomb(b.getTicksToExplode())}this.elementLayer.addChild(m);var w=new TimelineLite;w.add(TweenLite.fromTo(m,r*xyd.TweenDeltaTime,{x:g,y:f},{x:v,y:T,ease:Linear.easeNone}),0);var S=new egret.Rectangle(0,0,xyd.TILE_WIDTH,xyd.TILE_HEIGHT);if(m.displayGroup.mask=S,w.add(TweenLite.fromTo(m.displayGroup.mask,r*xyd.TweenDeltaTime,{x:0,y:0},{x:C,y:L,ease:Linear.easeNone}),0),m.effectDisplay){var O=new egret.Rectangle(0,0,xyd.TILE_WIDTH,xyd.TILE_HEIGHT);m.effectDisplay.mask=O,w.add(TweenLite.fromTo(m.effectDisplay.mask,r*xyd.TweenDeltaTime,{x:0,y:0},{x:C,y:L,ease:Linear.easeNone}),0)}var A=new TimelineLite,x=new egret.Rectangle(0,0,xyd.TILE_WIDTH,xyd.TILE_HEIGHT);e.view.displayGroup.mask=x,A.add(TweenLite.fromTo(e.view.displayGroup.mask,r*xyd.TweenDeltaTime,{x:d,y:p},{x:0,y:0,ease:Linear.easeNone}),0),egret.setTimeout(function(){i.elementLayer.removeChild(m),m.effectDisplay&&(m.effectDisplay.parent&&m.effectDisplay.parent.removeChild(m.effectDisplay),m.effectDisplay.mask=void 0),m.displayGroup&&m.displayGroup&&(m.displayGroup.mask=void 0),m.dispose(),e.view.getbitmap().mask=void 0,e.view.displayGroup&&(e.view.displayGroup.mask=void 0),e.view.effectDisplay&&(e.view.effectDisplay.mask=void 0)},this,1e3)},e.prototype._dpColorTargetStart=function(e){var t=e.data.ele,i=this.logicToView(new egret.Point(t.x,t.y)),n=this._dpColorTargetEffMap[t.id];n&&(n.animation.stop(),this._win.effectLayer.removeChild(n),EffectFactory.get().pushBackEffect(n),delete this._dpColorTargetEffMap[t.id]),EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_SINGLE,function(e){e.x=i.x,e.y=i.y,this._win.effectLayer.addChild(e),this._dpColorTargetEffMap[t.id]=e,e.animation.play("texiao01",0)}.bind(this));var o=new TimelineMax,a=t.view;o.add(TweenLite.to(a.displayGroup,2*xyd.TweenDeltaTime,{rotation:-10,ease:Linear.easeNone})),o.add(TweenLite.to(a.displayGroup,2*xyd.TweenDeltaTime,{rotation:10,ease:Linear.easeNone})),o.repeat(-1),o.play(),a.setDisplayTween(o)},e.prototype._dpColorTargetEnd=function(e){var t=this,i=e.data.ele,n=this.logicToView(new egret.Point(i.x,i.y));i.view.clearDisplayTween(),i.view.displayGroup.rotation=0;var o=this._dpColorTargetEffMap[i.id];o&&(o.animation.stop(),this._win.effectLayer.removeChild(o),EffectFactory.get().pushBackEffect(o),delete this._dpColorTargetEffMap[i.id]);var a;if(this._bombExplodeCovers.length>0)a=this._bombExplodeCovers.pop();else{var s=RES.getRes("bomb_explode_png");a=new egret.Bitmap(s)}if(a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=n.x,a.y=n.y,this.leafLayer.addChild(a),void 0!=a){var r=new TimelineLite;a.alpha=0,r.add(TweenLite.to(a,.1,{alpha:1,ease:Linear.easeNone}),0),r.add(TweenLite.to(a,.6,{alpha:0,ease:Linear.easeNone}),.2),r.call(function(){a&&a.parent&&(a.parent.removeChild(a),t._bombExplodeCovers.push(a))},void 0,void 0,.8),EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_TARGET,function(e){e.x=n.x,e.y=n.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))}},e.prototype._activateWand=function(){var e=this._board;e.setWandState(!0);var t=this._win;this._wandTargetManager=new WandTargetManager(e);EffectFactory.get().newEffect(EffectConstants.ITEM_WAND_EFFECT,function(i){for(var n=this,o=function(o){var s=a._wandTargetManager.getTarget(),r=void 0;s.hasElement()?r=s.getElement():s.hasBlocker()&&(r=s.getBlocker());var l=void 0;l=void 0==r.color||0==r.color?CellConstants.ELEMENT_COLOR_RANDOM:r.color;var _=e.getElementFactory().create(r.col,r.row,l,ElementTypeConstants.BOMB_SQUARE),h=r.getLock();void 0!=h&&_.addLock(h);var c=a.logicToView(new egret.Point(_.x,_.y));if(egret.setTimeout(function(){i.x=c.x,i.y=c.y,0==o&&t.effectLayer.addChild(i),i.animation.play("texiao01",1),egret.setTimeout(function(){SoundManager.getInstance().playEffect("se_item_wand_mp3");var t=!0,i=e.getGridContainerAt(_.col,_.row);if(i&&i.hasElement()){var n=i.getElement();!n||n.type!=ElementTypeConstants.LAMP_1&&n.type!=ElementTypeConstants.LAMP_2||(t=!1)}t&&(e.replaceTo(_),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,_)))},n,17e3*xyd.TweenDeltaTime)},a,4e4*o*xyd.TweenDeltaTime),egret.setTimeout(function(){e.addForRemoval(_,0,DamageSource.WAND),e.setWandState(!1)},a,13e4*xyd.TweenDeltaTime),2==o){var d=function(e){this.itemCanTouch=!0,i.removeDBEventListener("complete",d,this),i.animation.stop(),t.effectLayer.removeChild(i),EffectFactory.get().pushBackEffect(i)};i.addDBEventListener("complete",d,a)}},a=this,s=0;3>s;s++)o(s)}.bind(this)),this.clearPossibleMove()},e.prototype._removeAllEvents=function(){for(var e in this._listeningEvents)xyd.EventDispatcher.inner().removeEventListener(e,this._listeningEvents[e],this);this._listeningEvents={}},e.prototype.start=function(e){this._win.setCanTouch(!0)},e.prototype.preparePlay=function(){},e.prototype.beginPlay=function(){},e.prototype.prepareEnd=function(){},e.prototype.gameplayEnd=function(){},e.prototype.shuffleCandy=function(){},e.prototype.addScore=function(e){},e.prototype._boardInitDone=function(e){},e.prototype.checkGuide=function(){if(!this._board.isRecovered()&&GuideHelper.hasGuideForLevel(this._level)){this._currenGuideID=GuideHelper.getNextGuideID(this._level,-1),this._win.setGuide(this._currenGuideID);for(var e=0;e<this._displayTargetGroup.length;e++)this._displayTargetGroup[e].visible=!0;GuideHelper.isInGuide=!0,1==this._level&&(this._shouldLogGuideLoss=!0)}},e.prototype.boardStar=function(){this._scoreTargets=this._board.getScoreTargets();var e=this._scoreTargets[2],t=this._scoreTargets[0]/e*this.star_group.width-.5*this.star_group.width,i=this._scoreTargets[1]/e*this.star_group.width-.5*this.star_group.width;this.star_1.horizontalCenter=t,this.star_2.horizontalCenter=i,this.star_1.visible=!0,this.star_2.visible=!0,this.star_3.visible=!0},e.prototype.boardSize=function(e){var t=this,i=e.data.maxHeight,n=e.data.minHeight,o=e.data.maxWidth,a=e.data.minWidth;this._win.setBoardPos(o,a,i,n),this.checkBoardBoundary(),egret.setTimeout(function(){t.bottomLayer.cacheAsBitmap=!0},this,3e3)},e.prototype.checkBoardBoundary=function(){this._cellMap=this._board.getCellMap();for(var e=this._board.getBoardCols(),t=this._board.getBoardRows(),i=-1;e+1>i;i++)for(var n=-1;t+1>n;n++)this.isCellEmpty(i,n)&&this.addBoardBoundary(i,n)},e.prototype.isCellEmpty=function(e,t){var i=this._board.getBoardCols();this._board.getBoardRows();if(-1>=e||e>=i||-1>=t||t>=i)return!0;var n=this._cellMap[t][e];return void 0==n?!0:n.isEmpty()?!0:!1},e.prototype.addBoardBoundary=function(e,t){var i=this.isCellEmpty(e+1,t),n=this.isCellEmpty(e-1,t),o=this.isCellEmpty(e,t+1),a=this.isCellEmpty(e,t-1),s=this.isCellEmpty(e+1,t+1),r=this.isCellEmpty(e-1,t+1),l=this.isCellEmpty(e+1,t-1),_=this.isCellEmpty(e-1,t-1),h=xyd.TILE_WIDTH,c=xyd.TILE_HEIGHT;if(!i){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+1);var u=d.getbitmap();d.rotation=-90,d.y+=3,d.x+=h-5,u.width=c,s&&(d.y-=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),l&&(u.width-=this.TILE_BOUNDARY),l||a||(u.width-=this.TILE_BOUNDARY),s||o||(d.y-=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),this.bottomLayer.addChild(d)}if(!n){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+1);var u=d.getbitmap();d.rotation=90,d.y-=3,d.x-=h-5,u.width=c,r&&(u.width-=this.TILE_BOUNDARY),_&&(d.y+=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),_||a||(d.y+=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),r||o||(u.width-=this.TILE_BOUNDARY),this.bottomLayer.addChild(d)}if(!o){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+1);var u=d.getbitmap();d.y+=c-this.TILE_BOUNDARY,u.width=h,s&&(u.width-=this.TILE_BOUNDARY),r&&(d.x+=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),s||i||(u.width-=this.TILE_BOUNDARY),r||n||(d.width-=this.TILE_BOUNDARY,u.x+=this.TILE_BOUNDARY),this.bottomLayer.addChild(d)}if(!a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+1);var u=d.getbitmap();d.rotation=180,d.y+=this.TILE_BOUNDARY,d.y-=c,u.width=h,l&&(d.x-=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),_&&(u.width-=this.TILE_BOUNDARY),l||i||(d.x-=this.TILE_BOUNDARY,u.width-=this.TILE_BOUNDARY),_||n||(u.width-=this.TILE_BOUNDARY),this.bottomLayer.addChild(d)}if(!l&&i&&a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+2),d.rotation=-90,d.x+=c,d.y-=h,d.x-=11,d.y+=5,this.bottomLayer.addChild(d)}if(!_&&n&&a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+2),d.rotation=180,d.x-=c,d.y-=h,d.x+=14,d.y+=2,this.bottomLayer.addChild(d)}if(!s&&i&&o){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+2),d.x+=c,d.y+=h,d.x-=14,d.y-=2,this.bottomLayer.addChild(d)}if(!r&&n&&o){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+2),d.rotation=90,d.x-=c,d.y+=h,d.x+=11,d.y-=5,this.bottomLayer.addChild(d)}if(!l&&!i&&!a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.rotation=90,d.x-=2,d.y-=4,this.bottomLayer.addChild(d)}if(!_&&!n&&!a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.x-=1,d.y-=1,this.bottomLayer.addChild(d)}if(!s&&!i&&!o){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.rotation=180,d.x+=1,this.bottomLayer.addChild(d)}if(!r&&!n&&!o){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.rotation=-90,d.x+=2,d.y+=3,this.bottomLayer.addChild(d)}if(l&&!i&&!a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.rotation=90,d.y-=4,d.x-=2,this.bottomLayer.addChild(d);var m=new ElementView;m.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),m.rotation=270,m.x+=h,m.y-=c,m.y+=4,this.bottomLayer.addChild(m)}if(_&&!n&&!a){var d=new ElementView,p=this.logicToView(new egret.Point(e,t));d.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),d.rotation=0,d.x-=1,d.y-=1,this.bottomLayer.addChild(d);var m=new ElementView;m.setProp(p.x,p.y,DisplayConstants.BOUNDARY_TYPE_START+3),m.rotation=180,m.x+=1,m.y+=1,m.x-=h,m.y-=c,this.bottomLayer.addChild(m)}},e.prototype.gameEnd=function(e){this._doTestMoves=!1,this._win.gameEnd(),this.clearPossibleMove()},e.prototype.gameResume=function(e){SoundManager.getInstance().playBg("bgm_level_mp3"),this._win.gameResume(),this._win.setCanTouch(!0)},e.prototype.gameScore=function(e){var t=this;this._scoreTargets&&this._scoreTargets.length<3&&this.boardStar();var i=e.data.score,n=e.data.create||!1;if(i>0){this._lastScore<this._scoreTargets[0]&&i>=this._scoreTargets[0]&&UpdateBeat.Once(function(){t.star_1.source="icon_star3_png";var e;e=new egret.Point(t.star_1.x,t.star_1.y),t.starAnimation(1,e)},this),this._lastScore<this._scoreTargets[1]&&i>=this._scoreTargets[1]&&UpdateBeat.Once(function(){t.star_2.source="icon_star3_png";var e;e=new egret.Point(t.star_2.x,t.star_2.y),t.starAnimation(2,e)},this),this._lastScore<this._scoreTargets[2]&&i>=this._scoreTargets[2]&&UpdateBeat.Once(function(){t.star_3.source="icon_star3_png";var e;e=new egret.Point(t.star_3.x,t.star_3.y),t.starAnimation(3,e)},this);var o=i/this._scoreTargets[2];o>1&&(o=1),this._win.setScore(i,o,n)}else this._win.setScore(i,0,n);this._lastScore=i},e.prototype.gameScoreTarget=function(e){var t=e.data.scoreTarget;if(this._gameMode.modeName()==GameModeConstants.CLASSIC_MOVES){var i=new eui.Image;xyd.setUISprite(i,"text_mubiao"),this.group_target.addChild(i),i.left=.072*this.group_target.width,i.verticalCenter=0;var n=new eui.Group;n.height=i.height,n.width=i.width,this.scoreTargetNum&&xyd.bitmapNumber.destroyNumPic(this.scoreTargetNum);var o;t>9999999?(this.scoreTargetNum=xyd.bitmapNumber.createNumPic(t,"non_11_"),this.scoreTargetNum.scaleX=.9,this.scoreTargetNum.scaleY=.9,i.scaleX=1,i.scaleY=1,o=1,xyd.bitmapNumber.setNumGap(this.scoreTargetNum,-10)):t>999999&&1e7>t?(this.scoreTargetNum=xyd.bitmapNumber.createNumPic(t,"non_11_"),this.scoreTargetNum.scaleX=1,this.scoreTargetNum.scaleY=1,i.scaleX=1.1,i.scaleY=1.1,o=2,xyd.bitmapNumber.setNumGap(this.scoreTargetNum,-10)):(this.scoreTargetNum=xyd.bitmapNumber.createNumPic(t,"non_11_"),xyd.bitmapNumber.setNumGap(this.scoreTargetNum,-10),this.scoreTargetNum.scaleX=1.1,this.scoreTargetNum.scaleY=1.1,i.scaleX=1.2,i.scaleY=1.2,o=3),this.scoreTargetNum.x=(n.width-xyd.bitmapNumber.getWidth(this.scoreTargetNum))/2,this.scoreTargetNum.y=(n.height-xyd.bitmapNumber.getHeight(this.scoreTargetNum))/2-o,n.addChild(this.scoreTargetNum),this.group_target.addChild(n),n.left=.52*this.group_target.width,n.verticalCenter=0}},e.prototype.starAnimation=function(e,t){0!=t.x&&EffectFactory.get().newEffect(EffectConstants.RECEIVE_STAR_EFFECT,function(e){e.x=t.x+26,e.y=t.y+25,this.star_1.parent.addChild(e),e.animation.play("texiao01",1);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.stopStepAnimation=function(){var e=this._stepEff;void 0!=e&&(e.animation.stop(),e.visible=!1,e.parent.removeChild(e),e.dispose(),this._stepEff=void 0,this._stepTw&&(this._stepTw.kill(),this._stepTw=void 0))},e.prototype.stepAnimation=function(e){var t=this;egret.setTimeout(function(){EffectFactory.get().newEffect(EffectConstants.STEPS_REMINDER,function(t){t.x=e.x,t.y=e.y,this.step_.parent.addChildAt(t,0),t.animation.timeScale=2,t.scaleX=1.2,t.scaleY=1.2,t.animation.play("texiao01",-1),this._stepEff=t}.bind(t))},this,15e3*xyd.TweenDeltaTime);var i=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0});i.timeScale(2);var n=this.step_.getChildByName("stepNum");i.fromTo(n,22.5*xyd.frameScale,{scaleX:.9,scaleY:.9},{scaleX:1.1,scaleY:1.1}),this._stepTw=i},e.prototype._updateStartTarget=function(e,t){if(-1!=t){var i=new GameTargetView(e,0,this.labeTarget);if(Number(e)==ObjectiveConstants.SLATE){var n=this._board.checkHasCellStone();n&&i.changeSlateToStone()}this.group_start_target.addChild(i)}},e.prototype.gameStage=function(e){var t=0,i=!0;if(this._board.isRecovered()||GuideHelper.hasGuideForLevel(this._level))i=!1;else{var n=this._board.getGameMode(),o=n.modeName();switch(o){case GameModeConstants.CLASSIC_MOVES:var a=450,s=144;this.mode1_score1.x=a;var r=this.group_mode1;this._swapNumber&&xyd.bitmapNumber.destroyNumPic(this._swapNumber),this._swapNumber=xyd.bitmapNumber.createNumPic(n.getMovesLeft(),"non_p_"),xyd.bitmapNumber.setNumGap(this._swapNumber,-5),this._swapNumber.x=a+this.mode1_score1.width,this._swapNumber.y=s,r.addChild(this._swapNumber),this.mode1_score2.x=a+this.mode1_score1.width+xyd.bitmapNumber.getWidth(this._swapNumber),this._scoreNumber&&xyd.bitmapNumber.destroyNumPic(this._scoreNumber),this._scoreNumber=xyd.bitmapNumber.createNumPic(this._board.getScoreTarget(),"non_p_"),xyd.bitmapNumber.setNumGap(this._scoreNumber,-5),this._scoreNumber.x=this.mode1_score2.x+this.mode1_score2.width,this._scoreNumber.y=s,r.addChild(this._scoreNumber),this.mode1_score3.x=this.mode1_score2.x+this.mode1_score2.width+xyd.bitmapNumber.getWidth(this._scoreNumber),this.showShuffleTips(this.group_mode1,!1),t=1;break;case GameModeConstants.LAMP:this.showShuffleTips(this.group_mode3,!0),t=3;break;case GameModeConstants.LEAF:this.showShuffleTips(this.group_mode2,!0),t=2;break;case GameModeConstants.OBJECTIVE:this.showShuffleTips(this.group_mode4,!0),t=4;for(var l=this._board.getGameConf().objectives,_=0;_<l.length;_++)this._updateStartTarget(String(l[_].item),l[_].quantity);break;case GameModeConstants.LEAF_LAMP:this.showShuffleTips(this.group_mode4,!0),t=4;for(var _=0;_<this._targetkeys.length;_++)this._updateStartTarget(this._targetkeys[_],1);break;case GameModeConstants.LEAF_OBJECTIVE:this.showShuffleTips(this.group_mode4,!0),t=4;for(var _=0;_<this._targetkeys.length;_++)this._updateStartTarget(this._targetkeys[_],1);
break;default:this.showShuffleTips(this.group_mode4,!0),t=4;for(var _=0;_<this._targetkeys.length;_++)this._updateStartTarget(this._targetkeys[_],1)}}i&&(xyd.isiOS8?this.showAnnaImg():this.showAnnaAnimation(t))},e.prototype.initStepAnimation=function(){var e;e=new egret.Point(this.step_.x+this.step_.width/2,this.step_.y+this.step_.height/2),this.stepAnimation(e)},e.prototype.gameStep=function(e){var t=e.data.step,i=e.data.create||!1;void 0!=this._stepEff&&t>3&&this.stopStepAnimation(),3>=t&&!this._stepEff&&!e.data.lightoff&&UpdateBeat.Once(this.initStepAnimation,this),void 0!=this._stepEff&&0==t&&this.stopStepAnimation(),this._win.setStep(t,i)},e.prototype.addBase=function(e){var t=e.data.i,i=e.data.j,n=e.data.type;void 0==n&&(n=0);var o=new ElementView,a=this.logicToView(new egret.Point(t,i));if(n==DisplayConstants.DROP_DOWN){a.y-=35;var s=a.y;o.scaleY=1.25;var r=new TimelineMax;r.add(TweenLite.to(o,15*xyd.TweenDeltaTime,{scaleX:.85,ScaleY:1.4,y:s+5})),r.add(TweenLite.to(o,15*xyd.TweenDeltaTime,{scaleX:1,ScaleY:1.25,y:s})),r.repeat(-1),r.play(),this._usingTimelines.push(r)}else a.x-=1,a.y-=1;if(o.setProp(a.x,a.y,n),platform.inDebugMode()&&void 0!=this.debugLayer){var l=new egret.TextField;l.textColor=0,l.text="("+t+", "+i+")",l.x=a.x-xyd.TILE_WIDTH_HALF,l.y=a.y-xyd.TILE_HEIGHT_HALF,this.debugLayer.addChild(l)}var _=9*i+t;this._baseMap[_]=o,n==DisplayConstants.DROP_DOWN?this.effectLayer.addChild(o):this.bottomLayer.addChild(o)},e.prototype.getBaseViewAt=function(e,t){var i=9*t+e;return this._baseMap[i]},e.prototype.activeElement=function(e){var t=e.data;t.view.setLight(!0)},e.prototype.replaceElement=function(e){var t=e.data.newEle,i=e.data.oldEle;i&&i.view&&(i.view.dispose(),delete this.elementMap[i.id]);var n=this.logicToView(new egret.Point(t.col,t.row)),o=new ElementView,a=0;if(t.type==ElementTypeConstants.CAKE){var s=t;a=s.hp}if(t.type==ElementTypeConstants.BALLOON){var r=t;a=r.hp}t.type==ElementTypeConstants.CAKE&&SoundManager.getInstance().playEffect("se_special_cake_mp3");var l="",_="texiao01";l&&""!=l&&EffectFactory.get().newEffect(l,function(e){e.x=n.x,e.y=n.y,e.animation.play(_,1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),o.setProp(n.x,n.y,t.color+a,t.type,void 0,t.getSpecialDrop()),o.setGameView(this),t.type==ElementTypeConstants.CAKE&&o.initCake(t.hp,!0),t.type==ElementTypeConstants.BALLOON&&o.initBalloon(t.hp,!0),t.view=o;var h=new TimelineLite;h.add(TweenLite.to(o.displayGroup,3*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Power2.easeOut})),h.add(TweenLite.to(o.displayGroup,3*xyd.TweenDeltaTime,{scaleX:1.4,scaleY:1.4,ease:Power2.easeOut})),h.add(TweenLite.to(o.displayGroup,5*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Power2.easeOut})),h.add(TweenLite.to(o.displayGroup,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Power2.easeOut})),o.setDisplayTween(h),this.elementMap[t.id]=o,this.elementLayer.addChild(o)},e.prototype.addLeaf=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.getCol(),t.getRow()));2==t.getLeafType()&&(n.x-=9,n.y-=9.5),i.setProp(n.x,n.y,t.getLeafType()+DisplayConstants.LEAF_TYPE_START,0),i.setGameView(this),t.view=i,this.leafLayer.addChild(i)},e.prototype.addLock=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.col,t.row));1==t.type?(n.x-=8,n.y-=11):t.type==LOCK_TYPE.GIFT_WRAPPER&&this._setGiftWrapperBottom(t),i.setProp(n.x,n.y,t.type+DisplayConstants.LOCK_TYPE_START,0,t.health),i.setGameView(this),t.view=i,this._lockToViewMap[t.id]=i,this.lockLayer.addChild(i);var o=this._board.getElementAtGrid(t.col,t.row);o&&o.view&&o.view.setTimeLabelLock(!0)},e.prototype._setGiftWrapperBottom=function(e){var t=this.logicToView(new egret.Point(e.col,e.row)),i=RES.getRes("icon_giftwrapper_bottom_png"),n=new egret.Bitmap(i);n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=t.x,n.y=t.y,this.leafLayer.addChild(n),e.addBottomBitmap(n)},e.prototype.addEdges=function(e){for(var t=e.data,i=this.logicToView(new egret.Point(t.Col,t.Row)),n=0;4>n;n++)if(void 0!=t.Vertices[n]&&(t.Vertices[n].x=i.x,t.Vertices[n].y=i.y,n==CellVerticesDirection.LEFTUP?(t.Vertices[n].x-=59,t.Vertices[n].y-=62):n==CellVerticesDirection.RIGHTUP?(t.Vertices[n].x+=59,t.Vertices[n].y-=62):n==CellVerticesDirection.RIGHTDOWN?(t.Vertices[n].x+=59,t.Vertices[n].y+=62):n==CellVerticesDirection.LEFTDOWN&&(t.Vertices[n].x-=59,t.Vertices[n].y+=62),this.edgeLayer.addChildAt(t.Vertices[n],0)),void 0!=t.Edges[n]){var o=new ElementView,a=t.Edges[n].health;o.setProp(i.x,i.y,t.Edges[n].type+DisplayConstants.BLOCKER_TYPE_START+a-1,0,a);var s=22;3==a&&(s=27),0==n&&(o.y-=s),1==n?(o.y-=s,o.y+=124):2==n?(o.rotation=90,o.x+=s,o.x-=118):3==n&&(o.x+=s,o.rotation=90),o.setGameView(this),t.Edges[n].view=o,this.edgeLayer.addChild(o)}},e.prototype.addBlocker=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.col,t.row)),o=t.health-1;t.type==BlockerConstant.COLOR_MIXER?i.setProp(n.x,n.y,t.type+DisplayConstants.BLOCKER_TYPE_START,this._board.getGameConf().colorMixerInterval,o):i.setProp(n.x,n.y,t.type+DisplayConstants.BLOCKER_TYPE_START,0,o),i.setGameView(this);var a="",s=this.logicToView(new egret.Point(t.col,t.row));t.type==BlockerConstant.CLOUD?a=EffectConstants.BLOCK_CLOUD_GENERATION:t.type==BlockerConstant.SNOW&&(a=EffectConstants.BLOCK_SNOW_GENERATION),a.length>0&&EffectFactory.get().newEffect(a,function(e){e.x=s.x,e.y=s.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),t.view=i,this.blockerMap[t.id]=i,this.blockerLayer.addChild(i),t.type==BlockerConstant.CLOUD||t.type==BlockerConstant.CLOUD_ROCKET?this.checkNearCloudCenter(t.col,t.row):t.type==BlockerConstant.SNOW&&this.checkNearSnowCenter(t.col,t.row)},e.prototype.checkNearSnowCenter=function(e,t){this.checkNearSnow(e,t),this.isSnow(e-1,t)&&this.checkNearSnow(e-1,t),this.isSnow(e+1,t)&&this.checkNearSnow(e+1,t),this.isSnow(e,t-1)&&this.checkNearSnow(e,t-1),this.isSnow(e,t+1)&&this.checkNearSnow(e,t+1),this.isSnow(e-1,t-1)&&this.checkNearSnow(e-1,t-1),this.isSnow(e+1,t-1)&&this.checkNearSnow(e+1,t-1),this.isSnow(e-1,t+1)&&this.checkNearSnow(e-1,t+1),this.isSnow(e+1,t+1)&&this.checkNearSnow(e+1,t+1)},e.prototype.checkNearCloudCenter=function(e,t){this.checkNearCloud(e,t),this.isCould(e-1,t)&&this.checkNearCloud(e-1,t),this.isCould(e+1,t)&&this.checkNearCloud(e+1,t),this.isCould(e,t-1)&&this.checkNearCloud(e,t-1),this.isCould(e,t+1)&&this.checkNearCloud(e,t+1),this.isCould(e-1,t-1)&&this.checkNearCloud(e-1,t-1),this.isCould(e+1,t-1)&&this.checkNearCloud(e+1,t-1),this.isCould(e-1,t+1)&&this.checkNearCloud(e-1,t+1),this.isCould(e+1,t+1)&&this.checkNearCloud(e+1,t+1)},e.prototype.checkNearSnow=function(e,t){var i=this._board.getBlockerAtGrid(e,t);if(i){var n=[];this.isSnow(e-1,t)?n.push(1):n.push(0),this.isSnow(e+1,t)?n.push(1):n.push(0),this.isSnow(e,t-1)?n.push(1):n.push(0),this.isSnow(e,t+1)?n.push(1):n.push(0),this.isSnow(e-1,t-1)?n.push(1):n.push(0),this.isSnow(e+1,t-1)?n.push(1):n.push(0),this.isSnow(e-1,t+1)?n.push(1):n.push(0),this.isSnow(e+1,t+1)?n.push(1):n.push(0),i.view&&i.view.checkNearSnow(n)}},e.prototype.checkNearCloud=function(e,t){var i=this._board.getBlockerAtGrid(e,t);if(i){var n=[];this.isCould(e-1,t)?n.push(1):n.push(0),this.isCould(e+1,t)?n.push(1):n.push(0),this.isCould(e,t-1)?n.push(1):n.push(0),this.isCould(e,t+1)?n.push(1):n.push(0),this.isCould(e-1,t-1)?n.push(1):n.push(0),this.isCould(e+1,t-1)?n.push(1):n.push(0),this.isCould(e-1,t+1)?n.push(1):n.push(0),this.isCould(e+1,t+1)?n.push(1):n.push(0),i.view&&i.view.checkNearCloud(n)}},e.prototype.isSnow=function(e,t){var i=this._board.getBlockerAtGrid(e,t);return i&&i.type==BlockerConstant.SNOW?!0:!1},e.prototype.isCould=function(e,t){var i=this._board.getBlockerAtGrid(e,t);if(i){if(i.type==BlockerConstant.CLOUD)return!0;if(i.type==BlockerConstant.CLOUD_ROCKET)return!0}return!1},e.prototype.removePuzzle=function(e){var t=e.data;this._puzzleElement=t,SoundManager.getInstance().playEffect("se_special_jigsaw_mp3"),this.removePuzzleStep1()},e.prototype.removePuzzleStep1=function(){var e;e=this.logicToView(new egret.Point(this._puzzleElement.x+.5,this._puzzleElement.y+1.5)),EffectFactory.get().newEffect(EffectConstants.JIGSAW_FIREWORK,function(t){this._puzzleEff=t,t.x=e.x,t.y=e.y,this.effectLayer.addChild(t),t.animation.play("texiao01",1);var i=function(e){t.removeDBEventListener("complete",i,this),t.animation.play("texiao02",1),this.removePuzzleStep2()};t.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.removePuzzleStep2=function(){var e=this,t=new TimelineLite,i=9-this._puzzleElement.y,n=2*i*xyd.TweenDeltaTime,o=this.logicToView(new egret.Point(this._puzzleElement.x+.5,this._puzzleElement.y+1.5)),a=this.logicToView(new egret.Point(this._puzzleElement.x+.5,9));t.add(TweenLite.to(this._puzzleEff,3*xyd.TweenDeltaTime,{x:o.x,y:o.y-2*xyd.TILE_HEIGHT,ease:Power4.easeOut})),t.add(TweenLite.to(this._puzzleEff,n,{x:a.x,y:a.y,ease:Power1.easeIn})),t.call(function(){e.removePuzzleStep3()})},e.prototype.removePuzzleStep3=function(){var e=this,t=this._puzzleEff;t.animation.play("texiao04",1);var i=function(e){t.removeDBEventListener("complete",i,this),t.animation.stop(),this.effectLayer.removeChild(t),EffectFactory.get().pushBackEffect(t)};t.addDBEventListener("complete",i,this),egret.setTimeout(function(){e.removePuzzleStep5()},this,7*xyd.TweenDeltaTime*1e3)},e.prototype.removePuzzleStep4=function(){var e=this,t=this.logicToView(new egret.Point(this._puzzleElement.x+1,7)),i=this.logicToView(new egret.Point(3.5,3)),n=new egret.Bitmap;RES.getResAsync("puzzle_bomb_png",function(e){n&&(n.texture=e)},this),n.x=t.x,n.y=t.y,n.anchorOffsetX=96,n.anchorOffsetY=109,n.y=t.y,this.effectLayer.addChild(n);var o=new TimelineLite;o.add(TweenLite.to(n,10*xyd.TweenDeltaTime,{rotation:720}),0),o.add(TweenLite.to(n,10*xyd.TweenDeltaTime,{x:i.x,y:i.y}),0),o.call(function(){n.parent&&n.parent.removeChild(n),e.removePuzzleStep5()})},e.prototype.removePuzzleStep5=function(){var e=this.logicToView(new egret.Point(this._puzzleElement.x+.5,this._puzzleElement.y+.5));EffectFactory.get().newEffect(EffectConstants.BLOCKER_JIGSAW_DISTRUCTION,function(t){t.x=e.x,t.y=e.y,t.scaleX=2,t.scaleY=2,t.visible=!0,this.effectLayer.addChildAt(t,0),t.animation.play("texiao01",1);var i=function(e){t.removeDBEventListener("complete",i,this),t.animation.stop(),this.effectLayer.removeChild(t),EffectFactory.get().pushBackEffect(t)};t.addDBEventListener("complete",i,this)}.bind(this));var t=this.logicToView(new egret.Point(3.5,3));this._puzzleElement.view.dispose(),EffectFactory.get().newEffect(EffectConstants.BOMB_FIREWORK,function(e){e.x=t.x,e.y=t.y,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.addPuzzle=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.x,t.y));i.setProp(n.x,n.y,DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.PUZZLE,0,DisplayConstants.PUZZLE_BOTTOM),i.setGameView(this),t.view=i,this.elementLayer.addChildAt(i,0)},e.prototype.addGenerator=function(e){var t=20,i=e.data,n=this.logicToView(new egret.Point(i.col,i.row-1)),o=new eui.Group;o.x=n.x,o.y=n.y+55,o.width=xyd.TILE_WIDTH,o.anchorOffsetX=xyd.TILE_WIDTH_HALF,o.anchorOffsetY=xyd.TILE_HEIGHT_HALF;var a=new eui.HorizontalLayout;a.gap=-17,a.horizontalAlign="center",a.verticalAlign="center",o.layout=a,this.effectLayer.addChild(o);for(var s=0;s<i.types.length;s++){var r=i.types[s];if(r!=CellConstants.GENERATOR_ELEMENT){var l=new eui.Image;l.source=DisplayConstants.GeneratorSourceMap[r],l.scaleX=.4,l.scaleY=.4,(r==CellConstants.GENERATOR_BOX||r==CellConstants.BLACK_HOLE)&&(l.scaleX=.38,l.scaleY=.38),l.anchorOffsetX=xyd.TILE_WIDTH_HALF,l.anchorOffsetY=xyd.TILE_HEIGHT_HALF,o.addChild(l)}}EffectFactory.get().newEffect(EffectConstants.BASKET_EFFECT,function(e){this.generatorMap[10*i.col+i.row]={effect:e,state:0,frame:0,group:o},e.x=n.x+3,e.y=n.y+t,this.effectLayer.addChildAt(e,0),e.animation.play("texiao04",-1)}.bind(this))},e.prototype.addElement=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.col,t.row)),o=0;if(t.type==ElementTypeConstants.CAKE){var a=t;o=a.hp}if(t.type==ElementTypeConstants.BALLOON){var s=t;o=s.hp}i.setProp(n.x,n.y,t.color+o,t.type,void 0,t.getSpecialDrop()),i.setGameView(this),t.view=i;var r=this.elementMap[t.id];if(r&&r.dispose(),this.elementMap[t.id]=i,this.elementLayer.addChild(i),t.type==ElementTypeConstants.TIME_BOMB)t.view.initTimeBomb(t.getTicksToExplode());else if(t.type==ElementTypeConstants.CAKE)t.view.initCake(t.hp);else if(t.type==ElementTypeConstants.BALLOON)t.view.initBalloon(t.hp);else if(t.type==ElementTypeConstants.ROCKET){var l=t;l.view.name="RealRocketView",t.view.changeRocket(l.color,l.rocketState,l.rocketType)}if(t.type>=ElementTypeConstants.BOMB_ROW&&t.type<=ElementTypeConstants.BOMB_COLOR){var _=new TimelineLite;t&&t.view&&(t.view.filters=[xyd.lightFilter]),_.add(TweenLite.fromTo(t.view.displayGroup,.23,{scaleX:1,scaleY:1,rotation:-20},{scaleX:1.8,scaleY:1.8,ease:Power1.easeOut}),0),_.add(TweenLite.to(t.view.displayGroup,.1,{scaleX:1,scaleY:1,ease:Power1.easeOut}),.23),_.add(TweenLite.to(t.view.displayGroup,.23,{rotation:20,ease:Linear.easeNone}),0),_.add(TweenLite.to(t.view.displayGroup,.1,{rotation:0,ease:Linear.easeNone}),.23),_.call(function(){t&&t.view&&(t.view.filters=[])}),t.view&&t.view.setDisplayTween(_),EffectFactory.get().newEffect(EffectConstants.SPECIAL_GENERATION,function(e){e.x=n.x,e.y=n.y,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))}},e.prototype.createSpecial=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row));t.type!=ElementTypeConstants.NORMAL&&EffectFactory.get().newEffect(EffectConstants.SPECIAL_GENERATION,function(e){e.x=i.x,e.y=i.y,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.boardFakeElementPortal=function(e){var t=e.data,i=new ElementView,n=this.logicToView(new egret.Point(t.col,t.row)),o=t.type;o==ElementTypeConstants.BLACK_HOLE&&(o=ElementTypeConstants.NORMAL),i.setProp(n.x,n.y,t.color,o),i.setGameView(this),i.id=this.maxFakeElement,this.maxFakeElement++,this.fakeElementView[i.id]=i,this.elementLayer.addChild(i);var a=new egret.Rectangle(0,0,xyd.TILE_WIDTH,xyd.TILE_HEIGHT);i.displayGroup.mask=a,i.ya=t.ya;i.scaleY=1.25},e.prototype.timeBombExplode=function(e){var t=e.data,i=(t.view,this.logicToView(new egret.Point(t.col,t.row)));SoundManager.getInstance().playEffect("se_special_bomb_mp3"),EffectFactory.get().newEffect(EffectConstants.TIMEBOMB_EXPLODE,function(e){e.x=i.x,e.y=i.y,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.upateTimeBomb=function(e){var t=e.data,i=t.view;t.type==ElementTypeConstants.TIME_BOMB&&i.changeNumTimeBomb(t.getTicksToExplode())},e.prototype.colorMixerLaunch=function(e){var t=e.data.col,i=e.data.row,n=this.logicToView(new egret.Point(t,i));SoundManager.getInstance().playEffect("se_palette_finish_mp3"),EffectFactory.get().newEffect(EffectConstants.COLORMIXER_FINISH,function(e){e.x=n.x,e.y=n.y+10,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.colorMixerAddColor=function(e){var t=e.data.key,i=e.data.step,n=e.data.interval,o=Math.floor(t/9),a=t%9,s=this._board.getBlockerAtGrid(a,o);s&&s.type==BlockerConstant.COLOR_MIXER&&s.view.changeColorMixer(i,n)},e.prototype.boardEnter=function(e){var t=e.data;t.view.updatePos(t.x,t.y);var i=(this.logicToView(new egret.Point(t.col,t.row+1)),new egret.Rectangle(0,0,xyd.TILE_WIDTH,xyd.TILE_HEIGHT));i.y=xyd.TILE_HEIGHT,t.view.mask=i;var n=10*t.col+t.row+1;if(this.generatorMap[n]){var o=this.generatorMap[n].effect,a=this.generatorMap[n].state,s=this.generatorMap[n].group;this.generatorMap[n].frame=0,s.visible=!1,0==a&&(this.generatorMap[n].state=1,SoundManager.getInstance().playEffect("se_special_basket_mp3"),o.animation.play("texiao01",1))}},e.prototype.boardEnterCompelete=function(e){var t=e.data;t.view.mask=void 0},e.prototype.elementEnterBoard=function(e){var t=e.data.col,i=e.data.row,n=e.data.col,o=e.data.row+1,a=e.data.frames,s=this.logicToView(new egret.Point(n,o)),r=this._board.getElementAtGrid(t,i),l=new TimelineLite,_=a*xyd.TweenDeltaTime;l.add(TweenLite.to(r.view,_,{x:s.x,y:s.y}),0)},e.prototype.elementSlideTo=function(e){var t=(e.data.fromCol,e.data.fromRow,e.data.toCol),i=e.data.toRow,n=e.data.frames,o=e.data.element,a=this.logicToView(new egret.Point(t,i)),s=new TimelineLite,r=n*xyd.TweenDeltaTime;s.add(TweenLite.to(o.view,r,{x:a.x,y:a.y,ease:Linear.easeNone})),o.view&&o.view.setMoveTween(s)},e.prototype.element_reach_end=function(e){if(!this._belt_state){var t=e.data;if(t&&t.view&&!t.view.isDisposed()){if(t.isMovingOnBelt)return void(t.isMovingOnBelt=!1);var i=new TimelineLite;i.add(TweenLite.fromTo(t.view.displayGroup,.1,{scaleX:1,scaleY:1.25,y:xyd.TILE_HEIGHT_HALF},{scaleX:1.1,scaleY:.9,y:xyd.TILE_HEIGHT_HALF+9.3,ease:Linear.easeNone}),0),i.add(TweenLite.to(t.view.displayGroup,.13,{scaleX:.95,scaleY:1.05,y:xyd.TILE_HEIGHT_HALF-6.2,ease:Linear.easeNone}),.1),i.add(TweenLite.to(t.view.displayGroup,.1,{scaleX:1.02,scaleY:.98,y:xyd.TILE_HEIGHT_HALF+2.5,ease:Linear.easeNone}),.26),i.add(TweenLite.to(t.view.displayGroup,.1,{scaleX:1,scaleY:1,y:xyd.TILE_HEIGHT_HALF,ease:Linear.easeNone}),.39),t.view.setDisplayTween(i)}}},e.prototype.set_belt_state=function(e){var t=e.data.state;this._belt_state=t,this.playBeltAnimation()},e.prototype.playBeltAnimation=function(){if(this._belt_state){SoundManager.getInstance().playEffect("se_special_chuansong_mp3");for(var e in this.beltProtalOutMap){var t=this.beltProtalOutMap[e],i=this.beltPortalColorMap[e];if(i&&t){var n=BeltConstants.COLOR_TO_EFFECT_MAP[i][1];t.animation.play(n,0)}}for(var e in this.beltProtalEnterMap){var t=this.beltProtalEnterMap[e],i=this.beltPortalColorMap[e];if(i&&t){var n=BeltConstants.COLOR_TO_EFFECT_MAP[i][1];t.animation.play(n,0)}}for(var o=0,a=this.beltCellViewList;o<a.length;o++){var s=a[o];s.playAmination()}}else{for(var e in this.beltProtalOutMap){var t=this.beltProtalOutMap[e],i=this.beltPortalColorMap[e];if(i&&t){var n=BeltConstants.COLOR_TO_EFFECT_MAP[i][0];t.animation.play(n,0)}}for(var e in this.beltProtalEnterMap){var t=this.beltProtalEnterMap[e],i=this.beltPortalColorMap[e];if(i&&t){var n=BeltConstants.COLOR_TO_EFFECT_MAP[i][0];t.animation.play(n,0)}}}},e.prototype.playRemoveElementRocket=function(e){var t=e.data.from,i=e.data.to,n=this.logicToView(new egret.Point(i.col,i.row)),o=(this.logicToView(new egret.Point(t.col,t.row)),t.view.x),a=t.view.y,s=0,r=i.view;r.parent.addChild(r),i.col==t.col?i.row>t.row?a+=this.REMOVE_MOVE_PIXEL:a-=this.REMOVE_MOVE_PIXEL:(s=1,i.col>t.col?o+=this.REMOVE_MOVE_PIXEL:o-=this.REMOVE_MOVE_PIXEL),this.rocketClear(i);var l=new TimelineLite,_=3*xyd.TweenDeltaTime;l.add(TweenLite.to(t.view,_,{x:o,y:a}),0),l.add(TweenLite.to(t.view,_,{x:n.x,y:n.y}),_),t.view&&t.view.setMoveTween(l),EffectFactory.get().newEffect(EffectConstants.SPECIAL_GENERATION_SPEEDLINE,function(e){e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_HEIGHT_HALF,1==s?e.rotation=90:e.rotation=0,t.view.displayGroup.addChild(e),e.animation.play("texiao01",1);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.playRemoveElementSpecial=function(e){var t=e.data.element,i=e.data.match,n=this.logicToView(new egret.Point(i.col,i.row)),o=(this.logicToView(new egret.Point(t.col,t.row)),t.view.x),a=t.view.y,s=0;i.col==t.col?i.row>t.row?a+=this.REMOVE_MOVE_PIXEL:a-=this.REMOVE_MOVE_PIXEL:(s=1,i.col>t.col?o+=this.REMOVE_MOVE_PIXEL:o-=this.REMOVE_MOVE_PIXEL);var r=new TimelineLite,l=3*xyd.TweenDeltaTime;r.add(TweenLite.to(t.view,l,{x:o,y:a}),0),r.add(TweenLite.to(t.view,l,{x:n.x,y:n.y}),l),t.view&&t.view.setMoveTween(r),EffectFactory.get().newEffect(EffectConstants.SPECIAL_GENERATION_SPEEDLINE,function(e){e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_HEIGHT_HALF,1==s?e.rotation=90:e.rotation=0,t.view.displayGroup.addChild(e),e.animation.play("texiao01",1);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.playRemoveElementAnimationByPuzzle=function(e){var t=e.data,i=(this.logicToView(new egret.Point(t.x,t.y)),5),n=new TimelineLite,o=i*xyd.TweenDeltaTime;n.add(TweenLite.to(t.view,o,{scaleX:0,scaleY:0}),0),t.view&&t.view.setMoveTween(n)},e.prototype.playRemoveElementAnimation=function(e){var t=e.data;if(t.type!=ElementTypeConstants.BOMB_COLOR){var i=this.logicToView(new egret.Point(t.x,t.y));if(t.type==ElementTypeConstants.LAMP_1||t.type==ElementTypeConstants.LAMP_2)return void this.elementLeave(e);var n="texiao01",o="",a=1;switch(t.color){case CellConstants.CELL_COLOR_RANDOM:case CellConstants.COLOR_RED:o=EffectConstants.NORMAL_DESTRUCTION_RED;break;case CellConstants.COLOR_ORANGE:o=EffectConstants.NORMAL_DESTRUCTION_ORANGE;break;case CellConstants.COLOR_PINK:o=EffectConstants.NORMAL_DESTRUCTION_PINK;break;case CellConstants.COLOR_GREEN:o=EffectConstants.NORMAL_DESTRUCTION_GREEN;break;case CellConstants.COLOR_BLUE:o=EffectConstants.NORMAL_DESTRUCTION_BLUE;break;case CellConstants.COLOR_PURPLE:o=EffectConstants.NORMAL_DESTRUCTION_PURPLE}switch(t.type){case ElementTypeConstants.BOX:o=EffectConstants.ELEMENT_DESTRUCTION_JAR,SoundManager.getInstance().playEffect("se_special_jar_mp3");break;case ElementTypeConstants.CAKE:o=EffectConstants.ELEMENT_DESTRUCTION_CAKE,SoundManager.getInstance().playEffect("se_special_cake1_mp3");break;case ElementTypeConstants.TIME_BOMB:o=EffectConstants.ELEMENT_DESTRUCTION_TIMBBOMB;break;case ElementTypeConstants.TORNADO:o=EffectConstants.ELEMENT_DESTRUCTION_ACTIVE_TORNADO,SoundManager.getInstance().playEffect("se_special_tornado_mp3");break;case ElementTypeConstants.LUCKY_BAG:o=EffectConstants.ELEMENT_DESTRUCTION_LUCKYBAG,SoundManager.getInstance().playEffect("se_special_package_mp3");break;case ElementTypeConstants.GOLDEN_EGG:o=EffectConstants.ELEMENT_DESTRUCTION_GOLDENEGG,SoundManager.getInstance().playEffect("se_special_eggshell_mp3");break;case ElementTypeConstants.BALLOON:o=EffectConstants.ELEMENT_DESTRUCTION_BALLOON,SoundManager.getInstance().playEffect("se_special_ballon_mp3");break;case ElementTypeConstants.CRAYON:SoundManager.getInstance().playEffect("se_special_crayon_mp3")}if(""!=o){switch(t.type){case ElementTypeConstants.LUCKY_BAG:case ElementTypeConstants.GOLDEN_EGG:switch(t.color){case CellConstants.CELL_COLOR_RANDOM:case CellConstants.COLOR_RED:n="texiao01";break;case CellConstants.COLOR_ORANGE:n="texiao02";break;case CellConstants.COLOR_PINK:n="texiao03";break;case CellConstants.COLOR_GREEN:n="texiao04";break;case CellConstants.COLOR_BLUE:n="texiao05";break;case CellConstants.COLOR_PURPLE:n="texiao06"}break;case ElementTypeConstants.BALLOON:n="texiao04"}switch(t.type){case ElementTypeConstants.LUCKY_BAG:case ElementTypeConstants.GOLDEN_EGG:a=2}EffectFactory.get().newEffect(o,function(e){e.x=i.x,e.y=i.y,1==a?this.effectLayer.addChild(e):this.effectLayer.addChildAt(e,0),e.animation.play(n,1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this));var s=new TimelineLite;s.add(TweenLite.fromTo(t.view,.1,{scaleX:1,scaleY:1},{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),s.call(function(){t.view.setFilter([xyd.lightFilter])}),s.add(TweenLite.fromTo(t.view,.3,{scaleX:1.1,scaleY:1.1},{scaleX:.15,scaleY:.15,ease:Linear.easeNone}),.1),t.view&&t.view.setMoveTween(s)}}},e.prototype.playFlySpecialDropAniamtion=function(e){var t=this,i=e.data.ele;if(i.getSpecialDrop()&&i.view&&i.view.getDropBitmap()){var n=(this.effectLayer.localToGlobal(),i.view.getDropBitmap().localToGlobal()),o=this._win.getFundHead().localToGlobal(),a=new egret.Bitmap;xyd.setBitmapAsync(a,"fund_hongbao_icon",function(){a.x=n.x,a.y=n.y,a.width=ElementView.DROP_BITMAP_WIDTH,a.height=ElementView.DROP_BITMAP_HEIGHT}),this._win.addChild(a);var s=(a.y,new TimelineLite);s.add(TweenLite.to(a,.5,{x:o.x+30,y:o.y,ease:Power1.easeIn,scaleX:3,scaleY:3}),0),s.call(function(){var e=t._win.fundNum;t._win.fundSet(e+1),a&&a.parent&&a.parent.removeChild(a),a=void 0})}},e.prototype.removeLock=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row)),n=EffectConstants.LOCK_DESTRUCTION_SHACKLE;if(t.type==LOCK_TYPE.GIFT_WRAPPER){var o=this._board.getElementAtGrid(t.col,t.row);return o&&o.view&&o.view.setTimeLabelLock(!1),t.removeBottomBitmap(),t.view.giftWrapperRemove(),void delete this._lockToViewMap[t.id]}switch(delete this._lockToViewMap[t.id],t.type){case LOCK_TYPE.SHACKLE:n=EffectConstants.LOCK_DESTRUCTION_SHACKLE,SoundManager.getInstance().playEffect("se_special_chain_mp3");break;case LOCK_TYPE.ICE:n=EffectConstants.LOCK_DESTRUCTION_ICE,SoundManager.getInstance().playEffect("se_special_ice_mp3")}EffectFactory.get().newEffect(n,function(e){e.x=i.x,e.y=i.y,this.effectLayer.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),t.view&&t.view.dispose();var a=this._board.getElementAtGrid(t.col,t.row);a&&a.view&&a.view.setTimeLabelLock(!1)},e.prototype.replaceLock=function(e){var t=e.data;this.logicToView(new egret.Point(t.col,t.row));switch(t.type){case LOCK_TYPE.ICE:SoundManager.getInstance().playEffect("se_special_ice_mp3");break;case LOCK_TYPE.SHACKLE:SoundManager.getInstance().playEffect("se_special_chain_mp3")}t.view.replaceWrapper(t.health),t.view.setTimeLabelLock(!1)},e.prototype.replaceBlock=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row)),n=t.health-1,o="";switch(t.type){case BlockerConstant.SLATE:o=EffectConstants.BLOCKER_DESTRUCTION_SLATE,SoundManager.getInstance().playEffect("se_special_stone_mp3");break;case BlockerConstant.LAYED_SLATE:o=EffectConstants.BLOCKER_DESTRUCTION_LAYED_SLATE,SoundManager.getInstance().playEffect("se_special_box_mp3");break;case BlockerConstant.PUZZLE:o=EffectConstants.BLOCKER_DESTRUCTION_PUZZLE;break;case BlockerConstant.CLOUD:o=EffectConstants.BLOCK_DESTRUCTION_CLOUD,SoundManager.getInstance().playEffect("se_special_cloud_mp3");break;case BlockerConstant.CLOUD_ROCKET:o=EffectConstants.BLOCK_DESTRUCTION_CLOUD,SoundManager.getInstance().playEffect("se_special_cloud_mp3");break;case BlockerConstant.SNOW:o=EffectConstants.BLOCKER_DESTRUCTION_SNOW,SoundManager.getInstance().playEffect("se_special_snowman_mp3");break;case BlockerConstant.COLOR_MIXER:o=EffectConstants.COLORMIXER_ATTACK[this._board.getGameConf().colorMixerInterval-2],SoundManager.getInstance().playEffect("se_palette_broken_mp3");break;case BlockerConstant.CURLS:o=""}if(""!=o&&EffectFactory.get().newEffect(o,function(e){e.x=i.x,e.y=i.y,t.type==BlockerConstant.COLOR_MIXER&&(e.y+=12),e.animation.play("texiao01",1),this.effectLayer.addChild(e);var n=function(t){e.removeDBEventListener("complete",n,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",n,this)}.bind(this)),t.type==BlockerConstant.COLOR_MIXER)t.view.replaceColorMixer(n,this._board.getGameConf().colorMixerInterval);else if(t.type==BlockerConstant.PUZZLE){var a=t;this.replacePuzzle(a)}else if(t.type==BlockerConstant.CURLS){var s=t;t.view.setProp(t.view.x,t.view.y,t.type+DisplayConstants.BLOCKER_TYPE_START+n,0,n),n+1==2&&(s.direction==CellEdgesDirection.UP||s.direction==CellEdgesDirection.DOWN?t.view.y+=5:t.view.x+=5)}else t.view.setProp(i.x,i.y,t.type+DisplayConstants.BLOCKER_TYPE_START,0,n)},e.prototype.replacePuzzle=function(e){var t=e.health+3*(e.positionID-1)-1,i=e.col*xyd.TILE_WIDTH,n=e.row*xyd.TILE_HEIGHT,o=e.health,a=new egret.Bitmap,s=t,r=DisplayConstants.puzzleSourceMap[t];if(1==e.health&&(s=DisplayConstants.PUZZLE_FAKE_START+e.positionID-1,r=DisplayConstants.puzzleSourceMap[s]),r&&(a.texture=RES.getRes(r)),a.scaleX=0,a.scaleY=0,1==e.health){a.anchorOffsetX=92,a.anchorOffsetY=100,a.x=i+xyd.TILE_WIDTH_HALF,a.y=n+xyd.TILE_HEIGHT_HALF;var l=[[],[1,1],[-1,1],[1,-1],[-1,-1]];a.anchorOffsetX+=l[e.positionID][0]*xyd.TILE_WIDTH_HALF/2,a.anchorOffsetY+=l[e.positionID][1]*xyd.TILE_HEIGHT_HALF/2,a.x+=l[e.positionID][0]*xyd.TILE_WIDTH_HALF/2,a.y+=l[e.positionID][1]*xyd.TILE_HEIGHT_HALF/2}else a.anchorOffsetX=xyd.TILE_WIDTH_HALF,a.anchorOffsetY=xyd.TILE_HEIGHT_HALF,a.x=i+xyd.TILE_WIDTH_HALF,a.y=n+xyd.TILE_HEIGHT_HALF;this.effectLayer.addChild(a);var _=new TimelineLite;_.add(TweenLite.to(a,10*xyd.TweenDeltaTime,{scaleX:0,scaleY:0})),_.add(TweenLite.to(a,15*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2})),_.add(TweenLite.to(a,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1})),_.call(function(){a.parent&&a.parent.removeChild(a),e.view.setProp(i,n,DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.PUZZLE,0,t),e.resetAnchor(o)})},e.prototype.replaceLeaf=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.getCol(),t.getRow()));SoundManager.getInstance().playEffect("se_special_grass_mp3"),t.view.setProp(i.x,i.y,t.getLeafType()+DisplayConstants.LEAF_TYPE_START,0);var n=this.logicToView(new egret.Point(t.getCol(),t.getRow()));EffectFactory.get().newEffect(EffectConstants.LEAF_DESTRUCTION,function(e){e.x=n.x,e.y=n.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.replaceRocket=function(e){var t=e.data,i=this._board.getElementAtGrid(t.x,t.y);i&&i.view&&i.view.changeRocket(t.color,t.rocketState,t.rocketType)},e.prototype.removeLeaf=function(e){var t=e.data;SoundManager.getInstance().playEffect("se_special_grass_mp3");var i=this.logicToView(new egret.Point(t.getCol(),t.getRow()));EffectFactory.get().newEffect(EffectConstants.LEAF_DESTRUCTION,function(e){e.x=i.x,e.y=i.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),t.view&&t.view.dispose()},e.prototype.hideBlocker=function(e){var t=e.data;if(t&&t.view){var i=t.view;i.visible=!1}},e.prototype.removeBlocker=function(e){var t=e.data;delete this.blockerMap[t.id];var i=this.logicToView(new egret.Point(t.col,t.row)),n=EffectConstants.BLOCKER_DESTRUCTION_SLATE;switch(t.type){case BlockerConstant.PUZZLE:n="";
break;case BlockerConstant.SLATE:n=EffectConstants.BLOCKER_DESTRUCTION_SLATE,SoundManager.getInstance().playEffect("se_special_stone_mp3");break;case BlockerConstant.LAYED_SLATE:n=EffectConstants.BLOCKER_DESTRUCTION_LAYED_SLATE,SoundManager.getInstance().playEffect("se_special_box_mp3");break;case BlockerConstant.CLOUD:n=EffectConstants.BLOCK_DESTRUCTION_CLOUD,SoundManager.getInstance().playEffect("se_special_cloud_mp3");break;case BlockerConstant.CLOUD_ROCKET:n=EffectConstants.BLOCK_DESTRUCTION_CLOUD,SoundManager.getInstance().playEffect("se_special_cloud_mp3");break;case BlockerConstant.SNOW:n=EffectConstants.BLOCKER_DESTRUCTION_SNOW,SoundManager.getInstance().playEffect("se_special_snowman_mp3");break;case BlockerConstant.COLOR_MIXER:n="";break;case BlockerConstant.CURLS:n=""}if(n.length>0&&EffectFactory.get().newEffect(n,function(e){e.x=i.x,e.y=i.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),t.view&&t.view.dispose(),(t.type==BlockerConstant.CLOUD||t.type==BlockerConstant.CLOUD_ROCKET)&&this.checkNearCloudCenter(t.col,t.row),t.type==BlockerConstant.SNOW&&this.checkNearSnowCenter(t.col,t.row),t.type==BlockerConstant.CURLS){var o=t;if(o.direction==CellEdgesDirection.UP){var a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.LEFTUP);void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.LEFT)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row-1,CellEdgesDirection.LEFT)&&void 0==this._board.getCellFenceAtGridInDir(o.col-1,o.row,CellEdgesDirection.UP)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0),a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.RIGHTUP),void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.RIGHT)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row-1,CellEdgesDirection.RIGHT)&&void 0==this._board.getCellFenceAtGridInDir(o.col+1,o.row,CellEdgesDirection.UP)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0)}else if(o.direction==CellEdgesDirection.DOWN){var a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.LEFTDOWN);void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.LEFT)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row+1,CellEdgesDirection.LEFT)&&void 0==this._board.getCellFenceAtGridInDir(o.col-1,o.row,CellEdgesDirection.DOWN)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0),a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.RIGHTDOWN),void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.RIGHT)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row+1,CellEdgesDirection.RIGHT)&&void 0==this._board.getCellFenceAtGridInDir(o.col+1,o.row,CellEdgesDirection.DOWN)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0)}else if(o.direction==CellEdgesDirection.RIGHT){var a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.RIGHTUP);void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.UP)&&void 0==this._board.getCellFenceAtGridInDir(o.col+1,o.row,CellEdgesDirection.UP)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row-1,CellEdgesDirection.RIGHT)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0),a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.RIGHTDOWN),void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.DOWN)&&void 0==this._board.getCellFenceAtGridInDir(o.col+1,o.row,CellEdgesDirection.DOWN)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row+1,CellEdgesDirection.RIGHT)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0)}else if(o.direction==CellEdgesDirection.LEFT){var a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.LEFTUP);void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.UP)&&void 0==this._board.getCellFenceAtGridInDir(o.col-1,o.row,CellEdgesDirection.UP)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row-1,CellEdgesDirection.LEFT)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0),a=this._board.getCellVerticeAtGridInDirection(o.col,o.row,CellVerticesDirection.LEFTDOWN),void 0!=a&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row,CellEdgesDirection.DOWN)&&void 0==this._board.getCellFenceAtGridInDir(o.col-1,o.row,CellEdgesDirection.DOWN)&&void 0==this._board.getCellFenceAtGridInDir(o.col,o.row+1,CellEdgesDirection.LEFT)&&(this.edgeLayer.removeChild(a),a.cellEdges.Vertices[a.direction]=void 0)}}},e.prototype.removeElement=function(e){var t=e.data.ele;switch(t.type){case ElementTypeConstants.SCISSOR:SoundManager.getInstance().playEffect("se_special_scissors_mp3")}delete this.elementMap[t.id],t.view&&t.view.dispose()},e.prototype.elementLeave=function(e){var t=this,i=e.data;i.view&&(i.view.visible=!1);for(var n,o,a=this.logicToView(new egret.Point(i.x,i.y)),s=i.type==ElementTypeConstants.LAMP_1?"lantern_1_png":"lantern_2_png",r=0,l=this._displayTargetGroup;r<l.length;r++){var _=l[r];if(_.name==s){var h=_.localToGlobal();n=h.x,o=h.y}}var c=60,d=new TimelineMax,p=(c*xyd.TweenDeltaTime,new ElementView);p.setProp(a.x,a.y,0,i.type),a=i.view.localToGlobal(),p.setGameView(this),this._win.addChild(p),a.x+=xyd.TILE_WIDTH_HALF,a.y+=xyd.TILE_HEIGHT_HALF,p.x=a.x,p.y=a.y;var u=50*Math.sqrt((a.x-n)*(a.x-n)+(a.y-o)*(a.y-o))/1500*xyd.TweenDeltaTime;d.add(TweenMax.to(p,3*xyd.TweenDeltaTime,{scaleX:2.5,scaleY:2.5}),0),d.add(TweenMax.to(p,4*xyd.TweenDeltaTime,{scaleX:1.8,scaleY:1.8}),3*xyd.TweenDeltaTime),d.add(TweenMax.to(p,4*xyd.TweenDeltaTime,{scaleX:2.1,scaleY:2.1}),7*xyd.TweenDeltaTime),d.add(TweenMax.to(p,8*xyd.TweenDeltaTime,{scaleX:2,scaleY:2}),11*xyd.TweenDeltaTime),d.add(TweenMax.to(p,u-19*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9}),19*xyd.TweenDeltaTime),d.add(TweenMax.to(p,u,{bezier:[{x:a.x,y:a.y+100},{x:a.x-100,y:a.y+80},{x:n+54,y:o+55}],ease:Sine.easeIn,autoRotate:!1}),0),d.call(function(){EffectFactory.get().newEffect(EffectConstants.TARGET_COLLECT_NORMAL,function(e){e.x=n+54,e.y=o+55,this._win.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(t))}),d.call(function(){t._win.removeChild(p),p.dispose(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_UPDATE_LAMP_TARGET,!1,!0,{type:i.type}))})},e.prototype.viewToLogicSimpleX=function(e){return Math.floor((e-59)/xyd.elementWidth)},e.prototype.viewToLogicSimpleY=function(e){return Math.floor((e-62)/xyd.elementHeight)},e.prototype.logicToviewSimpleX=function(e){return Math.floor(e*xyd.elementWidth+59)},e.prototype.logicToviewSimpleY=function(e){return Math.floor(e*xyd.elementHeight+62)},e.prototype.viewToLogic=function(e){var t=new egret.Point(Math.floor((e.x-59)/xyd.elementWidth),Math.floor((e.y-62)/xyd.elementHeight));return t},e.prototype.logicToView=function(e){var t=new egret.Point(Math.floor(e.x*xyd.elementWidth+59),Math.floor(e.y*xyd.elementHeight+62));return t},e.prototype.viewToLogicFloat=function(e){var t=new egret.Point((e.x-59)/xyd.elementWidth,(e.y-62)/xyd.elementHeight);return t},e.prototype.logicToViewFloat=function(e){var t=new egret.Point(e.x*xyd.elementWidth+59,e.y*xyd.elementHeight+62),i=100,n=this._win.group_board.scaleX;return 1>n&&(i+=1080*(1-n)),e.x<=-1&&(t.x=-i),e.x>=9&&(t.x=xyd.getWidth()+i),t},e.prototype.viewToLogicTouch=function(e){var t=new egret.Point(Math.floor(e.x/xyd.elementWidth),Math.floor(e.y/xyd.elementHeight));return t},e.prototype.logicToViewTouch=function(e){var t=new egret.Point(Math.floor(e.x*xyd.elementWidth),Math.floor(e.y*xyd.elementHeight));return t},e.prototype.playInVaildSwapAnimation=function(e){var t=this,i=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),n=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(void 0!=i&&void 0!=n){var o=i.view,a=n.view,s=this.logicToView(e.fromColRow),r=this.logicToView(e.toColRow),l=new TimelineLite,_=.2,h=.15,c=1.5,d=.5,p=this.elementMap[i.id];p.parent.addChild(p),l.add(TweenLite.to(o,_,{x:r.x,y:r.y}),0),l.add(TweenLite.to(a,_,{x:s.x,y:s.y}),0),l.add(TweenLite.to(a,_/2,{scaleX:d,scaleY:d}),0),l.add(TweenLite.to(o,_/2,{scaleX:c,scaleY:c}),0),l.add(TweenLite.to(a,_/2,{scaleX:1,scaleY:1}),_/2),l.add(TweenLite.to(o,_/2,{scaleX:1,scaleY:1}),_/2),l.call(function(){var e=t.elementMap[n.id];e&&e.parent&&e.parent.addChild(e)}),l.add(TweenLite.to(a,h/2,{scaleX:c,scaleY:c}),_),l.add(TweenLite.to(o,h/2,{scaleX:d,scaleY:d}),_),l.add(TweenLite.to(a,h/2,{scaleX:1,scaleY:1}),_+h/2),l.add(TweenLite.to(o,h/2,{scaleX:1,scaleY:1}),_+h/2),l.add(TweenLite.to(o,h,{x:s.x,y:s.y}),_),l.add(TweenLite.to(a,h,{x:r.x,y:r.y}),_),l.call(function(){}),p&&p.setMoveTween(l)}},e.prototype.playInValidSwapByFenceAnimation=function(e){var t=this,i=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),n=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(void 0!=i&&void 0!=n){var o=i.view,a=n.view,s=this.logicToView(e.fromColRow),r=this.logicToView(e.toColRow),l=new TimelineLite,_=.2,h=.15,c=1.2,d=.8,p=this.elementMap[i.id],u=.2,m=r.x-s.x,g=r.y-s.y;p.parent.addChild(p),l.add(TweenLite.to(o,_,{x:s.x+m*u,y:s.y+g*u}),0),l.add(TweenLite.to(a,_,{x:r.x-m*u,y:r.y-g*u}),0),l.add(TweenLite.to(a,_/2,{scaleX:c,scaleY:c}),0),l.add(TweenLite.to(o,_/2,{scaleX:c,scaleY:c}),0),l.add(TweenLite.to(a,_/2,{scaleX:1,scaleY:1}),_/2),l.add(TweenLite.to(o,_/2,{scaleX:1,scaleY:1}),_/2),l.call(function(){var e=t.elementMap[n.id];e&&e.parent&&e.parent.addChild(e)}),l.add(TweenLite.to(a,h/2,{scaleX:d,scaleY:d}),_),l.add(TweenLite.to(o,h/2,{scaleX:d,scaleY:d}),_),l.add(TweenLite.to(a,h/2,{scaleX:1,scaleY:1}),_+h/2),l.add(TweenLite.to(o,h/2,{scaleX:1,scaleY:1}),_+h/2),l.add(TweenLite.to(o,h,{x:s.x,y:s.y}),_),l.add(TweenLite.to(a,h,{x:r.x,y:r.y}),_),l.call(function(){t._win.setCanTouch(!0)}),p&&p.setMoveTween(l)}},e.prototype.doSwap=function(e){var t=this;this.clearPossibleMove(),this.clearLeafLight(),this.stopBlackHoleEffect();var i=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),n=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(void 0!=i&&void 0!=n){var o=i.view,a=n.view,s=this.logicToView(e.fromColRow),r=this.logicToView(e.toColRow),l=new TimelineLite,_=.2,h=1.5,c=.5,d=this.elementMap[i.id];d.parent.addChild(d),l.add(TweenLite.to(o,_,{x:r.x,y:r.y}),0),l.add(TweenLite.to(a,_,{x:s.x,y:s.y}),0),l.add(TweenLite.to(a,_/2,{scaleX:c,scaleY:c}),0),l.add(TweenLite.to(o,_/2,{scaleX:h,scaleY:h}),0),l.add(TweenLite.to(a,_/2,{scaleX:1,scaleY:1}),_/2),l.add(TweenLite.to(o,_/2,{scaleX:1,scaleY:1}),_/2),l.call(function(){t._board.doSwap(e),t._movesUsed+=1,t._shouldLogGuideLoss&&t._movesUsed<7&&logger.logGuideLoss(3,t._movesUsed)}),d&&d.setMoveTween(l)}},e.prototype.doInValidSwap=function(e){this.clearPossibleMove(),e.swapFailType==SwapFailTypeConstants.RESIST_BY_FENCE?this.playInValidSwapByFenceAnimation(e):this.playInVaildSwapAnimation(e)},e.prototype.addScoreAnimation=function(e,t,i,n){0==n&&(n=2);var o="non_"+(n-1)+"_",a=xyd.bitmapNumber.createNumPic(i,o);a.x=e-xyd.elementWidth/2+20,i>99&&(a.x-=20),i>999&&(a.x-=20),a.y=t-xyd.elementHeight/4;var s=(a.x,a.y);this.effectLayer.addChild(a);var r=new TimelineLite;a.alpha=.9,r.add(TweenLite.fromTo(a,.2,{scaleX:0,scaleY:0},{scaleX:1,scaleY:1,ease:Power2.easeIn})),r.add(TweenLite.fromTo(a,.2,{y:s,scaleX:1,scaleY:1},{y:s-20,ease:Linear.ease})),r.add(TweenLite.to(a,.5,{alpha:0,ease:Power2.easeOut}),.7),r.call(function(){xyd.bitmapNumber.destroyNumPic(a),a.parent&&a.parent.removeChild(a)})},e.prototype.unselectElement=function(e,t){if(void 0!=e&&void 0!=t){var i=this._board.getElementAtGrid(e,t);i&&i.view&&i.view.setSelect(!1)}},e.prototype.selectElement=function(e,t){if(void 0!=e&&void 0!=t){var i=this._board.getElementAtGrid(e,t);i&&i.view&&i.view.setSelect(!0,e,t)}},e.prototype.showBigDpLine=function(e,t,i,n){var o=this.logicToView(new egret.Point(e,t));EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_LINE,function(e){e.x=o.x,e.y=o.y,e.rotation=0,1==n?(e.animation.play("texiao01",1),e.scaleX=3,e.scaleY=3,e.rotation=90):(e.animation.play("texiao01",1),e.scaleY=3,e.scaleX=3),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.dpSoundNormal=function(e){var t=this._dpSoundCount%7+1,i="se_normal_distruction"+t+"_mp3";SoundManager.getInstance().playEffect(i),this._dpSoundCount++},e.prototype.dpLine=function(e){this._win.shakeBoard(1),SoundManager.getInstance().playEffect("se_special_distruction_row_mp3");var t=e.data.direction,i=e.data.x,n=e.data.y,o=(e.data.color,this.logicToView(new egret.Point(i,n)));EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_LINE,function(e){e.x=o.x,e.y=o.y,e.scaleX=1,e.scaleY=1,1==t?(e.animation.play("texiao01",1),e.rotation=90):e.animation.play("texiao01",1),this.effectLayer.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.bombAroundAnimation=function(e,t,i){if(1==i)for(var n=0;5>n;n++)for(var o=0;5>o;o++){var a=this._board.getElementAtGrid(e-2+n,t-2+o);a&&!a.isSticky()&&this.bombAroundAnimationSingle(a.view,a.col,a.row,e,t)}else for(var n=0;9>n;n++)for(var o=0;9>o;o++){var a=this._board.getElementAtGrid(e-4+n,t-4+o);a&&!a.isSticky()&&this.bombAroundAnimationSingle(a.view,a.col,a.row,e,t)}},e.prototype.bombAroundAnimationSingle=function(e,t,i,n,o){if(e&&!e.isDisposed()){var a=new TimelineLite,s=(e.x,e.y,t-n),r=i-o,l=Math.sqrt(s*s+r*r),_=s/Math.abs(t-n),h=r/Math.abs(i-o),c=0==_?1:.8,d=0==h?1:.8,p=0==_?0:.2*xyd.TILE_WIDTH*_,u=0==h?0:.2*xyd.TILE_HEIGHT*h;a.add(TweenLite.to(e.displayGroup,2*l*xyd.TweenDeltaTime,{}),0),a.add(TweenLite.to(e.displayGroup,7*xyd.TweenDeltaTime,{scaleX:c,scaleY:d,x:xyd.TILE_WIDTH_HALF+p,y:xyd.TILE_HEIGHT_HALF+u}),2*l*xyd.TweenDeltaTime),a.add(TweenLite.to(e.displayGroup,7*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,x:xyd.TILE_WIDTH_HALF,y:xyd.TILE_HEIGHT_HALF}),2*l*xyd.TweenDeltaTime+7*xyd.TweenDeltaTime),e.getLockState()&&e.bombNumberGroup&&(a.add(TweenLite.to(e.bombNumberGroup,2*l*xyd.TweenDeltaTime,{}),0),a.add(TweenLite.to(e.bombNumberGroup,7*xyd.TweenDeltaTime,{scaleX:c,scaleY:d,x:e.bombNumberGroup.x+p,y:e.bombNumberGroup.y+u}),2*l*xyd.TweenDeltaTime),a.add(TweenLite.to(e.bombNumberGroup,7*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,x:e.bombNumberGroup.x,y:e.bombNumberGroup.y}),2*l*xyd.TweenDeltaTime+7*xyd.TweenDeltaTime)),e.setDisplayTween(a)}},e.prototype.matchComboEffect=function(e){var t=(new egret.Bitmap,DisplayConstants.MatchComboEffect[e.data]);switch(e.data){case MatchComboConstants.TYPE_FANTASTIC:SoundManager.getInstance().playEffect("se_fantastic_mp3");break;case MatchComboConstants.TYPE_WONDERFUL:SoundManager.getInstance().playEffect("se_wonderful_mp3");break;case MatchComboConstants.TYPE_GREAT:SoundManager.getInstance().playEffect("se_great_mp3");break;case MatchComboConstants.TYPE_GOOD:SoundManager.getInstance().playEffect("se_good_mp3")}e.data!=MatchComboConstants.TYPE_GOOD&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ANNA_HEAD_STATE,!1,!1,3)),this._disposeComboEffect(),this._comboEffect=new ComboEffectView,this.group_tips.addChild(this._comboEffect),this._comboEffect.setAnimation(t)},e.prototype.dpColorColorInitExplosion=function(e){for(var t=e.data.combinedPoint,i=e.data.scale,n=this.logicToView(t),o=0,a=this._fakeViews;o<a.length;o++){var s=a[o];s.parent&&(s.parent.removeChild(s),s.dispose())}EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_SQUARE,function(e){e.x=n.x,e.y=n.y,e.animation.play("texiao01",1),e.scaleX=i,e.scaleY=i,this.effectLayer.addChild(e),this._dpColorColorEffectMap.push(e)}.bind(this))},e.prototype.dpBomb=function(e){this._win.shakeBoard(1);var t=e.data.bomb_times;0==t?SoundManager.getInstance().playEffect("se_special_distruction_bomb1_mp3"):SoundManager.getInstance().playEffect("se_special_distruction_bomb2_mp3");var i=e.data.x,n=e.data.y,o=(e.data.color,e.data.scale);this.bombAroundAnimation(i,n,o),60==xyd.frameRate&&this._playBombAreaAnim(i,n,o);var a=this.logicToView(new egret.Point(i,n));EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_SQUARE,function(e){e.x=a.x,e.y=a.y,1==o?e.animation.play("texiao01",1):(e.animation.play("texiao01",1),e.scaleX=1.5,e.scaleY=1.5),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype._playBombAreaAnim=function(e,t,i){i>1?this._playHugeBombAreaAnim(e,t):this._playNormalBombAreaAnim(e,t)},e.prototype._playNormalBombAreaAnim=function(e,t){var i=this,n=new TimelineLite,o=this._getBombExplodeCovers(e,t,1),a=this._getBombExplodeCovers(e,t,2);n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.31,i.leafLayer.addChild(o)}},[o],void 0,1*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(o,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[o]},0),3*xyd.TweenDeltaTime),n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.31,i.leafLayer.addChild(o)}},[a],void 0,4*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(a,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[a]},0),6*xyd.TweenDeltaTime),this._usingTimelines.push(n)},e.prototype._playHugeBombAreaAnim=function(e,t){var i=this,n=new TimelineLite;this._usingTimelines.push(n);var o=this._getBombExplodeCovers(e,t,1),a=this._getBombExplodeCovers(e,t,2),s=this._getBombExplodeCovers(e,t,3),r=this._getBombExplodeCovers(e,t,4);n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.31,i.leafLayer.addChild(o)}},[o],void 0,1*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(o,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[o]},0),3*xyd.TweenDeltaTime),n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.43,i.leafLayer.addChild(o)}},[a],void 0,2*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(a,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[a]},0),4*xyd.TweenDeltaTime),n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.31,i.leafLayer.addChild(o)}},[s],void 0,4*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(s,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[s]},0),6*xyd.TweenDeltaTime),n.call(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.alpha=.31,i.leafLayer.addChild(o)}},[r],void 0,6*xyd.TweenDeltaTime),n.add(TweenMax.staggerFromTo(r,18*xyd.TweenDeltaTime,{alpha:.43},{alpha:0,ease:Linear.easeNone,onComplete:function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.parent&&(o.parent.removeChild(o),i._bombExplodeCovers.push(o))}},onCompleteParams:[r]},0),8*xyd.TweenDeltaTime)},e.prototype._getBombExplodeCovers=function(e,t,i){for(var n=[],o=Math.max(0,e-i),a=Math.min(this._board.getBoardCols()-1,e+i),s=Math.max(0,t-i),r=Math.min(this._board.getBoardRows()-1,t+i),l=o;a>=l;l++)for(var _=s;r>=_;_++)if((l!=e||_!=t)&&Math.abs(l-e)+Math.abs(_-t)==i){if(this._board.isVoidCell(l,_))continue;var h=void 0;if(this._bombExplodeCovers.length>0)h=this._bombExplodeCovers.pop();else{var c=RES.getRes("bomb_explode_png");h=new egret.Bitmap(c),h.anchorOffsetX=68,h.anchorOffsetY=71}var d=this.logicToView(new egret.Point(l,_));h.x=d.x,h.y=d.y,h.alpha=0,n.push(h)}if(1==i){var c=RES.getRes("bomb_explode_png"),h=new egret.Bitmap(c);h.anchorOffsetX=94,h.anchorOffsetY=96;var d=this.logicToView(new egret.Point(e,t));h.x=d.x,h.y=d.y,h.alpha=0,n.push(h)}return n},e.prototype.dpColorColorInitEffect=function(e){var t=e.data.combinedPoint,i=this.logicToView(t);EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_DOUBLE,function(e){return this._isDisposed?void EffectFactory.get().pushBackEffect(e):(e.x=i.x,e.y=i.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e),void this._dpColorColorEffectMap.push(e))}.bind(this))},e.prototype.dpColorInit=function(e){SoundManager.getInstance().playEffect("se_special_distruction_color_mp3");var t=e.data.x,i=e.data.y,n=e.data.id,o=this.logicToView(new egret.Point(t,i));EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_EFFECT,function(e){return 1==this._colorNeedDelEffects[n]?(this._colorNeedDelEffects[n]=0,void EffectFactory.get().pushBackEffect(e)):(e.x=o.x,e.y=o.y,e.animation.play("texiao01",0),this.effectLayer.addChild(e),this._colorElementEffects.push(e),void(this._colorNeedDelEffects[n]=0))}.bind(this))},e.prototype.dpColorColorInit=function(e){SoundManager.getInstance().playEffect("se_special_distruction_color2_mp3");var t=e.data.fromEle,i=e.data.toEle,n=t.view;if(t.type==ElementTypeConstants.ROCKET){var o=n.x,a=n.y;n=new ElementView,n.setProp(o,a,0,ElementTypeConstants.BOMB_COLOR),this.elementLayer.addChild(n),this._fakeViews.push(n)}var s=i.view;if(i.type==ElementTypeConstants.ROCKET){var o=s.x,a=s.y;s=new ElementView,s.setProp(o,a,0,ElementTypeConstants.BOMB_COLOR),this.elementLayer.addChild(s),this._fakeViews.push(s)}var r=this.logicToView(e.data.combinedPoint),l=new TimelineLite,_=new TimelineLite,h=.2;l.add(TweenLite.to(n,h,{x:r.x,y:r.y}),0),_.add(TweenLite.to(s,h,{x:r.x,y:r.y}),0),n.setMoveTween(l),s.setMoveTween(_)},e.prototype.dpColorColorTarget=function(e){var t,i=this,n=this.logicToView(new egret.Point(e.data.toX,e.data.toY)),o=new TimelineLite;if(this._bombExplodeCovers.length>0)t=this._bombExplodeCovers.pop();else{var a=RES.getRes("bomb_explode_png");t=new egret.Bitmap(a),t.anchorOffsetX=94,t.anchorOffsetY=96}t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=n.x,t.y=n.y,t.alpha=0,this.leafLayer.addChild(t),o.add(TweenLite.to(t,.1,{alpha:1,ease:Linear.easeNone}),0),o.add(TweenLite.to(t,.6,{alpha:0,ease:Linear.easeNone}),.2),o.call(function(){t&&t.parent&&(t.parent.removeChild(t),i._bombExplodeCovers.push(t))},void 0,void 0,.8)},e.prototype.dpColorThunder=function(e){var t=this.logicToView(new egret.Point(e.data.fromX,e.data.fromY)),i=this.logicToView(new egret.Point(e.data.toX,e.data.toY)),n=(this.logicToView(new egret.Point(((e.data.fromX+e.data.toX)/2,(e.data.fromY+e.data.toY)/2))),xyd.getRotation({x:t.x,y:t.y},{x:i.x,y:i.y})),o=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),a=o/620;EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_THUNDER,function(e){SoundManager.getInstance().playEffect("se_special_distruction_color_3_mp3"),e.x=t.x,e.y=t.y,e.scaleY=a,e.rotation=n,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))},e.prototype.playColorRemoveEff=function(e){e.animation.play("texiao03",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)},e.prototype.playColorBeginEff=function(e){e.animation.play("texiao02",-1)},e.prototype.dpColorBegin=function(e){if(this._colorElementEffects)for(var t=0;t<this._colorElementEffects.length;t++)this.playColorBeginEff(this._colorElementEffects[t])},e.prototype.dpColorColorEnd=function(e){if(this._dpColorColorEffectMap){for(var t=0,i=this._dpColorColorEffectMap;t<i.length;t++){var n=i[t];n.animation.stop(),n.parent&&n.parent.removeChild(n),EffectFactory.get().pushBackEffect(n)}this._dpColorColorEffectMap=[]}},e.prototype.dpColorEnd=function(e){var t=e.data.ele.id;if(this._colorNeedDelEffects[t]=1,this._colorElementEffects){for(var i=0;i<this._colorElementEffects.length;i++)this.playColorRemoveEff(this._colorElementEffects[i]);this._colorElementEffects=[]}},e.prototype.dpColThree=function(e){var t=this;SoundManager.getInstance().playEffect("se_special_distruction_row_bomb1_mp3");var i=e.data.x,n=e.data.y,o=e.data.color,a=new egret.Bitmap;a.texture=RES.getRes(DisplayConstants.ElementDisplaySourceMap[30+o]),a.anchorOffsetX=xyd.TILE_WIDTH_HALF,a.anchorOffsetY=xyd.TILE_HEIGHT_HALF;var s=this.logicToView(new egret.Point(i,n));a.x=s.x,a.y=s.y,a.alpha=0,this.elementLayer.addChild(a);var r=new TimelineLite;r.add(TweenLite.to(a,1*xyd.TweenDeltaTime,{alpha:1})),r.add(TweenLite.to(a,11*xyd.TweenDeltaTime,{scaleX:3,scaleY:3})),r.add(TweenLite.to(a,1*xyd.TweenDeltaTime,{alpha:0})),r.call(function(){t.elementLayer.addChild(a)});var l=new TimelineLite;l.add(TweenLite.to(a,1*xyd.TweenDeltaTime,{}),9*xyd.TweenDeltaTime),l.call(function(){t.showBigDpLine(i,n,o,1)})},e.prototype.dpColRowThree=function(e){var t=this;this._win.shakeBoard(3);var i=e.data.x,n=e.data.y,o=e.data.color,a=e.data.direction;0==a?SoundManager.getInstance().playEffect("se_special_distruction_row_bomb1_mp3"):SoundManager.getInstance().playEffect("se_special_distruction_row_bomb2_mp3");var s=new egret.Bitmap;s.texture=RES.getRes(DisplayConstants.ElementDisplaySourceMap[20+10*a+o]),s.anchorOffsetX=xyd.TILE_WIDTH_HALF,s.anchorOffsetY=xyd.TILE_HEIGHT_HALF;var r=this.logicToView(new egret.Point(i,n));s.x=r.x,s.y=r.y,s.alpha=0,this.elementLayer.addChild(s);var l=new TimelineLite;l.add(TweenLite.to(s,1*xyd.TweenDeltaTime,{alpha:1})),l.add(TweenLite.to(s,11*xyd.TweenDeltaTime,{scaleX:3,scaleY:3})),l.add(TweenLite.to(s,1*xyd.TweenDeltaTime,{alpha:0})),l.call(function(){t.elementLayer.addChild(s)});var _=new TimelineLite;_.add(TweenLite.to(s,1*xyd.TweenDeltaTime,{}),9*xyd.TweenDeltaTime),_.call(function(){t.showBigDpLine(i,n,o,a)})},e.prototype._shakeBoard=function(e){var t=1;e.data&&e.data.intensity&&(t=e.data.intensity),this._win.shakeBoard(t)},e.prototype.cloudMaker=function(e){var t=e.data;t.view.playCloudMakerAnimation()},e.prototype.clearLeafLight=function(){for(var e in this._leafLightEffects){var t=this._leafLightEffects[e];t.animation.stop(),t&&t.parent&&t.parent.removeChild(t),t.dispose()}this._leafLightEffects={}},e.prototype.leafLight=function(e){if(this._win.getStatus()==ItemConstants.NORMAL&&!(this._currenGuideID>0)){var t=e.data,i=this.logicToView(new egret.Point(t.getCol(),t.getRow()));EffectFactory.get().newEffect(EffectConstants.LEAF_HINT,function(e){this._leafLightEffects[9*t.getCol()+t.getRow()]=e,e.x=i.x,e.y=i.y,e.animation.play("texiao01",3),this.effectLayer.addChild(e);var n=function(i){e.removeDBEventListener("complete",n,this),e.animation.stop(),e&&e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e),delete this._leafLightEffects[9*t.getCol()+t.getRow()]};e.addDBEventListener("complete",n,this)}.bind(this))}},e.prototype.blackHoleChangeEffect=function(e){var t=e.data.element,i=e.data.color;if(t.type==ElementTypeConstants.BLACK_HOLE){t.view&&t.view.dispose();var n=this.logicToView(new egret.Point(t.col,t.row)),o=new ElementView;o.setProp(n.x,n.y,t.color,t.type),o.setGameView(this),t.view=o,this.elementMap[t.id]=o,t.view.blackHoleEff(i,t.type),this.elementLayer.addChild(o)}},e.prototype.playTornadoEffect=function(e,t,i,n,o,a){var s=new TimelineMax,r=i;EffectFactory.get().newEffect(e,function(e){var i=this;return this._isDisposed?void EffectFactory.get().pushBackEffect(e):(e.animation.play(t,-1),this.effectLayer.addChild(e),void s.add(TweenMax.fromTo(e,r,{x:n.x,y:n.y},{x:o.x,y:o.y})).call(function(){e.animation.stop(),EffectFactory.get().pushBackEffect(e),i._isDisposed||(i.effectLayer.removeChild(e),a&&EffectFactory.get().newEffect(EffectConstants.ELEMENT_DESTRUCTION_TORNADO,function(e){this._isDisposed&&EffectFactory.get().pushBackEffect(e),e.animation.play(t,1),e.x=o.x,e.y=o.y,this.effectLayer.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(i)))}))}.bind(this))},e.prototype.playTornadoEffectFromFan=function(e,t,i,n,o,a){var s=new TimelineMax,r=i;EffectFactory.get().newEffect(e,function(e){var i=this;return this._isDisposed?void EffectFactory.get().pushBackEffect(e):(e.animation.play(t,-1),e.scaleX=e.scaleY=0,this.effectLayer.addChild(e),void s.add(TweenMax.to(e,10*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Power2.easeInOut})).add(TweenMax.fromTo(e,r,{x:n.x,y:n.y},{x:o.x,y:o.y})).call(function(){e.animation.stop(),EffectFactory.get().pushBackEffect(e),i._isDisposed||(i.effectLayer.removeChild(e),a&&EffectFactory.get().newEffect(EffectConstants.ELEMENT_DESTRUCTION_TORNADO,function(e){this._isDisposed&&EffectFactory.get().pushBackEffect(e),e.animation.play(t,1),e.x=o.x,e.y=o.y,this.effectLayer.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(i)))}))}.bind(this))},e.prototype.crayonChangeEffect=function(e){SoundManager.getInstance().playEffect("se_special_crayon_mp3");var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row));EffectFactory.get().newEffect(EffectConstants.ELEMENT_DESTRUCTION_CRAYON,function(e){e.x=i.x,e.y=i.y,e.animation.play("texiao01",1),this.effectLayer.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.crayonInitEffect=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row)),n=(t.col,t.row,t.id);EffectFactory.get().newEffect(EffectConstants.ELEMENT_DESTRUCTION_CRAYON_RUN,function(e){return 1==this._crayonNeedDelEffects[n]?(this._crayonNeedDelEffects[n]=0,void EffectFactory.get().pushBackEffect(e)):(e.x=i.x,e.y=i.y,e.animation.play("texiao01",-1),this.effectLayer.addChild(e),this._crayonEffects[n]=e,void(this._crayonNeedDelEffects[n]=0))}.bind(this))},e.prototype._wandDisappearEffect=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.x,t.y)),n=(t.x,t.y,t.id),o=this._wandEffects[n];void 0!=o?(o.animation.stop(),o.parent&&this.effectLayer.removeChild(o),EffectFactory.get().pushBackEffect(o),delete this._wandEffects[n],this._wandNeedDelEffects[n]=0):this._wandNeedDelEffects[n]=1,EffectFactory.get().newEffect(EffectConstants.ITEM_WAND_ACTIVE,function(e){e.x=i.x,e.y=i.y,e.animation.play("texiao03",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.parent&&this.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this),this.effectLayer.addChild(e)}.bind(this))},e.prototype._initWandEffect=function(e){var t=e.data,i=this.logicToView(new egret.Point(t.col,t.row)),n=(t.col,t.row,t.id);
EffectFactory.get().newEffect(EffectConstants.ITEM_WAND_ACTIVE,function(e){if(1==this._wandNeedDelEffects[n])return this._wandNeedDelEffects[n]=0,void EffectFactory.get().pushBackEffect(e);e.x=i.x,e.y=i.y,e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.play("texiao02",-1)};e.addDBEventListener("complete",t,this),this.effectLayer.addChild(e),this._wandEffects[n]=e,this._wandNeedDelEffects[n]=0}.bind(this))},e.prototype.crayonEffect=function(e){var t=e.data.pos,i=e.data.dir,n=e.data.dis,o=e.data.eleid,a=this.logicToView(t);this.stopCrayonEffect(t,o);for(var s,r,l,_=xyd.directions[i][0],h=xyd.directions[i][1],c=new egret.Point(t.x+n*_,t.y+n*h),d=10*xyd.TweenDeltaTime*n,p=this._board.getBoardRows()-1,u=this._board.getBoardCols()-1,m=0;n>m;m++){var g=t.x+m*_,f=t.y+m*h;if(0!=m){if(0!=_&&(g>=p||0>=g)){if(l=10*xyd.TweenDeltaTime*(n-m-1),d=10*(m+1)*xyd.TweenDeltaTime,0>=g){c=new egret.Point(g,f),s=new egret.Point(p,f),r=new egret.Point(p-(n-m-2),f),0>g&&(s.x++,r.x--,l+=10*xyd.TweenDeltaTime,d-=10*xyd.TweenDeltaTime);break}c=new egret.Point(g,f),s=new egret.Point(0,f),r=new egret.Point(n-m-2,f),g>p&&(s.x--,r.x++,l+=10*xyd.TweenDeltaTime,d-=10*xyd.TweenDeltaTime);break}if(0!=h&&(f>=u||0>=f)){if(l=10*xyd.TweenDeltaTime*(n-m-1),d=10*(m+1)*xyd.TweenDeltaTime,0>=f){c=new egret.Point(g,f),s=new egret.Point(g,u),r=new egret.Point(g,u-(n-m-2)),0>f&&(s.y++,r.y--,l+=10*xyd.TweenDeltaTime,d-=10*xyd.TweenDeltaTime);break}c=new egret.Point(g,f),s=new egret.Point(g,0),r=new egret.Point(g,n-m-2),f>u&&(s.y--,r.y++,l+=10*xyd.TweenDeltaTime,d-=10*xyd.TweenDeltaTime);break}}}c=this.logicToView(c),s&&r&&(s=this.logicToView(s),r=this.logicToView(r));var y="texiao03",E=EffectConstants.ELEMENT_DESTRUCTION_CRAYON_RUN,v=0,T=1;switch(i){case xyd.DIRECTION.LEFT:T=-1;break;case xyd.DIRECTION.RIGHT:break;case xyd.DIRECTION.UP:v=-90;break;case xyd.DIRECTION.DOWN:v=90}var C=new TimelineMax;EffectFactory.get().newEffect(E,function(e){var t=this;e.animation.play(y,-1),e.rotation=v,e.scaleX=T,this.effectLayer.addChild(e),C.add(TweenMax.fromTo(e,d,{x:a.x,y:a.y},{x:c.x,y:c.y})),s&&r&&C.add(TweenMax.fromTo(e,l,{x:s.x,y:s.y},{x:r.x,y:r.y})),C.call(function(){e.animation.stop(),t.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e)})}.bind(this))},e.prototype.tornadoEffect=function(e){SoundManager.getInstance().playEffect("se_special_tornado_mp3");var t=e.data.fromEle,i=e.data.duration,n=e.data.color,o=e.data.type,a=this.logicToViewFloat(e.data.to),s=this.logicToViewFloat(e.data.from),r=DisplayConstants.EffectColorMap[n];if(t.type==BlockerConstant.FAN)return void this.playTornadoEffectFromFan("spetial_run_tornado",r,i,s,a,!0);switch(this.playTornadoEffect("spetial_run_tornado",r,i,s,a,!0),o){case Tornado.TRIGGER_LINE_TYPE:this.playTornadoEffect("spetial_run_tornado_row","texiao01",i,s,a,!1);break;case Tornado.TRIGGER_SQUARE_TYPE:this.playTornadoEffect("spetial_run_tornado_bomb","texiao01",i,s,a,!1);break;case Tornado.TRIGGER_COLOR_TYPE:this.playTornadoEffect("spetial_run_tornado_color","texiao01",i,s,a,!1)}},e.prototype.collectAnimation=function(e){var t,i=this,n=e.x,o=e.y,a=e.collectType,s=e.objectives,r={};for(var l in s)r[l]=s[l];for(var _,h,c=DisplayConstants.TargetSourceMap[a],d=0,p=this._displayTargetGroup;d<p.length;d++){var u=p[d];if(u.name==c){var m=u.localToGlobal();_=m.x,h=m.y}}var g=new egret.DisplayObjectContainer,f=new egret.Bitmap,y=this.logicToView(new egret.Point(n,o));RES.getResAsync(c).then(function(e){f.texture=e}),g.addChild(f),g.x=y.x,g.y=y.y,this.elementLayer.addChild(g),this._win.validateNow(),t=g.localToGlobal(),this.elementLayer.removeChild(g),t.x-=xyd.TILE_WIDTH_HALF,t.y-=xyd.TILE_HEIGHT_HALF,g.x=t.x,g.y=t.y,this._win.addChild(g);var E=20*xyd.TweenDeltaTime,v=new TimelineMax;v.add(TweenMax.to(g,E,{bezier:[{x:t.x-20,y:t.y+100},{x:_,y:h,scaleX:this._targetImgScale,scaleY:this._targetImgScale}],ease:Power1.easeIn,autoRotate:!1}),0),v.add(TweenMax.to(g,E,{scaleX:this._targetImgScale,scaleY:this._targetImgScale,ease:Power1.easeIn}),0),v.call(function(){for(var e in r)i._updateTarget(String(e),r[e]);g.parent&&g.parent.removeChild(g)})},e.prototype.boardTarget=function(e){var t=e.data;if(void 0!=t.collectType)this.collectAnimation(t);else for(var i in t){var n=t[i];if("objectives"==i)for(var o in n)this._updateTarget(String(o),n[o]);else this._updateTarget(i,n)}},e.prototype._updateTarget=function(e,t){if(Number(e)==ObjectiveConstants.SLATE){var i=this._board.checkHasCellStone();i&&(this._changeSlateToStone=!0)}var n=!1,o=0;for(var a in this._targetkeys){if(this._targetkeys[a]==e){n=!0;break}o++}if(n){if(0==t&&this._displayTargetLabel[o])return void this._displayTargetGroup[o].resetData(0);this._displayTargetGroup[o].resetData(t)}else{if(0>t)return;var s=new GameTargetDisplay(e,t,this._displayTargetLabel);this._displayTargetGroup.push(s),this._board.isRecovered()?s.visible=!0:s.visible=!1;var r=new eui.HorizontalLayout;r.gap=20,r.horizontalAlign="center",r.verticalAlign="middle",this.group_target.layout=r,this.group_target.addChild(s),this._targetkeys.push(e),this._changeSlateToStone&&Number(e)==ObjectiveConstants.SLATE&&s.changeSlateToStone()}},e.prototype.reshuffleTips=function(){this._disposeComboEffect(),this.showShuffleTips(this.group_shuffle)},e.prototype._disposeComboEffect=function(){this._comboEffect&&(this._comboEffect.parent&&this._comboEffect.parent.removeChild(this._comboEffect),this._comboEffect.dispose(),this._comboEffect=void 0)},e.prototype.reshuffle=function(){for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardCols();t++){var i=this._board.getElementAtGrid(e,t);if(void 0!=i){var n=this.logicToView(new egret.Point(i.col,i.row)),o=new TimelineLite,a=20*xyd.TweenDeltaTime;o.add(TweenLite.to(i.view,a,{x:n.x,y:n.y}),0),i.view.setMoveTween(o)}}},e.prototype.addBeltCell=function(e){var t=e.data.beltCell,i=new BeltCellView(t);this.beltCellViewList.push(i);var n=this.logicToView(t.getPosition());i.x=n.x,i.y=n.y,this.beltLayer.addChild(i)},e.prototype.addBeltPortal=function(e){var t=e.data.beltCell,i=t.getPosition(),n=i.x+10*i.y,o=t.getPortalType();this.beltPortalColorMap[n]=o;var a=t.getPortalOpenDirection(),s=BeltConstants.PORTAL_DIRECTION_EFFECT_MAP[a];if(t.getPortalInOrOut()==BeltConstants.PORTAL_IN){if(this.beltProtalEnterMap[n])return;var r=this.logicToView(i);EffectFactory.get().newEffect(EffectConstants.PORTAL_IN,function(e){e.x=r.x+s[1],e.y=r.y+s[2],e.rotation=s[0];var t=BeltConstants.COLOR_TO_EFFECT_MAP[o][0];e.animation.play(t,0),this.effectLayer.addChild(e),this.beltProtalEnterMap[n]=e}.bind(this))}else{if(this.beltProtalOutMap[n])return;var l=this.logicToView(i);EffectFactory.get().newEffect(EffectConstants.PORTAL_OUT,function(e){e.x=l.x+s[1],e.y=l.y+s[2],e.rotation=s[0];var t=BeltConstants.COLOR_TO_EFFECT_MAP[o][0];e.animation.play(t,0),this.effectLayer.addChild(e),this.beltProtalOutMap[n]=e}.bind(this))}},e.prototype.addPortal=function(e){var t=e.data.x,i=e.data.y,n=e.data.enter,o=t+10*i;if(n){if(this.protalEnterMap[o])return;var a=this.logicToView(new egret.Point(t,i));EffectFactory.get().newEffect(EffectConstants.PORTAL_IN,function(e){e.x=a.x+2,e.y=a.y+62,e.scaleY=-1,e.animation.play("texiao01",-1),this.effectLayer.addChild(e),this.protalEnterMap[o]=e}.bind(this))}else{if(this.protalOutMap[o])return;var s=this.logicToView(new egret.Point(t,i));EffectFactory.get().newEffect(EffectConstants.PORTAL_OUT,function(e){e.x=s.x+2,e.y=s.y-62,e.animation.play("texiao01",-1),this.effectLayer.addChild(e),this.protalOutMap[o]=e}.bind(this))}},e.prototype.enterPortal=function(e){var t=e.data.x,i=e.data.y,n=t+10*i,o=this.protalEnterMap[n];if(o){o.animation.play("texiao02",1);var a=function(e){o.removeDBEventListener("complete",a,this),o.animation.play("texiao01",-1)};o.addDBEventListener("complete",a,this)}},e.prototype.exitPortal=function(e){var t=e.data.x,i=e.data.y,n=t+10*i,o=this.protalOutMap[n];if(o){o.animation.play("texiao02",1);var a=function(e){o.removeDBEventListener("complete",a,this),o.animation.play("texiao01",-1)};o.addDBEventListener("complete",a,this)}},e.prototype.isStableElement=function(e,t){return this._board.isCannotMoveCell(e,t)?!0:this._board.isStaticCell(e,t)&&!this._board.isStickyCell(e,t)?!0:!1},e.prototype.dispose=function(){if(!this._isDisposed){this._isDisposed=!0,this._removeAllEvents(),this.clearPossibleMove(),this.stopStepAnimation(),this.group_skip&&this.group_skip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnSkipClick,this);for(var e in this.protalEnterMap){var t=this.protalEnterMap[e];t.animation.stop(),this.effectLayer.removeChild(t),t.dispose()}this.protalEnterMap={};for(var e in this.protalOutMap){var t=this.protalOutMap[e];t.animation.stop(),this.effectLayer.removeChild(t),t.dispose()}this.protalOutMap={};for(var i=0,n=this.beltCellViewList;i<n.length;i++){var o=n[i];o.dispose()}for(var e in this.beltProtalEnterMap){var t=this.beltProtalEnterMap[e];t.animation.stop(),this.effectLayer.removeChild(t),t.dispose()}this.beltProtalEnterMap={};for(var e in this.beltProtalOutMap){var t=this.beltProtalOutMap[e];t.animation.stop(),this.effectLayer.removeChild(t),t.dispose()}this.beltProtalOutMap={},this.scoreTargetNum&&xyd.bitmapNumber.destroyNumPic(this.scoreTargetNum),this._swapNumber&&xyd.bitmapNumber.destroyNumPic(this._swapNumber),this._scoreNumber&&xyd.bitmapNumber.destroyNumPic(this._scoreNumber);for(var a=0,s=this._displayTargetLabel;a<s.length;a++){var r=s[a];r&&xyd.bitmapNumber.destroyNumPic(r)}this._displayTargetLabel=[];for(var l in this.elementMap){var _=this.elementMap[l];_&&_.dispose()}this.elementMap={};for(var l in this.blockerMap){var _=this.blockerMap[l];_&&_.dispose()}this.blockerMap={};for(var h=0,c=this._usingTimelines;h<c.length;h++){var d=c[h];d.kill()}this._usingTimelines=[];for(var p in this._colorElementEffects){var t=this._colorElementEffects[p];t.animation.stop(),this.effectLayer.removeChild(t),t.dispose()}this._colorElementEffects=[];for(var e in this.generatorMap){var t=this.generatorMap[e].effect;t&&(t.animation.stop(),t.parent&&t.parent.removeChild(t),t.dispose())}this._comboEffect&&this._comboEffect.dispose(),this._vipEff1&&this._vipEff1.dispose(),this._vipEff2&&this._vipEff2.dispose(),this._vipEff1=void 0,this._vipEff2=void 0;for(var e in this._dpColorTargetEffMap){var t=this._dpColorTargetEffMap[e];t.parent&&t.parent.removeChild(t),t.animation.stop(),t.dispose()}for(var u=0,m=this._dpColorColorEffectMap;u<m.length;u++){var t=m[u];t.parent&&t.parent.removeChild(t),t.animation.stop(),t.dispose()}this._dpColorColorEffectMap=[];for(var e in this._lockToViewMap){var g=this._lockToViewMap[e];g&&g.dispose()}for(var f=0,y=this._fakeViews;f<y.length;f++){var E=y[f];E.parent&&(E.parent.removeChild(E),E.dispose())}this.generatorMap={},this.clearLeafLight()}},e.prototype._updatePossibleMove=function(){this._receivedPossibleMoveRequest=!0,this._win.getStatus()==ItemConstants.NORMAL&&(this._currenGuideID<=0&&this.clearPossibleMove(),this.checkPossibleMove())},e.prototype.checkPossibleMove=function(){if(!(this._currenGuideID>0)){for(var e=0,t=this._possibleMoveEle;e<t.length;e++){var i=t[e];i&&i.view&&i.view.resetPossibleMove()}for(var n=0,o=this._possibleMoveTween;n<o.length;n++){var a=o[n];a.kill()}this._possibleMoveEle=[];var s=this._board.getTopRankedPossibleMove();if(void 0!=s){if(this._doTestMoves){var r=xyd.random();r>.5&&(s=this._board.getRandomPossibleMove());var l=new SwapInfo(s.fromPos,s.toPos);return void this.doSwap(l)}s&&this._highlightElementsWithMove(s)}}},e.prototype._highlightElementsWithMove=function(e){for(var t=e.involvedElements,i=e.toPos.x,n=e.toPos.y,o=e.fromPos.x,a=e.fromPos.y,s=0,r=t;s<r.length;s++){var l=r[s];if(l.col!=i||l.row!=n)if(l.col==o&&l.row==a){var _=o==i?[0,a-n]:[o-i,0];this.elementLayer.setChildIndex(l.view,this.elementLayer.numChildren-1),this._highlightPossibleMoveElementWithMove(l,_)}else this._highlightPossibleMoveElement(l)}},e.prototype.highlightElementsInGuide=function(e){var t=GuideHelper.getManualInGuide(e);if(t&&2==t.length)for(var i=GuideHelper.getHighlightELementsInGuide(e,this._board),n=t[1],o=Math.floor(n/9),a=n%9,s=t[0],r=Math.floor(s/9),l=s%9,_=0,h=i;_<h.length;_++){var c=h[_];if(c.col!=o||c.row!=a)if(c.col==r&&c.row==l){var d=r==o?[0,l-a]:[r-o,0];this._highlightMoveElementInGuide(c,d)}else this._highlightStationaryElementInGuide(c)}},e.prototype._highlightStationaryElementInGuide=function(e){if(void 0!=e&&void 0!=e.view){this._possibleMoveEle.push(e);var t=e.view,i=new TimelineMax({repeat:-1});this._possibleMoveTween.push(i),i.add(TweenLite.fromTo(t,7*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,rotation:0},{scaleX:1.1,scaleY:1.1,rotation:5,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(t,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,rotation:5},{scaleX:1.1,scaleY:1.1,rotation:-10,ease:Linear.easeNone}),15*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(t,6*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,rotation:-10},{scaleX:1,scaleY:1,rotation:0,ease:Linear.easeNone}),22*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(t,7*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,rotation:0},{scaleX:1.1,scaleY:1.1,rotation:5,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(t,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,rotation:5},{scaleX:1.1,scaleY:1.1,rotation:-10,ease:Linear.easeNone}),35*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(t,6*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,rotation:-10},{scaleX:1,scaleY:1,rotation:0,ease:Linear.easeNone}),42*xyd.TweenDeltaTime);var n=new TimelineMax({repeat:-1});this._possibleMoveTween.push(n),n.call(function(){t.setPossibleMoveLight(!0)},void 0,void 0,8*xyd.TweenDeltaTime),n.call(function(){t.setPossibleMoveLight(!1),t.setPossibleMoveLight(!0)},void 0,void 0,28*xyd.TweenDeltaTime),n.call(function(){t.setPossibleMoveLight(!1)},void 0,void 0,48*xyd.TweenDeltaTime)}},e.prototype._highlightMoveElementInGuide=function(e,t){if(void 0!=e&&void 0!=e.view){this._possibleMoveEle.push(e);var i=e.view;this.elementLayer.addChild(i);var n=0==t[0],o=new TimelineMax({repeat:-1});if(this._possibleMoveTween.push(o),n){var a=i.y,s=t[1]<0?32:-32;o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,y:a},{scaleX:1.2,scaleY:1.2,y:a+s,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2,y:a+s},{scaleX:1,scaleY:1,y:a,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,y:a},{scaleX:1.2,scaleY:1.2,y:a+s,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2,y:a+s},{scaleX:1,scaleY:1,y:a,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)}else{var r=i.x,s=t[0]<0?32:-32;o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,x:r},{scaleX:1.2,scaleY:1.2,x:r+s,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2,x:r+s},{scaleX:1,scaleY:1,x:r,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,x:r},{scaleX:1.2,scaleY:1.2,x:r+s,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),o.add(TweenLite.fromTo(i,10*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2,x:r+s},{scaleX:1,scaleY:1,x:r,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)}var l=new TimelineMax({repeat:-1});this._possibleMoveTween.push(l),l.call(function(){i.setPossibleMoveLight(!0)},void 0,void 0,8*xyd.TweenDeltaTime),l.call(function(){i.setPossibleMoveLight(!1),i.setPossibleMoveLight(!0)},void 0,void 0,28*xyd.TweenDeltaTime),l.call(function(){i.setPossibleMoveLight(!1)},void 0,void 0,48*xyd.TweenDeltaTime)}},e.prototype._highlightPossibleMoveElementWithMove=function(e,t){if(void 0!=e&&void 0!=e.view){this._possibleMoveEle.push(e);var i=new TimelineMax;i.call(function(){e.view.setPossibleMoveLight(!0)}),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),0),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),7*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),14*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),20*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),27*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),34*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,46*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),40*xyd.TweenDeltaTime),i.call(function(){e.view.setPossibleMoveLight(!1)});var n=new TimelineMax;n.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:5,ease:Linear.easeOut}),0),n.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:-5,ease:Linear.easeOut}),7*xyd.TweenDeltaTime),n.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),14*xyd.TweenDeltaTime),n.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:5,ease:Linear.easeOut}),20*xyd.TweenDeltaTime),n.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:-5,ease:Linear.easeOut}),27*xyd.TweenDeltaTime),n.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),34*xyd.TweenDeltaTime),n.add(TweenLite.to(e.view,46*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),40*xyd.TweenDeltaTime);var o=this.logicToView(new egret.Point(e.x,e.y)),a=o.x,s=o.y,r=0,l=0;0==t[0]?l=t[1]<0?32:-32:r=t[0]<0?32:-32;var _=new TimelineMax;_.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{x:a+r,y:s+l,ease:Linear.easeOut}),0),_.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{x:a+r,y:s+l,ease:Linear.easeOut}),7*xyd.TweenDeltaTime),_.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{x:a,y:s,ease:Linear.easeOut}),14*xyd.TweenDeltaTime),_.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{x:a+r,y:s+l,ease:Linear.easeOut}),20*xyd.TweenDeltaTime),_.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{x:a+r,y:s+l,ease:Linear.easeOut}),27*xyd.TweenDeltaTime),_.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{x:a,y:s,ease:Linear.easeOut}),34*xyd.TweenDeltaTime),_.add(TweenLite.to(e.view,46*xyd.TweenDeltaTime,{x:a,y:s,ease:Linear.easeOut}),40*xyd.TweenDeltaTime),i.repeat(-1),n.repeat(-1),_.repeat(-1),this._possibleMoveTween.push(i),this._possibleMoveTween.push(n),this._possibleMoveTween.push(_)}},e.prototype._highlightPossibleMoveElement=function(e){this._possibleMoveEle.push(e);var t=new TimelineMax;t.call(function(){e.view.setPossibleMoveLight(!0)}),t.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),0),t.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),7*xyd.TweenDeltaTime),t.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),14*xyd.TweenDeltaTime),t.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),20*xyd.TweenDeltaTime),t.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeOut}),27*xyd.TweenDeltaTime),t.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),34*xyd.TweenDeltaTime),t.add(TweenLite.to(e.view,46*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeOut}),40*xyd.TweenDeltaTime),t.call(function(){e.view.setPossibleMoveLight(!1)});var i=new TimelineMax;i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:5,ease:Linear.easeOut}),0),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:-5,ease:Linear.easeOut}),7*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),14*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:5,ease:Linear.easeOut}),20*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,7*xyd.TweenDeltaTime,{rotation:-5,ease:Linear.easeOut}),27*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,6*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),34*xyd.TweenDeltaTime),i.add(TweenLite.to(e.view,46*xyd.TweenDeltaTime,{rotation:0,ease:Linear.easeOut}),40*xyd.TweenDeltaTime),t.repeat(-1),i.repeat(-1),this._possibleMoveTween.push(t),this._possibleMoveTween.push(i)},e.prototype.clearPossibleMove=function(){for(var e=0,t=this._possibleMoveTween;e<t.length;e++){var i=t[e];i.kill()}for(var n=0,o=this._possibleMoveEle;n<o.length;n++){var a=o[n];a.view.resetPossibleMove();var s=this.logicToView(new egret.Point(a.x,a.y));a.view.x=s.x,a.view.y=s.y}this._possibleMoveTween=[],this._possibleMoveEle=[]},e.prototype.showAnnaImg=function(){this.charImg1.visible=!0,this.charImg2.visible=!0,this.charImg3.visible=!0,this.charImg4.visible=!0},e.prototype.showAnnaAnimation=function(e){if(e>0){var t=this["charEffHolder"+e.toString()];EffectFactory.get().newEffect("anna_guide1",function(e){e.x=156.5,e.y=470,e.animation.play("anna_guide_celebration1",1),e.touchEnabled=!1,t.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.play("anna_guide_celebration2",1);var n=function(t){e.removeDBEventListener("complete",n,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",n,this)};e.addDBEventListener("complete",i,this)}.bind(this))}},e.prototype.showShuffleTips=function(e,t){var i=this;void 0===t&&(t=!1);var n=new TimelineLite;e.visible=!0,e.y=xyd.getHeight()+400,this._win.setCanTouch(!1),SoundManager.getInstance().playEffect("se_target_appear_1_mp3"),n.add(TweenLite.to(e,4*xyd.TweenDeltaTime,{y:xyd.getHeight()/2}),0),n.add(TweenLite.to(e,2*xyd.TweenDeltaTime,{y:xyd.getHeight()/2}),4*xyd.TweenDeltaTime),n.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{y:xyd.getHeight()/2-70}),6*xyd.TweenDeltaTime),n.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{y:xyd.getHeight()/2}),9*xyd.TweenDeltaTime),n.add(TweenLite.to(e,30*xyd.TweenDeltaTime,{y:xyd.getHeight()/2}),12*xyd.TweenDeltaTime),n.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{y:xyd.getHeight()/2-163}),42*xyd.TweenDeltaTime),n.add(TweenLite.to(e,10*xyd.TweenDeltaTime,{y:xyd.getHeight()+400}),45*xyd.TweenDeltaTime),n.call(function(){e.visible=!1,i.checkRemoveGameModeGroup(e),e!=i.group_shuffle&&(i._board.setPregameItemOnBoard(),egret.setTimeout(function(){i.VipStepAdd1()},i,1e3))}),t&&egret.setTimeout(function(){if(-1==i._currenGuideID)for(var e=0;e<i._targetkeys.length;e++){var t=i._targetkeys[e];i.gameModeTips(e,t)}},this,1e3)},e.prototype.VipStepAdd1=function(){if(!this._isDisposed&&!this._board.isRecovered()&&SelfInfo.get().isVip){this._win.setCanTouch(!1);var e=new egret.Bitmap;xyd.setBitmapAsync(e,"bg_black",function(){e.height=xyd.stageHeight,e.width=xyd.stageWidth,e.alpha=.6}),this._win.addChild(e);var t=SelfInfo.get().vipExtraStep;EffectFactory.get().newEffect(EffectConstants.VIP_ADD_MOVES,function(i){var n=this;if(this._isDisposed)return void i.dispose();i.x=xyd.stageWidth/2,i.y=xyd.stageHeight/2,this._vipEff1=i,i.animation.play("texiao0"+Number(t-1),1),this._win.addChild(i);var o=this.step_.localToGlobal();o.x+=75,o.y+=25;var a=new Vector2(xyd.stageWidth/2,xyd.stageHeight/2),s=new Vector2(0,0);s.x=(a.x+o.x)/2+200,s.y=(a.y+o.y)/2;var r=new TimelineMax,l=20*xyd.TweenDeltaTime;r.add(TweenMax.to(this._vipEff1,l,{bezier:[{x:a.x,y:a.y},{x:s.x,y:s.y},{x:o.x,y:o.y,scaleX:.5,scaleY:.5}],ease:Power1.easeIn,autoRotate:!1}),60*xyd.TweenDeltaTime),r.call(function(){n._win.removeChild(e),n.VipStepAdd2()})}.bind(this))}},e.prototype.VipStepAdd2=function(){if(!this._isDisposed){this._vipEff1.animation.stop(),this._win.removeChild(this._vipEff1),this._vipEff1.dispose(),this._vipEff1=void 0;var e=new Vector2(0,0);e.x+=75,e.y+=25,EffectFactory.get().newEffect(EffectConstants.VIP_MOVES_GLOW,function(t){if(this._isDisposed)return void t.dispose();t.x=e.x,t.y=e.y,t.animation.play("texiao01",1),this.step_.addChildAt(t,0),this._vipEff2=t;var i=function(e){t.removeDBEventListener("complete",i,this),t.animation.stop(),this.step_.removeChild(t),t.dispose(),this._win.setCanTouch(!0)};t.addDBEventListener("complete",i,this)}.bind(this)),this._win.setpAnimation()}},e.prototype.gameModeTips=function(e,t){var i,n=this,o=this._gameMode.modeName();if(this.group_start_target.$children.length>0?i=this.group_start_target.getChildAt(e):o==GameModeConstants.LEAF?i=this.target_mode2_1:o==GameModeConstants.LAMP&&(i=0==e?this.target_mode3_1:this.target_mode3_2),i){if(Number(t)==ObjectiveConstants.SLATE){var a=this._board.checkHasCellStone();a&&(t="99")}var s=DisplayConstants.TargetSourceMap[t],r=this._displayTargetGroup[e],l=i.localToGlobal(),_=r.localToGlobal();i.visible=!1,l.x+=xyd.TILE_WIDTH_HALF,l.y+=xyd.TILE_HEIGHT_HALF,_.x+=xyd.TILE_WIDTH_HALF,_.y+=xyd.TILE_HEIGHT_HALF;var h=48*xyd.TweenDeltaTime,c=new egret.DisplayObjectContainer,d=new egret.Bitmap;RES.getResAsync(s).then(function(e){d.texture=e,d.anchorOffsetX=xyd.TILE_WIDTH_HALF,d.anchorOffsetY=xyd.TILE_HEIGHT_HALF}),c.addChild(d),c.x=l.x,c.y=l.y,this._win.addChild(c),SoundManager.getInstance().playEffect("se_target_appear_2_mp3");var p=new TimelineMax;p.add(TweenMax.to(c,6*xyd.TweenDeltaTime,{scaleX:1.5,scaleY:1.5,ease:Linear.easeNone})),p.add(TweenMax.to(c,4*xyd.TweenDeltaTime,{scaleX:1.45,scaleY:1.45,ease:Linear.easeNone})),p.add(TweenMax.to(c,h,{bezier:[{x:l.x+50,y:l.y+100},{x:_.x,y:_.y,scaleX:1.05,scaleY:1.05}],ease:Quart.easeInOut,autoRotate:!1}),0),p.add(TweenMax.to(c,2*xyd.TweenDeltaTime,{scaleX:1.45,scaleY:1.45,ease:Linear.easeNone})),p.add(TweenMax.to(c,4*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeIn})),p.call(function(){n._displayTargetGroup[e].visible=!0,c.parent&&c.parent.removeChild(c)}),RES.getResAsync("xiaoxingxing_png").then(function(e){RES.getResAsync("xiaoxingxing_json").then(function(t){if(n._win){var i=new particle.GravityParticleSystem(e,t);n._win.addChild(i);var o=xyd.TILE_HEIGHT_HALF+40;i.x=0,i.y=0,i.emitterX=l.x,i.emitterY=l.y+o;var a=new TimelineMax;a.add(TweenMax.to(i,10*xyd.TweenDeltaTime,{})),a.call(function(){i.start()}),a.add(TweenMax.to(i,h,{bezier:[{emitterX:l.x+50,emitterY:l.y+100+o},{emitterX:_.x,emitterY:_.y+o}],ease:Quart.easeInOut,autoRotate:!1}),0),a.call(function(){i.parent&&i.parent.removeChild(i),i.stop()})}})})}},e.prototype.checkRemoveGameModeGroup=function(e){var t=!1;e==this.group_mode1?t=!0:e==this.group_mode2?t=!0:e==this.group_mode3?t=!0:e==this.group_mode4&&(t=!0),t&&(this._win.removeChild(this.group_mode1),this._win.removeChild(this.group_mode2),this._win.removeChild(this.group_mode3),this._win.removeChild(this.group_mode4))},e.prototype.winEffect=function(e){var t=(this.step_.localToGlobal(),e.view),i=t.localToGlobal();SoundManager.getInstance().playEffect("se_bonus_time_star_mp3"),EffectFactory.get().newEffect(EffectConstants.SHOOTING_STAR,function(e){e.x=i.x+xyd.TILE_WIDTH_HALF,e.y=i.y+xyd.TILE_HEIGHT_HALF,e.animation.play("texiao01",1),this._win.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this._win.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},e.prototype.showSkipBtn=function(){var e=this;this.group_bottom.visible=!1,this.group_skip.visible=!0,this.setting_group.visible=!1,this.group_skip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnSkipClick,this),platform.inTestMode()&&platform.inAutoMode()&&egret.setTimeout(function(){e.OnSkipClick()},this,500)},e.prototype.bonusTimeStart=function(){var e=this,t=new egret.Bitmap;xyd.setBitmapAsync(t,"bg_black",function(){t.height=e._bgImg.height,t.width=e._bgImg.width,t.alpha=0}),this.group_bg.addChild(t);var i=new TimelineLite;i.add(TweenLite.to(t,5*xyd.TweenDeltaTime,{alpha:1})),i.call(function(){xyd.isLowEndDevice?e._bgImg.source="game_bonus_low_png":e._bgImg.source="game_bonus_png"}),i.add(TweenLite.to(t,5*xyd.TweenDeltaTime,{alpha:0})),i.call(function(){e.group_bg.removeChild(t)})},e.prototype.bonusTime=function(){this._disposeComboEffect(),this.group_newuser_redpacket.visible=!1;var e=new egret.Bitmap;e.texture=RES.getRes("bg_black_png"),e.width=xyd.getWidth(),e.x=0,e.y=0,e.height=xyd.getHeight(),e.alpha=.6,this._win.addChild(e),e.visible=!1;var t=200;EffectFactory.get().newEffect(EffectConstants.ANNA_BOUNS_TIME,function(i){i.x=xyd.getWidth()/2,i.y=xyd.getHeight()/2+t,this._win.addChild(i);var n=new egret.Bitmap;n.texture=RES.getRes("zhenzhao_png"),n.x=0,n.y=0,n.width=xyd.getWidth(),n.height=xyd.getHeight()/2+t,this._win.addChild(n),i.mask=n,egret.setTimeout(function(){e.visible=!0,i.animation.play("texiao01",1)},this,5*xyd.TweenDeltaTime),EffectFactory.get().newEffect(EffectConstants.BOUNS_TIME,function(e){e.x=xyd.getWidth()/2,e.y=xyd.getHeight()/2+t,this._win.addChild(e),egret.setTimeout(function(){e.animation.play("texiao01",1)},this,5*xyd.TweenDeltaTime);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),this._win.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this));var o=function(t){i.removeDBEventListener("complete",o,this),i.animation.stop(),EffectFactory.get().pushBackEffect(i),this._win.removeChild(i),this._win.removeChild(n),this._win.removeChild(e)};i.addDBEventListener("complete",o,this)}.bind(this))},e.prototype.OnSkipClick=function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CLICK_SKIP_BTN)),this.group_skip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnSkipClick,this)},e.prototype.boardUnstable=function(){this._win.setCanTouch(!1),this._receivedPossibleMoveRequest=!1,this._isFirstStable&&(this._isFirstStable=!1),this._currenGuideID>0&&this._win.removeGuide()},e.prototype.stopBlackHoleEffect=function(){for(var e=this._board.getElementsOfType(ElementTypeConstants.BLACK_HOLE),t=0;t<e.length;t++){var i=e[t];i.view.stopBlackHoleEffect()}},e.prototype.boardStable=function(){this._dpSoundCount=0,this._win.setCanTouch(!0),this._isGuideComplete&&(this._isGuideComplete=!1,this._board.onGuideComplete()),this.playBlackHoleEffect(),this.playTimeBombWarningEffect(),this.syncProtal(),this._isFirstStable||this._currenGuideID<=0||this.tryNextGuide()},e.prototype.syncProtal=function(){for(var e in this.protalEnterMap){var t=this.protalEnterMap[e];t.animation.gotoAndPlayByProgress("texiao01",0,0)}for(var e in this.protalOutMap){var t=this.protalOutMap[e];t.animation.gotoAndPlayByProgress("texiao01",0,0)}},e.prototype.playBlackHoleEffect=function(){for(var e=this._board.getElementsOfType(ElementTypeConstants.BLACK_HOLE),t=0;t<e.length;t++){var i=e[t];i.view.playBlackHoleEffect()}},e.prototype.playTimeBombWarningEffect=function(){for(var e=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB),t=0;t<e.length;t++){var i=e[t];i.view.checkTimeBomb(i.getTicksToExplode())}},e.prototype.stopCrayonEffect=function(e,t){var i=t,n=this._crayonEffects[i];void 0!=n?(n.animation.stop(),n.parent&&this.effectLayer.removeChild(n),EffectFactory.get().pushBackEffect(n),delete this._crayonEffects[t],this._crayonNeedDelEffects[t]=0):this._crayonNeedDelEffects[t]=1},e.prototype.tryNextGuide=function(){var e=this;this._currenGuideID<=0||(GuideHelper.isLastGuideForLevel(this._currenGuideID)?(this._win.removeGuide(),GuideHelper.isInGuide=!1,this.clearPossibleMove(),this._currenGuideID=-1,this._receivedPossibleMoveRequest&&egret.setTimeout(function(){e._board.isStable()&&e.checkPossibleMove()},this,500),this._board.onGuideComplete()):(this._currenGuideID=GuideHelper.getNextGuideID(this._level,this._currenGuideID),this._win.setGuide(this._currenGuideID)))},e.prototype.skipGuide=function(){this._currenGuideID>0&&(this._win.removeGuide(),this._board.onGuideComplete()),this._currenGuideID=-1,this.clearPossibleMove(),this.checkPossibleMove()},e.prototype.swapAnimation=function(e){var t=this;this.clearPossibleMove();var i=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),n=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(void 0!=i&&void 0!=n){var o=this.elementMap[i.id],a=this.elementMap[n.id],s=this.logicToView(e.fromColRow),r=this.logicToView(e.toColRow),l=new egret.Bitmap;xyd.setBitmapAsync(l,String("icon_weizhijiaohuan"),function(){l.anchorOffsetX=69,l.anchorOffsetY=66,l.x=(s.x+r.x)/2,l.y=(s.y+r.y)/2,l.alpha=0
}),this.effectLayer.addChild(l),o.parent.addChild(o),a.parent.addChild(a);var _=(s.x+r.x)/2,h=(s.y+r.y)/2,c=new TimelineLite,d=new TimelineLite,p=new TimelineLite,u=new TimelineLite;this._win.setCanTouch(!1),s.x==r.x?(c.add(TweenLite.to(o,16*xyd.TweenDeltaTime,{y:r.y}),8*xyd.TweenDeltaTime),d.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{y:s.y}),8*xyd.TweenDeltaTime),s.y>r.y?(p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{x:_+this.TILE_HEIGHT/2}),8*xyd.TweenDeltaTime),p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{x:r.x}),16*xyd.TweenDeltaTime),u.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{x:_-this.TILE_HEIGHT/2}),8*xyd.TweenDeltaTime),u.add(TweenLite.to(a,8*xyd.TweenDeltaTime,{x:s.x}),16*xyd.TweenDeltaTime)):(p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{x:_-this.TILE_HEIGHT/2}),8*xyd.TweenDeltaTime),p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{x:r.x}),16*xyd.TweenDeltaTime),u.add(TweenLite.to(a,8*xyd.TweenDeltaTime,{x:s.x}),16*xyd.TweenDeltaTime),u.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{x:_+this.TILE_HEIGHT/2}),8*xyd.TweenDeltaTime))):(c.add(TweenLite.to(o,16*xyd.TweenDeltaTime,{x:r.x}),8*xyd.TweenDeltaTime),d.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{x:s.x}),8*xyd.TweenDeltaTime),s.x>r.x?(p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{y:h+this.TILE_WIDTH/2}),8*xyd.TweenDeltaTime),p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{y:r.y}),16*xyd.TweenDeltaTime),u.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{y:h-this.TILE_WIDTH/2}),8*xyd.TweenDeltaTime),u.add(TweenLite.to(a,8*xyd.TweenDeltaTime,{y:s.y}),16*xyd.TweenDeltaTime)):(p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{y:h-this.TILE_WIDTH/2}),8*xyd.TweenDeltaTime),p.add(TweenLite.to(o,8*xyd.TweenDeltaTime,{y:r.y}),16*xyd.TweenDeltaTime),u.add(TweenLite.to(a,16*xyd.TweenDeltaTime,{y:h+this.TILE_WIDTH/2}),8*xyd.TweenDeltaTime),u.add(TweenLite.to(a,8*xyd.TweenDeltaTime,{y:s.y}),16*xyd.TweenDeltaTime))),d.add(TweenLite.to(a,2*xyd.TweenDeltaTime,{scaleX:.96,scaleY:.96}),24*xyd.TweenDeltaTime),c.add(TweenLite.to(o,2*xyd.TweenDeltaTime,{scaleX:.96,scaleY:.96}),24*xyd.TweenDeltaTime),d.add(TweenLite.to(a,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05}),26*xyd.TweenDeltaTime),c.add(TweenLite.to(o,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05}),26*xyd.TweenDeltaTime),d.add(TweenLite.to(a,3*xyd.TweenDeltaTime,{scaleX:1,scaleY:1}),28*xyd.TweenDeltaTime),c.add(TweenLite.to(o,3*xyd.TweenDeltaTime,{scaleX:1,scaleY:1}),28*xyd.TweenDeltaTime);var m=new TimelineLite;m.add(TweenLite.fromTo(l,28*xyd.TweenDeltaTime,{rotation:176},{rotation:96}),0),m.add(TweenLite.to(l,12*xyd.TweenDeltaTime,{alpha:1}),0),m.add(TweenLite.to(l,5*xyd.TweenDeltaTime,{}),12*xyd.TweenDeltaTime),m.add(TweenLite.to(l,8*xyd.TweenDeltaTime,{alpha:0}),17*xyd.TweenDeltaTime),c.call(function(){t._win.setCanTouch(!0),l.parent&&l.parent.removeChild(l),t._board.doSwapWithoutRemoveMove(e)})}},e.prototype.getBeltState=function(){return this._belt_state},e.prototype._updateFPS=function(e){this._win.updateFPS(e.data.fps,e.data.avg,e.data.all)},e.prototype.rocketClear=function(e){if(!this._rocketClear){var t=this.logicToView(new egret.Point(e.col,e.row));this._rocketClear=!0,EffectFactory.get().newEffect(EffectConstants.ROCKET_CLEAR,function(e){e.x=t.x,e.y=t.y,this.effectLayer.addChild(e),e.animation.timeScale=2,e.animation.play("texiao",1);var i=function(t){this._rocketClear=!1,e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this))}},e.prototype.rocketLaunch=function(e){var t=this,i=(this.logicToView(e.data.from),this.logicToView(e.data.to),this._board.getElementAtGrid(e.data.from.x,e.data.from.y)),n=new ElementView;n.setProp(0,0,i.color,i.type),n.changeRocket(i.color,RocketConstants.STATE_READY,i.rocketType);var o=i.view.localToGlobal();o.x+=xyd.TILE_WIDTH_HALF,o.y+=xyd.TILE_HEIGHT_HALF;var a=9*e.data.to.y+e.data.to.x,s=this._baseMap[a],r=s.localToGlobal();r.x+=xyd.TILE_WIDTH_HALF,r.y+=xyd.TILE_HEIGHT_HALF,n.x=o.x,n.y=o.y,n.name="FakeRocketView",this._win.addChild(n),i.view.visible=!1,i.view.name="RealRocketView-1",EffectFactory.get().newEffect(EffectConstants.ROCKET_CLOUD,function(e){e.x=o.x,e.y=o.y+xyd.TILE_HEIGHT+20,this._win.addChild(e),e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this));var l=new TimelineMax,_=30*xyd.TweenDeltaTime;l.add(TweenLite.to(n,10*xyd.TweenDeltaTime,{})),l.call(function(){SoundManager.getInstance().playEffect("se_special_rocket_mp3"),EffectFactory.get().newEffect(EffectConstants.ROCKET_CLOUD,function(e){e.x=o.x,e.y=o.y,this._win.addChild(e),e.animation.play("texiao02",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(t))}),l.add(TweenLite.to(n,10*xyd.TweenDeltaTime,{scaleX:1.5,scaleY:1.5})),l.call(function(){SoundManager.getInstance().playEffect("se_special_rocket_1_mp3")}),l.add(TweenLite.to(n,_,{y:o.y-1500,ease:Power3.easeIn})),l.call(function(){n.x=r.x,n.y=r.y-1500,n.rotation=180}),l.add(TweenLite.to(n,_/2,{y:r.y,ease:Linear.easeNone})),l.call(function(){SoundManager.getInstance().playEffect("se_special_rocket_2_mp3"),n.parent.removeChild(n),EffectFactory.get().newEffect(EffectConstants.ROCKET_BOOM,function(e){e.x=n.x,e.y=n.y,this._win.addChild(e),e.animation.play("texiao01",1);var t=function(i){n.dispose(),e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(t))})},e.prototype._effectPressureTest=function(e){var t=e.data.effectName,i=e.data.actionName,n=e.data.col,o=e.data.row,a=e.data.times||0,s=this.logicToView(new egret.Point(n,o));EffectFactory.get().newEffect(t,function(e){if(e.x=s.x,e.y=s.y,this.effectLayer.addChild(e),e.animation.play(i,a),a>0){var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}}.bind(this))},e.prototype.getCurrentGuideID=function(){return this._currenGuideID},e.prototype._updateSnow=function(e){var t=e.data.snow,i=t.view;i.updateSnow(t.health)},e.prototype.setTestMove=function(){this._doTestMoves=platform.inAutoMode()},e}();__reflect(GameView.prototype,"GameView",["IGameView"]);var BaseWindow=function(e){function t(t,i){var n=e.call(this)||this;return n.name="",n.closeFunc=null,n.window_=null,n.minDepth_=0,n.showScene_=!0,n.gc_=!1,n._resources=[],n._resource_group=[],n.waitID_=null,n.isDisposed_=!1,n.name=t,n.params=i||{},n._isInit=!1,n.percentHeight=100,n.percentWidth=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),t.prototype.setResources=function(e){this._resources=e},t.prototype.setResourcesGroups=function(e){this._resource_group=e},t.prototype.isInit=function(){return this._isInit},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},t.prototype.addTapListener=function(e,t){function i(e){e.stopPropagation(),t.call(this,e)}e.addEventListener(egret.TouchEvent.TOUCH_TAP,i,this)},t.prototype.setVisible=function(e){this.visible=e},t.prototype.onClickCloseButton=function(){},t.prototype.addToUILayer=function(e){this._myParent=e,this._myParent.addChild(this),this.addColliderBg(),this.initWindow(),this.openWindow(this.params),this.addObjActive()},t.prototype.initWindow=function(){this.showScene_||this.showScene(!1),this.closeBtn&&this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClickCloseButton,this)},t.prototype.addObjActive=function(){},t.prototype.addColliderBg=function(){var e=this.params;this.winBg_&&(this.winBg_.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.forceConfirm||this.dispose()}.bind(this),this),e.transparentBg&&(this.winBg_.alpha=.01))},t.prototype.willOpen=function(e){},t.prototype.didOpen=function(e){},t.prototype.openWindow=function(e){},t.prototype.unloadResource=function(){if(void 0!=this._resources&&0!=this._resources.length||void 0!=this._resource_group&&0!=this._resource_group.length){var e="loadGroup_"+this.name;RES.destroyRes(e,!1)}},t.prototype.willClose=function(e,t,i){this.unloadResource(),this.showScene_||this.showScene(!0),null!=this.waitID_,this.visible=!1,this.isDisposed_=!0},t.prototype.didClose=function(e){},t.prototype.update=function(e){},t.prototype.playOpenAnimation=function(){var e=WindowTable.get().openAnimation(this.name);if(e&&void 0!=this.content_){var t=new TimelineLite;t.add(TweenLite.fromTo(this.content_,.42,{alpha:.5},{alpha:1}),0),t.add(TweenLite.fromTo(this.content_,.13,{scaleX:.5,scaleY:.5},{scaleX:1.1,scaleY:1.1}),0),t.add(TweenLite.to(this.content_,.13,{scaleX:.97,scaleY:.97}),.13),t.add(TweenLite.to(this.content_,.16,{scaleX:1,scaleY:1}),.26)}},t.prototype.playOpenAnimations=function(e,t){t&&t()},t.prototype.playCloseAnimations=function(e){e()},t.prototype.updateWindowLayout=function(e){},t.prototype.updateWindowDisplay=function(e){},t.prototype.dispose=function(){this.removeFromParent(),this._myParent=null,this._resources=null},t.prototype.onBackBtnClick=function(){},t.prototype.ready2Open=function(){return!0},t.prototype.initGuideParams=function(e){},t.prototype.showScene=function(e){},t.prototype.hideWindow=function(){this.setVisible(!1)},t.prototype.showWindow=function(){this.setVisible(!0)},t.prototype.addBg=function(){console.log("add common bg with close func")},t.prototype.layerType=function(){return WindowTable.get().layerType(this.name)},t.prototype.backType=function(){return WindowTable.get().backType(this.name)},t.prototype.loadAsset=function(e,t){var i=this;if(void 0===e&&(e=null),void 0===t&&(t=null),this._resources&&this._resources.length>0||this._resource_group&&this._resource_group.length>0){var n=this._resources.concat(this._resource_group),o="loadGroup_"+this.name;RES.createGroup(o,n,!0),RES.loadGroup(o).then(function(e){t(i)})}else e&&e(this),t&&t(this)},t}(eui.Component);__reflect(BaseWindow.prototype,"BaseWindow");var ByteArrayMsgByProtobuf=function(e){function t(){var t=e.call(this)||this;t.msgClass=null,t.protoConfigReq=null,t.protoConfigRes=null,t.protoConfigReqSymmetry=null,t.protoConfigResSymmetry=null,t.msgClass={},t.protoConfigReq={},t.protoConfigRes={},t.protoConfigReqSymmetry={},t.protoConfigResSymmetry={};for(var i=Object.keys(App.ProtoConfigReq),n=0,o=i.length;o>n;n++){var a=i[n],s=App.ProtoConfigReq[a],r=parseInt(a);t.protoConfigReq[r]=s,t.protoConfigReqSymmetry[s]=r}i=Object.keys(App.ProtoConfigRes);for(var n=0,o=i.length;o>n;n++){var a=i[n],s=App.ProtoConfigRes[a],r=parseInt(a);t.protoConfigRes[r]=s,t.protoConfigResSymmetry[s]=a}return t}return __extends(t,e),t.prototype.getMsgClass=function(e){var t=this.msgClass[e];return null==t&&(t=App.ProtoFile.build(e),this.msgClass[e]=t),t},t.prototype.getReqMsgID=function(e){return this.protoConfigReqSymmetry[e]},t.prototype.getResMsgID=function(e){return this.protoConfigResSymmetry[e]},t.prototype.getReqMsgKey=function(e){return this.protoConfigReq[e]},t.prototype.getResMsgKey=function(e){return this.protoConfigRes[e]},t.prototype.decode=function(e){var t=e.readUnsignedShort(),i=e.readUnsignedInt();if(e.bytesAvailable>=i){var n=e.readUnsignedInt(),o=new egret.ByteArray;e.readBytes(o,0,i-4);var a={};return a.seq=n,a.mid=t,a.key=this.getResMsgKey(t),App.DebugUtils.start("Protobuf Decode"),a.body=this.getMsgClass(a.key).decode(o.buffer),App.DebugUtils.stop("Protobuf Decode"),Log.trace("收到数据：","["+t+" "+a.key+"]",a.body),a}return null},t.prototype.encode=function(e){var t=e.mid,i=this.getReqMsgKey(t),n=new(this.getMsgClass(i))(e.body);App.DebugUtils.start("Protobuf Encode");var o=new egret.ByteArray(n.toArrayBuffer());App.DebugUtils.stop("Protobuf Encode"),Log.trace("发送数据：","["+t+" "+i+"]",e.body);var a=new egret.ByteArray;return a.writeUnsignedShort(t),a.writeBytes(o),a},t}(ByteArrayMsg);__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var Socket=function(e){function t(){var t=e.call(this)||this;return t._needReconnect=!1,t._maxReconnectCount=10,t._reconnectCount=0,t}return __extends(t,e),t.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},t.prototype.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},t.prototype.onSocketOpen=function(){this._reconnectCount=0,this._isConnecting=!0,this._connectFlag&&this._needReconnect?App.MessageCenter.dispatch(SocketConst.SOCKET_RECONNECT):App.MessageCenter.dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0},t.prototype.onSocketClose=function(){this._isConnecting=!1,this._needReconnect?(App.MessageCenter.dispatch(SocketConst.SOCKET_START_RECONNECT),this.reconnect()):App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE)},t.prototype.onSocketError=function(){this._needReconnect?this.reconnect():App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},t.prototype.onReceiveMessage=function(e){this._msg.receive(this._socket)},t.prototype.initServer=function(e,t,i){this._host=e,this._port=t,this._msg=i},t.prototype.connect=function(){if(App.DeviceUtils.IsHtml5&&!window.WebSocket)return void Log.trace("不支持WebSocket");this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),Log.trace("WebSocket: "+this._host+":"+this._port),this.addEvents();var e=("https:"==document.location.protocol?!0:!1,this._port),t=this._host,i="ws";i="wss",this._socket.connectByUrl(i+"://"+t+":"+e+"/ws")},t.prototype.reconnect=function(){this.closeCurrentSocket(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE):App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT))},t.prototype.send=function(e){this._msg.send(this._socket,e)},t.prototype.close=function(){this._isConnecting&&(this._connectFlag=!1,this.closeCurrentSocket())},t.prototype.closeCurrentSocket=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1},Object.defineProperty(t.prototype,"isConnecting",{get:function(){return this._isConnecting},enumerable:!0,configurable:!0}),t.prototype.debugInfo=function(e){App.MessageCenter.dispatch(SocketConst.SOCKET_DEBUG_INFO,e)},t}(BaseClass);__reflect(Socket.prototype,"Socket");var SocketConst=function(){function e(){}return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_MESSAGE="SOCKET_MESSAGE",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();__reflect(SocketConst.prototype,"SocketConst");var LoggerConst=function(){function e(){}return e.OP_CLICK="click",e.OP_IMPR="impr",e.OP_SHARE="share",e.PAGE_SN_GAME=12337,e.EL_SN_BRAND_CARD_CLOSE_BTN=388522,e.EL_SN_BRAND_CARD_NEXT_BTN=388586,e.EL_SN_BRAND_CARD_USE_BTN=388521,e.EL_SN_LEADERBOARD_MAIN_SEND_BTN=392196,e.EL_SN_LEADERBOARD_MAIN_INVITE_BTN=392193,e.EL_SN_LEADERBOARD_ONE_CLICK_SEND_BTN=392195,e.EL_SN_LEADERBOARD_ONE_CLICK_CLAIM_BTN=392194,e.EL_SN_DOWNGRADE_FPS=421703,e.EL_SN_GOTO_TASK_BTN=425661,e.EL_SN_GET_REWARD_BTN=425623,e.EL_SWITCH_STAGE_BTN=425660,e.EL_SN_GET_ALL_OR_ACTIVATE_BTN=425665,e.EL_SN_GET_EXP_BTN=425663,e.EL_SN_REWARD_IMPR=425664,e.EL_SN_GOTO_NOW_BTN=425675,e.EL_SN_PREGAME_CLOSE_BTN=457938,e.EL_SN_PREGAME_START_RETRY_BTN=457939,e.EL_SN_PREGAME_ITEM_1=457941,e.EL_SN_PREGAME_ITEM_2=457942,e.EL_SN_PREGAME_ITEM_3=457943,e.EL_SN_PREGAME_ITEM_4=497152,e.EL_SN_PREGAME_SHARE_BTN=457940,e.EL_SN_WINGAME_NEXT_BTN=458933,e.EL_SN_WINGAME_SHARE_BTN=458934,e.EL_SN_WINGAME_CLOSE_BTN=458935,e.EL_SCORE_RANK_SINGLE_RECALL_BTN=474770,e.EL_SCORE_RANK_ALL_RECALL_BTN=474769,e.EL_SN_VISIT_BTN=478257,e.EL_SN_VISIT_BTN_RANODW=0,e.EL_SN_VISIT_BTN_OTHERS=1,e.EL_SN_QUEST_TAB=478253,e.EL_SN_VISIT_TAB=478254,e.EL_SN_ZONE_TAB=478255,e.EL_SN_QUEST_BTN=478256,e.EL_SN_QUEST_BTN_ACTIVE=0,e.EL_SN_QUEST_BTN_TIME_ACTIVE=1,e.EL_SN_QUEST_BTN_TIME_ACCELERATE=2,e.EL_SN_QUEST_BTN_TIME_COMPLETE=3,e.EL_SN_HOME_OR_STAGE=478250,e.EL_SN_HOME_OR_STAGE_HOME=0,e.EL_SN_HOME_OR_STAGE_STAGE=1,e.EL_SN_QUEST_ICON=478251,e.EL_SN_ITEM_SUPPLY_USE=576101,e.EL_SN_ITEM_SUPPLY_NOT_USE=576108,e.EL_SN_ITEM_SUPPLY_USE_CLOSE=576096,e.EL_SN_ITEM_SUPPLY_BUY=576373,e.EL_SN_ITEM_SUPPLY_BUY_CLOSE=576337,e.EL_SN_BOARD_SHOW=689416,e.EL_SN_IN_GAME_SETTING_BTN_CLICK=689419,e.EL_SN_IN_GAME_ITEM_CLICK=689418,e.EL_SN_ELEMENT_CLICK=689417,e.EL_SN_MAIN_START_BTN=1037693,e.EL_SN_BILLION_CASH_BTN=1089995,e.EL_SN_FUND_BANNER_PREGAME=4721474,e.EL_SN_FUND_BANNER_WINGAME=4721475,e.EL_SN_FUND_STAGE=4721438,e}();__reflect(LoggerConst.prototype,"LoggerConst");var UTFMsgByJson=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.decode=function(e){return JSON.parse(e)},t.prototype.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var BaseEuiLayer=function(e){function t(){var t=e.call(this)||this;return t.percentWidth=100,t.percentHeight=100,t.touchEnabled=!1,t}return __extends(t,e),t}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastBgVolume=0,t.retryTimes_=0,t.MAX_RETRY_TIMES=10,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.touchEnabled=!1,window.platform||(window.platform=new DebugPlatform),window.logger=new Logger,egret.lifecycle.addLifecycleListener(function(e){});var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),egret.ImageLoader.crossOrigin="anonymous",this.runGame()["catch"](function(e){logger.error(e,!0)})},t.prototype._registerSoundEvents=function(){var e=this;this.stage.addEventListener(egret.Event.DEACTIVATE,function(){console.log("on pause"),"ios"==xyd.system.toLowerCase()?SoundManager.getInstance().isGameJsSoundPoolAvailable()?(SoundManager.getInstance().stopBg(),SoundManager.getInstance().saveSoundEffectStateBeforePause()):(e.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.triggerMusic,e),SoundManager.getInstance().saveBgVolumeBeforPause(),SoundManager.getInstance().saveSoundEffectStateBeforePause()):(egret.ticker.pause(),SoundManager.getInstance().stopBg(),SoundManager.getInstance().saveSoundEffectStateBeforePause())},this),this.stage.addEventListener(egret.Event.ACTIVATE,function(){console.log("on resume"),"ios"==xyd.system.toLowerCase()?SoundManager.getInstance().isGameJsSoundPoolAvailable()?(SoundManager.getInstance().triggerReady(),SoundManager.getInstance().resumePlayBg(),SoundManager.getInstance().setSoundEffectStateAfterResume()):(SoundManager.getInstance().setBgVolumeAfterResume(),SoundManager.getInstance().setSoundEffectStateAfterResume()):(egret.ticker.resume(),SoundManager.getInstance().resumePlayBg(),SoundManager.getInstance().setSoundEffectStateAfterResume())},this),xyd.EventDispatcher.inner().addEventListener(xyd.event.JS_SOUND_POOL_INITED,this._initSound,this)},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,n,o=this;return __generator(this,function(a){switch(a.label){case 0:return xyd.Global.init(),e=this.loadResource(),t=platform.callMethod("GET_GAME_INFO",{}).then(function(e){e.maxLevel&&e.maxLevel>1&&(xyd.MAX_STAGE=e.maxLevel),SelfInfo.get().initSelf(e),30==e.frameRate||60==e.frameRate?o._updateFrameRate(e.frameRate):o._updateFrameRate(60)})["catch"](function(e){logger.error(e)}),i=[e,t],[4,Promise.all(i)["catch"](function(e){logger.error(e)})];case 1:return a.sent(),[4,platform.callMethod("GET_SYSTEM_INFO",{}).then(function(e){xyd.system=e.system||"",xyd.isApp=1==e.is_app?!0:!1,xyd.isiOS8=1==e.is_ios_8?!0:!1,xyd.isLowEndDevice=1==e.is_low_end_device?!0:!1;var t=e.width||0,i=Number(e.statusBarHeight)||0;44==i&&(xyd.isiPhoneX=!0),i=0>=t?0:1080/t*i,xyd.statusBarHeight=i;var n=egret.Capabilities.renderMode;xyd.renderMode=n,"android"==xyd.system.toLowerCase()&&"canvas"==n&&logger.error("Android device should not run in canvas mode")})["catch"](function(e){return logger.error(e)})];case 2:return a.sent(),this.initScene(),[4,platform.callMethod("GET_AB_TESTS",{}).then(function(e){ABTest.get().setData(e)})["catch"](function(e){return logger.error(e)})];case 3:return a.sent(),[4,platform.callMethod("GET_USER_INFO",{}).then(function(e){SelfInfo.get().setExtraData(e)})["catch"](function(e){return logger.error(e)})];case 4:return a.sent(),this._registCallbacks(),this._registerSoundEvents(),platform.callMethod("GAME_LOADED",{})["catch"](function(e){return logger.error(e)}),xyd.loadJsonForLevel(SelfInfo.get().getCurrentLevel()||1),this.initController(),n=LevelTable.get(),n.init(),n.Clip(),xyd.isApp?SelfInfo.get().enterLinkType!=xyd.EnterLinkType.Main?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):SelfInfo.get().getCurrentLevel()>SelfInfo.get().getEnterHomeMapLevel()?ABTest.get().getSetting(ABTest.SEVERN_MAP)?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)?platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.HomeMap})["catch"](function(e){logger.error(e)}):(platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN))):MainController.get().newUserEntered():platform.callMethod("GET_SAVED_GAME",{}).then(function(e){var t=e.data;t.saveTime||(t.saveTime=new Date(2019,8,10));var i=(new Date).getTime()-t.saveTime;if(i>864e5&&(t=void 0,platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)})),t&&t.ver&&t.ver!=xyd.SAVE_DATA_VER&&(t=void 0,platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)})),platform.inTestMode()&&platform.inAutoMode())MainController.get().newUserEntered();else{var n=!0;t&&void 0!=t.enterLinkType&&(n=SelfInfo.get().enterLinkType==t.enterLinkType),t&&t.totalLevel&&n?(SelfInfo.get().enterLinkType!=xyd.EnterLinkType.Main&&t&&void 0!=t.mission_info&&(SelfInfo.get().isInMission=!0,SelfInfo.get().missionLevel=t.mission_info.mission_level,SelfInfo.get().missionID=t.mission_info.mission_id,SelfInfo.get().missionItemLock=1==t.mission_info.item_lock),SoundManager.getInstance().playBg("bgm_level_mp3"),xyd.loadJsonForLevel(t.totalLevel).then(function(e){if(!e)return logger.error("load leveldata fail"),platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)}),platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}),void xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN));var i=new GameConf;i.init(t.totalLevel),i.cellMap=CellUtils.generateCellMapFromPropMap(t.cellMap);var n=MainController.get().initGameFromConf(i);platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)}),n.setSavedData(t),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START))})["catch"](function(e){logger.error("load leveldata fail")})):SelfInfo.get().enterLinkType!=xyd.EnterLinkType.Main?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):SelfInfo.get().getCurrentLevel()>SelfInfo.get().getEnterHomeMapLevel()?ABTest.get().getSetting(ABTest.SEVERN_MAP)?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)?platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.HomeMap})["catch"](function(e){logger.error(e)}):(platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN))):MainController.get().newUserEntered()}})["catch"](function(e){return logger.error(e)}),platform.inDebugMode()&&(mouse.enable(this.stage),mouse.setMouseMoveEnabled(!1)),[2]}})})},t.prototype._initSound=function(){console.log("main _initSound"),"ios"==xyd.system.toLowerCase()?SoundManager.getInstance().isGameJsSoundPoolAvailable()?this.triggerMusic():this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.triggerMusic,this):this.triggerMusic()},t.prototype._registCallbacks=function(){platform.callMethod("GAME_ON_SHOW",{callback:this._onShowCallback})["catch"](function(e){logger.error(e)}),platform.callMethod("GAME_ON_HIDE",{callback:this._onHideCallback})["catch"](function(e){logger.error(e)}),platform.callMethod("ON_GATHER_TASK_ICON_CLICK",{callback:this._onGatherTaskIconClick})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_RECEIVE_ITEMS_ANIM",{callback:this._h5_receive_items_anim})["catch"](function(e){logger.error(e)}),platform.callMethod("SYNC_GAME_DATA",{callback:this._onSyncGameData})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_OPEN_PREGAME_WIN",{callback:this._h5_open_pregame_win})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_CLOSE_PREGAME_WIN",{callback:this._h5_close_pregame_win})["catch"](function(e){logger.error(e)}),platform.callMethod("LEADERBOARD_ON_ICON_CLICK",{callback:this._leaderboard_on_icon_click})["catch"](function(e){logger.error(e)}),platform.callMethod("MONTHLY_CARD_ON_ICON_CLICK",{callback:this._monthly_card_on_icon_click})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_ACTION_IN_GAME",{callback:this._onActionInGame})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_TOGGLE_MAP",{callback:this._h5_toggle_map})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_GET_IS_PLAY_IN_STAGE",{callback:this._is_play_in_game})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_ENTER_GAME_DIRECTLY",{callback:this._h5_enter_game_directly})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_IN_GAME_WINDOW",{callback:this._h5_in_game_window})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_NEW_USER_ENTER_HOME_MAP",{callback:this._h5_new_user_enter_home_map})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_SHOW_WIN_WINDOW",{callback:this._h5_show_win_window})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_SOUND_BG",{callback:this._h5_sound_bg})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_SOUND_EFFECT",{callback:this._h5_sound_effect})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_GOTO_MAP",{callback:this._h5_goto_map})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_GET_GAME_TARGET",{callback:this._h5_get_game_target})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_GAME_RELEASE_MEMORY",{callback:this._h5_game_release_memory})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_GAME_RESUME",{callback:this._h5_game_resume})["catch"](function(e){logger.error(e)}),platform.callMethod("H5_SHOW_SETTING_WIN",{callback:this._h5_show_setting_win})["catch"](function(e){logger.error(e)})},t.prototype.waitResPromise=function(e){return new Promise(function(t,i){var n;0==e?n=RES.loadConfig("default.res210329194522.json",platform.getResUrl()+"resource/"):2==e?n=RES.loadGroup("preload"):i("unknown restype!"),n.then(function(){t()})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,this.waitResPromise(0)["catch"](function(e){logger.error(e,!0)})];case 1:return t.sent(),[4,this.loadTheme()["catch"](function(e){logger.error(e,!0)})];case 2:return t.sent(),RES.createGroup("preload",["common","num"],!0),RES.createGroup("match3Res",["game","item","pre_effect"],!0),[4,this.waitResPromise(2)["catch"](function(e){logger.error(e,!0)})];case 3:return t.sent(),RES.loadGroup("nocompress"),RES.loadGroup("match3Res"),[3,5];case 4:return e=t.sent(),console.error("loadResource Error:",e),logger.error(e,!0),[3,5];case 5:return[2]}})})},t.prototype._updateFrameRate=function(e){this.stage.frameRate=e,xyd.frameRate=e,xyd.frameScale=e/30,xyd.DeltaTime=1/e,xyd.G=xyd.G/xyd.frameScale,xyd.MAX_YA=xyd.MAX_YA/xyd.frameScale},t.prototype.triggerMusic=function(){SoundManager.getInstance().triggerReady(),SoundManager.getInstance().resumePlayBg(),SoundManager.getInstance().setSoundEffectStateAfterResume(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.triggerMusic,this)},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})["catch"](function(e){logger.error(e,!0)})},t.prototype.initScene=function(){App.SceneManager.register(SceneConsts.Game,new GameScene),App.SceneManager.runScene(SceneConsts.Game),App.SceneManager.getCurrScene().addLayerAt(new BaseSpriteLayer,0)},t.prototype.initController=function(){MainController.get()},t.prototype._onHideCallback=function(){},t.prototype._onShowCallback=function(){SoundManager.getInstance().triggerReady()},t.prototype._onSyncGameData=function(e){SelfInfo.get().syncGameData(e)},t.prototype._onGatherTaskIconClick=function(){xyd.WindowManager.get().openWindow("red_packet_window")},t.prototype._onActionInGame=function(){var e=xyd.WindowManager.get().getWindow("stage_window");e&&e.onOperation()},t.prototype._onLuckyWheelSpin=function(e){if(void 0!=e&&void 0!=e.level&&e.success){var t=xyd.WindowManager.get().getWindow("stage_window");t&&t.iconClose(e.level)}},t.prototype._h5_receive_items_anim=function(e){if(e.items){var t={};for(var i in e.items){var n=e.items[i],o=i.split("=");if(o||2==o.length){var a=Number(o[0]),s=Number(o[1]);isNaN(a)||isNaN(s)||(1==a?(s+=2e3,t[s]=n):2==a&&(t[s]=n))}}xyd.WindowManager.get().openWindow("item_reward_window",{items:t,onComplete:e.onComplete})}},t.prototype._h5_play_or_stop_bgm=function(e){var t=!0;e&&(t=e.needPlay),console.log("_h5_play_or_stop_bgm",e.needPlay),t?"ios"==xyd.system.toLowerCase()?SoundManager.getInstance().setBgVolumeAfterResume():(egret.ticker.resume(),SoundManager.getInstance().resumePlayBg()):"ios"==xyd.system.toLowerCase()?(this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.triggerMusic,this),SoundManager.getInstance().saveBgVolumeBeforPause()):(egret.ticker.pause(),SoundManager.getInstance().stopBg())},t.prototype._h5_in_game_window=function(e){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.H5_IN_GAME_WINDOW,!1,e)},t.prototype._h5_new_user_enter_home_map=function(){},t.prototype._h5_enter_game_directly=function(e){e&&void 0!=e.mission_info&&(SelfInfo.get().isInMission=!0);var t=[];if(SelfInfo.get().isInMission){var i=e.mission_info.active_item_list;if(i&&i.length>0)for(var n=0,o=i;n<o.length;n++){var a=o[n];t.push(Number(a))}SelfInfo.get().missionLevel=e.mission_info.mission_level||0,SelfInfo.get().missionID=e.mission_info.mission_id||0,SelfInfo.get().missionItemLock=1==e.mission_info.item_lock
}var s=Math.min(SelfInfo.get().getCurrentLevel(),xyd.MAX_STAGE);e&&e.level&&(s=SelfInfo.get().isInMission?e.level:Math.min(s,e.level));var r=-1,l=-1;if(10>=s)r=1,l=s;else if(20>=s)r=2,l=s-10;else{var _=s-5;r=Math.floor(_/15)+2,_%=15,0==_?(r--,l=15):l=_}var h=platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!0,chapter:r,level:l,total_level:s}),c=xyd.loadJsonForLevel(s),d=[h,c];Promise.all(d).then(function(e){var i=e[0],n=e[1];if(!n)return void logger.error("load leveldata fail");if(i&&i.success){SoundManager.getInstance().playBg("bgm_level_mp3"),xyd.WindowManager.get().closeWindow("stage_window"),xyd.WindowManager.get().closeWindow("pre_game_window"),xyd.WindowManager.get().closeWindow("severn_map_window"),xyd.WindowManager.get().closeWindow("map_window");var o=new GameConf;o.init(s);var a=MainController.get().initGameFromConf(o),r=o.scoreTargets[0];if(a.setScoreTarget(r),i.funds&&a.setFundActivity(i.funds.init_count,i.funds.drop_count),SelfInfo.get().isInMission)a.setActiveItemList(t);else{var l=o.pregameItemList;if(ABTest.get().getSetting(ABTest.NEWUSER_BENEFITS)&&SelfInfo.get().getCurrentLevel()>=11&&SelfInfo.get().getCurrentLevel()<=50){var _=Math.ceil(4*Math.random());SelfInfo.get().newUserBenefitsItemID=l[_-1]}for(var h=[],c=0,d=l;c<d.length;c++){var p=d[c],u=String(ItemConstants.LIMITED_TIME_OFFSET+p),m=SelfInfo.get().getItemNumByID(u);(m||SelfInfo.get().newUserBenefitsItemID==p)&&h.push(p)}a.setActiveItemList(h)}var g=[RES.loadGroup("game")];Promise.all(g).then(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START,!1,!1,{isDirectly:!0}))})}})["catch"](function(e){logger.error("load leveldata fail")})},t.prototype._h5_open_pregame_win=function(e){var t=!0;if(MainController.get().isInGame()){if(!MainController.get().inWinState())return}else t=!1;var i=SelfInfo.get().getCurrentLevel(),n=!1;i=void 0==e||void 0==e.level||isNaN(e.level)?SelfInfo.get().getCurrentLevel():e.level>i?SelfInfo.get().getCurrentLevel():e.level;var o;e&&(n=e.lottery_text,o=e.scene_id);var a;e&&(a=e.need_replace_leaderboard),i=Math.min(i,xyd.MAX_STAGE),xyd.WindowManager.get().closeWindow("pre_game_window"),t&&xyd.WindowManager.get().isOpen("win_game_window")&&xyd.WindowManager.get().closeWindow("win_game_window"),logger.logStep("E:start-"+i),xyd.loadJsonForLevel(i).then(function(e){return e?void xyd.WindowManager.get().openWindow("pre_game_window",{totalLevel:i,lottery_text:n,scene_id:o,needReplaceLeaderboard:a}):void logger.error("load leveldata fail")})["catch"](function(e){logger.error("load leveldata fail")})},t.prototype._h5_close_pregame_win=function(e){var t=xyd.WindowManager.get().getWindow("pre_game_window");t&&t.closeBtnClick()},t.prototype._leaderboard_on_icon_click=function(){xyd.WindowManager.get().openWindow("stage_rank_window")},t.prototype._monthly_card_on_icon_click=function(){xyd.WindowManager.get().openWindow("month_card_window")},t.prototype._is_play_in_game=function(){return MainController.get().isInGame()},t.prototype._h5_toggle_map=function(e){var t=xyd.WindowManager.get().getWindow("map_window"),i=xyd.WindowManager.get().getWindow("stage_window");1==e?void 0!=i&&platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.HomeMap})["catch"](function(e){logger.error(e)}):2==e?void 0!=t&&platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}):logger.error("Cannot toggle map. Current map type is not correct.")},t.prototype._h5_goto_map=function(e){MainController.get().h5GoToMap(e)},t.prototype._h5_show_win_window=function(e){if((0==e.show_pre_game_window||1==e.show_pre_game_window)&&(1==e.show_pre_game_window?SelfInfo.get().setSkipPreWindow(!1):SelfInfo.get().setSkipPreWindow(!0)),0==e.show_end_game_window){var t=xyd.WindowManager.get().getWindow("win_game_window");t&&t.closeUIAndDoNext()}else{var t=xyd.WindowManager.get().getWindow("win_game_window");t&&t.showUI()}},t.prototype._h5_sound_bg=function(e){var t=SoundManager.getInstance();t.setBgOn(e),SelfInfo.get().setSoundBg(e)},t.prototype._h5_sound_effect=function(e){var t=SoundManager.getInstance();t.setEffectOn(e),SelfInfo.get().setSoundEffect(e)},t.prototype._h5_get_game_target=function(e){for(var t=e.level_list,i=[],n=0,o=t;n<o.length;n++){var a=o[n],s=new GameConf;s.init(a);var r=s.modeName;switch(r){case GameModeConstants.CLASSIC_MOVES:i.push({mode:1,target:s.scoreTargets[0]});break;case GameModeConstants.OBJECTIVE:i.push({mode:2,target:s.objectives});break;case GameModeConstants.LEAF_OBJECTIVE:for(var l=0,_=s.cellMap,h=0,c=9;c>h;h++)for(var d=0,p=9;p>d;d++){var u=_[h][d];(u.hasProperty(CellConstants.LEAF_1)||u.hasProperty(CellConstants.LEAF_2))&&l++}var m=s.objectives;m.push({item:27,quantity:l}),i.push({mode:3,target:m});break;case GameModeConstants.LAMP:var m=[],g=s.lamps,f=0,y=0;g.length>=1&&(f=s.lamps[0],f>0&&m.push({item:28,quantity:f})),g.length>=2&&(y=s.lamps[1],y>0&&m.push({item:29,quantity:y})),i.push({mode:4,target:m});break;case GameModeConstants.LEAF:for(var l=0,_=s.cellMap,h=0,c=9;c>h;h++)for(var d=0,p=9;p>d;d++){var u=_[h][d];(u.hasProperty(CellConstants.LEAF_1)||u.hasProperty(CellConstants.LEAF_2))&&l++}var m=[{item:27,quantity:l}];i.push({mode:5,target:m});break;case GameModeConstants.LEAF_LAMP:var m=[],g=s.lamps,f=0,y=0;g.length>=1&&(f=s.lamps[0],f>0&&m.push({item:28,quantity:f})),g.length>=2&&(y=s.lamps[1],y>0&&m.push({item:29,quantity:y}));for(var l=0,_=s.cellMap,h=0,c=9;c>h;h++)for(var d=0,p=9;p>d;d++){var u=_[h][d];(u.hasProperty(CellConstants.LEAF_1)||u.hasProperty(CellConstants.LEAF_2))&&l++}m.push({item:27,quantity:l}),i.push({mode:6,target:m})}}return i},t.prototype._h5_show_setting_win=function(e){var t=xyd.WindowManager.get().getWindow("stage_window");t&&t.onSetting()},t.prototype._h5_game_release_memory=function(){MainController.get().inReleaseState||MainController.get().isInGame()||(MainController.get().inReleaseState=!0,xyd.WindowManager.get().closeAllWindows(["stage_window"]),xyd.WindowManager.get().closeWindow("stage_window"),MainController.get().releaseBasicRes())},t.prototype._h5_game_resume=function(){MainController.get().inReleaseState&&RES.loadGroup("preload").then(function(){MainController.get().inReleaseState=!1,SelfInfo.get().enterLinkType!=xyd.EnterLinkType.Main?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):ABTest.get().getSetting(ABTest.SEVERN_MAP)?(platform.callMethod("SHOW_SEVERN_MAP",{}),xyd.WindowManager.get().openWindow("severn_map_window")):(platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN)))})["catch"](function(e){logger.error("resume resource fail")})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var BaseSpriteLayer=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!1,t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var SceneManager=function(e){function t(){var t=e.call(this)||this;return t._scenes={},t}return __extends(t,e),t.prototype.clear=function(){var e=this._scenes[this._currScene];e&&(e.onExit(),this._currScene=void 0),this._scenes={}},t.prototype.register=function(e,t){this._scenes[e]=t},t.prototype.runScene=function(e){var t=this._scenes[e];if(null==t)return void Log.trace("场景"+e+"不存在");var i=this._scenes[this._currScene];i&&i.onExit(),t.onEnter(),this._currScene=e},t.prototype.getCurrScene=function(){return this._scenes[this._currScene]},t}(BaseClass);__reflect(SceneManager.prototype,"SceneManager");var DebugPlatform=function(){function e(){this._autoMode=!1,this._testMode=!1,this._gameBridge=new DebugGameBridge,this._jsSoundPool=new DebugJSSound,console.log("")}return e.prototype.getResUrl=function(){return window.PACKCONFIG?window.PACKCONFIG:""},e.prototype.getMsgUrl=function(){return"http://192.168.2.38/api/v2"},e.prototype.getVersion=function(){return""},e.prototype.showModal=function(e){egret.setTimeout(e.success,this,2e3)},e.prototype.callMethod=function(e,t){var i=this;return new Promise(function(n,o){i._gameBridge.callMethod(e,t,function(e,t){void 0==e?n(t):o(e)})})},e.prototype.showOverlay=function(e){console.log("##### Show Overlay "+e),this.callMethod("GAME_SHOW_UI",{show_overlay:e})["catch"](function(e){return console.log(e)})},e.prototype.showGotoApp=function(e){this.callMethod("GAME_SHOW_UI",{show_goto_app:e})["catch"](function(e){return console.log(e)})},e.prototype.inDebugMode=function(){return!0},e.prototype.inAutoMode=function(){return this._autoMode},e.prototype.inTestMode=function(){return this._testMode},e.prototype.inDevMode=function(){return!0},e.prototype.switchAutoMode=function(){this._autoMode=!this._autoMode,this._testMode=!this._testMode},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]);var WebPlatform=function(){function e(){}return e.prototype.getResUrl=function(){return window.PACKCONFIG?window.PACKCONFIG:""},e.prototype.getMsgUrl=function(){return"http://192.168.2.38/api/v2"},e.prototype.getVersion=function(){return""},e.prototype.showModal=function(e){egret.setTimeout(e.success,this,2e3)},e.prototype.callMethod=function(e,t){return new Promise(function(i,n){window.gameBridge.callMethod(e,t,function(e,t){void 0==e?i(t):n(e)})})},e.prototype.showOverlay=function(e){this.callMethod("GAME_SHOW_UI",{show_overlay:e})["catch"](function(e){return console.log(e)})},e.prototype.showGotoApp=function(e){this.callMethod("GAME_SHOW_UI",{show_goto_app:e})["catch"](function(e){return console.log(e)})},e.prototype.inDebugMode=function(){return!1},e.prototype.inAutoMode=function(){return!1},e.prototype.inTestMode=function(){return!1},e.prototype.inDevMode=function(){return!1},e.prototype.switchAutoMode=function(){},e}();__reflect(WebPlatform.prototype,"WebPlatform",["Platform"]);var SoundBg=function(e){function t(){var t=e.call(this)||this;return t._currBg="",t}return __extends(t,e),t.prototype.stop=function(){this._currSoundChannel&&(this._currSoundChannel.stop(),platform.inDebugMode()&&console.log("stop sound: "+this._currBg)),this._currSoundChannel=null,this._currSound=null,this._currBg=""},t.prototype.play=function(e){this.stop(),this._currBg=e;var t=this.getSound(e);t&&(this.playSoundLoop(t),platform.inDebugMode()&&console.log("play sound: "+e))},t.prototype.loopSound=function(){this._currSound&&(this._currSoundChannel=this._currSound.play(0,1),this._currSoundChannel.volume=this._volume)},t.prototype.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,0),this._currSoundChannel.volume=this._volume},t.prototype.playSoundLoop=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,0),this._currSoundChannel.volume=this._volume},t.prototype.replayCurrentSound=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSound&&(this._currSoundChannel=this._currSound.play(0,0))},t.prototype.setVolume=function(e){this._volume=e,this._currSoundChannel&&0!=this._currSoundChannel.position&&(this._currSoundChannel.volume=this._volume)},t.prototype.loadedPlay=function(e){this._currBg==e&&SoundManager.getInstance().isReady&&this.playSound(RES.getRes(e))},t.prototype.checkCanClear=function(e){return this._currBg!=e},t.prototype.loadSound=function(e){this.getSound(e)},t}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(e,t){this.soundName_=e;var i=this.getSound(e);i&&this.playSound(i,t)},t.prototype.playSound=function(e,t,i){var n=e.play(0,1),o=this.soundName_;i&&(o=i),n.volume=this._volume*t},t.prototype.onComplete=function(){SoundManager.getInstance().finishEffectSound(this.soundName_)},t.prototype.setVolume=function(e){this._volume=e},t.prototype.loadedPlay=function(e){this.playSound(RES.getRes(e),1,e)},t}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(e){function t(){var t=e.call(this)||this;t.isReady_=!1,t.playeringSound={},t.soundQueue=[],t.ignoreEffect={},t.volumeMinusEffect={},t._needPlaySound=[],t.forbidSound={},t._jsSoundPoolAvailable=!1,t._jsStopSingleAvailable=!1,t._jsDetectHandleSoundInterruptionAvailable=!1,t._effectsGameJsSoundPool={},t._playingSoundID={},t.MAX_SOUND_PLAY=3,t.MAX_SOUND_PLAY_PDD=10,t.SOUND_REDUCE_1=1,t.SOUND_REDUCE_2=.5,t.SOUND_REDUCE_3=.25,t.SOUND_REDUCE_4=.3,t.bgOn=!1,t.effectOn=!1,t.bgVolume=1,t.effectVolume=.5,t.bg=new SoundBg,t.bg.setVolume(t.bgVolume),t.effect=new SoundEffects,t.effect.setVolume(t.effectVolume),t.initGameJsSoundPool(t.MAX_SOUND_PLAY_PDD,1,[t._resNameConvert("bgm_level_mp3"),t._resNameConvert("bgm_map_mp3")],1);for(var i=SoundPriorityTable.get().getMaxSoundPriority(),n=0;i>=n;n++){var o={};t._needPlaySound.push(o)}SoundPriorityTable.get().getAllSoundPriorityInfo();return t.onRegister(),t}return __extends(t,e),t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.onRegister=function(){},t.prototype._soundFrame=function(){for(var e=this,t=0,i=SoundPriorityTable.get().getMaxSoundPriority(),n=!1,o=0;i>=o;o++){var a=this._needPlaySound[o],s=function(i){if(r.forbidSound[i])return"continue";var a=SoundPriorityTable.get().getSoundCd(i);return a.x>0&&(r.forbidSound[i]=!0,egret.setTimeout(function(){e.forbidSound[i]&&(e.forbidSound[i]=!1)},r,xyd.random(a.x,a.y))),r.playeringSound[i]=1,r.playSoundCheckJsSound(i,1),o>0&&(t++,t>=r.MAX_SOUND_PLAY)?(n=!0,"break"):void 0},r=this;for(var l in a){var _=s(l);if("break"===_)break}if(n)break}for(var o=0;i>=o;o++)this._needPlaySound[o]={}},t.prototype.getSoundVolume=function(e){var t=!1;if(1==this.ignoreEffect[e])return this.SOUND_REDUCE_1;if(!t&&this.checkEffectIsPlaying(e))return 0;if(1==this.volumeMinusEffect[e]){var i=0;for(var n in this.volumeMinusEffect)if(this.playeringSound[n]>0&&(i+=1),i>=3)return 0;return this.playeringSound[e]>3?0:this.playeringSound[e]>0?0:this.SOUND_REDUCE_1}return 1},t.prototype.checkMaxSoundIsPlayingJS=function(){var e="";if(this.soundQueue.length>this.MAX_SOUND_PLAY_PDD){e=this.soundQueue[0];for(var t=0;t<=this.soundQueue.length;t++)if(this.soundQueue[t]==e){this.soundQueue.splice(t,1),this.playeringSound[e]=0;break}if(""!=e)if(this._jsSoundPoolAvailable&&this._jsStopSingleAvailable){var i=this.popPlayingSound(e);i?this.stopByGameJsSoundPool(e,i):this.stopByGameJsSoundPool(e)}else this.stopByGameJsSoundPool(e)}},t.prototype.playSoundCheckJsSound=function(e,t){var i=this;if(0!=t){var n=SoundPriorityTable.get().getSoundTime(e);if(this.isGameJsSoundPoolAvailable())return this.checkMaxSoundIsPlayingJS(),void this.playByGameJsSoundPool(e,n);n>0?egret.setTimeout(function(){i.finishEffectSound(e)},this,1e3*n):platform.inDevMode()?this.finishEffectSound(e):egret.setTimeout(function(){i.finishEffectSound(e)},this,5e3),this.effect.play(e,t)}},t.prototype.playEffectDirect=function(e){this.effect.play(e,1)},t.prototype.playBgDirect=function(e){this.bg.play(e)},t.prototype.playEffect=function(e){var t=this;if(this.effectOn){SoundPriorityTable.get().getSoundPriority(e);if(!this.forbidSound[e]){var i=SoundPriorityTable.get().getSoundCd(e);i.x>0&&(this.forbidSound[e]=!0,egret.setTimeout(function(){t.forbidSound[e]&&(t.forbidSound[e]=!1)},this,xyd.random(i.x,i.y))),this.playeringSound[e]=1,this.playSoundCheckJsSound(e,1)}}},t.prototype.playEffectDelay=function(e,t){var i=this;this.effectOn&&t&&t>0&&egret.setTimeout(function(){i.playEffect(e)},this,t)},t.prototype.checkEffectIsPlaying=function(e){return this.playeringSound[e]>this.MAX_SOUND_PLAY?!0:!1},t.prototype.finishEffectSound=function(e){this.playeringSound[e]>0&&(this.playeringSound[e]=0);for(var t=0;t<=this.soundQueue.length;t++)if(this.soundQueue[t]==e){this.soundQueue.splice(t,1);break}if(this._jsSoundPoolAvailable)if(this._jsStopSingleAvailable){var i=this.popPlayingSound(e);i?this.stopByGameJsSoundPool(e,i):this.stopByGameJsSoundPool(e)}else this.stopByGameJsSoundPool(e);else this.popPlayingSound(e)},t.prototype.loadBgSound=function(e){this.isGameJsSoundPoolAvailable()||this.bg.loadSound(e)},t.prototype.playBg=function(e){this.currBg=e,this.currBg!=e&&this.clearAllPlayingEffect(),console.log(this.bgOn),console.log(this.isReady),this.bgOn&&this.isReady&&(console.log(e),this.isGameJsSoundPoolAvailable()?(console.log("playBgJS"),this.playBgMusicByGameJsSoundPool(e,1,1,1)):(console.log("playBg"),this.bg.play(e)),this.savedBgValume&&this.setBgVolume(this.savedBgValume))},t.prototype.resumePlayBg=function(){this.bgOn&&this.currBg&&(console.log(this.currBg),this.isGameJsSoundPoolAvailable()?(console.log("resumePlayBgJS"),this.playBgMusicByGameJsSoundPool(this.currBg,1,1,1)):(console.log("resumePlayBg"),this.playBg(this.currBg)))},t.prototype.stopBg=function(){this.isGameJsSoundPoolAvailable()?this.stopBgMusicByGameJsSoundPool():this.bg.stop()},t.prototype.stopBgDirect=function(){this.bg.stop()},t.prototype.setEffectOn=function(e){this.effectOn=e},t.prototype.getEffectOn=function(){return this.effectOn},t.prototype.setBgOn=function(e){this.bgOn=e,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},t.prototype.getBgOn=function(){return this.bgOn},t.prototype.setBgVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume)},t.prototype.saveBgVolumeBeforPause=function(){void 0==this.savedBgValume&&(this.savedBgValume=this.bgVolume),this.setBgVolume(0)},t.prototype.setBgVolumeAfterResume=function(){this.savedBgValume&&this.setBgVolume(this.savedBgValume)},t.prototype.saveSoundEffectStateBeforePause=function(){this.savedSoundEffectState=this.effectOn,this.setEffectOn(!1)},t.prototype.setSoundEffectStateAfterResume=function(){void 0!=this.savedSoundEffectState&&this.setEffectOn(this.savedSoundEffectState)},t.prototype.getBgVolume=function(){return this.bgVolume},t.prototype.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},t.prototype.getEffectVolume=function(){return this.effectVolume},t.prototype.clearAllPlayingEffect=function(){this.playeringSound={},this.soundQueue=[],this._playingSoundID={}},t.prototype.triggerReady=function(){this.effect.play("blank_mp3",1),this.isReady_=!0},Object.defineProperty(t.prototype,"isReady",{get:function(){return this.isReady_},enumerable:!0,configurable:!0}),t.prototype.pushPlayingSound=function(e,t){this._playingSoundID[e]?this._playingSoundID[e].push(t):(this._playingSoundID[e]=[],this._playingSoundID[e].push(t))},t.prototype.popPlayingSound=function(e){var t=void 0;return this._playingSoundID[e]&&(t=this._playingSoundID[e][0],this._playingSoundID[e].splice(0,1)),t},t.prototype.initGameJsSoundPool=function(e,t,i,n){var o=this;return window.GameJsSoundPool?(console.log("initGameJsSoundPool start"),this._jsSoundPoolAvailable=window.GameJsSoundPool.detectAvailable(),this._jsStopSingleAvailable=window.GameJsSoundPool.detectPlayIdAvailable(),this._jsDetectHandleSoundInterruptionAvailable=window.GameJsSoundPool.detectHandleSoundInterruptionAvailable(),console.log("jsSoundPoolAvailable:",this._jsSoundPoolAvailable),console.log("jsStopSingleAvailable:",this._jsStopSingleAvailable),console.log("jsDetectHandleSoundInterruptionAvailable:",this._jsDetectHandleSoundInterruptionAvailable),this._jsSoundPoolAvailable?(this._gameJsSoundPool=new window.GameJsSoundPool,void(this._gameJsSoundPool&&this._jsSoundPoolAvailable?this._gameJsSoundPool.init({poll_size:e,auto_pause_resume:t}).then(function(){console.log("isGameJsSoundPoolAvailable:",o.isGameJsSoundPoolAvailable()),console.log("this._gameJsSoundPool.inited:",o._gameJsSoundPool.inited),console.log("initGameJsSoundPool success"),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.JS_SOUND_POOL_INITED)),o.isGameJsSoundPoolAvailable()&&(o.loadByGameJsSoundPool(i,n),o.hasInterruptionEvent()&&o._gameJsSoundPool.handleInterruptionResume(null,function(){o.resumePlayBg(),o.clearAllPlayingEffect()},null))})["catch"](function(e){console.log("initGameJsSoundPool error"),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.JS_SOUND_POOL_INITED)),logger.error(e)}):(console.log("initGameJsSoundPool not available"),egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.JS_SOUND_POOL_INITED))},this,10)))):(console.log("initGameJsSoundPool failed"),void egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.JS_SOUND_POOL_INITED))},this,10))):void egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.JS_SOUND_POOL_INITED))},this,10)},t.prototype.loadByGameJsSoundPool=function(e,t){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.preload({paths:e,remoteToMem:t})["catch"](function(e){logger.error(e)})},t.prototype.unloadByGameJsSoundPool=function(e){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.unload({path:e})["catch"](function(e){logger.error(e)})},t.prototype.releaseByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.release({})["catch"](function(e){logger.error(e)})},t.prototype.playByGameJsSoundPool=function(e,t){var i=this,n=this._resNameConvert(e);this._gameJsSoundPool&&this._gameJsSoundPool.inited&&(this._effectsGameJsSoundPool[e]?this._gameJsSoundPool.play({path:n}).then(function(n){i._jsStopSingleAvailable&&n.play_id&&(i.soundQueue.push(e),i.pushPlayingSound(e,n.play_id),t>0?egret.setTimeout(function(){i.finishEffectSound(e)},i,1e3*t):platform.inDevMode()?i.finishEffectSound(e):egret.setTimeout(function(){i.finishEffectSound(e)},i,5e3))})["catch"](function(e){logger.error(e)}):this._gameJsSoundPool.preload({paths:[n],remoteToMem:1}).then(function(){i._effectsGameJsSoundPool[e]=!0,i._gameJsSoundPool.play({path:n}).then(function(n){i._jsStopSingleAvailable&&n.play_id&&(i.soundQueue.push(e),i.pushPlayingSound(e,n.play_id),t>0?egret.setTimeout(function(){i.finishEffectSound(e)},i,1e3*t):platform.inDevMode()?i.finishEffectSound(e):egret.setTimeout(function(){i.finishEffectSound(e)},i,5e3))})["catch"](function(e){logger.error(e)})})["catch"](function(e){logger.error(e)}))},t.prototype.stopByGameJsSoundPool=function(e,t){void 0===t&&(t="");var i=this._resNameConvert(e),n=SoundPriorityTable.get().getUnloadType(e),o=void 0==this._playingSoundID[n]||0==this._playingSoundID[n].length;this._gameJsSoundPool&&this._gameJsSoundPool.inited&&(""==t?this._gameJsSoundPool.stop({path:i})["catch"](function(e){logger.error(e)}):this._gameJsSoundPool.stop({path:i,play_id:t})["catch"](function(e){logger.error(e)}),o&&0==n&&(this.unloadByGameJsSoundPool(i),this._effectsGameJsSoundPool[e]=!1))},t.prototype.pauseByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.pause({})["catch"](function(e){logger.error(e)})},t.prototype.resumeByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.resume({})["catch"](function(e){logger.error(e)})},t.prototype.playBgMusicByGameJsSoundPool=function(e,t,i,n){if(this._gameJsSoundPool&&this._gameJsSoundPool.inited){var o=this._resNameConvert(e);this._gameJsSoundPool.playBgMusic({path:o,loop:t,download:i,auto_pause_resume:n})["catch"](function(e){logger.error(e)})}},t.prototype.stopBgMusicByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.stopBgMusic({})["catch"](function(e){logger.error(e)})},t.prototype.pauseBgMusicByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.pauseBgMusic({})["catch"](function(e){logger.error(e)})},t.prototype.resumeBgMusicByGameJsSoundPool=function(){this._gameJsSoundPool&&this._gameJsSoundPool.inited&&this._gameJsSoundPool.resumeBgMusic({})["catch"](function(e){logger.error(e)})},t.prototype.isGameJsSoundPoolAvailable=function(){return this._jsSoundPoolAvailable&&this._gameJsSoundPool&&this._gameJsSoundPool.inited?!0:!1},t.prototype.hasInterruptionEvent=function(){return this._jsDetectHandleSoundInterruptionAvailable&&this._gameJsSoundPool&&this._gameJsSoundPool.inited?!0:!1},t.prototype._resNameConvert=function(e){var t=RES.config.getResourceWithSubkey(e),i=t.r;return i.root+i.url},t.prototype.unloadAllEffectSound=function(){if(this._gameJsSoundPool&&this._gameJsSoundPool.inited){var e=this._effectsGameJsSoundPool;for(var t in e)if(this._effectsGameJsSoundPool[t]){var i=this._resNameConvert(t);this._gameJsSoundPool.stop({path:i})["catch"](function(e){logger.error(e)});var n=SoundPriorityTable.get().getUnloadType(t);1!=n&&(this.unloadByGameJsSoundPool(i),this._effectsGameJsSoundPool[t]=!1)}}},t.CLEAR_TIME=18e4,t}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var starlingswf;!function(e){var t=function(){function t(i,n,o){void 0===o&&(o=24),this._swfData=i,this._assetManager=n,this._createDisplayFuns=new Object,this._createDisplayFuns[t.dataKey_Sprite]=this.createSprite,this._createDisplayFuns[t.dataKey_MovieClip]=this.createMovie,this._createDisplayFuns[t.dataKey_Image]=this.createImage,this._createDisplayFuns[t.dataKey_Scale9]=this.createS9Image,this._createDisplayFuns[t.dataKey_ShapeImg]=this.createShapeImage,this._createDisplayFuns[t.dataKey_TextField]=this.createTextField,this.swfUpdateManager=e.SwfUpdateManager.createSwfUpdateManager(o)}return t.prototype.createSprite=function(i,n,o){void 0===n&&(n=null),void 0===o&&(o=null),null==o&&(o=this._swfData[t.dataKey_Sprite][i]);for(var a,s,r,l=new e.SwfSprite,_=o.length,h=0;_>h;h++)a=o[h],r=this._createDisplayFuns[a[1]],null!=r&&(s=r.apply(this,[a[0],a]),s.name=a[9],s.x=a[2],s.y=a[3],a[0]==t.dataKey_TextField,a[1]!=t.dataKey_Scale9&&a[1]!=t.dataKey_ShapeImg&&(s.scaleX=a[4],s.scaleY=a[5]),s.skewX=a[6],s.skewY=a[7],s.alpha=a[8],l.addChild(s));return l},t.prototype.createMovie=function(i,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var a,s,r,l,_,h=this._swfData[t.dataKey_MovieClip][i],c=h.objCount,d={};for(_ in c){s=c[_][0],r=c[_][1],a=null==d[_]?[]:d[_];for(var p=0;r>p;p++)l=this._createDisplayFuns[s],null!=l&&a.push(l.apply(this,[_,null]));d[_]=a}var u;return u=null==o?new e.SwfMovieClip(h.frames,h.labels,d,this):new o(h.frames,h.labels,d,this),u.loop=h.loop,u},t.prototype.createImage=function(e,i){void 0===i&&(i=null);var n=this._swfData[t.dataKey_Image][e],o=this._assetManager.createBitmap(e);return o.anchorOffsetX=n[0],o.anchorOffsetY=n[1],o},t.prototype.getTexture=function(e){return this._assetManager.getTexture(e)},t.prototype.createS9Image=function(e,i){void 0===i&&(i=null);var n=this._swfData[t.dataKey_Scale9][e],o=this._assetManager.createBitmap(e);return o.scale9Grid=new egret.Rectangle(n[0],n[1],n[2],n[3]),null!=i&&(o.width=i[10],o.height=i[11]),o},t.prototype.createShapeImage=function(e,t){void 0===t&&(t=null);var i=this._assetManager.createBitmap(e);return i.fillMode=egret.BitmapFillMode.REPEAT,null!=t&&(i.width=t[10],i.height=t[11]),i},t.prototype.createTextField=function(e,t){void 0===t&&(t=null);var i=new egret.TextField;return null!=t&&(i.width=t[10],i.height=t[11],i.textColor=t[13],i.size=t[14],i.textAlign=t[15],i.text=t[18]),i},t.prototype.hasSprite=function(e){return null!=this._swfData[t.dataKey_Sprite][e]},t.prototype.hasMovieClip=function(e){return null!=this._swfData[t.dataKey_MovieClip][e]},t.prototype.hasImage=function(e){return null!=this._swfData[t.dataKey_Image][e]},t.prototype.hasS9Image=function(e){return null!=this._swfData[t.dataKey_Scale9][e]},t.prototype.hasShapeImage=function(e){return null!=this._swfData[t.dataKey_ShapeImg][e]},t.dataKey_Sprite="spr",t.dataKey_Image="img",t.dataKey_MovieClip="mc",t.dataKey_TextField="text",t.dataKey_Button="btn",t.dataKey_Scale9="s9",t.dataKey_ShapeImg="shapeImg",t.dataKey_Component="comp",t.dataKey_Particle="particle",t}();e.Swf=t,__reflect(t.prototype,"starlingswf.Swf")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){this._sheets={},this._textures={}}return e.prototype.addSpriteSheet=function(e,t){this._sheets[e]=t},e.prototype.addTexture=function(e,t){this._textures[e]=t},e.prototype.createBitmap=function(e){var t=this.getTexture(e);if(null==t)return null;var i=new egret.Bitmap;return i.texture=t,i},e.prototype.getTexture=function(e){var t,i,n;for(n in this._sheets)if(i=this._sheets[n],t=i.getTexture(e),null!=t)break;return null==t&&(t=this._textures[e]),t},e}();e.SwfAssetManager=t,__reflect(t.prototype,"starlingswf.SwfAssetManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){}return e.createSwfUpdateManager=function(t){var i=new e;return i._animations=[],i._addQueue=[],i._removeQueue=[],i._currentTime=0,i.setFps(t),App.TimerManager.doFrame(1,0,i.update,i),i},e.prototype.clear=function(){this._addQueue.splice(0),this._removeQueue.splice(0),this._animations.splice(0)},e.prototype.stop=function(){this.clear(),App.TimerManager.remove(this.update,this)},e.prototype.play=function(){App.TimerManager.doFrame(1,0,this.update,this)},e.prototype.setFps=function(e){this._fps=e,this._fpsTime=1e3/e},e.prototype.addSwfAnimation=function(e){this._addQueue.push(e)},e.prototype.removeSwfAnimation=function(e){this._removeQueue.push(e);var t=this._addQueue.indexOf(e);-1!=t&&this._addQueue.splice(t,1)},e.prototype.updateAdd=function(){for(var e,t,i=this._addQueue.length,n=0;i>n;n++)t=this._addQueue.pop(),e=this._animations.indexOf(t),-1==e&&this._animations.push(t)},e.prototype.updateRemove=function(){for(var e,t,i=this._removeQueue.length,n=0;i>n;n++)t=this._removeQueue.pop(),e=this._animations.indexOf(t),-1!=e&&this._animations.splice(e,1)},e.prototype.update=function(e){if(this._currentTime+=e,!(this._currentTime<this._fpsTime)){this._currentTime-=this._fpsTime,this._update();for(var t=0;this._currentTime>this._fpsTime;)this._currentTime-=this._fpsTime,t++,4>t&&this._update()}},e.prototype._update=function(){this.updateRemove(),this.updateAdd();for(var e=this._animations.length,t=0;e>t;t++)this._animations[t].update()},e}();e.SwfUpdateManager=t,__reflect(t.prototype,"starlingswf.SwfUpdateManager")}(starlingswf||(starlingswf={}));var UpdateBeat=function(){function e(){}return e.Add=function(e,t){App.StageUtils.getStage().addEventListener(egret.Event.ENTER_FRAME,e,t)},e.Remove=function(e,t){App.StageUtils.getStage().removeEventListener(egret.Event.ENTER_FRAME,e,t)},e.Once=function(e,t){App.StageUtils.getStage().once(egret.Event.ENTER_FRAME,e,t)},e}();__reflect(UpdateBeat.prototype,"UpdateBeat");var MainController=function(e){function t(){var t=e.call(this)||this;return t._popUpQueue=[],t._closeConversationComponentTimer=void 0,t._fadingOutBuildings={},t._inReleaseState=!1,t.onRegister(),t.initParams(),t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.initParams=function(){xyd.stageWidth=StageUtils.getInstance().getWidth(),xyd.stageHeight=StageUtils.getInstance().getHeight(),SelfInfo.get().syncSoundSetting()},t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.registerEvent(xyd.event.OPEN_STAGE_WIN,this.onOpenStage,this),this.registerEvent(xyd.event.GAME_END,this.onGameEnd,this),this.registerEvent(xyd.event.GAME_START,this.onGameStart,this)},t.prototype.onOpenStage=function(){xyd.WindowManager.get().openWindow("stage_window")},t.prototype.onGameStart=function(){var e=this;if(this._game){var t={callback:function(){e._onBackBtn()}};SelfInfo.get().getCurrentLevel()<=SelfInfo.get().getEnterHomeMapLevel()&&!SelfInfo.get().isInMission&&(t={}),platform.callMethod("H5_RETURN_STAGE",t)["catch"](function(e){logger.error(e)})}},t.prototype._onBackBtn=function(){if(this._game&&this._game.getEngine()){var e=this._game.getEngine();xyd.WindowManager.get().closeAllWindows(["game_window"]),e.exitGame(GameEndReason.BackBtnPressed)}},t.prototype.onPreGame=function(e){logger.logStep("E:start-"+e);
var t=[xyd.loadJsonForLevel(e),RES.loadGroup("game_eff")];Promise.all(t).then(function(t){var i=t[0];return i?void xyd.WindowManager.get().openWindow("pre_game_window",{totalLevel:e}):void logger.error("load leveldata fail")})},t.prototype.releaseMatchRes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return EffectFactory.get().cleanUp(),[4,RES.destroyRes("game")];case 1:return e.sent(),[4,RES.destroyRes("game_later")];case 2:return e.sent(),[4,RES.destroyRes("game_web")];case 3:return e.sent(),[4,RES.destroyRes("game_eff")];case 4:return e.sent(),[4,RES.destroyRes("pre_eff")];case 5:return e.sent(),[2]}})})},t.prototype.releaseMapRes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return EffectFactory.get().cleanUp(),[4,RES.destroyRes("stage")];case 1:return e.sent(),[2]}})})},t.prototype.releaseBasicRes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return EffectFactory.get().cleanUp(),[4,RES.destroyRes("common")];case 1:return e.sent(),[4,RES.destroyRes("common_web")];case 2:return e.sent(),[4,RES.destroyRes("stage")];case 3:return e.sent(),[4,RES.destroyRes("num")];case 4:return e.sent(),[4,RES.destroyRes("nocompress")];case 5:return e.sent(),[2]}})})},t.prototype.h5GoToMap=function(e){t.get().clearGame(),xyd.WindowManager.get().openWindow("stage_window"),platform.callMethod("GOTO_MAP_SUCCESS",{status:xyd.MainStageType.StageMap})},t.prototype.onGameEnd=function(e){var i=this;if(platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)}),xyd.WindowManager.get().closeWindow("exit_comfirm_window"),SoundManager.getInstance().unloadAllEffectSound(),SelfInfo.get().isInMission)return void this._onMissionEnd(e.data);var n=e.data,o=e.data.report;if(o.end_reason!=GameEndReason.Victory&&SelfInfo.get().setClearStreak(0),SelfInfo.get().checkSkipPreWindow()){xyd.WindowManager.get().closeWindow("game_window");var a=SelfInfo.get().getCurrentLevel(),s=-1,r=-1;if(10>=a)s=1,r=a;else if(20>=a)s=2,r=a-10;else{var l=a-5;s=Math.floor(l/15)+2,l%=15,0==l?(s--,r=15):r=l}return platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!0,chapter:s,level:r,total_level:a}).then(function(e){if(e.success){var n=[xyd.loadJsonForLevel(a),RES.loadGroup("game")];Promise.all(n).then(function(n){var o=n[0];if(!o)return void logger.error("load leveldata fail");void 0!=i._game&&(i._game.dispose(),i._game=void 0),SoundManager.getInstance().playBg("bgm_level_mp3");var s=new GameConf;s.init(a);var r=s.scoreTargets[0];i._game=t.get().initGameFromConf(s),i._game.setScoreTarget(r),e.funds&&i._game.setFundActivity(e.funds.init_count,e.funds.drop_count),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START))})}else t.get().clearGame(),t.get().releaseMatchRes().then(function(){xyd.WindowManager.get().openWindow("stage_window")})})["catch"](function(e){logger.error(e)}),void SelfInfo.get().setSkipPreWindow(!1)}var _=o.end_reason==GameEndReason.BackBtnPressed&&ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)&&SelfInfo.get().getCurrentLevel()<=SelfInfo.get().getEnterHomeMapLevel();if(!SelfInfo.get().isInMission)if(_||o.end_reason!=GameEndReason.Victory&&o.end_reason!=GameEndReason.BackBtnPressed&&(o.end_reason!=GameEndReason.PlayerQuit||0!=o.moves_used)){n.retry=1;var h=n;xyd.WindowManager.get().closeWindow("pre_game_window"),platform.callMethod("GAME_PRE_RETRY",h).then(function(e){if(e&&e.can_get_bonus){SelfInfo.get().updateItems(e);var t=[];if(e.items)for(var i in e.items)t.push(Number(i));h.bonus_items=t}}).then(function(){xyd.isApp&&ABTest.get().getSetting(ABTest.is_ITEMS_GUIDE)?i._needItemSupply(h):xyd.WindowManager.get().openWindow("pre_game_window",h)})["catch"](function(e){xyd.WindowManager.get().openWindow("pre_game_window",h)})}else{o.is_first_win&&(n.is_first_win=!0),platform.callMethod("H5_RETURN_STAGE",{})["catch"](function(e){logger.error(e)});var c=!0;ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)&&(c=!1),n.total_level<SelfInfo.get().getEnterHomeMapLevel()?c=!0:ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)||n.is_first_win&&n.total_level==SelfInfo.get().getEnterHomeMapLevel()&&(c=!1);var d=!1;n.win&&SelfInfo.get().getCurrentLevel()<=xyd.MAX_STAGE&&c?SelfInfo.get().getCurrentLevel()>=xyd.MAX_STAGE?d=!0:this._doPopUps(n):d=!0,d&&this.goToMap(n)}},t.prototype._onMissionEnd=function(e){var t=e.report;e.win||t.end_reason==GameEndReason.Victory?platform.callMethod("H5_RETURN_STAGE",{})["catch"](function(e){logger.error(e)}):t.end_reason==GameEndReason.BackBtnPressed||t.end_reason==GameEndReason.PlayerQuit&&0==t.moves_used?(platform.callMethod("H5_RETURN_STAGE",{})["catch"](function(e){logger.error(e)}),this.clearGame(),this.h5GoToMap(xyd.MainStageType.SevernMap)):t.end_reason==GameEndReason.PlayerQuit&&t.moves_used>0&&platform.callMethod("SHOW_PRE_MISSION_WINDOW",{mission_info:{mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel},retry:!0}),SelfInfo.get().clearMissionInfo()},t.prototype.goToMap=function(e){this.clearGame(),platform.callMethod("GOTO_MAP_SUCCESS",{status:xyd.MainStageType.StageMap}),platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.HomeMap})["catch"](function(e){logger.error(e)}),xyd.WindowManager.get().openWindow("stage_window",e);var t=e&&ABTest.get().getSetting(ABTest.NEWUSER_STAGE_CASH_REWARD)&&1==e.total_level&&SelfInfo.get().isFirstWin(),i=e&&SelfInfo.get().isFirstTenLevel(e.total_level)&&SelfInfo.get().isFirstWin();(t||i)&&platform.callMethod("NEWUSER_STAGE_CASH_REWARD",{})},t.prototype._checkClearStreakReward=function(){var e=this,t=function(){e._doNextPopUp()};xyd.WindowManager.get().openWindow("clear_streak_reward_window",{onComplete:t})},t.prototype._checkClearStreakGuide=function(){var e=this,t=function(){e._doNextPopUp()};xyd.WindowManager.get().openWindow("clear_streak_window",{onComplete:t})},t.prototype._checkGatherTaskWin=function(){var e=this,t=function(){e._doNextPopUp()};xyd.WindowManager.get().openWindow("red_packet_window",{onComplete:t})},t.prototype._checkPddPopups=function(){var e=this,t=function(){e._doNextPopUp()};platform.callMethod("GAME_SHOW_MAP_POPUPS",this._popUpParams).then(t)["catch"](t)},t.prototype._checkMonthCardLevelUp=function(){var e=this,t=function(){e._doNextPopUp()};if(void 0==SelfInfo.get().lastMonthlyCardLevel||void 0==SelfInfo.get().monthlyCardLevel)return void t();if(SelfInfo.get().lastMonthlyCardLevel<SelfInfo.get().monthlyCardLevel){var i=SelfInfo.get().lastMonthlyCardLevel,n=SelfInfo.get().monthlyCardLevel;SelfInfo.get().lastMonthlyCardLevel=SelfInfo.get().monthlyCardLevel,xyd.WindowManager.get().openWindow("month_card_level_up_window",{old_level:i,new_level:n,onComplete:t})}else t()},t.prototype._checkMonthCardGuide=function(){var e=this,t=function(){e._doNextPopUp()};xyd.WindowManager.get().openWindow("month_card_window",{has_guide:!0,guide_step:-1,onComplete:t})},t.prototype._checkRewardCash=function(){var e=this,t=function(){e._doNextPopUp()};platform.callMethod("NEWUSER_STAGE_CASH_REWARD",{}).then(function(){t()})["catch"](function(){t()})},t.prototype._checkLuckyWheelSpin=function(){},t.prototype._checkOpenNextLevel=function(){var e=this._popUpParams.total_level+1;xyd.loadJsonForLevel(e).then(function(t){return t?void xyd.WindowManager.get().openWindow("pre_game_window",{totalLevel:e,callBack:function(){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.SHOW_AND_ENABLE_TOUCH,!1,{})}}):void logger.error("load leveldata fail")})["catch"](function(e){logger.error("load leveldata fail")})},t.prototype._doNextPopUp=function(){if(this._popUpQueue&&this._popUpQueue.length>0){var e=this._popUpQueue.shift();e()}},t.prototype._doPopUps=function(e){this._popUpParams=e,this._popUpQueue=[],e&&e.win&&SelfInfo.get().isFirstTenLevel(e.total_level)&&SelfInfo.get().isFirstWin()&&(SelfInfo.get().showLuckyWheel=!1,this._popUpQueue.push(this._checkRewardCash.bind(this))),e&&e.win&&SelfInfo.get().showLuckyWheel&&(SelfInfo.get().showLuckyWheel=!1,this._popUpQueue.push(this._checkLuckyWheelSpin.bind(this))),e&&e.win&&this._popUpQueue.push(this._checkPddPopups.bind(this)),e&&e.win&&1==SelfInfo.get().getClearStreak()&&SelfInfo.get().isFirstStreak&&this._popUpQueue.push(this._checkClearStreakReward.bind(this)),e&&e.win&&1==SelfInfo.get().getClearStreak()&&SelfInfo.get().isFirstStreak&&this._popUpQueue.push(this._checkClearStreakGuide.bind(this)),e&&e.win&&SelfInfo.get().shouldOpenGatherTaskWin&&SelfInfo.get().getShareInfoWithKey("collect_mission_packet")&&this._popUpQueue.push(this._checkGatherTaskWin.bind(this)),e&&e.win&&e.total_level+1<xyd.MAX_STAGE&&this._popUpQueue.push(this._checkOpenNextLevel.bind(this)),this._doNextPopUp()},t.prototype.initGameFromConf=function(e){return void 0!=this._game&&(this._game.dispose(),this._game=void 0),this._game=new Game(App.StageUtils.getStage(),e),this._game},t.prototype.newUserEntered=function(){ABTest.get().getSetting(ABTest.CAN_ENTER_HOME_MAP)?(platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.HomeMap})["catch"](function(e){logger.error(e)}),this.initGameForNewUser(SelfInfo.get().getCurrentLevel())):(platform.callMethod("TOGGLE_TO_HOME_OR_STAGE",{status:xyd.MainStageType.StageMap})["catch"](function(e){logger.error(e)}),this.initGameForNewUser(SelfInfo.get().getCurrentLevel()))},t.prototype.initGameForNewUser=function(e){var t=this;SelfInfo.get().clearMissionInfo();var i=-1,n=-1;if(10>=e)i=1,n=e;else if(20>=e)i=2,n=e-10;else{var o=e-5;i=Math.floor(o/15)+2,o%=15,0==o?(i--,n=15):n=o}var a=platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!0,chapter:i,level:n,total_level:e}),s=xyd.loadJsonForLevel(e),r=[a,s];Promise.all(r).then(function(i){var n=i[0],o=i[1];if(!o)return logger.error("load leveldata fail"),void xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN));if(n&&n.success){void 0!=t._game&&(t._game.dispose(),t._game=void 0);var a=new GameConf;a.init(e),t._game=new Game(App.StageUtils.getStage(),a),t._game.setScoreTarget(a.scoreTargets[0]),n.funds&&t._game.setFundActivity(n.funds.init_count,n.funds.drop_count),SoundManager.getInstance().playBg("bgm_level_mp3"),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START))}else xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.OPEN_STAGE_WIN))})["catch"](function(e){return logger.error(e)})},t.prototype.isInGame=function(){return void 0==this._game?!1:!0},t.prototype.inWinState=function(){if(void 0==this._game)return!1;var e=this._game.getEngine().getState();return e==EngineState.STATE_WIN||e==EngineState.STATE_WIN_WINDOW},Object.defineProperty(t.prototype,"lastStageY",{get:function(){return this._lastStageY},set:function(e){this._lastStageY=e},enumerable:!0,configurable:!0}),t.prototype.clearGame=function(){this._game&&(this._game.dispose(),this._game=void 0)},t.prototype._saveItemSupply=function(e,t){var i={};i.times=e,i.startTime=t,platform.callMethod("SET_STORAGE",{itemSupply:i})},t.prototype._getStartTime=function(e){var t=new Date(1e3*e);t.setHours(0),t.setMinutes(0),t.setSeconds(0);var i=Math.ceil(t.getTime()/1e3);return i},t.prototype._needItemSupply=function(e){var t=this;platform.callMethod("GET_STORAGE",{key:"itemSupply"}).then(function(i){var n=i,o=0,a=0;n&&void 0!=n.startTime&&(a=n.startTime),n&&void 0!=n.times&&(o=n.times);var s=SelfInfo.get().getTime();s>a+86400&&(a=t._getStartTime(s),o=0);var r=Math.random()>.5;r&&5>o?(o+=1,xyd.WindowManager.get().openWindow("item_supply_window",e)):xyd.WindowManager.get().openWindow("pre_game_window",e),t._saveItemSupply(o,a)})["catch"](function(e){return logger.error(e)})},t.prototype.getGame=function(){return this._game},Object.defineProperty(t.prototype,"inReleaseState",{get:function(){return this._inReleaseState},set:function(e){this._inReleaseState=e},enumerable:!0,configurable:!0}),t.INSTANCE=null,t}(BaseController);__reflect(MainController.prototype,"MainController");var StarlingSwfFactory=function(e){function t(){var t=e.call(this)||this;return t.swfAssetsManager=new starlingswf.SwfAssetManager,t.swfAssetsNames=new Array,t.swfAssets=new Array,t.swfData={},t}return __extends(t,e),t.prototype.addSwf=function(e,t,i){if(-1==this.swfAssetsNames.indexOf(e)){if(null==t||null==i)return void console.log("SWF加载失败:"+e);this.swfAssetsManager.addSpriteSheet(e,i);var n=new starlingswf.Swf(t,this.swfAssetsManager,24);n.name=e,StarlingSwfUtils.addSwf(n),this.swfAssetsNames.push(e),this.swfAssets.push(n)}},t.prototype.stopSwfs=function(e){for(var t=0,i=e.length;i>t;t++){var n=StarlingSwfUtils.getSwf(e[t]);n&&n.swfUpdateManager.stop()}},t.prototype.playSwfs=function(e){for(var t=0,i=e.length;i>t;t++){var n=StarlingSwfUtils.getSwf(e[t]);n&&n.swfUpdateManager.play()}},t.prototype.clearSwfs=function(){for(;this.swfAssets.length;)StarlingSwfUtils.removeSwf(this.swfAssets.pop());for(;this.swfAssetsNames.length;)this.swfAssetsNames.pop();this.swfAssetsManager=new starlingswf.SwfAssetManager},t.prototype.clear=function(){this.clearSwfs()},t.prototype.makeMc=function(e){var t=StarlingSwfUtils.createMovie("mc_"+e,null,StarlingSwfMovieClip);return null==t&&console.log("SWF创建失败: "+e),t},t.prototype.makeImage=function(e){return StarlingSwfUtils.createImage("img_"+e)},t.prototype.getTexture=function(e){return StarlingSwfUtils.getTexture("img_"+e)},t}(BaseClass);__reflect(StarlingSwfFactory.prototype,"StarlingSwfFactory");var StarlingSwfMovieClip=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.frameActions={},a.preFrame=-1,a.addEventListener(egret.Event.REMOVED_FROM_STAGE,a.onRemove,a),a}return __extends(t,e),t.prototype.onRemove=function(){this.stop()},t.prototype.setFrameAction=function(e,t,i,n){void 0===n&&(n=null),this.frameActions[e]=[t,i,n]},t.prototype.setCompleteAction=function(e,t){this.complateFunc=e,this.complateObj=t,this.addEventListener(egret.Event.COMPLETE,this.onPlayend,this)},t.prototype.onPlayend=function(){this.complateFunc&&this.complateFunc.call(this.complateObj)},t.prototype.goToPlay=function(e){this.preFrame=-1,this.currFrameName=e,this.gotoAndPlay(e)},t.prototype.setCurrentFrame=function(t){e.prototype.setCurrentFrame.call(this,t);var i=this.getCurrentFrame();if(this.preFrame!=i&&(this.preFrame=i,this.frameActions&&this.frameActions[i])){var n=this.frameActions[i];n[2]?n[0].call(n[1],n[2]):n[0].call(n[1])}},t.prototype.dispose=function(){this.stop(),this.removeEventListener(egret.Event.COMPLETE,this.onPlayend,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),App.DisplayUtils.removeFromParent(this),this.complateFunc=null,this.complateObj=null,this.frameActions=null},t}(starlingswf.SwfMovieClip);__reflect(StarlingSwfMovieClip.prototype,"StarlingSwfMovieClip");var StarlingSwfUtils=function(){function e(){}return e.addSwf=function(t){e.swfList.push(t)},e.removeSwf=function(t){var i=e.swfList.indexOf(t);-1!=i&&e.swfList.splice(i,1)},e.createSprite=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);for(var o=e.swfList.length,a=0;o>a;a++){var s=e.swfList[a];if(s.hasSprite(t))return s.createSprite(t,i,n)}return null},e.createImage=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasImage(t))return a.createImage(t,i)}return null},e.getTexture=function(t){for(var i=e.swfList.length,n=0;i>n;n++){var o=e.swfList[n];if(o.hasImage(t))return o.getTexture(t)}return null},e.createMovie=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);for(var o=e.swfList.length,a=0;o>a;a++){var s=e.swfList[a];if(s.hasMovieClip(t))return s.createMovie(t,i,n)}return null},e.createS9Image=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasS9Image(t))return a.createS9Image(t,i)}return null},e.createShapeImage=function(t,i){void 0===i&&(i=null);for(var n=e.swfList.length,o=0;n>o;o++){var a=e.swfList[o];if(a.hasShapeImage(t))return a.createShapeImage(t,i)}return null},e.getSwf=function(t){for(var i=e.swfList.length,n=0;i>n;n++){var o=e.swfList[n];if(o.name==t)return o}return null},e.fixButton=function(t,i,n){e.firstAddBtn&&(e.firstAddBtn=!1,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.onTouchEnd,this));var o=new StarlingSwfButtonData;o.btn=t,o.onClick=i,o.thisObj=n,e.btnList.push(o),t.touchEnabled=!0,t.gotoAndStop(0),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnTouchBegin,t)},e.onBtnTouchBegin=function(t){for(var i=t.currentTarget,n=e.btnList.length,o=0;n>o;o++){var a=e.btnList[o];if(a.btn==i){a.touchStageX=t.stageX,a.touchStageY=t.stageY,i.gotoAndStop(1);break}}},e.onTouchEnd=function(t){for(var i=e.btnList.length,n=0;i>n;n++){var o=e.btnList[n];-1!=o.touchStageX&&(t.stageX&&Math.abs(o.touchStageX-t.stageX)<10&&Math.abs(o.touchStageY-t.stageY)<10&&o.onClick&&o.onClick.call(o.thisObj,t),o.touchStageX=-1,o.touchStageY=-1,o.btn.gotoAndStop(0))}},e.swfList=[],e.btnList=[],e.firstAddBtn=!0,e}();__reflect(StarlingSwfUtils.prototype,"StarlingSwfUtils");var StarlingSwfButtonData=function(){function e(){this.touchStageX=-1,this.touchStageY=-1}return e}();__reflect(StarlingSwfButtonData.prototype,"StarlingSwfButtonData");var Color=function(){function e(e,t,i,n){this.r=Mathf.Clamp(e,0,255),this.g=Mathf.Clamp(t,0,255),this.b=Mathf.Clamp(i,0,255),this.a=Mathf.Clamp(n,0,255)||255}return e.number2Color=function(t){var i=Math.floor(t/Mathf.Pow(16,4)),n=t-i*Mathf.Pow(16,4),o=Math.floor(n/Mathf.Pow(16,2)),a=n-o*Mathf.Pow(16,2);return new e(i,o,a)},Object.defineProperty(e.prototype,"R",{get:function(){return this.r/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"G",{get:function(){return this.g/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"B",{get:function(){return this.b/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"A",{get:function(){return this.a/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgb",{get:function(){return this.r*Mathf.Pow(16,4)+this.g*Mathf.Pow(16,2)+this.b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hexStr",{get:function(){var e=this.r.toString(16);e=1==e.length?"0"+e:e;var t=this.g.toString(16);t=1==t.length?"0"+t:t;var i=this.b.toString(16);return i=1==i.length?"0"+i:i,"0x"+e+t+i},enumerable:!0,configurable:!0}),e.gray=new e(178,178,178),e.grey=new e(215,215,215),e.deepGrey=new e(149,149,149),e.deepGreen=new e(30,178,11),e.yellow=new e(247,200,148),e.orange=new e(255,175,6),e.borderBrown=new e(144,123,75),e.bgBrown=new e(211,190,140),e.bgGrey=new e(28,28,28),e.deepBrown=new e(67,58,44),e.inputBrown=new e(86,80,61),e.black=new e(0,0,0),e.red=new e(255,0,0),e.green=new e(0,255,0),e.blue=new e(0,0,255),e.white=new e(255,255,255),e.Common=(_a={},_a[0]=e.number2Color(13619150),_a[1]=e.number2Color(2011659),_a[2]=e.number2Color(2648287),_a[3]=e.number2Color(10235816),_a[4]=e.number2Color(14905600),_a[5]=e.number2Color(15793920),_a),e.AllianceMarkChat=(_b={},_b[1]="0xf0ff00",_b[2]="0x9c2fa8",_b[3]="0x2868df",_b[4]="0xff4200",_b),e}();__reflect(Color.prototype,"Color");var _a,_b,App=function(){function e(){}return Object.defineProperty(e,"Http",{get:function(){return Http.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Socket",{get:function(){return Socket.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WindowManager",{get:function(){return xyd.WindowManager.get()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ViewManager",{get:function(){return ViewManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SceneManager",{get:function(){return SceneManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DebugUtils",{get:function(){return DebugUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MessageCenter",{get:function(){return MessageCenter.getInstance(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TimerManager",{get:function(){return TimerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DateUtils",{get:function(){return DateUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MathUtils",{get:function(){return MathUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RandomUtils",{get:function(){return RandomUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DisplayUtils",{get:function(){return DisplayUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BitmapNumber",{get:function(){return BitmapNumber.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GuideUtils",{get:function(){return GuideUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StageUtils",{get:function(){return StageUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StringUtils",{get:function(){return StringUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CommonUtils",{get:function(){return CommonUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoundManager",{get:function(){return SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DeviceUtils",{get:function(){return DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EgretExpandUtils",{get:function(){return EgretExpandUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"KeyboardUtils",{get:function(){return KeyboardUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RockerUtils",{get:function(){return RockerUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShockUtils",{get:function(){return ShockUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ResourceUtils",{get:function(){return ResourceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderTextureManager",{get:function(){return RenderTextureManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TextFlowMaker",{get:function(){return TextFlowMaker.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NotificationCenter",{get:function(){return null==e._notificationCenter&&(e._notificationCenter=new MessageCenter(1)),e._notificationCenter},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DelayOptManager",{get:function(){return DelayOptManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ArrayUtils",{get:function(){return ArrayUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EasyLoading",{get:function(){return EasyLoading.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DragonBonesFactory",{get:function(){return DragonBonesFactory.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StarlingSwfFactory",{get:function(){return StarlingSwfFactory.getInstance()},enumerable:!0,configurable:!0}),e.Init=function(){e.GlobalData=RES.getRes("global"),e.DebugUtils.isOpen(e.GlobalData.IsDebug),e.DebugUtils.setThreshold(5),e.EgretExpandUtils.init()},e.ProxyUserFlag="",e.GlobalData=null,e.ProtoFile=null,e.ProtoConfigReq=null,e.ProtoConfigRes=null,e}();__reflect(App.prototype,"App");var Rect=function(){function e(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}return e.prototype.Contains=function(e){return e.x<=this.x+this.width&&e.x>=this.x&&e.y<=this.y+this.height&&e.y>=this.y},e}();__reflect(Rect.prototype,"Rect");var SpriteRenderer=function(e){function t(){var t=e.call(this)||this;return t.sortingOrder_=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"sortingOrder",{set:function(e){this.sortingOrder_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{set:function(e){null==e?(this.sprite_=void 0,this.removeChildren()):(this.removeChildren(),this.sprite_=e,this.addChild(e))},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(SpriteRenderer.prototype,"SpriteRenderer");var sin=Math.sin,cos=Math.cos,acos=Math.acos,asin=Math.asin,sqrt=Math.sqrt,min=Math.min,max=Math.max,atan2=Math.atan2,clamp=Mathf.Clamp,abs=Math.abs,floor=Math.floor,Vector2=function(){function e(e,t){this.x=0,this.y=0,this.x=e||0,this.y=t||0}return e.New=function(t,i){return new e(t,i)},e.prototype.Set=function(e,t){this.x=e||0,this.y=t||0},e.prototype.Copy=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.Get=function(){return[this.x,this.y]},e.prototype.SqrMagnitude=function(){return this.x*this.x+this.y*this.y},e.prototype.Clone=function(){return e.New(this.x,this.y)},e.prototype.Normalize=function(){var e=this.Clone();return e.SetNormalize()},e.prototype.SetNormalize=function(){var e=this.Magnitude();return 1==e?this:(e>1e-5?this.Div(e):this.Set(0,0),this)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Angle=function(t,i){return 57.29578*acos(clamp(e.Dot(t.Normalize(),i.Normalize()),-1,1))},e.prototype.Magnitude=function(){return sqrt(this.x*this.x+this.y*this.y)},e.prototype.Div=function(e){return this.x=this.x/e,this.y=this.y/e,this},e.prototype.Mul=function(e){return this.x=this.x*e,this.y=this.y*e,this},e.prototype.Add=function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},e.prototype.Sub=function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},e.prototype.__tostring=function(){return"["+this.x+","+this.y+"]"},e.__div=function(t,i){return e.New(t.x/i,t.y/i)},e.__mul=function(t,i){return e.New(t.x*i,t.y*i)},e.__add=function(t,i){return e.New(t.x+i.x,t.y+i.y)},e.__sub=function(t,i){return e.New(t.x-i.x,t.y-i.y)},e.__unm=function(t){return e.New(-t.x,-t.y)},e.__eq=function(e,t){return e.x==t.x&&e.y==t.y},e.up=e.New(0,1),e.right=e.New(1,0),e.zero=e.New(0,0),e.one=e.New(1,1),e}();__reflect(Vector2.prototype,"Vector2");var rad2Deg=Mathf.deg(1),Vector3=function(){function e(e,t,i){this.x=0,this.y=0,this.z=0,this.x=e,this.y=t,this.z=i}return e.New=function(t,i,n){return new e(t,i,n)},e.prototype.Set=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},e.prototype.Get=function(){return[this.x,this.y,this.z]},e.prototype.Clone=function(){return new e(this.x,this.y,this.z)},e.prototype.Distance=function(e,t){return sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.prototype.Lerp=function(e,t,i){return i=clamp(i,0,1),e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i,e.z+(t.z-e.z)*i},e.prototype.Magnitude=function(){return sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.Max=function(t,i){return new e(max(t.x,i.x),max(t.y,i.y),max(t.z,i.z))},e.prototype.Min=function(t,i){return new e(min(t.x,i.x),min(t.y,i.y),min(t.z,i.z))},e.prototype.Normalize=function(){var t=[this.x,this.y,this.z],i=t[0],n=t[1],o=t[2],a=sqrt(i*i+n*n+o*o);return a>1e-5?new e(i/a,n/a,o/a):new e(0,0,0)},e.prototype.SetNormalize=function(){var e=sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e>1e-5?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):(this.x=0,this.y=0,this.z=0),this},e.prototype.SqrMagnitude=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.Angle=function(t,i){return acos(clamp(e.Dot(t.Normalize(),i.Normalize()),-1,1))*rad2Deg},e.prototype.ClampMagnitude=function(e){return this.SqrMagnitude()>e*e&&(this.SetNormalize(),this.Mul(e)),this},e.OrthoNormalize=function(e,t,i){return e.SetNormalize(),t.Sub(t.Project(e)),t.SetNormalize(),void 0==i?[e,t]:(i.Sub(i.Project(e)),i.Sub(i.Project(t)),i.SetNormalize(),[e,t,i])},e.Scale=function(t,i){var n=t.x*i.x,o=t.y*i.y,a=t.z*i.z;return new e(n,o,a)},e.Cross=function(t,i){var n=t.y*i.z-t.z*i.y,o=t.z*i.x-t.x*i.z,a=t.x*i.y-t.y*i.x;return new e(n,o,a)},e.prototype.Equals=function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},e.Project=function(t,i){var n=i.SqrMagnitude();if(1.175494e-38>n)return new e(0,0,0);var o=e.Dot(t,i),a=i.Clone();return a.Mul(o/n),a},e.prototype.Mul=function(e){return"number"==typeof e?(this.x=this.x*e,this.y=this.y*e,this.z=this.z*e):this.MulQuat(e),this},e.prototype.Div=function(e){return this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this},e.prototype.Add=function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},e.prototype.Sub=function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},e.prototype.MulQuat=function(e){var t=2*e.x,i=2*e.y,n=2*e.z,o=e.x*t,a=e.y*i,s=e.z*n,r=e.x*i,l=e.x*n,_=e.y*n,h=e.w*t,c=e.w*i,d=e.w*n,p=(1-(a+s))*this.x+(r-d)*this.y+(l+c)*this.z,u=(r+d)*this.x+(1-(o+s))*this.y+(_-h)*this.z,m=(l-c)*this.x+(_+h)*this.y+(1-(o+a))*this.z;return this.Set(p,u,m),this},e.AngleAroundAxis=function(t,i,n){t=t.Clone().Sub(e.Project(t,n)),i=i.Clone().Sub(e.Project(i,n));var o=e.Angle(t,i);return o*(e.Dot(n,e.Cross(t,i))<0&&-1||1)},e.prototype.tostring=function(){return"["+this.x+","+this.y+","+this.z+"]"},e.up=new e(0,1,0),e.down=new e(0,-1,0),e.right=new e(1,0,0),e.left=new e(-1,0,0),e.forward=new e(0,0,1),e.back=new e(0,0,-1),e.zero=new e(0,0,0),e.one=new e(1,1,1),e}();__reflect(Vector3.prototype,"Vector3");var AllAsyncExecutor=function(){function e(){this._functions=new Array,this._complateNum=0}return e.prototype.setCallBack=function(e,t){this._callBack=e,this._callBackTarget=t},e.prototype.regist=function(e,t){this._functions.push([e,t])},e.prototype.start=function(){App.ArrayUtils.forEach(this._functions,function(e){e[0].call(e[1])},this)},e.prototype.complate=function(){this._functions&&(this._complateNum++,this._complateNum==this._functions.length&&(this._callBack&&this._callBack.call(this._callBackTarget),this._callBack=null,this._callBackTarget=null,this._functions=null))},e}();__reflect(AllAsyncExecutor.prototype,"AllAsyncExecutor");var AnchorUtil=function(){function e(){}return e.init=function(){e._propertyChange=Object.create(null),e._anchorChange=Object.create(null),e.injectAnchor()},e.setAnchorX=function(e,t){e.anchorX=t},e.setAnchorY=function(e,t){e.anchorY=t},e.setAnchor=function(e,t){e.anchorX=e.anchorY=t},e.getAnchor=function(e){return e.anchorX!=e.anchorY&&console.log("target's anchorX != anchorY"),e.anchorX||0},e.getAnchorY=function(e){return e.anchorY||0},e.getAnchorX=function(e){return e.anchorX||0},e.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){var i=this;this.$setWidth(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){var i=this;this.$setHeight(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(t){var i=this;this._anchorX=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(t){var i=this;this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},e.changeAnchor=function(t){e._propertyChange[t.hashCode]&&e._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete e._propertyChange[t.hashCode])},e}();__reflect(AnchorUtil.prototype,"AnchorUtil");var ArrayUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.forEach=function(e,t,i){for(var n=0,o=e.length;o>n;n++)t.apply(i,[e[n]])
},t}(BaseClass);__reflect(ArrayUtils.prototype,"ArrayUtils");var AverageUtils=function(){function e(e){void 0===e&&(e=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=e}return e.prototype.push=function(e){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(e),this.numSum+=e,this.numsLen++},e.prototype.getValue=function(){return this.numSum/this.numsLen},e.prototype.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},e}();__reflect(AverageUtils.prototype,"AverageUtils");var CommonUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.addLableStrokeColor=function(e,t,i){e.strokeColor=t,e.stroke=i},t.copyDataHandler=function(e){var t;if(e instanceof Array)t=[];else{if(!(e instanceof Object))return e;t={}}for(var i=Object.keys(e),n=0,o=i.length;o>n;n++){var a=i[n];t[a]=this.copyDataHandler(e[a])}return t},t.lock=function(){App.StageUtils.getStage().touchEnabled=App.StageUtils.getStage().touchChildren=!1},t.unlock=function(){App.StageUtils.getStage().touchEnabled=App.StageUtils.getStage().touchChildren=!0},t.int64ToNumber=function(e){return parseInt(e.toString())},t.labelIsOverLenght=function(e,t){var i=null;i=1e5>t?t:1e6>t?Math.floor(t/1e3/10).toString()+"万":Math.floor(t/1e4).toString()+"万",e.text=i},t}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils");var DateUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.getFormatBySecond=function(e,t){void 0===t&&(t=1);var i="";switch(t){case 1:i=this.getFormatBySecond1(e);break;case 2:i=this.getFormatBySecond2(e);break;case 3:i=this.getFormatBySecond3(e);break;case 4:i=this.getFormatBySecond4(e);break;case 5:i=this.getFormatBySecond5(e);break;case 6:i=this.getFormatBySecond6(e)}return i},t.prototype.getFormatBySecond1=function(e){void 0===e&&(e=0);var t,i=Math.floor(e/3600);t=0==i?"00":10>i?"0"+i:""+i;var n,o,a=Math.floor((e-3600*i)/60),s=Math.floor((e-3600*i)%60);return n=0==a?"00":10>a?"0"+a:""+a,o=0==s?"00":10>s?"0"+s:""+s,t+":"+n+":"+o},t.prototype.getFormatBySecond3=function(e){void 0===e&&(e=0);var t,i,n=Math.floor(e/3600),o=Math.floor((e-3600*n)/60),a=Math.floor((e-3600*n)%60);return t=0==o?"00":10>o?"0"+o:""+o,i=0==a?"00":10>a?"0"+a:""+a,t+":"+i},t.prototype.getFormatBySecond2=function(e){var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),a=t.getHours(),s=t.getMinutes(),r=t.getSeconds();return i+"-"+n+"-"+o+" "+a+":"+s+":"+r},t.prototype.getFormatBySecond6=function(e){var t=new Date;t.setTime(1e3*e);var i,n,o,a=t.getMonth()+1,s=t.getDate(),r=t.getHours(),l=t.getMinutes(),_=t.getSeconds();return i=0==r?"00":10>r?"0"+r:r+"",i=0==r?"00":10>r?"0"+r:r+"",n=0==l?"00":10>l?"0"+l:l+"",o=0==_?"00":10>_?"0"+_:_+"",a+"/"+s+" "+i+":"+n+":"+o},t.prototype.getFormatBySecond4=function(e){var t=Math.floor(e/3600);return t>0?t>24?Math.floor(t/24)+"天前":t+"小时前":Math.floor(e/60)+"分钟前"},t.prototype.getFormatBySecond5=function(e){var t=86400,i=3600,n=60,o=Math.floor(e/t),a=Math.floor(e%t/i),s=Math.floor((e-a*i)/n),r=Math.floor((e-a*i)%n),l="",_="",h="",c="";return e>0?0==o?(l="",0==a?(_="",0==s?(h="",c=0==r?"":10>r?"0"+r+"秒":""+r+"秒"):(h=""+s+"分",c=0==r?"":10>r?"0"+r+"秒":""+r+"秒",h+c)):(_=a+"小时",0==s?(h="",c=0==r?"":10>r?"0"+r+"秒":""+r+"秒"):(h=10>s?"0"+s+"分":""+s+"分",_+h))):(l=o+"天",_=0==a?"":10>a?"0"+a+"小时":""+a+"小时",l+_):""},t}(BaseClass);__reflect(DateUtils.prototype,"DateUtils");var DebugUtils=function(e){function t(){var t=e.call(this)||this;return t._threshold=3,t._startTimes={},t}return __extends(t,e),t.prototype.isOpen=function(e){this._isOpen=e},Object.defineProperty(t.prototype,"isDebug",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),t.prototype.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},t.prototype.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold,t},t.prototype.setThreshold=function(e){this._threshold=e},t}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DelayOptManager=function(e){function t(){var t=e.call(this)||this;return t.TIME_THRESHOLD=2,t._delayOpts=[],App.TimerManager.doFrame(1,0,t.runCachedFun,t),t}return __extends(t,e),t.prototype.addDelayOptFunction=function(e,t,i,n,o){this._delayOpts.push({fun:t,funPara:i,thisObj:e,callBack:n,para:o})},t.prototype.clear=function(){this._delayOpts.length=0},t.prototype.stop=function(){App.TimerManager.remove(this.runCachedFun,this)},t.prototype.runCachedFun=function(e){if(0!=this._delayOpts.length)for(var t,i=egret.getTimer();this._delayOpts.length&&(t=this._delayOpts.shift(),t.funPara?t.fun.call(t.thisObj,t.funPara):t.fun.call(t.thisObj),t.callBack&&(void 0!=t.para?t.callBack.call(t.thisObj,t.para):t.callBack()),!(egret.getTimer()-i>this.TIME_THRESHOLD)););},t}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager");var DeviceUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsChromeBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSafariBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DisplayUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createBitmap=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.createEuiImage=function(e){var t=new eui.Image,i=RES.getRes(e);return t.source=i,t},t.prototype.removeFromParent=function(e){null!=e.parent&&e.parent.removeChild(e)},t}(BaseClass);__reflect(DisplayUtils.prototype,"DisplayUtils");var EgretExpandUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){AnchorUtil.init()},t}(BaseClass);__reflect(EgretExpandUtils.prototype,"EgretExpandUtils");var FrameDelay=function(){function e(){}return e.prototype.delayCall=function(e,t,i){this.func=t,this.thisObj=i,App.TimerManager.doFrame(e,1,this.listener_enterFrame,this)},e.prototype.listener_enterFrame=function(){this.func.call(this.thisObj)},e}();__reflect(FrameDelay.prototype,"FrameDelay");var FrameExecutor=function(){function e(e){this.delayFrame=e,this.frameDelay=new FrameDelay,this.functions=new Array}return e.prototype.regist=function(e,t){this.functions.push([e,t])},e.prototype.execute=function(){if(this.functions.length){var e=this.functions.shift();e[0].call(e[1]),this.frameDelay.delayCall(this.delayFrame,this.execute,this)}},e}();__reflect(FrameExecutor.prototype,"FrameExecutor");var KeyboardUtils=function(e){function t(){var t=e.call(this)||this;if(t.key_ups=new Array,t.key_downs=new Array,App.DeviceUtils.IsHtml5){var i=t;document.addEventListener("keyup",function(e){for(var t=0,n=i.key_ups.length;n>t;t++){var o=i.key_ups[t][0],a=i.key_ups[t][1];a?o.call(a,e.keyCode):o(e.keyCode)}}),document.addEventListener("keydown",function(e){for(var t=0,n=i.key_downs.length;n>t;t++){var o=i.key_downs[t][0],a=i.key_downs[t][1];a?o.call(a,e.keyCode):o(e.keyCode)}})}return t}return __extends(t,e),t.prototype.addKeyUp=function(e,t){this.key_ups.push([e,t])},t.prototype.addKeyDown=function(e,t){this.key_downs.push([e,t])},t.prototype.removeKeyUp=function(e,t){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==e&&this.key_ups[i][1]==t&&(this.key_ups.splice(i,1),i--)},t.prototype.removeKeyDown=function(e,t){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==e&&this.key_downs[i][1]==t&&(this.key_downs.splice(i,1),i--)},t}(BaseClass);__reflect(KeyboardUtils.prototype,"KeyboardUtils");var LocationProperty=function(){function e(){}return e.getPara=function(e,t){var i=t||location.href;if(-1!=i.indexOf("?")){var n="&"+i.split("?")[1],o=new RegExp("&"+e+"=.*?(?:&|$)"),a=o.exec(n);if(a){var s=a[0];return s.split("&")[1].split("=")[1]}}return null},e.setProperty=function(e,t,i){var n=i||location.href,o="&"+n.split("?")[1];if(-1==n.indexOf("?"))return n+="?"+e+"="+t;var o=n.split("?")[1];if(""==o)return n+=e+"="+t;var a=new RegExp("(?:^|&)"+e+"=.*?(?:&|$)"),s=a.exec(o);if(s&&""!=s[0]){var r=s[0],l=new RegExp("=.*$"),_=r.replace(l,"="+t);return n.replace(r,_)}return n+="&"+e+"="+t},e.hasProperty=function(e,t){var i=t||location.href,n="&"+i.split("?")[1];return-1!=n.indexOf("&"+e+"=")},e}();__reflect(LocationProperty.prototype,"LocationProperty");var Log=function(){function e(){}return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[DebugLog]"+e[0],console.log.apply(console,e))},e}();__reflect(Log.prototype,"Log");var MathUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getAngle=function(e){return 180*e/Math.PI},t.prototype.getRadian=function(e){return e/180*Math.PI},t.prototype.getRadian2=function(e,t,i,n){var o=i-e,a=n-t;return Math.atan2(a,o)},t.prototype.getDistance=function(e,t,i,n){var o=i-e,a=n-t,s=o*o+a*a;return Math.sqrt(s)},t}(BaseClass);__reflect(MathUtils.prototype,"MathUtils");var md5=function(){function e(){this.hexcase=0,this.b64pad=""}return e.prototype.hex_md5=function(e){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.b64_md5=function(e){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.any_md5=function(e,t){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(e)),t)},e.prototype.hex_hmac_md5=function(e,t){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.b64_hmac_md5=function(e,t){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.any_hmac_md5=function(e,t,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)),i)},e.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},e.prototype.rstr_md5=function(e){return this.binl2rstr(this.binl_md5(this.rstr2binl(e),8*e.length))},e.prototype.rstr_hmac_md5=function(e,t){var i=this.rstr2binl(e);i.length>16&&(i=this.binl_md5(i,8*e.length));for(var n=Array(16),o=Array(16),a=0;16>a;a++)n[a]=909522486^i[a],o[a]=1549556828^i[a];var s=this.binl_md5(n.concat(this.rstr2binl(t)),512+8*t.length);return this.binl2rstr(this.binl_md5(o.concat(s),640))},e.prototype.rstr2hex=function(e){try{this.hexcase}catch(t){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",o="",a=0;a<e.length;a++)i=e.charCodeAt(a),o+=n.charAt(i>>>4&15)+n.charAt(15&i);return o},e.prototype.rstr2b64=function(e){try{this.b64pad}catch(t){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",o=e.length,a=0;o>a;a+=3)for(var s=e.charCodeAt(a)<<16|(o>a+1?e.charCodeAt(a+1)<<8:0)|(o>a+2?e.charCodeAt(a+2):0),r=0;4>r;r++)n+=8*a+6*r>8*e.length?this.b64pad:i.charAt(s>>>6*(3-r)&63);return n},e.prototype.rstr2any=function(e,t){var i,n,o,a,s,r=t.length,l=Array(Math.ceil(e.length/2));for(i=0;i<l.length;i++)l[i]=e.charCodeAt(2*i)<<8|e.charCodeAt(2*i+1);var _=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),h=Array(_);for(n=0;_>n;n++){for(s=Array(),a=0,i=0;i<l.length;i++)a=(a<<16)+l[i],o=Math.floor(a/r),a-=o*r,(s.length>0||o>0)&&(s[s.length]=o);h[n]=a,l=s}var c="";for(i=h.length-1;i>=0;i--)c+=t.charAt(h[i]);return c},e.prototype.str2rstr_utf8=function(e){for(var t,i,n="",o=-1;++o<e.length;)t=e.charCodeAt(o),i=o+1<e.length?e.charCodeAt(o+1):0,t>=55296&&56319>=t&&i>=56320&&57343>=i&&(t=65536+((1023&t)<<10)+(1023&i),o++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n},e.prototype.str2rstr_utf16le=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i),e.charCodeAt(i)>>>8&255);return t},e.prototype.str2rstr_utf16be=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e.charCodeAt(i)>>>8&255,255&e.charCodeAt(i));return t},e.prototype.rstr2binl=function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t},e.prototype.binl2rstr=function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t},e.prototype.binl_md5=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var i=1732584193,n=-271733879,o=-1732584194,a=271733878,s=0;s<e.length;s+=16){var r=i,l=n,_=o,h=a;i=this.md5_ff(i,n,o,a,e[s+0],7,-680876936),a=this.md5_ff(a,i,n,o,e[s+1],12,-389564586),o=this.md5_ff(o,a,i,n,e[s+2],17,606105819),n=this.md5_ff(n,o,a,i,e[s+3],22,-1044525330),i=this.md5_ff(i,n,o,a,e[s+4],7,-176418897),a=this.md5_ff(a,i,n,o,e[s+5],12,1200080426),o=this.md5_ff(o,a,i,n,e[s+6],17,-1473231341),n=this.md5_ff(n,o,a,i,e[s+7],22,-45705983),i=this.md5_ff(i,n,o,a,e[s+8],7,1770035416),a=this.md5_ff(a,i,n,o,e[s+9],12,-1958414417),o=this.md5_ff(o,a,i,n,e[s+10],17,-42063),n=this.md5_ff(n,o,a,i,e[s+11],22,-1990404162),i=this.md5_ff(i,n,o,a,e[s+12],7,1804603682),a=this.md5_ff(a,i,n,o,e[s+13],12,-40341101),o=this.md5_ff(o,a,i,n,e[s+14],17,-1502002290),n=this.md5_ff(n,o,a,i,e[s+15],22,1236535329),i=this.md5_gg(i,n,o,a,e[s+1],5,-165796510),a=this.md5_gg(a,i,n,o,e[s+6],9,-1069501632),o=this.md5_gg(o,a,i,n,e[s+11],14,643717713),n=this.md5_gg(n,o,a,i,e[s+0],20,-373897302),i=this.md5_gg(i,n,o,a,e[s+5],5,-701558691),a=this.md5_gg(a,i,n,o,e[s+10],9,38016083),o=this.md5_gg(o,a,i,n,e[s+15],14,-660478335),n=this.md5_gg(n,o,a,i,e[s+4],20,-405537848),i=this.md5_gg(i,n,o,a,e[s+9],5,568446438),a=this.md5_gg(a,i,n,o,e[s+14],9,-1019803690),o=this.md5_gg(o,a,i,n,e[s+3],14,-187363961),n=this.md5_gg(n,o,a,i,e[s+8],20,1163531501),i=this.md5_gg(i,n,o,a,e[s+13],5,-1444681467),a=this.md5_gg(a,i,n,o,e[s+2],9,-51403784),o=this.md5_gg(o,a,i,n,e[s+7],14,1735328473),n=this.md5_gg(n,o,a,i,e[s+12],20,-1926607734),i=this.md5_hh(i,n,o,a,e[s+5],4,-378558),a=this.md5_hh(a,i,n,o,e[s+8],11,-2022574463),o=this.md5_hh(o,a,i,n,e[s+11],16,1839030562),n=this.md5_hh(n,o,a,i,e[s+14],23,-35309556),i=this.md5_hh(i,n,o,a,e[s+1],4,-1530992060),a=this.md5_hh(a,i,n,o,e[s+4],11,1272893353),o=this.md5_hh(o,a,i,n,e[s+7],16,-155497632),n=this.md5_hh(n,o,a,i,e[s+10],23,-1094730640),i=this.md5_hh(i,n,o,a,e[s+13],4,681279174),a=this.md5_hh(a,i,n,o,e[s+0],11,-358537222),o=this.md5_hh(o,a,i,n,e[s+3],16,-722521979),n=this.md5_hh(n,o,a,i,e[s+6],23,76029189),i=this.md5_hh(i,n,o,a,e[s+9],4,-640364487),a=this.md5_hh(a,i,n,o,e[s+12],11,-421815835),o=this.md5_hh(o,a,i,n,e[s+15],16,530742520),n=this.md5_hh(n,o,a,i,e[s+2],23,-995338651),i=this.md5_ii(i,n,o,a,e[s+0],6,-198630844),a=this.md5_ii(a,i,n,o,e[s+7],10,1126891415),o=this.md5_ii(o,a,i,n,e[s+14],15,-1416354905),n=this.md5_ii(n,o,a,i,e[s+5],21,-57434055),i=this.md5_ii(i,n,o,a,e[s+12],6,1700485571),a=this.md5_ii(a,i,n,o,e[s+3],10,-1894986606),o=this.md5_ii(o,a,i,n,e[s+10],15,-1051523),n=this.md5_ii(n,o,a,i,e[s+1],21,-2054922799),i=this.md5_ii(i,n,o,a,e[s+8],6,1873313359),a=this.md5_ii(a,i,n,o,e[s+15],10,-30611744),o=this.md5_ii(o,a,i,n,e[s+6],15,-1560198380),n=this.md5_ii(n,o,a,i,e[s+13],21,1309151649),i=this.md5_ii(i,n,o,a,e[s+4],6,-145523070),a=this.md5_ii(a,i,n,o,e[s+11],10,-1120210379),o=this.md5_ii(o,a,i,n,e[s+2],15,718787259),n=this.md5_ii(n,o,a,i,e[s+9],21,-343485551),i=this.safe_add(i,r),n=this.safe_add(n,l),o=this.safe_add(o,_),a=this.safe_add(a,h)}return[i,n,o,a]},e.prototype.md5_cmn=function(e,t,i,n,o,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(n,a)),o),i)},e.prototype.md5_ff=function(e,t,i,n,o,a,s){return this.md5_cmn(t&i|~t&n,e,t,o,a,s)},e.prototype.md5_gg=function(e,t,i,n,o,a,s){return this.md5_cmn(t&n|i&~n,e,t,o,a,s)},e.prototype.md5_hh=function(e,t,i,n,o,a,s){return this.md5_cmn(t^i^n,e,t,o,a,s)},e.prototype.md5_ii=function(e,t,i,n,o,a,s){return this.md5_cmn(i^(t|~n),e,t,o,a,s)},e.prototype.safe_add=function(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i},e.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t},e}();__reflect(md5.prototype,"md5");var MessageCenter=function(e){function t(t){var i=e.call(this)||this;return i.type=t,i.dict={},i.eVec=new Array,i.lastRunTime=0,0==i.type&&App.TimerManager.doFrame(1,0,i.run,i),i}return __extends(t,e),t.prototype.clear=function(){this.dict={},this.eVec.splice(0)},t.prototype.addListener=function(e,t,i){var n=this.dict[e];null==n&&(n=new Array,this.dict[e]=n);var o=0,a=n.length;for(o;a>o;o++)if(n[o][0]==t&&n[o][1]==i)return;n.push([t,i])},t.prototype.removeListener=function(e,t,i){var n=this.dict[e];if(null!=n){var o=0,a=n.length;for(o;a>o;o++)if(n[o][0]==t&&n[o][1]==i){n.splice(o,1);break}0==n.length&&(this.dict[e]=null,delete this.dict[e])}},t.prototype.removeAll=function(e){for(var t=Object.keys(this.dict),i=0,n=t.length;n>i;i++){for(var o=t[i],a=this.dict[o],s=0;s<a.length;s++)a[s][1]==e&&(a.splice(s,1),s--);0==a.length&&(this.dict[o]=null,delete this.dict[o])}},t.prototype.dispatch=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(null!=this.dict[e]){var n=ObjectPool.pop("MessageVo");n.type=e,n.param=t,0==this.type?this.eVec.push(n):1==this.type?this.dealMsg(n):Log.trace("MessageCenter未实现的类型")}},t.prototype.run=function(){var e=egret.getTimer(),t=e-this.lastRunTime>100;if(this.lastRunTime=e,t)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););},t.prototype.dealMsg=function(e){for(var t=this.dict[e.type],i=0,n=t.length,o=null;n>i;)o=t[i],o[0].apply(o[1],e.param),t.length!=n&&(n=t.length,i--),i++;e.dispose(),ObjectPool.push(e)},t}(BaseClass);__reflect(MessageCenter.prototype,"MessageCenter");var MessageVo=function(){function e(){}return e.prototype.dispose=function(){this.type=null,this.param=null},e}();__reflect(MessageVo.prototype,"MessageVo");var ObjectPool=function(){function e(){this._objs=new Array}return e.prototype.pushObj=function(e){this._objs.push(e)},e.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},e.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];e._content[t]||(e._content[t]=[]);var o=e._content[t];if(o.length)return o.pop();var a,s=egret.getDefinitionByName(t),r=i.length;return 0==r?a=new s:1==r?a=new s(i[0]):2==r?a=new s(i[0],i[1]):3==r?a=new s(i[0],i[1],i[2]):4==r?a=new s(i[0],i[1],i[2],i[3]):5==r&&(a=new s(i[0],i[1],i[2],i[3],i[4])),a.ObjectPoolKey=t,a},e.popWithExtraKey=function(t,i){e._content[t]||(e._content[t]=[]);var n,o=e._content[t];if(o.length)for(var a=0;a<o.length;a++)if(o[a].extraKey==i){n=o[a],o.splice(a,1);break}if(!n){var s=egret.getDefinitionByName(t);n=new s(i),n.extraKey=i,n.ObjectPoolKey=t}return n},e.push=function(t){if(null==t)return!1;var i=t.ObjectPoolKey;return e._content[i]?(e._content[i].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,i){void 0===i&&(i=null);for(var n=e._content[t];n&&n.length;){var o=n.pop();i&&o[i](),o=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,i){var n=e._content[t];if(null!=n){var o=0,a=n.length;for(o;a>o;o++)n[o][i]()}},e._content={},e}();__reflect(ObjectPool.prototype,"ObjectPool");var Percent=function(){function e(e,t){this.currentValue=e,this.totalValue=t}return e.prototype.computePercent=function(){return this.currentValue/this.totalValue*100},e.prototype.computeRate=function(){return this.currentValue/this.totalValue},e.prototype.reverse=function(){return this.currentValue=this.totalValue-this.currentValue,this},e.prototype.copy=function(){return new e(this.currentValue,this.totalValue)},e.prototype.computePercentReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue*100},e.prototype.computeRateReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue},e}();__reflect(Percent.prototype,"Percent");var QueueExecutor=function(){function e(){this._functions=new Array}return e.prototype.setCallBack=function(e,t){this._callBack=e,this._callBackTarget=t},e.prototype.regist=function(e,t){this._functions.push([e,t])},e.prototype.start=function(){this.next()},e.prototype.next=function(){if(this._functions)if(0==this._functions.length)this._callBack&&this._callBack.call(this._callBackTarget),this._callBack=null,this._callBackTarget=null,this._functions=null;else{var e=this._functions.shift();e[0].call(e[1])}},e}();__reflect(QueueExecutor.prototype,"QueueExecutor");var RandomUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.limit=function(e,t){e=Math.min(e,t),t=Math.max(e,t);var i=t-e;return e+Math.random()*i},t.prototype.limitInteger=function(e,t){return Math.round(this.limit(e,t))},t.prototype.randomArray=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},t}(BaseClass);__reflect(RandomUtils.prototype,"RandomUtils");var RenderTextureManager=function(e){function t(){var t=e.call(this)||this;return t._pool=[],t._useNum=0,t.isLowerQQBrowser()?t._maxNum=18:t._maxNum=-1,t}return __extends(t,e),t.prototype.isLowerQQBrowser=function(){if(App.DeviceUtils.IsQQBrowser){for(var e=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"],t=!1,i=0,n=e.length;n>i;i++)if(-1!=navigator.userAgent.indexOf(e[i])){t=!0;break}return t}return!1},t.prototype.pop=function(){var e=this._pool.pop();return e||(-1==this._maxNum||this._useNum<this._maxNum)&&(e=new egret.RenderTexture,this._useNum++),e},t.prototype.push=function(e){for(var t=!1,i=0,n=this._pool.length;n>i;i++)if(this._pool[i]==e){t=!0;break}t||this._pool.push(e)},t}(BaseClass);__reflect(RenderTextureManager.prototype,"RenderTextureManager");var ResourceUtils=function(e){function t(){var t=e.call(this)||this;return t._groupIndex=0,t._configs=new Array,t._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,t.onResourceLoadComplete,t),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,t.onResourceLoadProgress,t),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,t.onResourceLoadError,t),t}return __extends(t,e),t.prototype.addConfig=function(e,t){this._configs.push([e,t])},t.prototype.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},t.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},t.prototype.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},t.prototype.loadGroup=function(e,t,i,n){var o=[t,i,n];null!=this._groups[e]?this._groups[e].push(o):this._groups[e]=[o],"Load_WorldMap"==e?RES.loadGroup(e,100):RES.loadGroup(e)},t.prototype.loadGroups=function(e,t,i,n,o){RES.createGroup(e,t,!0),this.loadGroup(e,i,n,o)},t.prototype.pilfererLoadGroup=function(e,t){void 0===t&&(t=null);var i="pilferer_"+e;t||(t=[e]),RES.createGroup(i,t,!0),RES.loadGroup(i,-1)},t.prototype.onResourceLoadComplete=function(e){var t=e.groupName,i=this._groups[t];if(null!=i){for(var n=0;n<i.length;n++){var o=i[n][0],a=i[n][2];null!=o&&null!=a&&o.call(a,t)}this._groups[t]=null,delete this._groups[t]}},t.prototype.onResourceLoadProgress=function(e){var t=e.groupName,i=this._groups[t];if(null!=i)for(var n=0;n<i.length;n++){var o=i[n][1],a=i[n][2];null!=o&&null!=a&&o.call(a,e.itemsLoaded,e.itemsTotal,t)}},t.prototype.onResourceLoadError=function(e){Log.trace(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},t.prototype.loadResource=function(e,t,i,n,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null);var a=e.concat(t),s="loadGroup"+this._groupIndex++;RES.createGroup(s,a,!0);var r=[i,n,o];this._groups[s]=[r],RES.loadGroup(s)},t}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var RockerUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(e,t,i,n){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=t,this.moveFlagX=t.x,this.moveFlagY=t.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*e.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*e.width,this.moveFlagY-.5*e.height,e.width,e.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.dealKeyFunc=i,this.dealKeyTarget=n,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),App.KeyboardUtils.addKeyDown(this.onKeyDown,this),App.KeyboardUtils.addKeyUp(this.onKeyUp,this)},t.prototype.onKeyDown=function(e){switch(e){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},t.prototype.onKeyUp=function(e){switch(e){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},t.prototype.stopEvent=function(e){e.stopPropagation()},t.prototype.leaveStateEvent=function(e){e.stageX==this.mouseX&&e.stageY==this.mouseY&&this.stopMove()},t.prototype.startMove=function(e){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=e.stageX,this.mouseY=e.stageY},t.prototype.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},t.prototype.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},t.prototype.heroMoveEvent=function(e){this.runMove(e.stageX,e.stageY)},t.prototype.runMove=function(e,t){if(this.isMoveing&&(this.moveFlagCheckRec.contains(e,t)||!(Math.abs(this.mouseX-e)>50||Math.abs(this.mouseY-t)>50))){if(this.mouseX=e,this.mouseY=t,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var i=App.MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);this.moveFlagGoX=this.moveFlagX+Math.cos(i)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(i)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},t.prototype.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,App.TimerManager.doFrame(1,0,this.delKeys,this))},t.prototype.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(App.TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},t.prototype.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},t.prototype.stop=function(){this.stopCheckKey(),this.stopMove()},t}(BaseClass);__reflect(RockerUtils.prototype,"RockerUtils");var ShockUtils=function(e){function t(){var t=e.call(this)||this;return t.MAP=0,t.SPRITE=1,t.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],t.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],t._shockLength=0,t._shockCount=0,t._rx=0,t._ry=0,t._type=0,t._repeatCount=0,t}return __extends(t,e),t.prototype.destroy=function(){this.stop()},t.prototype.shock=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=null),void 0===i&&(i=3),this._target||(this._type=e,this._target=t,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(i))},t.prototype.start=function(e){void 0===e&&(e=1),this.repeatCount=e,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,App.TimerManager.doFrame(1,0,this.onShockEnter,this))},t.prototype.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,App.TimerManager.remove(this.onShockEnter,this)),this._target=null},t.prototype.onShockEnter=function(e){var t=this._shockLength*this._repeatCount;if(this._shockCount>=t)return void this.stop();var i=this._shockCount%this._shockLength,n=this._shockPoss[i];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+n.x),this._target.y=this._ry+n.y),this._shockCount++},Object.defineProperty(t.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(e){this._repeatCount=e},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(ShockUtils.prototype,"ShockUtils");var StageUtils=function(e){function t(){var i=e.call(this)||this;return null==t._uiStage&&(t._uiStage=new eui.UILayer,t._uiStage.percentHeight=100,t._uiStage.percentWidth=100,t._uiStage.touchEnabled=!1,i.getStage().addChild(t._uiStage)),i}return __extends(t,e),t.prototype.getHeight=function(){return this.getStage().stageHeight},t.prototype.getWidth=function(){return this.getStage().stageWidth},t.prototype.setTouchChildren=function(e){this.getStage().touchChildren=e},t.prototype.setMaxTouches=function(e){this.getStage().maxTouches=e},t.prototype.setFrameRate=function(e){this.getStage().frameRate=e},t.prototype.setScaleMode=function(e){this.getStage().scaleMode=e},t.prototype.getStage=function(){return egret.MainContext.instance.stage
},t.prototype.getUIStage=function(){return t._uiStage},t}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var StringBuffer=function(){function e(){this._strings=new Array}return e.prototype.append=function(e){this._strings.push(e)},e.prototype.toString=function(){return this._strings.join("")},e.prototype.clear=function(){this._strings.length=0},e}();__reflect(StringBuffer.prototype,"StringBuffer");var StringUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.trimSpace=function(e){return e.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.prototype.getStringLength=function(e){for(var t=e.split(""),i=0,n=0;n<t.length;n++){var o=t[n];i+=this.isChinese(o)?2:1}return i},t.prototype.isChinese=function(e){var t=/^.*[\u4E00-\u9FA5]+.*$/;return t.test(e)},t}(BaseClass);__reflect(StringUtils.prototype,"StringUtils");var TextFlowMaker=function(e){function t(){var t=e.call(this)||this;return t.STYLE_COLOR="C",t.STYLE_SIZE="S",t.PROP_TEXT="T",t}return __extends(t,e),t.prototype.generateTextFlow=function(e){for(var t=e.split("|"),i=[],n=0,o=t.length;o>n;n++)i.push(this.getSingleTextFlow(t[n]));return i},t.prototype.getSingleTextFlow=function(e){for(var t,i=e.split("&"),n={style:{}},o=0,a=i.length;a>o;o++)t=i[o].split(":"),t[0]==this.PROP_TEXT?n.text=t[1]:t[0]==this.STYLE_SIZE?n.style.size=parseInt(t[1]):t[0]==this.STYLE_COLOR?n.style.textColor=parseInt(t[1]):n.text=t[0];return n},t}(BaseClass);__reflect(TextFlowMaker.prototype,"TextFlowMaker");var TimerManager=function(e){function t(){var t=e.call(this)||this;return t._handlers=new Array,t._delHandlers=new Array,t._currTime=egret.getTimer(),t._currFrame=0,t._count=0,t._timeScale=1,egret.Ticker.getInstance().register(t.onEnterFrame,t),t}return __extends(t,e),t.prototype.setTimeScale=function(e){this._timeScale=e},t.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),App.DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],i=t.userFrame?this._currFrame:this._currTime;i>=t.exeTime&&(App.DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),App.DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}App.DebugUtils.stop("TimerManager:")},t.prototype.create=function(e,t,i,n,o,a,s){if(!(0>t||0>i||null==n)){this.remove(n,o);var r=ObjectPool.pop("TimerHandler");r.userFrame=e,r.repeat=0==i,r.repeatCount=i,r.delay=t,r.method=n,r.methodObj=o,r.complateMethod=a,r.complateMethodObj=s,r.exeTime=t+(e?this._currFrame:this._currTime),r.dealTime=this._currTime,this._handlers.push(r),this._count++}},t.prototype.doTimer=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!1,e,t,i,n,o,a)},t.prototype.doFrame=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!0,e,t,i,n,o,a)},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.remove=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t){this._handlers.splice(i,1),ObjectPool.push(n),this._count--;break}}},t.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var i=this._handlers[t];i.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(i),this._count--,t--)}},t.prototype.isExists=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t)return!0}return!1},t}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var AutoRemover=function(){function e(){this._toRemoveElements=[]}return e.prototype.add=function(e,t,i){this._toRemoveElements.push(new AutoRemoveElement(e,t,i))},e.prototype.update=function(e){for(var t=0;t<this._toRemoveElements.length;t++){var i=this._toRemoveElements[t];i.hasTriggered()||(i.update(),i.shouldRemove(e)&&i.triggerRemove())}for(var n=[],t=0;t<this._toRemoveElements.length;t++){var i=this._toRemoveElements[t];i.hasTriggered()||n.push(i)}this._toRemoveElements=n},e.prototype.willAutoRemove=function(){return this._toRemoveElements.length>0},e}();__reflect(AutoRemover.prototype,"AutoRemover");var AutoRemoveElement=function(){function e(e,t,i){this._element=e,this._removeDelay=t,this._removeWhenStable=i}return e.prototype.update=function(){this._removeDelay-=1},e.prototype.shouldRemove=function(e){return this._removeDelay<=0?this._removeWhenStable?e:!0:!1},e.prototype.triggerRemove=function(){if(!this._hasTriggered)if(this._hasTriggered=!0,this._element.type!=ElementTypeConstants.ROCKET)this._element.prepareForRemoval(0);else{var e=this._element;e.consumeSpecialPower()}},e.prototype.hasTriggered=function(){return this._hasTriggered},e}();__reflect(AutoRemoveElement.prototype,"AutoRemoveElement");var Engine=function(){function e(e,t,i,n,o,a){void 0===a&&(a=!1);var s=this;this._state=EngineState.STATE_INIT,this._lastState=void 0,this._isFreezed=!1,this._numFrames=0,this._onBoardSpecialElements=[],this._lastExplodeTimes=-1,this._lastExplodeFrames=-1,this._lastExplodeInitFinishFrams=-1,this._bounusTimeFrames=-1,this._lastExplodeFrequency=-1,this._shuffleFailed=!1,this._specicalExploadNumFrames=0,this._timeBombHasExploded=!1,this._lastExplodeBeginFrames=Math.floor(120*xyd.frameScale),this._lastExplodeWaitinFrames=5*xyd.frameScale,this._lastExplodeElements=[],this._isSkip=!1,this._forceSkip=!1,this._forceSkipFrames=Math.floor(1800*xyd.frameScale),this._isDisposed=!1,this._gameView=t,this._board=e,this._gameMode=i,this._gameConf=o,this._isDirectly=a,this._boardElementFactory=n,this._stabilityUpdater=new StabilityUpdater(this,e,this._gameConf,this._gameMode),this._board.setIsStabilityUpdating(function(){return s._stabilityUpdater.isUpdating()})}return e.prototype.update=function(e){var t=this;switch(this._state){case EngineState.STATE_INIT:xyd.WindowManager.get().openWindow("game_window",{view:this._gameView,board:this._board,engineCallback:function(){t.setState(EngineState.STATE_ENTER)},isDirectly:this._isDirectly});break;case EngineState.STATE_ENTER:this._numFrames--,this._numFrames<=0&&this.setState(EngineState.STATE_GAME);break;case EngineState.STATE_GAME:if(this._onRunGame(e),(this._gameMode.checkIfGameEnd()&&!this._stabilityUpdater.isUpdating()||this._timeBombHasExploded)&&(xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_PRE_END)),this._board.setLastExplodeState(!0),this._board.isStable()||this._timeBombHasExploded)){var i=this._gameMode.checkGameStatus();if(void 0==i)return;xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION)),this._timeBombHasExploded&&(i=GameEndReason.TimeBombExploded),this._gameMode.modeName()!=GameModeConstants.CLASSIC_MOVES||this._timeBombHasExploded?i==GameEndReason.Victory?this.setState(EngineState.STATE_SPECIAL_EXPLODE_INIT):this.setState(EngineState.STATE_PRE_END):this.setState(EngineState.STATE_SPECIAL_EXPLODE_INIT)}break;case EngineState.STATE_SHUFFLE:this._stabilityUpdater.update();break;case EngineState.STATE_END:if(platform.inTestMode()&&platform.inAutoMode()&&(xyd.AUTO_TEST_FAIL_TIMES=xyd.AUTO_TEST_FAIL_TIMES+1),platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)}),this._stabilityUpdater.update(),0==this._timeBombHasExploded){logger.logStep("E:lose");var n=this._gameMode.getGameEndInfo();xyd.AUTO_TEST_FAIL_TIMES>=xyd.AUTO_TEST_FAIL_MAX_TIMES&&(xyd.AUTO_TEST_LEVEL=xyd.AUTO_TEST_LEVEL+1,xyd.AUTO_TEST_FAIL_TIMES=0,n.total_level=n.total_level+1),this._shuffleFailed?n[GameEndInfo.END_REASON]=GameEndReason.NoPossibleMoves:this._timeBombHasExploded&&(n[GameEndInfo.END_REASON]=GameEndReason.TimeBombExploded),SelfInfo.get().isInMission&&(n.mission_info={mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel}),platform.callMethod("GAME_END",n).then(function(){SelfInfo.get().syncData()["catch"](function(e){logger.error(e)})})["catch"](function(e){return logger.error(e)}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_END,!1,{win:!1,score:0,star:0,total_level:n.total_level,report:n})}break;case EngineState.STATE_PRE_END:if(this._numFrames>0&&(this._numFrames-=1),this._board.checkPartialStable()){if(0==this._numFrames){this._numFrames-=1,SoundManager.getInstance().playEffect("se_lose_mp3"),SoundManager.getInstance().stopBg();var n=this._gameMode.getGameEndInfo();if(this._shuffleFailed?n[GameEndInfo.END_REASON]=GameEndReason.NoPossibleMoves:this._timeBombHasExploded&&(n[GameEndInfo.END_REASON]=GameEndReason.TimeBombExploded),SelfInfo.get().isInMission){var o=function(){t._addMoves(),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_RESUME)},a=function(){t.setState(EngineState.STATE_END),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_WITHDRAW)};n.game_resume_callback=o,n.game_end_callback=a,n.mission_info={mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel},platform.callMethod("GAME_PRE_END",n)["catch"](function(e){MainController.get().h5GoToMap(xyd.MainStageType.SevernMap)})}else{var s=function(){t.setState(EngineState.STATE_END),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_WITHDRAW)},r=function(){t._addMoves(),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_RESUME)};xyd.WindowManager.get().openWindow("end_game_window",{report:n,gameEndCallback:s,gameResumeCallback:r})}}}else this._onRunGame(e);break;case EngineState.STATE_SPECIAL_EXPLODE_INIT:if(this._numFrames-=1,this._numFrames==60*xyd.frameScale){this._onBoardSpecialElements=this._board.getSpecialElements();var l=this._gameMode.getMovesLeft();!this._timeBombHasExploded&&(l>0||this._onBoardSpecialElements.length>0)&&(xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BONUS_TIME)),SoundManager.getInstance().playEffect("se_bonus_time_mp3"))}0==this._numFrames&&(egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.SHOW_SKIP_BTN)),t._setForceSkip()},this,2e3),this.setState(EngineState.STATE_SPECIAL_EXPLODE));break;case EngineState.STATE_SPECIAL_EXPLODE:if(!this._checkForceSkip()){if(this._specicalExploadNumFrames++,this._board.isStable()&&!this._board.isCrayonActivated){var _=this._onBoardSpecialElements.length;0==_&&(this._onBoardSpecialElements=this._board.getSpecialElements(),_=this._onBoardSpecialElements.length),_>0?(this._board.addForRemoval(this._onBoardSpecialElements[_-1]),this._onBoardSpecialElements.splice(_-1)):this._numFrames-=1}if(this._onRunGame(e),0==this._numFrames){var i=this._gameMode.checkGameStatus();i==GameEndReason.Victory?(this.setState(EngineState.STATE_LAST_EXPLODE_INIT),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BONUS_TIME_START,!0,!1,{}))):this.setState(EngineState.STATE_PRE_END)}}break;case EngineState.STATE_LAST_EXPLODE_INIT:if(!this._checkForceSkip()){if(this._lastExplodeFrames+=1,(this._lastExplodeFrames-this._lastExplodeWaitinFrames)%this._lastExplodeFrequency==0){var h=this._lastExplodeTimes%2==0?!0:!1;this._changeElementTypeForLastExplode(h)}if(this._lastExplodeTimes>0){if(this._lastExplodeFrames%this._lastExplodeFrequency==0){var h=this._lastExplodeTimes%2==0?!0:!1,c=this._board.getRandomNormalElement();void 0!=c&&(this._lastExplodeElements.push(c),this._gameView.winEffect(c)),this._lastExplodeTimes-=1,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STEP,!0,!1,{step:this._lastExplodeTimes,lightoff:!0}))}}else this._lastExplodeInitFinishFrams++,10==this._lastExplodeInitFinishFrams&&this.setState(EngineState.STATE_LAST_EXPLODE)}break;case EngineState.STATE_LAST_EXPLODE:if(!this._checkForceSkip()){if(this._board.isStable()&&!this._board.isCrayonActivated){var _=this._onBoardSpecialElements.length;0==_&&(this._onBoardSpecialElements=this._board.getSpecialElements(),_=this._onBoardSpecialElements.length),_>0?(this._board.addForRemoval(this._onBoardSpecialElements[_-1]),this._onBoardSpecialElements.splice(_-1)):this._numFrames-=1}this._onRunGame(e),0==this._numFrames&&this.setState(EngineState.STATE_WIN_WINDOW)}break;case EngineState.STATE_WIN_WINDOW:if(this._board.checkPartialStable()){if(0==this._numFrames){this._numFrames-=1;var d=function(){t.setState(EngineState.STATE_WIN)};SoundManager.getInstance().playEffect("se_win_mp3"),SoundManager.getInstance().stopBg(),this._isSkip&&this._board.calculateSkipScore(),this._gameMode.saveScoreInfo(!0);var p=this._gameMode.getGameEndInfo();if(SelfInfo.get().getCurrentLevel()==p.total_level&&(p.is_first_win=!0),platform.callMethod("SAVE_GAME",{})["catch"](function(e){logger.error(e)}),SelfInfo.get().isInMission){p.mission_info={mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel},platform.callMethod("GAME_WIN",p).then(function(e){t.setState(EngineState.STATE_WIN)})["catch"](function(e){t.setState(EngineState.STATE_WIN)});break}SelfInfo.get().setStageInfo(p.total_level,p.stars,p.score,!0);var u=ABTest.get().getSetting(ABTest.NEWUSER_STAGE_CASH_REWARD)&&1==p.total_level&&SelfInfo.get().isFirstWin(),m=SelfInfo.get().isFirstTenLevel(p.total_level)&&SelfInfo.get().isFirstWin();u||m?platform.callMethod("GAME_WIN",p).then(function(e){SelfInfo.get().setGatherTaskInfo(e.gather_task),SelfInfo.get().syncData().then(function(){d()})["catch"](function(e){logger.error(e)}),e.show_privilege_guide&&(SelfInfo.get().showMonthCardGuide=!0),e.has_spin?SelfInfo.get().showLuckyWheel=!0:SelfInfo.get().showLuckyWheel=!1})["catch"](function(e){SelfInfo.get().syncData().then(function(){d()})["catch"](function(e){logger.error(e)})}):xyd.WindowManager.get().openWindow("win_game_window",{report:p,onConfirmCallback:d,shouldLogGuideLoss:!this._board.isRecovered()&&1==p.total_level})}}else this._onRunGame(e);break;case EngineState.STATE_WIN:xyd.AUTO_TEST_LEVEL=xyd.AUTO_TEST_LEVEL+1,xyd.AUTO_TEST_FAIL_TIMES=0,logger.logStep("E:win");var p=this._gameMode.getGameEndInfo();xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_END,!0,{win:!0,stars:p.stars,total_level:p.total_level,report:p})}},e.prototype._onRunGame=function(e){this._isFreezed||(this.updateBoard(),this._stabilityUpdater.update())},e.prototype.isBoardStable=function(){return this._board.isStable()},e.prototype.getBoard=function(){return this._board},e.prototype.setState=function(e){switch(this._lastState=this._state,this._state=e,e){case EngineState.STATE_ENTER:GuideHelper.hasGuideForLevel(this._gameConf.totalLevel)||this._board.isRecovered()?this._numFrames=0:this._numFrames=Math.floor(60*xyd.frameScale);break;case EngineState.STATE_GAME:this._board.setLastExplodeState(!1);break;case EngineState.STATE_END:this._numFrames=1;break;case EngineState.STATE_SHUFFLE:break;case EngineState.STATE_PRE_END:this._numFrames=Math.floor(20*xyd.frameScale),this._isSkip&&this._board.calculateSkipScore(),this._gameMode.saveScoreInfo();break;case EngineState.STATE_SPECIAL_EXPLODE_INIT:xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ANNA_HEAD_STATE,!1,!1,4)),this._numFrames=Math.floor(90*xyd.frameScale),this._onBoardSpecialElements=this._board.getSpecialElements();var t=this._gameMode.getMovesLeft();!this._timeBombHasExploded&&(t>0||this._onBoardSpecialElements.length>0)||(this._numFrames=Math.floor(5*xyd.frameScale));break;case EngineState.STATE_SPECIAL_EXPLODE:this._numFrames=Math.floor(20*xyd.frameScale);break;case EngineState.STATE_LAST_EXPLODE_INIT:var t=this._gameMode.getMovesLeft();if(0==t)return void this.setState(EngineState.STATE_WIN_WINDOW);this._lastExplodeTimes=Math.ceil(Math.pow(t,.85)),this._lastExplodeFrequency=Math.floor(5*xyd.frameScale),this._lastExplodeFrames=0;break;case EngineState.STATE_LAST_EXPLODE:this._numFrames=Math.floor(20*xyd.frameScale),this._onBoardSpecialElements=this._board.getSpecialElements();break;case EngineState.STATE_WIN_WINDOW:this._numFrames=0;break;case EngineState.STATE_WIN:}},e.prototype.updateBoard=function(){this._board.updateBoard(),this._gameView.update()},e.prototype._changeElementTypeForLastExplode=function(e){if(0!=this._lastExplodeElements.length){var t=this._lastExplodeElements[0];if(void 0!=t){var i=void 0;e?(t.type=ElementTypeConstants.BOMB_COL,i=new DPackCol(this._board,t)):(t.type=ElementTypeConstants.BOMB_ROW,i=new DPackRow(this._board,t)),t.destructionPack=i,t.setActiveInLastExplode(!0),this._board.replaceBoardElement(t);var n=this._gameView;n.logicToView(new egret.Point(t.col,t.row));this._board.addScore(ScoreConstants.SPEICAL_ELEMENT),this._lastExplodeElements.splice(0)}}},e.prototype._addMoves=function(){logger.logStep("E:add5"),this._gameMode.addExtraMoves(5),this.setState(EngineState.STATE_GAME)},e.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._gameView.dispose(),this._gameMode.dispose(),this._stabilityUpdater.dispose(),this._board.dispose(),xyd.WindowManager.get().closeWindow("game_window"))},e.prototype.skip=function(){if(this._isSkip=!0,this._state==EngineState.STATE_SPECIAL_EXPLODE){var e=this._gameMode.checkGameStatus();e==GameEndReason.Victory?this.setState(EngineState.STATE_WIN_WINDOW):this.setState(EngineState.STATE_PRE_END)}else(this._state==EngineState.STATE_SPECIAL_EXPLODE_INIT||this._state==EngineState.STATE_LAST_EXPLODE_INIT||this._state==EngineState.STATE_LAST_EXPLODE)&&this.setState(EngineState.STATE_WIN_WINDOW)},e.prototype.exitGame=function(e){void 0===e&&(e=GameEndReason.PlayerQuit),logger.logStep("E:quit"),this._state==EngineState.STATE_INIT&&logger.errorStr("Try to quit before game window created"),this._gameMode.saveScoreInfo(!1);var t=this._gameMode.getGameEndInfo();t[GameEndInfo.END_REASON]=e,SelfInfo.get().isInMission&&(t.mission_info={mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel}),platform.callMethod("GAME_END",t)["catch"](function(e){return logger.error(e)}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.GAME_END,!1,{win:!1,score:0,stars:0,total_level:t.total_level,report:t})},e.prototype.shuffleFailed=function(){this._shuffleFailed=!0,this._gameMode.saveScoreInfo(!1),this.setState(EngineState.STATE_PRE_END)},e.prototype.hasTimeBombExploded=function(){return this._timeBombHasExploded},e.prototype.setTimeBombHasExploded=function(e){this._timeBombHasExploded=e},e.prototype.isGameReachEnd=function(){return this._gameMode.checkIfGameEnd()},e.prototype.getGameMode=function(){return this._gameMode},e.prototype.getState=function(){return this._state},e.prototype.inGame=function(){return this._state==EngineState.STATE_GAME},e.prototype._setForceSkip=function(){this._forceSkip?this._forceSkipFrames=Math.floor(1800*xyd.frameScale):this._forceSkip=!0},e.prototype._checkForceSkip=function(){return this._forceSkip&&(this._forceSkipFrames--,this._forceSkipFrames<=0)?(this.skip(),!0):!1},e}();__reflect(Engine.prototype,"Engine");var EngineFactory=function(){function e(e,t){this._gameConf=e,this._stage=t}return e.prototype.create=function(e){void 0===e&&(e=!1);var t=new GameModeFactory,i=this._gameConf,n=i.totalLevel,o=t.create(i),a=new ScoreHandler(i.scoreTargets);o.setScoreHandler(a);var s=new RandomHandler(i.randomSeed);if(GuideHelper.hasGuideForLevel(n)){var r=GuideHelper.getRandomSeedForLevel(n);r>0&&(s=new RandomHandler(r))}var l=new BoardElementFactory(i,s),_=new BlockerFactory,h=new Board(this._gameConf,l,_),c=new SwapHandler(h);h.setScoreHandler(a);var d=new PortalHandler(h,i.portals);h.setPortalHander(d),h.setMatchHandler(new MatchHandler(h,l,a,c)),h.setFallingHandler(new FallingHandler(h,d)),h.setSwapHandler(c),h.setRandomHandler(s),h.setGameMode(o),l.setBoard(h),o.setBoard(h),o.setMovesLeft(i.moveLimit),o.saveModeInfo(i.chapterId,i.levelId,i.totalLevel,i.modeName),o.addModePlugins();var p=o.createGameView(h);return new Engine(h,p,o,l,i,e)},e}();__reflect(EngineFactory.prototype,"EngineFactory");var EngineState;!function(e){e[e.STATE_INIT=1]="STATE_INIT",e[e.STATE_ENTER=2]="STATE_ENTER",e[e.STATE_GAME=3]="STATE_GAME",e[e.STATE_END=4]="STATE_END",e[e.STATE_SHUFFLE=5]="STATE_SHUFFLE",e[e.STATE_WIN=6]="STATE_WIN",e[e.STATE_PRE_END=7]="STATE_PRE_END",e[e.STATE_SPECIAL_EXPLODE_INIT=8]="STATE_SPECIAL_EXPLODE_INIT",e[e.STATE_SPECIAL_EXPLODE=9]="STATE_SPECIAL_EXPLODE",e[e.STATE_LAST_EXPLODE_INIT=10]="STATE_LAST_EXPLODE_INIT",e[e.STATE_LAST_EXPLODE=11]="STATE_LAST_EXPLODE",e[e.STATE_WIN_WINDOW=12]="STATE_WIN_WINDOW"}(EngineState||(EngineState={}));var Game=function(e){function t(t,i){var n=e.call(this)||this;return n._activeItemList=[],n._isDisposed=!1,n._totalTicks=0,n._fpsTick=0,n._fpsTime=0,n._lastTime=0,n._lastFPS=0,n._avgFps=0,n._fpsWindow=[],n._fpsWindowSize=10,n._fpsIndex=0,n._fpsSum=0,n._lowFpsThreshold=50,n._lowFpsCountThreshold=4,n._lowFpsCount=0,n._stage=t,n._gameConf=i,n.registerEvent(xyd.event.GAME_START,n._start,n),n.registerEvent(xyd.event.GAME_END,n._stop,n),n.registerEvent(xyd.event.CLICK_SKIP_BTN,n._skip,n),n.registerEvent(xyd.event.CLICK_EXIT_BTN,n._exitGame,n),n}return __extends(t,e),t.prototype._test=function(){var e=egret.$hashCount;setInterval(function(){var t=egret.$hashCount,i=t-e;e=t,console.log(i)},1e3)},t.prototype.onRegister=function(){this._stage.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},t.prototype.setActiveItemList=function(e){this._activeItemList=e},t.prototype.setScoreTarget=function(e){this._scoreTarget=e},t.prototype.setSavedData=function(e){this._savedData=e},t.prototype._start=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,a;return __generator(this,function(s){switch(s.label){case 0:return console.log("start game"),[4,MainController.get().releaseMapRes()];case 1:return s.sent(),t=e.data,i=!1,t&&1==t.isDirectly&&(i=!0),SelfInfo.get().operationLog="",n=this._gameConf,this._savedData?platform.callMethod("GAME_RECOVER",{})["catch"](function(e){logger.error(e)}):platform.callMethod("GAME_BEGIN",{chapter:n.chapterId,level:n.levelId,total_level:n.totalLevel})["catch"](function(e){return logger.error(e)}),this._savedData&&(n.randomSeed=this._savedData.seed),o=new EngineFactory(n,this._stage),this._engine=o.create(i),a=this._engine.getBoard(),a.setScoreTarget(this._scoreTarget),this._savedData?(a.setSavedScore(this._savedData.saveScore),a.setMovesUsed(this._savedData.saveMovesUsed),a.setMovesLeft(this._savedData.saveMovesLeft),a.setScoreTarget(this._savedData.saveScoreTarget),a.setItemUsedCount(this._savedData.itemUsedCount),a.setSaveNextDropElementType(this._savedData.nextDropElementType),a.setTimeBomb(this._savedData.timeBomb),a.setSavedRocket(this._savedData.saveRocket),a.getGameMode().setSaveData(this._savedData.pluginData),a.setPregameItemManager(this._savedData.activeItemList||[],this._engine,!0),a.setSavedColorMixer(this._savedData.saveMixer),this._savedData.availableColors&&a.setSavedAvailableColors(this._savedData.availableColors),this._savedData.fundTotal&&(a.setSpecialDropHandler(this._savedData.fundOnBoard,this._savedData.fundTotal),a.getSpecialDropHandler().setCollectedEleNum(this._savedData.pluginData.special_drops||0))):(a.setPregameItemManager(this._activeItemList,this._engine,!1),this._fundInitCount&&this._fundTotalCount&&a.setSpecialDropHandler(this._fundInitCount,this._fundTotalCount)),this.onRegister(),this._resetFPS(),[2]}})})},t.prototype._stop=function(){this._resetFPS(),this._stage.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.reset()},t.prototype.getEngine=function(){return this._engine},t.prototype._skip=function(){this._engine.skip()},t.prototype._exitGame=function(){this._engine.exitGame()},t.prototype._onEnterFrame=function(){this._totalTicks+=1,this._updateFPS(),this._engine.update(this._totalTicks)},t.prototype._updateFPS=function(){if(!(xyd.frameRate<60)){var e=egret.getTimer();if(this._lastTime<=0)return void(this._lastTime=e);var t=e-this._lastTime;if(t>200)return void this._resetFPS();if(this._fpsTime+=t,this._lastTime=e,this._fpsTick++,this._fpsTime>1e3){if(this._lastFPS=Math.min(Math.ceil(1e3*this._fpsTick/this._fpsTime),xyd.frameRate),this._fpsWindow.length<this._fpsWindowSize)this._fpsWindow[this._fpsIndex]=this._lastFPS,this._fpsSum+=this._lastFPS,this._lastFPS<this._lowFpsThreshold&&this._lowFpsCount++;else{var i=this._fpsWindow[this._fpsIndex];this._fpsSum-=i,this._fpsSum+=this._lastFPS,this._fpsWindow[this._fpsIndex]=this._lastFPS,this._avgFps=this._fpsSum/this._fpsWindowSize,i<this._lowFpsThreshold&&this._lowFpsCount--,this._lastFPS<this._lowFpsCount&&this._lowFpsCount++}if(this._fpsIndex=(this._fpsIndex+1)%this._fpsWindowSize,platform.inDebugMode()&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.UPDATE_FPS,!1,{fps:this._lastFPS,avg:this._avgFps,all:this._fpsWindow}),this._fpsTick=0,this._fpsTime=this._fpsTime%1e3,xyd.frameRate>=60&&this._lowFpsCount>=this._lowFpsCountThreshold){this._lowFpsCountThreshold=this._fpsWindowSize+1,this._changeFrameRate(30);var n=this._avgFps;this._fpsWindow.length>0&&this._fpsWindow.length<this._fpsWindowSize&&(n=this._fpsSum/this._fpsWindow.length),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_DOWNGRADE_FPS,{avg_fps:n})}}}},t.prototype._resetFPS=function(){this._fpsTick=0,this._fpsTime=0,this._lastTime=0,this._lastFPS=0},t.prototype._changeFrameRate=function(e){var t=xyd.frameScale;this._stage.frameRate=e,xyd.frameRate=e,xyd.frameScale=e/30,xyd.DeltaTime=1/e,t>xyd.frameScale?(xyd.G=xyd.G*t,xyd.MAX_YA=xyd.MAX_YA*t):t<xyd.frameScale&&(xyd.G=xyd.G/xyd.frameScale,xyd.MAX_YA=xyd.MAX_YA/xyd.frameScale)},t.prototype.setFundActivity=function(e,t){this._engine?this._engine.getBoard().setSpecialDropHandler(e,e+t):(this._fundInitCount=e,this._fundTotalCount=e+t)},t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._stage.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.reset(),this._engine&&this._engine.dispose())},t.prototype._doPresureTest=function(){if(platform.inDebugMode()){var e=2e3,t=EffectConstants.NORMAL_DESTRUCTION_PURPLE,i="texiao01",n=0;if(1==this._totalTicks)for(var o=0;e>o;o++){var a=xyd.random(0,8),s=xyd.random(0,8);xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.EFFECT_PRESSURE_TEST,!1,{effectName:t,actionName:i,col:a,row:s,repeat:n})}}},t}(BaseController);__reflect(Game.prototype,"Game");var GameData=function(){function e(){}return Object.defineProperty(e.prototype,"board",{get:function(){return this._board},set:function(e){this._board=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameConf",{get:function(){return this._gameConf},set:function(e){this._gameConf=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameMode",{get:function(){return this._gameMode},set:function(e){this._gameMode=e},enumerable:!0,configurable:!0}),e}();__reflect(GameData.prototype,"GameData");var GuideHelper=function(){function e(){}return e.hasGuideForLevel=function(e){if(platform.inTestMode()&&platform.inAutoMode())return!1;if(!SelfInfo.get().isInMission&&e!=SelfInfo.get().getCurrentLevel())return!1;var t=GuideTable.get(),i=t.getGuideIDsByLevel(e);return void 0!=i&&i.length>0?!0:!1},e.getNextGuideID=function(e,t){for(var i=GuideTable.get(),n=i.getGuideIDsByLevel(e),o=-1,a=0,s=n;a<s.length;a++){var r=s[a];if(r>t){o=r;break}}return o},e.getRandomSeedForLevel=function(e){var t=0,i=GuideTable.get(),n=i.getGuideIDsByLevel(e);return n.length>0&&(t=i.getRandomSeed(n[0])),t},e.isValidMoveInGuide=function(e,t,i){var n=GuideTable.get(),o=n.getManual(e);if(o&&2==o.length){var a=9*t.x+t.y,s=9*i.x+i.y;return a==o[0]&&s==o[1]||a==o[1]&&s==o[0]}return!1},e.isValidSelectionInGuide=function(e,t){var i=GuideTable.get(),n=i.getManual(e);if(n)for(var o=9*t.x+t.y,a=0,s=n;a<s.length;a++){var r=s[a];if(o==r)return!0}return!1},e.getManualInGuide=function(e){var t=GuideTable.get(),i=t.getManual(e);return i},e.getHighlightELementsInGuide=function(e,t){var i=GuideTable.get(),n=i.getHighlight(e),o=[];if(n)for(var a=0,s=n;a<s.length;a++){var r=s[a],l=Math.floor(r/9),_=r%9,h=t.getElementAtGrid(l,_);h&&o.push(h)}return o},e.isFirstGuideForLevel=function(e){var t=GuideTable.get(),i=t.getTotalLevel(e),n=t.getGuideIDsByLevel(i);return n&&n.length>0&&n[0]==e?!0:!1},e.isLastGuideForLevel=function(e){var t=GuideTable.get(),i=t.getTotalLevel(e),n=t.getGuideIDsByLevel(i);if(901==e||902==e)return!1;if(n&&n.length>0){var o=n.length;if(e==n[o-1])return!0}return!1},e.isInGuide=!1,e}();__reflect(GuideHelper.prototype,"GuideHelper");var Board=function(){function e(e,t,i){this._SHOW_POSSIBLE_MOVE_FRAMES=Math.floor(79*xyd.frameScale),this._SHOW_LEAF_LIGHT_MOVE_FRAMES=Math.floor(150*xyd.frameScale),this._needUpdateColor=!1,this._destructionList=[],this._didSwap=!1,this._didUnstableAction=!1,this._swapPassFrames=0,this._scoreFactor=1,this._isPartialStable=!1,this._isStable=!1,this._nextDropElementType=[],this._nextDropElementTypeForPregameItem=[],this._steadyStableFrames=0,this._isRecovered=!1,this._itemList=[],this._itemUsedCount=[],this._isPregameItemsSetted=!1,this.isStabilityUpdating=function(){},this._inLastExplodeState=!1,this._activeItemList=[],this._recoverdSavedItemList=!1,this._inWandState=!1,this._beltMap=[],this._beltMoving=!1,this._isCrayonActivated=!1,this._usedToHaveColorMixer=!1,this._canSpecialDrop=!1,this._gameConf=e,this._boardElementFactory=t,this._blockerFactory=i,this._allElements=[],this._allBlockers=[],this._generators=[],this._generatorsBoard=[],this._generatorsCount=[],this._generatorHandlers=[],this._edgeBlockerBoard=[],this._firstButterflyEles=[],this._canSpecialDrop=!1,this._lockFactory=new LockFactory,platform.inAutoMode()&&(this._SHOW_POSSIBLE_MOVE_FRAMES=Math.floor(20*xyd.frameScale)),this._boardSave=new BoardSave(this._gameConf,this)}return e.prototype.init=function(){if(0==this._itemUsedCount.length)for(var e=0;e<xyd.MAX_ITEM_USED_COUNT;e++)this._itemUsedCount.push(0);var t=this._gameConf.cellMap;this._cellMap=t,this._boardRows=t.length,this._boardCols=t[0].length,this._preInit(),this._postInit(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_INIT_DONE)),this.saveToJson()},e.prototype._preInit=function(){var t=0,i=this._isRecovered?30:500;this._initPresetColor();var n=1/0,o=[];do this._initElementBoard(),n=this._setElementBoard(),this._recoverTimeBomb(),this._recoverRocket(),this._updateColorBoard(),this._removeMatches(),this._matchHandler.updatePossibleMoves(),o=this._matchHandler.getAllMatches(e.MATCH_PATTERN_3),t++;while(i>t&&n>2&&this._matchHandler.getPossibleMoves().length<=0&&o.length<=0);this._updateIntegratedBoard(),this._initUI(),this._initPluginsFromMode(),this._initBeltMap()},e.prototype._initUI=function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STAGE,!0,!1,{stage:this._gameConf.totalLevel})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STEP,!0,!1,{step:this._gameMode.getMovesLeft(),create:!0})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SCORE_TARGET,!0,!1,{scoreTarget:this.getScoreTarget()})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SCORE,!0,!1,{score:this._scoreHandler.getScore(),create:!0}))},e.prototype._initPresetColor=function(){this._presetColor=[];for(var e=0,t=this._boardRows;t>e;e++){this._presetColor[e]=[];for(var i=0,n=this._boardCols;n>i;i++){var o=this._cellMap[e][i];this._presetColor[e][i]=o.getPresetColor()}}},e.prototype._initElementBoard=function(){var e=[],t=[],i=[],n=[],o=[];this._elementBoard=[],this._integratedBoard=[],this._blockerBoard=[],this._generatorsBoard=[],this._edgeBlockerBoard=[];for(var a=0,s=this._boardRows;s>a;a++){e[a]=[],t[a]=[],i[a]=[],n[a]=[],o[a]=[];for(var r=0,l=this._boardCols;l>r;r++)e[a][r]=void 0,t[a][r]=void 0,i[a][r]=void 0,n[a][r]=void 0,o[a][r]=void 0
}this._elementBoard=e,this._integratedBoard=t,this._blockerBoard=i,this._generatorsBoard=n,this._edgeBlockerBoard=o},e.prototype._setElementBoard=function(){var e,t;this._generators=[],this._generatorsCount=[];for(var i=0,n=0,o=this._boardRows;o>n;n++)for(var a=0,s=this._boardCols;s>a;a++){e=this._cellMap[n][a],e.hasProperty(CellConstants.ELEMENET_GENERATOR)&&(t=new Generator(n,a,e),this._generators.push(t),this._generatorsCount.push(0),this._generatorsBoard[n][a]=t);var r=new CellFences(a,n,e,this._boardElementFactory,this._blockerFactory);this._edgeBlockerBoard[n][a]=r;var l=this._blockerFactory.getBlockerFromCell(e,a,n);l&&(this.setBlockerAtGrid(a,n,l),l.type==BlockerConstant.CLOUD_ROCKET?this._rocket=this._boardElementFactory.create(a,n,CellConstants.ELEMENT_COLOR_RANDOM,ElementTypeConstants.ROCKET):l.type==BlockerConstant.COLOR_MIXER&&(this.usedToHaveColorMixer=!0));var _=this._boardElementFactory.getElementFromCell(e,a,n);_&&(l?l.setNextElement(_):this.setElementAtGrid(a,n,_),i+=1);for(var h=0,c=1,d=0,p=CellConstants.LOCK_SET;d<p.length;d++){var u=p[d];switch(u){case CellConstants.SHACKLE:e.hasProperty(u)&&(h=LOCK_TYPE.SHACKLE);break;case CellConstants.ICE:e.hasProperty(u)&&(h=LOCK_TYPE.ICE);break;case CellConstants.GIFT_WRAPPER_1:case CellConstants.GIFT_WRAPPER_2:case CellConstants.GIFT_WRAPPER_3:case CellConstants.GIFT_WRAPPER_4:case CellConstants.GIFT_WRAPPER_5:e.hasProperty(u)&&(h=LOCK_TYPE.GIFT_WRAPPER,c=u-CellConstants.GIFT_WRAPPER_1+1)}if(h>0)break}if(h>0){var m=this._lockFactory.create(h,c);void 0!=l?l.addLock(m):void 0!=_&&_.addLock(m)}}for(var n=0,o=this._boardRows;o>n;n++)for(var a=0,s=this._boardCols;s>a;a++){var g=this._edgeBlockerBoard[n][a];if(void 0!=g.Edges[CellEdgesDirection.UP]){var f=this.getCellFenceAtGridInDir(a,n,CellEdgesDirection.LEFT)||this.getCellFenceAtGridInDir(a,n-1,CellEdgesDirection.LEFT);void 0!=f?g.Vertices[CellVerticesDirection.LEFTUP]=new CellVertice(g,CellVerticesDirection.LEFTUP):void 0==this.getCellFenceAtGridInDir(a-1,n,CellEdgesDirection.UP)&&(g.Vertices[CellVerticesDirection.LEFTUP]=new CellVertice(g,CellVerticesDirection.LEFTUP)),f=this.getCellFenceAtGridInDir(a,n,CellEdgesDirection.RIGHT)||this.getCellFenceAtGridInDir(a,n-1,CellEdgesDirection.RIGHT),void 0!=f?g.Vertices[CellVerticesDirection.RIGHTUP]=new CellVertice(g,CellVerticesDirection.RIGHTUP):void 0==this.getCellFenceAtGridInDir(a+1,n,CellEdgesDirection.UP)&&(g.Vertices[CellVerticesDirection.RIGHTUP]=new CellVertice(g,CellVerticesDirection.RIGHTUP))}if(void 0!=g.Edges[CellEdgesDirection.DOWN]){var f=this.getCellFenceAtGridInDir(a,n,CellEdgesDirection.LEFT)||this.getCellFenceAtGridInDir(a,n+1,CellEdgesDirection.LEFT);void 0!=f?g.Vertices[CellVerticesDirection.LEFTDOWN]=new CellVertice(g,CellVerticesDirection.LEFTDOWN):void 0==this.getCellFenceAtGridInDir(a-1,n,CellEdgesDirection.DOWN)&&(g.Vertices[CellVerticesDirection.LEFTDOWN]=new CellVertice(g,CellVerticesDirection.LEFTDOWN)),f=this.getCellFenceAtGridInDir(a,n,CellEdgesDirection.RIGHT)||this.getCellFenceAtGridInDir(a,n+1,CellEdgesDirection.RIGHT),void 0!=f?g.Vertices[CellVerticesDirection.RIGHTDOWN]=new CellVertice(g,CellVerticesDirection.RIGHTDOWN):void 0==this.getCellFenceAtGridInDir(a+1,n,CellEdgesDirection.DOWN)&&(g.Vertices[CellVerticesDirection.RIGHTDOWN]=new CellVertice(g,CellVerticesDirection.RIGHTDOWN))}}return i},e.prototype._initGeneratorHandler=function(e){for(var t=new GeneratorHandlerFactory,i=this._gameConf.handlerSet,n=0;n<i.length;n++){var o=i[n],a=t.create(o,e,this);void 0!=a&&this._generatorHandlers.push(a)}},e.prototype.setPregameItemOnBoard=function(){this._isPregameItemsSetted||(this._isPregameItemsSetted=!0,this._pregameItemManager.setOnBoard())},e.prototype.setExtraMoves=function(e){this._gameMode.addExtraMoves(e)},e.prototype._updateColorBoard=function(){this._colorBoard=[];for(var e,t=0,i=this._boardRows;i>t;t++){this._colorBoard[t]=[];for(var n=0,o=this._boardCols;o>n;n++)e=this.getElementAtGrid(n,t),e&&e.isMatchable()?this._colorBoard[t][n]=e.color:this._colorBoard[t][n]=0}},e.prototype._updateIntegratedBoard=function(){for(var e=0;e<this._boardCols;e++)for(var t=0;t<this._boardRows;t++){this._integratedBoard[t][e]=void 0;var i=this._elementBoard[t][e];i&&i.isDestroyed()&&(i=void 0),this._integratedBoard[t][e]=i}this._fallingHandler.integrateFallingElements()},e.prototype._removeMatches=function(){for(var t,i=this._matchHandler.getAllMatches(e.MATCH_PATTERN_3),n=0;i.length>0&&500>n;){for(var o=0,a=i;o<a.length;o++)t=a[o],this._recreateMatchElements(t);i=this._matchHandler.getAllMatches(e.MATCH_PATTERN_3),n+=1}},e.prototype._recreateMatchElements=function(e){for(var t=e.col,i=e.row,n=1;n<=e.up;n++)this._recreateMatchElementAt(t,i-n);for(var n=1;n<=e.down;n++)this._recreateMatchElementAt(t,i+n);for(var n=1;n<=e.left;n++)this._recreateMatchElementAt(t-n,i);for(var n=1;n<=e.right;n++)this._recreateMatchElementAt(t+n,i);this._updateColorBoard()},e.prototype._recreateMatchElementAt=function(e,t){this._cellMap[t][e];if(!(this._presetColor[t][e]>0)){var i=this.getElementAtGrid(e,t);if(void 0!=i){var n=i.getLock(),o=i.type,a=this._boardElementFactory.create(e,t,CellConstants.ELEMENT_COLOR_RANDOM,o);void 0!=n&&a.addLock(n),this.setElementAtGrid(e,t,a)}}},e.prototype._postInit=function(){this._changeElementTypeIfGuideRequires(),this._createGeneratorView(),this._createSpecialDrops(),this._createBoardView(),this._createPortalsView(),this._createElementsViewFromMode(),this._checkMatches(),this._rebuildPaths(),this._initGeneratorHandler(this._gameConf)},e.prototype._changeElementTypeIfGuideRequires=function(){var e=this._gameConf.totalLevel;if(GuideHelper.hasGuideForLevel(e)&&!this._isRecovered){var t=GuideTable.get(),i=GuideHelper.getNextGuideID(e,-1);if(0>=i)return;var n=t.getElementType(i),o=t.getHighlight(i);if(void 0==o||void 0==n||o.length!=n.length)return;for(var a=0;a<o.length;a++){var s=o[a]%9,r=Math.floor(o[a]/9),l=this._elementBoard[s][r];if(l){var _=l.color,h=n[a],c=this._boardElementFactory.create(r,s,_,h);this._elementBoard[s][r]=c}}}},e.prototype._createGeneratorView=function(){for(var e=0;e<this._generators.length;e++)this._generators[e].createGeneratorView()},e.prototype._createSpecialDrops=function(){if(this._specialDropsHandler&&this._specialDropsHandler.specialDrop){for(var e=[],t=0,i=this._boardRows;i>t;){for(var n=0,o=this._boardCols;o>n;){var a=this._elementBoard[t][n];a&&a.type==ElementTypeConstants.NORMAL&&!a.isLocked()&&e.push(a),n+=1}t+=1}var s=e.length,r=this._specialDropsHandler.getPreGenNum();if(r>=s)for(var l=0;s>l;l++)e[l].setSpecialDrop(!0),this._firstButterflyEles.push(e[l]),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_COIN));else for(var _=xyd.randomEx(0,s,r),l=0;r>l;l++)e[_[l]].setSpecialDrop(!0),this._firstButterflyEles.push(e[_[l]]),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_COIN));this._canSpecialDrop=!0}},e.prototype._createBoardView=function(){for(var e=0,t=0,i=8,n=8,o=0,a=this._boardRows;a>o;o++)for(var s=0,r=this._boardCols;r>s;s++){var l=this._elementBoard[o][s],_=this._blockerBoard[o][s],h=this._cellMap[o][s],c=this._edgeBlockerBoard[o][s];h.isEmpty()||((o+s)%2==0?xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BASE,!0,!1,{i:s,j:o,type:0})):xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BASE,!0,!1,{i:s,j:o,type:1})),e=s>e?s:e,t=o>t?o:t,i=i>s?s:i,n=n>o?o:n),l&&this.addElementToBoard(l),_&&this.addBlockerToBoard(_),c.isEmpty||this.addFenceToBoard(c)}xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SIZE,!0,!1,{maxHeight:t,minHeight:n,maxWidth:e,minWidth:i}))},e.prototype._createPortalsView=function(){for(var e=this._portalHandler.portals,t=0,i=e;t<i.length;t++){var n=i[t],o=n.color;(o==CellConstants.PORTAL_VISIBLE||o==CellConstants.PORTAL_VISIBLE_ENTER_POINT||o==CellConstants.PORTAL_VISIBLE_EXIT_POINT)&&(xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_PORTAL,!0,!1,{x:n.enterPoint.x,y:n.enterPoint.y,enter:!0})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_PORTAL,!0,!1,{x:n.exitPoint.x,y:n.exitPoint.y,enter:!1})))}},e.prototype._checkMatches=function(){this._matchHandler.checkMatches()},e.prototype._rebuildPaths=function(){for(var e=0,t=this._boardCols;t>e;e++)this._fallingHandler.rebuildPathByCol(e)},e.prototype.getLockFactory=function(){return this._lockFactory},e.prototype.rebuildPathForColumn=function(e){this._fallingHandler.rebuildPathByCol(e)},e.prototype.addElementToBoard=function(e){this._allElements.push(e),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_ELEMENT,!0,!1,e)),e.isLocked()&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_LOCK,!0,e.getLock())},e.prototype.addFenceToBoard=function(e){for(var t,i=0;i<xyd.directions.length;i++)t=e.Edges[i],t&&this._allBlockers.push(t);xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_EDGES,!0,!1,e))},e.prototype.addBlockerToBoard=function(e){this._allBlockers.push(e),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BLOCKER,!0,!1,e)),e.isLocked()&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_LOCK,!0,e.getLock())},e.prototype.getScoreTargets=function(){return this._scoreHandler.getScoreTargets()},e.prototype.getScoreTarget=function(){return this._scoreHandler.getScoreTarget()},e.prototype.getColorBoard=function(){return this._colorBoard},e.prototype.getCellMap=function(){return this._cellMap},e.prototype.getEdgeBoard=function(){return this._edgeBlockerBoard},e.prototype.getCell=function(e,t){return this.isValidGridPos(t,e)?this._cellMap[e][t]:void 0},e.prototype.setMatchHandler=function(e){this._matchHandler=e},e.prototype.setFallingHandler=function(e){this._fallingHandler=e},e.prototype.setSwapHandler=function(e){this._swapHandler=e},e.prototype.setScoreHandler=function(e){this._scoreHandler=e},e.prototype.setRandomHandler=function(e){this._randomHandler=e;var t={stage:this.getGameConf().totalLevel,rm_seed:this._randomHandler.getSeed()};logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_BOARD_SHOW,t,!0)},e.prototype.setRandomHandlerForChecking=function(){this._randomHandlerForChecking=new RandomHandler(this._randomHandler.getSeed())},e.prototype.setPortalHander=function(e){this._portalHandler=e},e.prototype.getPortalHandler=function(){return this._portalHandler},e.prototype.setGameMode=function(e){this._gameMode=e},e.prototype.setSpecialDropHandler=function(e,t){this._specialDropsHandler=new SpecialDropHandler(this,e,t),this._specialDropsHandler.setSpecialDrop(!0)},e.prototype.setPregameItemManager=function(e,t,i){i&&(this._recoverdSavedItemList=!0);var n=new PregameItemManager(t);if(!this._recoverdSavedItemList)for(var o=0,a=e;o<a.length;o++){var s=a[o];logger.logStep("PI:"+s)}this._activeItemList=e,n.init(e,this),this._pregameItemManager=n},e.prototype._recoverRocket=function(){if(this._rocketSave){var e=Number(this._rocketSave.key),t=e%10,i=Math.floor(e/10),n=this.getElementAtGrid(t,i);if(n){var o=n,a=this._rocketSave.type||RocketConstants.REGULAR_ROCKET,s=this._rocketSave.state||RocketConstants.STATE_DARK,r=void 0==this._rocketSave.remainCapacity?o.remainCapacity:this._rocketSave.remainCapacity;o.rocketState=s,o.setSpecialPower(a),o.remainCapacity=r,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ROCKET,!1,o)}else{var l=this.getBlockerAtGrid(t,i);if(l){var o=l,a=this._rocketSave.type||RocketConstants.REGULAR_ROCKET,s=this._rocketSave.state||RocketConstants.STATE_DARK,r=void 0==this._rocketSave.remainCapacity?o.remainCapacity:this._rocketSave.remainCapacity,_=this._rocketSave.color||o.color;o.rocketType=a,o.rocketState=s,o.color=_,o.remainCapacity=r}}}},e.prototype.setSavedRocket=function(e){e&&(this._rocketSave=e)},e.prototype.getSavedColorMixer=function(){return this._colorMixerSave},e.prototype.setSavedColorMixer=function(e){e&&(this.usedToHaveColorMixer=e.usedToHaveCM,this._colorMixerSave={eleIndex:e.eleIndex,stepCnt:e.stepCnt})},e.prototype.getScoreHandler=function(){return this._scoreHandler},e.prototype.setScoreTarget=function(e){this._scoreHandler.setScoreTarget(e)},e.prototype.setSavedScore=function(e){this._isRecovered=!0,this._scoreHandler.setScore(e),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SCORE,!0,!1,{score:e}))},e.prototype.setMovesLeft=function(e){this._gameMode.setMovesLeft(e),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STEP,!0,!1,{step:e}))},e.prototype.setAutoWin=function(){this._gameMode.setAutoWin()},e.prototype.setMovesUsed=function(e){this._gameMode.setMovesUsed(e)},e.prototype.isStable=function(){return this._isStable&&this._steadyStableFrames>1},e.prototype.isBeltCell=function(e,t){if(0==this.isValidGridPos(e,t))return!1;var i=e+9*t;return this._beltMap[i]||!1},e.prototype.updateBoard=function(){this._updatePortals(),this._updateFallingPaths(),this._updateELements(),this._updateBlockers(),this._updateColorBoard(),this._updateIntegratedBoard(),this._shouldCheckMatch()&&this._matchHandler.checkMatches(),this._updateElementsFromMode(),this._updateShouldRemoveElements(),this._updateShouldRemoveBlockers(),this._updateDestructionPacks(),this._updateDestroyedElements(),this._updateMoveElementsFromGridToPath(),this._updateGenerateElementsOnTop(),this._updateIntegratedBoard(),this._shouldCheckStability()&&this._updateStability()},e.prototype._shouldCheckActiveList=function(){return this.checkPartialStable()},e.prototype._updateGenerateElementsOnTop=function(){for(var e=0;e<this._generators.length;e++)this._generatorsCount[e]<1?this._waitingForTeleport(this._generators[e])||this._checkTopSpace(e):this._checkTopSpace(e)},e.prototype._waitingForTeleport=function(e){var t=e.col,i=e.row;if(this._portalHandler.isExitPortal(t,i)){var n=this._portalHandler.getExitPortalAt(t,i),o=n.enterPoint,a=this.getGridContainerAt(o.x,o.y);return void 0==a?!1:a.isLocked()?!1:a.hasBlocker()?!1:this._portalHandler.checkIfTeleported(n,a.getElement())?!1:!0}return!1},e.prototype._checkTopSpace=function(e){var t=this._generators[e],i=t.row,n=t.col;if(!this.isStaticCell(n,i)&&void 0==this.getElementAtGrid(n,i)){this._generatorsCount[e]=1;var o=this._fallingHandler.getPathByPoint(n,i);if(void 0!=o){for(var a=0,s=i;s<this._boardRows&&!this.isStaticCell(n,s)&&(this.getElementAtGrid(n,s)||a++,!this.getCellFenceAtGridInDir(n,s,CellEdgesDirection.DOWN));s++);a-=o.getSize(),a>0&&this._generateNewElementByGeneratror(n,i,t,1)}}},e.prototype._checkCanGeneratorInLastExplode=function(e){return e.type!=ElementTypeConstants.NORMAL?!1:!0},e.prototype._generateNewElementByGeneratror=function(e,t,i,n){if(!this._beltMoving){for(var o,a,s=this._fallingHandler.getPathByPoint(e,t),r=!0,l=!1,_=0;_<this._nextDropElementType.length;_++){var h=this._nextDropElementType[_];if(i.canGenerateElement(h)){var c=ElementTypeConstants.COLORFUL_ELEMENTS.indexOf(h)>-1?CellConstants.ELEMENT_COLOR_RANDOM:0;o=h==ElementTypeConstants.CAKE?this._boardElementFactory.create(e,t-n,0,h,void 0,3):this._boardElementFactory.create(e,t-n,c,h),a=_;break}}if(void 0==o)for(var _=0;_<this._nextDropElementTypeForPregameItem.length;_++){var h=this._nextDropElementTypeForPregameItem[_],c=ElementTypeConstants.COLORFUL_ELEMENTS.indexOf(h)>-1?CellConstants.ELEMENT_COLOR_RANDOM:0;o=h==ElementTypeConstants.CAKE?this._boardElementFactory.create(e,t-n,0,h,void 0,3):this._boardElementFactory.create(e,t-n,c,h),a=_,l=!0;break}if(void 0==o){if(!i.canGenerateElement(ElementTypeConstants.NORMAL))return;o=this._boardElementFactory.create(e,t-n,CellConstants.ELEMENT_COLOR_RANDOM,ElementTypeConstants.NORMAL),r=!1}if(this._inLastExplodeState&&(this._checkCanGeneratorInLastExplode(o)||(o=this._boardElementFactory.create(e,t-n,CellConstants.ELEMENT_COLOR_RANDOM,ElementTypeConstants.NORMAL),r=!1)),void 0!=o)if(s.hasSpaceForInsertElement(o)){r&&void 0!=a&&(!l&&this._nextDropElementType.length>0?this._nextDropElementType.splice(a,1):l&&this._nextDropElementTypeForPregameItem.length>0&&this._nextDropElementTypeForPregameItem.splice(a,1));var d=s.getElementAt(0);d&&(o.ya=d.ya),s.insertElement(o),this.addElementToBoard(o),o.enteringY=t,o.enteringBoard=!0,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ENTER,!1,o)}else o.getSpecialDrop()&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_REMOVE_COIN))}},e.prototype._updatePortals=function(){if(!this.isBeltMoving())for(var e=0,t=this._allElements;e<t.length;e++){var i=t[e];i.isDead()||i.busy||i.shouldNotFall||i.locked||i.isSliding()||i.isTeleporting()||this._portalHandler.update(i)}},e.prototype._updateFallingPaths=function(){this._fallingHandler.update()},e.prototype._updateELements=function(){for(var e,t=0,i=this._allElements;t<i.length;t++)e=i[t],e.update()},e.prototype._updateBlockers=function(){for(var e,t=0,i=this._allBlockers;t<i.length;t++)e=i[t],e.update()},e.prototype.getRocket=function(){return this._rocket},e.prototype._updateShouldRemoveElements=function(){for(var e=0,t=this._allElements;e<t.length;e++){var i=t[e];if(i.shouldRemove){if(i.isDead())continue;i.setDead();var n=i.getRemoveMatch(),o=i.getDamageSource();xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ELEMENT_ANIMATION_BEGIN,!1,{ele:i,damageSource:o}),o==DamageSource.PUZZLE?xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ANIMATION_ELEMENT_BY_PUZZLE,!1,i):o==DamageSource.REFUEL_TO_ROCKET&&this.getRocket()&&i.color==this.getRocket().color&&(i.type<ElementTypeConstants.BOMB_ROW||i.type>ElementTypeConstants.BOMB_COLOR)&&!this._inLastExplodeState?(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ANIMATION_ROCKET,!1,{from:i,to:this.getRocket()}),i.affectAdjacentBlockerOnRemove&&(this._checkAdjacentBlocker(i),this._checkAdjacentElement(i),this._didUnstableAction=!0)):(n&&n.patternType!=MatchConstants.MATCH_3&&i.type==ElementTypeConstants.NORMAL?((void 0==i.destructionPack||i.destructionPack.getType()!=MatchConstants.DP_NONE)&&i.setDestroyFrames(9*xyd.frameScale),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ANIMATION_SPECIAL,!1,{element:i,match:n})):xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ANIMATION_ELEMENT,!1,i),void 0==i.destructionPack||i.destructionTriggered||this.addToDestructionPlanList(i),i.affectAdjacentBlockerOnRemove&&(this._checkAdjacentBlocker(i),this._checkAdjacentElement(i),this._didUnstableAction=!0))}}},e.prototype._checkAdjacentElement=function(e){for(var t=[1,0,3,2],i=0,n=0,o=xyd.directions;n<o.length;n++){var a=o[n];if(!this.getCellFenceAtGridInDir(e.col,e.row,t[i++])){var s=e.col+a[0],r=e.row+a[1],l=this.getElementAtGrid(s,r);if(void 0!=l)if(l.type!=ElementTypeConstants.CAKE||l.busy){if(l.isLocked()&&!l.busy){var _=l.getLock();_.type==LOCK_TYPE.ICE&&this.removeLock(l)}}else if(l.isLocked()){var _=l.getLock();_.type==LOCK_TYPE.ICE&&this.removeLock(l)}else this.addForRemoval(l)}}},e.prototype._checkAdjacentBlocker=function(e){for(var t=[1,0,3,2],i=0,n=0,o=xyd.directions;n<o.length;n++){var a=o[n],s=e.col+a[0],r=e.row+a[1];if(!this.getCellFenceAtGridInDir(e.col,e.row,t[i++])){var l=this.getBlockerAtGrid(s,r);if(void 0!=l){if(l.type==BlockerConstant.CLOUD||l.type==BlockerConstant.CLOUD_ROCKET){if(l.isLocked())continue;this.hitBlocker(l,1)}if(l.isLocked()){var _=l.getLock();_.type==LOCK_TYPE.ICE&&this.hitBlocker(l,1)}}}}},e.prototype._updateShouldRemoveBlockers=function(){for(var e=0,t=this._allBlockers;e<t.length;e++){var i=t[e];i.shouldRemove()&&(this.removeBlocker(i),this._didUnstableAction=!0)}},e.prototype._updateDestroyedElements=function(){for(var e=0,t=this._allElements;e<t.length;e++){var i=t[e];i.isDestroyed()&&this.removeElement(i)}},e.prototype._updateDestructionPacks=function(){if(0!=this._destructionList.length){for(var e,t,i=[],n=0,o=this._destructionList;n<o.length;n++){var a=o[n];a.update(),e=a.getElementsToRemove();for(var s=0,r=e;s<r.length;s++)if(t=r[s],t.canBeDestroyed()||t.isLocked()){a.getType()==MatchConstants.DP_BOMB&&t.setStable();var l=void 0,_=0;if(a.shouldRefuelToRocket()?l=DamageSource.REFUEL_TO_ROCKET:a.getType()==MatchConstants.DP_ROW||a.getType()==MatchConstants.DP_COL?l=DamageSource.LINE:a.getType()==MatchConstants.DP_COLOR_COLOR?(l=l=DamageSource.COLOR_COLOR,t.type>=ElementTypeConstants.BOMB_ROW&&t.type<=ElementTypeConstants.BOMB_COLOR&&(t.shouldNotPreventSlide=!0,_=30*xyd.frameScale)):a.getType()==MatchConstants.DP_COLOR&&(_=8*xyd.frameScale),this.addForRemoval(t,_,l),a.getType()!=MatchConstants.DP_COLOR)for(var h=0,c=e;h<c.length;h++)t=c[h],t.score<=0&&(t.score=ScoreConstants.ELEMENET_IN_DP_LINE);else for(var d=a.getAllElements().length+1,p=0,u=e;p<u.length;p++)t=u[p],t.score<=0?t.score=ScoreConstants.ELEMENET_IN_DP_LINE*d:t.score*=d,t.specialScore>0&&(t.specialScore*=d)}else if(t.type==ElementTypeConstants.ROCKET){var m=t;m.isRegular()||(this.addToDestructionPlanList(m),m.clearDestructionPack())}for(var g=a.getBlockersToRemove(),f=0,y=g;f<y.length;f++){var E=y[f],l=null,v=SpecialSwapConstants.NONE;if(a.getSwap()&&(v=a.getSwap().specialSwapType),a.getType()==MatchConstants.DP_ROW||a.getType()==MatchConstants.DP_COL)l=DamageSource.LINE,v==SpecialSwapConstants.LINE_LINE_SWAP&&(l=DamageSource.LINE_LINE);else if(a.getType()==MatchConstants.DP_BOMB){l=DamageSource.SQUARE;var T=a;v==SpecialSwapConstants.SQUARE_SQUARE_SWAP?l=DamageSource.SQUARE_SQUARE:T.isColorMixerExploded&&(l=DamageSource.COLOR_MIXER_EXPLODE)}else a.getType()==MatchConstants.DP_COL_ROW_THREE?l=DamageSource.LINE_SQUARE:a.getType()==MatchConstants.DP_COLOR_COLOR&&(l=l=DamageSource.COLOR_COLOR);this.hitBlocker(E,1,l)}for(var C=0,L=a.getAffectedLocs();C<L.length;C++){var b=L[C],w=b.x,S=b.y;!this.isValidGridPos(w,S)||this.getElementAtGrid(w,S)||this.getBlockerAtGrid(w,S)||this.hitEmptyCell(w,S)}0==a.isDone()&&i.push(a)}this._destructionList=i}},e.prototype.hasMoves=function(){return!0},e.prototype.getAllElements=function(){return this._allElements},e.prototype.getAllBlockers=function(){return this._allBlockers},e.prototype.getElementAtGrid=function(e,t){return this.isValidGridPos(e,t)?this._elementBoard[t][e]:void 0},Object.defineProperty(e.prototype,"isCrayonActivated",{get:function(){return this._isCrayonActivated},set:function(e){this._isCrayonActivated=e},enumerable:!0,configurable:!0}),e.prototype.setElementAtGrid=function(e,t,i,n){if(void 0===n&&(n=!1),this.isValidGridPos(e,t)){var o=this.getElementAtGrid(e,t);o&&o.getSpecialDrop()&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_REMOVE_COIN)),i.type==ElementTypeConstants.ROCKET&&(this._rocket=i),this.isValidGridPos(i.col,i.row)&&(this._elementBoard[i.row][i.col]==i?this._elementBoard[i.row][i.col]=void 0:n&&this._elementBoard[i.row][i.col]),n&&this._elementBoard[t][e]&&logger.errorStr("ERROR: Set element at occupied grid\n"+SelfInfo.get().operationLog),this._didUnstableAction=!0,this._elementBoard[t][e]=i,i.y=t,i.x=e,i.ya=0}},e.prototype.getIntergratedElementAt=function(e,t){return this.isValidGridPos(e,t)?this._integratedBoard[t][e]:void 0},e.prototype.setIntegratedElementAt=function(e,t,i){this._integratedBoard[t][e]=i},e.prototype.clearElementAtGrid=function(e,t){this.isValidGridPos(e,t)&&(this._elementBoard[t][e]=void 0)},e.prototype.swapElements=function(e,t){this._elementBoard[e.row][e.col]=void 0,this._elementBoard[t.row][t.col]=void 0;var i=e.col,n=e.row;this.setElementAtGrid(t.col,t.row,e),this.setElementAtGrid(i,n,t)},e.prototype.setBlockerAtGrid=function(e,t,i){this.isValidGridPos(e,t)&&(this._blockerBoard[t][e]=i,i.col=e,i.row=t)},e.prototype.replaceBlockerToElement=function(e){var t=e.col,i=e.row,n=this.getBlockerAtGrid(t,i);0>i||0>t||i>8||i>8||(void 0!=n&&(n.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,n.getLock()),n.breakLock()),this._blockerBoard[i][t]=void 0,this._allBlockers.splice(this._allBlockers.indexOf(n),1),this._fallingHandler.rebuildPathByCol(t)),this._elementBoard[i][t]=e,e.y=i,e.x=t,e.ya=0,this._allElements.push(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_BLOCKER,!1,n),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_ELEMENT,!1,e))},e.prototype.replaceBoardElement=function(e,t){void 0===t&&(t=!1);var i=e.col,n=e.row,o=this.getElementAtGrid(i,n);0>n||0>i||n>8||n>8||(void 0!=o&&(this._elementBoard[n][i]=void 0,this._allElements.splice(this._allElements.indexOf(o),1),o.type==ElementTypeConstants.TIME_BOMB&&this.addDropElementType(ElementTypeConstants.TIME_BOMB)),this._elementBoard[n][i]=e,e.y=n,e.x=i,e.ya=0,this._allElements.push(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ELEMENT,!1,{newEle:e,oldEle:o,needCollect:t}))},e.prototype.replaceCakeElement=function(e){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ELEMENT,!1,{newEle:e,oldEle:e,needCollect:!0})},e.prototype.replaceBalloonElement=function(e){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ELEMENT,!1,{newEle:e,oldEle:e})},e.prototype.isValidSwap=function(t){this._swapPassFrames=0;var i=this._matchHandler.isValidSwap(t,e.MATCH_PATTERN_3);return i?this._lastSwap=t:this._lastSwap=void 0,i},e.prototype.doSwap=function(e){return this._swapPassFrames=0,this._swapHandler.doSwap(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_SWITCH_MADE,!0,e),this._gameMode.removeMoves(),this._didSwap=!0,!0},e.prototype.doSwapWithoutRemoveMove=function(e){return this._swapPassFrames=0,this._swapHandler.doSwapBySwapper(e),this._didSwap=!0,!0},e.prototype.getBoardCols=function(){return this._boardCols},e.prototype.getBoardRows=function(){return this._boardRows},e.prototype.isStaticCell=function(e,t){if(!this.isValidGridPos(e,t))return!0;if(this._cellMap[t][e].hasProperty(CellConstants.VOID))return!0;var i=this.getBlockerAtGrid(e,t);if(i)return!0;var n=this.getElementAtGrid(e,t);return n&&(n.isLocked()||n.isSticky())?!0:!1},e.prototype.isStickyCell=function(e,t){var i=this.getElementAtGrid(e,t);return i&&i.isSticky()?!0:!1},e.prototype.isCannotMoveCell=function(e,t){var i=this.getElementAtGrid(e,t);return i&&!i.canBeMoved()?!0:!1},e.prototype.isVoidCell=function(e,t){return this.isValidGridPos(e,t)?this._cellMap[t][e].hasProperty(CellConstants.VOID)?!0:!1:!0},e.prototype.hasLockAtPos=function(e,t){var i=this.getElementAtGrid(e,t);if(i&&i.isLocked())return!0;var n=this.getBlockerAtGrid(e,t);return n&&n.isLocked()?!0:!1},e.prototype.isValidGridPos=function(e,t){return 0>e||e>=this._boardCols||0>t||t>=this._boardRows?!1:!0},e.prototype.removeElement=function(e,t){void 0===t&&(t=!1);var i;this._allElements.splice(this._allElements.indexOf(e),1);var n=this.getElementAtGrid(e.col,e.row);if(n==e)n.getDamageSource()==DamageSource.PUZZLE&&n.type!=ElementTypeConstants.BALLOON&&(n.destructionPack=void 0),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ELEMENT,!1,{ele:e,scoreFactor:this._scoreFactor,force:t}),this._elementBoard[e.row][e.col]=void 0;else{if(i=this._fallingHandler.getPathByElement(e),void 0==i)return void xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ELEMENT,!1,{ele:e,scoreFactor:this._scoreFactor,force:t});i.removeElement(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_ELEMENT,!1,{ele:e,scoreFactor:this._scoreFactor,force:t})}if(!t){this.calculateElementScore(e);var o=e.destructionPack;if(void 0!=o&&void 0!=o.getNextElement()){var a=o.getNextElement();if(a.setBoard(this),a.inDpack=!1,this._allElements.push(a),a.isLocked())a.x=e.col,a.y=e.row,this.setElementAtGrid(a.col,a.row,a);else{if(a.x=e.x,a.y=e.y,this._fallingHandler.rebuildPathByCol(a.x),i=this._fallingHandler.getPathByPoint(a.x,a.y),void 0==i)return;i.insertElement(a),this._fallingHandler.rebuildPathByCol(a.x)}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_ELEMENT,!1,a),a.isLocked()&&(this.rebuildPathForColumn(a.col),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_LOCK,!0,a.getLock())),o.getType()==MatchConstants.DP_BOMB&&(a.score=ScoreConstants.BOMB_SQUARE,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ACTIVE_ELEMENT,!1,a))}}},e.prototype.removeBlocker=function(e){if(this._allBlockers.splice(this._allBlockers.indexOf(e),1),e.type==BlockerConstant.CURLS){var t=this._edgeBlockerBoard[e.row][e.col].Edges.indexOf(e);t>-1&&(this._edgeBlockerBoard[e.row][e.col].Edges[t]=void 0)}else this._blockerBoard[e.row][e.col]=void 0;xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_BLOCKER,!1,e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.ROCKT_RECOVER_FROM_CLOUD,!1,e),this._fallingHandler.rebuildPathByCol(e.col)},e.prototype.addForRemoval=function(e,t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=DamageSource.MATCH),e&&e.state==BoardElementState.REMOVE_STATE&&this.hitEmptyCell(e.col,e.row),e.busy&&!e.isSliding()||e.isDead()||e.hasShield())return void(e.inDpack=!1);if(i==DamageSource.WAND)this.removeLock(e);else if(e.isLocked()){var o=e.getLock();return e.breakLock()&&(this._fallingHandler.rebuildPathByCol(e.col),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,o)),e.inDpack=!1,void this.didUnstableAction()}if(e.type==ElementTypeConstants.CAKE){var a=e,s=a.hitElementAndCheckRemove();if(!s)return void this.replaceCakeElement(a)}if(e.type==ElementTypeConstants.BALLOON){var r=e,s=r.hitElementAndCheckRemove();if(!s)return void this.replaceBalloonElement(r);var l=this._boardElementFactory.create(r.col,r.row,0,ElementTypeConstants.BOMB_COLOR);r.destructionPack=new DPackSimple(this,r,l)}e.type==ElementTypeConstants.ROCKET&&(this._checkAdjacentBlocker(e),this._checkAdjacentElement(e)),this._didUnstableAction=!0,e.prepareForRemoval(t,i,n)},e.prototype.addForRemovalForce=function(e,t){void 0===t&&(t=0),e.busy||e.isDead()||(this.removeLock(e),this._didUnstableAction=!0,e.prepareForRemoval(t))},e.prototype.addBlockerForRemoval=function(e){e.busy||e.hasShield()||e.prepareForRemoval()},e.prototype.didUnstableAction=function(){this._didUnstableAction=!0},e.prototype._updateMoveElementsFromGridToPath=function(){if(!this.isBeltMoving())for(var e,t=this._boardRows-1;t>=0;t--)for(var i=0,n=this._boardCols;n>i;i++)e=this.getElementAtGrid(i,t),void 0==e||0!=e.shouldNotFall||e.busy||e.isDestroyed()||this.hasLockAtPos(i,t)||void 0!=this.getElementAtGrid(i,t+1)||this.isStaticCell(i,t+1)||e.isSticky()||this.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.DOWN)||this._insertElementIntoPath(i,t,e)&&(this._elementBoard[t][i]=void 0)},e.prototype._insertElementIntoPath=function(e,t,i){var n=this._fallingHandler.getPathByPoint(e,t);return n&&n.hasSpaceForInsertElement(i)?n.insertElement(i):!1},e.prototype._shouldCheckStability=function(){return this._inWandState?!1:!0},e.prototype._shouldCheckMatch=function(){return this._inWandState?!1:this.checkPartialStable()},e.prototype.checkPartialStable=function(){return this._didSwap?!0:this._swapPassFrames<Math.floor(10*xyd.frameScale)?!1:this._didUnstableAction||this._destructionList.length>0?!1:!this._fallingHandler.isFalling()&&!this._hasElementSliding()},e.prototype._updateStability=function(){var e=this._isStable,t=this._isPartialStable;if(this._isPartialStable=this.checkPartialStable(),0==t&&1==this._isPartialStable)for(var i=0;i<this._generatorsCount.length;i++)this._generatorsCount[i]=0;if(this._isStable=this._isPartialStable&&!this.isStabilityUpdating()&&this._isAllElementStablized(),this._isStable&&!e)this._steadyStableFrames=0;else if(!this._isStable&&e)xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_UNSTABLE));else if(this._isStable&&e)if(this._steadyStableFrames+=1,3==this._steadyStableFrames){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STABLE)),this._checkMatchCombo(),this._scoreFactor=1;for(var i=0;i<this._generatorsCount.length;i++)this._generatorsCount[i]=0}else if(4==this._steadyStableFrames)this.saveToJson(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION)),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_GRID_HINT_ANIMATION)),this._gameMode.checkHammerHint(),GuideHelper.isInGuide||this._gameMode.checkWandHint();
else if(this._steadyStableFrames==this._SHOW_POSSIBLE_MOVE_FRAMES)xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SHOW_POSSIBLE_MOVE));else if((this._steadyStableFrames-180)%this._SHOW_LEAF_LIGHT_MOVE_FRAMES==0&&this._gameMode.hasLeaf()){var n=this._gameMode;n.leafLight()}this._didSwap=!1,this._didUnstableAction=!1,this._swapPassFrames++,!e&&this._isPartialStable&&this._matchHandler.updatePossibleMoves()},e.prototype.blackHoleEff=function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STABLE))},e.prototype._hasElementSliding=function(){for(var e=0,t=this._allElements;e<t.length;e++){var i=t[e];if(i.isSliding())return!0}return!1},e.prototype._isAllElementStablized=function(){for(var e=0,t=this._allElements;e<t.length;e++){var i=t[e];if(i.isPreventingStability())return!1}return!0},e.prototype.getLastSwap=function(){return this._lastSwap},e.prototype.calculateElementScore=function(e){0!=e.score&&(e.inDpack||(e.score*=this._scoreFactor,this._scoreFactor++));var t=e.score+e.specialScore;t>0&&this._scoreHandler.addScore(t)},e.prototype.addScore=function(e){this._scoreHandler.addScore(e)},e.prototype.isPartialStable=function(){return this._isPartialStable},e.prototype.addToDestructionPlanList=function(e){e.destructionTriggered||(e.destructionTriggered=!0,e.destructionPack.setup(),this._destructionList.push(e.destructionPack)),e.destructionTriggered=!0},e.prototype.getElementFactory=function(){return this._boardElementFactory},e.prototype.getCellEdgesAtGrid=function(e,t){return this.isValidGridPos(e,t)?this._edgeBlockerBoard[t][e]:void 0},e.prototype.getCellVerticeAtGridInDirection=function(e,t,i){return this.isValidGridPos(e,t)?void 0!=this._edgeBlockerBoard[t][e].Vertices[i]?this._edgeBlockerBoard[t][e].Vertices[i]:i==CellVerticesDirection.LEFTUP?this.simpleGetCellVerticeAtGridInDir(e-1,t,CellVerticesDirection.RIGHTUP)||this.simpleGetCellVerticeAtGridInDir(e,t-1,CellVerticesDirection.LEFTDOWN)||this.simpleGetCellVerticeAtGridInDir(e-1,t-1,CellVerticesDirection.RIGHTDOWN):i==CellVerticesDirection.RIGHTUP?this.simpleGetCellVerticeAtGridInDir(e+1,t,CellVerticesDirection.LEFTUP)||this.simpleGetCellVerticeAtGridInDir(e,t-1,CellVerticesDirection.RIGHTDOWN)||this.simpleGetCellVerticeAtGridInDir(e+1,t-1,CellVerticesDirection.LEFTDOWN):i==CellVerticesDirection.RIGHTDOWN?this.simpleGetCellVerticeAtGridInDir(e+1,t,CellVerticesDirection.LEFTDOWN)||this.simpleGetCellVerticeAtGridInDir(e,t+1,CellVerticesDirection.RIGHTDOWN)||this.simpleGetCellVerticeAtGridInDir(e+1,t+1,CellVerticesDirection.LEFTUP):i==CellVerticesDirection.LEFTDOWN?this.simpleGetCellVerticeAtGridInDir(e-1,t,CellVerticesDirection.RIGHTDOWN)||this.simpleGetCellVerticeAtGridInDir(e,t+1,CellVerticesDirection.LEFTUP)||this.simpleGetCellVerticeAtGridInDir(e-1,t+1,CellVerticesDirection.RIGHTUP):void console.error("unknow directions type!!!!!!!"):void 0},e.prototype.simpleGetCellVerticeAtGridInDir=function(e,t,i){return this.isValidGridPos(e,t)?this._edgeBlockerBoard[t][e].getVertice(i):void 0},e.prototype.getCellFenceAtGridInDir=function(e,t,i){return this.isValidGridPos(e,t)?void 0!=this._edgeBlockerBoard[t][e].Edges[i]?this._edgeBlockerBoard[t][e].Edges[i]:i==CellEdgesDirection.UP?this.isValidGridPos(e,t-1)?this._edgeBlockerBoard[t-1][e].getEdge(CellEdgesDirection.DOWN):void 0:i==CellEdgesDirection.DOWN?this.isValidGridPos(e,t+1)?this._edgeBlockerBoard[t+1][e].getEdge(CellEdgesDirection.UP):void 0:i==CellEdgesDirection.LEFT?this.isValidGridPos(e-1,t)?this._edgeBlockerBoard[t][e-1].getEdge(CellEdgesDirection.RIGHT):void 0:i==CellEdgesDirection.RIGHT?this.isValidGridPos(e+1,t)?this._edgeBlockerBoard[t][e+1].getEdge(CellEdgesDirection.LEFT):void 0:void console.error("unknow directions type!!!!!!!"):void 0},e.prototype.getBlockerAtGrid=function(e,t){return this.isValidGridPos(e,t)?this._blockerBoard[t][e]:void 0},e.prototype.getBlockerAroundGrid=function(e,t){var i=[],n=void 0;return n=this.getBlockerAtGrid(e-1,t),n&&i.push(n),n=this.getBlockerAtGrid(e+1,t),n&&i.push(n),n=this.getBlockerAtGrid(e,t-1),n&&i.push(n),n=this.getBlockerAtGrid(e,t+1),n&&i.push(n),i},e.prototype.isBlocker=function(e,t){return void 0!=this.getBlockerAtGrid(e,t)},e.prototype._initPluginsFromMode=function(){if(this._gameMode.initPlugins(this._gameConf),this._gameMode.hasLeaf()){var e=this._gameMode;this._LeafFacade=e.getLeafFacade()}this._gameMode.hasObjectiveMode()||(this._goldEggManager=new GoldEggManager(this,void 0))},e.prototype._initBeltMap=function(){for(var e=0;81>=e;e++)this._beltMap[e]=!1;for(var t=this._gameConf.beltInfo,i=0,n=t;i<n.length;i++){var o=n[i],a=o[0]+9*o[1];this._beltMap[a]=!0}},e.prototype._createElementsViewFromMode=function(){this._gameMode.createElementsView()},e.prototype._updateElementsFromMode=function(){this._gameMode.updateElementsInPlugin()},e.prototype.calculateMatchedSpecialScore=function(e){return this._gameMode.calculateElementScore(e)},e.prototype.getFallingHandler=function(){return this._fallingHandler},e.prototype.hitBlocker=function(e,t,i){if(void 0!=e){if(e.isLocked()){var n=e.getLock();return e.breakLock()?(e.type==BlockerConstant.CLOUD&&(e.shieldFrames=3*xyd.frameScale),this._fallingHandler.rebuildPathByCol(e.col),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,n),void(this._didUnstableAction=!0)):void 0}(e.type!=BlockerConstant.PUZZLE||1!=e.health)&&(99==t||!e.busy&&!e.hasShield())&&(e.applyDamage(t,i),e.canBeDestroyed()&&(e.health<=0?(this.addBlockerForRemoval(e),e.type==BlockerConstant.COLOR_MIXER?xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_PREPARE_REMOVE_COLORMIXER,!1,e):e.type==BlockerConstant.CURLS):xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_BLOCK,!1,e)))}},e.prototype.getFallingPathsByCol=function(e){return this._fallingHandler.getPathByCol(e)},e.prototype.getFallingPathByPoint=function(e,t){return this._fallingHandler.getPathByPoint(e,t)},e.prototype.getFallingPathByElement=function(e){return this._fallingHandler.getPathByElement(e)},e.prototype.addDropElementType=function(e){this._nextDropElementType.push(e)},e.prototype.addDropElementTypeForPregameItem=function(e){this._nextDropElementTypeForPregameItem.push(e)},e.prototype.removeDropElementType=function(e){for(var t=this._nextDropElementType.length-1;t>=0;t--)this._nextDropElementType[t]==e&&this._nextDropElementType.splice(t,1)},e.prototype.getRequestNumOfType=function(e){for(var t=0,i=0;i<this._nextDropElementType.length;i++)this._nextDropElementType[i]==e&&t++;return t},e.prototype.hasPossibleMoves=function(){return this._matchHandler.hasPossibleMoves()},e.prototype.hasDestructionPlans=function(){return this._destructionList.length>0},e.prototype.checkMovesAfterShuffle=function(){if(this._needUpdateColor=!0,this._updateColorBoard(),this._matchHandler.updatePossibleMoves(),this.hasPossibleMoves())return!0;var t=this._matchHandler.getAllMatches(e.MATCH_PATTERN_ALL);return t.length>0},e.prototype.getSpecialElements=function(){for(var e=[],t=0;t<this._boardCols;t++)for(var i=0;i<this._boardRows;i++)if(!this.isStaticCell(t,i)){var n=this._elementBoard[i][t];n&&n.canBeDestroyed()&&n.isActiveInLastExplode()&&e.push(n)}return e},e.prototype.getTopRankedPossibleMove=function(){return this._matchHandler.getTopRankedPossibleMove()},e.prototype.getRandomPossibleMove=function(){return this._matchHandler.getRandomPossibleMove()},e.prototype.random=function(e,t){return this._randomHandler.nextInt(e,t)},e.prototype.randomForChecking=function(e,t){return this._randomHandlerForChecking.nextInt(e,t)},e.prototype.randomDouble=function(){return this._randomHandler.nextDouble()},e.prototype.getRandomSeed=function(){return this._randomHandler.getSeed()},e.prototype.getRandomNormalElement=function(){for(var e=this.getAllElements(),t=[],i=0;i<e.length;i++){var n=e[i];!n.locked&&ElementTypeConstants.NORMAL_ELEMENTS.indexOf(n.type)>-1&&t.push(n)}if(0!=t.length){var o;return o=t[this.random(0,t.length-1)]}},e.prototype.getNormalElementLengthForWand=function(){for(var e=this.getAllElements(),t=0,i=0;i<e.length;i++){var n=e[i];ElementTypeConstants.NORMAL_ELEMENTS.indexOf(n.type)>-1&&t++}return t},e.prototype.getGridContainerAt=function(e,t){var i=this.getElementAtGrid(e,t),n=this.getBlockerAtGrid(e,t);return void 0!=i||void 0!=n?new GridContainer(e,t,i,n):void 0},e.prototype.hasLeafAtGrid=function(e,t){return this._LeafFacade?this._LeafFacade.getNumLayersAtGrid(e,t)>0:!1},e.prototype.getLeafFacade=function(){return this._LeafFacade},e.prototype.getBlockersOfType=function(e){for(var t=[],i=0,n=this._allBlockers;i<n.length;i++){var o=n[i];o.type==e&&t.push(o)}return t},e.prototype.getElementsOfType=function(e){for(var t=[],i=0,n=this._allElements;i<n.length;i++){var o=n[i];o.type==e&&t.push(o)}return t},e.prototype.getGameMode=function(){return this._gameMode},e.prototype.getGameConf=function(){return this._gameConf},e.prototype.removeLock=function(e){if(e&&e.isLocked()&&e.getLock().type!=LOCK_TYPE.GIFT_WRAPPER){for(var t=e.getLock();e.isLocked();)e.breakLock();this._fallingHandler.rebuildPathByCol(e.col),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,t)}},e.prototype.onGuideComplete=function(){this.setPregameItemOnBoard()},e.prototype.createNewBlockerAt=function(e,t,i,n,o){void 0===n&&(n=1);var a=this._blockerFactory.create(e,t,i,n);return o&&(a.isCreatedByColorMixer=!0),this._blockerBoard[t][e]=a,this.addBlockerToBoard(a),a},e.prototype.dispose=function(){for(var e=0,t=this._generatorHandlers;e<t.length;e++){var i=t[e];i&&i.dispose()}this._portalHandler.dispose(),this._specialDropsHandler&&this._specialDropsHandler.dispose(),this._pregameItemManager.dispose(),this._goldEggManager&&this._goldEggManager.dispose(),this.isStabilityUpdating=void 0},e.prototype.isRecovered=function(){return this._isRecovered},e.prototype.saveToJson=function(){0==xyd.isApp&&this._boardSave.saveToJson()},e.prototype.getItemUsedCount=function(){return this._itemUsedCount},e.prototype.setItemUsedCount=function(e){if(this._itemUsedCount=[],e)if(0==e.length)for(var t=0;t<xyd.MAX_ITEM_USED_COUNT;t++)this._itemUsedCount.push(0);else for(var t=0;t<e.length;t++)this._itemUsedCount.push(e[t])},e.prototype.increaseItemUsedCount=function(e){!this._itemUsedCount||e>=this._itemUsedCount.length||this._itemUsedCount[e]++},e.prototype._recoverTimeBomb=function(){if(this._timeBombSave)for(var e in this._timeBombSave){var t=Number(e);if(void 0!=t){var i=t%10,n=Math.floor(t/10),o=this.getElementAtGrid(i,n),a=o;o&&a.setTicksToExplode&&a.setTicksToExplode(this._timeBombSave[t])}}},e.prototype.setTimeBomb=function(e){this._timeBombSave=e},e.prototype.setIsStabilityUpdating=function(e){e&&(this.isStabilityUpdating=e)},e.prototype.getNextDropElementType=function(){for(var e=[],t=0;t<this._nextDropElementType.length;t++)e.push(this._nextDropElementType[t]);return e},e.prototype.setSaveNextDropElementType=function(e){e&&(this._nextDropElementType=e)},e.prototype._checkMatchCombo=function(){if(!(this._scoreFactor<MatchComboConstants.GOOD_NUM)){var e=MatchComboConstants.TYPE_GOOD;this._scoreFactor>=MatchComboConstants.FANTASTIC_NUM?e=MatchComboConstants.TYPE_FANTASTIC:this._scoreFactor>=MatchComboConstants.WONDERFUL_NUM?e=MatchComboConstants.TYPE_WONDERFUL:this._scoreFactor>=MatchComboConstants.GREAT_NUM?e=MatchComboConstants.TYPE_GREAT:this._scoreFactor>=MatchComboConstants.GOOD_NUM&&(e=MatchComboConstants.TYPE_GOOD),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.MATCH_COMBO_EFFECT,!0,!1,e))}},e.prototype.calculateSkipScore=function(){var e,t=this._gameMode.getMovesLeft();e=t>0?Math.ceil(Math.pow(t,.85)):this.getElementsOfType(ElementTypeConstants.BOMB_COL).length+this.getElementsOfType(ElementTypeConstants.BOMB_ROW).length,this.addScore(e*ScoreConstants.SPEICAL_ELEMENT+8*ScoreConstants.ELEMENET_IN_DP_LINE)},e.prototype.getCollectNum=function(e){return this._gameMode.getCollectNum(e)},e.prototype.getIngameItemList=function(){return this._gameConf.ingameItemList},e.prototype.setLastExplodeState=function(e){this._inLastExplodeState=e},e.prototype.getLastExplodeState=function(){return this._inLastExplodeState},e.prototype.getActiveItemList=function(){for(var e=[],t=0;t<this._activeItemList.length;t++)e.push(this._activeItemList[t]);return e},e.prototype.replaceTo=function(e){var t=this.getGridContainerAt(e.col,e.row);t&&(t.hasElement()?this.replaceBoardElement(e,!0):t.hasBlocker()&&this.replaceBlockerToElement(e))},e.prototype.setWandState=function(e){this._inWandState=e},e.prototype.isBeltMoving=function(){return this._beltMoving},e.prototype.setBeltMoving=function(e){this._beltMoving=e},e.prototype.hitEmptyCell=function(e,t){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_EMPTY_CELL,!1,{col:e,row:t})},e.prototype.getGeneratorAt=function(e,t){return this._generatorsBoard[t][e]},e.prototype.switchMoveTime=function(){platform.inAutoMode()?this._SHOW_POSSIBLE_MOVE_FRAMES=Math.floor(20*xyd.frameScale):this._SHOW_POSSIBLE_MOVE_FRAMES=Math.floor(79*xyd.frameScale)},Object.defineProperty(e.prototype,"colorMixerHandler",{get:function(){return this._colorMixerHandler},set:function(e){this._colorMixerHandler=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedToHaveColorMixer",{get:function(){return this._usedToHaveColorMixer},set:function(e){this._usedToHaveColorMixer=e},enumerable:!0,configurable:!0}),e.prototype.checkHasCellStone=function(){for(var e=0,t=this._boardRows;t>e;e++)for(var i=0,n=this._boardCols;n>i;i++){var o=this._cellMap[e][i];if(o.hasProperty(CellConstants.SLATE))return!0}return!1},e.prototype.setSavedAvailableColors=function(e){this._boardElementFactory.setAvailableColors(e)},e.prototype.needCreateSpecialDrop=function(){return this._canSpecialDrop&&!this._inLastExplodeState&&this._specialDropsHandler&&this._specialDropsHandler.needCreateSpecialDrop()},e.prototype.getSpecialDropHandler=function(){return this._specialDropsHandler},e.MAX_RESHUFFLES=15,e.MATCH_PATTERN_3=[new MatchPattern(MatchConstants.MATCH_3,3,1,1)],e.MATCH_PATTERN_ALL=[new MatchPattern(MatchConstants.MATCH_5,5,1,1),new MatchPattern(MatchConstants.MATCH_L,3,3,0),new MatchPattern(MatchConstants.MATCH_4,4,1,1),new MatchPattern(MatchConstants.MATCH_3,3,1,1)],e}();__reflect(Board.prototype,"Board",["IBoard"]);var BoardDispatcher=function(){function e(){this._subscribers=[]}return e.prototype.subscribe=function(e){this._subscribers.push(e)},e.prototype.addElement=function(e,t,i){for(var n in this._subscribers)this._subscribers[n].addElement(e,t,i)},e.prototype.removeElement=function(e,t,i){for(var n in this._subscribers)this._subscribers[n].removeElement(e,t,i)},e.prototype.swapMade=function(){for(var e in this._subscribers)this._subscribers[e].swapMade()},e}();__reflect(BoardDispatcher.prototype,"BoardDispatcher");var BoardSave=function(){function e(e,t){this._gameConf=e,this._board=t}return e.prototype.saveToJson=function(){this._scoreHandler=this._board.getScoreHandler(),this._gameMode=this._board.getGameMode(),this._allElements=this._board.getAllElements(),this._allBlockers=this._board.getAllBlockers(),this._cellMap=this._board.getCellMap(),this._specialDropHandler=this._board.getSpecialDropHandler();for(var e=CellUtils.generateEmptyCellMap(),t={},i={},n=0;n<this._allBlockers.length;n++){var o=this._allBlockers[n];if(this._board.isValidGridPos(o.col,o.row)){var a=e[o.row][o.col];if(o.dataToCell(a),o.type==BlockerConstant.CLOUD_ROCKET){var s=o;i.saveRocket={key:10*o.row+o.col,type:s.rocketType,state:s.rocketState,color:s.color,remainCapacity:s.remainCapacity}}if(o.type==BlockerConstant.COLOR_MIXER){i.saveMixer=this._board.colorMixerHandler.counterSaveToJson()}if(o.isLocked()){var r=o.getLock();r.dataToCell(a)}}}for(var n=0;n<this._allElements.length;n++){var o=this._allElements[n];if(this._board.isValidGridPos(o.col,o.row)){var a=e[o.row][o.col];if(o.dataToCell(a),o.type==ElementTypeConstants.TIME_BOMB){var l=o,_=l.getTicksToExplode();t[10*o.row+o.col]=_}if(o.type==ElementTypeConstants.ROCKET){var s=o;i.saveRocket={key:10*o.row+o.col,type:s.rocketType,state:s.rocketState,remainCapacity:s.remainCapacity}}if(o.isLocked()){var r=o.getLock();r.dataToCell(a)}}}for(var h=0;9>h;h++)for(var c=0;9>c;c++){var d=this._cellMap[h][c],p=e[h][c];d.hasProperty(CellConstants.ELEMENET_GENERATOR)&&p.setProperty(CellConstants.ELEMENET_GENERATOR),d.hasProperty(CellConstants.LAMP_OUT)&&p.setProperty(CellConstants.LAMP_OUT);for(var n=CellConstants.PORTAL;n<=CellConstants.PORTAL_VISIBLE_EXIT_POINT;n++)d.hasProperty(n)&&p.setProperty(n);for(var n=0;n<CellConstants.GENERATOR_SET.length;n++)d.hasProperty(CellConstants.GENERATOR_SET[n])&&p.setProperty(CellConstants.GENERATOR_SET[n]);d.hasProperty(CellConstants.EMPTY)&&p.setProperty(CellConstants.EMPTY),d.isEmpty()||p.setProperty(CellConstants.EMPTY)}i.pluginData=this._gameMode.getSaveData(e);for(var u=[],h=0;9>h;h++){for(var m=[],c=0;9>c;c++){var a=e[h][c],g=a.propertiesToString();m.push(g)}u.push(m)}i.cellMap=u,i.totalLevel=this._gameConf.totalLevel,i.saveMovesLeft=this._gameMode.getMovesLeft(),i.saveMovesUsed=this._gameMode.getMovesUsed(),i.saveScore=this._scoreHandler.getScore(),i.saveScoreTarget=this._scoreHandler.getScoreTarget(),i.itemUsedCount=this._board.getItemUsedCount(),i.seed=this._board.getRandomSeed(),i.timeBomb=t,i.nextDropElementType=this._board.getNextDropElementType(),i.activeItemList=this._board.getActiveItemList(),i.ver=xyd.SAVE_DATA_VER,i.saveTime=(new Date).getTime(),i.availableColors=this._board.getElementFactory().getAvailableColors(),i.enterLinkType=SelfInfo.get().enterLinkType,SelfInfo.get().isInMission&&(i.mission_info={mission_id:SelfInfo.get().missionID,mission_level:SelfInfo.get().missionLevel,item_lock:SelfInfo.get().missionItemLock}),this._specialDropHandler&&(i.fundTotal=this._specialDropHandler.getMaxCollectNum(),i.fundOnBoard=this._specialDropHandler.getSpecialEleNum());var f=!1;for(var y in t)0==t[y]&&(f=!0);return f?void platform.callMethod("SAVE_GAME",{}):void platform.callMethod("SAVE_GAME",i)},e}();__reflect(BoardSave.prototype,"BoardSave");var DamageSource=function(){function e(){}return e.MATCH=1,e.WAND=2,e.PUZZLE=3,e.CLOUD=4,e.REFUEL_TO_ROCKET=5,e.LINE=6,e.ADJACENT_MATCH=7,e.COLOR_COLOR=8,e.SQUARE=9,e.LINE_LINE=10,e.LINE_SQUARE=11,e.SQUARE_SQUARE=12,e.COLOR_MIXER_EXPLODE=13,e}();__reflect(DamageSource.prototype,"DamageSource");var SpecialDropHandler=function(){function e(e,t,i){void 0===t&&(t=3),void 0===i&&(i=1e4),this._maxCollectNum=1e4,this._preGenNum=3,this._board=e,this._specialDrop=!1,this._specialEleNum=0,this._preGenNum=t,this._collectedEleNum=0,this._maxCollectNum=i,this.setEvent()}return e.prototype.setEvent=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_COLLECT_COIN,this._collectCoin,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_COIN,this._removeCoin,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_ADD_COIN,this._addCoin,this)},e.prototype._collectCoin=function(e){this._collectedEleNum=this._collectedEleNum+1},e.prototype._addCoin=function(e){this._specialEleNum=this._specialEleNum+1},e.prototype._removeCoin=function(e){this._specialEleNum=this._specialEleNum-1},e.prototype.setSpecialDrop=function(e){this._specialDrop=e},e.prototype.getPreGenNum=function(){return this._preGenNum},e.prototype.getSpecialEleNum=function(){return this._specialEleNum},e.prototype.setCollectedEleNum=function(e){this._collectedEleNum=e},e.prototype.getCollectedEleNum=function(){return this._collectedEleNum},e.prototype.getMaxCollectNum=function(){return this._maxCollectNum},e.prototype.needCreateSpecialDrop=function(){var t=this._specialDrop&&this._specialEleNum<e.MAXSPECIALNUM&&Math.floor(xyd.random(0,100))<10&&this._collectedEleNum+this._specialEleNum<this._maxCollectNum;return t&&(this._specialEleNum=this._specialEleNum+1),t},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_COLLECT_COIN,this._collectCoin,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_COIN,this._removeCoin,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_ADD_COIN,this._addCoin,this)},Object.defineProperty(e.prototype,"specialDrop",{get:function(){return this._specialDrop},enumerable:!0,configurable:!0}),e.MAXSPECIALNUM=100,e}();__reflect(SpecialDropHandler.prototype,"SpecialDropHandler");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BlockerFactory=function(){function e(){this._maxID=1}return e.prototype.getBlockerFromCell=function(e,t,i){var n=void 0;if(e.hasProperty(CellConstants.SLATE))n=new Slate(t,i);else if(e.hasProperty(CellConstants.CLOUD))n=new Cloud(t,i);else if(e.hasProperty(CellConstants.LAYED_SLATE_1))n=new LayedSlate(t,i,1);else if(e.hasProperty(CellConstants.LAYED_SLATE_2))n=new LayedSlate(t,i,2);else if(e.hasProperty(CellConstants.LAYED_SLATE_3))n=new LayedSlate(t,i,3);else if(e.hasProperty(CellConstants.LAYED_SLATE_4))n=new LayedSlate(t,i,4);else if(e.hasProperty(CellConstants.LAYED_SLATE_5))n=new LayedSlate(t,i,5);else if(e.hasProperty(CellConstants.CLOUD_MAKER))n=new CloudMaker(t,i);else if(e.hasProperty(CellConstants.PUZZLE))n=new PuzzleTile(t,i,3);else if(e.hasProperty(CellConstants.PUZZLE_1))n=new PuzzleTile(t,i,1);else if(e.hasProperty(CellConstants.PUZZLE_2))n=new PuzzleTile(t,i,2);else if(e.hasProperty(CellConstants.PUZZLE_3))n=new PuzzleTile(t,i,3);else if(e.hasProperty(CellConstants.CLOUD_ROCKET))n=new CloudRocket(t,i);else if(e.hasProperty(CellConstants.SNOW_1))n=new Snow(t,i,1);else if(e.hasProperty(CellConstants.SNOW_2))n=new Snow(t,i,2);else if(e.hasProperty(CellConstants.SNOW_3))n=new Snow(t,i,3);else if(e.hasProperty(CellConstants.COLOR_MIXER_1))n=new ColorMixer(t,i,1);else if(e.hasProperty(CellConstants.COLOR_MIXER_2))n=new ColorMixer(t,i,2);else if(e.hasProperty(CellConstants.COLOR_MIXER_3))n=new ColorMixer(t,i,3);else if(e.hasProperty(CellConstants.COLOR_MIXER_4))n=new ColorMixer(t,i,4);else if(e.hasProperty(CellConstants.COLOR_MIXER_5))n=new ColorMixer(t,i,5);else{if(!e.hasProperty(CellConstants.FAN))return;n=new FanBlocker(t,i)}return n.id=++this._maxID,n},e.prototype.getFenceByDirFromCell=function(e,t,i,n){var o=void 0;if(n==CellEdgesDirection.UP)if(e.hasProperty(CellConstants.FENCE_UP))o=new Fence(t,i,CellEdgesDirection.UP);else if(e.hasProperty(CellConstants.CURLS_UP_1))o=new Curls(t,i,1,CellEdgesDirection.UP);else if(e.hasProperty(CellConstants.CURLS_UP_2))o=new Curls(t,i,2,CellEdgesDirection.UP);else{if(!e.hasProperty(CellConstants.CURLS_UP_3))return;o=new Curls(t,i,3,CellEdgesDirection.UP)}else if(n==CellEdgesDirection.DOWN)if(e.hasProperty(CellConstants.FENCE_DOWN))o=new Fence(t,i,CellEdgesDirection.DOWN);else if(e.hasProperty(CellConstants.CURLS_DOWN_1))o=new Curls(t,i,1,CellEdgesDirection.DOWN);else if(e.hasProperty(CellConstants.CURLS_DOWN_2))o=new Curls(t,i,2,CellEdgesDirection.DOWN);else{if(!e.hasProperty(CellConstants.CURLS_DOWN_3))return;o=new Curls(t,i,3,CellEdgesDirection.DOWN)}else if(n==CellEdgesDirection.LEFT)if(e.hasProperty(CellConstants.FENCE_LEFT))o=new Fence(t,i,CellEdgesDirection.LEFT);else if(e.hasProperty(CellConstants.CURLS_LEFT_1))o=new Curls(t,i,1,CellEdgesDirection.LEFT);else if(e.hasProperty(CellConstants.CURLS_LEFT_2))o=new Curls(t,i,2,CellEdgesDirection.LEFT);else{if(!e.hasProperty(CellConstants.CURLS_LEFT_3))return;o=new Curls(t,i,3,CellEdgesDirection.LEFT)}else{if(n!=CellEdgesDirection.RIGHT)return;if(e.hasProperty(CellConstants.FENCE_RIGHT))o=new Fence(t,i,CellEdgesDirection.RIGHT);else if(e.hasProperty(CellConstants.CURLS_RIGHT_1))o=new Curls(t,i,1,CellEdgesDirection.RIGHT);else if(e.hasProperty(CellConstants.CURLS_RIGHT_2))o=new Curls(t,i,2,CellEdgesDirection.RIGHT);else{if(!e.hasProperty(CellConstants.CURLS_RIGHT_3))return;o=new Curls(t,i,3,CellEdgesDirection.RIGHT)}}return o.id=++this._maxID,o},e.prototype.create=function(e,t,i,n){void 0===n&&(n=1);var o=void 0;switch(i){case BlockerConstant.SLATE:o=new Slate(e,t);break;case BlockerConstant.CLOUD:o=new Cloud(e,t);break;case BlockerConstant.CLOUD_ROCKET:o=new CloudRocket(e,t);break;case BlockerConstant.SNOW:o=new Snow(e,t,n);break;case BlockerConstant.LAYED_SLATE:o=new LayedSlate(e,t,n)}return o},e}();__reflect(BlockerFactory.prototype,"BlockerFactory",["IBlockerFactory"]);var GiftWrapper=function(e){function t(t,i){var n=e.call(this,t)||this;return n._type=t,n._row=0,n._col=0,n._health=i,n}return __extends(t,e),t.prototype["break"]=function(){},t.prototype.cutGiftWrapper=function(){this._health-=1,this._health>0&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_LOCK,!1,this)},t}(Lock);__reflect(GiftWrapper.prototype,"GiftWrapper");var LayedSlate=function(e){function t(t,i,n){var o=e.call(this,t,i,BlockerConstant.LAYED_SLATE)||this;return o._health=n,o}return __extends(t,e),t}(Blocker);__reflect(LayedSlate.prototype,"LayedSlate");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LockFactory=function(){function e(){this._maxID=1,this._lockPool={}}return e.prototype.create=function(e,t){var i;return i=e==LOCK_TYPE.GIFT_WRAPPER?new GiftWrapper(e,t):new Lock(e),i.id=this._maxID,this._lockPool[i.id]=i,this._maxID++,i},e}();__reflect(LockFactory.prototype,"LockFactory",["ILockFactory"]);var Slate=function(e){function t(t,i){return e.call(this,t,i,BlockerConstant.SLATE)||this}return __extends(t,e),t}(Blocker);__reflect(Slate.prototype,"Slate");var BeltCell=function(){function e(e,t,i,n,o,a){this._isPortal=!1,this._preBeltCell=void 0,this._nextBeltCell=void 0,this._x=e,this._y=t,this._direction=o,this._targetX=i,this._targetY=n,this._portalType=a,0!=this._portalType&&(this._isPortal=!0,this._initPortal())}return e.prototype._initPortal=function(){switch(this.getTarget().equals(this._getNext())?this._portalInOrOut=BeltConstants.PORTAL_OUT:this._portalInOrOut=BeltConstants.PORTAL_IN,this._direction){case BeltConstants.DOWN:this._portalInOrOut==BeltConstants.PORTAL_OUT?this._portalOpenDirection=BeltConstants.UP:this._portalOpenDirection=BeltConstants.DOWN;break;case BeltConstants.UP:this._portalInOrOut==BeltConstants.PORTAL_OUT?this._portalOpenDirection=BeltConstants.DOWN:this._portalOpenDirection=BeltConstants.UP;break;case BeltConstants.LEFT:this._portalInOrOut==BeltConstants.PORTAL_OUT?this._portalOpenDirection=BeltConstants.RIGHT:this._portalOpenDirection=BeltConstants.LEFT;break;case BeltConstants.RIGHT:this._portalInOrOut==BeltConstants.PORTAL_OUT?this._portalOpenDirection=BeltConstants.LEFT:this._portalOpenDirection=BeltConstants.RIGHT}},e.prototype.getPosition=function(){return new egret.Point(this._x,this._y)},e.prototype.getTarget=function(){return new egret.Point(this._targetX,this._targetY)},e.prototype.getDirection=function(){return this._direction},e.prototype.getPortalType=function(){return this._portalType},e.prototype.getOpposite=function(){var e=this._x-BeltConstants.DX[this._direction],t=this._y-BeltConstants.DY[this._direction];return new egret.Point(e,t)},e.prototype._getNext=function(){var e=this._x+BeltConstants.DX[this._direction],t=this._y+BeltConstants.DY[this._direction];return new egret.Point(e,t)},e.prototype._getDistant=function(){return Math.abs(this._x-this._targetX)+Math.abs(this._y-this._targetY)},e.prototype.isNeedTeleport=function(){return this._getDistant()>1?!0:this.getTarget().equals(this.getOpposite())?!0:!1},e.prototype.getPortalOpenDirection=function(){return this._portalOpenDirection},e.prototype.getPortalInOrOut=function(){return this._portalInOrOut},e.prototype.getIsPortal=function(){return this._isPortal},Object.defineProperty(e.prototype,"preBeltCell",{get:function(){return this._preBeltCell},set:function(e){this._preBeltCell=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextBeltCell",{get:function(){return this._nextBeltCell},set:function(e){this._nextBeltCell=e},enumerable:!0,configurable:!0}),e}();__reflect(BeltCell.prototype,"BeltCell",["IBeltCell"]);var BeltUtils=function(){function e(){}return e.generateBeltFromArrays=function(e){for(var t=[],i={},n=0,o=e;n<o.length;n++){var a=o[n],s=new BeltCell(a[0],a[1],a[2],a[3],a[4],a[5]),r=a[0]+10*a[1];i[r]=s,t.push(s)}for(var r in i){var s=i[r],l=s.getTarget(),_=l.x+10*l.y,h=i[_];h&&(s.nextBeltCell=h,h.preBeltCell=s)}return t},e}();__reflect(BeltUtils.prototype,"BeltUtils");var DebugData=function(){function e(e){this._gems=0,this._currentLevel=0,this._monthlyCardLevel=0,this._stamina=0,this._lastCookingLevel=0,this._records=[],this._items={},this._setting={soundBg:!0,soundEfx:!0,strongReminder:!0},this._gatherTaskData={},this._leaderboardInfo=[],this._clearStreak=0,this._balance=Math.floor(100*Math.random()),this._friendsRanking={},this._sendList={},this._staminaStatus={},this._monthCardInfo={},this._monthCardRewards={},this._monthCardTasks={},this._monthCardRankInfo=[],this._stars=xyd.STAR,this._levelScoreRankInfo={},this._rankSelfData={},this._monthcardRankSelfData={},this._friendHomeList=[],this.spring_level_info={},this._debug_icons=["icon_tiezhi_png","icon_teshuqizi_png","icon_longjuanfengqing_png"],this._debug_names=["王三","赵四","孙二","李一","超级长的名字周八很长很长很长很长很长","吴无","六六\n\n\n\n\n\n\n","YYE"],this._questFinishedTimeList=[],this._questRewards=[],this._fundsAmount=0,this._fundsTime=Math.floor((new Date).getTime()/1e3)+1987200,this._ABTestInfo=e,this._gems=1e3,this._stamina=3,this._lastCookingLevel=0,this._currentLevel=xyd.TEST_LEVEL;for(var t=["1001","1004","1005","1006","1007","1008","1018","1019","1020"],i=0,n=t;i<n.length;i++){var o=n[i];this._addItem(o,Math.floor(5*Math.random()))}for(var a=["2001","2004","2005","2006","2007","2008","2018","2019","2020"],s=Math.floor((new Date).getTime()/1e3),r=0,l=a;r<l.length;r++){var o=l[r],_=Math.floor(3*Math.random()),h=void 0;if(_>0){h=[];for(var c=0;_>c;c++)s+=xyd.random(60,360),h.push(s)}this._addItem(o,_,h)}for(var d=["1001","1006","1003","1002","1017"],p=0,u=d;p<u.length;p++){var o=u[p];this._addItem(o,2)}for(var m=["3001","3002","3003","3004","3005","3006","3007","3008","3017"],g=0,f=m;g<f.length;g++){var o=f[g],h=[],y=Math.floor((new Date).getTime()/1e3);y+=xyd.random(60,360),h.push(y),this._addItem(o,1,h)}this._gatherTaskData={target_item:1001003,packet_status:[2,1,0],packet_score:[1500,3e3,5e3],gathered_num:3845,next_num:5e3,total_num:5e3,end_time:Math.floor((new Date).getTime()/1e3)+36e3,has_extra_reward:!0,self_index:1,rank_data:[{rank:1,nickname:"张宇",avatar:"",gathered_num:1290},{rank:2,nickname:"魏璐路",avatar:"",gathered_num:665},{rank:3,nickname:"独守空房",avatar:"",gathered_num:650},{rank:4,nickname:"逻辑福克斯",avatar:"",gathered_num:490},{rank:5,nickname:"琳琳1\n\n\n\n\n\n",avatar:"",gathered_num:420},{rank:6,nickname:"上栗是1",avatar:"",gathered_num:330},{rank:7,nickname:"琳琳2",avatar:"",gathered_num:420},{rank:8,nickname:"上栗是2",avatar:"",gathered_num:330},{rank:9,nickname:"琳琳3",avatar:"",gathered_num:420},{rank:10,nickname:"上栗是3",avatar:"",gathered_num:330},{rank:11,nickname:"琳琳4",avatar:"",gathered_num:420},{rank:12,nickname:"上栗是4",avatar:"",gathered_num:330},{rank:13,nickname:"琳琳5",avatar:"",gathered_num:420},{rank:14,nickname:"上栗是5",avatar:"",gathered_num:330},{rank:15,nickname:"琳琳6",avatar:"",gathered_num:420},{rank:16,nickname:"上栗是6",avatar:"",gathered_num:330},{rank:17,nickname:"琳琳7",avatar:"",gathered_num:420},{rank:18,nickname:"上栗是7",avatar:"",gathered_num:330}]};
for(var c=(Math.random(),1);52>=c;c++){var E={rank:c,nickname:this._debug_names[c%7],avatar:this._debug_icons[c%3],uin:"100"+c,stars:4999-c,level:995+c,can_send_stamina:!0};this._leaderboardInfo.push(E)}this._rankSelfData=this._leaderboardInfo[Math.floor(Math.random()*this._leaderboardInfo.length)],this._friendsRanking={rank_data:[{nickname:"王三",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"王三",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"王三",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"丽丽",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"XXXX",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"超级心心心人",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试1",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试2",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试3",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"我自己的头像",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试4",avatar:"icon_tiezhi_png",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试5",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试6",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试7",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试8",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试9",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试10",avatar:"",level:xyd.random(1,xyd.MAX_STAGE)},{nickname:"测试11",avatar:"icon_teshuqizi_png",level:xyd.random(1,xyd.MAX_STAGE)}]},this._sendList={success:!0,send_list:[{rank:4,nickname:"超级心心心人",avatar:"",uin:"1004",stars:999,level:999,can_send_stamina:!0},{rank:5,nickname:"测试1",avatar:"",uin:"1005",stars:999,level:999,can_send_stamina:!0},{rank:6,nickname:"测试2",avatar:"",uin:"1006",stars:999,level:999,can_send_stamina:!0},{rank:7,nickname:"测试3",avatar:"",uin:"1007",stars:999,level:999,can_send_stamina:!0},{rank:9,nickname:"测试4",avatar:"",uin:"1009",stars:999,level:999,can_send_stamina:!0}]},this._staminaStatus={received_num:1,received_list:[{rank:4,nickname:"超级心心心人",avatar:"",uin:"1004",stars:999,level:999,can_send_stamina:!0},{rank:5,nickname:"测试1",avatar:"",uin:"1005",stars:999,level:999,can_send_stamina:!0},{rank:6,nickname:"测试2",avatar:"",uin:"1006",stars:999,level:999,can_send_stamina:!0},{rank:7,nickname:"测试3",avatar:"",uin:"1007",stars:999,level:999,can_send_stamina:!0},{rank:9,nickname:"测试4",avatar:"",uin:"1009",stars:999,level:999,can_send_stamina:!0}]},this._monthCardInfo={level:20,reward_level:18,current_exp:1e3,upgrade_exp:1e4,end_time:1551715200,purchased:!1,show_privilege_guide:!1,current_week:2},this._monthCardRewards={rewards:{1:[{item_id:"1=1002",num:10,free:!0,status:1},{item_id:"2=1004",num:100,free:!1,status:1}],2:[{item_id:"2=1001",num:10,free:!1,status:1},{item_id:"2=1014",num:10,free:!1,status:1}],3:[{item_id:"1=1003",num:10,free:!0,status:2},{item_id:"2=1015",num:10,free:!1,status:2},{item_id:"2=1012",num:10,free:!1,status:2}],4:[{item_id:"2=1001",num:1,free:!0,status:1}]}};for(var c=5;50>=c;c++){var v=c%4+1;this._monthCardRewards.rewards[c]=[];for(var T=0,C=this._monthCardRewards.rewards[v];T<C.length;T++){var L=C[T],b={};b.item_id=L.item_id,b.num=L.num,b.free=L.free,b.status=L.status,this._monthCardRewards.rewards[c].push(b)}}this._monthCardTasks=(S={},S[1]=[{task_id:"1001",exp:5,current_count:0,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"www"},{task_id:"1002",exp:10,current_count:0,total_count:1e3,difficulty:1,desc:"收集1000个草莓",img_url:"icon_fengche_png"},{task_id:"1003",exp:20,current_count:0,total_count:100,difficulty:2,desc:"收集100个草地",img_url:"ele_purple_png"},{task_id:"1004",exp:5,current_count:7,total_count:10,difficulty:0,desc:"收集10个风车横条交换",img_url:"icon_fengche_png"},{task_id:"1005",exp:150,current_count:500,total_count:1e3,difficulty:1,desc:"收集1000个葡萄",img_url:"ele_purple_png"},{task_id:"1006",exp:5,current_count:3,total_count:5,difficulty:2,desc:"收集5个风车风车交换",img_url:"icon_fengche_png"}],S[2]=[{task_id:"1001",exp:5,current_count:0,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"icon_fengche_png"},{task_id:"1001",exp:5,current_count:20,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"ele_purple_png"},{task_id:"1001",exp:5,current_count:30,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"icon_fengche_png"},{task_id:"1001",exp:5,current_count:9,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"ele_purple_png"},{task_id:"1001",exp:5,current_count:5,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"icon_fengche_png"}],S[3]=[{task_id:"1001",exp:5,current_count:0,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"icon_fengche_png"},{task_id:"1002",exp:10,current_count:0,total_count:1e3,difficulty:1,desc:"收集1000个草莓",img_url:"ele_purple_png"}],S[4]=[{task_id:"1001",exp:5,current_count:0,total_count:10,difficulty:0,desc:"收集10个风车",img_url:"icon_fengche_png"},{task_id:"1002",exp:10,current_count:0,total_count:1e3,difficulty:1,desc:"收集1000个草莓",img_url:"ele_purple_png"},{task_id:"1003",exp:20,current_count:0,total_count:100,difficulty:2,desc:"收集100个草地",img_url:"icon_fengche_png"}],S);for(var c=this._leaderboardInfo.length-1;c>=0;--c){var w=this._leaderboardInfo[c];w.monthly_card_rank=this._leaderboardInfo.length-c,w.monthly_card_level=20+c,this._monthCardRankInfo.push(w),this._rankSelfData.uin==w.uin&&(this._monthcardRankSelfData=w)}this.spring_level_info={level:999,mission_info:{mission_id:1,mission_level:2,active_item_list:[ItemConstants.COLOR_BOMB,ItemConstants.LINE_SQUARE_BOMB_PACK,ItemConstants.CRAYON,ItemConstants.LINE_BOMB],item_lock:!0}};var S}return e.prototype._addRecord=function(e,t,i,n,o,a){1==e&&(t=3),this._records.push({level:e,stars:t,score:i,packet_type:n,packet_status:o,pay_level:a})},e.prototype._addItem=function(e,t,i){this._items[e]={quantity:t,expire_time:i}},e.prototype.initRecords=function(){for(var e=1;e<this._currentLevel+20;e++){var t=(e-1)%3+1,i=Math.floor(9e3*Math.random())+1e3,n=0,o=0,a=LevelTable.get().getTableData(e);n=o=a&&a.lucky_wheel>0?1:0;var s=1==e||5==e||10==e?!0:!1;this._addRecord(e,t,i,n,o,s)}},Object.defineProperty(e.prototype,"gems",{get:function(){return this._gems},set:function(e){this._gems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stamina",{get:function(){return this._stamina},set:function(e){this._stamina=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLevel",{get:function(){return this._currentLevel},set:function(e){this._currentLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monthlyCardLevel",{get:function(){return this._monthlyCardLevel},set:function(e){this._monthlyCardLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastCookingLevel",{get:function(){return this._lastCookingLevel},set:function(e){this._lastCookingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clearStreak",{get:function(){return this._clearStreak},set:function(e){this._clearStreak=e},enumerable:!0,configurable:!0}),e.prototype.getRecords=function(){return this.records},Object.defineProperty(e.prototype,"records",{get:function(){(void 0==this._records||0==this._records.length)&&this.initRecords();for(var e=[],t=0,i=this._records;t<i.length;t++){var n=i[t];e.push({level:n.level,stars:n.stars,score:n.score,packet_type:n.packet_type,packet_status:n.packet_status,pay_level:n.pay_level})}return e},set:function(e){this._records=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setting",{get:function(){return this._setting},set:function(e){e&&(1==e.soundBg?this._setting.soundBg=!0:this._setting.soundBg=!1,1==e.soundEfx?this._setting.soundEfx=!0:this._setting.soundEfx=!1,1==e.strongReminder?this._setting.strongReminder=!0:this._setting.strongReminder=!1)},enumerable:!0,configurable:!0}),e.prototype.getItemByID=function(e){var t=this._items[e];return t},e.prototype.addItemByID=function(e,t){var i=this._items[e];return void 0==i&&(i={quantity:0,expire_time:void 0}),i.quantity+=1,void 0!=t&&(void 0==i.expire_time?i.expire_time=[t]:i.expire_time.push(t)),this._items[e]=i,i},e.prototype.useItemByID=function(e){var t=this._items[e];return"3"==e.charAt(0)?this._items[e]:(void 0==t.quantity&&(t.quantity=1),t.quantity-=1,t.expire_time&&t.expire_time.length>0&&(t.expire_time.sort(),t.expire_time.splice(0,1)),this._items[e])},Object.defineProperty(e.prototype,"gatherTaskData",{get:function(){return this._gatherTaskData},enumerable:!0,configurable:!0}),e.prototype.getQuestFinishedTime=function(){return this._questFinishedTimeList},Object.defineProperty(e.prototype,"gatherTaskInfo",{get:function(){if(void 0!=this._gatherTaskData){var e={};return e.target_item=this._gatherTaskData.target_item,e.gathered_num=this._gatherTaskData.gathered_num,e.next_num=this._gatherTaskData.next_num,e.total_num=this._gatherTaskData.total_num,e.end_time=this._gatherTaskData.end_time,e}},enumerable:!0,configurable:!0}),e.prototype.addGatherTaskTargetNum=function(e){if(this._gatherTaskData&&this._gatherTaskData.target_item==e.target_item&&e.gathered_num){var t=this._gatherTaskData.gathered_num+e.gathered_num,i=this._gatherTaskData.rank_data,n=this._gatherTaskData.self_index;i[n].gathered_num+=e.gathered_num;for(var o=this._gatherTaskData.packet_status,a=this._gatherTaskData.packet_score,s=a.length,r=0;s>r;r++)a[r]<=t&&0==o[r]&&(o[r]=1);for(var l=a[s-1],r=s-1;r>=0;r--)a[r]>t&&(l=a[r]);this._gatherTaskData.next_num=l,this._gatherTaskData.gathered_num=t}},e.prototype.claimGatherTaskPacket=function(e){var t=!1;if(e>=0){var i=void 0;this._gatherTaskData&&(i=this._gatherTaskData.packet_status),i&&e<i.length&&1==i[e]&&(i[e]=2,t=!0)}return t},e.prototype.getScoreRankForLevel=function(e,t,i){void 0==this._levelScoreRankInfo[e]&&(this._levelScoreRankInfo[e]=this._initLevelRankInfo(e));for(var n=this._levelScoreRankInfo[e],o=[],a=0,s=n;a<s.length;a++){var r=s[a];r.rank>=t&&r.rank<=i&&o.push(r)}return o},e.prototype._initLevelRankInfo=function(e){for(var t=[],i=1;200>=i;i++){var n=i,o=this._debug_names[i%this._debug_names.length],a=this._debug_icons[i%this._debug_icons.length],s=1e4+i,r=1e5-20*i;t.push({rank:n,nickname:o,avatar:a,uin:s,score:r,can_recall:Math.random()>.5,recall_diamond:i})}return t},e.prototype._getRequireLeaderboardInfo=function(e,t){for(var i=[],n=0,o=this._leaderboardInfo;n<o.length;n++){var a=o[n];a.rank>=e&&a.rank<=t&&i.push(a)}return{self_index:this._rankSelfData.rank-1,self_data:this._rankSelfData,rank_data:i,received_num:3}},e.prototype._getRequireMonthCardRewardInfo=function(e,t){var i={};i.rewards={};var n=0;for(var o in this._monthCardRewards.rewards)n++;for(var a=1;n>=a;a++)if(a>=e&&t>=a){i.rewards[a]=[];for(var s=0,r=this._monthCardRewards.rewards[a];s<r.length;s++){var l=r[s];i.rewards[a].push({item_id:l.item_id,num:l.num,free:l.free,status:l.status})}}return i},e.prototype.isAllItemsGetted=function(){for(var e in this._monthCardRewards.rewards)for(var t=this._monthCardRewards.rewards[e],i=0,n=t;i<n.length;i++){var o=n[i];if(1==o.status&&Number(t.level)<=this._monthCardInfo.level){if(o.free)return!1;if(this._monthCardInfo.purchased)return!1}}return!0},e.prototype.claimRewardData=function(e,t,i,n){if(e){var o=[];for(var a in this._monthCardRewards.rewards)for(var s=this._monthCardRewards.rewards[a],r=0,l=s;r<l.length;r++){var _=l[r];1==_.status&&(_.status=2,Number(a)<=Number(this._monthCardInfo.level)&&o.push(_))}return{success:!0,claim_all:!0,level:t,item_id:i,free:n,items:o}}for(var s=this._monthCardRewards.rewards[t],h=s,c=0,d=h;c<d.length;c++){var _=d[c];if(_.item_id==i&&1==_.status)return _.status=2,{success:!0,claim_all:!1,level:t,item_id:i,free:n,reward_level:0}}return{success:!1}},e.prototype.addStar=function(e){this._stars=this._stars+e},e.prototype.getMonthCardRankInfo=function(e,t){for(var i=[],n=0,o=this._monthCardRankInfo;n<o.length;n++){var a=o[n];a.monthly_card_rank>=e&&a.monthly_card_rank<=t&&i.push(a)}return{self_data:this._monthcardRankSelfData,rank_data:i,received_num:3}},e.prototype.getLeaderboardInfo=function(e,t){return this._getRequireLeaderboardInfo(e,t)},e.prototype.getMonthCardRewardInfo=function(e,t){return this._getRequireMonthCardRewardInfo(e,t)},e.prototype.getFriendHomeList=function(e,t){return e>this._friendHomeList.length?{home_list:null}:(0>e-1&&(e=0),t>this._friendHomeList.length&&(t=this._friendHomeList.length),{home_list:this._friendHomeList.slice(e-1,t)})},e.prototype.getPreGameShowGoodsInfo=function(){var e=2,t=30,i=1e4,n={goods_id:123,brief_name:"",img_url:"icon_longjuanfengqing_png"},o={phase:1,progress:3333.73},a=[{mission_id:1011,mission_name:"",icon:"",description:"每日登录领金币",mission_target:0,completed_times:0,total_times:1,reward_list:[{type:1,id:1004,count:100,name:"金币",description:"",icon:""}],tracker_param:""},{mission_id:1012,mission_name:"22222222222222222222222222222",icon:"",description:"",mission_target:0,completed_times:0,total_times:1,reward_list:[{type:1,id:1004,count:30,name:"金币",description:"",icon:""}],tracker_param:""},{mission_id:1013,mission_name:"333333333333333333333333",icon:"",description:"",mission_target:0,completed_times:0,total_times:1,reward_list:[{type:1,id:1004,count:56678,name:"金币",description:"",icon:""}],tracker_param:""},{mission_id:1014,mission_name:"444444444444444444444444444444",icon:"",description:"",mission_target:0,completed_times:0,total_times:1,reward_list:[{type:1,id:1004,count:1e3,name:"金币",description:"",icon:""}],tracker_param:""},{mission_id:1015,mission_name:"55555555555555555555555555555555",icon:"non_k_5_png",description:"",mission_target:0,completed_times:0,total_times:1,reward_list:[{type:1,id:1004,count:100,name:"金币",description:"",icon:""}],tracker_param:""}];return{status:e,current_coin:t,target_coin:i,goods_info:n,phase_info:o,mission_list:a}},e.prototype.getVipInfo=function(){var e=2,t=4,i=5,n=24,o=60,a=10,s=123123,r=123123;return{status:e,level:t,max_level:i,cur_exp:n,next_level_exp:o,uplevel_stage:a,expire_at:s,renew_expire_at:r}},e.prototype.getBalance=function(){return this._balance},e.prototype.setBalance=function(e){this._balance=e},e.prototype.getFriendsRanking=function(){return this._friendsRanking},e.prototype.getSendList=function(){return this._sendList},e.prototype.getStaminaInfo=function(){return this._staminaStatus},Object.defineProperty(e.prototype,"onBack",{get:function(){return this._onBack},set:function(e){this._onBack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monthCardInfo",{get:function(){return this._monthCardInfo},set:function(e){this._monthCardInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monthCardRewards",{get:function(){return this._monthCardRewards},set:function(e){this._monthCardRewards=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monthCardTasks",{get:function(){return this._monthCardTasks},set:function(e){this._monthCardTasks=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"questRewards",{get:function(){return this._questRewards},enumerable:!0,configurable:!0}),e.prototype.getfundsData=function(){return{amount:this._fundsAmount,expired_at:this._fundsTime}},e.prototype.addFundsAmount=function(e){this._fundsAmount=this._fundsAmount+e},e}();__reflect(DebugData.prototype,"DebugData");var CloudMaker=function(e){function t(t,i){return e.call(this,t,i,BlockerConstant.CLOUD_MAKER)||this}return __extends(t,e),t.prototype.canBeAffectedByMatch=function(){return!1},t.prototype.canBeDestroyed=function(){return!1},t}(Blocker);__reflect(CloudMaker.prototype,"CloudMaker");var ColorMixer=function(e){function t(t,i,n){var o=e.call(this,t,i,BlockerConstant.COLOR_MIXER)||this;return o.health=n,o}return __extends(t,e),t.prototype.canBeDestroyedByItem=function(){return!0},t.prototype.prepareForRemoval=function(){this._removeFrames=65,this._busy=!0},t.UPDATE=1,t.ADD_COLOR=2,t.IDLE=0,t}(Blocker);__reflect(ColorMixer.prototype,"ColorMixer");var ColorMixerHandler=function(){function e(e){this._colorMixerElements=[],this._eleIndexOfMixer={},this._stepCntOfMixer={},this._canAddStep={},this._spawnPositions=[],this._allSpawnPos=[],this._mixersCanUpdate=[],this._numOfFrames=-1,this._inspected={},this._addedForExpand={},this._mixersBeenRemoved=!1,this._isAnyType=!1,this._dir1=[[-1,0],[1,0],[0,-1],[0,1],[1,1],[-1,-1],[1,-1],[-1,1]],this._state=ColorMixer.IDLE,this._board=e,this._initEvents();var t=this._board.getGameConf();this.colorMixerInterval=t.colorMixerInterval,this.colorMixerAmount=t.colorMixerAmount,this.colorMixerElements=t.colorMixerElements,this._isAnyType=1==this.colorMixerElements.length&&0==this.colorMixerElements[0]}return e.prototype.counterSaveToJson=function(){var e={eleIndex:this._eleIndexOfMixer,stepCnt:this._stepCntOfMixer,usedToHaveCM:this._board.usedToHaveColorMixer};return e},e.prototype.requestUpdate=function(){switch(this._state){case ColorMixer.ADD_COLOR:var e=!1;for(var t in this._stepCntOfMixer)this._canAddStep[t]&&(this._stepCntOfMixer[t]++,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.COLORMIXER_ADD_COLOR,!1,{key:t,step:this._stepCntOfMixer[t],interval:this._colorMixerInterval}),this._canAddStep[t]=!1),this._stepCntOfMixer[t]>=this._colorMixerInterval&&(e=!0);return e?(this._getAllSpawnPos(),this._setState(ColorMixer.UPDATE),!0):(this._setState(ColorMixer.IDLE),!1);case ColorMixer.UPDATE:case ColorMixer.IDLE:return!1}},e.prototype.requestWithdraw=function(){switch(this._state){case ColorMixer.IDLE:return this._numOfFrames=-1,this._inspected={},this._allSpawnPos=[],this._mixersCanUpdate=[],!0;case ColorMixer.UPDATE:return!1}},e.prototype.update=function(){switch(this._state){case ColorMixer.UPDATE:if(this._numOfFrames++,10==this._numOfFrames)for(var e=0,t=this._allSpawnPos;e<t.length;e++){var i=t[e];xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.COLORMIXER_LAUNCH,!1,{col:i.y,row:i.x})}if(this._numOfFrames==30*xyd.frameScale)for(var n=0,o=this._allSpawnPos;n<o.length;n++){var i=o[n];this._generate(i.y,i.x,i.z)}if(this._numOfFrames==35*xyd.frameScale){for(var a=0,s=this._mixersCanUpdate;a<s.length;a++){var r=s[a];this._eleIndexOfMixer[r]=(this._eleIndexOfMixer[r]+1)%this.colorMixerElements.length,this._stepCntOfMixer[r]=0,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.COLORMIXER_ADD_COLOR,!1,{key:r,step:0,interval:this._colorMixerInterval})}this._setState(ColorMixer.IDLE)}}},e.prototype._getAllSpawnPos=function(){for(var e=this._getAllValidMixer(),t=0,i=e;t<i.length;t++){var n=i[t];if(!n.isLocked()&&this._stepCntOfMixer[n.col+9*n.row]>=this.colorMixerInterval&&(this._mixersCanUpdate.push(n.col+9*n.row),this._getSpawnPos(n))){var o=Math.min(this._colorMixerAmount,this._spawnPositions.length);this._spawnPositions.sort(function(){return.5-Math.random()}),this._allSpawnPos=this._allSpawnPos.concat(this._spawnPositions.slice(0,o));for(var a=o;a<this._spawnPositions.length;a++)this._inspected[this._spawnPositions[a].y+9*this._spawnPositions[a].x]=!1}}},e.prototype._getSpawnPos=function(t){this._spawnPositions=[],this._addedForExpand={};var i=e.ELEMENTS_MAP[this.colorMixerElements[this._eleIndexOfMixer[t.col+9*t.row]]];(this._isAnyType||-1==i)&&(i=e.ELEMENTS_MAP[this._board.random(1,10)]);var n=[];return n.push(new Vector2(t.row,t.col)),this._expandSpawnPos(n,0,i,t.col+9*t.row),this._spawnPositions.length>0},e.prototype._expandSpawnPos=function(e,t,i,n){if(!(t>=e.length)){for(var o=0;o<this._dir1.length;o++){var a=e[t].y+this._dir1[o][0],s=e[t].x+this._dir1[o][1];this._notValidForInspection(a,s)||(this._canSpawnHere(a,s,i)?this._inspected[a+9*s]||(this._spawnPositions.push(new Vector3(s,a,n)),this._inspected[a+9*s]=!0):4>o&&this._addForExpand(a,s,i)&&(this._addedForExpand[a+9*s]||(this._addedForExpand[a+9*s]=!0,e.push(new Vector2(s,a)))))}return this._expandSpawnPos(e,t+1,i,n)}},e.prototype._addForExpand=function(e,t,i){var n=this._board.getElementAtGrid(e,t),o=this._board.getBlockerAtGrid(e,t);return this._isGeneratedByColorMixer(n,o)||this._isColorMixerCanGenerate(n,o)||this._isTheSameTypeAndHealth(n,o,i)},e.prototype._isGeneratedByColorMixer=function(e,t){return void 0!=e?e.isCreatedByColorMixer||e.isLocked()&&e.getLock().isCreatedByColorMixer:void 0!=t?this._isAnyType?t.isCreatedByColorMixer:t.type==BlockerConstant.LAYED_SLATE?this._isColorMixerCanGenerate(void 0,t):t.isCreatedByColorMixer:!1},e.prototype._isColorMixerCanGenerate=function(e,t){var i=TypeConverter.CELL_TO_COLORMIXER_ELEMENTS_INDEX_MAP;return void 0!=e?this._colorMixerElements.indexOf(i[TypeConverter.ELEMENT_TO_CELL_MAP[e.type]])>=0||e.isLocked()&&this._colorMixerElements.indexOf(i[TypeConverter.LOCK_TO_CELL_MAP[e.getLock().type]])>=0:void 0!=t?t.type==BlockerConstant.LAYED_SLATE?this._colorMixerElements.indexOf(t.health+2)>=0:this._colorMixerElements.indexOf(i[TypeConverter.BLOCKER_TO_CELL_MAP[t.type]])>=0:!1},e.prototype._isTheSameTypeAndHealth=function(e,t,i){switch(i){case CellConstants.TIME_BOMB:case CellConstants.BOX:return void 0!=e&&i==TypeConverter.ELEMENT_TO_CELL_MAP[e.type];case CellConstants.SLATE:case CellConstants.CLOUD:return void 0!=t&&i==TypeConverter.BLOCKER_TO_CELL_MAP[t.type];case CellConstants.LAYED_SLATE_2:case CellConstants.LAYED_SLATE_3:case CellConstants.LAYED_SLATE_4:case CellConstants.LAYED_SLATE_5:return void 0!=t&&t.type==BlockerConstant.LAYED_SLATE&&t.health==i-32;case CellConstants.SHACKLE:case CellConstants.ICE:return void 0!=e&&e.isLocked()&&TypeConverter.LOCK_TO_CELL_MAP[e.getLock().type]==i}return!1},e.prototype._isForbiddenSpawnHere=function(e,t){return void 0!=e?e.busy||e.hasGiftWrapper()||e.type==ElementTypeConstants.BALLOON||e.type==ElementTypeConstants.CRAYON||e.type==ElementTypeConstants.SCISSOR||e.type==ElementTypeConstants.BLACK_HOLE||e.type==ElementTypeConstants.GOLDEN_EGG||e.type==ElementTypeConstants.LAMP_1||e.type==ElementTypeConstants.LAMP_2:void 0!=t?t.busy||t.type==BlockerConstant.COLOR_MIXER||t.type==BlockerConstant.PUZZLE||t.type==BlockerConstant.CLOUD_MAKER||t.type==BlockerConstant.CLOUD_ROCKET||t.type==BlockerConstant.FAN:!1},e.prototype._canSpawnHere=function(e,t,i){var n=this._board.getElementAtGrid(e,t),o=this._board.getBlockerAtGrid(e,t);if(this._isForbiddenSpawnHere(n,o)||this._isTheSameTypeAndHealth(n,o,i)||this._isGeneratedByColorMixer(n,o)||this._isColorMixerCanGenerate(n,o))return!1;switch(i){case CellConstants.TIME_BOMB:case CellConstants.BOX:if(o&&o.type==BlockerConstant.SNOW)return!1;if(n&&(n.type==ElementTypeConstants.LAMP_1||n.type==ElementTypeConstants.LAMP_2))return!1;break;case CellConstants.SLATE:case CellConstants.CLOUD:case CellConstants.LAYED_SLATE_2:case CellConstants.LAYED_SLATE_3:case CellConstants.LAYED_SLATE_4:case CellConstants.LAYED_SLATE_5:if(this._board.isBeltCell(e,t)||n&&n.type==ElementTypeConstants.LAMP_1||n&&n.type==ElementTypeConstants.LAMP_2)return!1;break;case CellConstants.SHACKLE:case CellConstants.ICE:if(o)return!1;if(void 0==n)return!1;if(this._board.isBeltCell(e,t)||n.type==ElementTypeConstants.BOX)return!1}return!0},e.prototype._notValidForInspection=function(e,t){return!this._board.isValidGridPos(e,t)||this._board.isVoidCell(e,t)},e.prototype._generate=function(t,i,n){var o=e.ELEMENTS_MAP[this._colorMixerElements[this._eleIndexOfMixer[n]]];switch((this._isAnyType||-1==o)&&(o=e.ELEMENTS_MAP[this._board.random(1,10)]),o){case CellConstants.TIME_BOMB:case CellConstants.BOX:this._generateElement(t,i,o);break;case CellConstants.SLATE:this._generateSlate(t,i,1);break;case CellConstants.LAYED_SLATE_2:case CellConstants.LAYED_SLATE_3:case CellConstants.LAYED_SLATE_4:case CellConstants.LAYED_SLATE_5:this._generateSlate(t,i,o-32);break;case CellConstants.CLOUD:this._generateCloud(t,i);break;case CellConstants.SHACKLE:this._generateLock(t,i,LOCK_TYPE.SHACKLE);break;case CellConstants.ICE:this._generateLock(t,i,LOCK_TYPE.ICE)}},e.prototype._generateElement=function(e,t,i){var n,o=this._board.getBlockerAtGrid(e,t),a=this._board.getElementAtGrid(e,t),s=CellConstants.ELEMENT_COLOR_RANDOM;if(a&&a.color>=2&&a.color<=7&&(s=a.color),i==CellConstants.TIME_BOMB)n=this._board.getElementFactory().create(e,t,s,ElementTypeConstants.TIME_BOMB);else{if(!CellConstants.BOX)return;n=this._board.getElementFactory().create(e,t,0,ElementTypeConstants.BOX)}n.isCreatedByColorMixer=!0,o?this._board.replaceBlockerToElement(n):a?(a.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,a.getLock()),a.breakLock()),i==CellConstants.TIME_BOMB?(this._board.removeElement(a,!0),this._board.rebuildPathForColumn(e),this._board.setElementAtGrid(e,t,n),this._board.addElementToBoard(n)):this._board.replaceBoardElement(n)):(this._board.setElementAtGrid(e,t,n),this._board.addElementToBoard(n))},e.prototype._generateSlate=function(e,t,i){var n=this._board.getBlockerAtGrid(e,t),o=this._board.getElementAtGrid(e,t);n&&(n.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,n.getLock()),n.breakLock()),this._board.removeBlocker(n)),o&&(o.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,o.getLock()),o.breakLock()),this._board.removeElement(o,!0),this._board.rebuildPathForColumn(e)),1==i?this._board.createNewBlockerAt(e,t,BlockerConstant.SLATE,i,!0):this._board.createNewBlockerAt(e,t,BlockerConstant.LAYED_SLATE,i,!0)},e.prototype._generateCloud=function(e,t){var i=this._board.getBlockerAtGrid(e,t),n=this._board.getElementAtGrid(e,t);if(i&&(i.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,i.getLock()),i.breakLock()),this._board.removeBlocker(i)),n){if(n.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,n.getLock()),n.breakLock()),n.type==ElementTypeConstants.ROCKET){this._board.createNewBlockerAt(e,t,BlockerConstant.CLOUD_ROCKET,1,!0);var o=this._board.getBlockerAtGrid(e,t);o.rocketType=n.rocketType,o.rocketState=n.rocketState,o.color=n.color}else this._board.createNewBlockerAt(e,t,BlockerConstant.CLOUD,1,!0);this._board.removeElement(n,!0),this._board.rebuildPathForColumn(e)}else this._board.createNewBlockerAt(e,t,BlockerConstant.CLOUD,1,!0)},e.prototype._generateLock=function(e,t,i){var n=this._board.getElementAtGrid(e,t);if(void 0!=n){var o;if(i==LOCK_TYPE.SHACKLE)o=this._board.getLockFactory().create(LOCK_TYPE.SHACKLE,1);else{if(i!=LOCK_TYPE.ICE)return;o=this._board.getLockFactory().create(LOCK_TYPE.ICE,1)}o.isCreatedByColorMixer=!0,n.isLocked()&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_LOCK,!1,n.getLock()),n.breakLock()),n.addLock(o),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_LOCK,!0,n.getLock())}},e.prototype._getAllValidMixer=function(){for(var e=[],t=this._board.getAllBlockers(),i=0,n=t;i<n.length;i++){var o=n[i];o.type==BlockerConstant.COLOR_MIXER&&o.health>0&&!o.busy&&!o.isDead&&e.push(o)}return e},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onChangeBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_INIT_DONE,this._initCounterOfMixer,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_PREPARE_REMOVE_COLORMIXER,this._onBoardPrepareRemoveColorMixer,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onChangeBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_INIT_DONE,this._initCounterOfMixer,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_PREPARE_REMOVE_COLORMIXER,this._onBoardPrepareRemoveColorMixer,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},e.prototype._onBoardStable=function(){0==this._getAllValidMixer().length?this._mixersBeenRemoved=!0:this._mixersBeenRemoved=!1},e.prototype._initCounterOfMixer=function(){var e=this._board.getSavedColorMixer();if(e){this._stepCntOfMixer=e.stepCnt,this._eleIndexOfMixer=e.eleIndex;for(var t in this._stepCntOfMixer)this._canAddStep[t]=!1;var i=this._getAllValidMixer();return void(0==i.length&&(this.mixersBeenRemoved=!0))}for(var n=this._getAllValidMixer(),o=0,a=n;o<a.length;o++){var s=a[o];this._stepCntOfMixer[s.col+9*s.row]=0,this._eleIndexOfMixer[s.col+9*s.row]=0,this._canAddStep[s.col+9*s.row]=!1}},e.prototype._onChangeBlocker=function(e){var t=e.data;this._mixersBeenRemoved||t.type!=BlockerConstant.COLOR_MIXER||(this._canAddStep[t.col+9*t.row]=!1)},e.prototype._onBoardPrepareRemoveColorMixer=function(e){var t=e.data;this._canAddStep[t.col+9*t.row]=!1,t.view&&t.view.colorMixerRemove()},e.prototype._onRemoveBlocker=function(e){var t=e.data;if(t.type==BlockerConstant.COLOR_MIXER){this._setState(ColorMixer.IDLE);var i=t.col+9*t.row;delete this._stepCntOfMixer[i],delete this._eleIndexOfMixer[i],delete this._canAddStep[i],this._board.addScore(ScoreConstants.COLOR_MIXER);var n=this._board.getElementFactory().create(t.col,t.row,CellConstants.EMPTY,ElementTypeConstants.BLANK),o=new DPackBomb(this._board,n,void 0,5);o.isColorMixerExploded=!0,n.destructionPack=o,this._board.setElementAtGrid(t.col,t.row,n),this._board.getAllElements().push(n),this._board.addToDestructionPlanList(n),this._board.removeElement(n,!0)}},e.prototype._onSwitchMade=function(e){if(!this._mixersBeenRemoved){var t=this._getAllValidMixer();if(0==t.length)return this._mixersBeenRemoved=!0,void this._setState(ColorMixer.IDLE);this._mixersBeenRemoved=!1;for(var i=0,n=t;i<n.length;i++){var o=n[i];o.isLocked()||(this._canAddStep[o.col+9*o.row]=!0)}this._setState(ColorMixer.ADD_COLOR)}},e.prototype._setState=function(e){this._state=e},e.prototype._isMixerGenEle=function(e){return e==ElementTypeConstants.TIME_BOMB?this.colorMixerElements.indexOf(1)>=0:e==ElementTypeConstants.BOX?this.colorMixerElements.indexOf(2)>=0:!1},e.prototype._isMixerGenLock=function(e){return e==LOCK_TYPE.ICE?this.colorMixerElements.indexOf(10)>=0:e==LOCK_TYPE.SHACKLE?this.colorMixerElements.indexOf(9)>=0:!1},e.prototype._isMixerGenBlocker=function(e){if(e==BlockerConstant.SLATE)return this.colorMixerElements.indexOf(3)>=0;if(e==BlockerConstant.LAYED_SLATE){for(var t=0,i=this.colorMixerElements;t<i.length;t++){var n=i[t];if(n>=4&&7>=n)return!0}return!1}return e==BlockerConstant.CLOUD?this.colorMixerElements.indexOf(8)>=0:!1},e.prototype.isMixerGenObjective=function(e){if(e==BlockerConstant.SLATE||e==BlockerConstant.LAYED_SLATE){for(var t=0,i=this.colorMixerElements;t<i.length;t++){var n=i[t];if(n>=3&&7>=n)return!0}return!1}return e==BlockerConstant.CLOUD?this.colorMixerElements.indexOf(8)>=0:e==ElementTypeConstants.BOX?this.colorMixerElements.indexOf(2)>=0:void 0},Object.defineProperty(e.prototype,"colorMixerAmount",{get:function(){return this._colorMixerAmount},set:function(e){this._colorMixerAmount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMixerInterval",{get:function(){return this._colorMixerInterval},set:function(e){this._colorMixerInterval=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMixerElements",{get:function(){return this._colorMixerElements},set:function(e){this._colorMixerElements=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mixersBeenRemoved",{get:function(){return this._mixersBeenRemoved},set:function(e){this._mixersBeenRemoved=e},enumerable:!0,configurable:!0}),e.ELEMENTS_MAP=[-1,CellConstants.TIME_BOMB,CellConstants.BOX,CellConstants.SLATE,CellConstants.LAYED_SLATE_2,CellConstants.LAYED_SLATE_3,CellConstants.LAYED_SLATE_4,CellConstants.LAYED_SLATE_5,CellConstants.CLOUD,CellConstants.SHACKLE,CellConstants.ICE],e
}();__reflect(ColorMixerHandler.prototype,"ColorMixerHandler",["IStabilityClient"]);var FanBlocker=function(e){function t(t,i){return e.call(this,t,i,BlockerConstant.FAN)||this}return __extends(t,e),t.prototype.update=function(){e.prototype.update.call(this),this._health>0&&this._health--},t.prototype.applyDamage=function(e,t){void 0===t&&(t=null);var i=0;this._health<=0&&(i=this.getNumOfTornadoForSource(t),this._health=0==i?0:2,i>0&&(this._view.fanBlockerTriggerAnimation(),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.FAN_BLOCKER_LAUNCH,!1,{fanBlocker:this,alleyNum:i}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_TRIGGER_ELEMENT_OR_BLOCKER,!1,{ele:this,count:i})))},t.prototype.getNumOfTornadoForSource=function(e){void 0===e&&(e=null);var t=0;return(e==DamageSource.LINE||e==DamageSource.SQUARE)&&(t=1),(e==DamageSource.COLOR_COLOR||e==DamageSource.LINE_LINE||e==DamageSource.LINE_SQUARE||e==DamageSource.SQUARE_SQUARE||e==DamageSource.COLOR_MIXER_EXPLODE)&&(t=3),t},t.prototype.canBeDestroyed=function(){return!1},t.prototype.canBeDestroyedByItem=function(){return!1},t}(Blocker);__reflect(FanBlocker.prototype,"FanBlocker");var CellFences=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,n)||this;s._verticesDrawTime=new Array(4);for(var r=CellConstants.EDGE_BLOCKER_SET,l=0;l<r.length;l++)for(var _=r[l],h=0,c=_;h<c.length;h++){var d=(c[h],a.getFenceByDirFromCell(n,t,i,l));if(d){s._edges[l]=d,s.isEmpty&&(s.isEmpty=!1);break}}return s}return __extends(t,e),t.prototype.getAdjacentEdgeBlocker=function(e){return null},t}(CellEdges);__reflect(CellFences.prototype,"CellFences");var CellVertice=function(e){function t(t,i){var n=e.call(this)||this;return n._cellEdges=t,n._direction=i,xyd.setBitmapAsync(n,"icon_xiaokeng",function(){n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2}),n}return __extends(t,e),Object.defineProperty(t.prototype,"cellEdges",{get:function(){return this._cellEdges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),t}(egret.Bitmap);__reflect(CellVertice.prototype,"CellVertice");var Curls=function(e){function t(t,i,n,o){var a=e.call(this,t,i,BlockerConstant.CURLS)||this;return a._health=n,a._direction=o,a}return __extends(t,e),t.prototype.canBeAffectByNearElement=function(){return!0},t.prototype.canBeAffectedByMatch=function(){return!0},t.prototype.canBeDestroyed=function(){return!0},t.prototype.canBeDestroyedByItem=function(){return!1},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction=e},enumerable:!0,configurable:!0}),t}(Blocker);__reflect(Curls.prototype,"Curls");var Fence=function(e){function t(t,i,n){var o=e.call(this,t,i,BlockerConstant.FENCE)||this;return o._direction=n,o}return __extends(t,e),t.prototype.canBeAffectByNearElement=function(){return!1},t.prototype.canBeAffectedByMatch=function(){return!1},t.prototype.canBeDestroyed=function(){return!1},t.prototype.canBeDestroyedByItem=function(){return!1},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction=e},enumerable:!0,configurable:!0}),t}(Blocker);__reflect(Fence.prototype,"Fence");var Puzzle=function(){function e(){this._tiles=[],this._state=0,this._puzzleID=-1}return Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._puzzleID},set:function(e){this._puzzleID=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"puzzleID",{get:function(){return this._puzzleID},set:function(e){this._puzzleID=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiles",{get:function(){return this._tiles},set:function(e){this._tiles=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._tiles.push(n)}},enumerable:!0,configurable:!0}),e.position={LEFT_UP:1,RIGHT_UP:2,LEFT_DOWN:3,RIGHT_DOWN:4},e.states={IDLE:0,WAITING_TO_EXPLODE:1,HAS_EXPLODED:2},e}();__reflect(Puzzle.prototype,"Puzzle");var PuzzleHandlerState;!function(e){e[e.IDLE=1]="IDLE",e[e.ANIM=2]="ANIM",e[e.REMOVE=3]="REMOVE",e[e.DONE=4]="DONE"}(PuzzleHandlerState||(PuzzleHandlerState={}));var PuzzleHandler=function(){function e(e){this._puzzles=[],this._maxPuzzleID=1,this._intelvalFrame=10*xyd.frameScale,this._numFrames=-1,this._unchangedPos=[],this._changedElements=[],this._changeType=-1,this._changeDir=-1,this._isChanging=!1,this._isAnimation=!1,this._changeDone=!1,this._shouldUpdate=!1,this.PUZZLE_TILE_COUNT=4,this.START_ANIMATION_TIME=30*xyd.frameScale,this.ANIMATION_TIME=90*xyd.frameScale,this._state=PuzzleHandlerState.IDLE,this._board=e,this._initEvents()}return e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SIZE,this._onPuzzleCheck,this)},e.prototype.createPuzzle=function(e){var t=new Puzzle;t.puzzleID=this._maxPuzzleID,t.tiles=e;for(var i=0;i<e.length;i++){var n=e[i];n.puzzleID=this._maxPuzzleID,n.positionID=i+1}return this._maxPuzzleID++,t.state=Puzzle.states.IDLE,t.x=e[0].col,t.y=e[0].row,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ADD_PUZZLE,!1,t),t},e.prototype._onPuzzleCheck=function(e){var t=this._board.getBlockersOfType(BlockerConstant.PUZZLE),i=t.length;if(i>0)for(var n=Math.floor(i/this.PUZZLE_TILE_COUNT),o=0;n>o;o++){var a=t[0],s=this._board.getBlockerAtGrid(a.col+1,a.row),r=this._board.getBlockerAtGrid(a.col,a.row+1),l=this._board.getBlockerAtGrid(a.col+1,a.row+1),_=[a,s,r,l];t=this._removeBlockerInArray(t,_);var h=this.createPuzzle(_);this._puzzles.push(h)}t=this._board.getBlockersOfType(BlockerConstant.PUZZLE);for(var c=0,d=t;c<d.length;c++){var p=d[c],u=p,m=u.health+3*(u.positionID-1)-1,g=u.col*xyd.TILE_WIDTH,f=u.row*xyd.TILE_HEIGHT;u.view.setProp(g,f,DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.PUZZLE,0,m),u.resetAnchor(u.health)}},e.prototype._removeBlockerInArray=function(e,t){for(var i=[],n=0;n<e.length;n++){for(var o=e[n],a=!1,s=t.length-1;s>=0;s--){var r=t[s];r.col==o.col&&r.row==o.row&&(a=!0)}a||i.push(o)}return i},e.prototype._onPuzzleComplete=function(e){this._isAnimation=!1,this._isChanging=!0},e.prototype.checkIsPuzzleActive=function(){for(var e=0;e<this._puzzles.length;e++){for(var t=this._puzzles[e],i=!0,n=0;n<this.PUZZLE_TILE_COUNT;n++){var o=t.tiles[n].health;if(o>1){i=!1;break}}if(i)return t.state=Puzzle.states.WAITING_TO_EXPLODE,this._activePuzzle=t,this._isAnimation=!0,!0}return!1},e.prototype.startAnimation=function(e){for(var t=0;t<this.PUZZLE_TILE_COUNT;t++)xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_HIDE_BLOCKER,!1,e.tiles[t]);xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_PUZZLE,!1,e)},e.prototype.requestUpdate=function(){return this._shouldUpdate?!1:this.checkIsPuzzleActive()?(this._shouldUpdate=!0,this._state=PuzzleHandlerState.ANIM,!0):!1},e.prototype.update=function(){this._shouldUpdate&&(this._numFrames++,this._state==PuzzleHandlerState.ANIM?(this._numFrames>this.ANIMATION_TIME&&(this._numFrames=-1,this._state=PuzzleHandlerState.REMOVE),this._numFrames==this.START_ANIMATION_TIME&&this.startAnimation(this._activePuzzle)):this._state==PuzzleHandlerState.REMOVE&&(this._onPuzzleExplodeClearBoard(),this._state=PuzzleHandlerState.DONE))},e.prototype.canDelete=function(e){return e&&e.canBeDestroyed()?!0:!1},e.prototype.requestWithdraw=function(){return this._shouldUpdate?this._state!=PuzzleHandlerState.DONE?!1:(this._shouldUpdate=!1,this._state=PuzzleHandlerState.IDLE,this._numFrames=-1,this._changedElements=[],this._unchangedPos=[],!0):!1},e.prototype._onPuzzleExplodeClearBoard=function(){for(var e=0,t=this._activePuzzle.tiles;e<t.length;e++){var i=t[e];this._board.hitEmptyCell(i.col,i.row)}for(var n=this._board.getBoardCols(),o=this._board.getBoardRows(),a=0;n>a;a++)for(var s=0;o>s;s++){var r=this._board.getGridContainerAt(a,s);if(void 0!=r){if(r.hasBlocker()){var l=r.getBlocker();l.type!=BlockerConstant.PUZZLE&&l.canBeDestroyed()&&this._board.hitBlocker(l,1)}else if(r.hasElement()){var _=r.getElement();(_.type==ElementTypeConstants.LAMP_1||_.type==ElementTypeConstants.LAMP_2)&&this._board.hitEmptyCell(_.col,_.row),(_.canBeDestroyed()||_.isLocked())&&(_.isLocked()||(_.destructionPack=void 0,_.setDestroyFrames(2*xyd.frameScale)),this._board.addForRemoval(r.getElement(),0,DamageSource.PUZZLE))}}else this._board.hitEmptyCell(a,s)}for(var h=0;h<this.PUZZLE_TILE_COUNT;h++){var i=this._activePuzzle.tiles[h];i.removePuzzle(),this._board.addBlockerForRemoval(i)}this._board.addScore(ScoreConstants.PUZZLE),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_PUZZLE_COMPLETE,!1,{x:this._activePuzzle.tiles[0].col,y:this._activePuzzle.tiles[0].row});for(var h=0;h<this._puzzles.length;h++)if(this._puzzles[h].puzzleID==this._activePuzzle.puzzleID){this._puzzles.splice(h,1);break}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.SHAKE_BOARD,!1,{intensity:3}),this._activePuzzle=void 0},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SIZE,this._onPuzzleCheck,this)},e}();__reflect(PuzzleHandler.prototype,"PuzzleHandler",["IStabilityClient"]);var PuzzleTile=function(e){function t(t,i,n){var o=e.call(this,t,i,BlockerConstant.PUZZLE)||this;return o._health=n,o}return __extends(t,e),Object.defineProperty(t.prototype,"positionID",{get:function(){return this._positionID},set:function(e){this._positionID=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"puzzleID",{get:function(){return this._puzzeID},set:function(e){this._puzzeID=e},enumerable:!0,configurable:!0}),t.prototype.canBeDestroyedByItem=function(){return!1},t.prototype.canBeAffectByNearElement=function(){return!1},t.prototype.canBeDestroyed=function(){return!0},t.prototype.canBeAffectedByMatch=function(){return!0},t.prototype.resetAnchor=function(e){3==e?this._view.setAnchor(xyd.TILE_WIDTH_HALF,xyd.TILE_HEIGHT_HALF):1==e?this._view.setAnchor(xyd.TILE_WIDTH_HALF+DisplayConstants.PUZZLE_ANCHORX_1,xyd.TILE_HEIGHT_HALF+DisplayConstants.PUZZLE_ANCHORY_1):this._view.setAnchor(xyd.TILE_WIDTH_HALF+DisplayConstants.PUZZLE_ANCHORX_2,xyd.TILE_HEIGHT_HALF+DisplayConstants.PUZZLE_ANCHORY_2)},t.prototype.applyDamage=function(e){this._health>1&&(this._health-=e)},t.prototype.removePuzzle=function(){this._health=0},t}(Blocker);__reflect(PuzzleTile.prototype,"PuzzleTile");var Snow=function(e){function t(t,i,n){var o=e.call(this,t,i,BlockerConstant.SNOW)||this;return o._health=n,o}return __extends(t,e),t}(Blocker);__reflect(Snow.prototype,"Snow");var ActivedCrayon=function(){function e(e,t,i,n){this._x=e,this._y=t,this._type=i,this._dir=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},enumerable:!0,configurable:!0}),e.TRIGGER_NORMAL_TYPE=1,e.TRIGGER_LINE_TYPE=2,e.TRIGGER_SQUARE_TYPE=3,e.TRIGGER_COLOR_TYPE=4,e}();__reflect(ActivedCrayon.prototype,"ActivedCrayon");var ActivedWandElement=function(){function e(e,t,i,n,o){this._x=e,this._y=t,this._type=i,this._dir=o,this._id=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.TRIGGER_NORMAL_TYPE=1,e.TRIGGER_LINE_TYPE=2,e.TRIGGER_SQUARE_TYPE=3,e.TRIGGER_COLOR_TYPE=4,e}();__reflect(ActivedWandElement.prototype,"ActivedWandElement");var Balloon=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,n,o)||this;return s.affectAdjacentBlockerOnRemove=!1,s._health=a,s}return __extends(t,e),t.prototype.canBeTransformedToPowerUpByMatch=function(){return!1},t.prototype.canBeCoveredByCloud=function(){return!1},t.prototype.canBeAttackedByRocket=function(){return!1},t.prototype.isSticky=function(){return!0},t.prototype.isSpecial=function(){return!0},t.prototype.canBeMoved=function(){return!1},Object.defineProperty(t.prototype,"hp",{get:function(){return this._health},enumerable:!0,configurable:!0}),t.prototype.hitElementAndCheckRemove=function(){return this._health>0&&this._health--,this._health>0?(this._shieldFrames=1,!1):!0},t}(BoardElement);__reflect(Balloon.prototype,"Balloon");var BlackHole=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,n,o)||this;return s.color2=a,s}return __extends(t,e),Object.defineProperty(t.prototype,"color2",{get:function(){return this._color2},set:function(e){this._color2=e},enumerable:!0,configurable:!0}),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(BlackHole.prototype,"BlackHole");var BlankElement=function(e){function t(t,i,n){var o=e.call(this,t,i,0,0)||this;return o._destroyFrames=n,o}return __extends(t,e),t}(BoardElement);__reflect(BlankElement.prototype,"BlankElement");var Keyboard=function(){function e(){}return e.LEFT=37,e.RIGHT=39,e.UP=38,e.DOWN=40,e.W=87,e.A=65,e.S=83,e.D=68,e.J=74,e.K=75,e.L=76,e.U=85,e.I=73,e.O=79,e.P=80,e.SPACE=32,e.ENTER=13,e}();__reflect(Keyboard.prototype,"Keyboard");var BoardElementFactory=function(){function e(e,t){this._maxID=1,this._numOfColors=e.numOfColors,this._randomHandler=t,this._availableColors=e.availableColors,this._gameConf=e}return e.prototype.setBoard=function(e){this._board=e},e.prototype.setRandomHandler=function(e){this._randomHandler=e},e.prototype.create=function(e,t,i,n,o,a){var s,r=i!=CellConstants.ELEMENT_COLOR_RANDOM?i:this.randomColor();switch(n){case ElementTypeConstants.LAMP_1:case ElementTypeConstants.LAMP_2:s=new LampElement(e,t,0,n);break;case ElementTypeConstants.BOMB_COL:s=new BoardElement(e,t,r,n),s.setActiveInLastExplode(!0),s.setSpecial();break;case ElementTypeConstants.BOMB_ROW:s=new BoardElement(e,t,r,n),s.setActiveInLastExplode(!0),s.setSpecial();break;case ElementTypeConstants.BOMB_SQUARE:s=new BoardElement(e,t,r,n),s.setActiveInLastExplode(!0),s.setSpecial();break;case ElementTypeConstants.BOMB_COLOR:s=new BoardElement(e,t,0,n),s.setActiveInLastExplode(!0),s.setSpecial();break;case ElementTypeConstants.BOX:s=new BoxElement(e,t,0,n);break;case ElementTypeConstants.TIME_BOMB:s=new TimeBomb(e,t,r,n,this._gameConf.timeBombExplosionMoves);break;case ElementTypeConstants.TORNADO:s=new Tornado(e,t,r,n),s.setActiveInLastExplode(!0);break;case ElementTypeConstants.LUCKY_BAG:s=new LuckyBag(e,t,r,n);break;case ElementTypeConstants.BLACK_HOLE:for(var l=this.randomColor();l==r;)l=this.randomColor();s=new BlackHole(e,t,r,n,l);break;case ElementTypeConstants.CRAYON:s=new Crayon(e,t,0,n),s.setActiveInLastExplode(!0);break;case ElementTypeConstants.CAKE:s=new CakeElement(e,t,0,n,a);break;case ElementTypeConstants.ROCKET:s=new Rocket(e,t,r,n,this._gameConf.rocketCapacity);break;case ElementTypeConstants.WAND:s=new WandElement(e,t,0,n),s.setActiveInLastExplode(!0);break;case ElementTypeConstants.GOLDEN_EGG:s=new GoldenEgg(e,t,r,n);break;case ElementTypeConstants.SCISSOR:s=new Scissor(e,t,r,n);break;case ElementTypeConstants.BALLOON:s=new Balloon(e,t,0,n,a);break;default:s=new BoardElement(e,t,r,n),this._board.needCreateSpecialDrop()&&s.setSpecialDrop(!0)}switch(s.id=this.getNexElementId(),s.setBoard(this._board),s.type){case ElementTypeConstants.BOMB_COL:s.destructionPack=new DPackCol(this._board,s,o);break;case ElementTypeConstants.BOMB_ROW:s.destructionPack=new DPackRow(this._board,s,o);break;case ElementTypeConstants.BOMB_SQUARE:var _=this.create(e,t,r,ElementTypeConstants.NORMAL,o);_.setUnstable(),_.setDestroyFrames(8*xyd.frameScale),_.destructionPack=new DPackBomb(this._board,_,void 0,3),s.destructionPack=new DPackBomb(this._board,s,_,3,o);break;case ElementTypeConstants.BOMB_COLOR:s.destructionPack=new DPackColor(this._board,s,o),s.setDestroyFrames(Math.floor(60*xyd.frameScale))}return s},e.prototype.getElementFromCell=function(e,t,i){return e.hasProperty(CellConstants.BOMB_ROW)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.BOMB_ROW):e.hasProperty(CellConstants.BOMB_COL)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.BOMB_COL):e.hasProperty(CellConstants.BOMB_SQUARE)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.BOMB_SQUARE):e.hasProperty(CellConstants.CRAYON)?this.create(t,i,0,ElementTypeConstants.CRAYON):e.hasProperty(CellConstants.BOMB_COLOR)?this.create(t,i,0,ElementTypeConstants.BOMB_COLOR):e.hasProperty(CellConstants.LAMP1)?this.create(t,i,0,ElementTypeConstants.LAMP_1):e.hasProperty(CellConstants.LAMP2)?this.create(t,i,0,ElementTypeConstants.LAMP_2):e.hasProperty(CellConstants.BOX)?this.create(t,i,0,ElementTypeConstants.BOX):e.hasProperty(CellConstants.CAKE_1)?this.create(t,i,0,ElementTypeConstants.CAKE,void 0,1):e.hasProperty(CellConstants.CAKE_2)?this.create(t,i,0,ElementTypeConstants.CAKE,void 0,2):e.hasProperty(CellConstants.CAKE_3)?this.create(t,i,0,ElementTypeConstants.CAKE,void 0,3):e.hasProperty(CellConstants.CAKE_4)?this.create(t,i,0,ElementTypeConstants.CAKE,void 0,4):e.hasProperty(CellConstants.CAKE_5)?this.create(t,i,0,ElementTypeConstants.CAKE,void 0,5):e.hasProperty(CellConstants.ROCKET)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.ROCKET):e.hasProperty(CellConstants.TIME_BOMB)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.TIME_BOMB):e.hasProperty(CellConstants.LUCKY_BAG)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.LUCKY_BAG):e.hasProperty(CellConstants.TORNADO)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.TORNADO):e.hasProperty(CellConstants.BLACK_HOLE)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.BLACK_HOLE):e.hasProperty(CellConstants.WAND)?this.create(t,i,0,ElementTypeConstants.WAND):e.hasProperty(CellConstants.GOLDEN_EGG)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.GOLDEN_EGG):e.hasProperty(CellConstants.SCISSOR)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.SCISSOR):e.hasProperty(CellConstants.BALLOON_1)?this.create(t,i,0,ElementTypeConstants.BALLOON,void 0,1):e.hasProperty(CellConstants.BALLOON_2)?this.create(t,i,0,ElementTypeConstants.BALLOON,void 0,2):e.hasProperty(CellConstants.BALLOON_3)?this.create(t,i,0,ElementTypeConstants.BALLOON,void 0,3):e.hasProperty(CellConstants.NORMAL_ELEMENT)?this.create(t,i,this._getReqColor(e),ElementTypeConstants.NORMAL):void 0},e.prototype.randomColor=function(){var e=this._randomHandler.nextInt(0,this._numOfColors-1);return this._availableColors[e]},e.prototype.getNexElementId=function(){return++this._maxID},e.prototype._getReqColor=function(e){for(var t=0,i=CellConstants.COLOR_SET;t<i.length;t++){var n=i[t];if(e.hasProperty(n))return n}return CellConstants.ELEMENT_COLOR_RANDOM},e.prototype.getAvailableColors=function(){return this._availableColors},e.prototype.setAvailableColors=function(e){this._availableColors=e},e}();__reflect(BoardElementFactory.prototype,"BoardElementFactory",["IBoardElementFactory"]);var BoardElementState;!function(e){e[e.IDLE_STATE=1]="IDLE_STATE",e[e.MOVE_STATE=2]="MOVE_STATE",e[e.REMOVE_STATE=3]="REMOVE_STATE",e[e.CREATE_STATE=4]="CREATE_STATE"}(BoardElementState||(BoardElementState={}));var BoxElement=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.specialScore=ScoreConstants.BOX,a}return __extends(t,e),t.prototype.canBeTransformedToPowerUpByMatch=function(){return!1},t.prototype.canBeCoveredByCloud=function(){return!1},Object.defineProperty(t.prototype,"affectAdjacentBlockerOnRemove",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(BoxElement.prototype,"BoxElement");var CakeElement=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,n,o)||this;return s._health=a,s}return __extends(t,e),t.prototype.canBeTransformedToPowerUpByMatch=function(){return!1},t.prototype.canBeCoveredByCloud=function(){return!0},Object.defineProperty(t.prototype,"affectAdjacentBlockerOnRemove",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.hitElementAndCheckRemove=function(){return this._health>0&&this._health--,this._health>0?(this._shieldFrames=2*xyd.frameScale,!1):!0},Object.defineProperty(t.prototype,"hp",{get:function(){return this._health},enumerable:!0,configurable:!0}),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(CakeElement.prototype,"CakeElement");var DebugJSSound=function(){function e(){this.inited=!0}return e.detectAvailable=function(){return!0},e.detectPlayIdAvailable=function(){return!0},e.detectHandleSoundInterruptionAvailable=function(){return!1},e.prototype.play=function(e){var t=this.changeSoundName(e);return new Promise(function(e,i){SoundManager.getInstance().playEffectDirect(t);var n=String(xyd.random(1,1e4));e({play_id:n})})},e.prototype.preload=function(e,t){return new Promise(function(e,t){e({})})},e.prototype.stop=function(e,t){return new Promise(function(e,t){e({})})},e.prototype.stopBgMusic=function(){return new Promise(function(e,t){SoundManager.getInstance().stopBgDirect(),e({})})},e.prototype.pauseBgMusic=function(){return new Promise(function(e,t){e({})})},e.prototype.playBgMusic=function(e,t,i,n){var o=this.changeSoundName(e);return new Promise(function(e,t){SoundManager.getInstance().playBgDirect(o),e({})})},e.prototype.init=function(e,t){return new Promise(function(e,t){e({})})},e.prototype.unload=function(e){return new Promise(function(e,t){e({})})},e.prototype.changeSoundName=function(e){var t=e.path,i=t.lastIndexOf("/");i>0&&(t=t.substring(i+1,t.length));var n=t.indexOf("."),o=t.substring(0,n)+"_"+t.substring(n+1,t.length);return o},e}();__reflect(DebugJSSound.prototype,"DebugJSSound"),window.DebugGameJsSoundPool=DebugJSSound;var Crayon=function(e){function t(i,n,o,a){var s=e.call(this,i,n,o,a)||this;return s._isTriggered=!1,s._triggerType=t.TRIGGER_NORMAL_TYPE,s._triggerDir=-1,s}return __extends(t,e),t.prototype.triggerBy=function(e,i){this._isTriggered=!0,e==ElementTypeConstants.BOMB_COL||e==ElementTypeConstants.BOMB_ROW?this._triggerType=t.TRIGGER_LINE_TYPE:e==ElementTypeConstants.BOMB_SQUARE?this._triggerType=t.TRIGGER_SQUARE_TYPE:e==ElementTypeConstants.BOMB_COLOR?this._triggerType=t.TRIGGER_COLOR_TYPE:e==ElementTypeConstants.CRAYON&&(this._triggerType=t.TRIGGER_CRAYON_TYPE),this._triggerDir=i},t.prototype.getTriggerType=function(){return this._triggerType},t.prototype.getTriggerDir=function(){return this._triggerDir},t.prototype.isSpecial=function(){return!0},t.TRIGGER_NORMAL_TYPE=0,t.TRIGGER_LINE_TYPE=1,t.TRIGGER_SQUARE_TYPE=2,t.TRIGGER_COLOR_TYPE=3,t.TRIGGER_CRAYON_TYPE=4,t}(BoardElement);__reflect(Crayon.prototype,"Crayon");var GridContainer=function(){function e(e,t,i,n){this._col=e,this._row=t,this._element=i,this._blocker=n}return e.prototype.getCol=function(){return this._col},e.prototype.getRow=function(){return this._row},e.prototype.hasElement=function(){return void 0!=this._element},e.prototype.hasBlocker=function(){return void 0!=this._blocker},e.prototype.isLocked=function(){return void 0!=this._blocker?this._blocker.isLocked():void 0!=this._element?this._element.isLocked():!1},e.prototype.getElement=function(){return this._element},e.prototype.getBlocker=function(){return this._blocker},e.prototype.getCellConst=function(){return this.hasElement()?TypeConverter.getCellPropertyForELement(this._element):this.hasBlocker()?TypeConverter.getCellPropertyForBlocker(this._blocker):-1},e.prototype.getLockType=function(){return this.isLocked()?this.hasBlocker()&&this._blocker.isLocked()?this._blocker.getLock().type:this.hasElement()&&this._element.isLocked()?this._element.getLock().type:0:0},e.prototype.isEmpty=function(){return void 0==this._element&&void 0==this._blocker},e}();__reflect(GridContainer.prototype,"GridContainer");var LampElement=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.specialScore=ScoreConstants.LAMP,a}return __extends(t,e),t.prototype.canBeTransformedToPowerUpByMatch=function(){return!1},t.prototype.canBeDestroyed=function(){return!1},t.prototype.canBeCoveredByCloud=function(){return!1},t.prototype.isSpecial=function(){return!0},t.prototype.canBeAttackedByRocket=function(){return!1},t}(BoardElement);__reflect(LampElement.prototype,"LampElement");var Scissor=function(e){function t(t,i,n,o){return e.call(this,t,i,n,o)||this}return __extends(t,e),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(Scissor.prototype,"Scissor");var TimeBomb=function(e){function t(i,n,o,a,s){var r=e.call(this,i,n,o,a)||this;return r._ticksToExplode=0,r._maxTicksToExplode=0,s&&0!=s?r._maxTicksToExplode=s:r._maxTicksToExplode=t._DEFAULT_MAX_TICKS_TO_EXPLODE,r._ticksToExplode=r._maxTicksToExplode,r.specialScore=ScoreConstants.TIME_BOMB,r}return __extends(t,e),t.prototype.getTicksToExplode=function(){return this._ticksToExplode},t.prototype.setTicksToExplode=function(e){this._ticksToExplode=e},t.prototype.addTicksToExplode=function(e){this._ticksToExplode=this._ticksToExplode+e},t.prototype.decreaseTicksToExplode=function(){this._ticksToExplode=Math.max(0,this._ticksToExplode-1)},t.prototype.isSpecial=function(){return!0},t._DEFAULT_MAX_TICKS_TO_EXPLODE=5,t}(BoardElement);__reflect(TimeBomb.prototype,"TimeBomb");var WandElement=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a._isTriggered=!1,a._triggerType=Crayon.TRIGGER_NORMAL_TYPE,a._triggerDir=-1,a}return __extends(t,e),t.prototype.triggerBy=function(e,i){this._isTriggered=!0,e==ElementTypeConstants.BOMB_COL||e==ElementTypeConstants.BOMB_ROW?this._triggerType=t.TRIGGER_LINE_TYPE:e==ElementTypeConstants.BOMB_SQUARE?this._triggerType=t.TRIGGER_SQUARE_TYPE:e==ElementTypeConstants.BOMB_COLOR?this._triggerType=t.TRIGGER_COLOR_TYPE:e==ElementTypeConstants.CRAYON&&(this._triggerType=t.TRIGGER_CRAYON_TYPE),this._triggerDir=i},t.prototype.getTriggerType=function(){return this._triggerType},t.prototype.getTriggerDir=function(){return this._triggerDir},t.prototype.isSpecial=function(){return!0},t.TRIGGER_NORMAL_TYPE=0,t.TRIGGER_LINE_TYPE=1,t.TRIGGER_SQUARE_TYPE=2,t.TRIGGER_COLOR_TYPE=3,t.TRIGGER_CRAYON_TYPE=4,t}(BoardElement);__reflect(WandElement.prototype,"WandElement");var GoldEggManager=function(){function e(e,t){this._board=e,this._objPlugin=t,this._initEvents()}return e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveOrReplaceElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onRemoveOrReplaceElement,this)},e.prototype._onRemoveOrReplaceElement=function(e){var t=e.data.ele;t&&t.type==ElementTypeConstants.GOLDEN_EGG&&t.getDamageSource()!=DamageSource.CLOUD&&(t.col<0||t.col>8||t.row<0||t.row>8||(this._objPlugin?this._preOpenGoldenEgg(t):this._openGoldenEgg(t,-1)))},e.prototype._openGoldenEgg=function(e,t){if(this._checkAdjacentElement(e),this._isReplaceWithBlocker(t)){var i=this._replaceWithBlocker(e,t);i&&this._board.isBeltCell(e.x,e.y)&&this._board.hitBlocker(i,99)}else this._replaceWithElement(e,t)},e.prototype._preOpenGoldenEgg=function(e){var t=this._objPlugin.getRandomObjective();this._openGoldenEgg(e,t)},e.prototype._checkAdjacentElement=function(e){for(var t=0,i=xyd.directions;t<i.length;t++){var n=i[t],o=e.col+n[0],a=e.row+n[1],s=this._board.getElementAtGrid(o,a);if(void 0!=s&&s.isLocked()&&!s.busy){var r=s.getLock();r.type==LOCK_TYPE.ICE&&this._board.removeLock(s)}}},e.prototype._isReplaceWithBlocker=function(e){for(var t=0;t<ObjectiveConstants.BLOCKER_OBJECTIVES_SET.length;t++)if(e==ObjectiveConstants.BLOCKER_OBJECTIVES_SET[t])return!0;return!1},e.prototype._replaceWithElement=function(e,t){var i;if(void 0!=ObjectiveConstants.OBJECTIVE_TO_COLOR_MAP[t])i=this._board.getElementFactory().create(e.col,e.row,ObjectiveConstants.OBJECTIVE_TO_COLOR_MAP[t],ElementTypeConstants.NORMAL),e.destructionPack=new DPackSimple(this._board,e,i);else if(t==ObjectiveConstants.TIME_BOMB)i=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.TIME_BOMB),e.destructionPack=new DPackSimple(this._board,e,i);else if(t==ObjectiveConstants.BALLOON)i=this._board.getElementFactory().create(e.col,e.row,0,ElementTypeConstants.BALLOON,void 0,3),e.destructionPack=new DPackSimple(this._board,e,i);else if(void 0!=ObjectiveConstants.OBJECTIVE_TO_ELEMENTTYPE_MAP[t]){var n=this._getRandomElementTypeFromObjectiveType(t);i=this._board.getElementFactory().create(e.col,e.row,e.color,n),e.destructionPack=new DPackSimple(this._board,e,i)}else if(-1==t){var n=ElementTypeConstants.BOMB_SQUARE,o=this._board.random(1,100)%4;switch(o){case 1:n=ElementTypeConstants.BOMB_COLOR;break;case 2:n=ElementTypeConstants.BOMB_COL;break;case 3:n=ElementTypeConstants.BOMB_ROW}i=this._board.getElementFactory().create(e.col,e.row,e.color,n),e.destructionPack=new DPackSimple(this._board,e,i)}i&&this._board.getRocket()&&this._board.getRocket().col==e.col&&this._board.getRocket().row==e.row&&this._board.addForRemoval(i)},e.prototype._replaceWithBlocker=function(e,t){var i,n=this._board,o=this._getRandomElementTypeFromObjectiveType(t);if(o==BlockerConstant.LAYED_SLATE){var a=n.random(1,5);i=n.createNewBlockerAt(e.col,e.row,o,a)}else o==BlockerConstant.CLOUD&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.PUT_OFF_CLOUD),i=n.createNewBlockerAt(e.col,e.row,o);return n.rebuildPathForColumn(e.col),this._board.getBlockerAtGrid(e.col,e.row)&&this._board.getRocket()&&this._board.getRocket().col==e.col&&this._board.getRocket().row==e.row&&this._board.removeBlocker(this._board.getBlockerAtGrid(e.col,e.row)),i},e.prototype._getRandomElementTypeFromObjectiveType=function(e){var t=ObjectiveConstants.OBJECTIVE_TO_ELEMENTTYPE_MAP[e];t||(t=ObjectiveConstants.OBJECTIVE_TO_BLOCKER_MAP[e]);var i=this._board.random(0,t.length-1);return t[i]},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveOrReplaceElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onRemoveOrReplaceElement,this)},e}();__reflect(GoldEggManager.prototype,"GoldEggManager");var GoldenEgg=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.affectAdjacentBlockerOnRemove=!1,a._destroyFrames=Math.floor(26*xyd.frameScale),a}return __extends(t,e),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(GoldenEgg.prototype,"GoldenEgg");var LuckyBag=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n,o)||this;return a.affectAdjacentBlockerOnRemove=!1,a._destroyFrames=Math.floor(16*xyd.frameScale),a}return __extends(t,e),t.prototype.isSpecial=function(){return!0},t}(BoardElement);__reflect(LuckyBag.prototype,"LuckyBag");var LuckyBagBlocker=function(e){function t(t,i,n){void 0===n&&(n=!1);var o=e.call(this,t,i,n)||this;return o._isBlocker=!0,o}return __extends(t,e),t}(LuckyBagElement);__reflect(LuckyBagBlocker.prototype,"LuckyBagBlocker");var HotspotBitmap=function(e){function t(){var t=e.call(this)||this;return t._hotspot=[],t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouch,t),t}return __extends(t,e),t.prototype.addHotspotArea=function(e,t,i,n){this._hotspot.push({rect:e,callBack:t,thisObj:i,para:n})
},t.prototype.onTouch=function(e){for(var t,i=e.localX,n=e.localY,o=0;o<this._hotspot.length;o++)t=this._hotspot[o],t.rect.contains(i,n)&&(t.para?t.callBack.call(t.thisObj,t.para):t.callBack.call(t.thisObj))},t}(egret.Bitmap);__reflect(HotspotBitmap.prototype,"HotspotBitmap");var LuckyBagManager=function(){function e(e){this._board=e,this._initLuckyBagList()}return e.prototype._initLuckyBagList=function(){this._luckyBagList=[],this._initLuckyBagElements(),this._initLuckyBagBlockers(),this._initAdditionalLuckyBag()},e.prototype._initLuckyBagElements=function(){this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_COLOR,1.3)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_COLOR,1.3,!0)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_COL,5.6)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_COL,5.6,!0)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_ROW,5.6)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_ROW,5.6,!0)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_SQUARE,5.6)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOMB_SQUARE,5.6,!0)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.CRAYON,.2)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.CRAYON,.2,!0)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.TIME_BOMB,2.3)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BOX,2.3));var e=this._board.getGameConf();e.totalLevel>=this.LEVEL_FIRST_APPEAR_BLACK_HOLE&&(this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BLACK_HOLE,.2)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.BLACK_HOLE,.2,!0)))},e.prototype._initLuckyBagBlockers=function(){this._luckyBagList.push(new LuckyBagBlocker(BlockerConstant.LAYED_SLATE,11.5)),this._luckyBagList.push(new LuckyBagBlocker(BlockerConstant.SLATE,5.6)),this._luckyBagList.push(new LuckyBagBlocker(BlockerConstant.CLOUD,2.3))},e.prototype._initAdditionalLuckyBag=function(){var e=this._board.getGameMode().modeName();e==GameModeConstants.LEAF?(this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.TORNADO,2.3)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.TORNADO,2.3,!0))):e==GameModeConstants.OBJECTIVE&&(this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.GOLDEN_EGG,2.3)),this._luckyBagList.push(new LuckyBagElement(ElementTypeConstants.GOLDEN_EGG,2.3,!0)))},e.prototype.getRandomReplacement=function(e){for(var t=this._getTotalWeight(e),i=this._board.randomDouble()*t,n=0,o=0;o<this._luckyBagList.length;o++){var a=this._luckyBagList[o];if(n+=a.getWeight(),n>=i)return a}},e.prototype._getTotalWeight=function(e){for(var t=0,i=this._luckyBagList.length-1;i>=0;i--){var n=this._luckyBagList[i];n.isNotAllowedOnBelt()&&e?this._luckyBagList.splice(i,1):t+=n.getWeight()}return t},e.prototype.dispose=function(){this._luckyBagList=void 0},e}();__reflect(LuckyBagManager.prototype,"LuckyBagManager");var CloudRocket=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._type=BlockerConstant.CLOUD_ROCKET,n.rocketType=RocketConstants.REGULAR_ROCKET,n.rocketState=RocketConstants.STATE_DARK,n.color=CellConstants.CELL_COLOR_RANDOM,n}return __extends(t,e),Object.defineProperty(t.prototype,"rocketType",{get:function(){return this._rocketType},set:function(e){this._rocketType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rocketState",{get:function(){return this._rocketState},set:function(e){this._rocketState=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._remainCapacity},set:function(e){this._remainCapacity=e},enumerable:!0,configurable:!0}),t}(Cloud);__reflect(CloudRocket.prototype,"CloudRocket");var Rocket=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,n,o)||this;return s.capacity=a,s.capacity>0?s.capacity=Math.min(s.capacity,RocketConstants.DEFAULT_CAPACITY):s.capacity=RocketConstants.DEFAULT_CAPACITY,s.remainCapacity=s._capacity,s.rocketType=RocketConstants.REGULAR_ROCKET,s.rocketState=RocketConstants.STATE_DARK,s}return __extends(t,e),Object.defineProperty(t.prototype,"rocketType",{get:function(){return this._rocketType},set:function(e){this._rocketType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rocketState",{get:function(){return this._rocketState},set:function(e){this._rocketState=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},set:function(e){this._capacity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainCapacity",{get:function(){return this._remainCapacity},set:function(e){this._remainCapacity=e},enumerable:!0,configurable:!0}),t.prototype.canBeTransformedToPowerUpByMatch=function(){return!1},t.prototype.canBeCoveredByCloud=function(){return!0},t.prototype.canBeDestroyed=function(){return!1},t.prototype.canBeAttackedByRocket=function(){return!1},t.prototype.isSticky=function(){return!0},t.prototype.isSpecial=function(){return!0},t.prototype.isRegular=function(){return this.rocketType==RocketConstants.REGULAR_ROCKET},t.prototype.setSpecialPower=function(e){var t;this.setMatchable(!0),e==RocketConstants.SPECIAL_STRIPED_COLUMN?t=new DPackCol(this._board,this):e==RocketConstants.SPECIAL_STRIPED_LINE?t=new DPackLine(this._board,this):e==RocketConstants.SPECIAL_COLOR_BOMBED?(t=new DPackColor(this._board,this),this.setMatchable(!1)):e==RocketConstants.SPECIAL_WRAPPED&&(t=new DPackBomb(this._board,this,void 0,3)),this.rocketType=e,this.destructionPack=t,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ROCKET,!1,this)},t.prototype.consumeSpecialPower=function(){this.isRegular()||(this._board.addToDestructionPlanList(this),this.clearDestructionPack())},t.prototype.clearDestructionPack=function(){this.rocketType=RocketConstants.REGULAR_ROCKET,this.destructionPack=void 0,this.destructionTriggered=!1,this.setMatchable(!0),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ROCKET,!1,this)},t.prototype.refuelThisMany=function(e){this.remainCapacity=this.remainCapacity-e,this.remainCapacity<0&&(this.remainCapacity=0),SoundManager.getInstance().playEffect("se_rocket_charging_mp3"),this.caculateState()},t.prototype.caculateState=function(){var e=this.rocketState,t=this.capacity/2;this.rocketState=RocketConstants.STATE_DARK,0==this.remainCapacity?this.rocketState=RocketConstants.STATE_READY:this.remainCapacity<=t&&(this.rocketState=RocketConstants.STATE_LIGHT),e!=this.rocketState&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ROCKET,!1,this)},t}(BoardElement);__reflect(Rocket.prototype,"Rocket");var RocketConstants=function(){function e(){}return e.DEFAULT_CAPACITY=6,e.CANDY_SATISFACTION=1,e.STATE_DARK=0,e.STATE_LIGHT=1,e.STATE_READY=2,e.REGULAR_ROCKET=0,e.SPECIAL_STRIPED_LINE=1,e.SPECIAL_STRIPED_COLUMN=2,e.SPECIAL_WRAPPED=3,e.SPECIAL_COLOR_BOMBED=4,e}();__reflect(RocketConstants.prototype,"RocketConstants");var RocketMatcher=function(){function e(){}return e.prototype.checkMatch=function(e,t,i){t.patternType==MatchConstants.MATCH_5?e.setSpecialPower(RocketConstants.SPECIAL_COLOR_BOMBED):t.patternType==MatchConstants.MATCH_4?t.left+t.right>=3?e.setSpecialPower(RocketConstants.SPECIAL_STRIPED_COLUMN):e.setSpecialPower(RocketConstants.SPECIAL_STRIPED_LINE):t.patternType==MatchConstants.MATCH_L&&e.setSpecialPower(RocketConstants.SPECIAL_WRAPPED);for(var n=0,o=i;n<o.length;n++){var a=o[n];a.setDamageSource(DamageSource.REFUEL_TO_ROCKET)}},e}();__reflect(RocketMatcher.prototype,"RocketMatcher");var RocketTarget=function(){function e(e){this._board=e,this.initEvents()}return e.prototype.initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.ROCKET_CHECK_TARGET,this.checkTarget,this)},e.prototype.checkTarget=function(e){var t=e.data.to.x,i=e.data.to.y,n=e.data.from,o=this._board,a=o.getCell(i,t);if(!a||a.hasProperty(CellConstants.VOID))return!1;var s=this._board.getGridContainerAt(t,i);if(!s||!s.isLocked()){if(s&&s.hasBlocker()){var r=s.getBlocker();if(!r.canBeAttackedByRocket()||!r.canBeDestroyed())return}if(s&&s.hasElement()){var l=s.getElement();if(!l.canBeAttackedByRocket()||!l.canBeDestroyed())return}xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ROCKET_CHECK_TARGET_SUCCESS,!0,!1,{to:e.data.to,from:n})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ROCKET_CHECK_TARGET_FINISH,!0,!1,{from:n}))}},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.ROCKET_CHECK_TARGET,this.checkTarget,this)},e}();__reflect(RocketTarget.prototype,"RocketTarget");var Tornado=function(e){function t(i,n,o,a){var s=e.call(this,i,n,o,a)||this;return s._isTriggered=!1,s._triggerType=t.TRIGGER_NORMAL_TYPE,s}return __extends(t,e),t.prototype.isTriggered=function(){return this._isTriggered},t.prototype.getTriggerELement=function(){return this._triggerELement},t.prototype.isNormalTriggerType=function(){return this._triggerType==t.TRIGGER_NORMAL_TYPE},t.prototype.isLineTriggerType=function(){return this._triggerType==t.TRIGGER_LINE_TYPE},t.prototype.isSquareTriggerType=function(){return this._triggerType==t.TRIGGER_SQUARE_TYPE},t.prototype.isColorTriggerType=function(){return this._triggerType==t.TRIGGER_COLOR_TYPE},t.prototype.getTriggerType=function(){return this._triggerType},t.prototype.setTriggerType=function(e){this._triggerType=e},t.prototype.triggerBy=function(e){if(this._isTriggered=!0,void 0!=e){var i=e.type;if(i==ElementTypeConstants.BOMB_COL||i==ElementTypeConstants.BOMB_ROW)this._triggerType=t.TRIGGER_LINE_TYPE;else if(i==ElementTypeConstants.BOMB_SQUARE)this._triggerType=t.TRIGGER_SQUARE_TYPE;else if(i==ElementTypeConstants.BOMB_COLOR)this._triggerType=t.TRIGGER_COLOR_TYPE;else if(i==ElementTypeConstants.ROCKET){var n=e,o=n.rocketType;o==RocketConstants.SPECIAL_STRIPED_COLUMN||o==RocketConstants.SPECIAL_STRIPED_LINE?this._triggerType=t.TRIGGER_LINE_TYPE:o==RocketConstants.SPECIAL_WRAPPED?this._triggerType=t.TRIGGER_SQUARE_TYPE:o==RocketConstants.SPECIAL_COLOR_BOMBED&&(this._triggerType=t.TRIGGER_COLOR_TYPE)}this._triggerELement=e}},t.prototype.isSpecial=function(){return!0},t.TRIGGER_NORMAL_TYPE=0,t.TRIGGER_LINE_TYPE=1,t.TRIGGER_SQUARE_TYPE=2,t.TRIGGER_COLOR_TYPE=3,t}(BoardElement);__reflect(Tornado.prototype,"Tornado");var TornadoAlley=function(){function e(e,t,i,n,o,a){this._defaultScore=0,this._tweenDuration=1.3,this._hasVanished=!1,this._hasArrived=!1,this._justArrived=!1,this._isTweenDone=!1,e.type==ElementTypeConstants.TORNADO&&(this._tornado=e),this._fromEle=e,this._startPos=t,this._targetPos=i,this._isTrigger=n,this._delayFrames=o,this._defaultScore=a}return e.prototype.init=function(){var e=Tornado.TRIGGER_NORMAL_TYPE,t=Math.floor(6*Math.random())+2;void 0!=this._tornado&&(e=this._tornado.getTriggerType(),t=this._tornado.color),this._tweenFrames=Math.ceil(this._tweenDuration/xyd.DeltaTime),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.TORNADO_SWING,!1,{fromEle:this._fromEle,from:this._startPos,to:this._targetPos,duration:this._tweenDuration,color:t,type:e})},e.prototype.update=function(){return this._tweenFrames>0&&(this._tweenFrames-=1,this._tweenFrames<=0&&(this._isTweenDone=!0)),this._delayFrames>0?void(this._delayFrames-=1):void(this._isTweenDone&&(this.hasArrived?this.hasArrived&&!this._hasVanished&&(this._hasVanished=!0):(this._hasArrived=!0,this._justArrived=!0)))},e.prototype.getTornado=function(){return this._tornado},e.prototype.getTargetPos=function(){return this._targetPos},Object.defineProperty(e.prototype,"hasVanished",{get:function(){return this._hasVanished},set:function(e){this._hasVanished=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasArrived",{get:function(){return this._hasArrived},set:function(e){this._hasArrived=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"justArrived",{get:function(){return this._justArrived},set:function(e){this._justArrived=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTrigger",{get:function(){return this._isTrigger},set:function(e){this._isTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultScore",{get:function(){return this._defaultScore},set:function(e){this._defaultScore=e},enumerable:!0,configurable:!0}),e.prototype.onTweenDone=function(){this._isTweenDone=!0},e}();__reflect(TornadoAlley.prototype,"TornadoAlley");var TornadoTargetConst=function(){function e(){}return e.EMPTY=0,e.TIMEBOMB_COUNTDOWN=4001,e.SHACKLE_LOCKED_CLOUD=4002,e.SHACKLE_LOCKED_LAMP=4003,e.ICE_LOCKED_LAMP=4004,e.LAMP_UPWARD=4005,e.TIMEBOMB_GONNA_EXPLODE=4006,e}();__reflect(TornadoTargetConst.prototype,"TornadoTargetConst");var TornadoTargetFinderLeaf=function(){function e(e,t,i,n,o){void 0===o&&(o=[]),this._board=e,this._leafFacade=t,this._tornadoHandler=i,this._isSpecialType=n,this._avoidTargets=o}return e.prototype.getTargets=function(e){var t=[];return this._selectRandomTargetWithLeaf(e,t),this._selecteRandomTarget(e,t),t},e.prototype._selectRandomTargetWithLeaf=function(e,t){var i=this;if(void 0!=this._leafFacade){var n=this._leafFacade.getAllLeaves();xyd.shuffleArray(n,function(){return i._board.randomDouble()});for(var o=Math.min(e,n.length),a=0;o>a;){var s=n[a],r=s.getCol(),l=s.getRow();this._tornadoHandler.isUniqueTarget(r,l)&&this._isValidTarget(r,l,!0)?t.push(new egret.Point(r,l)):(n.splice(a--,1),o=Math.min(e,n.length)),a++}}},e.prototype._selecteRandomTarget=function(e,t){var i=this,n=e-t.length;if(n=Math.max(n,0),!(1>n)){for(var o=[],a=this._board.getBoardCols(),s=this._board.getBoardRows(),r=0;a>r;r++)for(var l=0;s>l;l++)this._board.isVoidCell(r,l)||o.push(r+l*a);xyd.shuffleArray(o,function(){return i._board.randomDouble()});for(var _=0;_<o.length;_++){var h=o[_],c=Math.floor(h%a),d=Math.floor(h/a);if(this._tornadoHandler.isUniqueTarget(c,d)&&this._isValidTarget(c,d)){for(var p=!1,u=0,m=t;u<m.length;u++){var g=m[u];g.x==c&&g.y==d&&(p=!0)}if(!p&&(t.push(new egret.Point(c,d)),--n<=0))break}}}},e.prototype._isValidTarget=function(e,t,i){if(void 0===i&&(i=!1),this._board.isVoidCell(e,t))return!1;if(this._isSpecialType&&void 0!=this._board.getBlockerAtGrid(e,t))return!1;if(this._shouldAvoid(e,t))return!1;var n=this._board.getElementAtGrid(e,t);if(n){if(!this.canBetargetedByTornado(n))return!1;if(n.hasGiftWrapper())return!1}else{var o=this._board.getBlockerAtGrid(e,t);if(o&&o.hasGiftWrapper())return!1;if(this._leafFacade&&this._leafFacade.getNumLayersAtGrid(e,t)<1)return!1;if(void 0==o)return i?!0:!1}return!0},e.prototype._shouldAvoid=function(e,t){for(var i=0,n=this._avoidTargets;i<n.length;i++){var o=n[i];if(o.x==e&&o.y==t)return!0}return!1},e.prototype.canBetargetedByTornado=function(e){return void 0==e?!1:0==e.canBeDestroyed()?!1:e.type==ElementTypeConstants.BALLOON?!1:!0},e}();__reflect(TornadoTargetFinderLeaf.prototype,"TornadoTargetFinderLeaf");var TornadoTargetFinderRanked=function(){function e(e,t,i){this._scoredTargetList=[],this._otherTargetList=[],this._board=e,this._leafFacade=t,this._tornadoHandler=i}return e.prototype.getTargets=function(e){var t=this;this._scanBoardForTargets(),xyd.shuffleArray(this._scoredTargetList,function(){return t._board.randomDouble()}),this._scoredTargetList.sort(function(e,t){return t.getScore()-e.getScore()});for(var i=[],n=0;n<this._scoredTargetList.length&&e>n;n++)i.push(this._scoredTargetList[n].getLoc());if(e>n){var o=e-n;for(n=0,xyd.shuffleArray(this._otherTargetList,function(){return t._board.randomDouble()});n<this._otherTargetList.length&&o>n;n++)i.push(this._otherTargetList[n].getLoc())}return i},e.prototype._scanBoardForTargets=function(){this._scoredTargetList=[],this._otherTargetList=[];for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getGridContainerAt(e,t),n=this._board.getGridContainerAt(e,t-1),o=0;this._leafFacade&&(o=this._leafFacade.getNumLayersAtGrid(e,t));if(this._tornadoHandler.isUniqueTarget(e,t)){var a=new TornadoTargetScoreAssigner(i,n,o),s=a.getScore();if(0>=s)continue;var r=new TornadoTarget(new egret.Point(e,t),s);1==s?this._otherTargetList.push(r):this._scoredTargetList.push(r)}}},e}();__reflect(TornadoTargetFinderRanked.prototype,"TornadoTargetFinderRanked");var TornadoTarget=function(){function e(e,t){this._loc=e,this._score=t}return e.prototype.getLoc=function(){return this._loc},e.prototype.getScore=function(){return this._score},e}();__reflect(TornadoTarget.prototype,"TornadoTarget");var TornadoTargetScoreAssigner=function(){function e(e,t,i){this.DEFAULT_SCORE=1,this.COMMON_FACTOR=.05,this.SPECIAL_SCORE=20,this.SPECIAL_NUM=3,this.RANKING=[TornadoTargetConst.TIMEBOMB_COUNTDOWN,TornadoTargetConst.SHACKLE_LOCKED_CLOUD,CellConstants.NORMAL_ELEMENT,CellConstants.BLACK_HOLE,CellConstants.BOMB_COL,CellConstants.BOMB_ROW,CellConstants.BOMB_SQUARE,CellConstants.LUCKY_BAG,CellConstants.TORNADO,CellConstants.SCISSOR,CellConstants.ICE,CellConstants.BOX,CellConstants.SLATE,CellConstants.CAKE_1,CellConstants.CAKE_2,CellConstants.CAKE_3,CellConstants.CAKE_4,CellConstants.CAKE_5,CellConstants.LAYED_SLATE_1,CellConstants.SHACKLE,CellConstants.CLOUD,CellConstants.LAYED_SLATE_2,CellConstants.LAYED_SLATE_3,CellConstants.LAYED_SLATE_4,CellConstants.LAYED_SLATE_5,CellConstants.GOLDEN_EGG,CellConstants.LEAF_1,CellConstants.LEAF_2,CellConstants.COLOR_MIXER_5,TornadoTargetConst.LAMP_UPWARD,TornadoTargetConst.SHACKLE_LOCKED_LAMP,CellConstants.PUZZLE,CellConstants.TIME_BOMB,TornadoTargetConst.TIMEBOMB_GONNA_EXPLODE],this._cellType=0,this._score=0,this._scoreList=[],this._curGridCont=e,this._upwardGridCont=t,this._numOfleaves=i,this._curGridCont&&(this._cellType=this._curGridCont.getCellConst()),this._computeScore()}return e.prototype.getScore=function(){return this._score},e.prototype._computeScore=function(){var e=this._addLockScore();if(this._addLeafScore(),this._addLampScore(),this._addElementAndBlockerScore(e),(this._cellType==CellConstants.BALLOON_1||this._cellType==CellConstants.BALLOON_2||this._cellType==CellConstants.BALLOON_3)&&(this._score=0),this._cellType!=CellConstants.LAMP1&&this._cellType!=CellConstants.LAMP2||e||(this._score=0),0==this._scoreList.length)this._score=0;else{this._score=1;for(var t=0,i=this._scoreList;t<i.length;t++){var n=i[t];this._score*=n}}},e.prototype._addLockScore=function(){if(!this._curGridCont||!this._curGridCont.isLocked())return!1;var e=this._curGridCont.getLockType();if(this._curGridCont.hasElement()){var t=this._curGridCont.getElement();t.type==ElementTypeConstants.LAMP_1||t.type==ElementTypeConstants.LAMP_2?e==LOCK_TYPE.SHACKLE?this._addScoreForType(TornadoTargetConst.SHACKLE_LOCKED_LAMP):e==LOCK_TYPE.ICE&&this._addScoreForType(TornadoTargetConst.ICE_LOCKED_LAMP):e==LOCK_TYPE.SHACKLE?this._addScoreForType(CellConstants.SHACKLE):e==LOCK_TYPE.ICE?this._addScoreForType(CellConstants.ICE):e==LOCK_TYPE.GIFT_WRAPPER}else if(this._curGridCont.hasBlocker()){var i=this._curGridCont.getBlocker();i.type==BlockerConstant.CLOUD&&e==LOCK_TYPE.SHACKLE?this._addScoreForType(TornadoTargetConst.SHACKLE_LOCKED_CLOUD):e==LOCK_TYPE.GIFT_WRAPPER}return!0},e.prototype._addLeafScore=function(){1==this._numOfleaves?this._addScoreForType(CellConstants.LEAF_1):2==this._numOfleaves&&this._addScoreForType(CellConstants.LEAF_2)},e.prototype._addLampScore=function(){if(this._curGridCont&&this._upwardGridCont){var e=this._upwardGridCont.getElement();!e||e.type!=ElementTypeConstants.LAMP_1&&e.type!=ElementTypeConstants.LAMP_2||this._addScoreForType(TornadoTargetConst.LAMP_UPWARD)}},e.prototype._addTimeBombScore=function(){var e=this._curGridCont.getElement();if(e){var t=e.getTicksToExplode();1==t&&this._addScoreForType(TornadoTargetConst.TIMEBOMB_GONNA_EXPLODE);var i=0;99>t&&(i=99-t);for(var n=0,o=0;i>o;o++)n+=this._getScoreForType(TornadoTargetConst.TIMEBOMB_COUNTDOWN);this._addScore(n)}},e.prototype._addElementAndBlockerScore=function(e){this._curGridCont&&((this._cellType==CellConstants.PUZZLE||this._cellType==CellConstants.PUZZLE_3||this._cellType==CellConstants.PUZZLE_2)&&(this._cellType=CellConstants.PUZZLE),this._cellType==CellConstants.TIME_BOMB&&this._addTimeBombScore(),(!e||this._cellType!=CellConstants.BOMB_COLOR&&this._cellType!=CellConstants.LAMP1&&this._cellType!=CellConstants.LAMP2)&&(this._numOfleaves>0&&(this._cellType==CellConstants.BOMB_COL||this._curGridCont.isEmpty())||this._addScoreForType(this._cellType)))},e.prototype._addScoreForType=function(e){var t=this._getScoreForType(e);this._addScore(t)},e.prototype._addScore=function(e){e>=0&&this._scoreList.push(e)},e.prototype._getScoreForType=function(e){var t=this.RANKING.indexOf(e);if(0>t)return 0;var i=this.DEFAULT_SCORE+t*this.COMMON_FACTOR;return this.RANKING.length-this.SPECIAL_NUM<=t&&(i+=this.SPECIAL_SCORE),i},e}();__reflect(TornadoTargetScoreAssigner.prototype,"TornadoTargetScoreAssigner");var FallingHandler=function(){function e(e,t){this._board=e,this._paths=[],this._portalHandler=t}return e.prototype.update=function(){for(var e=this._countFallingElements(),t=0,i=this._paths;t<i.length;t++){var n=i[t];this._updatePath(n)}for(var o=0;o<this._board.getBoardRows();o++)for(var a=0;a<this._board.getBoardCols();a++)if(!this._board.isStaticCell(a,o)){var s=this._board.getElementAtGrid(a,o);!s||s.busy||s.isDead()||s.shouldNotFall||this._trySlide(s)}this.isFalling()||e>0&&this._board.didUnstableAction()},e.prototype.rebuildPathByCol=function(e){var t=this._extractPathByCol(e);this._createNewPathByCol(e),this._moveElementsFromTmpToNew(t)},e.prototype.getPathByCol=function(e){for(var t=[],i=0;i<this._paths.length;i++){var n=this._paths[i];n.getStartPoint().x==e&&t.push(n)}return t},e.prototype._extractPathByCol=function(e){for(var t=[],i=[],n=0;n<this._paths.length;n++){var o=this._paths[n];o.getStartPoint().x==e?i.push(o):t.push(o)}return this._paths=t,i},e.prototype._createNewPathByCol=function(e){for(var t=0,i=this._board.getBoardRows();i>t;t++)!this._board.isStaticCell(e,t)&&this._board.isStaticCell(e,t-1)?this._paths.push(new FallingPath(new egret.Point(e,t))):this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.UP)&&this._paths.push(new FallingPath(new egret.Point(e,t)))},e.prototype._moveElementsFromTmpToNew=function(e){for(var t,i=0,n=e;i<n.length;i++){var o=n[i],a=o.getStartPoint();t=this.getPathByPoint(a.x,a.y);for(var s=0,r=o.getElements();s<r.length;s++){var l=r[s];if(void 0==t)l.isInFallingPath=!1,this._board.removeElement(l),console.log("removed element since unable to find falling column when rebuild");else{var _=this.getPathByPoint(l.col,l.row),h=t;void 0!=_&&_!=t&&_.getStartPoint().y>t.getStartPoint().y&&l.y>=_.getStartPoint().y&&(h=_),h.hasSpaceForInsertElement(l)?h.insertElement(l):(this._board.removeElement(l),console.log("removed element since unable to insert into falling column when rebuild"))}}}},e.prototype._removeElementsFromTmpPath=function(e){for(var t=e.getElements(),i=0,n=t;i<n.length;i++){var o=n[i];o.isInFallingPath=!1,this._board.removeElement(o)}},e.prototype._insertElementsAndRemoveRestFromTmpPath=function(e,t){for(var i=e.getElements(),n=0,o=i;n<o.length;n++){var a=o[n];t.hasSpaceForInsertElement(a)?t.insertElement(a):this._board.removeElement(a)}},e.prototype.isFalling=function(){for(var e,t=0,i=this._paths;t<i.length;t++)if(e=i[t],!e.isEmpty())return!0;return!1},e.prototype.getPathByPoint=function(e,t){for(var i,n,o,a,s=0,r=this._paths;s<r.length;s++)a=r[s],i=a.getStartPoint(),i.x==e&&(i.y<=t?(void 0==n||t-i.y<t-n.getStartPoint().y)&&(n=a):(void 0==o||i.y-t<o.getStartPoint().y-t)&&(o=a));return void 0!=n?n:o},e.prototype.getPathByElement=function(e){for(var t=0,i=this._paths;t<i.length;t++){var n=i[t];if(n.getElements().indexOf(e)>=0)return n}},e.prototype.integrateFallingElements=function(){for(var e=0,t=this._paths;e<t.length;e++)for(var i=t[e],n=0,o=i.getElements();n<o.length;n++){var a=o[n];if(!a.isDestroyed()){var s=a.col,r=a.row;if(a.y>=i.getStartPoint().y&&this._board.isValidGridPos(s,r)){var l=this._board.getIntergratedElementAt(s,r);l&&l.id!=a.id?a.type!=ElementTypeConstants.LAMP_1&&a.type!=ElementTypeConstants.LAMP_2&&(this._board.removeElement(a,!0),logger.errorStr("Has to remove element for board intergrity "+s+","+r)):this._board.setIntegratedElementAt(s,r,a)}}}},e.prototype._updatePath=function(e){var t=e.getElements(),i=e.isFalling();if(i)for(var n=t.length-1;n>=0;n--){var o=t[n];this._updateFallingElement(e,o)}else for(var n=0;n<t.length;n++){var o=t[n];this._updateFallingElement(e,o)}for(var a=0,s=t;a<s.length;a++){var o=s[a];o&&o.isInFallingPath&&0==o.ya&&o.getFramesInPath()>60*xyd.frameScale&&o.type!=ElementTypeConstants.LAMP_1&&o.type!=ElementTypeConstants.LAMP_2&&(this._board.removeElement(o,!0),console.log("Has to remove element stay too long in path"))}},e.prototype._handleElementOffBoard=function(e,t){t.row<e.getStartPoint().y&&t.type!=ElementTypeConstants.LAMP_1&&t.type!=ElementTypeConstants.LAMP_2&&this._board.removeElement(t)},e.prototype._tryToSettleElement=function(e){if(!(e.y<0)){var t=this.getPathByElement(e);if(!(t&&e.y<t.getStartPoint().y)){var i=this._isElementBelowStable(e)&&!this._board.isStaticCell(e.x,e.y);i&&this._settleElement(e,e.x,e.y)}}},e.prototype._settleElement=function(e,t,i){var n=this._board.getElementAtGrid(t,i);if(!n){e.ya=0;var o=this.getPathByElement(e);o&&o.removeElement(e),this._board.setElementAtGrid(e.col,e.row,e),e.view.updatePos(e.col,e.row)}},e.prototype._isElementBelowStable=function(e){return e.y+.51>=this._getLowestFall(e)||void 0!=this._board.getElementAtGrid(e.col,e.y+.51)},e.prototype._getLowestFall=function(e){for(var t=void 0,i=e.y;;){if(t=i+1,void 0!=this._board.getElementAtGrid(e.col,t))break;if(this._board.isStaticCell(e.col,t))return i;i=t}return i},e.prototype._canFall=function(e,t){return e.canFall(t)&&this._canElementFall(t)?!0:!1},e.prototype._canElementFall=function(e){if(this._board.getCellFenceAtGridInDir(e.col,e.row,CellEdgesDirection.DOWN))return!1;var t=this.getPathByElement(e);if(t&&e.y<=t.getStartPoint().y-.5)return!0;if(this._checkUpwardCollision(e))return!1;if(e.y+e.ya>=0&&this._board.isStaticCell(e.x,e.y+e.ya+.5))return!1;var i=e.col,n=Math.floor(e.y+e.ya+.5);return void 0!=this._board.getElementAtGrid(i,n)||this._board.isStaticCell(i,n)?!1:!0},e.prototype._checkUpwardCollision=function(e){return e.ya<0&&e.y>1&&this._board.isStaticCell(e.x,e.y-.5)?!0:!1},e.prototype._updateFallingElement=function(e,t){if(!t.shouldNotFall&&!t.busy&&!t.isDead()&&e.canFall(t)){var i=!1;if(this._board.isStaticCell(t.col,t.row+1)?i=!0:void 0!=this._board.getElementAtGrid(t.col,t.row+1)?i=!0:void 0==this._board.getCellFenceAtGridInDir(t.col,t.row,CellEdgesDirection.DOWN)||t.isTeleporting()?(t.move(),(this._board.isStaticCell(t.col,t.row+1)||void 0!=this._board.getElementAtGrid(t.col,t.row+1))&&(i=!0)):i=!0,i&&(t.view.updatePos(t.col,t.row),0==this._trySlide(t)))if(t.ya=0,this._board.isStaticCell(t.col,t.row))t.row<e.getStartPoint().y&&void 0==this._board.getCellFenceAtGridInDir(t.col,t.row,CellEdgesDirection.DOWN)&&t.type!=ElementTypeConstants.LAMP_1&&t.type!=ElementTypeConstants.LAMP_2&&(this._board.removeElement(t,!0),console.log("Has to remove element at static position "+t.col+","+t.row));else{var n=this.getPathByElement(t);n&&n.removeElement(t),this._board.setElementAtGrid(t.col,t.row,t,!0),t.view.updatePos(t.col,t.row),t.view.setSelect(!1),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ELEMENT_REACH_END,!1,t)}}},e.prototype._trySlide=function(e){if(e.busy||e.isDead())return!1;if(e.type==ElementTypeConstants.LAMP_1||e.type==ElementTypeConstants.LAMP_2){var t=this._board.getCell(e.row,e.col);if(t&&t.hasProperty(CellConstants.LAMP_OUT))return!1}var i=void 0;return this._canSlide(e,1)?i=this._getSlideEndPos(e,1):this._canSlide(e,-1)&&(i=this._getSlideEndPos(e,-1)),void 0!=i?(this._slideELement(e,i.x,i.y),!0):!1},e.prototype._slideELement=function(e,t,i){var n=Math.sqrt(Math.pow(e.col-t,2)+Math.pow(e.row-i,2)),o=Math.floor(4*Math.max(n,1)),a=Math.max(xyd.MAX_YA,e.ya+o*xyd.G);e.slideTo(t,i,o,function(){});var s=this.getPathByElement(e);s&&s.removeElement(e),this._board.setElementAtGrid(t,i,e,!0),e.ya=a},e.prototype._canSlide=function(e,t){if(!this._board.isBeltMoving()){if(e.busy||e.locked)return!1;if(!this._isAllowToSlide(e.col,Math.floor(e.y),t))return!1;if(this._portalHandler.portals.length>0)for(var i=e.row+1;i<this._board.getBoardRows();i++){if(this._board.isStaticCell(e.col,i))return!0;if(!this._portalHandler.isAllowToSlideBelowExitPoint(e.col,i))return!1}return!0}},e.prototype._getSlideEndPos=function(e,t){if(!e.busy&&!e.locked){for(var i=e.col,n=e.row;this._isAllowToSlide(i,n,t);)i+=t,n+=1;return new egret.Point(i,n)}},e.prototype._isAllowToSlide=function(e,t,i){var n=e+i,o=t+1;if(!this._board.isStaticCell(e,o)&&void 0==this._board.getElementAtGrid(e,o))return!1;if(1==i){if(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.RIGHT)&&(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.DOWN)||this._board.getCellFenceAtGridInDir(e+1,t+1,CellEdgesDirection.LEFT)))return!1;if(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.DOWN))return!1;if(this._board.getCellFenceAtGridInDir(e+1,t+1,CellEdgesDirection.UP)&&this._board.getCellFenceAtGridInDir(e+1,t+1,CellEdgesDirection.LEFT))return!1}else if(-1==i){if(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.LEFT)&&(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.DOWN)||this._board.getCellFenceAtGridInDir(e-1,t+1,CellEdgesDirection.RIGHT)))return!1;if(this._board.getCellFenceAtGridInDir(e,t,CellEdgesDirection.DOWN))return!1;if(this._board.getCellFenceAtGridInDir(e-1,t+1,CellEdgesDirection.UP)&&this._board.getCellFenceAtGridInDir(e-1,t+1,CellEdgesDirection.RIGHT))return!1}if(this._board.isStaticCell(n,o)||this._board.getElementAtGrid(n,o))return!1;var a=this.getPathByPoint(n,o);if(void 0==a)return!0;for(var s=0,r=a.getElements();s<r.length;s++){var l=r[s];if(l.row<=o)return!1}if(this._portalHandler.isExitPortal(n,o)){var _=this._portalHandler.getExitPortalAt(n,o),h=_.enterPoint,c=this._board.getElementAtGrid(h.x,h.y);if(void 0!=c&&!c.locked)return!1;var d=this.getPathByPoint(h.x,h.y);if(d&&d.getSize()>0)return!1}var p=this._board.getGeneratorAt(n,o);if(void 0!=p&&p.canGenerateNormal())return!1;for(;o>=0;){var u=this._board.getElementAtGrid(n,o);if(u&&0==u.isLocked()&&!u.isSticky())return this._board.getCellFenceAtGridInDir(u.col,u.row,CellEdgesDirection.DOWN)?!0:u.shouldNotPreventSlide?!0:!1;if(this._board.isStaticCell(n,o))return!0;o-=1}return!0},e.prototype._countFallingElements=function(){for(var e,t=0,i=0,n=this._paths;i<n.length;i++)e=n[i],t+=e.getSize();return t},e}();__reflect(FallingHandler.prototype,"FallingHandler");var FallingPath=function(){function e(e){this._elements=[],this._startPoint=e}return e.prototype.insertElement=function(e){var t,i=this._elements.length;for(t=i;t>0;t--){if(e.y==this._elements[t-1].y)return!1;if(e.y>this._elements[t-1].y)break}return this._elements.splice(t,0,e),e.isInFallingPath=!0,!0},e.prototype.removeElement=function(e){var t=this._elements.indexOf(e);this._elements.splice(t,1),e.isInFallingPath=!1},e.prototype.getElementAt=function(e){return e>=this._elements.length?void 0:this._elements[e]},e.prototype.getElements=function(){return this._elements},e.prototype.getStartPoint=function(){return this._startPoint},e.prototype.canFall=function(e){var t=this._elements.indexOf(e);return 0>t?(console.log("ERROR: element not found in falling path"),!1):t==this._elements.length-1?!0:e.y+e.ya+.9999<=this._elements[t+1].y?!0:!1},e.prototype.hasSpaceForInsertElement=function(e){if(this._elements.length>0&&e.y<this._startPoint.y&&this._elements[0].y<this._startPoint.y+1e-4)return!1;for(var t,i=0,n=this._elements;i<n.length;i++)if(t=n[i],e.row==t.row)return!1;
return!0},e.prototype.isEmpty=function(){return 0==this._elements.length},e.prototype.isFalling=function(){for(var e=0;e<this._elements.length;e++)if(this._elements[e].ya<=0)return!1;return!0},e.prototype.getSize=function(){return this._elements.length},e.prototype.preventFalling=function(){for(var e=0,t=this._elements;e<t.length;e++){var i=t[e];i.shouldNotFall=!0}},e.prototype.enableFalling=function(){for(var e=0,t=this._elements;e<t.length;e++){var i=t[e];i.shouldNotFall=!1}},e}();__reflect(FallingPath.prototype,"FallingPath");var BlackHoleGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BLACK_HOLE).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BLACK_HOLE);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BLACK_HOLE)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BlackHoleGeneratorHandler.prototype,"BlackHoleGeneratorHandler");var BombColGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BOMB_COL).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BOMB_COL);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BOMB_COL)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BombColGeneratorHandler.prototype,"BombColGeneratorHandler");var BombColorGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._lastMove=0,o._lastGenerate=0,o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BOMB_COLOR).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BOMB_COLOR);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BOMB_COLOR)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BombColorGeneratorHandler.prototype,"BombColorGeneratorHandler");var BombLineGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BOMB_COL).length+t.getElementsOfType(ElementTypeConstants.BOMB_ROW).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BOMB_COL)+t.getRequestNumOfType(ElementTypeConstants.BOMB_ROW);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){var e=this._board.random(0,1)%2==0?ElementTypeConstants.BOMB_COL:ElementTypeConstants.BOMB_ROW;this._board.addDropElementType(e)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BombLineGeneratorHandler.prototype,"BombLineGeneratorHandler");var BombRowGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._movesNeedToGenerate=Math.max(o._movesNeedToGenerate,1),o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BOMB_ROW).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BOMB_ROW);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BOMB_ROW)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BombRowGeneratorHandler.prototype,"BombRowGeneratorHandler");var BombSquareGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._lastMove=0,o._lastGenerate=0,o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.BOMB_SQUARE).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.BOMB_SQUARE);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove),this._lastMove=this._curMove}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BOMB_SQUARE)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BombSquareGeneratorHandler.prototype,"BombSquareGeneratorHandler");var BoxGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._removedBoxInCurrentStep=!1,o._removedBoxInCurrentSwap=!1,o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BOX,this._onRemoveBox,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onBoardStable=function(){this._removedBoxInCurrentSwap=this._removedBoxInCurrentStep,this._removedBoxInCurrentStep=!1,this._board.removeDropElementType(ElementTypeConstants.BOX)},t.prototype._onRemoveBox=function(e){this._lastMove=this._curMove;var t=(e.data.ele,e.data.match);void 0!=t.swap?(this._removedBoxInCurrentSwap=!0,this._board.removeDropElementType(ElementTypeConstants.BOX)):(this._removedBoxInCurrentStep=!0,this._board.removeDropElementType(ElementTypeConstants.BOX))},t.prototype._onRemoveElement=function(e){var t=e.data.ele;if(t.type==ElementTypeConstants.BOX&&t.getDamageSource()!=DamageSource.ADJACENT_MATCH&&(this._removedBoxInCurrentStep=!0),!this._removedBoxInCurrentSwap){var i=this._board,n=i.getElementsOfType(ElementTypeConstants.BOX).length,o=i.getRequestNumOfType(ElementTypeConstants.BOX);if(this._lastMove!=this._curMove)for(var a=this._maxNumOnBoard-n-o,s=0;a>s;s++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove),this._lastMove=this._curMove}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.BOX)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BOX,this._onRemoveBox,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(BoxGeneratorHandler.prototype,"BoxGeneratorHandler");var CakeGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},t.prototype._onSwitchMade=function(){this._curMove++;var e=this._board,t=e.getElementsOfType(ElementTypeConstants.CAKE).length;if(!(this._maxNumOnBoard>0&&t>=this._maxNumOnBoard)){var i=e.getRequestNumOfType(ElementTypeConstants.CAKE);if(this._lastMove!=this._curMove)for(var n=this._maxNumOnBoard-t-i,o=0;n>o;o++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastMove=this._curMove)}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.CAKE)},t.prototype._onBoardStable=function(){this._board.removeDropElementType(ElementTypeConstants.CAKE)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},t}(GeneratorHandler);__reflect(CakeGeneratorHandler.prototype,"CakeGeneratorHandler");var Generator=function(){function e(e,t,i){this._canGenerateNormal=!1,this._row=e,this._col=t,this._types=[];for(var n=0,o=CellConstants.GENERATOR_SET;n<o.length;n++){var a=o[n];i.hasProperty(a)&&(this._types.push(a),a==CellConstants.GENERATOR_ELEMENT&&(this._canGenerateNormal=!0))}}return e.prototype.createGeneratorView=function(){if(this._types.length>0){if(1==this._types.length&&this._types[0]==CellConstants.GENERATOR_ELEMENT)return;xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_GENERATOR,!0,!1,{row:this._row,col:this._col,types:this._types}))}},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),e.prototype.getPos=function(){return new egret.Point(this._col,this._row)},e.prototype.getTypes=function(){return this._types},e.prototype.canGenerateElement=function(e){if(0==this._types.length)return!0;var t=GeneratorConstant.GENERATOR_MAP[e];return void 0==t?this._checkGeneratorOfType(CellConstants.GENERATOR_ELEMENT):t==CellConstants.GENERATOR_BOMB_COL?this._checkGeneratorOfType(CellConstants.GENERATOR_BOMB_COL)||this._checkGeneratorOfType(CellConstants.GENERATOR_BOMB_LINE):t==CellConstants.GENERATOR_BOMB_ROW?this._checkGeneratorOfType(CellConstants.GENERATOR_BOMB_ROW)||this._checkGeneratorOfType(CellConstants.GENERATOR_BOMB_LINE):this._checkGeneratorOfType(t)},e.prototype._checkGeneratorOfType=function(e){return this._types.indexOf(e)>-1?!0:!1},e.prototype.canGenerateNormal=function(){return this._canGenerateNormal},e}();__reflect(Generator.prototype,"Generator");var SpriteFrame=function(e){function t(){var t=e.call(this)||this;return t.frameCount_=0,t.nextFrameCount_=0,t.nowFrame_=0,t.isDispose_=!1,t.isSetTimeOut=!1,t.isLight_=!1,t.bHighLight=!1,t.lightFrame_=0,t.scale_=1,t.wait_=0,t.isPaused=!1,t._imgPool=[],t._containerPool=[],t}return __extends(t,e),t.prototype.childrenCreated=function(){},t.prototype.loadFrame=function(e,t,i,n,o,a,s,r){this.fileName_!=t&&(this.removeChildren(),this.img_=new egret.Bitmap,RES.loadGroup(e),this.resName_=e,this.fileName_=t,this.frameCount_=i,this.frameInerval_=n,this.nextResName_=o,this.nextFileName_=a,this.nextFrameCount_=s,this.nextFrameInerval_=r,this.nowFrame_>=this.frameCount_&&(this.nowFrame_=0),xyd.setBitmapAsync(this.img_,this.fileName_+Math.floor(this.nowFrame_),function(){this.img_.scaleX=this.scale_,this.img_.scaleY=this.scale_}.bind(this)),this.addChild(this.img_),this.isSetTimeOut||(egret.setTimeout(this.onUpdate,this,this.frameInerval_),this.isSetTimeOut=!0))},t.prototype.setHeightLight=function(e){this.isLight_=e,e||this.img_&&(this.img_.filters=[])},t.prototype.setScale=function(e){this.scale_=e,this.img_.scaleX=e,this.img_.scaleY=e},t.prototype.setWait=function(e){this.wait_=e},t.prototype.setComplete=function(e){this.callback_=e},t.prototype.onUpdate=function(){if(!this.isDispose_&&!this.isPaused){if(this.nowFrame_+=1,this.lightFrame_+=1,this.nowFrame_>=Math.round(this.frameCount_-1)){if(this.callback_)return this.callback_(),this.pause(),void this.dispose();if(this.nextResName_&&(this.resName_=this.nextResName_,this.fileName_=this.nextFileName_,this.frameCount_=this.nextFrameCount_,this.frameInerval_=this.nextFrameInerval_,this.loadFrame(this.resName_,this.fileName_,Math.floor(this.frameCount_),this.frameInerval_),this.nextResName_=void 0),this.nowFrame_=0,this.wait_>0)return this.img_.texture=void 0,void egret.setTimeout(this.onUpdate,this,this.wait_)}this.nowFrame_>=this.frameCount_&&(this.nowFrame_=0),this.lightFrame_>=10&&(this.lightFrame_=0,this.isLight_&&(this.bHighLight?(this.img_.filters=[xyd.lightFilter],this.bHighLight=!1):(this.img_.filters=[],this.bHighLight=!0))),xyd.setBitmapAsync(this.img_,this.fileName_+Math.floor(this.nowFrame_),function(){this.img_.scaleX=this.scale_,this.img_.scaleY=this.scale_}.bind(this)),this.isDispose_||egret.setTimeout(this.onUpdate,this,this.frameInerval_)}},t.prototype.reStart=function(){this.isDispose_=!1,this.nowFrame_=0,this.lightFrame_=0,this.isSetTimeOut||(egret.setTimeout(this.onUpdate,this,this.frameInerval_),this.isSetTimeOut=!0)},t.prototype.pause=function(){this.isPaused=!0,this.isSetTimeOut=!1},t.prototype.resume=function(e){void 0===e&&(e=!0),e&&(this.nowFrame_=0,this.lightFrame_=0),this.isPaused=!1,this.isDispose_=!1,this.isSetTimeOut||(egret.setTimeout(this.onUpdate,this,this.frameInerval_),this.isSetTimeOut=!0)},t.prototype.dispose=function(){this.isSetTimeOut=!1,this.isDispose_=!0,this.parent&&this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);__reflect(SpriteFrame.prototype,"SpriteFrame");var GeneratorHandlerFactory=function(){function e(){this._createHandler={},this._createHandler=(e={},e[CellConstants.BOX]=this._getBoxGeneratorHandler,e[CellConstants.TIME_BOMB]=this._getTimeBombGeneratorHandler,e[CellConstants.LUCKY_BAG]=this._getLuckyBagGeneratorHandler,e[CellConstants.GOLDEN_EGG]=this._getGoldenEggGeneratorHandler,e[CellConstants.BLACK_HOLE]=this._getBlackHoleGeneratorHandler,e[CellConstants.GENERATOR_BOMB_LINE]=this._getBombLineGeneratorHandler,e[CellConstants.GENERATOR_BOMB_COL]=this._getBombColGeneratorHandler,e[CellConstants.GENERATOR_BOMB_ROW]=this._getBombRowGeneratorHandler,e[CellConstants.GENERATOR_BOMB_SQUARE]=this._getBombSquareGeneratorHandler,e[CellConstants.SCISSOR]=this._getScissorGeneratorHandler,e[CellConstants.CAKE_1]=this._getCakeGeneratorHandler,e[CellConstants.BOMB_COLOR]=this._getBombColorGeneratorHandler,e[CellConstants.TORNADO]=this._getTornadoGeneratorHandler,e);var e}return e.prototype._getBoxGeneratorHandler=function(e,t){return new BoxGeneratorHandler(e.movesNeedToGenerateBox,e.maxBoxNumOnBoard,t)},e.prototype._getScissorGeneratorHandler=function(e,t){return new ScissorGeneratorHandler(e.movesNeedToGenerateScissor,e.maxScissorNumOnBoard,t)},e.prototype._getCakeGeneratorHandler=function(e,t){return new CakeGeneratorHandler(e.movesNeedToGenerateCake,e.maxCakeNumOnBoard,t)},e.prototype._getTimeBombGeneratorHandler=function(e,t){return new TimeBombGeneratorHandler(e.movesNeedToGenerateTimeBomb,e.maxTimeBombNumOnBoard,t)},e.prototype._getLuckyBagGeneratorHandler=function(e,t){return new LuckyBagGeneratorHandler(e.movesNeedToGenerateLuckyBag,e.maxLuckyBagNumOnBoard,t)},e.prototype._getBlackHoleGeneratorHandler=function(e,t){return new BlackHoleGeneratorHandler(e.movesNeedToGenerateBlackHole,e.maxBlackHoleNumOnBoard,t)},e.prototype._getBombLineGeneratorHandler=function(e,t){return new BombLineGeneratorHandler(e.movesNeedToGenerateBombLine,e.maxBombLineNumOnBoard,t)},e.prototype._getBombRowGeneratorHandler=function(e,t){return new BombRowGeneratorHandler(e.movesNeedToGenerateBombCol,e.maxBombColNumOnBoard,t)},e.prototype._getBombColGeneratorHandler=function(e,t){return new BombColGeneratorHandler(e.movesNeedToGenerateBombCol,e.maxBombColNumOnBoard,t)},e.prototype._getBombSquareGeneratorHandler=function(e,t){return new BombSquareGeneratorHandler(e.movesNeedToGenerateBombSquare,e.maxBombSquareNumOnBoard,t)},e.prototype._getGoldenEggGeneratorHandler=function(e,t){return new GoldenEggGeneratorHandler(e.movesNeedToGenerateGoldenEgg,e.maxGoldenEggNumOnBoard,t)},e.prototype._getBombColorGeneratorHandler=function(e,t){return new BombColorGeneratorHandler(e.movesNeedToGenerateBombColor,e.maxBombColorNumOnBoard,t)},e.prototype._getTornadoGeneratorHandler=function(e,t){return new TornadoGeneratorHandler(e.movesNeedToGenerateTornado,e.maxTornadoNumOnBoard,t)},e.prototype.create=function(e,t,i){return this._createHandler[e]?this._createHandler[e](t,i):void 0},e}();__reflect(GeneratorHandlerFactory.prototype,"GeneratorHandlerFactory");var GoldenEggGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.GOLDEN_EGG).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.GOLDEN_EGG);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.GOLDEN_EGG)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(GoldenEggGeneratorHandler.prototype,"GoldenEggGeneratorHandler");var LuckyBagGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._luckyBagManager=new LuckyBagManager(n),o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){this._checkIfOpenLuckyBag(e.data.ele);var t=this._board,i=t.getElementsOfType(ElementTypeConstants.LUCKY_BAG).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.LUCKY_BAG);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)}}},t.prototype._checkIfOpenLuckyBag=function(e){if(e&&e.type==ElementTypeConstants.LUCKY_BAG){var t=this._board.isBeltCell(e.x,e.y)||e.isTeleporting(),i=this._luckyBagManager.getRandomReplacement(t);this._openLuckyBag(e,i)}},t.prototype._openLuckyBag=function(e,t){this._checkAdjacentElement(e);var i=t.getType();if(t.isBlocker()){var n=this._board;if(i==BlockerConstant.LAYED_SLATE){var o=n.random(1,5);n.createNewBlockerAt(e.col,e.row,i,o)}else i==BlockerConstant.CLOUD&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.PUT_OFF_CLOUD),n.createNewBlockerAt(e.col,e.row,i);n.rebuildPathForColumn(e.col)}else{var a=this._board.getElementFactory().create(e.col,e.row,e.color,i);if(t.hasIce()){var s=new Lock(LOCK_TYPE.ICE);a.addLock(s)}e.destructionPack=new DPackSimple(this._board,e,a)}},t.prototype._checkAdjacentElement=function(e){for(var t=0,i=xyd.directions;t<i.length;t++){var n=i[t],o=e.col+n[0],a=e.row+n[1],s=this._board.getElementAtGrid(o,a);if(void 0!=s&&s.isLocked()&&!s.busy){var r=s.getLock();r.type==LOCK_TYPE.ICE&&this._board.removeLock(s)}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.LUCKY_BAG)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(LuckyBagGeneratorHandler.prototype,"LuckyBagGeneratorHandler");var ScissorGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._needScissor=!0,o._lastGenerate=0,o._shouldGenerateScissor=!1,o._justAddedForGenerator=!1,o._scissorJustRemoved=!1,o._scissorNeededForAll=0,o._initEvents(),o._checkHasGiftWrapperOnBoard(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onReplaceElement=function(e){if(this._needScissor){var t=e.data.oldEle;this._removeElement(t)}},t.prototype._onRemoveElement=function(e){if(this._needScissor){var t=e.data.ele;this._removeElement(t),e.data.force}},t.prototype._removeElement=function(e){if(e.type==ElementTypeConstants.SCISSOR){for(var t=this._board.getAllElements(),i=0,n=t;i<n.length;i++){var o=n[i];o.cutGiftWrapper()}for(var a=this._board.getAllBlockers(),s=0,r=a;s<r.length;s++){var l=r[s];l.cutGiftWrapper()}this._checkHasGiftWrapperOnBoard()}if(this._needScissor){var _=this._board.getElementsOfType(ElementTypeConstants.SCISSOR).length,h=this._board.getRequestNumOfType(ElementTypeConstants.SCISSOR);if(!(this._maxNumOnBoard>0&&(_>=this._maxNumOnBoard||h>=this._maxNumOnBoard))){this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove),h=this._board.getRequestNumOfType(ElementTypeConstants.SCISSOR);for(var c=this._maxNumOnBoard-_-h,d=0;c>d;d++)this._generateOnTop()}}},t.prototype._onBoardStable=function(){this._checkHasGiftWrapperOnBoard()},t.prototype._checkHasGiftWrapperOnBoard=function(){var e=0,t=this._board.getAllElements();this._scissorNeededForAll=0;for(var i=0,n=t;i<n.length;i++){var o=n[i];o.hasGiftWrapper()&&(e++,this._scissorNeededForAll=Math.max(o.getLock().health,this._scissorNeededForAll))}for(var a=this._board.getAllBlockers(),s=0,r=a;s<r.length;s++){var l=r[s];l.hasGiftWrapper()&&(e++,this._scissorNeededForAll=Math.max(l.getLock().health,this._scissorNeededForAll))}0==e&&(this._needScissor=!1,this._raplaceAllScissorsWithNormalElement())},t.prototype._raplaceAllScissorsWithNormalElement=function(){for(var e=this._board.getElementsOfType(ElementTypeConstants.SCISSOR),t=0,i=e;t<i.length;t++){var n=i[t],o=this._board.getElementFactory().create(n.x,n.y,n.color,ElementTypeConstants.NORMAL),a=n.getLock();a&&o.addLock(a);var s=this._board.getElementAtGrid(n.col,n.row);void 0!=s&&this._board.replaceBoardElement(o)}this._board.removeDropElementType(ElementTypeConstants.SCISSOR)},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.SCISSOR)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},t}(GeneratorHandler);__reflect(ScissorGeneratorHandler.prototype,"ScissorGeneratorHandler");var TimeBombGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._bookingCount=0,o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onStable,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_HAS_MATCHED,this._onMatched,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),this._onSwitchMade()},t.prototype._onSwitchMade=function(){var e=this._board,t=e.getElementsOfType(ElementTypeConstants.TIME_BOMB).length;this._curMove++;for(var i=e.getRequestNumOfType(ElementTypeConstants.TIME_BOMB),n=this._maxNumOnBoard-t-i,o=0;n>o;o++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._generateOnTop()},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.TIME_BOMB)},t.prototype._getValidTimeBombs=function(){for(var e=[],t=0,i=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB);t<i.length;t++){var n=i[t];!n||n.isDead()||n.shouldRemove||e.push(n)}return e},t.prototype._onStable=function(){this._bookingCount=0,this._board.removeDropElementType(ElementTypeConstants.TIME_BOMB)},t.prototype._onMatched=function(e){var t=e.data.match;if(void 0==t.swap&&void 0!=t.matchedElements){for(var i=!1,n=0,o=t.matchedElements;n<o.length;n++){var a=o[n];if(a.type==ElementTypeConstants.TIME_BOMB){i=!0;break}}i||this._spawnToMaxWithBookingCount()}},t.prototype._spawnToMaxWithBookingCount=function(){if(!(this._bookingCount<=0)){var e=this._board.getRequestNumOfType(ElementTypeConstants.TIME_BOMB);if(!(e>=this._maxNumOnBoard)){var t=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB).length;if(!(e+t>=this._maxNumOnBoard))for(var i=Math.min(this._maxNumOnBoard-e-t,this._bookingCount),n=0;i>n;n++)this._generateOnTop(),this._bookingCount--}}},t.prototype._onRemoveElement=function(e){var t=e.data.ele;if(void 0!=t&&t.type==ElementTypeConstants.TIME_BOMB){if(void 0!=t.getRemoveMatch())return;this._bookingCount+=1,this._bookingCount=Math.min(this._maxNumOnBoard,this._bookingCount);var i=this._board.getRequestNumOfType(ElementTypeConstants.TIME_BOMB);if(i>0)return;var n=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB).length;if(n>0)return;this._spawnToMaxWithBookingCount()}},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onStable,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_HAS_MATCHED,this._onMatched,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(TimeBombGeneratorHandler.prototype,"TimeBombGeneratorHandler");var TornadoGeneratorHandler=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._lastMove=0,o._lastGenerate=0,o._initEvents(),o}return __extends(t,e),t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onSwitchMade=function(){this._curMove++},t.prototype._onRemoveElement=function(e){if(!e.data.force){var t=this._board,i=t.getElementsOfType(ElementTypeConstants.TORNADO).length;if(!(this._maxNumOnBoard>0&&i>=this._maxNumOnBoard)){var n=t.getRequestNumOfType(ElementTypeConstants.TORNADO);if(this._lastMove!=this._curMove)for(var o=this._maxNumOnBoard-i-n,a=0;o>a;a++)this._generateOnTop();this._curMove%this._movesNeedToGenerate==0&&this._lastGenerate!=this._curMove&&this._lastMove!=this._curMove&&(this._generateOnTop(),this._lastGenerate=this._curMove)
}}},t.prototype._generateOnTop=function(){this._board.addDropElementType(ElementTypeConstants.TORNADO)},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t}(GeneratorHandler);__reflect(TornadoGeneratorHandler.prototype,"TornadoGeneratorHandler");var MatchChecker=function(){function e(){this._matchInfoPool=[],this.MAX_MATCH_COUNT=4}return e.prototype.findMatchAt=function(e,t,i,n,o,a){var s=0,r=0,l=0,_=0,h=e[o][n];if(0!=h){if(!t.getCellFenceAtGridInDir(n,o,CellEdgesDirection.RIGHT))for(var c=n+1;c<t.getBoardCols();c++){var d=e[o][c];if(a&&1==a[o][c])break;if(t.getCellFenceAtGridInDir(c,o,CellEdgesDirection.LEFT))break;if(d!=h)break;_++}if(!t.getCellFenceAtGridInDir(n,o,CellEdgesDirection.LEFT))for(var c=n-1;c>=0;c--){var d=e[o][c];if(a&&1==a[o][c])break;if(t.getCellFenceAtGridInDir(c,o,CellEdgesDirection.RIGHT))break;if(d!=h)break;l++}if(!t.getCellFenceAtGridInDir(n,o,CellEdgesDirection.DOWN))for(var c=o+1;c<t.getBoardRows();c++){var d=e[c][n];if(a&&1==a[c][n])break;if(t.getCellFenceAtGridInDir(n,c,CellEdgesDirection.UP))break;if(d!=h)break;r++}if(!t.getCellFenceAtGridInDir(n,o,CellEdgesDirection.UP))for(var c=o-1;c>=0;c--){var d=e[c][n];if(a&&1==a[c][n])break;if(t.getCellFenceAtGridInDir(n,c,CellEdgesDirection.DOWN))break;if(d!=h)break;s++}for(var p=0,u=i;p<u.length;p++){var m=u[p];2>s+r&&(s=0,r=0),2>l+_&&(l=0,_=0);var g=this._matchInfoPool.pop();if(void 0==g?g=new MatchInfo(n,o,s,r,l,_,h):g.setData(n,o,s,r,l,_,h),m.setMatch(g))return g;this._matchInfoPool.push(g)}}},e.prototype.findAllMatch=function(e,t,i){for(var n=[],o=0,a=t.getBoardRows();a>o;o++){n[o]=[];for(var s=0,r=t.getBoardCols();r>s;s++)n[o][s]=0}for(var l=[],_=0,h=i;_<h.length;_++)for(var c=h[_],d=0;d<t.getBoardRows();d++)for(var p=0;p<t.getBoardCols();p++)if(1!=n[d][p]){var u=this.findMatchAt(e,t,[c],p,d,n);if(void 0!=u){if(l.push(u),u.left+u.right>=2)for(var m=u.col-u.left;m<=u.col+u.right;m++)n[u.row][m]=1;if(u.up+u.down>=2)for(var m=u.row-u.up;m<=u.row+u.down;m++)n[m][u.col]=1}}return l},e}();__reflect(MatchChecker.prototype,"MatchChecker");var MatchHandler=function(){function e(e,t,i,n){this._possibleMoves=[],this._possibleMoveRankMap={},this._board=e,this._elementFactory=t,this._scoreHandler=i,this._swapHandler=n,this._matchChecker=new MatchChecker,this._rocketMatcher=new RocketMatcher;this._board.getBoardRows(),this._board.getBoardCols();this._createPossibleMoveRankMap()}return e.prototype.updatePossibleMoves=function(){this._possibleMoves=[],this._colorBoard=this._board.getColorBoard(),this._findPossibleNormaMoves(),this._findPossibleSpecialSwapMoves(),this._removeInvalidMoves()},e.prototype._removeInvalidMoves=function(){for(var e=[],t=0,i=this._possibleMoves;t<i.length;t++){var n=i[t];this._isValidMove(n)&&e.push(n)}this._possibleMoves=e},e.prototype._findPossibleNormaMoves=function(){for(var e=this._board.getBoardRows(),t=this._board.getBoardCols(),i=0;e>i;i++)for(var n=0;t>n;n++){var o=this._colorBoard[i][n];0!=o&&(!this._board.getCellFenceAtGridInDir(n,i,CellEdgesDirection.UP)&&this._board.isValidGridPos(n,i-1)&&(!this._board.getCellFenceAtGridInDir(n,i-1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n-1,i-1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-2,i-1,o)||!this._board.getCellFenceAtGridInDir(n,i-1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n+1,i-1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+2,i-1,o)||!this._board.getCellFenceAtGridInDir(n,i-1,CellEdgesDirection.UP)&&this._isColorAtPos(n,i-2,o)&&!this._board.getCellFenceAtGridInDir(n,i-2,CellEdgesDirection.UP)&&this._isColorAtPos(n,i-3,o)||!this._board.getCellFenceAtGridInDir(n,i-1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n,i-1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+1,i-1,o))&&this._possibleMoves.push(new PossibleMoveInfo(n,i,n,i-1,o)),!this._board.getCellFenceAtGridInDir(n,i,CellEdgesDirection.DOWN)&&this._board.isValidGridPos(n,i+1)&&(!this._board.getCellFenceAtGridInDir(n,i+1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-1,i+1,o)&&!this._board.getCellFenceAtGridInDir(n-1,i+1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-2,i+1,o)||!this._board.getCellFenceAtGridInDir(n,i+1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+1,i+1,o)&&!this._board.getCellFenceAtGridInDir(n+1,i+1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+2,i+1,o)||!this._board.getCellFenceAtGridInDir(n,i+1,CellEdgesDirection.DOWN)&&this._isColorAtPos(n,i+2,o)&&!this._board.getCellFenceAtGridInDir(n,i+2,CellEdgesDirection.DOWN)&&this._isColorAtPos(n,i+3,o)||!this._board.getCellFenceAtGridInDir(n,i+1,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-1,i+1,o)&&!this._board.getCellFenceAtGridInDir(n,i+1,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+1,i+1,o))&&this._possibleMoves.push(new PossibleMoveInfo(n,i,n,i+1,o)),!this._board.getCellFenceAtGridInDir(n,i,CellEdgesDirection.LEFT)&&this._board.isValidGridPos(n-1,i)&&(!this._board.getCellFenceAtGridInDir(n-1,i,CellEdgesDirection.DOWN)&&this._isColorAtPos(n-1,i+1,o)&&!this._board.getCellFenceAtGridInDir(n-1,i+1,CellEdgesDirection.DOWN)&&this._isColorAtPos(n-1,i+2,o)||!this._board.getCellFenceAtGridInDir(n-1,i,CellEdgesDirection.UP)&&this._isColorAtPos(n-1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n-1,i-1,CellEdgesDirection.UP)&&this._isColorAtPos(n-1,i-2,o)||!this._board.getCellFenceAtGridInDir(n-1,i,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-2,i,o)&&!this._board.getCellFenceAtGridInDir(n-2,i,CellEdgesDirection.LEFT)&&this._isColorAtPos(n-3,i,o)||!this._board.getCellFenceAtGridInDir(n-1,i,CellEdgesDirection.UP)&&this._isColorAtPos(n-1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n-1,i,CellEdgesDirection.DOWN)&&this._isColorAtPos(n-1,i+1,o))&&this._possibleMoves.push(new PossibleMoveInfo(n,i,n-1,i,o)),!this._board.getCellFenceAtGridInDir(n,i,CellEdgesDirection.RIGHT)&&this._board.isValidGridPos(n+1,i)&&(!this._board.getCellFenceAtGridInDir(n+1,i,CellEdgesDirection.DOWN)&&this._isColorAtPos(n+1,i+1,o)&&!this._board.getCellFenceAtGridInDir(n+1,i+1,CellEdgesDirection.DOWN)&&this._isColorAtPos(n+1,i+2,o)||!this._board.getCellFenceAtGridInDir(n+1,i,CellEdgesDirection.UP)&&this._isColorAtPos(n+1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n+1,i-1,CellEdgesDirection.UP)&&this._isColorAtPos(n+1,i-2,o)||!this._board.getCellFenceAtGridInDir(n+1,i,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+2,i,o)&&!this._board.getCellFenceAtGridInDir(n+2,i,CellEdgesDirection.RIGHT)&&this._isColorAtPos(n+3,i,o)||!this._board.getCellFenceAtGridInDir(n+1,i,CellEdgesDirection.UP)&&this._isColorAtPos(n+1,i-1,o)&&!this._board.getCellFenceAtGridInDir(n+1,i,CellEdgesDirection.DOWN)&&this._isColorAtPos(n+1,i+1,o))&&this._possibleMoves.push(new PossibleMoveInfo(n,i,n+1,i,o)))}},e.prototype._findPossibleSpecialSwapMoves=function(){for(var e=[[0,1],[1,0]],t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++)if(!this._board.isStaticCell(t,i)){var n=this._board.getElementAtGrid(t,i);if(void 0!=n)for(var o=0,a=e;o<a.length;o++){var s=a[o],r=t+s[0],l=i+s[1],_=this._board.getElementAtGrid(r,l);if(void 0!=n&&void 0!=_&&!(0==s[0]&&this._board.getCellFenceAtGridInDir(n.col,n.row,CellEdgesDirection.DOWN)||1==s[0]&&this._board.getCellFenceAtGridInDir(n.col,n.row,CellEdgesDirection.RIGHT))){var h=this._getRankOfPossibleSwapMove(n,_);if(h!=PossibleMoveInfo.RANK_DEFAULT){var c=new PossibleMoveInfo(t,i,r,l);c.rank=h,this._possibleMoves.push(c)}}}}},e.prototype._isValidMove=function(e){var t=e.fromPos,i=e.toPos,n=this._board.getElementAtGrid(t.x,t.y),o=this._board.getElementAtGrid(i.x,i.y);if(void 0==n||void 0==o)return!1;if(this._board.isCannotMoveCell(t.x,t.y)||this._board.isCannotMoveCell(i.x,i.y))return!1;if(this._board.isStaticCell(t.x,t.y)&&!n.isSticky()||this._board.isStaticCell(i.x,i.y)&&!o.isSticky())return!1;i.x-t.x,i.x-t.y;return!0},e.prototype.getTopRankedPossibleMove=function(){return this.updatePossibleMoves(),this._assignRankAndInvolvedToPossibleMoves(),this._possibleMoves.sort(function(e,t){return t.rank-e.rank}),this._possibleMoves[0]},e.prototype.getRandomPossibleMove=function(){this.updatePossibleMoves(),this._assignRankAndInvolvedToPossibleMoves(),this._possibleMoves.sort(function(e,t){return t.rank-e.rank});var e=this._possibleMoves.length;return this._possibleMoves[xyd.random(0,e-1)]},e.prototype._assignRankAndInvolvedToPossibleMoves=function(){for(var e=0,t=this._possibleMoves;e<t.length;e++){var i=t[e],n=[],o=i.fromPos,a=i.toPos,s=this._board.getElementAtGrid(o.x,o.y),r=this._board.getElementAtGrid(a.x,a.y);if(i.rank!=PossibleMoveInfo.RANK_DEFAULT)n.push(s),n.push(r);else{var l=i.color,_=a,h=0,c=0,d=0,p=0;s.color!=l?(_=o,n.push(r)):n.push(s),this._swapColor(o.x,o.y,a.x,a.y);for(var u=_.y;!this._board.getCellFenceAtGridInDir(_.x,u,CellEdgesDirection.DOWN)&&this._isColorAtPos(_.x,++u,l);)p++;for(u=_.y;!this._board.getCellFenceAtGridInDir(_.x,u,CellEdgesDirection.UP)&&this._isColorAtPos(_.x,--u,l);)d++;for(u=_.x;!this._board.getCellFenceAtGridInDir(u,_.y,CellEdgesDirection.RIGHT)&&this._isColorAtPos(++u,_.y,l);)c++;for(u=_.x;!this._board.getCellFenceAtGridInDir(u,_.y,CellEdgesDirection.LEFT)&&this._isColorAtPos(--u,_.y,l);)h++;var m=d+p+1,g=h+c+1;m>=5||g>=5?(m>=5?(h=0,c=0):(d=0,p=0),i.rank=PossibleMoveInfo.RANK_FIVE_MATCH):m>=3&&g>=3?i.rank=PossibleMoveInfo.RANK_T_MATCH:4==m||4==g?(4==m?(h=0,c=0):(d=0,p=0),i.rank=PossibleMoveInfo.RANK_FOUR_MATCH):3==m?(h=0,c=0):(d=0,p=0);for(var f=1;p>=f;f++){var y=this._board.getElementAtGrid(_.x,_.y+f);n.push(y)}for(var E=1;d>=E;E++){var y=this._board.getElementAtGrid(_.x,_.y-E);n.push(y)}for(var v=1;c>=v;v++){var y=this._board.getElementAtGrid(_.x+v,_.y);n.push(y)}for(var T=1;h>=T;T++){var y=this._board.getElementAtGrid(_.x-T,_.y);n.push(y)}this._swapColor(o.x,o.y,a.x,a.y)}i.involvedElements=n}},e.prototype.hasPossibleMoves=function(){return this._possibleMoves.length>0},e.prototype._isColorAtPos=function(e,t,i){return this._board.isValidGridPos(e,t)&&this._colorBoard[t][e]==i?!0:!1},e.prototype._swapColor=function(e,t,i,n){var o=this._colorBoard[t][e];this._colorBoard[t][e]=this._colorBoard[n][i],this._colorBoard[n][i]=o},e.prototype.getPossibleMoves=function(){return this._possibleMoves},e.prototype.isValidSwap=function(e,t){this._colorBoard=this._board.getColorBoard();var i=e.fromColRow.x-e.toColRow.x,n=e.fromColRow.y-e.toColRow.y;if(i>0&&this._board.getCellFenceAtGridInDir(e.fromColRow.x,e.fromColRow.y,CellEdgesDirection.LEFT)||0>i&&this._board.getCellFenceAtGridInDir(e.fromColRow.x,e.fromColRow.y,CellEdgesDirection.RIGHT)||0>n&&this._board.getCellFenceAtGridInDir(e.fromColRow.x,e.fromColRow.y,CellEdgesDirection.DOWN)||n>0&&this._board.getCellFenceAtGridInDir(e.fromColRow.x,e.fromColRow.y,CellEdgesDirection.UP))return e.swapFailType=SwapFailTypeConstants.RESIST_BY_FENCE,!1;var o=!1,a=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y);if(void 0==a||a.isLocked())return!1;var s=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(void 0==s||s.isLocked())return!1;if(this._swapHandler.isSpecialSwap(a,s)&&(o=!0),o)return!0;if(!o&&this._colorBoard[e.fromColRow.y][e.fromColRow.x]==this._colorBoard[e.toColRow.y][e.toColRow.x])return!1;var r=this._colorBoard[e.fromColRow.y][e.fromColRow.x];this._colorBoard[e.fromColRow.y][e.fromColRow.x]=this._colorBoard[e.toColRow.y][e.toColRow.x],this._colorBoard[e.toColRow.y][e.toColRow.x]=r;var l=this._matchChecker.findMatchAt(this._colorBoard,this._board,t,e.fromColRow.x,e.fromColRow.y);if(l)return!0;var _=this._matchChecker.findMatchAt(this._colorBoard,this._board,t,e.toColRow.x,e.toColRow.y);return _?!0:(r=this._colorBoard[e.fromColRow.y][e.fromColRow.x],this._colorBoard[e.fromColRow.y][e.fromColRow.x]=this._colorBoard[e.toColRow.y][e.toColRow.x],this._colorBoard[e.toColRow.y][e.toColRow.x]=r,!1)},e.prototype.checkMatches=function(){for(var e,t=this._matchChecker.findAllMatch(this._board.getColorBoard(),this._board,Board.MATCH_PATTERN_ALL),i=0,n=t;i<n.length;i++)e=n[i],this.removeElementsInMatch(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_HAS_MATCHED,!1,{match:e});t.length>0&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_SOUND_NORMAL),this._board.didUnstableAction())},e.prototype.getAllMatches=function(e){var t=this._matchChecker.findAllMatch(this._board.getColorBoard(),this._board,e);return t},e.prototype.getElementsInMatch=function(e){var t,i=[],n=e.col,o=e.row;t=this._board.getElementAtGrid(n,o),t&&i.push(t);for(var a=1;a<=e.up;a++)t=this._board.getElementAtGrid(n,o-a),t&&i.push(t);for(var a=1;a<=e.down;a++)t=this._board.getElementAtGrid(n,o+a),t&&i.push(t);for(var a=1;a<=e.left;a++)t=this._board.getElementAtGrid(n-a,o),t&&i.push(t);for(var a=1;a<=e.right;a++)t=this._board.getElementAtGrid(n+a,o),t&&i.push(t);return i},e.prototype.getNormalElementsInMatch=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var o=n[i];(o.type==ElementTypeConstants.NORMAL||o.type==ElementTypeConstants.TIME_BOMB||o.type==ElementTypeConstants.BLACK_HOLE)&&t.push(o)}return t},e.prototype._createSpecialElement=function(e,t,i){var n=t,o=i,a=this._board.getElementAtGrid(n,o),s=a.color,r=a.type;if(r!=ElementTypeConstants.NORMAL&&r!=ElementTypeConstants.TIME_BOMB&&r!=ElementTypeConstants.BLACK_HOLE){var l=this.getElementsInMatch(e),_=this.getNormalElementsInMatch(l);if(_.length>0){var h=this._board.random(0,_.length-1),c=_[h];n=c.col,o=c.row,a=this._board.getElementAtGrid(n,o)}}var d;switch(e.patternType){case MatchConstants.MATCH_5:d=this._elementFactory.create(n,o,0,ElementTypeConstants.BOMB_COLOR),d.score=ScoreConstants.BOMB_COLOR,d.inDpack=!0;break;case MatchConstants.MATCH_L:d=this._elementFactory.create(n,o,s,ElementTypeConstants.BOMB_SQUARE),d.score=ScoreConstants.BOMB_SQUARE,d.inDpack=!0;break;case MatchConstants.MATCH_4:e.left+e.right>=3?(d=this._elementFactory.create(n,o,s,ElementTypeConstants.BOMB_COL),d.inDpack=!0):(d=this._elementFactory.create(n,o,s,ElementTypeConstants.BOMB_ROW),d.inDpack=!0)}if(d){d.createSpecial(9*xyd.frameScale);var p=new DPackSimple(this._board,a,d);a.destructionPack=p,a.setDestroyFrames(0),this._board.addForRemoval(a,0,DamageSource.MATCH,e)}},e.prototype._checkIsSameMatch=function(e,t){var i=t;if(t.patternType==MatchConstants.MATCH_L)return i;if(e.x==i.col)if(e.y>i.row){if(e.y-t.row<=i.down){var n=e.y-i.row;return i.row=e.y,i.up=i.up+n,i.down=i.down-n,i}}else if(i.row-e.y<=i.up){var n=i.row-e.y;return i.row=e.y,i.up=i.up-n,i.down=i.down+n,i}if(e.y==i.row)if(e.x>i.col){if(e.x-i.col<=i.right){var n=e.x-i.col;return i.col=e.x,i.right=i.right-n,i.left=i.left+n,i}}else if(i.col-e.x<=i.left){var n=i.col-e.x;return i.col=e.x,i.right=i.right+n,i.left=i.left-n,i}return i},e.prototype._checkPointInMatch=function(e,t){var i=t;if(e.x==i.col)if(e.y>i.row){if(e.y-t.row<=i.down)return!0}else if(i.row-e.y<=i.up)return!0;if(e.y==i.row)if(e.x>i.col){if(e.x-i.col<=i.right)return!0}else if(i.col-e.x<=i.left)return!0;return!1},e.prototype.removeElementsInMatch=function(e){var t,i=void 0,n=void 0,o=0,a=this.getElementsInMatch(e);e.matchedElements=a;var s=this.getNormalElementsInMatch(a),r=this._board.getLastSwap();if(void 0!=this._board.getLastSwap()&&r){var l=r.toColRow;if(this._checkPointInMatch(l,e))i=l.x,n=l.y,e.swap=r;else{var _=r.fromColRow;this._checkPointInMatch(_,e)&&(i=_.x,n=_.y,e.swap=r)}}if(e.patternType==MatchConstants.MATCH_L){var h=e.col,c=e.row,d=this._board.getElementAtGrid(h,c);(d.type==ElementTypeConstants.NORMAL||d.type==ElementTypeConstants.TIME_BOMB||d.type==ElementTypeConstants.BLACK_HOLE)&&(i=d.col,n=d.row)}if(void 0==i&&s.length>0){var p=this._board.random(0,s.length-1),d=s[p];i=d.col,n=d.row}void 0==i&&(i=e.col,n=e.row);var u=e.getCenterPoint(),m=u.x,g=u.y;o+=this._scoreHandler.calculateMatchedScore(e.size),o+=this._board.calculateMatchedSpecialScore(a);var f=this._board.getElementAtGrid(i,n),y=this._board.getElementAtGrid(m,g);y.type==ElementTypeConstants.ROCKET?f.score=o:y.score=o,e.col=i,e.row=n;for(var E=0,v=a;E<v.length;E++){var T=v[E];if(T.type==ElementTypeConstants.ROCKET){t=T,e.col=t.x,e.row=t.y;break}}for(var C=0,L=a;C<L.length;C++){var d=L[C];d.isLocked()||(this._checkAdjecentBlockers(d),this._checkAdjacentElements(d,e),this._checkAdjecentEdges(d)),this._board.addForRemoval(d,0,DamageSource.MATCH,e)}t?(t.cancelRemove(),t.isRegular()?this._rocketMatcher.checkMatch(t,e,a):(this._board.addToDestructionPlanList(t),t.clearDestructionPack(),this._rocketMatcher.checkMatch(t,e,a)),this._board.hitEmptyCell(t.col,t.row)):e.patternType!=MatchConstants.MATCH_3&&(f.type==ElementTypeConstants.LUCKY_BAG?s.length>0&&this._createSpecialElement(e,i,n):this._createSpecialElement(e,i,n))},e.prototype._checkAdjacentElements=function(e,t){for(var i=[1,0,3,2],n=0,o=0,a=xyd.directions;o<a.length;o++){var s=a[o];if(!this._board.getCellFenceAtGridInDir(e.col,e.row,i[n++])){var r=e.col+s[0],l=e.row+s[1],_=this._board.getElementAtGrid(r,l);if(void 0!=_&&_.type==ElementTypeConstants.BOX){var h=_.getLock();if(h&&h.type!=LOCK_TYPE.ICE)continue;xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_BOX,!1,{ele:_,match:t}),this._board.addForRemoval(_,0,DamageSource.ADJACENT_MATCH)}}}},e.prototype._checkAdjecentBlockers=function(e){for(var t=this._board.getAllBlockers(),i=e.col,n=e.row,o=0,a=t;o<a.length;o++){var s=a[o];if((!(s.health>0)||s.canBeAffectedByMatch()||s.canBeAffectByNearElement())&&s.type!=BlockerConstant.FENCE&&s.type!=BlockerConstant.CURLS){if(s.isLocked()){var r=s.getLock();if(r.type!=LOCK_TYPE.ICE)continue}var l=Math.abs(s.col-i)+Math.abs(s.row-n);1==l&&(s.col>i&&!this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.RIGHT)||s.col<i&&!this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.LEFT)||s.row>n&&!this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.DOWN)||s.row<n&&!this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.UP))&&this._board.hitBlocker(s,1)}}},e.prototype._checkAdjecentEdges=function(e){var t,i=e.col,n=e.row;(t=this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.DOWN))&&this._board.hitBlocker(t,1),(t=this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.UP))&&this._board.hitBlocker(t,1),(t=this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.LEFT))&&this._board.hitBlocker(t,1),(t=this._board.getCellFenceAtGridInDir(i,n,CellEdgesDirection.RIGHT))&&this._board.hitBlocker(t,1)},e.prototype._getRankKey=function(e,t){return e>t?this._getRankKey(t,e):e<<16|t},e.prototype._createPossibleMoveRankMap=function(){this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_COLOR)]=PossibleMoveInfo.RANK_COLOR_COLOR,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_COL)]=PossibleMoveInfo.RANK_COLOR_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_ROW)]=PossibleMoveInfo.RANK_COLOR_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_SQUARE)]=PossibleMoveInfo.RANK_COLOR_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_COL)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_ROW)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_COL)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.BOMB_SQUARE)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_SQUARE)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_SQUARE)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.NORMAL)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.LUCKY_BAG)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.TIME_BOMB)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.TORNADO)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.ROCKET)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.ROCKET)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.ROCKET)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.ROCKET)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.SCISSOR)]=PossibleMoveInfo.RANK_COLOR_NORMAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.TORNADO)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.TORNADO)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.TORNADO)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.SCISSOR,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.NORMAL,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.CRAYON,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.CRAYON,ElementTypeConstants.BLACK_HOLE)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.TIME_BOMB,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.GOLDEN_EGG,ElementTypeConstants.CRAYON)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.SCISSOR,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.NORMAL,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.CRAYON,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.WAND,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.BLACK_HOLE,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.TIME_BOMB,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL,this._possibleMoveRankMap[this._getRankKey(ElementTypeConstants.GOLDEN_EGG,ElementTypeConstants.WAND)]=PossibleMoveInfo.RANK_SPECIAL_SPECIAL},e.prototype._getRankOfPossibleSwapMove=function(e,t){var i=this._getRankKey(e.type,t.type),n=this._possibleMoveRankMap[i];return void 0==n&&(n=PossibleMoveInfo.RANK_DEFAULT),n},e}();__reflect(MatchHandler.prototype,"MatchHandler");var MatchInfo=function(){function e(e,t,i,n,o,a,s,r){this._matchedElements=[],this._col=e,this._row=t,this._up=i,this._down=n,this._left=o,this._right=a,this._color=s,this._swap=r}return e.prototype.setData=function(e,t,i,n,o,a,s,r){this._col=e,this._row=t,this._up=i,this._down=n,this._left=o,this._right=a,this._color=s,this._swap=r},Object.defineProperty(e.prototype,"width",{get:function(){return this._right+this._left+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._up+this._down+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.height+this.width-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){if(void 0!=this._col&&this.col!=e){var t=e-this._col;this._right-=t,this._left+=t}this._col=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){if(void 0!=this._row&&this._row!=e){var t=e-this._row;this._down-=t,this._up+=t}this._row=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._up=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"down",{get:function(){return this._down},set:function(e){this._down=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(e){this._left=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(e){this._right=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"patternType",{get:function(){return this._patternType},set:function(e){this._patternType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"swap",{get:function(){return this._swap},set:function(e){this._swap=e},enumerable:!0,configurable:!0}),e.prototype.getCenterPoint=function(){var e=this._col,t=this._row;return this._patternType!=MatchConstants.MATCH_L&&this._patternType!=MatchConstants.MATCH_5&&(e+=Math.round((this._right-this.left)/2),t+=Math.round((this._down-this.up)/2)),new egret.Point(e,t)},Object.defineProperty(e.prototype,"matchedElements",{get:function(){return void 0==this._matchedElements?[]:this._matchedElements},set:function(e){this._matchedElements=e},enumerable:!0,configurable:!0}),e}();__reflect(MatchInfo.prototype,"MatchInfo");var DragonBonesArmature=function(e){function t(t,i){var n=e.call(this)||this;return n._armature=t,n._clock=i,n.addChild(n._armature.display),n._completeCalls=[],n._frameCalls=[],n._isPlay=!1,n._playName="",n}return __extends(t,e),t.prototype.addListeners=function(){this._armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.completeHandler,this),this._armature.cacheFrameRate>0?this._armature.addEventListener(dragonBones.FrameEvent.ANIMATION_FRAME_EVENT,this.frameHandler,this):this._armature.addEventListener(dragonBones.FrameEvent.BONE_FRAME_EVENT,this.frameHandler,this)},t.prototype.removeListeners=function(){this._armature.removeEventListener(dragonBones.AnimationEvent.COMPLETE,this.completeHandler,this),this._armature.cacheFrameRate>0?this._armature.removeEventListener(dragonBones.FrameEvent.ANIMATION_FRAME_EVENT,this.frameHandler,this):this._armature.removeEventListener(dragonBones.FrameEvent.BONE_FRAME_EVENT,this.frameHandler,this)},t.prototype.completeHandler=function(e){for(var t=e.animationName,i=0,n=this._completeCalls.length;n>i;i++){var o=this._completeCalls[i];o[0].apply(o[1],[e,t])}t==this._playName&&(this._playName="")},t.prototype.frameHandler=function(e){for(var t=0,i=this._frameCalls.length;i>t;t++){var n=this._frameCalls[t];n[0].apply(n[1],[e])}},t.prototype.play=function(e,t){return void 0===t&&(t=void 0),this._playName==e?this._currAnimationState:(this._playName=e,this.start(),void 0==t?this._currAnimationState=this.getAnimation().gotoAndPlay(e):this._currAnimationState=this.getAnimation().gotoAndPlay(e,void 0,void 0,t),this._currAnimationState)},t.prototype.start=function(){this._isPlay||(this._clock.add(this._armature),this._isPlay=!0,this.addListeners())},t.prototype.stop=function(){this._isPlay&&(this._clock.remove(this._armature),this._isPlay=!1,this._playName="",this.removeListeners())},t.prototype.destroy=function(){this.stop(),this.parent&&this.parent.removeChild(this),this.removeChildren(),this._armature=null,this._clock=null,this._completeCalls=null,this._frameCalls=null},t.prototype.addCompleteCallFunc=function(e,t){for(var i=0;i<this._completeCalls.length;i++){var n=this._completeCalls[i];if(n[0]==e&&n[1]==t)return}this._completeCalls.unshift([e,t])},t.prototype.removeCompleteCallFunc=function(e,t){for(var i=0;i<this._completeCalls.length;i++){var n=this._completeCalls[i];n[0]==e&&n[1]==t&&(this._completeCalls.splice(i,1),i--)}},t.prototype.addFrameCallFunc=function(e,t){for(var i=0;i<this._frameCalls.length;i++){var n=this._frameCalls[i];if(n[0]==e&&n[1]==t)return}this._frameCalls.push([e,t])},t.prototype.removeFrameCallFunc=function(e,t){for(var i=0;i<this._frameCalls.length;i++){var n=this._frameCalls[i];n[0]==e&&n[1]==t&&(this._frameCalls.splice(i,1),i--)}},t.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.stop()},t.prototype.getArmature=function(){return this._armature},t.prototype.getCurrAnimationState=function(){return this._currAnimationState},t.prototype.getClock=function(){return this._clock},t.prototype.getAnimation=function(){return this._armature.animation},t.prototype.getBone=function(e){return this._armature.getBone(e)},t.prototype.getPlayName=function(){return this._playName},t.prototype.getBoneDisplay=function(e){return e.slot.getDisplay()},t.prototype.changeBone=function(e,t){var i=this.getBone(e);i&&i.slot.setDisplay(t)},t}(egret.DisplayObjectContainer);__reflect(DragonBonesArmature.prototype,"DragonBonesArmature");var PossibleMoveInfo=function(){function e(t,i,n,o,a){void 0===a&&(a=0),this._rank=e.RANK_DEFAULT,this._color=0,this._involvedElements=[],this._fromPosX=t,this._fromPosY=i,this._toPosX=n,this._toPosY=o,this._color=a}return Object.defineProperty(e.prototype,"fromPos",{get:function(){return{x:this._fromPosX,y:this._fromPosY}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toPos",{get:function(){return{x:this._toPosX,y:this._toPosY}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rank",{get:function(){return this._rank},set:function(e){this._rank=e},enumerable:!0,configurable:!0}),e.getSwapRankByType=function(t,i){return t==ElementTypeConstants.BOMB_COLOR&&i==ElementTypeConstants.BOMB_COLOR?e.RANK_COLOR_COLOR:void 0},Object.defineProperty(e.prototype,"involvedElements",{get:function(){return this._involvedElements},set:function(e){this._involvedElements=e},enumerable:!0,configurable:!0}),e.RANK_DEFAULT=1,e.RANK_SPECIAL_NORMAL=2,e.RANK_COLOR_NORMAL=3,e.RANK_SPECIAL_SPECIAL=4,e.RANK_FOUR_MATCH=5,e.RANK_T_MATCH=6,e.RANK_COLOR_SPECIAL=7,e.RANK_COLOR_COLOR=8,e.RANK_FIVE_MATCH=9,e
}();__reflect(PossibleMoveInfo.prototype,"PossibleMoveInfo");var DragonBonesArmatureContainer=function(e){function t(){var t=e.call(this)||this;return t.armatures=new Array,t.actions={},t.cacheBones={},t}return __extends(t,e),t.prototype.register=function(e,t){this.armatures.push(e);for(var i=0,n=t.length;n>i;i++)this.actions[t[i]]=this.armatures.length-1},Object.defineProperty(t.prototype,"armature",{get:function(){return this.armatures[this.currArmatureIndex]},enumerable:!0,configurable:!0}),t.prototype.getCacheBone=function(e){if(!this.cacheBones[e]){this.cacheBones[e]=[];for(var t=0,i=this.armatures.length;i>t;t++){var n=this.armatures[t];this.cacheBones[e].push(n.getBone(e))}}return this.cacheBones[e][this.currArmatureIndex]},t.prototype.play=function(e,t){if(void 0===t&&(t=void 0),null==this.actions[e])return void Log.trace("DragonBonesArmatureContainer不存在动作：",e);var i=this.actions[e];i!=this.currArmatureIndex&&this.remove();var n=this.armatures[i];return n?(this.addChild(n),this.currArmatureIndex=i,n.play(e,t)):null},t.prototype.stop=function(){var e=this.armatures[this.currArmatureIndex];e&&e.stop()},t.prototype.start=function(){var e=this.armatures[this.currArmatureIndex];e&&e.start()},t.prototype.remove=function(){var e=this.armatures[this.currArmatureIndex];e&&(e.stop(),App.DisplayUtils.removeFromParent(e),this.currArmatureIndex=null)},t.prototype.addCompleteCallFunc=function(e,t){for(var i=0,n=this.armatures.length;n>i;i++){var o=this.armatures[i];o.addCompleteCallFunc(e,t)}},t.prototype.removeCompleteCallFunc=function(e,t){for(var i=0,n=this.armatures.length;n>i;i++){var o=this.armatures[i];o.removeCompleteCallFunc(e,t)}},t.prototype.addFrameCallFunc=function(e,t){for(var i=0,n=this.armatures.length;n>i;i++){var o=this.armatures[i];o.addFrameCallFunc(e,t)}},t.prototype.removeFrameCallFunc=function(e,t){for(var i=0,n=this.armatures.length;n>i;i++){var o=this.armatures[i];o.removeFrameCallFunc(e,t)}},t.prototype.clear=function(){for(;this.armatures.length;){var e=this.armatures.pop();App.DisplayUtils.removeFromParent(e),e.destroy()}this.cacheBones={},this.actions={}},t.prototype.destroy=function(){this.clear(),this.armatures=null,this.cacheBones=null,this.actions=null},t}(egret.DisplayObjectContainer);__reflect(DragonBonesArmatureContainer.prototype,"DragonBonesArmatureContainer");var DPackBomb=function(e){function t(t,i,n,o,a){var s=e.call(this,t,i,a)||this;return s._lastOffset=0,s.isColorMixerExploded=!1,s._gridSize=o,s._nextEle=n,s._type=MatchConstants.DP_BOMB,s}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=(this._gridSize-1)/2,i=Math.max(0,this._initRow-t),n=Math.min(this._board.getBoardRows(),this._initRow+t),o=Math.max(0,this._initCol-t),a=Math.min(this._board.getBoardCols(),this._initCol+t),s=i;n>=s;s++)for(var r=o;a>=r;r++){this._affectedLocs.push({x:r,y:s});var l=this._board.getBlockerAtGrid(r,s);if(void 0==l){var _=this._board.getIntergratedElementAt(r,s);void 0!=_&&(this._affectedElements.push(_),_.inDpack=!0,_.type==ElementTypeConstants.ROCKET&&(this._shouldRefuelToRocket=!0,_.inDpack=!1,this._board.hitEmptyCell(_.col,_.row)),(_.type==ElementTypeConstants.LAMP_1||_.type==ElementTypeConstants.LAMP_2)&&this._board.hitEmptyCell(_.col,_.row));var h=this._board.getCellEdgesAtGrid(r,s);if(h)for(var c=0;c<xyd.directions.length;c++){var d=h.getEdge(c);s==i&&c==CellEdgesDirection.UP||s==n&&c==CellEdgesDirection.DOWN||r==o&&c==CellEdgesDirection.LEFT||r==a&&c==CellEdgesDirection.RIGHT||d&&this._affectedBlockers.push(d)}}else this._affectedBlockers.push(l)}var p=0;this._nextEle||(p=1),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_BOMB,!1,{x:this._initCol,y:this._initRow,bomb_times:p,color:this._initElement.color,scale:this._gridSize/3})},t.prototype.isDone=function(){return!0},t.prototype.getNextElement=function(){return this._nextEle},t}(DPack);__reflect(DPackBomb.prototype,"DPackBomb");var DPackCol=function(e){function t(t,i,n,o){void 0===o&&(o=!0);var a=e.call(this,t,i,n)||this;return a._zeroGElements=[],a._lockLamp=!0,a._direction=1,a._type=MatchConstants.DP_COL,a._lockLamp=o,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=0,i=this._allElements;t<i.length;t++){var n=i[t];(!this._lockLamp||n.type!=ElementTypeConstants.LAMP_1&&n.type!=ElementTypeConstants.LAMP_2&&!n.isLocked())&&n.state!=BoardElementState.CREATE_STATE&&(n.shouldNotFall=!0)}},t.prototype.update=function(){if(e.prototype.update.call(this),this._isDone)for(var t=0,i=this._allElements;t<i.length;t++){var n=i[t];n.shouldNotFall=!1}else;},t}(DPackLine);__reflect(DPackCol.prototype,"DPackCol");var DebugGameBridge=function(){function e(){this._methodNameToFunc={},this.count=15.55,this.waitState=!1,this._initMethodsMap(),this._initABTestInfo(),this._debugData=new DebugData(this._ABTestInfo)}return e.prototype.callMethod=function(e,t,i){var n=this._methodNameToFunc[e];void 0!=n?"GAME_SHOW_UI"!=e?egret.setTimeout(function(){n(t,i)},this,500):n(t,i):i("Calling invalid method !!!",void 0)},e.prototype._initMethodsMap=function(){this._addMethod("GET_SYSTEM_INFO",this._getSystemInfo.bind(this)),this._addMethod("SYNC_GAME_SETTING",this._syncGameSetting.bind(this)),this._addMethod("SHOW_ALERT",this._showAlert.bind(this)),this._addMethod("SHOW_CONFIRM",this._showConfirm.bind(this)),this._addMethod("SHOW_TOAST",this._showToast.bind(this)),this._addMethod("GET_GAME_INFO",this._getGameInfo.bind(this)),this._addMethod("GET_GAME_RECORDS",this._getGameRecords.bind(this)),this._addMethod("GAME_LOADED",this._gameLoaded.bind(this)),this._addMethod("GAME_BEGIN",this._gameBegin.bind(this)),this._addMethod("GAME_WIN",this._gameWin.bind(this)),this._addMethod("GAME_END",this._gameEnd.bind(this)),this._addMethod("GAME_PRE_END",this._gamePreEnd.bind(this)),this._addMethod("GET_USER_INFO",this._getUserInfo.bind(this)),this._addMethod("GAME_BUY_ITEM",this._gameBuyItem.bind(this)),this._addMethod("GAME_USE_ITEM",this._gameUseItem.bind(this)),this._addMethod("GAME_PRE_BEGIN",this._gamePreBegin.bind(this)),this._addMethod("LOGGER",this._logger.bind(this)),this._addMethod("LOG_ERROR",this._logError.bind(this)),this._addMethod("GAME_ON_SHOW",this._gameOnShow.bind(this)),this._addMethod("GAME_ON_HIDE",this._gameOnHide.bind(this)),this._addMethod("GAME_ON_LEAVE",this._gameOnLeave.bind(this)),this._addMethod("GAME_RECOVER",this._gameRecover.bind(this)),this._addMethod("GET_SAVED_GAME",this._getSavedGame.bind(this)),this._addMethod("SAVE_GAME",this._saveGame.bind(this)),this._addMethod("SYNC_GAME_DATA",this._syncGameData.bind(this)),this._addMethod("GAME_CLAIM_PACKET",this._gameClaimPacket.bind(this)),this._addMethod("GAME_CLEAR_REWARD",this._gameShowOff.bind(this)),this._addMethod("GAME_SHOW_UI",this._gameShowUI.bind(this)),this._addMethod("GAME_PRE_RETRY",this._gamePreRetry.bind(this)),this._addMethod("GET_GATHER_TASK_GROUP_INFO",this._getGatherTaskGroupInfo.bind(this)),this._addMethod("ON_GATHER_TASK_ICON_CLICK",this._onGatherTaskIconClick.bind(this)),this._addMethod("GAME_SHARE",this._gameShare.bind(this)),this._addMethod("GAME_SHOW_MAP_POPUPS",this._gameShowMapPopups.bind(this)),this._addMethod("GET_AB_TESTS",this._getAbTests.bind(this)),this._addMethod("H5_RECEIVE_ITEMS_ANIM",this._h5_receive_items_anim.bind(this)),this._addMethod("H5_OPEN_PREGAME_WIN",this._h5_open_pregame_win.bind(this)),this._addMethod("H5_CLOSE_PREGAME_WIN",this._h5_close_pregame_win.bind(this)),this._addMethod("H5_ENTER_GAME_DIRECTLY",this._h5_enter_game_directly.bind(this)),this._addMethod("H5_IN_GAME_WINDOW",this._h5_in_game_window.bind(this)),this._addMethod("H5_NEW_USER_ENTER_HOME_MAP",this._h5_new_user_enter_home_map.bind(this)),this._addMethod("H5_ACTION_IN_GAME",this._h5_action_in_game.bind(this)),this._addMethod("LEADERBOARD_GET_INFO",this._leaderboard_get_info.bind(this)),this._addMethod("LEADERBOARD_SEND_STAMINA",this._leaderboard_send_stamina.bind(this)),this._addMethod("LEADERBOARD_CLAIM_STAMINA",this._leaderboard_claim_stamina.bind(this)),this._addMethod("LEADERBOARD_ON_ICON_CLICK",this._leaderboard_on_icon_click.bind(this)),this._addMethod("GET_FRIENDS_RANKING",this._get_friends_ranking.bind(this)),this._addMethod("GAME_SHOW_SALES",this._game_show_sales.bind(this)),this._addMethod("LEADERBOARD_STAMINA_STATUS",this._leaderboard_stamina_status.bind(this)),this._addMethod("H5_RETURN_STAGE",this._h5_return_stage.bind(this)),this._addMethod("MONTHLY_CARD_GET_LEVEL_INFO",this._monthcard_info.bind(this)),this._addMethod("MONTHLY_CARD_GET_REWARD_INFO",this._monthcard_rewards.bind(this)),this._addMethod("MONTHLY_CARD_GET_TASK_INFO",this._monthcard_tasks.bind(this)),this._addMethod("MONTHLY_CARD_PURCHASE",this._monthcard_purchase.bind(this)),this._addMethod("MONTHLY_CARD_CLAIM_REWARD",this._monthcard_claim_reward.bind(this)),this._addMethod("MONTHLY_CARD_ON_ICON_CLICK",this._monthly_card_on_icon_click.bind(this)),this._addMethod("NEWUSER_STAGE_CASH_REWARD",this._newuser_stage_cash_reward.bind(this)),this._addMethod("GET_SCORE_RANK_FOR_LEVEL",this._get_score_rank_for_level.bind(this)),this._addMethod("MONTHLY_CARD_GET_RANK_INFO",this._monthcard_get_rank_info.bind(this)),this._addMethod("H5_TOGGLE_MAP",this._h5_toggle_map.bind(this)),this._addMethod("FINGER_SHOW",this._finger_show.bind(this)),this._addMethod("H5_GET_IS_PLAY_IN_STAGE",this._h5_get_is_play_in_stage.bind(this)),this._addMethod("SHOW_RULES_WINDOW",this._show_rule_window.bind(this)),this._addMethod("TOGGLE_TO_HOME_OR_STAGE",this._toggle_to_home_or_stage.bind(this)),this._addMethod("GET_PRE_GAME_REWARD",this._get_pre_game_reward.bind(this)),this._addMethod("H5_PLAY_OR_STOP_BGM",this._h5_play_or_stop_bgm.bind(this)),this._addMethod("GET_STORAGE",this._get_storage.bind(this)),this._addMethod("SET_STORAGE",this.set_storage.bind(this)),this._addMethod("NOT_ENOUGH_DIAMOND",this._not_enough_diamond.bind(this)),this._addMethod("GET_DIAMOND_NUM",this._get_diamond_num.bind(this)),this._addMethod("OPEN_BACKPACK",this._open_backpack.bind(this)),this._addMethod("OPEN_WALLET",this._open_wallet.bind(this)),this._addMethod("GET_WALLET_DOLLAR",this._get_wallet_dollar.bind(this)),this._addMethod("PREGAME_SHOW_GOODS_GET_INFO",this._pregame_show_goods_get_info.bind(this)),this._addMethod("PREGAME_SHOW_GOODS_OPEN_WINDOW",this._pregame_show_goods_open_window.bind(this)),this._addMethod("SAVE_PET_INFO",this.save_pet_info.bind(this)),this._addMethod("OPEN_PIGGY",this._open_piggy.bind(this)),this._addMethod("BILLION_CASH_CLICK_BUTTON",this._billion_cash_click_button.bind(this)),this._addMethod("CLICK_START_BUTTON",this._click_start_button.bind(this)),this._addMethod("H5_SHOW_WIN_WINDOW",this._h5_show_win_window.bind(this)),this._addMethod("SHOW_SEVERN_MAP",this._show_severn_map.bind(this)),this._addMethod("H5_SOUND_BG",this._h5_sound_bg.bind(this)),this._addMethod("H5_SOUND_EFFECT",this._h5_sound_effect.bind(this)),this._addMethod("H5_GOTO_MAP",this._h5_goto_map.bind(this)),this._addMethod("GOTO_MAP_SUCCESS",this._goto_map_success.bind(this)),this._addMethod("SHOW_PRE_MISSION_WINDOW",this._show_pre_mission_window.bind(this)),this._addMethod("H5_GET_GAME_TARGET",this._h5_get_game_target.bind(this)),this._addMethod("GET_CLEAR_STAGE_INFO",this._get_clear_stage_info.bind(this)),this._addMethod("SHOW_CLEAR_STAGE_REWARD",this._show_clear_stage_reward.bind(this)),this._addMethod("SET_STRONG_REMINDER",this._strong_reminder.bind(this)),this._addMethod("H5_GAME_RELEASE_MEMORY",this._h5_game_release_memory.bind(this)),this._addMethod("H5_GAME_RESUME",this._h5_game_resume.bind(this)),this._addMethod("GET_VIP_INFO",this._get_vip_info.bind(this)),this._addMethod("CLICK_VIP_BOARD",this._click_vip_board.bind(this)),this._addMethod("GET_BANNER_INFO",this._get_banner_info.bind(this)),this._addMethod("GAME_END_CLICK_PACKET",this._game_end_click_packet.bind(this)),this._addMethod("RED_PACKET_CASH_CLICK_BUTTON",this._showRedPacket.bind(this)),this._addMethod("H5_SHOW_SETTING_WIN",this._h5_show_setting_win.bind(this))},e.prototype._addMethod=function(e,t){this._methodNameToFunc[e]=t},e.prototype._getSystemInfo=function(e,t){t(void 0,{width:xyd.getWidth(),height:xyd.getHeight(),system:"iOS",is_app:!1,is_ios_8:!1,is_low_end_device:!0,statusBarHeight:40})},e.prototype._showAlert=function(e,t){window.alert(e)},e.prototype._showConfirm=function(e,t){window.alert(e),e.onConfirmClick&&e.onConfirmClick()},e.prototype._showToast=function(e,t){window.alert(e)},e.prototype._showPopup=function(e,t){window.alert(e),e&&e.onBtnClick&&e.onBtnClick()},e.prototype._getGameInfo=function(e,t){var i=this._debugData.currentLevel,n=Math.max(0,i-21),o=this._debugData.records.slice(n,i+21),a={};for(var s in this._debugData.items){var r=this._debugData.items[s],l={quantity:r.quantity,expire_time:void 0};r.expire_time&&r.expire_time.length>0&&(l.expire_time=r.expire_time.slice()),a[s]=l}var _={gems:this._debugData.gems,current_level:i,monthly_card_level:this._debugData.monthCardInfo.level,stamina:this._debugData.stamina,records:o,items:a,gather_task:this._debugData.gatherTaskInfo,clear_streak:this._debugData.clearStreak,is_banlist:!1,is_safe:!0,enter_home_map_level:10,is_vip:!0,red_packet_cash_amount:this.count,vip_extra_step:2,enter_link_type:2,clear_stage_info:{5:{"1=1002":1,"2=1014":10},6:{"1=1002":1,"2=1015":10,"2=1002":100},7:{"1=1002":1,"2=1014":10},8:{"1=1002":1,"2=1015":10,"2=1002":100},10:{"1=1002":1,"2=1014":10},12:{"1=1002":1,"2=1015":10,"2=1002":100},20:{"1=1002":100,"2=1012":10,"2=1001":1},30:{"1=1002":10,"2=1005":1,"2=1007":100},40:{"1=1002":1,"2=1008":100}}};platform.inTestMode()&&(_.clear_streak=0),t(void 0,_)},e.prototype._getGameRecords=function(e,t){var i=this._debugData.currentLevel,n=e.start;n=Math.min(Math.max(1,n),i-1);var o=e.end;o=Math.min(Math.max(1,o),i-1);var a=this._debugData.records.slice(n-1,o);t(void 0,{records:a})},e.prototype._syncGameSetting=function(e,t){e&&(this._debugData.setting=e),console.log(e),t(void 0,this._debugData.setting)},e.prototype._gameLoaded=function(e,t){console.log("Game Loaded"),t(void 0,void 0)},e.prototype._gameBegin=function(e,t){console.log("Game Begin: "),console.log(e),t(void 0,void 0)},e.prototype._gameWin=function(e,t){var i=this;if(console.log("Game Win: "),console.log(e),e.mission_info){var n=xyd.WindowManager.get().getWindow("game_window");if(n){var o=new eui.Label("胜利窗口");o.size=50,o.textColor=0,o.bold=!0,o.x=400,o.y=850;var a=new eui.Image("btn_luchang_png");a.x=400,a.y=900;var s=new eui.Image("btn_fenchang_png");s.x=400,s.y=1020,n.group_tips.removeChildren(),n.group_tips.addChild(o),n.group_tips.addChild(a),n.group_tips.addChild(s),this._debugData.spring_level_info.level+=1,this._debugData.spring_level_info.mission_info.mission_level+=1,xyd.setNormalBtnBehavior(a,this,this._show_pre_mission_window),xyd.setNormalBtnBehavior(s,this,function(){i._debugData.h5GoToMap(xyd.MainStageType.SevernMap)})}return void t(void 0,{})}this._debugData.currentLevel>10?this._debugData.clearStreak+=1:this._debugData.clearStreak=0;var r=0,l=0,_=void 0;if(e.total_level==this._debugData.currentLevel){this._debugData.currentLevel+=1,this._debugData.lastCookingLevel+=1;var h=this._debugData.lastCookingLevel,c=(new Date).getTime()/1e3+864e3;_={cooking_level:h,end_time:c,rewards:[{level:2,reward_list:{"1=1003":100,"1=1002":100,"2=1012":1,"2=1001":1}},{level:10,reward_list:{"1=1003":100,"1=1002":100,"2=1001":2,"2=1014":1,"2=1006":1}},{level:20,reward_list:{"1=1003":100,"2=1015":1,"2=1001":2,"2=1006":1,"2=1002":1}}]}}if(this._debugData.getRecords().length==e.total_level-1){var d=0,p=e.total_level;(2==p||6==p||10==p||p%10==0)&&(d=1),this._debugData.getRecords().push({level:e.total_level,stars:e.stars,score:e.score,packet_type:d,packet_status:1}),l=e.stars}else{var u=this._debugData.getRecords()[e.total_level-1];r=u.stars;var m=u.score;u.stars=Math.max(r,u.stars),u.score=Math.max(m,u.score),u.packet_status=u.packet_type>0?Math.max(u.packet_status,1):0,l=e.stars}if(1==e.total_level||5==e.total_level||10==e.total_level)var u=this._debugData.getRecords()[e.total_level-1];e.gather_task&&this._debugData.addGatherTaskTargetNum(e.gather_task),e.game_count&&this._monthcard_update(e.game_count);var g=(Math.random()>.3?!0:!1,this._debugData.getBalance()),f=g+25*Math.max(0,l-r),y=Math.ceil(7*Math.random());this._debugData.addStar(l-r),this._debugData.setBalance(f);var E=LevelTable.get().getTableData(e.total_level),v=E&&E.lucky_wheel>0?!0:!1;7==y&&(v=!1);var T={has_spin:v,clear_reward_type:y,clear_streak:this._debugData.clearStreak,first_streak:!0,old_stars:r,old_balance:g,new_balance:f,previous_cash:100,current_cash:120,can_withdraw:!0,show_privilege_guide:!1,billion_cash_status:2};T.old_coin=g,T.new_coin=f,console.log(T),e.funds_count&&(T.funds_packet={funds_packet_sn:"asdjia",type:0,status:1,amount_max:1e3,expired_at:(new Date).getTime()/1e3+864e3}),t(void 0,T),platform.callMethod("H5_SHOW_WIN_WINDOW",{show_end_game_window:1,show_pre_game_window:1})},e.prototype._gameEnd=function(e,t){console.log("Game End: "),console.log(e),this._debugData.clearStreak=0,e.game_count&&this._monthcard_update(e.game_count),t(void 0,void 0)},e.prototype._gamePreEnd=function(e,t){var i=this;if(console.log("Game Pre End: "),console.log(e),e.mission_info){var n=xyd.WindowManager.get().getWindow("game_window");if(n){var o=new eui.Label("失败窗口");o.size=50,o.textColor=0,o.bold=!0,o.x=400,o.y=850;var a=new eui.Image("btn_anchang_png");a.x=400,a.y=900;var s=new eui.Image("btn_fenchang_png");s.x=400,s.y=1020,n.group_tips.removeChildren(),n.group_tips.addChild(o),n.group_tips.addChild(a),n.group_tips.addChild(s),xyd.setNormalBtnBehavior(a,this,function(){e.game_end_callback(),i._show_pre_mission_window()}),xyd.setNormalBtnBehavior(s,this,function(){var t=xyd.WindowManager.get().getWindow("game_window");t&&t.group_tips.removeChildren(),e.game_resume_callback()})}return void t(void 0,{})}var r=e.callback,l=function(){console.log("Add Moves click callback"),r(!0)};t(void 0,{success:!0,text:"邀请好友",callback:l,btn_info:{breath:!0,bubble_text:"气泡内容",click_type:1},is_reach_coin_limit:!0})},e.prototype._getUserInfo=function(e,t){t(void 0,{nickname:"Test",avatar:"icon_tiezhi_png",share_info:{general_invite:this._getRandomBoolean(),quest_invite:this._getRandomBoolean(),collect_mission_packet:this._getRandomBoolean(),leaderboard_invite:this._getRandomBoolean(),collect_map_packet:this._getRandomBoolean(),quest_inviet:this._getRandomBoolean(),pre_game_share:this._getRandomBoolean(),score_rank_recall:this._getRandomBoolean()},uid:"user12345"})},e.prototype._getRandomBoolean=function(){return!0},e.prototype._gameBuyItem=function(e,t){console.log("GAME BUY ITEM"),console.log(e);var i,n=!0,o=e.itemID;n?(i=this._debugData.addItemByID(o),this._debugData.gems-=ItemConstants.ITEM_PRICE[o],alert("购买成功！")):(i=this._debugData.getItemByID(o),alert("购买失败！"));var a=this._debugData.addItemByID(1017),s={success:n,items:[{itemID:e.itemID,quantity:void 0!=i?i.quantity:0,expire_time:void 0!=i.expire_time?i.expire_time.slice():void 0},{itemID:1017,quantity:void 0!=a?a.quantity:0,expire_time:void 0}]};t(void 0,s)},e.prototype._gameUseItem=function(e,t){console.log("GAME USE ITEM"),console.log(e);var i=this._debugData.useItemByID(e.itemID),n={success:!0,itemID:e.itemID,quantity:void 0!=i?i.quantity:0,expire_time:void 0};i&&i.expire_time&&(n.expire_time=i.expire_time.slice()),t(void 0,n)},e.prototype._gamePreBegin=function(e,t){console.log("GAME_PRE_BEGIN"),console.log(e);var i=void 0,n=Math.random()>0?!0:!1,o=Math.random()>.5?!0:!1,a=Math.random()>.5?"去App领奖励":"领App奖励",s=e.total_level,r={color:"pink",breath:!1,bubble:!0,text:a,bubble_text:"气泡内容",click_type:1},l={init_count:5,drop_count:10};i={success:n,total_level:s,has_pre_game_reward:o,btn_text:a,pre_reward_times:5*Math.random(),btn_info:r,funds:l},t(void 0,i)},e.prototype._logger=function(e,t){console.log(e),t(void 0,e)},e.prototype._logError=function(e,t){t(void 0,e)},e.prototype._gameOnShow=function(e,t){t(void 0,e)},e.prototype._gameOnHide=function(e,t){t(void 0,e)},e.prototype._gameOnLeave=function(e,t){var i={success:!1};t(void 0,i)},e.prototype._gameRecover=function(e,t){t(void 0,void 0)},e.prototype._getSavedGame=function(e,t){console.log("GET_SAVED_GAME");var i=egret.localStorage.getItem("savedBoard"),n={data:{}};if(void 0!=i)try{n.data=JSON.parse(i)}catch(o){console.log("cannot parse saved board, not a valid json")}console.log(n.data),t(void 0,n)},e.prototype._saveGame=function(e,t){var i="{}";try{i=JSON.stringify(e)}catch(n){console.log("cannot stringify saved board")}egret.localStorage.setItem("savedBoard",i),t(void 0,void 0)},e.prototype._get_storage=function(e,t){console.log("GET_SAVED_ITEM");var i=e.key,n=egret.localStorage.getItem(i),o={};if(void 0!=n)try{o=JSON.parse(n)}catch(a){console.log("cannot parse saved item, not a valid json")}console.log(o),t(void 0,o)},e.prototype.set_storage=function(e,t){console.log("SAVE_ITEM");for(var i in e){var n="",o=void 0;n=i,o=e[i];var a="{}";try{a=JSON.stringify(o)}catch(s){console.log("cannot stringify item")}egret.localStorage.setItem(n,a)}t(void 0,void 0)},e.prototype.save_pet_info=function(e,t){console.log("SAVE_ITEM");for(var i in e){var n="",o=void 0;n=i,o=e[i];var a="{}";try{a=JSON.stringify(o)}catch(s){console.log("cannot stringify item")}egret.localStorage.setItem(n,a)}t(void 0,void 0)},e.prototype._syncGameData=function(e,t){e&&e.callback?this._debugData.onBack=e.callback:this._debugData.onBack=void 0},e.prototype._gameClaimPacket=function(e,t){console.log("GAME_CLAIM_PACKET");var i=e.level,n=!1,o=this._debugData.getRecords()[i-1];o&&o.packet_type>0&&1==o.packet_status&&(o.packet_status=2,n=!0),n&&console.log("CLAIM_PACKET"),t(void 0,{success:n})},e.prototype._gameShowOff=function(e,t){console.log("GAME_SHOW_OFF");var i=e.level,n=Math.random()>.5?!0:!1;n&&alert("SHOW_OFF At level "+i),t(void 0,{success:n})},e.prototype._gameShowOffInfo=function(e,t){console.log("GAME_SHOW_OFF_INFO");var i=Math.random()>.5?!0:!1;t(void 0,{show:i})},e.prototype._gameShowUI=function(e,t){var i=this;if(void 0==this._pddUILayer){this._pddUILayer=new BaseSpriteLayer;var n=new eui.Image("icon_hongbao_topbar_png");n.x=50,n.y=150;var o=new eui.Label("PDD");o.x=85,o.y=220,o.bold=!0,this._pddUILayer.addChild(n),this._pddUILayer.addChild(o),App.SceneManager.getCurrScene().addLayerAt(this._pddUILayer,98),this._pddUILayer.visible=!1}if(void 0==this._gotoAppUILayer){this._gotoAppUILayer=new BaseSpriteLayer;var o=new eui.Label("goto app");o.textColor=0,o.x=85,o.y=xyd.getHeight()-300,o.bold=!0,this._gotoAppUILayer.addChild(o),this._pddUILayer.addChild(this._gotoAppUILayer),this._gotoAppUILayer.visible=!1}if(void 0==this._staticUILayer){this._staticUILayer=new BaseSpriteLayer;var n=new eui.Image("icon_guanbi_1_png");n.x=50,n.y=1920;var o=new eui.Label("BACK");o.textColor=0,o.x=70,o.y=1970,o.bold=!0,this._staticUILayer.addChild(n),this._staticUILayer.addChild(o),App.SceneManager.getCurrScene().addLayerAt(this._staticUILayer,99),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i._onBackBtnClick()},this)}void 0!=e.show_overlay&&(this._pddUILayer.visible=e.show_overlay),void 0!=e.show_goto_app&&(this._gotoAppUILayer.visible=e.show_goto_app),t(void 0,{})},e.prototype._gameLimitedGiftbag=function(e,t){t(void 0,{})},e.prototype._gamePreRetry=function(e,t){alert("Pre Retry");var i="1001",n=this._debugData.getItemByID(i),o=!1;n&&n.quantity>0&&(o=!0),o?t(void 0,{can_get_bonus:!0,items:{1001:n}}):t(void 0,{can_get_bonus:!1})},e.prototype._getGatherTaskGroupInfo=function(e,t){var i=this._debugData.gatherTaskData;t(void 0,i)},e.prototype._onGatherTaskIconClick=function(e,t){t(void 0,{})},e.prototype._gameShowMapPopups=function(e,t){alert("pdd popups!"),t(void 0,{})},e.prototype._get_pre_game_reward=function(e,t){console.log("_get_pre_game_reward total level:",e.total_level),t(void 0,{success:!0})},e.prototype._gameShare=function(e,t){var i=e.type;if("general_invite"==i)t(void 0,{});else if("collect_mission_packet"==i){var n=-1;e.params&&e.params.index&&(n=e.params.index);var o=this._debugData.claimGatherTaskPacket(n);t(void 0,{success:o})}else if("collect_map_packet"==i){console.log("GAME_CLAIM_PACKET");var a=-1,o=!1;e.params&&e.params.level&&(a=e.params.level);var s=this._debugData.getRecords()[a-1];a>0&&s&&s.packet_type>0&&1==s.packet_status&&(s.packet_status=2,o=!0),o&&console.log("CLAIM_PACKET"),t(void 0,{success:o})}else if("pre_game_share"==i)t(void 0,{success:!0});else if("quest_invite"==i){var r=-1;e.params&&e.params.quest_id&&(r=e.params.quest_id),t(void 0,{success:!0})}else"score_rank_recall"==i?t(void 0,{}):t("unknown share type",{})},e.prototype._getAbTests=function(e,t){void 0==this._ABTestInfo&&this._initABTestInfo(),console.log("Ongoing AB Test: "),console.log(this._ABTestInfo),t(void 0,this._ABTestInfo)},e.prototype._initABTestInfo=function(){var e={easier_score_targets:this._getAbTestRandomGroup(.5),cannot_skip_guide:this._getAbTestRandomGroup(.5),can_enter_home_map:"A",is_items_guide:"A",newuser_benefits:"A",newuser_stage_cash_reward:"B",first_ten_level_pay:"B",board_simple:"A",board_expiration:"A",small_skip_btn:"A",win_game_cash_reward:"B",show_goods_by_step:"A",show_goods_coin_after_game:"A",severn_map:"A",new_stage_map_style:"A",android_strong_reminder:"A",new_ingame_item_limit:"B",new_funds_guide:"A",map_red_packet_style:"A"};this._ABTestInfo=e},e.prototype._getAbTestRandomGroup=function(e){return Math.random()>e?"A":"B"},e.prototype._h5_receive_items_anim=function(e,t){t(void 0,{})},e.prototype._h5_play_or_stop_bgm=function(e,t){this._debugData.h5PlayOrStopBGM=e.callback,t(void 0,{})},e.prototype._h5_open_pregame_win=function(e,t){this._debugData.showFingerCallback=e.callback,t(void 0,{})},e.prototype._h5_close_pregame_win=function(e,t){t(void 0,{})},e.prototype._h5_enter_game_directly=function(e,t){this._debugData.enterGameDirectly=e.callback,t(void 0,{})},e.prototype._h5_in_game_window=function(e,t){t(void 0,{})},e.prototype._h5_new_user_enter_home_map=function(e,t){t(void 0,{})},e.prototype._h5_action_in_game=function(e,t){t(void 0,{})},e.prototype._leaderboard_get_info=function(e,t){var i=this,n=e.start,o=e.end;console.log(n+" - "+o),egret.setTimeout(function(){t(void 0,i._debugData.getLeaderboardInfo(n,o))},this,500)},e.prototype._get_score_rank_for_level=function(e,t){var i=e.level,n=e.start,o=e.end,a=this._debugData.getScoreRankForLevel(i,n,o),s=this._debugData.getScoreRankForLevel(i,1,4);t(void 0,{rank_data:a,recall_list:s})},e.prototype._leaderboard_send_stamina=function(e,t){var i=!1;e&&e.uin_list&&e.uin_list.length>=0&&(i=!0),t(void 0,{success:i})},e.prototype._leaderboard_claim_stamina=function(e,t){var i=!1;e&&e.uin_list&&e.uin_list.length>0&&(i=!0),t(void 0,this._debugData.getSendList())},e.prototype._leaderboard_on_icon_click=function(e,t){t(void 0,{})},e.prototype._monthly_card_on_icon_click=function(e,t){t(void 0,{})},e.prototype._get_friends_ranking=function(e,t){t(void 0,this._debugData.getFriendsRanking())},e.prototype._game_show_sales=function(e,t){var i=!0;t(void 0,{success:i})},e.prototype._leaderboard_stamina_status=function(e,t){t(void 0,this._debugData.getStaminaInfo())},e.prototype._h5_return_stage=function(e,t){},e.prototype._onBackBtnClick=function(){this.waitState?(this._debugData.resumeCallback(),this.waitState=!1):(this._debugData.releaseMemoryCallback(),this.waitState=!0)},e.prototype._monthcard_info=function(e,t){t(void 0,this._debugData.monthCardInfo)},e.prototype._monthcard_rewards=function(e,t){var i=e.start_level,n=e.end_level;t(void 0,this._debugData.getMonthCardRewardInfo(i,n))},e.prototype._monthcard_tasks=function(e,t){var i=e.week,n=this._debugData.monthCardTasks[i];t(void 0,{tasks:n})},e.prototype._monthcard_purchase=function(e,t){var i,n;this._debugData.monthCardInfo.purchased?(i=!1,n=!0):(i=!0,n=!0,this._debugData.monthCardInfo.purchased=!0),t(void 0,{success:i,purchased:n})},e.prototype._monthcard_claim_reward=function(e,t){var i=this,n=e.claim_all,o=e.level,a=e.item_id,s=e.free;n&&(this._debugData.monthCardInfo.reward_level=0),t(void 0,this._debugData.claimRewardData(n,o,a,s)),egret.setTimeout(function(){i._debugData.isAllItemsGetted()&&(i._debugData.monthCardInfo.reward_level=0)},this,500)},e.prototype._newuser_stage_cash_reward=function(e,t){alert("_newuser_stage_cash_reward"),t(void 0,e)},e.prototype._lucky_wheel_spin=function(e,t){return e.callback?(this._debugData.luckWheelCallback=e.callback,void t(void 0,e)):(e.level?(this._debugData.luckWheelCallback({level:e.level,success:!0}),alert("Let the wheel spin!")):alert("In homemap the wheel spin!"),void t(void 0,e))},e.prototype._monthcard_update=function(e){for(var t in this._debugData.monthCardTasks)for(var i=this._debugData.monthCardTasks[t],n=0,o=0,a=i;o<a.length;o++){var s=a[o];switch(s.task_id){case"1001":n=0|e.element_count[17104896];break;case"1002":n=0|e.element_count[16842756];break;case"1003":n=0|e.element_count[50331648];break;case"1004":n=0|e.swap_count[33555712];break;case"1005":n=0|e.element_count[16842754];break;case"1006":n=0|e.swap_count[83887360]}s.current_count=Math.min(s.current_count+n,s.total_count)}},e.prototype._monthcard_get_rank_info=function(e,t){var i=this,n=e.start,o=e.end;console.log(n+" - "+o),egret.setTimeout(function(){t(void 0,i._debugData.getMonthCardRankInfo(n,o))},this,500)},e.prototype._get_wallet_dollar=function(e,t){t(void 0,{dollar:Math.floor(1e4*Math.random())})},e.prototype._open_wallet=function(e,t){t(void 0,{}),alert("_open_wallet")},e.prototype._open_backpack=function(e,t){t(void 0,{}),alert("_open_backpack")},e.prototype._get_diamond_num=function(e,t){var i=this;egret.setTimeout(function(){t(void 0,{diamond_num:i._debugData.gems})},this,1e3)},e.prototype._not_enough_diamond=function(e,t){e.type;t(void 0,{})},e.prototype._h5_toggle_map=function(e,t){t(void 0,{})},e.prototype._h5_get_is_play_in_stage=function(e,t){t(void 0,{})},e.prototype._finger_show=function(e,t){if(t(void 0,{}),this._debugData.showFingerCallback){var i={level:SelfInfo.get().getCurrentLevel(),scene_id:123,need_replace_leaderboard:!0};this._debugData.showFingerCallback(i)}},e.prototype._toggle_to_home_or_stage=function(e,t){console.log("toggle map type ",e.status),t(void 0,{})},e.prototype._show_rule_window=function(e,t){console.log("show ruls window"),t(void 0,{})},e.prototype._pregame_show_goods_get_info=function(e,t){t(void 0,this._debugData.getPreGameShowGoodsInfo())},e.prototype._pregame_show_goods_open_window=function(e,t){alert("pdd popups! status: "+e.status+" mission_id: "+e.mission_id),t(void 0,{})},e.prototype._open_piggy=function(e,t){alert("open piggy"),t(void 0,{can_withdraw:!1,current_cash:90})},e.prototype._billion_cash_click_button=function(e,t){alert("billion_cash_click"),t(void 0,{})},e.prototype._click_start_button=function(e,t){t(void 0,{is_open:!0})},e.prototype._h5_show_win_window=function(e,t){if((0==e.show_pre_game_window||1==e.show_pre_game_window)&&(1==e.show_pre_game_window?SelfInfo.get().setSkipPreWindow(!1):SelfInfo.get().setSkipPreWindow(!0)),0==e.show_end_game_window){var i=xyd.WindowManager.get().getWindow("win_game_window");i&&i.closeUIAndDoNext()}else{var i=xyd.WindowManager.get().getWindow("win_game_window");i&&i.showUI(),t(void 0,{})}},e.prototype._show_severn_map=function(e,t){t(void 0,{})},e.prototype._h5_sound_bg=function(e,t){t(void 0,{})},e.prototype._h5_sound_effect=function(e,t){t(void 0,{})},e.prototype._h5_goto_map=function(e,t){this._debugData.h5GoToMap=e.callback,t(void 0,{})},e.prototype._goto_map_success=function(e,t){t(void 0,{})},e.prototype._show_pre_mission_window=function(){var e=this,t=xyd.WindowManager.get().getWindow("game_window");if(t){var i=new eui.Label("开局窗口");i.x=400,i.y=850,i.size=50,i.textColor=0,i.bold=!0;var n=new eui.Image("btn_huangxiao_png");n.x=400,n.y=900;var o=new eui.Image("btn_fenchang_png");o.x=400,o.y=1020,t.group_tips.removeChildren(),t.group_tips.addChild(i),t.group_tips.addChild(n),t.group_tips.addChild(o),xyd.setNormalBtnBehavior(n,this,function(){e._debugData.enterGameDirectly(e._debugData.spring_level_info)}),xyd.setNormalBtnBehavior(o,this,function(){e._debugData.h5GoToMap(xyd.MainStageType.SevernMap)
})}},e.prototype._h5_get_game_target=function(e,t){this._debugData.h5GetGameTarget=e.callback,t(void 0,void 0)},e.prototype._get_clear_stage_info=function(e,t){t(null,{success:!0,remaining_level:4})},e.prototype._show_clear_stage_reward=function(){alert("pdd show clear stage reward")},e.prototype._strong_reminder=function(e,t){t(void 0,{success:!0})},e.prototype._get_vip_info=function(e,t){t(void 0,this._debugData.getVipInfo())},e.prototype._click_vip_board=function(e,t){t(void 0,{}),alert("click vip board!")},e.prototype._get_banner_info=function(e,t){var i={};if(i.type="funds","severn"==i.type)i.data=this._debugData.getPreGameShowGoodsInfo();else if("rank"==i.type){var n=e.level,o=e.start,a=e.end,s=this._debugData.getScoreRankForLevel(n,o,a),r=this._debugData.getScoreRankForLevel(n,1,4);i.data={rank_data:s,recall_list:r}}else"funds"==i.type&&(i.data={funds_account:this._debugData.getfundsData()});t(void 0,i)},e.prototype._showRedPacket=function(e,t){window.alert("red_bag!")},e.prototype._game_end_click_packet=function(e,t){this._debugData.addFundsAmount(137),t(void 0,{status:0,amount:137})},e.prototype._h5_game_release_memory=function(e,t){this._debugData.releaseMemoryCallback=e.callback,t(void 0,void 0)},e.prototype._h5_game_resume=function(e,t){this._debugData.resumeCallback=e.callback,t(void 0,void 0)},e.prototype._h5_show_setting_win=function(e,t){this._debugData.h5ShowSettingWin=e.callback,t(void 0,{})},e}();__reflect(DebugGameBridge.prototype,"DebugGameBridge"),window.DebugGameBridge=DebugGameBridge;var DPackColorColor=function(e){function t(t,i,n,o){var a=e.call(this,t,i,o)||this;return a._lastOffset=0,a._color=0,a._allGridContainers=[],a._framesPostDone=-1,a._framesToInitEff=2*xyd.frameScale,a._framesToInitExplode=60*xyd.frameScale,a._explodeEffFrames=30*xyd.frameScale,a._explodeEffFrontCircleFrames=10*xyd.frameScale,a._initHoldFrames=Math.floor(60*xyd.frameScale),a._framestoRemove=7*xyd.frameScale,a._layerContainerMap={},a._toEle=i,a._type=MatchConstants.DP_COLOR_COLOR,a._fromEle=n,a._fromCol=n.col,a._fromRow=n.row,a._combinedPoint=new egret.Point((n.col+i.col)/2,(n.row+i.row)/2),a._maxDistance=a.getMaxDistance(),a._maxManhattanDistance=a.getMaxManhattanDistance(),a._explodeScale=a._maxDistance/2.5,a._framesPerLayer=a._explodeEffFrontCircleFrames/Math.ceil(a._maxManhattanDistance),a._nowLayer=1,a}return __extends(t,e),t.prototype.getMaxManhattanDistance=function(){return Math.max(this.getManhattanDistance(0,0,this._fromEle.col,this._fromEle.row),this.getManhattanDistance(0,9,this._fromEle.col,this._fromEle.row),this.getManhattanDistance(9,0,this._fromEle.col,this._fromEle.row),this.getManhattanDistance(9,9,this._fromEle.col,this._fromEle.row),this.getManhattanDistance(0,0,this._toEle.col,this._toEle.row),this.getManhattanDistance(0,9,this._toEle.col,this._toEle.row),this.getManhattanDistance(9,0,this._toEle.col,this._toEle.row),this.getManhattanDistance(9,9,this._toEle.col,this._toEle.row))},t.prototype.getManhattanDistance=function(e,t,i,n){return Math.abs(e-i)+Math.abs(t-n)},t.prototype.getMaxDistance=function(){var e=new egret.Point(0,0),t=new egret.Point(9,0),i=new egret.Point(0,9),n=new egret.Point(9,9);return Math.max(egret.Point.distance(this._combinedPoint,e),egret.Point.distance(this._combinedPoint,t),egret.Point.distance(this._combinedPoint,i),egret.Point.distance(this._combinedPoint,n))},t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=(this._initCol,this._initRow,0);t<=this._maxManhattanDistance;t++)this._layerContainerMap[t]=[];for(var t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++){var n=Math.min(this.getManhattanDistance(t,i,this._fromEle.col,this._fromEle.row),this.getManhattanDistance(t,i,this._toEle.col,this._toEle.row)),o=this._board.getGridContainerAt(t,i);if(o){if(o.hasElement()){var a=o.getElement();a.type==ElementTypeConstants.ROCKET&&(this._shouldRefuelToRocket=!0),0==a.isLocked()&&(o.getElement().shouldNotFall=!0)}this._layerContainerMap[n].push(o)}else this._board.hasLeafAtGrid(t,i)&&(o=new GridContainer(t,i,void 0,void 0),this._layerContainerMap[n].push(o))}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_INIT,!1,{fromEle:this._fromEle,toEle:this._toEle,combinedPoint:this._combinedPoint})},t.prototype.update=function(){if(this._numFrames+=1,this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[],this._numFrames==this._framesToInitEff&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_INIT_EFFECT,!1,{combinedPoint:this._combinedPoint}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_BEGIN)),this._numFrames==this._framesToInitExplode&&(this._framesPostDone=this._framestoRemove,this._toEle.setDestroyFrames(this._framesPostDone),this._fromEle.setDestroyFrames(this._framesPostDone),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_INIT_EXPLOSION,!1,{combinedPoint:this._combinedPoint,scale:this._explodeScale})),!(xyd.frameScale>1&&this._numFrames%2==0||this._numFrames<=this._initHoldFrames)){var e=this._numFrames-this._framesToInitExplode;if(!(e<this._framesPerLayer*this._nowLayer)){if(this._nowLayer<=this._maxManhattanDistance){for(var t=0,i=this._layerContainerMap[this._nowLayer];t<i.length;t++){var n=i[t];if(n.hasBlocker()){var o=n.getBlocker();this._affectedBlockers.push(o),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_TARGET,!1,{toX:o.col,toY:o.row})}else if(n.hasElement()){var a=n.getElement();this._affectedElements.push(a);var s=this._board.getCellEdgesAtGrid(a.col,a.row);if(s)for(var r=0;r<xyd.directions.length;r++){var l=this._board.getCellFenceAtGridInDir(s.Col,s.Row,r);void 0!=l&&this._affectedBlockers.push(l)}a.shouldNotFall=!1,a.type==ElementTypeConstants.ROCKET&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_EMPTY_CELL,!1,{col:n.getCol(),row:n.getRow()}),(a.type==ElementTypeConstants.LAMP_1||a.type==ElementTypeConstants.LAMP_2)&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_EMPTY_CELL,!1,{col:n.getCol(),row:n.getRow()}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_TARGET,!1,{toX:a.col,toY:a.row})}else xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_TARGET,!1,{toX:n.getCol(),toY:n.getRow()}),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REMOVE_EMPTY_CELL,!1,{col:n.getCol(),row:n.getRow()});this._lastOffset==this._allGridContainers.length}this._nowLayer++}this._nowLayer>this._maxManhattanDistance&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_COLOR_END),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.SHAKE_BOARD,!1,{intensity:1}),this._isDone=!0)}}},t}(DPack);__reflect(DPackColorColor.prototype,"DPackColorColor");var DPackColorSpecial=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n)||this;return a._lastOffset=0,a._color=0,a._toRemoveElements=[],a._numToRemove=1,a._framesPerRemove=-1,a._framesPostDone=-1,a._initHoldFrames=Math.floor(7*xyd.frameScale),a._framesBeforeDP=Math.floor(20*xyd.frameScale),a._type=MatchConstants.DP_COLOR,a._changeType=o,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++){var n=this._board.getIntergratedElementAt(t,i);!n||n.type==ElementTypeConstants.GOLDEN_EGG||n.busy||n.color!=this.sourceColor||n.col==this._initCol&&n.row==this._initRow||n.hasGiftWrapper()||xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:this._initCol,fromY:this._initRow,toX:n.x,toY:n.y})}},t.prototype.update=function(){if(this._numFrames+=1,this._numFrames==this._initHoldFrames){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_BEGIN);for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getIntergratedElementAt(e,t);if(i&&i.type!=ElementTypeConstants.GOLDEN_EGG&&!i.busy&&i.color==this.sourceColor&&(i.col!=this._initCol||i.row!=this._initRow)&&!i.hasGiftWrapper()){if(i.type==ElementTypeConstants.ROCKET){var n=i;this._shouldRefuelToRocket=!0,this.changeRocket(n)}else this._changeType==DPackColor.CHANGE_TYPE.BMOB_LINE?this.checkIsSwapElement(i)||(i=this.doLineChange(i)):this._changeType==DPackColor.CHANGE_TYPE.BOMB_SQURE?this.checkIsSwapElement(i)||(i=this.doSqureChange(i)):this._changeType==DPackColor.CHANGE_TYPE.BOMB_TORNADO&&(this.checkIsSwapElement(i)||(i=this.doTornadoChange(i))),i.shouldNotFall=!0;this._allElements.push(i)}}this._allElements.sort(function(e,t){return e.y!=t.y?e.y-t.y:e.x-t.x});var o=this._allElements.length;this._framesPerRemove=Math.floor(3*xyd.frameScale),this._minNumToRemove=Math.floor(o/this._removalTimes),this._maxNumToRemove=this._minNumToRemove+1,this._framesToSwatchRemoveNum=(o-o%this._removalTimes*this._maxNumToRemove)*this._framesPerRemove+2*this._initHoldFrames,0==this._allElements.length&&(this._framesPostDone=this._framestoRemove,this._initElement.setDestroyFrames(this._framestoRemove))}if(!(this._numFrames<=this._initHoldFrames)){this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var a=0;if(this._numFrames>this._framesBeforeDP&&this._allElements.length>0&&this._numFrames%this._framesPerRemove==0){for(a=this._numFrames<this._framesToSwatchRemoveNum?this._minNumToRemove:this._maxNumToRemove;a>0&&this._allElements.length>0;){var i=this._allElements[0];if(this._affectedLocs.push({x:i.col,y:i.row}),i.type==ElementTypeConstants.TORNADO){var s=i;s.triggerBy({type:ElementTypeConstants.BOMB_COLOR}),this._board.addForRemoval(i)}else if(i.type!=ElementTypeConstants.ROCKET)this._affectedElements.push(i);else{var n=i;n.consumeSpecialPower(),this._rocket=n}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_TARGET_END,!1,{ele:i}),this._allElements.splice(0,1),a-=1}0==this._allElements.length&&(this._framesPostDone=this._framesPostDoneMax)}this._framesPostDone>0?(this._framesPostDone-=1,this._framesPostDone==this._framestoRemove&&(this._initElement.setDestroyFrames(this._framestoRemove),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_END,!1,{ele:this._initElement}))):0==this._framesPostDone&&(this._isDone=!0)}},t}(DPackColor);__reflect(DPackColorSpecial.prototype,"DPackColorSpecial");var DPackColRowThree=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._rowPacks=[],o._colPacks=[],o._color=2,o._dpColFrames=0,o._dpRowFrames=0,o._dpColStart=!1,o._type=MatchConstants.DP_COL_ROW_THREE,o}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);var t=this._board.getIntergratedElementAt(this._initCol,this._initRow);t&&(this._color=t.color);for(var i=Math.max(0,this._initRow-1),n=Math.min(this._board.getBoardRows(),this._initRow+1),o=Math.max(0,this._initCol-1),a=Math.min(this._board.getBoardCols(),this._initCol+1);n>=i;){var s=this._board.getIntergratedElementAt(this._initCol,i);void 0==s&&(s=new BoardElement(this._initCol,i,this._initElement.color,ElementTypeConstants.NORMAL));var r=new DPackRow(this._board,s,this._swap);r.setup(),r.setShowAnimation(!1),this._rowPacks.push(r),i++}for(;a>=o;){var s=this._board.getIntergratedElementAt(o,this._initRow);void 0==s&&(s=new BoardElement(o,this._initRow,this._initElement.color,ElementTypeConstants.NORMAL));var l=new DPackCol(this._board,s,this._swap,!1);l.setShowAnimation(!1),l.setup(),this._colPacks.push(l),o++}},t.prototype.update=function(){if(this._numFrames++,0==this._rowPacks.length&&(this._dpColStart=!0),this._dpColStart){if(this._dpColFrames++,1==this._dpColFrames&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COL_ROW_THREE,!1,{x:this._initCol,y:this._initRow,color:this._color,direction:1}),this._dpColFrames<Math.floor(9*xyd.frameScale))return}else if(this._dpRowFrames++,1==this._dpRowFrames&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COL_ROW_THREE,!1,{x:this._initCol,y:this._initRow,color:this._color,direction:0}),this._dpRowFrames<Math.floor(9*xyd.frameScale))return;this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var e;e=this._dpColStart?this._colPacks:this._rowPacks;for(var t=[],i=[0,1],n=[2,3],o=0,a=e;o<a.length;o++){var s=a[o];s.update();for(var r=0,l=s.getAffectedLocs();r<l.length;r++){var _=l[r];this._affectedLocs.push(_)}for(var h=0,c=s.getElementsToRemove();h<c.length;h++){var d=c[h];if(this._affectedElements.push(d),1==e.indexOf(s)){this._board.getCellEdgesAtGrid(d.col,d.row);if(this._dpColStart)for(var p=0;p<n.length;p++){var u=this._board.getCellFenceAtGridInDir(d.col,d.row,n[p]);void 0!=u&&this._affectedBlockers.push(u)}else for(var p=0;p<i.length;p++){var u=this._board.getCellFenceAtGridInDir(d.col,d.row,i[p]);void 0!=u&&this._affectedBlockers.push(u)}}}for(var m=0,g=s.getBlockersToRemove();m<g.length;m++){var f=g[m];this._affectedBlockers.push(f)}s.isDone()||t.push(s)}var y=this._board.getCellEdgesAtGrid(this._initCol,this._initRow);if(y)for(var E=0;E<xyd.directions.length;E++){var u=this._board.getCellFenceAtGridInDir(y.Col,y.Row,E);u&&this._affectedBlockers.push(u)}this._rowPacks.length>0?this._rowPacks=t:this._colPacks.length>0?this._colPacks=t:this._isDone=!0},t.prototype.isDone=function(){return this._isDone},t}(DPack);__reflect(DPackColRowThree.prototype,"DPackColRowThree");var DPackCrayon=function(e){function t(t,i,n,o){return e.call(this,t,i,n,o)||this}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=3,i=xyd.directions[this._dir][0],n=xyd.directions[this._dir][1],o=0;t>o;o++){var a=this._board.getIntergratedElementAt(this._initEle.col+i*o,this._initEle.row+n*o);void 0!=a&&this._unchangedElemnts.push(a)}this._replaceType=this._dir<=1?ElementTypeConstants.BOMB_ROW:ElementTypeConstants.BOMB_COL},t.prototype.update=function(){if(this._numFrames++,this._numFrames%this._intelvalFrame==0){var e=this._unchangedElemnts[0];xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_EFFECT,!1,{ele:e,dir:this._dir});var t=this._board.getElementFactory(),i=t.create(e.col,e.row,e.color,this._replaceType);this._board.replaceBoardElement(i),this._unchangedElemnts.splice(0,1),this._changedElements.push(i)}if(0==this._unchangedElemnts.length){this._isDone=!0;for(var n=0;n<this._changedElements.length;n++){var e=this._changedElements[n];e.setDestroyFrames(1),this._affectedElements.push(e)}}},t}(DPackCrayonBase);__reflect(DPackCrayon.prototype,"DPackCrayon");var DragonBonesFactory=function(e){function t(){var t=e.call(this)||this;return t.averageUtils=new AverageUtils,t.factory=new dragonBones.EgretFactory,t.clocks=new Array,t.clocksLen=0,t.files=[],t.start(),t}return __extends(t,e),t.prototype.initArmatureFile=function(e,t,i){-1==this.files.indexOf(e.name)&&(this.addSkeletonData(e),this.addTextureAtlas(t,i),this.files.push(e.name))},t.prototype.removeArmatureFile=function(e){var t=this.files.indexOf(e);-1!=t&&(this.removeSkeletonData(e),this.removeTextureAtlas(e),this.files.splice(t,1))},t.prototype.clear=function(){for(;this.files.length;)this.removeArmatureFile(this.files[0])},t.prototype.addSkeletonData=function(e){this.factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(e))},t.prototype.addTextureAtlas=function(e,t){this.factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(e,t))},t.prototype.removeSkeletonData=function(e){this.factory.removeSkeletonData(e)},t.prototype.removeTextureAtlas=function(e){this.factory.removeTextureAtlas(e)},t.prototype.makeArmature=function(e,t,i){void 0===i&&(i=1);var n=this.factory.buildArmature(e,t);if(null==n)return Log.trace("不存在Armature： "+e),null;var o=this.createWorldClock(i),a=new DragonBonesArmature(n,o);return a},t.prototype.makeFastArmature=function(e,t,i){void 0===i&&(i=1);var n=this.makeArmature(e,t,i);return n.getArmature().enableAnimationCache(24),n},t.prototype.createWorldClock=function(e){for(var t=0;t<this.clocksLen;t++)if(this.clocks[t].timeScale==e)return this.clocks[t];var i=new dragonBones.WorldClock;return i.timeScale=e,this.clocks.push(i),this.clocksLen=this.clocks.length,i},t.prototype.onEnterFrame=function(e){this.averageUtils.push(e);for(var t=.001*this.averageUtils.getValue(),i=0;i<this.clocksLen;i++){var n=this.clocks[i];n.advanceTime(t)}},t.prototype.stop=function(){this.isPlay&&(App.TimerManager.remove(this.onEnterFrame,this),this.isPlay=!1)},t.prototype.start=function(){this.isPlay||(this.isPlay=!0,App.TimerManager.doFrame(1,0,this.onEnterFrame,this))},t}(BaseClass);__reflect(DragonBonesFactory.prototype,"DragonBonesFactory");var GuideMaskBackgroud=function(e){function t(){var t=e.call(this)||this;return t._stageWidth=0,t._stageHeight=0,t._bgs=new Array,t.touchEnabled=!0,t}return __extends(t,e),t.prototype.init=function(e,t){this._stageWidth=e,this._stageHeight=t},t.prototype.draw=function(e){this.cacheAsBitmap=!1,this._deductRec=e,this.removeAllChild();var t=Math.max(e.x,0),i=Math.max(e.y,0),n=Math.min(e.x+e.width,this._stageWidth),o=Math.min(e.y+e.height,this._stageHeight);this.addBg(0,0,this._stageWidth,i),this.addBg(0,i,t,e.height),this.addBg(n,i,this._stageWidth-n,e.height),this.addBg(0,o,this._stageWidth,this._stageHeight-o),this.width=this._stageWidth,this.height=this._stageHeight,this.cacheAsBitmap=!0},t.prototype.destroy=function(){this.removeChildren(),this._bgs=[]},t.prototype.removeAllChild=function(){for(;this.numChildren;){var e=this.removeChildAt(0);this._bgs.push(e)}},t.prototype.addBg=function(e,t,i,n){var o;this._bgs.length?(o=this._bgs.pop(),o.graphics.clear()):o=new egret.Shape,o.graphics.beginFill(0,.5),o.graphics.drawRect(e,t,i,n),o.graphics.endFill(),this.addChild(o)},t.prototype.hitTest=function(e,t,i){return this._deductRec&&this._deductRec.contains(e,t)?null:this},t}(egret.Sprite);__reflect(GuideMaskBackgroud.prototype,"GuideMaskBackgroud");var DPackRow=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._direction=0,o._type=MatchConstants.DP_ROW,o}return __extends(t,e),t}(DPackLine);__reflect(DPackRow.prototype,"DPackRow");var DPackSimple=function(e){function t(t,i,n,o){var a=e.call(this,t,i,o)||this;return a._type=MatchConstants.DP_NONE,a._nextEle=n,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this)},t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.getElementsToRemove=function(){return[]},t.prototype.getBlockersToRemove=function(){return[]},t.prototype.getAllElements=function(){},t.prototype.isDone=function(){return!0},t}(DPack);__reflect(DPackSimple.prototype,"DPackSimple");var GuideUtils=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configData={1:{1:{txt:"点击这里，去设置宠物出战",txtdir:1,handDir:1},2:{txt:"点击选择一个宠物出战",txtdir:3,handDir:1},3:{txt:"点击宠物出战",txtdir:3,handDir:1}},2:{1:{txt:"更多宠物，可以抽取获得哦！",txtdir:1,handDir:2},2:{txt:"点击抽取宠物",txtdir:1,handDir:1}},3:{1:{txt:"点击选择另一个宠物",txtdir:1,handDir:1},2:{txt:"点击宠物出战",txtdir:3,handDir:1}},4:{1:{txt:"点击查看宠物属性",txtdir:4,handDir:1},2:{txt:"点击宠物升级",txtdir:1,handDir:2},3:{txt:"点击选择升级材料",txtdir:3,handDir:1},4:{txt:"选择一个宠物或卡牌作为材料",txtdir:3,handDir:1},5:{txt:"选择材料后点击确定回到升级界面",txtdir:1,handDir:2},6:{txt:"点击完成升级",txtdir:1,handDir:2}},5:{1:{txt:"现在立刻享受\n炫酷的飞行吧",txtdir:1,handDir:2},2:{txt:"每天前3次购买免费",txtdir:1,handDir:1},3:{txt:"开始战斗吧",txtdir:1,handDir:2}},6:{1:{txt:"点击这里查看战机",txtdir:1,handDir:1},2:{txt:"点击升级战机，\n可以提高战力",txtdir:1,handDir:2}}},t.currPart=0,t.currStep=0,t}return __extends(t,e),t.prototype.next=function(){null!=this.view&&null!=this.view.parent&&(this.currStep++,this.configData[this.currPart][this.currStep]||(this.currPart++,this.currStep=1),this.configData[this.currPart]||(this.currPart=0,this.currStep=0),this.hide())},t.prototype.show=function(e,t,i){this.currPart==t&&this.currStep==i&&(null==this.view&&(this.view=new GuideView),this.view.setData(e,this.configData[this.currPart][this.currStep]),egret.MainContext.instance.stage.addChild(this.view))},t.prototype.hide=function(){App.DisplayUtils.removeFromParent(this.view)},t.prototype.isShow=function(){return null!=this.view&&null!=this.view.parent},t}(BaseClass);__reflect(GuideUtils.prototype,"GuideUtils");var RocketDPackColorSpecial=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n)||this;return a._lastOffset=0,a._color=0,a._toRemoveElements=[],a._numToRemove=1,a._framesPerRemove=-1,a._framesPostDone=-1,a._initHoldFrames=Math.floor(7*xyd.frameScale),a._framesBeforeDP=Math.floor(20*xyd.frameScale),a._type=MatchConstants.DP_COLOR,a._changeType=o,a}return __extends(t,e),t.prototype.setup=function(){e.prototype.setup.call(this);for(var t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++){var n=this._board.getIntergratedElementAt(t,i);!n||n.busy||n.color!=this.sourceColor||n.col==this._initCol&&n.row==this._initRow||n.hasGiftWrapper()||xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:this._initCol,fromY:this._initRow,toX:n.x,toY:n.y})}},t.prototype.update=function(){if(this._numFrames+=1,this._numFrames==this._initHoldFrames){for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getIntergratedElementAt(e,t);!i||i.busy||i.color!=this.sourceColor||i.col==this._initCol&&i.row==this._initRow||i.hasGiftWrapper()||i.type==ElementTypeConstants.ROCKET||(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:this._initCol,fromY:this._initRow,toX:i.x,toY:i.y}),this._changeType==DPackColor.CHANGE_TYPE.BMOB_LINE?this.checkIsSwapElement(i)||(i=this.doLineChange(i)):this._changeType==DPackColor.CHANGE_TYPE.BOMB_SQURE?this.checkIsSwapElement(i)||(i=this.doSqureChange(i)):this._changeType==DPackColor.CHANGE_TYPE.BOMB_TORNADO&&(this.checkIsSwapElement(i)||(i=this.doTornadoChange(i))),this._allElements.push(i),i.shouldNotFall=!0)}this._allElements.sort(function(e,t){return e.y!=t.y?e.y-t.y:e.x-t.x});var n=this._allElements.length;this._framesPerRemove=Math.floor(3*xyd.frameScale),this._minNumToRemove=Math.floor(n/this._removalTimes),this._maxNumToRemove=this._minNumToRemove+1,this._framesToSwatchRemoveNum=(n-n%this._removalTimes*this._maxNumToRemove)*this._framesPerRemove+this._initHoldFrames,0==this._allElements.length&&(this._framesPostDone=0)}if(!(this._numFrames<=this._initHoldFrames)){this._affectedElements=[],this._affectedBlockers=[],this._affectedLocs=[];var o=0;if(this._numFrames>this._framesBeforeDP&&this._allElements.length>0&&this._numFrames%this._framesPerRemove==0){for(o=this._numFrames<this._framesToSwatchRemoveNum?this._minNumToRemove:this._maxNumToRemove;o>0&&this._allElements.length>0;){var i=this._allElements[0];if(this._affectedLocs.push({x:i.col,y:i.row}),i.type==ElementTypeConstants.TORNADO){var a=i;a.triggerBy({type:ElementTypeConstants.BOMB_COLOR}),this._board.addForRemoval(i)}else this._affectedElements.push(i);this._allElements.splice(0,1),o-=1}0==this._allElements.length&&(this._framesPostDone=this._framesPostDoneMax)}this._framesPostDone>0?this._framesPostDone-=1:0==this._framesPostDone&&(this._initElement.setMatchable(!0),this._isDone=!0)}},t}(RocketDPackColor);__reflect(RocketDPackColorSpecial.prototype,"RocketDPackColorSpecial");var Portal=function(){function e(e,t,i,n){this._enterPoint=e,this._exitPoint=t,this._color=i,this._id=n}return Object.defineProperty(e.prototype,"enterPoint",{get:function(){return this._enterPoint},set:function(e){this._enterPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exitPoint",{get:function(){return this._exitPoint},set:function(e){this._exitPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),e}();__reflect(Portal.prototype,"Portal");var PortalHandler=function(){function e(e,t){this._countBetweenRemoval={},this._teleportedEleIDs={},this._portals=[],this._board=e;for(var i=0,n=0,o=t;n<o.length;n++){var a=o[n],s=new egret.Point(a[0][0],a[0][1]),r=new egret.Point(a[1][0],a[1][1]),l=3==a[0].length?a[0][2]:CellConstants.PORTAL,_=new Portal(s,r,l,i);this._portals.push(_),this._countBetweenRemoval[i]=0,this._teleportedEleIDs[i]={}}xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._clearRemovalCount,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)}return e.prototype.update=function(e){var t=this.getAvailableEnterPortalByElement(e);void 0!=t&&(t.enterPoint.y-e.y>.01?e.y=t.enterPoint.y:this.teleportElement(e,t))},Object.defineProperty(e.prototype,"portals",{get:function(){return this._portals},enumerable:!0,configurable:!0}),e.prototype.getEnterPortalAt=function(e,t){for(var i=0,n=this._portals;i<n.length;i++){var o=n[i],a=o.enterPoint;if(a.x==e&&a.y==t)return o}},e.prototype.getExitPortalAt=function(e,t){for(var i=0,n=this._portals;i<n.length;i++){var o=n[i],a=o.exitPoint;if(a.x==e&&a.y==t)return o}},e.prototype.isEnterPortal=function(e,t){var i=this._board.getCell(t,e);return i?i.hasProperty(CellConstants.PORTAL_ENTER_POINT):!1},e.prototype.isExitPortal=function(e,t){var i=this._board.getCell(t,e);return i?i.hasProperty(CellConstants.PORTAL_EXIT_POINT):!1},e.prototype.canEnter=function(e,t){return!1},e.prototype.isAllowToSlideBelowExitPoint=function(e,t){if(this.isEnterPortal(e,t)){var i=this.getEnterPortalAt(e,t),n=i.exitPoint;if(this.hasSpaceForTeleport(n.x,n.y))return!1}return!0},e.prototype.getAvailableEnterPortalByElement=function(e){if(this.isEnterPortal(e.col,e.row)&&!e.isSticky()){var t=this.getEnterPortalAt(e.col,e.row),i=t.exitPoint;this.getExitPortalAt(e.col,e.row);if(!this._teleportedEleIDs[t.id][e.id]){var n=this._board.getFallingPathByPoint(i.x,i.y);if(n){var o=n.getElementAt(0);if(!(void 0!=o&&o.y<=n.getStartPoint().y+.51)&&this.hasSpaceForTeleport(i.x,i.y))return t}}}},e.prototype.teleportElement=function(e,t){if(!(this._countBetweenRemoval[t.id]>82)){var i=t.enterPoint,n=t.exitPoint,o=this._board.getFallingPathByElement(e),a=this._board.getFallingPathByPoint(n.x,n.y),s=n.y-i.y-1,r=new BoardElement(n.x,e.y+s,e.color,e.type);a.hasSpaceForInsertElement(r)&&(!a.isEmpty()&&a.getElementAt(0).y-.99<e.y+s||(this._countBetweenRemoval[t.id]+=1,this._teleportedEleIDs[t.id][e.id]=!0,this._board.clearElementAtGrid(e.col,e.row),o&&o.removeElement(e),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_FAKE_ELEMENT_PORTAL,!1,e),e.x=n.x,e.y=e.y+s,e.enteringBoard=!0,e.enteringY=n.y,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_ENTER,!1,e),a.insertElement(e),e.teleportTo(n.y),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ENTER_PORTAL,!0,!1,{x:i.x,y:i.y})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_EXIT_PORTAL,!0,!1,{x:n.x,y:n.y}))))}},e.prototype.hasSpaceForTeleport=function(e,t){return this._board.isStaticCell(e,t)?!1:void 0==this._board.getElementAtGrid(e,t)},e.prototype._clearRemovalCount=function(){var e=this._portals.length;this._teleportedEleIDs={};for(var t=0;e>t;t++)this._countBetweenRemoval[t]=0,this._teleportedEleIDs[t]={}},e.prototype._onBoardStable=function(){var e=this._portals.length;this._teleportedEleIDs={};for(var t=0;e>t;t++)this._countBetweenRemoval[t]=0,this._teleportedEleIDs[t]={}},e.prototype.hasPortal=function(){for(var e=this._portals,t=0,i=e;t<i.length;t++){var n=i[t],o=n.color;if(o==CellConstants.PORTAL_VISIBLE||o==CellConstants.PORTAL_VISIBLE_ENTER_POINT||o==CellConstants.PORTAL_VISIBLE_EXIT_POINT)return!0}return!1},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._clearRemovalCount,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STABLE,this._onBoardStable,this)},e.prototype.checkIfTeleported=function(e,t){var i=(this._portals.length,e.id);return this._teleportedEleIDs[i]&&this._teleportedEleIDs[i][t.id]?this._teleportedEleIDs[i][t.id]:!1},e}();__reflect(PortalHandler.prototype,"PortalHandler");var BeltHandler=function(){function e(e){this.STATE_IDLE=0,this.STATE_WAITING=1,this.STATE_MOVING=2,this.STATE_TELEPORTING=3,this.STATE_DONE=4,this.POST_ANIMATION_DELAY=5,this._moveFrames=-1,this._movingStickyElements=[],this._board=e,this._initEvents();var t=this._board.getGameConf();this._belt=BeltUtils.generateBeltFromArrays(t.beltInfo)||[],this._beltState=this.STATE_IDLE}return e.prototype.requestUpdate=function(){return this._belt.length<=0?!1:this._beltState==this.STATE_WAITING?(this._beltState=this.STATE_MOVING,this._moveFrames=(BeltConstants.ANIMATION_TICKS+this.POST_ANIMATION_DELAY)*xyd.frameScale,this._board.setBeltMoving(!0),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SET_BELT_STATE,!0,!1,{state:!0})),!0):!1},e.prototype.update=function(){if(this._beltState==this.STATE_MOVING){for(var e=0,t=this._belt;e<t.length;e++){var i=t[e];this._moveElementAtBeltCell(i)}if(this._movingStickyElements.length>0)for(var n=0,o=this._movingStickyElements;n<o.length;n++){var a=o[n];this._board.setElementAtGrid(a.to.x,a.to.y,a.ele),this._board.rebuildPathForColumn(a.from.x),this._board.rebuildPathForColumn(a.to.x)}this._movingStickyElements=[],this._beltState=this.STATE_TELEPORTING}else this._beltState==this.STATE_TELEPORTING&&(this._moveFrames--,this._moveFrames<=0&&(this._beltState=this.STATE_DONE))},e.prototype.requestWithdraw=function(){return this._beltState==this.STATE_DONE?(xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SET_BELT_STATE,!0,!1,{state:!1})),this._beltState=this.STATE_IDLE,this._board.setBeltMoving(!1),!0):!1},e.prototype.getBelt=function(){return this._belt},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SIZE,this._setBeltOnBoard,this)},e.prototype._onSwitchMade=function(){this._beltState==this.STATE_IDLE&&(this._beltState=this.STATE_WAITING)},e.prototype._removeFromOriginPath=function(e){var t=this._board.getFallingPathByElement(e);t&&t.removeElement(e)},e.prototype._moveOrTeleportElement=function(e,t){var i=t.getPosition(),n=t.getTarget();e.beginBeltMove(i.x,i.y,n.x,n.y),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BELT_ELEMENT_MOVE,!0,!1,{element:e,beltCell:t}))},e.prototype._addToTargetPath=function(e,t){var i=this._board.getFallingPathByPoint(t.x,t.y);i&&i.insertElement(e)},e.prototype._moveElementAtBeltCell=function(e){var t=e.getPosition(),i=e.getTarget(),n=this._board.getElementAtGrid(t.x,t.y);n&&(this._board.clearElementAtGrid(t.x,t.y),this._removeFromOriginPath(n),this._moveOrTeleportElement(n,e),n.isSticky()?this._movingStickyElements.push({ele:n,from:{x:t.x,y:t.y},to:{x:i.x,y:i.y}}):this._addToTargetPath(n,i))},e.prototype._setBeltOnBoard=function(){for(var e=0,t=this._belt;e<t.length;e++){var i=t[e];i.getIsPortal()&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BELT_PORTAL,!0,!1,{beltCell:i})),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BELT_CELL,!0,!1,{beltCell:i}))}},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SIZE,this._setBeltOnBoard,this)},e}();__reflect(BeltHandler.prototype,"BeltHandler",["IStabilityClient"]);var BlackHoleHandler=function(){function e(e){this.CHANGE_DELAY=20*xyd.frameScale,this.changeFrames=-1,this._shouldTransform=!1,this._inTransform=!1,this._transformDone=!1,this._board=e,this._initEvents()}return e.prototype.requestUpdate=function(){if(this._shouldTransform){var e=this._getValidBlackHoles();if(e.length>0){this._shouldTransform=!1,this._inTransform=!0,this.changeFrames=this.CHANGE_DELAY;for(var t=0,i=e;t<i.length;t++){var n=i[t];
xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BLACK_HOLE_CHANGE_EFFECT,!1,{element:n,color:n.color2})}return!0}}return!1},e.prototype.requestWithdraw=function(){return this._transformDone?(this._shouldTransform=!1,this._inTransform=!1,this._transformDone=!1,!0):!1},e.prototype._changeBlackHoles=function(){if(this._inTransform){this._inTransform=!1,this.changeFrames=-1;for(var e=this._getValidBlackHoles(),t=0,i=e;t<i.length;t++){var n=i[t];this._transformBlackHole(n)}this._transformDone=!0}},e.prototype.update=function(){this.changeFrames>0&&(this.changeFrames-=1),0==this.changeFrames&&this._changeBlackHoles()},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this)},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this)},e.prototype._onSwitchMade=function(e){this._inTransform=!1,this._shouldTransform=!0,this._transformDone=!1},e.prototype._getValidBlackHoles=function(){for(var e=[],t=0,i=this._board.getElementsOfType(ElementTypeConstants.BLACK_HOLE);t<i.length;t++){var n=i[t];!n||n.isDead()||n.shouldRemove||e.push(n)}return e},e.prototype._transformBlackHole=function(e){var t=e.color;e.color=e.color2,e.color2=t},e}();__reflect(BlackHoleHandler.prototype,"BlackHoleHandler",["IStabilityClient"]);var CloudHandler=function(){function e(e){this.CLOUD_MAKER_MAX_PAUSE=2,this._shouldUpdateCloud=!1,this._shouldSpawnCloud=!1,this._cloudBeenRemoved=!1,this._cloudMakerPauseTime=this.CLOUD_MAKER_MAX_PAUSE,this._board=e,this._initEvents()}return e.prototype.requestUpdate=function(){return this._shouldSpawnCloud?(this._shouldUpdateCloud=!0,!0):!1},e.prototype.requestWithdraw=function(){return this._cloudBeenRemoved?(this._shouldUpdateCloud=!1,this._cloudBeenRemoved=!1,!0):!1},e.prototype.putOffCloud=function(){this._shouldUpdateCloud&&(this._cloudBeenRemoved=!0),this._shouldSpawnCloud=!1,this._cloudMakerPauseTime=this.CLOUD_MAKER_MAX_PAUSE},e.prototype.update=function(){var e=this;if(this._shouldUpdateCloud&&this._shouldSpawnCloud){this._shouldSpawnCloud=!1,this._cloudMakerPauseTime>0&&(this._cloudMakerPauseTime-=1);for(var t=this._getAllValidClouds(),i=[],n=[[0,1],[1,0],[0,-1],[-1,0]],o=0,a=t;o<a.length;o++){var s=a[o];if(!(s.type==BlockerConstant.CLOUD_MAKER&&this._cloudMakerPauseTime>0))for(var r=s.col,l=s.row,_=0,h=n;_<h.length;_++){var c=h[_],d=this._board.getElementAtGrid(r+c[0],l+c[1]);if(d&&d.canBeCoveredByCloud()&&!this._board.isBeltCell(r+c[0],l+c[1])){var p=this._getSpawnTargetScore(d.type);i.push({blocker:s,target:d,score:p})}}}i.sort(function(e,t){return t.score-e.score});var u;if(i.length>0&&(u=i[0]),u){var d=u.target;if(d.setDamageSource(DamageSource.CLOUD),this.checkIsNearCloudMaker(d.col,d.row),d.type==ElementTypeConstants.ROCKET){this._board.createNewBlockerAt(d.col,d.row,BlockerConstant.CLOUD_ROCKET);var m=this._board.getBlockerAtGrid(d.col,d.row);m.rocketType=d.rocketType,m.rocketState=d.rocketState,m.color=d.color}else this._board.createNewBlockerAt(d.col,d.row,BlockerConstant.CLOUD);this._board.removeElement(d,!0),this._board.rebuildPathForColumn(d.col),egret.setTimeout(function(){e._cloudBeenRemoved=!0},this,500)}else this._cloudBeenRemoved=!0}},e.prototype.checkIsNearCloudMaker=function(e,t){for(var i=this._getAllValidClouds(),n=0,o=i;n<o.length;n++){var a=o[n];if(a.type==BlockerConstant.CLOUD_MAKER){var s=Math.abs(Math.floor(a.col-e))+Math.abs(Math.floor(a.row-t));1==s&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CLOUD_MAKER,!1,a)}}},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.PUT_OFF_CLOUD,this.putOffCloud,this)},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.PUT_OFF_CLOUD,this.putOffCloud,this)},e.prototype._onRemoveBlocker=function(e){var t=e.data;(t.type==BlockerConstant.CLOUD||t.type==BlockerConstant.CLOUD_ROCKET)&&(this._shouldSpawnCloud=!1,this._shouldUpdateCloud&&(this._cloudBeenRemoved=!0),this._cloudMakerPauseTime=this.CLOUD_MAKER_MAX_PAUSE)},e.prototype._onSwitchMade=function(e){var t=this._getAllValidClouds();t.length>0&&(this._shouldSpawnCloud=!0)},e.prototype._getAllValidClouds=function(){for(var e=[],t=this._board.getAllBlockers(),i=0,n=t;i<n.length;i++){var o=n[i];(o.type==BlockerConstant.CLOUD||o.type==BlockerConstant.CLOUD_MAKER||o.type==BlockerConstant.CLOUD_ROCKET)&&o.health>0&&!o.busy&&!o.isDead&&!o.isLocked()&&e.push(o)}return e},e.prototype._getSpawnTargetScore=function(e){var t;return t=e==ElementTypeConstants.NORMAL||e==ElementTypeConstants.TIME_BOMB?1:e==ElementTypeConstants.BOMB_SQUARE?.1:e==ElementTypeConstants.BOMB_ROW?.1:e==ElementTypeConstants.BOMB_COL?.1:e==ElementTypeConstants.BOMB_COLOR?.5:e==ElementTypeConstants.LUCKY_BAG?.1:e==ElementTypeConstants.GOLDEN_EGG?.5:e==ElementTypeConstants.BLACK_HOLE?.5:e==ElementTypeConstants.BOX?.5:e==ElementTypeConstants.WAND?.5:e==ElementTypeConstants.ROCKET?.5:e==ElementTypeConstants.SCISSOR?.5:0,this._board.random(0,100)*t},e}();__reflect(CloudHandler.prototype,"CloudHandler",["IStabilityClient"]);var CrayonHandler=function(){function e(e){this._activedCrayon=[],this._intelvalFrame=10*xyd.frameScale,this._numFrames=-1,this._unchangedPos=[],this._changedElements=[],this._changeType=-1,this._changeDir=-1,this._isChanging=!1,this._changeDone=!1,this._crayonDis=0,this._eleIDs=[],this.DISTANCE_NORMAL=3,this.DISTANCE_SPECIAL=9,this._board=e,this._initEvents()}return e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;if(!i&&t.getDamageSource()!=DamageSource.PUZZLE&&t.type==ElementTypeConstants.CRAYON){var n=new ActivedCrayon(t.col,t.row,t.getTriggerType(),t.getTriggerDir());this._activedCrayon.push(n),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_INIT_EFFECT,!1,t),this._eleIDs.push(t.id)}},e.prototype.requestUpdate=function(){if(0==this._activedCrayon.length)return!1;this._board.isCrayonActivated=!0;var e=this._activedCrayon[0],t=e.type==Crayon.TRIGGER_NORMAL_TYPE?this.DISTANCE_NORMAL:this.DISTANCE_SPECIAL,i=e.dir;-1==i&&(i=this._board.random(0,3));for(var n=xyd.directions[i][0],o=xyd.directions[i][1],a=this._board.getBoardCols(),s=this._board.getBoardRows(),r=0;t>r;r++){var l=e.x+n*r,_=e.y+o*r;0>l&&(l+=a),0>_&&(_+=s),l%=a,_%=s;var h=this._board.getElementAtGrid(l,_);this.canReplace(h)||t<this.DISTANCE_SPECIAL&&t++;var c=new egret.Point(Math.floor(l),Math.floor(_));this._unchangedPos.push(c)}return this._changeType=1>=i?ElementTypeConstants.BOMB_ROW:ElementTypeConstants.BOMB_COL,e.type==Crayon.TRIGGER_SQUARE_TYPE&&(this._changeType=ElementTypeConstants.BOMB_SQUARE),this._changeDir=i,this._crayonDis=t,this._isChanging=!0,this._activedCrayon.splice(0,1),!0},e.prototype.update=function(){if(this._isChanging){if(this._numFrames++,0==this._numFrames&&this._unchangedPos.length>0&&(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_EFFECT,!1,{pos:this._unchangedPos[0],dir:this._changeDir,dis:this._crayonDis,eleid:this._eleIDs[0]}),this._eleIDs.splice(0,1)),this._numFrames%this._intelvalFrame==0&&this._unchangedPos.length>0){var e=this._unchangedPos[0],t=this._board.getElementAtGrid(e.x,e.y);if(!this.canReplace(t))return void this._unchangedPos.splice(0,1);var i=0==t.color?CellConstants.ELEMENT_COLOR_RANDOM:t.color,n=this._board.getElementFactory().create(e.x,e.y,i,this._changeType),o=t.getLock();void 0!=o&&n.addLock(o),this._board.replaceBoardElement(n),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_CHANGE_EFFECT,!1,n),this._unchangedPos.splice(0,1),this._changedElements.push(n)}if(0==this._unchangedPos.length){for(var a=0;a<this._changedElements.length;a++){var t=this._changedElements[a];this._board.addForRemoval(t,20*xyd.frameScale)}this._changeDone=!0}}},e.prototype.canReplace=function(e){return e&&e.canBeDestroyed()?e.isLocked()?!1:e.type==ElementTypeConstants.BOX?!1:e.type==ElementTypeConstants.CAKE?!1:e.type==ElementTypeConstants.CRAYON?!1:e.type==ElementTypeConstants.BOMB_COLOR?!1:e.type==ElementTypeConstants.BALLOON?!1:!0:!1},e.prototype.requestWithdraw=function(){return this._changeDone?(this._changeType=-1,this._changeDir=-1,this._isChanging=!1,this._changeDone=!1,this._numFrames=-1,this._changedElements=[],this._unchangedPos=[],this._crayonDis=0,this._board.isCrayonActivated=!1,!0):!1},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e}();__reflect(CrayonHandler.prototype,"CrayonHandler",["IStabilityClient"]);var RocketHandler=function(){function e(e,t){this._moveFrames=-1,this._waitFrames=5,this._isRocketCoveredByCloud=!1,this.STATE_IDLE=0,this.STATE_LAUNCH=1,this.STATE_MOVING=2,this.STATE_DONE=3,this._board=e,this._engine=t,this._initEvents(),this._rocketTarget=new RocketTarget(e),this._rocketAttackState=this.STATE_IDLE}return e.prototype._setRocket=function(){this._rocket=this._board.getRocket()},e.prototype.requestUpdate=function(){return this._rocketAttackState==this.STATE_LAUNCH?(this._rocketAttackState=this.STATE_MOVING,this._moveFrames=65*xyd.frameScale,this._waitFrames=50,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ROCKET_LAUNCH,!0,!1,{from:this._from,to:this._to})),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_SWITCH_MADE,!0),!0):!1},e.prototype.update=function(){this._rocketAttackState==this.STATE_MOVING&&(this._moveFrames--,this._moveFrames<=0&&(this._rocketAttackState=this.STATE_DONE,this.replaceRocket()))},e.prototype.requestWithdraw=function(){return this._rocketAttackState==this.STATE_DONE&&(this._waitFrames--,this._waitFrames<=0)?(this._rocketAttackState=this.STATE_IDLE,!0):!1},e.prototype.replaceRocket=function(){var e,t=this._board.getGridContainerAt(this._to.x,this._to.y);t?(e=t.getElement(),e.setAffectAdjacentBlockerOnRemove(!1),e.type==ElementTypeConstants.BOMB_COLOR&&(e.destroyFrames=0,e.view.visible=!1),e.type==ElementTypeConstants.CAKE?this._board.addForRemovalForce(e):this._board.addForRemoval(e)):this._board.hitEmptyCell(this._to.x,this._to.y),this._board.clearElementAtGrid(this._from.x,this._from.y),this._rocket.x=this._to.x,this._rocket.y=this._to.y,this._rocket.remainCapacity=this._rocket.capacity,this._rocket.rocketType=RocketConstants.REGULAR_ROCKET,this._rocket.rocketState=RocketConstants.STATE_DARK,this._rocket.color=this._board.getElementFactory().randomColor(),this._rocket.destructionPack=new DPackBomb(this._board,this._rocket,void 0,3),this._board.setElementAtGrid(this._to.x,this._to.y,this._rocket),this._board.addElementToBoard(this._rocket),this._board.addToDestructionPlanList(this._rocket),this._rocket.clearDestructionPack(),this._board.rebuildPathForColumn(this._from.x),this._board.rebuildPathForColumn(this._to.x)},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_INIT_DONE,this._setRocket,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ROCKET_CHECK_TARGET_SUCCESS,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ROCKET_COVERED_BY_CLOUD,this._onCoverRocket,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ROCKT_RECOVER_FROM_CLOUD,this._onRecoverFromCloud,this)},e.prototype._onRecoverFromCloud=function(e){var t=e.data;t.type==BlockerConstant.CLOUD_ROCKET&&(this._isRocketCoveredByCloud=!1,this._board.setElementAtGrid(t.col,t.row,this._rocket),this._board.addElementToBoard(this._rocket),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_REPLACE_ROCKET,!1,this._rocket))},e.prototype._onCoverRocket=function(){this._isRocketCoveredByCloud=!0},e.prototype._onRemoveElement=function(e){if(!this._isRocketCoveredByCloud&&this._engine.getState()==EngineState.STATE_GAME){var t=e.data.ele;t.getDamageSource()==DamageSource.REFUEL_TO_ROCKET&&t.color==this._rocket.color&&(t.type<ElementTypeConstants.BOMB_ROW||t.type>ElementTypeConstants.BOMB_COLOR)&&this._rocket.refuelThisMany(1)}},e.prototype._onSwitchMade=function(e){this._rocketAttackState=this.STATE_LAUNCH,this._from=e.data.from,this._to=e.data.to},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_INIT_DONE,this._setRocket,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ROCKET_CHECK_TARGET_SUCCESS,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ROCKET_COVERED_BY_CLOUD,this._onCoverRocket,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ROCKT_RECOVER_FROM_CLOUD,this._onRecoverFromCloud,this),this._rocketTarget.dispose()},e}();__reflect(RocketHandler.prototype,"RocketHandler",["IStabilityClient"]);var ShuffleHandler=function(){function e(t,i){this._shuffleFrames=-1,this._state=e.IDLE_STATE,this._shuffleLimit=30,this._MAX_SHUFFLE_TIME=Math.floor(60*xyd.frameScale),this._SHUFFLE_TIP_TIME=Math.floor(59*xyd.frameScale),this._LOGIC_SHUFFLE_TIME=Math.floor(29*xyd.frameScale),this._DISPLAY_SHUFFLE_TIME=Math.floor(27*xyd.frameScale),this._COMPLETE_SHUFFLE_TIME=0,this._board=i,this._engine=t}return e.prototype.requestUpdate=function(){return this._isShuffleNeeded()?(console.log("Start to shuffle"),this._shuffleFrames=this._MAX_SHUFFLE_TIME,this._state=e.SHUFFLE_STATE,this._engine.setState(EngineState.STATE_SHUFFLE),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_UNSTABLE)),!0):!1},e.prototype.requestWithdraw=function(){return this._state==e.COMPLETE_STATE?(console.log("Shuffle completed"),this._state=e.IDLE_STATE,this._shuffleFrames=-1,this._engine.getState()==EngineState.STATE_SHUFFLE&&this._engine.setState(EngineState.STATE_GAME),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_STABLE)),!0):!1},e.prototype.update=function(){if(this._state==e.SHUFFLE_STATE)if(this._shuffleFrames-=1,this._shuffleFrames==this._SHUFFLE_TIP_TIME)xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SHUFFLE_TIPS));else if(this._shuffleFrames==this._LOGIC_SHUFFLE_TIME){for(var t=0,i=!1;t++<this._shuffleLimit&&!i;)i=this._shuffle();i||this._engine.shuffleFailed()}else this._shuffleFrames==this._DISPLAY_SHUFFLE_TIME?(console.log("Notify gameview about shuffling"),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SHUFFLE))):this._shuffleFrames==this._COMPLETE_SHUFFLE_TIME&&(this._state=e.COMPLETE_STATE)},e.prototype._shuffle=function(){var e=this._getShufflableElements(),t=e.length;if(2>t)return!1;for(var i=0;t>i;i++){for(var n=this._board.random(0,t-1),o=this._board.random(0,t-1);n==o;)o=this._board.random(0,t-1);this._board.swapElements(e[n],e[o])}return this._board.checkMovesAfterShuffle()},e.prototype._getShufflableElements=function(){for(var e=[],t=0,i=this._board.getAllElements();t<i.length;t++){var n=i[t];this._canShuffleElement(n)&&e.push(n)}return e},e.prototype._canShuffleElement=function(e){return void 0==e||e.isLocked()||e.type!=ElementTypeConstants.NORMAL&&e.type!=ElementTypeConstants.TIME_BOMB&&e.type!=ElementTypeConstants.BLACK_HOLE&&e.type!=ElementTypeConstants.GOLDEN_EGG?!1:e.canBeDestroyed()?!0:!1},e.prototype._isShuffleNeeded=function(){return this._board.isStable()?this._engine.isGameReachEnd()?!1:this._engine.getState()!=EngineState.STATE_GAME?!1:this._state!=e.IDLE_STATE||this._board.hasPossibleMoves()||!this._board.isStable()?!1:!0:!1},e.prototype.dispose=function(){},e.IDLE_STATE=1,e.SHUFFLE_STATE=2,e.COMPLETE_STATE=3,e}();__reflect(ShuffleHandler.prototype,"ShuffleHandler",["IStabilityClient"]);var SnowHandler=function(){function e(e){this._shouldUpdateSnow=!1,this._shouldSpawnSnow=!1,this._snowBeenRemoved=!1,this._board=e,this._initEvents()}return e.prototype.requestUpdate=function(){return this._shouldSpawnSnow?(this._shouldUpdateSnow=!0,!0):!1},e.prototype.requestWithdraw=function(){return this._snowBeenRemoved?(this._shouldUpdateSnow=!1,this._snowBeenRemoved=!1,!0):!1},e.prototype.update=function(){if(this._shouldUpdateSnow&&this._shouldSpawnSnow){this._shouldSpawnSnow=!1;var e=this._getAllValidSnows(),t=(e[0],e[1]),i=e[2],n=this._spawnWithHealth(i,2);if(!n&&(n=this._spawnWithHealth(t,2),!n&&(n=this._spawnWithHealth(i,3),!n))){var o=[0,1,2],a=Math.floor(Math.random()*o.length),s=e[o[a]];o.splice(a,1),a=Math.floor(Math.random()*o.length);var r=e[o[a]];o.splice(a,1),a=Math.floor(Math.random()*o.length);var l=e[o[a]];n=this._spawnWithHealth(s,1),n||(n=this._spawnWithHealth(r,1),n||(n=this._spawnWithHealth(l,1))),n||(this._snowBeenRemoved=!0)}}},e.prototype._spawnWithHealth=function(e,t){for(var i=this,n=!1,o=[],a=[[0,1],[1,0],[0,-1],[-1,0]],s=0,r=e;s<r.length;s++)for(var l=r[s],_=l.col,h=l.row,c=0,d=a;c<d.length;c++){var p=d[c];if(1==t){var u=this._board.getElementAtGrid(_+p[0],h+p[1]);if(u&&u.canBeCoveredByCloud()&&!this._board.isBeltCell(_+p[0],h+p[1])){var m=this._getSpawnTargetScore(u.type);m>0&&o.push({blocker:l,target:u,score:m,is_self_growth:!1})}}else if(2==t){var g=this._board.getBlockerAtGrid(_+p[0],h+p[1]);g&&!g.isLocked()&&g.type==BlockerConstant.SNOW&&1==g.health&&o.push({blocker:l,target:g,score:100,is_self_growth:!0})}else if(3==t){var g=this._board.getBlockerAtGrid(_+p[0],h+p[1]);g&&!g.isLocked()&&g.type==BlockerConstant.SNOW&&2==g.health&&o.push({blocker:l,target:g,score:100,is_self_growth:!0})}}o.sort(function(e,t){return t.score-e.score});var f;if(o.length>0&&(f=o[0]),f){n=!0;var y=f.target;f.is_self_growth?(y.health++,xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.UPDATE_SNOW,!1,{snow:y})):(this._board.createNewBlockerAt(y.col,y.row,BlockerConstant.SNOW,1),this._board.removeElement(y,!0)),this._board.rebuildPathForColumn(y.col),egret.setTimeout(function(){i._snowBeenRemoved=!0},this,500)}else this._snowBeenRemoved=!0;return n},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this)},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this)},e.prototype._onRemoveBlocker=function(e){var t=e.data;t.type==BlockerConstant.SNOW&&(this._shouldSpawnSnow=!1,this._shouldUpdateSnow&&(this._snowBeenRemoved=!0))},e.prototype._onSwitchMade=function(e){var t=this._getAllValidSnows();(t[0].length>0||t[1].length>0||t[2].length>0)&&(this._shouldSpawnSnow=!0)},e.prototype._getAllValidSnows=function(){for(var e=[[],[],[]],t=this._board.getAllBlockers(),i=0,n=t;i<n.length;i++){var o=n[i];o.type==BlockerConstant.SNOW&&o.health>0&&!o.busy&&!o.isDead&&!o.isLocked()&&e[o.health-1].push(o)}return e},e.prototype._getSpawnTargetScore=function(e,t){void 0===t&&(t=0);var i;return i=e==ElementTypeConstants.NORMAL||e==ElementTypeConstants.TIME_BOMB?1:e==ElementTypeConstants.BOMB_SQUARE?.1:e==ElementTypeConstants.BOMB_ROW?.1:e==ElementTypeConstants.BOMB_COL?.1:e==ElementTypeConstants.BOMB_COLOR?.5:e==ElementTypeConstants.LUCKY_BAG?.1:e==ElementTypeConstants.GOLDEN_EGG?.5:e==ElementTypeConstants.BLACK_HOLE?.5:e==ElementTypeConstants.BOX?.5:e==ElementTypeConstants.WAND?.5:e==ElementTypeConstants.SCISSOR?.5:0,this._board.random(0,100)*i},e}();__reflect(SnowHandler.prototype,"SnowHandler",["IStabilityClient"]);var StabilityUpdater=function(){function e(e,t,i,n){this._clients=[],this._updatingIdx=-1,this._engine=e,this._board=t,this._gameConf=i;var o=void 0;if(n.hasLeaf()){var a=n;o=a.getLeafFacade()}this._clients.push(new TornadoHandler(t,o)),this._clients.push(new CrayonHandler(t)),this._clients.push(new BlackHoleHandler(t));var s=new ColorMixerHandler(t);this._clients.push(s),this._board.colorMixerHandler=s,this._clients.push(new CloudHandler(t)),this._clients.push(new RocketHandler(t,e)),this._clients.push(new SnowHandler(t)),this._clients.push(new PuzzleHandler(t)),this._clients.push(new BeltHandler(t)),this._clients.push(new WandElementHandler(t)),this._clients.push(new ShuffleHandler(e,t)),this._clients.push(new TimeBombHandler(e,t,i))}return e.prototype.update=function(){if(this._updatingIdx<0&&this._board.isStable()){for(var e=0;e<this._clients.length;e++)if(this._clients[e].requestUpdate()){this._updatingIdx=e;break}}else this._updatingIdx>=0&&this._clients[this._updatingIdx].requestWithdraw()&&(this._updatingIdx=-1);for(var t=0,i=this._clients;t<i.length;t++){var n=i[t];n.update()}},e.prototype.isUpdating=function(){return this._updatingIdx>=0},e.prototype.dispose=function(){for(var e=0,t=this._clients;e<t.length;e++){var i=t[e];i.dispose()}},e}();__reflect(StabilityUpdater.prototype,"StabilityUpdater");var TimeBombHandler=function(){function e(e,t,i){this._bombShouldExplode=!1,this._isExploding=!1,this._explodingFrames=45*xyd.frameScale,this._engine=e,this._board=t,this._gameConf=i,this._initEvents()}return e.prototype.requestUpdate=function(){return this._bombShouldExplode?this._bombAboutToExplode()&&!this._engine.isGameReachEnd()?(this._engine.setTimeBombHasExploded(!0),!0):(this._bombShouldExplode=!1,!1):!1},e.prototype.requestWithdraw=function(){return this._engine.hasTimeBombExploded()?!1:!0},e.prototype.update=function(){if(this._isExploding){if(this._explodingFrames==45*xyd.frameScale)for(var e=0,t=this._getValidTimeBombs();e<t.length;e++){var i=t[e];i.getTicksToExplode()<1&&xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.TIME_BOMB_EXPLODE,!1,i)}else 1==this._explodingFrames&&(this._isExploding=!1,this._engine.setTimeBombHasExploded(!1));this._explodingFrames-=1}},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.GAME_RESUME,this._onGameResume,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.GAME_WITHDRAW,this._onGameWithdraw,this)},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SWITCH_MADE,this._onSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.GAME_RESUME,this._onGameResume,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.GAME_WITHDRAW,this._onGameWithdraw,this)},e.prototype._onSwitchMade=function(){this._decreaseTimeBombsTick()},e.prototype._bombAboutToExplode=function(){for(var e=0,t=this._getValidTimeBombs();e<t.length;e++){var i=t[e];if(i.getTicksToExplode()<1)return!0}return!1},e.prototype._decreaseTimeBombsTick=function(){for(var e=0,t=this._getValidTimeBombs();e<t.length;e++){var i=t[e];i.decreaseTicksToExplode(),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.UPDATE_TIME_BOMB,!1,i)}this._bombAboutToExplode()&&!this._engine.isGameReachEnd()&&(this._bombShouldExplode=!0)},e.prototype._getValidTimeBombs=function(){for(var e=[],t=0,i=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB);t<i.length;t++){var n=i[t];!n||n.isDead()||n.shouldRemove||e.push(n)}return e},e.prototype._onGameResume=function(){var e=this._getValidTimeBombs();this._gameConf&&(this._gameConf.timeBombExplosionMoves+=5);for(var t=0,i=e;t<i.length;t++){var n=i[t];n.addTicksToExplode(5),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.UPDATE_TIME_BOMB,!1,n),this._engine.setTimeBombHasExploded(!1)}},e.prototype._onGameWithdraw=function(){if(this._bombAboutToExplode()&&!this._engine.isGameReachEnd()){this._engine.getGameMode();this._isExploding=!0,this._explodingFrames=45*xyd.frameScale,this._engine.setTimeBombHasExploded(!0)}else this._engine.setTimeBombHasExploded(!1)},e}();__reflect(TimeBombHandler.prototype,"TimeBombHandler",["IStabilityClient"]);var TornadoHandler=function(){function e(e,t){this._tornadoAlleies=[],this._autoRemoveDelay=5*xyd.frameScale,this._board=e,this._elementFactory=this._board.getElementFactory(),this._LeafFacade=t,this._autoRemover=new AutoRemover,this._initEvents()}return e.prototype.requestUpdate=function(){return this._tornadoAlleies.length>0},e.prototype.requestWithdraw=function(){return 0==this._tornadoAlleies.length&&!this._autoRemover.willAutoRemove()},e.prototype.update=function(){this._autoRemover.update(this._board.isStable()),this._updateAlleies()},e.prototype.isUniqueTarget=function(e,t){for(var i=0,n=this._tornadoAlleies;i<n.length;i++){var o=n[i],a=o.getTargetPos();if(a.x==e&&a.y==t)return!1}return!0},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.FAN_BLOCKER_LAUNCH,this._onHitFanBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype._updateAlleies=function(){for(var e=0,t=this._tornadoAlleies;e<t.length;e++){var i=t[e];i.hasVanished||(i.update(),i.justArrived&&(i.justArrived=!1,i.isTrigger?i.getTornado()&&this._createTornadoAlleyFrom(i.getTornado()):this._tornadoInAction(i)))}for(var n=0;n<this._tornadoAlleies.length;){if(this._tornadoAlleies[n].hasVanished){this._tornadoAlleies.splice(n,1);break}n++}},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.FAN_BLOCKER_LAUNCH,this._onHitFanBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype._tornadoInAction=function(e){var t=e.getTargetPos(),i=t.x,n=t.y,o=this._board.getElementAtGrid(i,n),a=this._board.getBlockerAtGrid(i,n),s=this._hitElement(o,e),r=this._hitBlocker(a);if(s||r||this._board.hitEmptyCell(i,n),!s){if(!e.getTornado())return;this._setDpackWithBlankElement(i,n,e.getTornado().getTriggerType())}},e.prototype._hitElement=function(e,t){if(e&&!e.isDestroyed()&&!e.busy){var i=e.color,n=t.getTornado();if(1>i||void 0==n||n.isNormalTriggerType())if(e.type!=ElementTypeConstants.ROCKET)(e.locked||e.canBeDestroyed())&&this._board.addForRemoval(e);else{var o=e;o.consumeSpecialPower(),this._board.hitEmptyCell(o.col,o.row)}else e.isLocked()&&this._board.removeLock(e),n.isLineTriggerType()?this.changeToLineType(e,i):n.isSquareTriggerType()?this._changeToSquareType(e,i):n.isColorTriggerType()&&this._changeToTornadoType(e,i),e.type==ElementTypeConstants.ROCKET&&this._board.hitEmptyCell(e.col,e.row);return!0}return!1},e.prototype._hitBlocker=function(e){return e?(this._board.hitBlocker(e,1),!0):!1},e.prototype.changeToLineType=function(e,t){var i=this._board.random(0,99);if(e.type!=ElementTypeConstants.ROCKET){var n=e.col,o=e.row,a=ElementTypeConstants.BOMB_COL;i>49&&(a=ElementTypeConstants.BOMB_ROW);var s=this._elementFactory.create(n,o,t,a);this._board.replaceBoardElement(s),this._autoRemover.add(s,this._autoRemoveDelay,!1)}else{var r=e,l=RocketConstants.SPECIAL_STRIPED_COLUMN;i>49&&(l=RocketConstants.SPECIAL_STRIPED_LINE),r.setSpecialPower(l),this._autoRemover.add(r,this._autoRemoveDelay,!1)}},e.prototype._changeToSquareType=function(e,t){if(e.type!=ElementTypeConstants.ROCKET){var i=e.col,n=e.row,o=this._elementFactory.create(i,n,t,ElementTypeConstants.BOMB_SQUARE);this._board.replaceBoardElement(o),this._autoRemover.add(o,this._autoRemoveDelay,!1)}else{var a=e;a.setSpecialPower(RocketConstants.SPECIAL_WRAPPED),this._autoRemover.add(a,this._autoRemoveDelay,!1)}},e.prototype._changeToTornadoType=function(e,t){if(e.type!=ElementTypeConstants.ROCKET){var i=e.col,n=e.row,o=this._elementFactory.create(i,n,t,ElementTypeConstants.TORNADO);this._board.replaceBoardElement(o),this._autoRemover.add(o,this._autoRemoveDelay,!1)}else{var a=e;a.setSpecialPower(RocketConstants.SPECIAL_COLOR_BOMBED),this._autoRemover.add(a,this._autoRemoveDelay,!1)}},e.prototype._setDpackWithBlankElement=function(e,t,i){var n=this._elementFactory.create(e,t,0,ElementTypeConstants.BLANK);if(i==Tornado.TRIGGER_LINE_TYPE){var o=this._board.random(0,99);o>49?n.destructionPack=new DPackCol(this._board,n):n.destructionPack=new DPackRow(this._board,n)}else{if(i!=Tornado.TRIGGER_SQUARE_TYPE)return;n.destructionPack=new DPackBomb(this._board,n,void 0,3)}this._board.addToDestructionPlanList(n)},e.prototype._createTornadoAlleyFrom=function(e,t,i){void 0===t&&(t=3),void 0===i&&(i=0);var n,o=!1,a=[];switch(e.type){case ElementTypeConstants.TORNADO:var s=e;if(o=0==s.isNormalTriggerType(),void 0!=s)if(s.isColorTriggerType())s.setTriggerType(Tornado.TRIGGER_NORMAL_TYPE),n=new egret.Point(s.col,s.row);else{var r=s.x>4.5?9:-1;n=new egret.Point(r,-1)}else n=new egret.Point(-1,4.5);break;case BlockerConstant.FAN:var l=e;n=new egret.Point(l.col,l.row)}0==o&&(a=a.concat(new TornadoTargetFinderRanked(this._board,this._LeafFacade,this).getTargets(1)));var _=new TornadoTargetFinderLeaf(this._board,this._LeafFacade,this,o,a);a=a.concat(_.getTargets(Math.max(0,t-a.length))),this._setTornadoAlleies(a,n,e,i)},e.prototype._setTornadoAlleies=function(e,t,i,n){for(var o=0,a=e;o<a.length;o++){var s=a[o],r=new egret.Point;r.x=t.x,t.y<0?r.y=s.y:r.y=t.y;var l=new TornadoAlley(i,r,s,!1,1*xyd.frameScale,n);l.init(),this._tornadoAlleies.push(l)}},e.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;if(!i&&t.type==ElementTypeConstants.TORNADO){var n=t;if(n.isColorTriggerType())this._createTornadoAlleyFrom(n,1);else{0==n.isTriggered()&&n.triggerBy(void 0);var o=1*xyd.frameScale,a=new egret.Point(n.x,n.y);if(void 0!=n.getTriggerELement()){var s=n.getTriggerELement();a=new egret.Point((n.x+s.x)/2,(n.y+s.y)/2),n.isLineTriggerType&&(o=15*xyd.frameScale),n.isSquareTriggerType&&(o=10*xyd.frameScale),n.isColorTriggerType&&(o=15*xyd.frameScale)}var r=n.col<4?-1:9,l=new egret.Point(r,n.row),_=new TornadoAlley(n,a,l,!0,o,0);_.init(),this._tornadoAlleies.push(_)}}},e.prototype._onHitFanBlocker=function(e){var t=e.data.alleyNum,i=e.data.fanBlocker;t&&t>0&&this._createTornadoAlleyFrom(i,t)},e}();__reflect(TornadoHandler.prototype,"TornadoHandler",["IStabilityClient"]);var WandElementHandler=function(){function e(e){this._activedWand=[],this._intelvalFrame=10*xyd.frameScale,this._numFrames=-1,this._unchangedPos=[],this._changedElements=[],this._changeType=-1,this._changeDir=-1,this._isChanging=!1,this._changeDone=!1,this._wandDis=0,this._eleIDs=[],this.DISTANCE_NORMAL=3,this.DISTANCE_SPECIAL=9,this._board=e,this._initEvents()}return e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;if(!i&&t.type==ElementTypeConstants.WAND){var n=new ActivedWandElement(t.col,t.row,t.getTriggerType(),t.id,t.getTriggerDir());this._activedWand.push(n),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.WAND_INIT_EFFECT,!1,t),this._eleIDs.push(t.id)}},e.prototype.requestUpdate=function(){if(0==this._activedWand.length)return!1;var e=this._activedWand[0];return xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.WAND_DISAPPEAR_EFFECT,!1,e),this._isChanging=!0,this._activedWand.splice(0,1),!0},e.prototype.update=function(){this._isChanging&&(this._numFrames++,20==this._numFrames&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ACTIVATE_WAND_EFFECT,!0,!1)),this._numFrames>=140&&(this._changeDone=!0))},e.prototype.canReplace=function(e){return e&&e.canBeDestroyed()?e.isLocked()?!1:e.type==ElementTypeConstants.BOX?!1:e.type==ElementTypeConstants.CRAYON?!1:e.type==ElementTypeConstants.BOMB_COLOR?!1:!0:!1
},e.prototype.requestWithdraw=function(){return this._changeDone?(this._changeType=-1,this._changeDir=-1,this._isChanging=!1,this._changeDone=!1,this._numFrames=-1,this._changedElements=[],this._unchangedPos=[],this._wandDis=0,!0):!1},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e}();__reflect(WandElementHandler.prototype,"WandElementHandler",["IStabilityClient"]);var ColorColorSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_COLOR_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);this.setDPack(t,void 0);var n=new DPackColorColor(this._board,i,t,e);this.setDPack(i,n),t.setDestroyFrames(90*xyd.frameScale),i.setDestroyFrames(90*xyd.frameScale),this._board.addForRemoval(t),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(ColorColorSwap.prototype,"ColorColorSwap");var GuideView=function(e){function t(){var t=e.call(this)||this;return t._objRec=new egret.Rectangle,t._objGlobalPoint=new egret.Point,t._bg=new GuideMaskBackgroud,t.addChild(t._bg),t._maskPic=StarlingSwfUtils.createS9Image("s9_guide_mask"),t.addChild(t._maskPic),t._textBgPic=StarlingSwfUtils.createS9Image("s9_guide_txt"),AnchorUtil.setAnchorY(t._textBgPic,1),t.addChild(t._textBgPic),t._handPic=StarlingSwfUtils.createImage("img_hand"),AnchorUtil.setAnchorX(t._handPic,.5),t.addChild(t._handPic),t._txt=new egret.TextField,t._txt.size=26,t._txt.textColor=5723991,t._txt.lineSpacing=4,AnchorUtil.setAnchorY(t._txt,.5),t.addChild(t._txt),egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE,t.onResize,t),t}return __extends(t,e),t.prototype.onResize=function(){this.stage&&egret.setTimeout(this.refurbish,this,500)},t.prototype.refurbish=function(){this.setData(this._obj,this._data)},t.prototype.setData=function(e,t){if(null!=e){this._obj=e,this._data=t,this._obj.localToGlobal(0,0,this._objGlobalPoint),this._obj.getBounds(this._objRec),this._objGlobalPoint.x=Math.ceil(this._objGlobalPoint.x),this._objGlobalPoint.y=Math.ceil(this._objGlobalPoint.y);var i=15,n=15;this._objRec.x=this._objGlobalPoint.x-i,this._objRec.y=this._objGlobalPoint.y-n,this._objRec.width+=2*i,this._objRec.height+=2*n,this._bg.init(egret.MainContext.instance.stage.stageWidth,egret.MainContext.instance.stage.stageHeight),this._bg.draw(this._objRec),this._maskPic.cacheAsBitmap=!1,this._maskPic.x=this._objRec.x,this._maskPic.y=this._objRec.y,this._maskPic.width=this._objRec.width,this._maskPic.height=this._objRec.height,this._maskPic.cacheAsBitmap=!0,1==this._data.handDir?(this._handPic.scaleY=1,this._handPic.y=this._objRec.y+this._objRec.height-20):2==this._data.handDir&&(this._handPic.scaleY=-1,this._handPic.y=this._objRec.y+20),this._handPic.x=this._objRec.x+.5*this._objRec.width,this._txt.width=0/0,this._txt.height=0/0,this._txt.text=this._data.txt,this._txt.width>320&&(this._txt.text="",this._txt.width=320,this._txt.text=this._data.txt);var o=15;this._textBgPic.cacheAsBitmap=!1,this._textBgPic.width=this._txt.width+2*o+35,this._textBgPic.height=114,1==this._data.txtdir?(this._textBgPic.scaleX=-1,this._textBgPic.scaleY=1,this._textBgPic.x=this._objRec.x):2==this._data.txtdir?(this._textBgPic.scaleX=-1,this._textBgPic.scaleY=-1,this._textBgPic.x=this._objRec.x):3==this._data.txtdir?(this._textBgPic.scaleX=1,this._textBgPic.scaleY=1,this._textBgPic.x=this._objRec.x+this._objRec.width):4==this._data.txtdir&&(this._textBgPic.scaleX=1,this._textBgPic.scaleY=-1,this._textBgPic.x=this._objRec.x+this._objRec.width),this.checkTextBgX(),this._textBgPic.y=this._objRec.y+.5*this._objRec.height,this._txt.x=this._textBgPic.x-(-1==this._textBgPic.scaleX?this._textBgPic.width:-35)+o,this._txt.y=this._textBgPic.y-this._textBgPic.scaleY*this._textBgPic.height*.5,this._textBgPic.cacheAsBitmap=!0}},t.prototype.checkTextBgX=function(){if(1==this._textBgPic.scaleX){var e=egret.MainContext.instance.stage.stageWidth;this._textBgPic.x+this._textBgPic.width>e&&(this._textBgPic.x=e-this._textBgPic.width)}else-1==this._textBgPic.scaleX&&this._textBgPic.x-this._textBgPic.width<0&&(this._textBgPic.x=this._textBgPic.width)},t}(egret.Sprite);__reflect(GuideView.prototype,"GuideView");var ColorSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=t.color;t.type==ElementTypeConstants.BOMB_COLOR?(n=i.color,t.destructionPack=new DPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BOMB_SQURE),t.setDestroyFrames(60*xyd.frameScale),t.shouldNotFall=!0,this._board.addForRemoval(t),i.setMatchable(!1)):(i.destructionPack=new DPackColorSpecial(this._board,i,e,DPackColor.CHANGE_TYPE.BOMB_SQURE),i.setDestroyFrames(60*xyd.frameScale),i.shouldNotFall=!0,this._board.addForRemoval(i),t.setMatchable(!1))},t}(SpecialSwap);__reflect(ColorSquareSwap.prototype,"ColorSquareSwap");var ColorTronadoSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_TORNADO_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=t.color;t.type==ElementTypeConstants.BOMB_COLOR?(n=i.color,t.destructionPack=new DPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BOMB_TORNADO),t.setDestroyFrames(60*xyd.frameScale),t.shouldNotFall=!0,this._board.addForRemoval(t),i.setMatchable(!1)):(i.destructionPack=new DPackColorSpecial(this._board,i,e,DPackColor.CHANGE_TYPE.BOMB_TORNADO),i.setDestroyFrames(60*xyd.frameScale),i.shouldNotFall=!0,this._board.addForRemoval(i),t.setMatchable(!1))},t}(SpecialSwap);__reflect(ColorTronadoSwap.prototype,"ColorTronadoSwap");var CrayonSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.CRAYON_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=xyd.DIRECTION.LEFT;i.x-t.x==1?n=xyd.DIRECTION.RIGHT:t.y-i.y==1?n=xyd.DIRECTION.UP:i.y-t.y==1&&(n=xyd.DIRECTION.DOWN);var o,a;if(t.type==ElementTypeConstants.CRAYON){if(o=t,a=i,i.type==ElementTypeConstants.CRAYON){var s=i;s.triggerBy(t.type,n)}}else o=i,a=t;o.triggerBy(a.type,n),o.setDestroyFrames(1),a.setDestroyFrames(1),this._board.addForRemoval(o),this._board.addForRemoval(a)},t}(SpecialSwap);__reflect(CrayonSwap.prototype,"CrayonSwap");var LineLineSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.LINE_LINE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(t.col==i.col){var n=new DPackRow(this._board,i,e),o=new DPackCol(this._board,t,e);this.setDPack(i,n),this.setDPack(t,o)}else{var n=new DPackRow(this._board,t,e),o=new DPackCol(this._board,i,e);this.setDPack(t,n),this.setDPack(i,o)}this._board.addForRemoval(t),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(LineLineSwap.prototype,"LineLineSwap");var LineSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.LINE_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=new DPackColRowThree(this._board,i,e);this.setDPack(i,n),t.destructionPack=void 0;for(var o=i.row,a=i.col,s=Math.max(0,o-1),r=Math.min(this._board.getBoardRows(),o+1),l=Math.max(0,a-1),_=Math.min(this._board.getBoardCols(),a+1),h=s;r>=h;h++)for(var c=l;_>=c;c++)if(h!=o||c!=a){var d=this._board.getElementAtGrid(c,h);if(void 0!=d&&d.canBeDestroyed()&&!d.isLocked()){if(!d.isSpecial()||h==t.row&&c==t.col){var p=new BlankElement(c,h,20*xyd.frameScale),u=new DPackSimple(this._board,d,p);p.destructionPack=u}d.setDestroyFrames(1),this._board.addForRemoval(d,10*xyd.frameScale)}}i.setDestroyFrames(1),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(LineSquareSwap.prototype,"LineSquareSwap");var NormalColorSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.NORMAL_COLOR_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);t.type==ElementTypeConstants.BOMB_COLOR?(this.setDPack(t,new DPackColor(this._board,t,e)),this._board.addForRemoval(t),i.setMatchable(!1)):(this.setDPack(i,new DPackColor(this._board,i,e)),this._board.addForRemoval(i),t.setMatchable(!1))},t}(SpecialSwap);__reflect(NormalColorSwap.prototype,"NormalColorSwap");var NormalCrayonSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.NORMAL_CRAYON_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=xyd.DIRECTION.LEFT;i.x-t.x==1?n=xyd.DIRECTION.RIGHT:t.y-i.y==1?n=xyd.DIRECTION.UP:i.y-t.y==1&&(n=xyd.DIRECTION.DOWN),t.type==ElementTypeConstants.CRAYON?(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_INIT_EFFECT,!1,t),this.setDPack(t,new DPackCrayon(this._board,t,n,e)),this._board.addForRemoval(t)):(xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.CRAYON_INIT_EFFECT,!1,i),this.setDPack(i,new DPackCrayon(this._board,i,n,e)),this._board.addForRemoval(i))},t}(SpecialSwap);__reflect(NormalCrayonSwap.prototype,"NormalCrayonSwap");var RocketColorColorSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_COLOR_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n),t.clearDestructionPack();var a=new DPackColorColor(this._board,i,t,e);this.setDPack(i,a),i.setDestroyFrames(90*xyd.frameScale),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(RocketColorColorSwap.prototype,"RocketColorColorSwap");var RocketColorLineSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_LINE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n),t.rocketType==RocketConstants.SPECIAL_COLOR_BOMBED?(t.destructionPack=new RocketDPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BMOB_LINE),t.setMatchable(!1),i.setMatchable(!1),this._board.addToDestructionPlanList(t),t.clearDestructionPack()):(i.destructionPack=new DPackColorSpecial(this._board,i,e,DPackColor.CHANGE_TYPE.BMOB_LINE),i.setDestroyFrames(60*xyd.frameScale),i.shouldNotFall=!0,this._board.addForRemoval(i),this._board.addToDestructionPlanList(t),t.clearDestructionPack())},t}(ColorLineSwap);__reflect(RocketColorLineSwap.prototype,"RocketColorLineSwap");var RocketColorSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n),t.rocketType==RocketConstants.SPECIAL_COLOR_BOMBED?(t.destructionPack=new RocketDPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BOMB_SQURE),this._board.addToDestructionPlanList(t),t.clearDestructionPack(),t.setMatchable(!1),i.setMatchable(!1)):(i.destructionPack=new DPackColorSpecial(this._board,i,e,DPackColor.CHANGE_TYPE.BOMB_SQURE),i.setDestroyFrames(60*xyd.frameScale),i.shouldNotFall=!0,this._board.addForRemoval(i),this._board.addToDestructionPlanList(t),t.clearDestructionPack())},t}(SpecialSwap);__reflect(RocketColorSquareSwap.prototype,"RocketColorSquareSwap");var RocketColorTornadoSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.COLOR_TORNADO_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n);var a=new RocketDPackColorSpecial(this._board,t,e,DPackColor.CHANGE_TYPE.BOMB_TORNADO);this.setDPack(t,a),this._board.addToDestructionPlanList(t),t.clearDestructionPack(),i.setDestroyFrames(1*xyd.frameRate);var s=i;s.triggerBy({type:ElementTypeConstants.BOMB_COLOR}),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(RocketColorTornadoSwap.prototype,"RocketColorTornadoSwap");var RocketLineLineSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.LINE_LINE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(t.col==i.col){var n=new DPackRow(this._board,i,e),o=new DPackCol(this._board,t,e);this.setDPack(i,n),this.setDPack(t,o)}else{var n=new DPackRow(this._board,t,e),o=new DPackCol(this._board,i,e);this.setDPack(t,n),this.setDPack(i,o)}var a,s;t.type==ElementTypeConstants.ROCKET?(a=t,s=i):(a=i,s=t),this._board.addForRemoval(s),this._board.addToDestructionPlanList(a),a.clearDestructionPack()},t}(SpecialSwap);__reflect(RocketLineLineSwap.prototype,"RocketLineLineSwap");var RocketLineSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.LINE_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n);var a=new DPackColRowThree(this._board,o,e);this.setDPack(t,a),this._board.addToDestructionPlanList(t),t.clearDestructionPack(),i.destructionPack=void 0;for(var s=o.row,r=o.col,l=Math.max(0,s-1),_=Math.min(this._board.getBoardRows(),s+1),h=Math.max(0,r-1),c=Math.min(this._board.getBoardCols(),r+1),d=l;_>=d;d++)for(var p=h;c>=p;p++)if(d!=s||p!=r){var u=this._board.getElementAtGrid(p,d);if(void 0!=u&&u.canBeDestroyed()&&!u.isLocked()){if(!u.isSpecial()||d==i.row&&p==i.col){var m=new BlankElement(p,d,20*xyd.frameScale),g=new DPackSimple(this._board,u,m);m.destructionPack=g}u.setDestroyFrames(1),this._board.addForRemoval(u,10*xyd.frameScale)}}},t}(SpecialSwap);__reflect(RocketLineSquareSwap.prototype,"RocketLineSquareSwap");var RocketNormalColorSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.NORMAL_COLOR_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);t.type==ElementTypeConstants.BOMB_COLOR?(this.setDPack(t,new DPackColor(this._board,t,e)),this._board.addForRemoval(t),i.setMatchable(!1)):(this.setDPack(i,new DPackColor(this._board,i,e)),this._board.addForRemoval(i),t.setMatchable(!1))},t}(SpecialSwap);__reflect(RocketNormalColorSwap.prototype,"RocketNormalColorSwap");var RocketSpecialSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.ROCKET_SPECIAL_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);t.type==ElementTypeConstants.ROCKET?(this._rocket=t,this._otherElement=i):(this._rocket=i,this._otherElement=t);var n=this._rocket.rocketType;n==RocketConstants.REGULAR_ROCKET?this.handleNormalRocket(e):n==RocketConstants.SPECIAL_STRIPED_LINE?this.handleLinedRocket(e):n==RocketConstants.SPECIAL_STRIPED_COLUMN?this.handleLinedRocket(e):n==RocketConstants.SPECIAL_COLOR_BOMBED?this.handleColoredRocket(e):n==RocketConstants.SPECIAL_WRAPPED&&this.handleSquaredRocket(e)},t.prototype.handleLinedRocket=function(e){var t=this._otherElement.type;if(t==ElementTypeConstants.BOMB_COL||t==ElementTypeConstants.BOMB_ROW){var i=new RocketLineLineSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.BOMB_SQUARE){var i=new RocketLineSquareSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.BOMB_COLOR){var i=new RocketColorLineSwap(this._board);i.doSwap(e);this._otherElement.destructionPack}},t.prototype.handleSquaredRocket=function(e){var t=this._otherElement.type;if(t==ElementTypeConstants.BOMB_COL||t==ElementTypeConstants.BOMB_ROW){var i=new RocketLineSquareSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.BOMB_SQUARE){var i=new RocketSquareSquareSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.BOMB_COLOR){var i=new RocketColorSquareSwap(this._board);i.doSwap(e)}},t.prototype.handleColoredRocket=function(e){var t=this._otherElement.type;if(t==ElementTypeConstants.BOMB_COL||t==ElementTypeConstants.BOMB_ROW){var i=new RocketColorLineSwap(this._board);i.doSwap(e);this._rocket.destructionPack}else if(t==ElementTypeConstants.BOMB_SQUARE){var i=new RocketColorSquareSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.BOMB_COLOR){var i=new RocketColorColorSwap(this._board);i.doSwap(e)}else if(t==ElementTypeConstants.TORNADO){var i=new RocketColorTornadoSwap(this._board);i.doSwap(e)}else this.setDPack(this._rocket,new RocketDPackColor(this._board,this._rocket,e)),this._rocket.consumeSpecialPower(),this._otherElement.setMatchable(!1)},t.prototype.handleNormalRocket=function(e){var t=this._otherElement.type;t==ElementTypeConstants.BOMB_COL?(this._rocket.setSpecialPower(RocketConstants.SPECIAL_STRIPED_COLUMN),this._board.addForRemoval(this._otherElement)):t==ElementTypeConstants.BOMB_ROW?(this._rocket.setSpecialPower(RocketConstants.SPECIAL_STRIPED_LINE),this._board.addForRemoval(this._otherElement)):t==ElementTypeConstants.BOMB_SQUARE?(this._rocket.setSpecialPower(RocketConstants.SPECIAL_WRAPPED),this._board.addForRemoval(this._otherElement)):t==ElementTypeConstants.BOMB_COLOR&&(this._rocket.setSpecialPower(RocketConstants.SPECIAL_COLOR_BOMBED),this.setDPack(this._otherElement,new DPackColor(this._board,this._otherElement,e)),this._board.addForRemoval(this._otherElement))},t}(SpecialSwap);__reflect(RocketSpecialSwap.prototype,"RocketSpecialSwap");var RocketSquareSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.SQUARE_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);n.type==ElementTypeConstants.ROCKET?(t=n,i=o):(t=o,i=n);var a=this._board.getElementFactory().create(t.col,t.row,2,ElementTypeConstants.NORMAL);a.setUnstable(),a.destructionPack=new DPackBomb(this._board,a,void 0,5),t.destructionPack=new DPackBomb(this._board,t,a,5);var s=this._board.getElementFactory().create(i.col,i.row,2,ElementTypeConstants.NORMAL);s.setUnstable(),s.destructionPack=new DPackBomb(this._board,s,void 0,5),i.destructionPack=new DPackBomb(this._board,i,s,5),this._board.addToDestructionPlanList(t),t.clearDestructionPack(),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(RocketSquareSquareSwap.prototype,"RocketSquareSquareSwap");var EasyLoading=function(e){function t(){var t=e.call(this)||this;return t.content=null,t.speed=.6,t.progress=0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer);var e=new egret.DisplayObjectContainer;e.x=.5*this.content.width,e.y=.5*this.content.height,this.progressLabel=new eui.Label("0%"),this.progressLabel.x=-20,this.progressLabel.y=100,this.progressLabel.size=32,this.progressLabel.textAlign=egret.HorizontalAlign.CENTER,this.content.addChild(e),e.addChild(this.progressLabel),RES.getResByUrl("resource/assets/load_Reel.png",function(e){var t=new egret.Bitmap;t.texture=e,t.x=.5*-t.width,t.y=.5*-t.height,this.uiImageContainer.addChild(t)},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.showLoading=function(){App.StageUtils.getStage().addChild(this.content),App.TimerManager.doTimer(33,100,this.enterTime,this)},t.prototype.setProgressLabel=function(e,t){if(e==this.progress&&100==t||!(this.progress/100>=e/t)){this.progress=Math.round(e/t*100);var i=this.progress+"%";this.progressLabel.text=i}},t.prototype.hideLoading=function(){this.content&&this.content.parent&&(App.StageUtils.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager.remove(this.enterFrame,this)},t.prototype.enterFrame=function(e){},t.prototype.enterTime=function(){this.uiImageContainer.rotation+=6*this.speed,this.progress++,this.progress>100&&(this.progress=100),this.setProgressLabel(this.progress,100)},t}(BaseClass);__reflect(EasyLoading.prototype,"EasyLoading");var SquareSquareSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.SQUARE_SQUARE_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=this._board.getElementFactory().create(t.col,t.row,t.color,ElementTypeConstants.NORMAL);n.setUnstable(),n.destructionPack=new DPackBomb(this._board,n,void 0,5),t.destructionPack=new DPackBomb(this._board,t,n,5);var o=this._board.getElementFactory().create(i.col,i.row,i.color,ElementTypeConstants.NORMAL);o.setUnstable(),o.destructionPack=new DPackBomb(this._board,o,void 0,5),i.destructionPack=new DPackBomb(this._board,i,o,5),this._board.addForRemoval(t),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(SquareSquareSwap.prototype,"SquareSquareSwap");var SwapFailTypeConstants=function(){function e(){}return e.NONE=0,e.CANT_MATCH=1,e.RESIST_BY_FENCE=2,e}();__reflect(SwapFailTypeConstants.prototype,"SwapFailTypeConstants");var SwapHandler=function(){function e(t){this._swapMap={},this._board=t;var i=new LineLineSwap(this._board),n=new ColorLineSwap(this._board),o=new LineSquareSwap(this._board),a=new NormalColorSwap(this._board),s=new CrayonSwap(this._board),r=new TornadoSpecialSwap(this._board),l=new WandElementSwap(this._board),_=new RocketSpecialSwap(this._board),h=new ColorTronadoSwap(this._board);this._swapMap[e.getSwapKey(ElementTypeConstants.SCISSOR,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.NORMAL,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.TIME_BOMB,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.LUCKY_BAG,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.GOLDEN_EGG,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.BLACK_HOLE,ElementTypeConstants.BOMB_COLOR)]=a,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_COLOR)]=new ColorColorSwap(this._board),this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.BOMB_SQUARE)]=new SquareSquareSwap(this._board),this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_COL)]=i,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_ROW)]=i,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_COL)]=i,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_COLOR)]=n,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_COLOR)]=n,this._swapMap[e.getSwapKey(ElementTypeConstants.TORNADO,ElementTypeConstants.BOMB_COLOR)]=h,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_SQUARE)]=o,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_SQUARE)]=o,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.BOMB_COLOR)]=new ColorSquareSwap(this._board),this._swapMap[e.getSwapKey(ElementTypeConstants.TORNADO,ElementTypeConstants.BOMB_COL)]=r,this._swapMap[e.getSwapKey(ElementTypeConstants.TORNADO,ElementTypeConstants.BOMB_ROW)]=r,this._swapMap[e.getSwapKey(ElementTypeConstants.TORNADO,ElementTypeConstants.BOMB_SQUARE)]=r,this._swapMap[e.getSwapKey(ElementTypeConstants.SCISSOR,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.NORMAL,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.CRAYON,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.CRAYON,ElementTypeConstants.BLACK_HOLE)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.TIME_BOMB,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.GOLDEN_EGG,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.LUCKY_BAG,ElementTypeConstants.CRAYON)]=s,this._swapMap[e.getSwapKey(ElementTypeConstants.SCISSOR,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.NORMAL,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COL,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.CRAYON,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.WAND,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.BLACK_HOLE,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.TIME_BOMB,ElementTypeConstants.WAND)]=l,this._swapMap[e.getSwapKey(ElementTypeConstants.GOLDEN_EGG,ElementTypeConstants.WAND)]=l,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_LINE,ElementTypeConstants.BOMB_COL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_COLUMN,ElementTypeConstants.BOMB_COL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_WRAPPED,ElementTypeConstants.BOMB_COL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.BOMB_COL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_LINE,ElementTypeConstants.TORNADO)]=r,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_COLUMN,ElementTypeConstants.TORNADO)]=r,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_WRAPPED,ElementTypeConstants.TORNADO)]=r,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.TORNADO)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_LINE,ElementTypeConstants.BOMB_ROW)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_COLUMN,ElementTypeConstants.BOMB_ROW)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_WRAPPED,ElementTypeConstants.BOMB_ROW)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.BOMB_ROW)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_LINE,ElementTypeConstants.BOMB_COLOR)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_COLUMN,ElementTypeConstants.BOMB_COLOR)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_WRAPPED,ElementTypeConstants.BOMB_COLOR)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.BOMB_COLOR)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.NORMAL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_LINE,ElementTypeConstants.BOMB_SQUARE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_STRIPED_COLUMN,ElementTypeConstants.BOMB_SQUARE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_WRAPPED,ElementTypeConstants.BOMB_SQUARE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.BOMB_SQUARE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.REGULAR_ROCKET,ElementTypeConstants.BOMB_SQUARE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.REGULAR_ROCKET,ElementTypeConstants.BOMB_ROW)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.REGULAR_ROCKET,ElementTypeConstants.BOMB_COLOR)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.REGULAR_ROCKET,ElementTypeConstants.BOMB_COL)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.BLACK_HOLE)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.TIME_BOMB)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.GOLDEN_EGG)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.LUCKY_BAG)]=_,this._swapMap[e.getRocketSwapKey(RocketConstants.SPECIAL_COLOR_BOMBED,ElementTypeConstants.SCISSOR)]=_}return e.prototype.doSwap=function(t){var i={stage:this._board.getGameConf().totalLevel,swap:"step:("+t.fromColRow.x+","+t.fromColRow.y+")-("+t.toColRow.x+","+t.toColRow.y+")"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ELEMENT_CLICK,i,!0),SelfInfo.get().addOperationLog("Swap from ("+t.fromColRow.x+", "+t.fromColRow.y+") to ("+t.toColRow.x+", "+t.toColRow.y+")");var n=t.fromColRow,o=t.toColRow,a=this._board.getElementAtGrid(n.x,n.y),s=this._board.getElementAtGrid(o.x,o.y);if(void 0==a||void 0==s)return!1;this._board.swapElements(a,s);var r=this._swapMap[e.getSwapKeyFromElement(a,s)];return r&&(r.doSwap(t),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.BOARD_SPECIAL_SWITCH_MADE,!1,{specialSwap:r,swapInfo:t})),this._board.rebuildPathForColumn(a.x),this._board.rebuildPathForColumn(s.x),!0},e.prototype.isSpecialSwap=function(t,i){var n=this._swapMap[e.getSwapKeyFromElement(t,i)];return void 0==n?!1:!0},e.prototype.doSwapBySwapper=function(e){var t=e.fromColRow,i=e.toColRow,n=this._board.getElementAtGrid(t.x,t.y),o=this._board.getElementAtGrid(i.x,i.y);return this._board.setElementAtGrid(i.x,i.y,n),this._board.setElementAtGrid(t.x,t.y,o),this._board.rebuildPathForColumn(n.x),this._board.rebuildPathForColumn(o.x),!0},e.getRocketSwapKey=function(e,t){var i=ElementTypeConstants.ROCKET,n=t,o=e,a=0,s=i<<8|o,r=n<<8|a;return this.getSwapKeyFromTypeSubType(s,r)
},e.getSwapKey=function(e,t){var i=e<<8|0,n=t<<8|0;return this.getSwapKeyFromTypeSubType(i,n)},e.getSwapKeyFromTypeSubType=function(e,t){return e>t?this.getSwapKeyFromTypeSubType(t,e):e<<16|t},e.getSwapKeyFromElement=function(e,t){var i=e.type,n=t.type,o=0,a=0;if(i==ElementTypeConstants.ROCKET){var s=e;o=s.rocketType}if(n==ElementTypeConstants.ROCKET){var s=t;a=s.rocketType}var r=i<<8|o,l=n<<8|a;return this.getSwapKeyFromTypeSubType(r,l)},e}();__reflect(SwapHandler.prototype,"SwapHandler");var SwapInfo=function(){function e(e,t){this._specialSwapType=SpecialSwapConstants.NONE,this._swapFailType=SwapFailTypeConstants.NONE,this._fromColRow=e,this._toColRow=t}return Object.defineProperty(e.prototype,"fromColRow",{get:function(){return this._fromColRow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toColRow",{get:function(){return this._toColRow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specialSwapType",{get:function(){return this._specialSwapType},set:function(e){this._specialSwapType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"swapFailType",{get:function(){return this._swapFailType},set:function(e){this._swapFailType=e},enumerable:!0,configurable:!0}),e}();__reflect(SwapInfo.prototype,"SwapInfo");var TornadoSpecialSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.TORNADO_SPECIAL_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t,i,n=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),o=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y);if(n.type==ElementTypeConstants.TORNADO?(t=n,i=o):(t=o,i=n),t.triggerBy(i),t.setDestroyFrames(1),this._board.addForRemoval(t),i.type==ElementTypeConstants.ROCKET){var a=i;a.clearDestructionPack()}else i.destructionPack=void 0,i.setDestroyFrames(1),this._board.addForRemoval(i)},t}(SpecialSwap);__reflect(TornadoSpecialSwap.prototype,"TornadoSpecialSwap");var WandElementSwap=function(e){function t(t){var i=e.call(this,t)||this;return i.name=SpecialSwapConstants.WAND_ELEMENT_SWAP,i}return __extends(t,e),t.prototype.doSwap=function(e){e.specialSwapType=this.name;var t=this._board.getElementAtGrid(e.fromColRow.x,e.fromColRow.y),i=this._board.getElementAtGrid(e.toColRow.x,e.toColRow.y),n=xyd.DIRECTION.LEFT;i.x-t.x==1?n=xyd.DIRECTION.RIGHT:t.y-i.y==1?n=xyd.DIRECTION.UP:i.y-t.y==1&&(n=xyd.DIRECTION.DOWN);var o,a;t.type==ElementTypeConstants.WAND?(o=t,a=i):(o=i,a=t),o.triggerBy(a.type,n),o.setDestroyFrames(1),a.setDestroyFrames(1),this._board.addForRemoval(o),this._board.addForRemoval(a)},t}(SpecialSwap);__reflect(WandElementSwap.prototype,"WandElementSwap");var GameCountHandler=function(){function e(e){this._savedData={},this.ELEMENT=1,this.BLOCKER=2,this.LEAF=3,this._collectedSpecialDrops=0,this._board=e,this._collectedElements={},this._collectedSwaps={},this._initEvents()}return e.prototype.initSaveData=function(){this._savedData&&(this._savedData.element_count&&(this._collectedElements=this._savedData.element_count),this._savedData.swap_count&&(this._collectedSwaps=this._savedData.swap_count),this._savedData.special_drops&&(this._collectedSpecialDrops=this._savedData.special_drops))},e.prototype.getSaveData=function(e,t){e.element_count=this._collectedElements,e.swap_count=this._collectedSwaps,e.special_drops=this._collectedSpecialDrops},e.prototype.setSaveData=function(e){e.element_count&&(this._savedData.element_count=e.element_count),e.swap_count&&(this._savedData.swap_count=e.swap_count),e.special_drops&&(this._savedData.special_drops=e.special_drops)},e.prototype.getGameCountInfo=function(){var e={};return e.element_count=this._collectedElements,e.swap_count=this._collectedSwaps,e.special_drops=this._collectedSpecialDrops,e},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_LEAF,this._onRemoveLeaf,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SPECIAL_SWITCH_MADE,this._onSpecialSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_PUZZLE_COMPLETE,this._onRemovePuzzle,this)},e.prototype._addCount=function(e,t,i,n){if(void 0!=n)this._addSwapCollectByKey(n);else{var o=e<<24|t<<16|i;this._addElementCollectByKey(o)}},e.prototype._addSpecialDrops=function(e){e.getSpecialDrop()&&(this._collectedSpecialDrops=this._collectedSpecialDrops+1,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_REMOVE_COIN)),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_COLLECT_COIN,!1,!1,{ele:e})))},e.prototype._addElementCollectByKey=function(e){this._collectedElements[e]||(this._collectedElements[e]=0),this._collectedElements[e]++},e.prototype._addSwapCollectByKey=function(e){this._collectedSwaps[e]||(this._collectedSwaps[e]=0),this._collectedSwaps[e]++},e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_LEAF,this._onRemoveLeaf,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SPECIAL_SWITCH_MADE,this._onSpecialSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_PUZZLE_COMPLETE,this._onRemovePuzzle,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ITEM_SPECIAL_SWITCH_MADE,this._onItemSpecialSwitchMade,this)},e.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;if(t&&!i&&t.getDamageSource()!=DamageSource.CLOUD){var n=t.color;void 0!=n&&(this._addCount(this.ELEMENT,t.type,t.color),this._addSpecialDrops(t))}},e.prototype._onRemoveLeaf=function(e){this._addCount(this.LEAF,0,0)},e.prototype._onItemSpecialSwitchMade=function(e){var t=e.data.itemType,i=e.data.elementColor;switch(t){case ItemConstants.COLOR_LINE_BOMB_PACK:var n=this._board.getElementFactory().create(0,0,i,ElementTypeConstants.BOMB_COL),o=this._board.getElementFactory().create(0,0,0,ElementTypeConstants.BOMB_COLOR),a=SwapHandler.getSwapKeyFromElement(n,o);this._addCount(0,0,0,a),this._addCount(this.ELEMENT,o.type,o.color),this._addCount(this.ELEMENT,n.type,n.color);break;case ItemConstants.COLOR_SQUARE_BOMB_PACK:var n=this._board.getElementFactory().create(0,0,i,ElementTypeConstants.BOMB_SQUARE),o=this._board.getElementFactory().create(0,0,0,ElementTypeConstants.BOMB_COLOR),a=SwapHandler.getSwapKeyFromElement(n,o);this._addCount(0,0,0,a),this._addCount(this.ELEMENT,o.type,o.color),this._addCount(this.ELEMENT,n.type,n.color)}},e.prototype._onSpecialSwitchMade=function(e){var t=e.data.swapInfo,i=e.data.specialSwap;if(i){var n=t.fromColRow,o=t.toColRow,a=this._board.getElementAtGrid(n.x,n.y),s=this._board.getElementAtGrid(o.x,o.y),r=SwapHandler.getSwapKeyFromElement(a,s);this._addCount(0,0,0,r)}},e.prototype._onRemoveBlocker=function(e){var t=e.data;if(t){var i=t.type;i&&i!=BlockerConstant.PUZZLE&&this._addCount(this.BLOCKER,i,0)}},e.prototype._onReplaceElement=function(e){var t=e.data.oldEle,i=e.data.force;if(t&&!i&&t.getDamageSource()!=DamageSource.CLOUD){var n=t.color;void 0!=n&&(this._addCount(this.ELEMENT,t.type,t.color),this._addSpecialDrops(t))}},e.prototype._onRemovePuzzle=function(e){this._addCount(this.BLOCKER,BlockerConstant.PUZZLE,0)},e}();__reflect(GameCountHandler.prototype,"GameCountHandler");var xyd;!function(e){var t=function(){function e(){this.models_={}}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.prototype.loadModel=function(e){if(null==this.models_[e]){var t={},i=new t[e];null!=i&&(this.models_[e]=i,i.onRegister())}return this.models_[e]},e.prototype.reset=function(){this.models_={}},e.INSTANCE=null,e}();e.ModelManager=t,__reflect(t.prototype,"xyd.ModelManager")}(xyd||(xyd={}));var GameModeFactory=function(){function e(){this._modeToCreator={},this._modeToCreator=(e={},e[GameModeConstants.CLASSIC_MOVES]=this._getClassicMovesMode,e[GameModeConstants.LEAF]=this._getLeafMode,e[GameModeConstants.LAMP]=this._getLampMode,e[GameModeConstants.OBJECTIVE]=this._getObjectiveMode,e[GameModeConstants.LEAF_OBJECTIVE]=this._getLeafObjectiveMode,e[GameModeConstants.LEAF_LAMP]=this._getLeafLampMode,e);var e}return e.prototype._getClassicMovesMode=function(){return new ClassicMovesMode},e.prototype._getLeafMode=function(){return new LeafMode},e.prototype._getLampMode=function(){return new LampMode},e.prototype._getObjectiveMode=function(){return new ObjectiveMode},e.prototype._getLeafObjectiveMode=function(){return new LeafObjectiveMode},e.prototype._getLeafLampMode=function(){return new LeafLampMode},e.prototype.create=function(e){var t=e.modeName;return this._modeToCreator[t]()},e}();__reflect(GameModeFactory.prototype,"GameModeFactory");var ViewManager=function(e){function t(){var t=e.call(this)||this;return t._views={},t._opens=[],t}return __extends(t,e),t.prototype.clear=function(){this.closeAll(),this._views={}},t.prototype.register=function(e,t){null!=t&&(this._views[e]||(this._views[e]=t))},t.prototype.unregister=function(e){this._views[e]&&(this._views[e]=null,delete this._views[e])},t.prototype.destroy=function(e,t){void 0===t&&(t=null);var i=this.getView(e);i&&(this.unregister(e),i.destroy(),i=null),this.register(e,t)},t.prototype.open=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=this.getView(e);return null==n?void Log.trace("UI_"+e+"不存在"):n.isShow()?(n.open.apply(n,t),n):(n.isInit()?(n.addToParent(),n.open.apply(n,t)):(App.EasyLoading.showLoading(),n.loadResource(function(){n.setVisible(!1),n.addToParent()}.bind(this),function(){n.initUI(),n.initData(),n.open.apply(n,t),n.setVisible(!0),App.EasyLoading.hideLoading()}.bind(this))),this._opens.push(e),n)},t.prototype.close=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(this.isShow(e)){var n=this.getView(e);if(null!=n){var o=this._opens.indexOf(e);e>=0&&this._opens.splice(o,1),n.removeFromParent(),n.close.apply(n,t)}}},t.prototype.closeView=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=Object.keys(this._views),o=0,a=n.length;a>o;o++){var s=parseInt(n[o]);if(this._views[s]==e)return void this.close(s,t)}},t.prototype.getView=function(e){return this._views[e]},t.prototype.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},t.prototype.currOpenNum=function(){return this._opens.length},t.prototype.isShow=function(e){return-1!=this._opens.indexOf(e)},t}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var ClassicMovesMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.CLASSIC_MOVES},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t}(GameMode);__reflect(ClassicMovesMode.prototype,"ClassicMovesMode");var LampMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.LAMP},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t.prototype.addModePlugins=function(){var e=new LampPlugin(this._board,this._gameEndInfo);this._modeplugins.push(e)},t}(GameMode);__reflect(LampMode.prototype,"LampMode");var LampPlugin=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._stableCount=0,n}return __extends(t,e),t.prototype.init=function(e){this._minLampNumOnBoard=e.minLampNumOnBoard,this._maxLampNumOnBoard=e.maxLampNumOnBoard,this._movesNeedToGenerateLamp=e.movesNeedToGenerateLamp,this._nowMovesToGenerateLamp=0;var t=e.lamps;this._lampRemain1=t[0]||0,this._lampRemain2=t[1]||0,this._lampLogicRemain1=this._lampRemain1,this._lampLogicRemain2=this._lampRemain2,this._lampDisplayRemain1=this._lampLogicRemain1,this._lampDisplayRemain2=this._lampLogicRemain2,this._gameEndInfo[GameEndInfo.LAMP_TARGET]=[this._lampRemain1,this._lampRemain2];var i=this._board,n=this._board.getCellMap();this._lampDownPos=[],this._lampCreater=[];for(var o=!1,a=0,s=i.getBoardRows();s>a;a++)for(var r=0,l=i.getBoardCols();l>r;r++){var _=n[a][r];_.hasProperty(CellConstants.GENERATOR_LAMP)&&(this._lampCreater.push(_),o=!0)}for(var a=0,s=i.getBoardRows();s>a;a++)for(var r=0,l=i.getBoardCols();l>r;r++){var _=n[a][r];if(_.hasProperty(CellConstants.LAMP_OUT)&&this._lampDownPos.push(_),!o&&_.hasProperty(CellConstants.ELEMENET_GENERATOR)){for(var h=!1,c=0;c<CellConstants.GENERATOR_SET.length;c++)if(_.hasProperty(CellConstants.GENERATOR_SET[c])){h=!0;break}h||this._lampCreater.push(_)}_.hasProperty(CellConstants.LAMP)&&this._createLampAtPos(_,_.x,_.y)}var d=0;if(this._savedData)this._lampRemain1=this._savedData._lampRemain1,this._lampRemain2=this._savedData._lampRemain2,d=this._savedData._lampOnBoard,this._lampLogicRemain1=this._savedData._lampLogicRemain1,this._lampLogicRemain2=this._savedData._lampLogicRemain2,this._lampDisplayRemain1=this._lampLogicRemain1,this._lampDisplayRemain2=this._lampLogicRemain2,this._nowMovesToGenerateLamp=this._savedData._nowMovesToGenerateLamp;else for(var a=0,s=i.getBoardRows();s>a;a++)for(var r=0,l=i.getBoardCols();l>r;r++){var _=n[a][r];(_.hasProperty(CellConstants.LAMP)||_.hasProperty(CellConstants.LAMP1)||_.hasProperty(CellConstants.LAMP2))&&(d+=1)}if((this._lampRemain1>0||this._lampRemain2>0)&&d<this._minLampNumOnBoard)for(var p=this._minLampNumOnBoard-d,c=0;p>c;c++)this._createLamp();this._initEvents(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{lamp1:this._lampDisplayRemain1,lamp2:this._lampDisplayRemain2}))},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STEP,this._doMove,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._checkCreateLamp,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_UPDATE_LAMP_TARGET,this.updateLampTarget,this)},t.prototype._createLampAtPos=function(e,t,i,n){var o=this._getRemainLampType();n&&(o=n),1==o&&this._lampRemain1--,2==o&&this._lampRemain2--;for(var a=this._board.getElementFactory().create(t,i,0,o-1+ElementTypeConstants.LAMP_1),s=0,r=1,l=0,_=CellConstants.LOCK_SET;l<_.length;l++){var h=_[l];switch(h){case CellConstants.SHACKLE:e.hasProperty(h)&&(s=LOCK_TYPE.SHACKLE);break;case CellConstants.ICE:e.hasProperty(h)&&(s=LOCK_TYPE.ICE);break;case CellConstants.GIFT_WRAPPER_1:case CellConstants.GIFT_WRAPPER_2:case CellConstants.GIFT_WRAPPER_3:case CellConstants.GIFT_WRAPPER_4:case CellConstants.GIFT_WRAPPER_5:e.hasProperty(h)&&(s=LOCK_TYPE.GIFT_WRAPPER,r=h-CellConstants.GIFT_WRAPPER_1+1)}if(s>0)break}s>0&&a.addLock(this._board.getLockFactory().create(s,r)),this._board.setElementAtGrid(t,i,a)},t.prototype._getRemainLampType=function(){if(this._lampRemain1>0&&this._lampRemain2>0){var e=this._board.random(0,1);return 1==e?2:1}return this._lampRemain1>0?1:this._lampRemain2>0?2:0},t.prototype._createLamp=function(){var e=this._getRemainLampType();if(0!=e){for(var t,i=[],n=0;n<this._lampCreater.length;n++){var o=this._lampCreater[n];t=this._board.getElementAtGrid(o.x,o.y),t&&(t.isLocked()||t.isSticky()||t.type!=ElementTypeConstants.LAMP_1&&t.type!=ElementTypeConstants.LAMP_2&&t.type!=ElementTypeConstants.SCISSOR&&i.push(o))}if(0!=i.length){1==e&&this._lampRemain1--,2==e&&this._lampRemain2--;var a=this._board.random(0,i.length-1),s=i[a];t=this._board.getElementAtGrid(s.x,s.y);var r=this._board.getElementFactory().create(t.col,t.row,0,e-1+ElementTypeConstants.LAMP_1);this._board.setElementAtGrid(r.col,r.row,r)}}},t.prototype.createElementsView=function(){for(var e=0,t=this._lampDownPos;e<t.length;e++){var i=t[e],n=i.x,o=i.y;xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_BASE,!0,!1,{i:n,j:o+1,type:9}))}},t.prototype.updateElements=function(){for(var e=0,t=this._lampDownPos;e<t.length;e++){var i=t[e],n=i.x,o=i.y,a=this._board.getElementAtGrid(n,o);if(void 0!=a)a.state!=BoardElementState.REMOVE_STATE&&a.state!=BoardElementState.MOVE_STATE&&(a.type!=ElementTypeConstants.LAMP_1&&a.type!=ElementTypeConstants.LAMP_2||a.isLocked()||(this._lampOutBoard(a),this._stableCount++));else{var s=this._board.getFallingHandler(),r=s.getPathByPoint(n,o);if(void 0==r)continue;for(var l=0,_=r.getElements();l<_.length;l++){var h=_[l];h.state!=BoardElementState.REMOVE_STATE&&(h.type!=ElementTypeConstants.LAMP_1&&h.type!=ElementTypeConstants.LAMP_2||h.row!=o||(this._lampOutBoard(h),this._stableCount++))}}}},t.prototype._lampOutBoard=function(e){this._board.addForRemoval(e,1*xyd.frameScale)},t.prototype.updateLampTarget=function(e){var t=e.data.type;t==ElementTypeConstants.LAMP_1?this._lampDisplayRemain1--:t==ElementTypeConstants.LAMP_2&&this._lampDisplayRemain2--,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{lamp1:this._lampDisplayRemain1,lamp2:this._lampDisplayRemain2})),this._stableCount--},t.prototype.createLampOnTop=function(){var e=this._getRemainLampType();e>0&&(1==e?this._lampRemain1--:this._lampRemain2--,this._nowMovesToGenerateLamp=0,this._board.addDropElementType(e-1+ElementTypeConstants.LAMP_1))},t.prototype.getLampOnBoard=function(){return this._board.getElementsOfType(ElementTypeConstants.LAMP_1).length+this._board.getElementsOfType(ElementTypeConstants.LAMP_2).length},t.prototype._checkCreateLamp=function(e){var t=e.data.ele,i=t.type;i==ElementTypeConstants.LAMP_1?this._lampLogicRemain1--:i==ElementTypeConstants.LAMP_2&&this._lampLogicRemain2--;var n=this._board.getRequestNumOfType(ElementTypeConstants.LAMP_1)+this._board.getRequestNumOfType(ElementTypeConstants.LAMP_2),o=this.getLampOnBoard()+n;return this._maxLampNumOnBoard>0&&o>=this._maxLampNumOnBoard?void 0:o<this._minLampNumOnBoard?void this.createLampOnTop():void(this._nowMovesToGenerateLamp>=this._movesNeedToGenerateLamp&&this.createLampOnTop())},t.prototype._doMove=function(){this._nowMovesToGenerateLamp++},t.prototype.checkIfGameEnd=function(){return this._lampLogicRemain1<=0&&this._lampLogicRemain2<=0},t.prototype.checkGameEndStatus=function(){return this._lampLogicRemain1<=0&&this._lampLogicRemain2<=0?GameEndReason.Victory:GameEndReason.CollectLampsFailed},t.prototype.savePluginData=function(){this._gameEndInfo[GameEndInfo.LAMP_REMAIN]=[this._lampLogicRemain1,this._lampLogicRemain2]},t.prototype.isStable=function(){return 0==this._stableCount},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STEP,this._doMove,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._checkCreateLamp,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_UPDATE_LAMP_TARGET,this.updateLampTarget,this)},t.prototype.getSaveData=function(e,t){var i={};i._lampRemain1=this._lampRemain1,i._lampRemain2=this._lampRemain2,i._lampLogicRemain1=this._lampLogicRemain1,i._lampLogicRemain2=this._lampLogicRemain2,i._lampOnBoard=this.getLampOnBoard(),i._nowMovesToGenerateLamp=this._nowMovesToGenerateLamp,e.lamp=i},t.prototype.setSaveData=function(e){e.lamp&&(this._savedData=e.lamp)},t.prototype.isLampPlugin=function(){return!0},t.prototype.checkHammerHint=function(){var e=this._lampDisplayRemain1<0?0:this._lampDisplayRemain1,t=this._lampDisplayRemain2<0?0:this._lampDisplayRemain2;if(!(e+t>1)&&1==this.getLampOnBoard()){for(var i=this._board.getElementsOfType(ElementTypeConstants.LAMP_1),n=this._board.getElementsOfType(ElementTypeConstants.LAMP_2),o=0!=i.length?i[0]:n[0],a=o.col,s=o.row+1,r=!1,l=0,_=this._lampDownPos;l<_.length;l++){var h=_[l];h.x,h.y;a==h.x&&s==h.y&&(r=!0)}if(r){var c=this._board.getGridContainerAt(a,s);if(void 0!=c&&!c.isLocked()){if(c.hasBlocker()){var d=c.getBlocker();if(d.health>1)return}if(c.hasElement()){var p=c.getElement();if(p.type==ElementTypeConstants.CAKE){var u=p;if(u.hp>1)return}else if(p.type==ElementTypeConstants.ROCKET)return}xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_HAMMER_HINT,!0,!1,{x:a,y:s}))}}}},t.prototype.checkWandHint=function(){if(!this._board.getPortalHandler().hasPortal()){var e=this._board.getElementsOfType(ElementTypeConstants.LAMP_1),t=this._board.getElementsOfType(ElementTypeConstants.LAMP_2),i=this._lampDisplayRemain1<0?0:this._lampDisplayRemain1,n=this._lampDisplayRemain2<0?0:this._lampDisplayRemain2;if((0!=i||0!=n)&&e.length==i&&t.length==n){for(var o={},a=0,s=this._lampDownPos;a<s.length;a++){var r=s[a];o[r.x]=r.y}for(var l=new WandTargetManager(this._board,!0).getWandTargets(),_={},h={},c=[{col:1,row:0},{col:1,row:1},{col:1,row:-1},{col:-1,row:0},{col:-1,row:1},{col:-1,row:-1},{col:0,row:1},{col:0,row:-1}],d=0;d<l.length;++d){var p=l[d],u=p.getGridContainer(),m=u.getCol(),g=u.getRow(),f=void 0,y=!1,E=[-1,0,1];if(g+1<=this._board.getBoardRows())for(var v=0,T=E;v<T.length;v++){var C=T[v],L=this._board.getElementAtGrid(m+C,g+1),b=this._board.getBlockerAtGrid(m+C,g+1),w=this._board.isVoidCell(m+C,g+1);w||null!=L||null!=b||(y=!0)}if(!y){h["col"+m.toString()+"row"+g.toString()]=!0;for(var S=0,O=c;S<O.length;S++){var A=O[S];f=this._board.getElementAtGrid(m+A.col,g+A.row),f&&(_["col"+(m+A.col).toString()+"row"+(g+A.row).toString()]=!0)}}}for(var x=this._board.getBoardRows(),I=0,M=0,R=e;M<R.length;M++){for(var D=R[M],m=D.col,g=D.row,B=0,N=o[m]-g,P=0,k=0,d=g+1;x>d;++d){var G=this._board.getBlockerAtGrid(m,d),f=this._board.getElementAtGrid(m,d);o[m]>=g&&h["col"+m.toString()+"row"+d.toString()]?B++:o[m]>=g&&!G&&_["col"+m.toString()+"row"+d.toString()]&&B++,null==f&&null==G&&P++,!f||f.type!=ElementTypeConstants.LAMP_1&&f.type!=ElementTypeConstants.LAMP_2||k++}N-=P+k,B==N&&I++}for(var F=0,H=0,W=t;H<W.length;H++){for(var U=W[H],m=U.col,g=U.row,B=0,N=o[m]-g,P=0,k=0,d=g+1;x>d;++d){var G=this._board.getBlockerAtGrid(m,d),f=this._board.getElementAtGrid(m,d);o[m]>=g&&h["col"+m.toString()+"row"+d.toString()]?B++:o[m]>=g&&!G&&_["col"+m.toString()+"row"+d.toString()]&&B++,null==f&&null==G&&P++,!f||f.type!=ElementTypeConstants.LAMP_1&&f.type!=ElementTypeConstants.LAMP_2||k++}N-=P+k,B==N&&F++}I==e.length&&F==t.length&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_WAND_HINT))}}},t}(ModePlugin);__reflect(LampPlugin.prototype,"LampPlugin");var Leaf=function(){function e(e,t,i){this._col=e,this._row=t,this._originLeafType=i,this._curLeafType=i}return e.prototype.getRow=function(){return this._row},e.prototype.getCol=function(){return this._col},e.prototype.getLeafType=function(){return this._curLeafType},Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),e.prototype.decreaseLayer=function(){this._curLeafType--},e}();__reflect(Leaf.prototype,"Leaf");var LeafFacade=function(){function e(e){this._leafPlugin=e}return e.prototype.getAllLeaves=function(){var e=[],t=this._leafPlugin.getLeafBoard();if(!t)return e;for(var i=0;i<t.length;i++)for(var n=0;n<t[0].length;n++){var o=t[i][n];o&&e.push(o)}return e},e.prototype.getNumLayersAtGrid=function(e,t){var i=this._leafPlugin.getLeafBoard(),n=i[t][e];return n?n.getLeafType():0},e.prototype.createLeafOnCell=function(e,t,i){var n=void 0;e.hasProperty(CellConstants.LEAF_1)&&(n=new Leaf(i,t,1)),e.hasProperty(CellConstants.LEAF_2)&&(n=new Leaf(i,t,2));var o=this._leafPlugin.getLeafBoard();return o[t][i]=n,n},e}();__reflect(LeafFacade.prototype,"LeafFacade");var BacksType;!function(e){e[e.UNKONOW=0]="UNKONOW",e[e.DEFAULT=1]="DEFAULT",e[e.ONLY_UPDATE_MAIN_WIN=2]="ONLY_UPDATE_MAIN_WIN"}(BacksType||(BacksType={}));var WindowContext=function(){function e(){this.isAnimating=!1,this.isDisappearing=!1,this.win=null}return e.prototype.setAnimating=function(e){this.isAnimating=e,this.isAnimating||(this.isDisappearing=!1)},e.prototype.setDisappearing=function(e){this.isDisappearing=e,this.isDisappearing||(this.isAnimating=!0)},e}();__reflect(WindowContext.prototype,"WindowContext");var xyd;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._showPddIcon=!1,e.uiLayers_=[],e.loadingWindows_={},e.windowContexts_={},e.windowContextsByLayer_=[],e.windowBackSequence_=[],e.winNameStack_=[],e.topWindowHeight_=0,e.bottomWindowHeight_=0,e.actionQueues_=[],e.isPlayingAnim_=!1,e._views={},e._opens=[],e}return __extends(i,t),i.get=function(){return null==i.INSTANCE&&(i.INSTANCE=new i),i.INSTANCE},i.prototype.getTopMargine=function(){return this.topWindowHeight_},i.prototype.getBottomMargine=function(){return this.bottomWindowHeight_},i.prototype.getWindowContexts=function(){return this.windowContexts_},i.prototype.getActiveHeight=function(){return StageUtils.getInstance().getHeight()},i.prototype.isOpen=function(e){var t=this.windowContexts_[e];if(!t||!t.win)return!1;var i=t.win,n=this.getUILayer(i.layerType());return n?!0:!1},i.prototype.getWindow=function(e){var t=this.windowContexts_[e];return null==t?null:t.win},i.prototype.isLoadingOrOpening=function(e){return void 0!=this.loadingWindows_[e]||this.isOpen(e)},i.prototype.showOverlay=function(e){this._showPddIcon=e,this._checkOverlay()},i.prototype._checkOverlay=function(){for(var e=3,t=0,i=e;5>i;i++){var n=this.getUILayer(i);n&&(t+=n.numChildren)}var o;o=t>0?!1:!0,platform.showOverlay(this._showPddIcon&&o)},i.prototype.openWindow=function(t,i,n){var o=function(e){null!=n&&n(e),this.doAction()}.bind(this);if(null==t||!WindowTable.get().hasWindow(t))return o();if(this.isOpen(t))return void this.updateWindow(t,i,n);"map_window"==t?"map_window"==t&&i.mapType==e.MapType.FriendHomeMap?this.showOverlay(!1):(this._checkOverlay(),this.showOverlay(!0)):"stage_window"==t||"severn_map_window"==t?this.showOverlay(!0):this.showOverlay(!1);var a=this.windowContexts_[t],s=null;if(null==a||null==a.win){var r=WindowTable.get().className(t);window[r]&&(s=new window[r](t,i))}else s=a.win;if(null==s)return o();var l=this.getUILayer(s.layerType());return null==l?o(s):s.ready2Open()?(s.closeFunc=this.closeWindow.bind(this),void((null==a||null==a.win)&&(this.loadingWindows_[s.name]=s,s.loadAsset(null,function(e){this.onWindowLoaded(e,i,o)}.bind(this))))):o(s)},i.prototype.updateWindow=function(e,t,i){var n=function(e){null!=i&&i(e)},o=this.windowContexts_[e];null!=o&&null!=o.win?(o.win.params=t,o.win.openWindow(t),n(o.win)):n(null)},i.prototype.refreshWindow=function(e,t){var i=this.windowContexts_[e];null!=i&&null!=i.win&&i.win.update(t)},i.prototype.closeWindow=function(e,t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null);var o=function(e){null!=t&&t(e),this.doAction()}.bind(this);if(null==e)return o(null);var a=null;a="string"==typeof e?e:e.name,this.cancelLoadingWindow(a);var s=this.windowContexts_[a];if(null==s||null==s.win)return o(null);var r=s.win;this.removeWindow(r,o,i,!1,n)},i.prototype.onBackBtnClick=function(){},i.prototype.closeAllWindowsOnLayer=function(t){var i=this.windowContextsByLayer_[t];if(!(null==i||i.length<=0)){for(var n=!1,o=[],a=0,s=i;a<s.length;a++){var r=s[a];o.push(r)}for(var l=0,_=o;l<_.length;l++){var r=_[l];null!=r&&(this.cancelLoadingWindow(r.win.name),this.removeWindow(r.win,null,!0,!0),n=!0)}if(t==e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI){this.windowBackSequence_=[];var h=this.getWindow("main_window");null!=h&&(h.updateWindowDisplay(),e.EventDispatcher.inner().dispatchEvent(new egret.Event(e.event.WINDOW_DISPLAY_INIT_STATUS)))}}},i.prototype.closeAllWindows=function(e){var t={};if(null!=e)for(var i=0,n=e;i<n.length;i++){var o=n[i],a=o;t[a]=!0}for(var s=[],r=0,l=Object.keys(this.windowContexts_);r<l.length;r++){var _=l[r],h=this.windowContexts_[_];h&&h.win&&!t[h.win.name]&&s.push(h)}for(var c=0,d=s;c<d.length;c++){var h=d[c];null!=h&&(this.cancelLoadingWindow(h.win.name),this.removeWindow(h.win,null,!0,!0))}},i.prototype.getUILayer=function(t){var i=this.uiLayers_[t];if(!i){i=new BaseEuiLayer;var n=0;for(var o in this.uiLayers_)Number(o)<t&&n++;this.uiLayers_[t]=i,App.SceneManager.getCurrScene().addLayerAt(i,n),t==e.UILayerType.LAYER_TYPE_FIXED_UI||t==e.UILayerType.LAYER_TYPE_FLOATING_UI||t==e.UILayerType.LAYER_TYPE_FLOATING_CHILD_UI||t==e.UILayerType.LAYER_TYPE_TOP||t==e.UILayerType.LAYER_TYPE_MAX?App.SceneManager.getCurrScene().addLayer(i):App.SceneManager.getCurrScene().addLayerAt(i,0)}return i},i.prototype.hideLayer=function(e){var t=this.getUILayer(e);t&&(t.visible=!1)},i.prototype.showLayer=function(e){var t=this.getUILayer(e);t&&(t.visible=!0)},i.prototype.hideAllLayers=function(){for(var e in this.uiLayers_){var t=this.uiLayers_[e];t&&(t.visible=!1)}},i.prototype.removeLayer=function(e){-1!=this.uiLayers_.indexOf(e)&&this.uiLayers_.splice(this.uiLayers_.indexOf(e),1)},i.prototype.showAllLayers=function(){for(var e in this.uiLayers_){var t=this.uiLayers_[e];t&&(t.visible=!0)}},i.prototype.layoutWindow=function(e){},i.prototype.canOpenWindow=function(t){if(null==t||null==t.name)return!1;var i=t.layerType();if(i==e.UILayerType.LAYER_TYPE_TOP_MODAL){var n=this.windowContextsByLayer_[i];for(var o in n){var a=n[o];if(null!=a&&null!=a.win)return!1}}for(var o in this.windowContexts_){var s=this.windowContexts_[o];if(null!=s&&null!=s.win){var r=s.win.forbiddenWindows();if(null!=r&&null!=r[t.name])return!1}}return!0},i.prototype.canShowWindow=function(e){var t=!0;return t},i.prototype.addWindow=function(t,i,n){if(null==t)return n();var o=t.layerType(),a=this.getUILayer(o);if(!a)return n();var s=this.windowContexts_[t.name],r=this.windowContextsByLayer_[o];null==r&&(r=[],this.windowContextsByLayer_[o]=r),null==s?(s=new WindowContext,s.win=t):s.win!=t&&(this.removeWindow(s.win,null,!0),s=new WindowContext,s.win=t),this.windowContexts_[t.name]=s,this.indexOfWindowOnLayer(t)<0&&r.push(s),i=i?i:{},i.windowName=t.name,t.willOpen(i),e.EventDispatcher.inner().dispatchEventWith(e.event.WINDOW_WILL_OPEN,!1,i),t.addToUILayer(a)},i.prototype.showBlurBackground=function(e,t,i){},i.prototype.removeWindow=function(t,i,n,o,a){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===a&&(a=null);var s=function(e){null!=i&&i(e),e.gc_};if(null==t)return s(null);a=a?a:{},a.windowName=t.name,t.willClose(a,n,o),e.EventDispatcher.inner().dispatchEventWith(e.event.WINDOW_WILL_CLOSE,!1,a);var r=this.windowContexts_[t.name];if(null!=r&&r.win!=t)return s(null);delete this.windowContexts_[t.name];var l=this.windowContextsByLayer_[t.layerType()];if(null!=l)for(;;){var _=this.indexOfWindowOnLayer(t);if(!(_>=0&&_<l.length))break;l.splice(_,1)}var h=function(){t.didClose(a),e.EventDispatcher.inner().dispatchEventWith(e.event.WINDOW_DID_CLOSE,!1,a),t.dispose(),this.onWindowClosed(t,o),s(t)}.bind(this);if(h(),this.windowContexts_.stage_window||this.windowContexts_.severn_map_window){for(var c=3,d=0,p=c;5>p;p++){var u=this.getUILayer(p);u&&(d+=u.numChildren)}if(1>d){var m=!0;this.showOverlay(m)}}},i.prototype.cancelLoadingWindow=function(e){var t=this.loadingWindows_[e];t&&(this.loadingWindows_[t.name]=null,t.cancelLoadAsset())},i.prototype.onWindowLoaded=function(e,t,i){return null==e?i(null):(this.loadingWindows_[e.name]=null,this.addWindow(e,t,i),void this.showWindow(e,t,i))},i.prototype.showWindow=function(e,t,i){return null==e?i(null):(e.playOpenAnimation(),void i(e))},i.prototype.onWindowShown=function(t){var i=t.layerType(),n=t.backType();if((i==e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI||i==e.UILayerType.LAYER_TYPE_FLOATING_UI)&&n>BacksType.UNKONOW){var o=this.windowBackSequence_.length;if(o>0){var a=this.windowBackSequence_[o-1],s=this.getWindow(a);
n==BacksType.DEFAULT&&s&&s.updateWindowVisible(!1)}this.windowBackSequence_.push(t.name)}(i==e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI||i==e.UILayerType.LAYER_TYPE_FLOATING_UI)&&this.winNameStack_.push(t.name)},i.prototype.onWindowClosed=function(t,i){var n=t.layerType(),o=t.backType();if((n==e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI||n==e.UILayerType.LAYER_TYPE_FLOATING_UI)&&this.removeWindowFromList(this.winNameStack_,t.name),(!i||n!=e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI)&&(n==e.UILayerType.LAYER_TYPE_FULL_SCREEN_UI||n==e.UILayerType.LAYER_TYPE_FLOATING_UI)&&o>BacksType.UNKONOW){var a=this.windowBackSequence_.length;if(this.removeWindowFromList(this.windowBackSequence_,t.name),a=this.windowBackSequence_.length,a>0){var s=this.windowBackSequence_[a-1],r=this.getWindow(s);o==BacksType.DEFAULT&&r&&r.updateWindowVisible(!0);var l=this.getWindow("main_window");null!=l&&(r&&r.hideType()>=0?l.updateWindowDisplay(r.hideType()):l.updateWindowDisplay())}else{var l=this.getWindow("main_window");null!=l&&(l.updateWindowDisplay(),e.EventDispatcher.inner().dispatchEvent(new egret.Event(e.event.WINDOW_DISPLAY_INIT_STATUS)))}}},i.prototype.collectCloseWindowContextsByOpen=function(){},i.prototype.collectCloseWindowContextsByClose=function(){},i.prototype.batchChangeWindows=function(){},i.prototype.prepareAppear=function(){},i.prototype.prepareDisappear=function(){},i.prototype.onWindowAnimationFinished=function(){},i.prototype.onWindowDisappearAnimationFinished=function(){},i.prototype.updateFullscreenLayerAndFixedLayerWindowVisibility=function(){},i.prototype.indexOfWindowOnLayer=function(e){if(null==e)return-1;var t=this.windowContextsByLayer_[e.layerType()];if(null==t)return-1;for(var i=0;i<t.length;i++){var n=t[i];if(n&&n.win==e)return i}return-1},i.prototype.playWindowOpenAnimations=function(e,t){e.openAnimType()>0&&(this.isPlayingAnim_=!0);var i=this.winNameStack_[this.winNameStack_.length-1];e.playOpenAnimations(i?i:"",t)},i.prototype.playWindowCloseAnimations=function(e,t){e.closeAnimType()>0&&(Log.trace("playWindowCloseAnimations==================",e.name,this.isPlayingAnim()),this.isPlayingAnim_=!0),e.playCloseAnimations(t)},i.prototype.isPlayingAnim=function(){return this.isPlayingAnim_},i.prototype.windowBack=function(){var e=this.windowBackSequence_.length;if(!(0>=e)){var t=this.windowBackSequence_[e-1];null!=t&&this.closeWindow(t,null,!1,{closeByBack:!0})}},i.prototype.clearAll=function(){this.closeAllWindows(["main_window"]),this.closeWindow("main_window"),App.SceneManager.getCurrScene().removeAllLayer(),this.uiLayers_=[]},i.prototype.getWindowsByLayer=function(e){return this.windowContextsByLayer_[e]?this.windowContextsByLayer_[e]:[]},i.prototype.doAction=function(){var e=this.actionQueues_.length;if(e>0&&!this.isPlayingAnim()){var t=this.actionQueues_[e-1];this.actionQueues_.pop(),Log.trace("doAction==================",t.type,t.params[1]),"open"==t.type?this.openWindow.call(this,t.params):"close"==t.type&&this.closeWindow.call(this,t.params)}},i.prototype.removeWindowFromList=function(e,t){for(var i=-1,n=0;n<e.length;n++){var o=e[n];if(o==t){i=n;break}}i>=0&&e.splice(i,1)},Object.defineProperty(i.prototype,"windowContextsByLayer",{get:function(){return this.windowContextsByLayer_},enumerable:!0,configurable:!0}),i.INSTANCE=null,i.TOP_WINDOW_HEIGHT=80,i.BOTTOM_WINDOW_HEIGHT=140,i.MANUAL_WIDTH=1080,i.MANUAL_HEIGHT=1920,i}(BaseClass);e.WindowManager=t,__reflect(t.prototype,"xyd.WindowManager")}(xyd||(xyd={}));var LeafPlugin=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.init=function(e){var t=this._board,i=this._board.getCellMap();this._leafBoard=[],this._leafRemain=[];for(var n=0,o=t.getBoardRows();o>n;n++){for(var a=[],s=0,r=t.getBoardCols();r>s;s++){var l=i[n][s],_=this._createLeafOnCell(l,s,n);a.push(_),void 0!=_&&this._leafRemain.push(_)}this._leafBoard.push(a)}this._leafTarget=this.getLeafNum(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{leaf:this._leafTarget})),this._gameEndInfo[GameEndInfo.LEAF_TARGET]=this._leafTarget,this._initEvents()},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT_ANIMATION_BEGIN,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_EMPTY_CELL,this._onRemoveEmptyCell,this)},t.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;e.data.damageSource;t&&!i&&t.type!=ElementTypeConstants.BOX&&t.type!=ElementTypeConstants.CAKE&&t.type!=ElementTypeConstants.BALLOON&&this._updateElementAtGrid(t.col,t.row)},t.prototype._onRemoveEmptyCell=function(e){var t=e.data.col,i=e.data.row;void 0!=t&&void 0!=i&&this._updateElementAtGrid(t,i)},t.prototype._createLeafOnCell=function(e,t,i){var n=void 0;return e.hasProperty(CellConstants.LEAF_1)&&(n=new Leaf(t,i,1)),e.hasProperty(CellConstants.LEAF_2)&&(n=new Leaf(t,i,2)),n},t.prototype.createElementsView=function(){for(var e=0,t=this._leafRemain;e<t.length;e++){var i=t[e];i.getCol(),i.getRow(),i.getLeafType();xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_ADD_LEAF,!0,!1,i))}},t.prototype._updateElementAtGrid=function(e,t){if(0!=this._board.isValidGridPos(e,t)){var i=this._leafBoard[t][e];if(void 0!=i){var n=i.getLeafType();2==n?(i.decreaseLayer(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_REPLACE_LEAF,!0,!1,i))):1==n&&(xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_REMOVE_LEAF,!0,!1,i)),this._leafBoard[t][e]=void 0,this._leafRemain.splice(this._leafRemain.indexOf(i),1),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{leaf:this.getLeafNum()})))}}},t.prototype.calculateElementScore=function(e,t){var i=this._leafBoard[t][e];return void 0!=i?ScoreConstants.LEAF:0},t.prototype.getLeafNum=function(){return this._leafRemain?this._leafRemain.length:void 0},t.prototype.checkIfGameEnd=function(){return 0==this.getLeafNum()},t.prototype.checkGameEndStatus=function(){return 0==this.getLeafNum()?GameEndReason.Victory:GameEndReason.ClearLeafFailed},t.prototype.savePluginData=function(){this._gameEndInfo[GameEndInfo.LEAF_REMAIN]=this.getLeafNum()||0},t.prototype.isStable=function(){return this._isStable},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT_ANIMATION_BEGIN,this._onRemoveElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_EMPTY_CELL,this._onRemoveEmptyCell,this)},t.prototype.getSaveData=function(e,t){var i=this._leafBoard;if(i)for(var n=0;9>n;n++)for(var o=0;9>o;o++)if(i[n][o]){var a=i[n][o];t[n][o].setProperty(CellConstants.LEAF_1+a.getLeafType()-1)}},t.prototype.setSaveData=function(e){},t.prototype.getLeafBoard=function(){return this._leafBoard},t.prototype.getLeafRemain=function(){return this._leafRemain},t.prototype.leafLight=function(){if(this.getLeafNum()<=5)for(var e=0;e<this._leafRemain.length;e++)xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_LEAF_LIGHT,!0,!1,this._leafRemain[e]))},t.prototype.isLeafPlugin=function(){return!0},t.prototype.checkHammerHint=function(){if(!(this.getLeafNum()>1)){var e=this._leafRemain[0];if(e&&!(e.getLeafType()>1)){var t=e.getCol(),i=e.getRow(),n=this._board.getGridContainerAt(t,i);if(void 0==n){if(!this._leafBoard[i][t]||1!=this._leafBoard[i][t].getLeafType())return;return void xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_HAMMER_HINT,!0,!1,{x:t,y:i}))}if(!n.isLocked()&&!n.hasBlocker()){if(n.hasElement()){var o=n.getElement(),a=o.type;if(a==ElementTypeConstants.BOX||a==ElementTypeConstants.CAKE||a==ElementTypeConstants.ROCKET)return}xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_HAMMER_HINT,!0,!1,{x:t,y:i}))}}}},t.prototype.checkWandHint=function(){if(null!=this._leafRemain&&0!=this._leafRemain.length){for(var e=new WandTargetManager(this._board,!0).getWandTargets(),t={},i={},n=[{col:1,row:0},{col:1,row:1},{col:1,row:-1},{col:-1,row:0},{col:-1,row:1},{col:-1,row:-1},{col:0,row:1},{col:0,row:-1}],o=0;o<e.length;++o){var a=e[o],s=a.getGridContainer(),r=s.getCol(),l=s.getRow(),_=void 0,h=!1,c=[-1,0,1];if(l+1<=this._board.getBoardRows())for(var d=0,p=c;d<p.length;d++){var u=p[d],m=this._board.getElementAtGrid(r+u,l+1),g=this._board.getBlockerAtGrid(r+u,l+1),f=this._board.isVoidCell(r+u,l+1);f||null!=m||null!=g||(h=!0)}if(!h){i["col"+r.toString()+"row"+l.toString()]=!0;for(var y=0,E=n;y<E.length;y++){var v=E[y];_=this._board.getElementAtGrid(r+v.col,l+v.row),_&&(t["col"+(r+v.col).toString()+"row"+(l+v.row).toString()]=!0)}}}for(var T=0,C=0,L=this._leafRemain;C<L.length;C++){var b=L[C],r=b.getCol(),l=b.getRow();i["col"+r.toString()+"row"+l.toString()]?T++:b.getLeafType()<2&&t["col"+r.toString()+"row"+l.toString()]&&T++}T==this._leafRemain.length&&xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_USE_WAND_HINT))}},t}(ModePlugin);__reflect(LeafPlugin.prototype,"LeafPlugin");var LeafLampMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.LEAF_LAMP},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t.prototype.addModePlugins=function(){var e=new LeafPlugin(this._board,this._gameEndInfo),t=new LampPlugin(this._board,this._gameEndInfo);this._modeplugins.push(e),this._modeplugins.push(t),this._leafFacade=new LeafFacade(e)},t}(LeafMode);__reflect(LeafLampMode.prototype,"LeafLampMode");var LeafObjectiveMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.LEAF_OBJECTIVE},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t.prototype.addModePlugins=function(){var e=new LeafPlugin(this._board,this._gameEndInfo),t=new ObjectivePlugin(this._board,this._gameEndInfo);this._modeplugins.push(e),this._modeplugins.push(t),this._leafFacade=new LeafFacade(e)},t}(LeafMode);__reflect(LeafObjectiveMode.prototype,"LeafObjectiveMode");var ObjectiveMode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.modeName=function(){return GameModeConstants.OBJECTIVE},t.prototype.createGameView=function(e){return new ClassicMovesModeView(this,e)},t.prototype.addModePlugins=function(){var e=new ObjectivePlugin(this._board,this._gameEndInfo);this._modeplugins.push(e)},t}(GameMode);__reflect(ObjectiveMode.prototype,"ObjectiveMode");var ObjectivePlugin=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.OBJECT_COMPLETE=-1,n._collectingFailedByColorMixer=!1,n._objectiveTarget={},n._objectiveRemain={},n}return __extends(t,e),t.prototype.init=function(e){for(var t=0,i=e.objectives;t<i.length;t++){var n=i[t];this._objectiveTarget[n.item]=n.quantity,void 0==this._objectiveRemain[n.item]&&(this._objectiveRemain[n.item]=n.quantity)}xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{objectives:this._objectiveRemain})),this._gameEndInfo[GameEndInfo.OBJECTIVES_TARGET]=this._objectiveTarget,this._initEvents(),this._goldEggManager=new GoldEggManager(this._board,this)},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_SPECIAL_SWITCH_MADE,this._onSpecialSwitchMade,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onReplaceBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_PUZZLE_COMPLETE,this._onRemovePuzzle,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_TRIGGER_ELEMENT_OR_BLOCKER,this._onTriggerElementOrBlocker,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ITEM_SPECIAL_SWITCH_MADE,this.onItemSpecialSwitchMade,this)},t.prototype.createElementsView=function(){},t.prototype.getRandomObjective=function(){var e=[];for(var t in this._objectiveRemain){var i=-1,n=ObjectiveConstants.OBJECTIVE_TO_BLOCKER_MAP[t];if(n){i=0;for(var o=0;o<n.length;o++){var a=n[o];if(a)if(1==ObjectiveConstants.OBJECTIVE_COUNT_BLOCKER_MAP[a])for(var s=this._board.getBlockersOfType(a),r=0;r<s.length;r++){var l=s[r];l.health&&(i+=l.health)}else i+=this._board.getBlockersOfType(a).length}}else if(n=ObjectiveConstants.OBJECTIVE_TO_ELEMENTTYPE_MAP[t],i=0,n)for(var o=0;o<n.length;o++){var a=n[o];if(a)if(1==ObjectiveConstants.OBJECTIVE_COUNT_ELEMENTTYPE_MAP[a])for(var s=this._board.getElementsOfType(a),_=0;_<s.length;_++){var l=s[_];l.health&&(i+=l.health)}else i+=this._board.getElementsOfType(a).length}i>=this._objectiveRemain[t]||void 0!=this._objectiveRemain[t]&&this._objectiveRemain[t]>0&&e.push(Number(t))}if(0==e.length)for(var t in this._objectiveRemain)void 0!=this._objectiveRemain[t]&&this._objectiveRemain[t]>0&&e.push(Number(t));if(e.length>0){var h=this._board.random(0,e.length-1);return e[h]}return this.OBJECT_COMPLETE},t.prototype._onRemoveBlocker=function(e){var t=e.data;if(t){var i=t.type;switch(i){case BlockerConstant.CLOUD:case BlockerConstant.CLOUD_ROCKET:this.collectObjective(ObjectiveConstants.CLOUD,t.col,t.row);break;case BlockerConstant.SLATE:case BlockerConstant.LAYED_SLATE:var n=t,o=n.health||1;this.collectObjective(ObjectiveConstants.SLATE,t.col,t.row,o);break;case BlockerConstant.SNOW:this.collectObjective(ObjectiveConstants.SNOW,t.col,t.row);break;case BlockerConstant.COLOR_MIXER:this.collectObjective(ObjectiveConstants.COLOR_MIXER,t.col,t.row)}}},t.prototype._onReplaceBlocker=function(e){var t=e.data;if(t){var i=t.type;switch(i){case BlockerConstant.CLOUD:this.collectObjective(ObjectiveConstants.CLOUD,t.col,t.row);break;case BlockerConstant.SLATE:case BlockerConstant.LAYED_SLATE:;this.collectObjective(ObjectiveConstants.SLATE,t.col,t.row);break;case BlockerConstant.SNOW:this.collectObjective(ObjectiveConstants.SNOW,t.col,t.row)}}},t.prototype._onRemovePuzzle=function(e){this.collectObjective(ObjectiveConstants.PUZZLE,e.data.x,e.data.y)},t.prototype.onItemSpecialSwitchMade=function(e){var t=e.data.itemType;switch(t){case ItemConstants.COLOR_LINE_BOMB_PACK:this.collectObjective(ObjectiveConstants.COLOR_LINE_SWAP,4,4),this.collectObjective(ObjectiveConstants.BOMB_LINE,4,4),this.collectObjective(ObjectiveConstants.BOMB_COLOR,4,4);break;case ItemConstants.COLOR_SQUARE_BOMB_PACK:this.collectObjective(ObjectiveConstants.COLOR_SQUARE_SWAP,4,4),this.collectObjective(ObjectiveConstants.BOMB_SQUARE,4,4),this.collectObjective(ObjectiveConstants.BOMB_COLOR,4,4)}},t.prototype._onSpecialSwitchMade=function(e){var t=e.data.swapInfo,i=e.data.specialSwap;if(i){var n=i.getName();switch(n){case SpecialSwapConstants.LINE_LINE_SWAP:this.collectObjective(ObjectiveConstants.LINE_LINE_SWAP,t.toColRow.x,t.toColRow.y);break;case SpecialSwapConstants.LINE_SQUARE_SWAP:this.collectObjective(ObjectiveConstants.LINE_SQUARE_SWAP,t.toColRow.x,t.toColRow.y);break;case SpecialSwapConstants.COLOR_LINE_SWAP:this.collectObjective(ObjectiveConstants.COLOR_LINE_SWAP,t.toColRow.x,t.toColRow.y);break;case SpecialSwapConstants.COLOR_COLOR_SWAP:this.collectObjective(ObjectiveConstants.COLOR_COLOR_SWAP,t.toColRow.x,t.toColRow.y);break;case SpecialSwapConstants.COLOR_SQUARE_SWAP:this.collectObjective(ObjectiveConstants.COLOR_SQUARE_SWAP,t.toColRow.x,t.toColRow.y);break;case SpecialSwapConstants.SQUARE_SQUARE_SWAP:this.collectObjective(ObjectiveConstants.SQUARE_SQUARE_SWAP,t.toColRow.x,t.toColRow.y)}}},t.prototype._onRemoveElement=function(e){this._collectElementHelper(e.data.ele)},t.prototype._onReplaceElement=function(e){e.data&&e.data.needCollect&&this._collectElementHelper(e.data.oldEle)},t.prototype._onTriggerElementOrBlocker=function(e){if(e&&e.data&&e.data.ele){var t=e.data.ele,i=t.type;switch(i){case BlockerConstant.FAN:this.collectObjective(ObjectiveConstants.TORNADO,t.col,t.row,e.data.count)}}},t.prototype._collectElementHelper=function(e){if(e&&e.getDamageSource()!=DamageSource.CLOUD){if(e.color>0){var t=e.color;t<=CellConstants.CELL_COLOR_F&&t>=CellConstants.CELL_COLOR_A&&this.collectObjective(ObjectiveConstants.CELL_COLOR_TO_TARGET[t],e.col,e.row)}var i=e.type;switch(i){case ElementTypeConstants.BOMB_COL:case ElementTypeConstants.BOMB_ROW:this.collectObjective(ObjectiveConstants.BOMB_LINE,e.col,e.row);break;case ElementTypeConstants.BOMB_SQUARE:this.collectObjective(ObjectiveConstants.BOMB_SQUARE,e.col,e.row);break;case ElementTypeConstants.BOMB_COLOR:this.collectObjective(ObjectiveConstants.BOMB_COLOR,e.col,e.row);break;case ElementTypeConstants.TIME_BOMB:this.collectObjective(ObjectiveConstants.TIME_BOMB,e.col,e.row);break;case ElementTypeConstants.BOX:this.collectObjective(ObjectiveConstants.BOX,e.col,e.row);break;case ElementTypeConstants.TIME_BOMB:this.collectObjective(ObjectiveConstants.TIME_BOMB,e.col,e.row);break;case ElementTypeConstants.TORNADO:this.collectObjective(ObjectiveConstants.TORNADO,e.col,e.row);break;case ElementTypeConstants.CAKE:this.collectObjective(ObjectiveConstants.CAKE,e.col,e.row);break;case ElementTypeConstants.LUCKY_BAG:this.collectObjective(ObjectiveConstants.LUCKY_BAG,e.col,e.row);break;case ElementTypeConstants.BALLOON:this.collectObjective(ObjectiveConstants.BALLOON,e.col,e.row)}}},t.prototype._calculateNumOfType=function(e){var t=this._board.getAllBlockers(),i=this._board.getAllElements(),n=0;switch(e){case BlockerConstant.CLOUD:for(var o=0,a=t;o<a.length;o++){var s=a[o];s.type==e&&n++}break;case BlockerConstant.LAYED_SLATE:for(var r=0,l=t;r<l.length;r++){var s=l[r];s.type==e&&(n+=s.health)}break;case ElementTypeConstants.BOX:for(var _=0,h=i;_<h.length;_++){var c=h[_];c.type==e&&n++}}return n},t.prototype.checkIfGameEnd=function(){var e=this._objectiveRemain,t=this._board.colorMixerHandler;if(this._board.usedToHaveColorMixer&&t.mixersBeenRemoved){t.colorMixerElements;for(var i in e){var n=e[i],o=ObjectiveConstants.OBJECTIVE_TO_MIXERTYPE_MAP[i],a=this._calculateNumOfType(o);if(Number(n)>0&&t.isMixerGenObjective(o)&&n>a)return this._collectingFailedByColorMixer=!0,!0}}for(var i in e){var s=e[i];if(Number(s)>0)return!1}return!0},t.prototype.checkGameEndStatus=function(){if(this._collectingFailedByColorMixer)return GameEndReason.ColorMixerDestroyed;var e=this._objectiveRemain;for(var t in e){var i=e[t];if(Number(i)>0)return GameEndReason.CollectObjectivesFailed}return GameEndReason.Victory},t.prototype.savePluginData=function(){this._gameEndInfo[GameEndInfo.OBJECTIVES_REMAIN]=this._objectiveRemain},t.prototype.isStable=function(){return this._isStable},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_SPECIAL_SWITCH_MADE,this._onSpecialSwitchMade,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_BLOCKER,this._onRemoveBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_BLOCK,this._onReplaceBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REPLACE_ELEMENT,this._onReplaceElement,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_PUZZLE_COMPLETE,this._onRemovePuzzle,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_TRIGGER_ELEMENT_OR_BLOCKER,this._onTriggerElementOrBlocker,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ITEM_SPECIAL_SWITCH_MADE,this.onItemSpecialSwitchMade,this),this._goldEggManager&&this._goldEggManager.dispose(),this._objectiveTarget={},this._objectiveRemain={}},t.prototype.collectObjective=function(e,t,i,n){if(void 0===n&&(n=1),this.checkIfNeedToCollect(e)){var o=this._objectiveRemain[e];if(void 0==o&&console.log("error: no need to collect this item"),o>0){o-=n,0>o&&(o=0),this._objectiveRemain[e]=o;var a=this._board.getScoreHandler();a.addScore(ObjectiveConstants.getObjectiveScore(e)),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_TARGET,!0,!1,{collectType:e,x:t,y:i,objectives:this._objectiveRemain}))}}},t.prototype.checkIfNeedToCollect=function(e){for(var t in this._objectiveTarget)if(e==Number(t))return!0;return!1},t.prototype.getSaveData=function(e,t){e.objective=this._objectiveRemain},t.prototype.setSaveData=function(e){e.objective&&(this._objectiveRemain=e.objective)},t.prototype.isObjectivePlugin=function(){return!0},t.prototype.isCollectObjective=function(e){return this.checkIfNeedToCollect(e)},t}(ModePlugin);__reflect(ObjectivePlugin.prototype,"ObjectivePlugin");var ColorLineBomb=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.COLOR_LINE_BOMB_PACK,o}return __extends(t,e),t.prototype.activate=function(){for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getIntergratedElementAt(e,t);!i||i.type==ElementTypeConstants.GOLDEN_EGG||i.busy||i.color!=this._sourceColor||i.hasGiftWrapper()||xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:4,fromY:4,toX:i.x,toY:i.y})}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_BEGIN);for(var e=0;e<this._board.getBoardCols();e++)for(var t=0;t<this._board.getBoardRows();t++){var i=this._board.getIntergratedElementAt(e,t);!i||i.type==ElementTypeConstants.GOLDEN_EGG||i.busy||i.color!=this._sourceColor||i.hasGiftWrapper()||(i=this._doLineChange(i),this._board.addForRemoval(i,60))}this.inUse(),this._canUse=!0,this._window.setCanTouch(!0),this._window.clearMouseData()},t.prototype.setSourceColor=function(e){this._sourceColor=e},t.prototype._doLineChange=function(e){var t;if(this._board.removeLock(e),0==this._board.random(0,1)){t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_ROW),t.id=e.id;var i=new DPackRow(this._board,t);t.destructionPack=i,this._board.replaceBoardElement(t)}else{t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_COL),t.id=e.id;var i=new DPackCol(this._board,t);t.destructionPack=i,this._board.replaceBoardElement(t)}return t},t}(IngameItem);__reflect(ColorLineBomb.prototype,"ColorLineBomb");var ColorSquareBomb=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.COLOR_SQUARE_BOMB_PACK,o}return __extends(t,e),t.prototype.activate=function(e){for(var t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++){var n=this._board.getIntergratedElementAt(t,i);!n||n.type==ElementTypeConstants.GOLDEN_EGG||n.busy||n.color!=this._sourceColor||n.hasGiftWrapper()||xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_THUNDER,!1,{fromX:4,fromY:4,toX:n.x,toY:n.y})}xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.DP_COLOR_BEGIN);for(var t=0;t<this._board.getBoardCols();t++)for(var i=0;i<this._board.getBoardRows();i++){var n=this._board.getIntergratedElementAt(t,i);!n||n.type==ElementTypeConstants.GOLDEN_EGG||n.busy||n.color!=this._sourceColor||n.hasGiftWrapper()||(n=this._doSquareChange(n),this._board.addForRemoval(n,60))}this.inUse(),this._canUse=!0,this._window.setCanTouch(!0),this._window.clearMouseData()},t.prototype.setSourceColor=function(e){this._sourceColor=e},t.prototype._doSquareChange=function(e){var t=this._board.getElementFactory().create(e.col,e.row,e.color,ElementTypeConstants.BOMB_SQUARE);t.id=e.id,this._board.removeLock(e);var i=this._board.getElementFactory().create(t.col,t.row,t.color,ElementTypeConstants.NORMAL);return i.setUnstable(),i.destructionPack=new DPackBomb(this._board,i,void 0,3),t.destructionPack=new DPackBomb(this._board,t,i,3),this._board.replaceBoardElement(t),t},t}(IngameItem);__reflect(ColorSquareBomb.prototype,"ColorSquareBomb");var Hammer=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.HAMMER,ABTest.get().getSetting(ABTest.NEW_INGAME_ITEM_LIMIT)?o._count=ABTest.NEW_INGAME_ITEM_LIMIT_COUNT:o._count=ItemTable.get().getTableDataByItemID(o._itemId).usage_times,o}return __extends(t,e),t.prototype.activate=function(e){if(e){var t=e.x,i=e.y,n={stage:this._board.getGameConf().totalLevel,prop_type:ItemConstants.HAMMER,act_type:"use",II:"II:("+t+","+i+")"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,n,!0);var o=this._board,a=o.getGridContainerAt(t,i);if(a){if(a.hasBlocker())o.hitBlocker(a.getBlocker(),1);else if(a.hasElement()){var s=a.getElement();s.affectAdjacentBlockerOnRemove=!1,o.addScore(ScoreConstants.ELEMENT),o.addForRemoval(s)}}else o.hitEmptyCell(t,i);this._canUse=!0,this._window.setCanTouch(!0),this._window.clearMouseData()}},t.prototype._checkIfCanUse=function(e,t){if(!this._canUse)return!1;var i=this._board,n=i.getCell(t,e);if(!n||n.hasProperty(CellConstants.VOID))return!1;var o=i.getGridContainerAt(e,t);if(!o)return this._board.hasLeafAtGrid(e,t)?!0:!1;var a=o.getElement(),s=o.getBlocker();return a||s?a&&(!a.canBeDestroyed()&&!a.isLocked()||a.hasGiftWrapper())?!1:s&&!s.canBeDestroyedByItem()?!1:!s||s.canBeDestroyed()&&!s.hasGiftWrapper()?!0:!1:!1},t.prototype.onOpDown=function(e){this._window.onOpDownNormal(e)},t.prototype.onDragOnMainField=function(e){var t=this._window;if(t.touchAble()&&!t.isGameOver()&&void 0!=t.lastLogicPoint)return void 0==t.curMousePos?t.curMousePos=new egret.Point(e.stageX,e.stageY):(t.curMousePos.x=e.stageX,t.curMousePos.y=e.stageY),Math.abs(t.curMousePos.x-t.lastMousePos.x)>xyd.TILE_WIDTH/4?(this._gameView.unselectElement(t.lastLogicPoint.x,t.lastLogicPoint.y),void(t.lastLogicPoint=void 0)):Math.abs(t.curMousePos.y-t.lastMousePos.y)>xyd.TILE_HEIGHT/4?(this._gameView.unselectElement(t.lastLogicPoint.x,t.lastLogicPoint.y),void(t.lastLogicPoint=void 0)):void 0},t.prototype.onOpUp=function(e){var t=this._window;if(t.lastLogicPoint=this._gameView.viewToLogic(new egret.Point(e.localX,e.localY)),this._gameView.unselectElement(t.lastLogicPoint.x,t.lastLogicPoint.y),t.touchAble()&&!t.isGameOver()&&!(e.localX>xyd.BOARD_MAX_WIDTH||e.localY>xyd.BOARD_MAX_HEIGHT)){var i=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));if(!this._checkIfCanUse(i.x,i.y))return void this._gameView.unselectElement(i.x,i.y);this.inUse(),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION));var n=this._gameView.logicToView(i);SoundManager.getInstance().playEffect("se_item_hammer_mp3"),EffectFactory.get().newEffect("item_effect_hammer",function(e){var o=this;e.x=n.x,e.y=n.y,t.effectLayer.addChild(e),e.animation.play("texiao01",1),egret.setTimeout(function(){o.activate(i)},this,12e3*xyd.TweenDeltaTime);var a=function(i){e.removeDBEventListener("complete",a,this),e.animation.stop(),t.effectLayer.removeChild(e),EffectFactory.get().pushBackEffect(e),this._board.getGameMode().checkHammerHint()};e.addDBEventListener("complete",a,this)}.bind(this))}},t}(IngameItem);__reflect(Hammer.prototype,"Hammer");var IngameAddFiveSteps=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.INGAME_ADD_FIVE_STEPS,o}return __extends(t,e),t.prototype.activate=function(){this._window.addStepAnimation(5);for(var e=0,t=this._board.getElementsOfType(ElementTypeConstants.TIME_BOMB);e<t.length;e++){var i=t[e];if(i&&!i.isDead()&&!i.shouldRemove){var n=i;n.addTicksToExplode(5),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.UPDATE_TIME_BOMB,!1,n)}}this._canUse=!0},t}(IngameItem);__reflect(IngameAddFiveSteps.prototype,"IngameAddFiveSteps");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.progressTotalWidth=0,t.createView(),t}return __extends(t,e),t.prototype.createView=function(){var e=(StageUtils.getInstance().getHeight()-xyd.getHeight())/2;if(e>0){var t=new eui.Image;t.width=xyd.getWidth(),t.height=e,xyd.setUISprite(t,"bg_mbzh"),this.addChild(t);var i=new eui.Image;i.width=xyd.getWidth(),i.height=e,i.y=e+xyd.getHeight(),xyd.setUISprite(i,"bg_mbzh"),this.addChild(i)}else e=0;this.bgLoading=new eui.Image,this.logo=new eui.Image;var n=new eui.Image;this.progressBar=new eui.Image,this.progressBarMask=new eui.Image,this.progressImg=new eui.Image,xyd.setUISprite(this.bgLoading,"bg_loading"),xyd.setUISprite(this.logo,"logo"),xyd.setUISprite(n,"bg_jindutiao"),xyd.setUISprite(this.progressBar,"jindutiao"),xyd.setUISprite(this.progressBarMask,"bg_mbzh"),xyd.setUISprite(this.progressImg,"icon_mao"),this.textBg=new eui.Image,xyd.setUISprite(this.textBg,"bg_mbzh"),this.textBg.width=xyd.getWidth(),this.textBg.height=.1*xyd.getHeight(),this.textBg.y=StageUtils.getInstance().getHeight()-e-100,this.textBg.alpha=.5,this.addChild(this.textBg),this.bgLoading.y=e,this.bgLoading.width=xyd.getWidth(),this.bgLoading.height=xyd.getHeight(),this.addChild(this.bgLoading),this.logo.width=800,this.logo.height=454,this.logo.x=xyd.getWidth()/2-this.logo.width/2,this.logo.y=e+.18*xyd.getHeight()-100,this.addChild(this.logo);var o=new eui.Image("bg_mbzh_png");o.height=200,o.alpha=.6,o.width=StageUtils.getInstance().getWidth(),o.y=StageUtils.getInstance().getHeight()-e-195,this.addChild(o);var a=new eui.Label;a.size=36,a.text=xyd.__("GAME_ADVICE"),a.width=xyd.getWidth(),a.textAlign="center",a.fontFamily="Microsoft YaHei",a.lineSpacing=10,a.y=StageUtils.getInstance().getHeight()-e-150,this.addChild(a);var s=122,r=0,l=0;this.progressTotalWidth=xyd.getWidth()-2*s;var _=e+xyd.getHeight()-458;n.x=s-r,n.width=this.progressTotalWidth+2*r,n.height=40,n.y=_-l,this.progressBar.x=s,this.progressBar.width=this.progressTotalWidth,this.progressBar.height=37.5,this.progressBar.y=_+2.5,this.progressBarMask.x=s,this.progressBarMask.width=0,this.progressBarMask.height=37.5,this.progressBarMask.y=_,this.progressBar.mask=this.progressBarMask,this.addChild(n),this.addChild(this.progressBar),this.addChild(this.progressBarMask),this.progressImg.x=s,this.progressImg.y=e+xyd.getHeight()-538,this.addChild(this.progressImg),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=e+xyd.getHeight()-582,this.textField.textAlign="center",this.textField.text="0%",this.textField.fontFamily="Microsoft YaHei",this.textField.size=48,this.textField.stroke=3,this.textField.strokeColor=475939,this.textField.x=xyd.getWidth()/2-this.textField.measuredWidth/2,this.progressEffect=new SpriteFrame,this.progressEffect.x=s,this.progressEffect.y=_,this.progressEffect.scaleX=1,this.progressEffect.scaleY=1,this.progressEffect.anchorOffsetX=45,this.progressEffect.anchorOffsetY=20,this.addChildAt(this.progressEffect,99)},t.prototype.onProgress=function(e,t){var i=Math.round(100*e/t);this.progressBarMask.width=i/100*this.progressTotalWidth,this.progressEffect.x=22+this.progressBarMask.width,this.textField.x=102+this.progressBarMask.width,this.progressImg.x=22+this.progressBarMask.width,100>i?this.textField.text=i+"%":this.textField.text=i+"%"},t.prototype.close=function(){this.parent&&this.parent.removeChild(this),this.progressEffect.dispose(),RES.destroyRes("loading")},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var IngameItemManager=function(){function e(){this._itemCreateMap={},this._activedList=[],this._itemMap={},this._itemCreateMap=(e={},e[ItemConstants.HAMMER]=this._initHammer,e[ItemConstants.SWAPPER]=this._initSwapper,e[ItemConstants.WAND]=this._initWand,e[ItemConstants.STICKER]=this._initSticker,e[ItemConstants.INGAME_ADD_FIVE_STEPS]=this._initIngameAddFiveSteps,e[ItemConstants.COLOR_LINE_BOMB_PACK]=this._initColorLineBomb,e[ItemConstants.COLOR_SQUARE_BOMB_PACK]=this._initColorSquareBomb,e);var e}return e.prototype.init=function(e,t,i,n){for(var o=this._calculateNewItemId(t),a=0;a<e.length;a++){var s=e[a];this._itemCreateMap[s](this._activedList,t,i,n),this._itemMap[s]=this._activedList[a]}o&&(e.push(o),this._itemCreateMap[o](this._activedList,t,i,n),this._itemMap[o]=this._activedList[4])
},e.prototype._canShowNewItem=function(e){return e.getGameConf().totalLevel>10},e.prototype._calculateNewItemId=function(e){if(this._canShowNewItem(e)){for(var t,i=e.getGameMode(),n=i.ModePlugins(),o=0;o<n.length;o++)if(n[o],n[o].isObjectivePlugin()){t=n[o];break}if(void 0!=t){var a=t;return a.isCollectObjective(ObjectiveConstants.BOMB_LINE)||a.isCollectObjective(ObjectiveConstants.COLOR_LINE_SWAP)?ItemConstants.COLOR_LINE_BOMB_PACK:a.isCollectObjective(ObjectiveConstants.COLOR_SQUARE_SWAP)||a.isCollectObjective(ObjectiveConstants.BOMB_SQUARE)?ItemConstants.COLOR_SQUARE_BOMB_PACK:ItemConstants.INGAME_ADD_FIVE_STEPS}return ItemConstants.INGAME_ADD_FIVE_STEPS}},e.prototype._initHammer=function(e,t,i,n){e.push(new Hammer(t,i,n))},e.prototype._initSwapper=function(e,t,i,n){e.push(new Swapper(t,i,n))},e.prototype._initWand=function(e,t,i,n){e.push(new Wand(t,i,n))},e.prototype._initSticker=function(e,t,i,n){e.push(new Sticker(t,i,n))},e.prototype._initIngameAddFiveSteps=function(e,t,i,n){e.push(new IngameAddFiveSteps(t,i,n))},e.prototype._initColorLineBomb=function(e,t,i,n){e.push(new ColorLineBomb(t,i,n))},e.prototype._initColorSquareBomb=function(e,t,i,n){e.push(new ColorSquareBomb(t,i,n))},e.prototype.getItemById=function(e){return this._itemMap[e]},e}();__reflect(IngameItemManager.prototype,"IngameItemManager");var Sticker=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.STICKER,ABTest.get().getSetting(ABTest.NEW_INGAME_ITEM_LIMIT)?o._count=ABTest.NEW_INGAME_ITEM_LIMIT_COUNT:o._count=ItemTable.get().getTableDataByItemID(o._itemId).usage_times,o}return __extends(t,e),t.prototype.activate=function(e,t){var i={stage:this._board.getGameConf().totalLevel,prop_type:ItemConstants.STICKER,act_type:"use",II:"II:("+e.x+","+e.y+")"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,i,!0);var n,o=this._board,a=o.getElementAtGrid(e.x,e.y);n=t?o.getElementFactory().create(a.x,a.y,a.color,ElementTypeConstants.BOMB_COL):o.getElementFactory().create(a.x,a.y,a.color,ElementTypeConstants.BOMB_ROW),o.replaceBoardElement(n,!0),this._canUse=!0,this._window.setCanTouch(!0),this._window.clearMouseData(),this._gameView.checkPossibleMove()},t.prototype._checkIfCanUse=function(e,t){if(!this._canUse)return!1;var i=this._board,n=i.getCell(t,e);if(!n||n.hasProperty(CellConstants.VOID))return!1;var o=i.getGridContainerAt(e,t);if(!o)return!1;var a=o.getElement();if(!a||0==a.color||a.isSticky())return!1;var s=this._window.getGuide();if(void 0!=s){var r=s.getGuideID();if(void 0!=r){var l=GuideHelper.getManualInGuide(r);if(l&&1==l.length){var _=9*a.col+a.row;if(_!=l[0])return!1}}}return!0},t.prototype.onOpDown=function(e){var i=this._window;if(i.stick_choosed==t.CHOOSE_NONE&&(i.stick_show&&i.unshow_sticker_effect(),i.touchAble()&&!i.isGameOver()&&!(e.localX>xyd.BOARD_MAX_WIDTH||e.localY>xyd.BOARD_MAX_HEIGHT))){if(i.lastLogicPoint=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY)),this._gameView.isStableElement(i.lastLogicPoint.x,i.lastLogicPoint.y))return void(i.lastLogicPoint=void 0);var n=this._board.getElementAtGrid(i.lastLogicPoint.x,i.lastLogicPoint.y);if(!n||0==n.color||n.isSticky())return void(i.lastLogicPoint=void 0);for(var o=i.lastLogicPoint.x,a=0;9>a;a++)this._gameView.selectElement(o,a);0!=e.stageX||0!=e.stageY?(i.lastMousePos=new egret.Point(e.stageX,e.stageY),i.curMousePos=new egret.Point(e.stageX,e.stageY)):(i.lastMousePos=new egret.Point(-1e3,-1e3),i.curMousePos=new egret.Point(-1e3,-1e3))}},t.prototype.onOpUp=function(e){var i=this._gameView,n=this._window;if(n.stick_choosed!=t.CHOOSE_NONE){var o=i.viewToLogicTouch(new egret.Point(e.localX,e.localY)),a=i.logicToView(o);if(i.isStableElement(o.x,o.y))return void(n.lastLogicPoint=void 0);if(!this._checkIfCanUse(o.x,o.y))return;this.inUse(),SoundManager.getInstance().playEffect("se_item_sticker_mp3"),n.stick_choosed==t.CHOOSE_ROW?this.play_sticker_effect(a,o,!1):this.play_sticker_effect(a,o,!0),n.stick_choosed=t.CHOOSE_NONE}if(void 0!=n.lastLogicPoint&&n.touchAble()&&!n.isGameOver()){for(var s=n.lastLogicPoint,r=s.x,l=s.y,_=i.logicToView(s),h=0;9>h;h++)i.unselectElement(r,h),i.unselectElement(h,l);void 0==n.curMousePos?n.curMousePos=new egret.Point(e.stageX,e.stageY):(n.curMousePos.x=e.stageX,n.curMousePos.y=e.stageY);var c=i.viewToLogicTouch(new egret.Point(e.localX,e.localY));return i.isStableElement(c.x,c.y)?void(n.lastLogicPoint=void 0):void(this._checkIfCanUse(c.x,c.y)&&(this.inUse(),n.stick_choosed=t.CHOOSE_NONE,SoundManager.getInstance().playEffect("se_item_sticker_mp3"),Math.abs(n.curMousePos.x-n.lastMousePos.x)>Math.abs(n.curMousePos.y-n.lastMousePos.y)?this.play_sticker_effect(_,s,!1):this.play_sticker_effect(_,s,!0),n.stick_choosed=t.CHOOSE_NONE))}},t.prototype.onDragOnMainField=function(e){var i=this._window;if(i.stick_choosed==t.CHOOSE_NONE&&i.touchAble()&&!i.isGameOver()&&void 0!=i.lastLogicPoint){void 0==i.curMousePos?i.curMousePos=new egret.Point(e.stageX,e.stageY):(i.curMousePos.x=e.stageX,i.curMousePos.y=e.stageY);var n=i.lastLogicPoint.x,o=i.lastLogicPoint.y;if(Math.abs(i.curMousePos.x-i.lastMousePos.x)>Math.abs(i.curMousePos.y-i.lastMousePos.y))for(var a=0;9>a;a++)a!=o&&this._gameView.unselectElement(n,a),this._gameView.selectElement(a,o);else for(var a=0;9>a;a++)a!=n&&this._gameView.unselectElement(a,o),this._gameView.selectElement(n,a)}},t.prototype.play_sticker_effect=function(e,t,i){var n=this._window;EffectFactory.get().newEffect("item_effect_sticker",function(o){var a=this;o.x=e.x,o.y=e.y,n.effectLayer.addChild(o),i?o.animation.play("texiao01",1):o.animation.play("texiao02",1),egret.setTimeout(function(){a.activate(t,i)},this,12e3*xyd.TweenDeltaTime);var s=function(e){o.removeDBEventListener("complete",s,this),o.animation.stop(),n.effectLayer.removeChild(o),EffectFactory.get().pushBackEffect(o)};o.addDBEventListener("complete",s,this)}.bind(this))},t.CHOOSE_NONE=0,t.CHOOSE_ROW=1,t.CHOOSE_COL=2,t}(IngameItem);__reflect(Sticker.prototype,"Sticker");var Swapper=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.SWAPPER,ABTest.get().getSetting(ABTest.NEW_INGAME_ITEM_LIMIT)?o._count=ABTest.NEW_INGAME_ITEM_LIMIT_COUNT:o._count=ItemTable.get().getTableDataByItemID(o._itemId).usage_times,o}return __extends(t,e),t.prototype.activate=function(e,t){var i={stage:this._board.getGameConf().totalLevel,prop_type:ItemConstants.SWAPPER,act_type:"use",II:"II:("+e.x+","+e.y+")-("+t.x+","+t.y+")"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,i,!0);var n=new SwapInfo(e,t);this._gameView.swapAnimation(n),this._canUse=!0,this._window.clearMouseData()},t.prototype._checkIfCanUse=function(e,t){if(!this._canUse)return!1;var i=this._board.getElementAtGrid(e.x,e.y),n=this._board.getElementAtGrid(t.x,t.y);if(void 0==i||void 0==n)return!1;var o=new egret.Point(t.x-e.x,t.y-e.y),a=-1;if(o.x>0)a=CellEdgesDirection.RIGHT;else if(o.x<0)a=CellEdgesDirection.LEFT;else if(o.y>0)a=CellEdgesDirection.DOWN;else{if(!(o.y<0))return!1;a=CellEdgesDirection.UP}if(this._board.getCellFenceAtGridInDir(i.x,i.y,a))return!1;if(void 0!=this._window.getGuide()){var s=this._window.getGuide(),r=s.getGuideID(),l=GuideHelper.getManualInGuide(r);if(l&&2==l.length){var _=9*e.x+e.y,h=9*t.x+t.y;if(!(l[0]==_&&l[1]==h||l[1]==_&&l[0]==h))return!1}}return!0},t.prototype.onOpDown=function(e){var t=this._window;if(t.touchAble()&&!t.isGameOver()&&!(e.localX>xyd.BOARD_MAX_WIDTH||e.localY>xyd.BOARD_MAX_HEIGHT)){this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));if(t.lastLogicPoint=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY)),this._gameView.isStableElement(t.lastLogicPoint.x,t.lastLogicPoint.y))return void(t.lastLogicPoint=void 0);this._gameView.selectElement(t.lastLogicPoint.x,t.lastLogicPoint.y),0!=e.stageX||0!=e.stageY?(t.lastMousePos=new egret.Point(e.stageX,e.stageY),t.curMousePos=new egret.Point(e.stageX,e.stageY)):(t.lastMousePos=new egret.Point(-1e3,-1e3),t.curMousePos=new egret.Point(-1e3,-1e3))}},t.prototype.onOpUp=function(e){var t=this._window;if(t.lastLogicPoint&&this._gameView.unselectElement(t.lastLogicPoint.x,t.lastLogicPoint.y),t.touchAble()){var i=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));if(t.lastElementChoose&&(t.lastElementChoose.x==i.x&&1==Math.abs(t.lastElementChoose.y-i.y)||t.lastElementChoose.y==i.y&&1==Math.abs(t.lastElementChoose.x-i.x)))return this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),this._gameView.unselectElement(i.x,i.y),void this.moveElement(t.lastElementChoose,i);t.lastLogicPoint&&i.x==t.lastLogicPoint.x&&i.y==t.lastLogicPoint.y&&(void 0==t.lastElementChoose?(t.lastElementChoose=i,this._gameView.selectElement(i.x,i.y)):t.lastElementChoose.x==i.x&&1==Math.abs(t.lastElementChoose.y-i.y)?(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),this._gameView.selectElement(i.x,i.y),t.lastElementChoose=i):t.lastElementChoose.y==i.y&&1==Math.abs(t.lastElementChoose.x-i.x)?(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),this._gameView.selectElement(i.x,i.y),t.lastElementChoose=i):i.x==t.lastElementChoose.x&&i.y==t.lastElementChoose.y?(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),t.lastElementChoose=void 0):(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),this._gameView.selectElement(i.x,i.y),t.lastElementChoose=i)),t.lastLogicPoint=i,t.isGameOver()||void 0!=t.lastLogicPoint&&(i.x==t.lastLogicPoint.x&&(i.y==t.lastLogicPoint.y+1||i.y==t.lastLogicPoint.y-1)&&this.moveElement(t.lastLogicPoint,i),i.y==t.lastLogicPoint.y&&(i.x==t.lastLogicPoint.x+1||i.x==t.lastLogicPoint.x-1)&&this.moveElement(t.lastLogicPoint,i),t.clearMouseData())}},t.prototype.onDragOnMainField=function(e){var t=this._window;if(t.touchAble()&&!t.isGameOver()&&void 0!=t.lastLogicPoint){void 0==t.curMousePos?t.curMousePos=new egret.Point(e.stageX,e.stageY):(t.curMousePos.x=e.stageX,t.curMousePos.y=e.stageY);var i=new egret.Point;return i.x=t.lastLogicPoint.x,i.y=t.lastLogicPoint.y,Math.abs(t.curMousePos.x-t.lastMousePos.x)>xyd.TILE_WIDTH/4?(t.curMousePos.x-t.lastMousePos.x>0?i.x++:i.x--,i.y=t.lastLogicPoint.y,t.lastElementChoose&&(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),t.lastElementChoose=void 0),void this.moveElement(t.lastLogicPoint,i)):Math.abs(t.curMousePos.y-t.lastMousePos.y)>xyd.TILE_WIDTH/4?(t.curMousePos.y-t.lastMousePos.y>0?i.y++:i.y--,i.x=t.lastLogicPoint.x,t.lastElementChoose&&(this._gameView.unselectElement(t.lastElementChoose.x,t.lastElementChoose.y),t.lastElementChoose=void 0),void this.moveElement(t.lastLogicPoint,i)):void 0}},t.prototype.moveElement=function(e,t){SoundManager.getInstance().playEffect("se_item_switch_mp3");var i=this._window;return i.lastElementChoose=void 0,i.lastLogicPoint&&this._gameView.unselectElement(i.lastLogicPoint.x,i.lastLogicPoint.y),this._gameView.isStableElement(t.x,t.y)?void(i.lastLogicPoint=void 0):void(this._checkIfCanUse(e,t)&&(this.inUse(),this.activate(e,t)))},t}(IngameItem);__reflect(Swapper.prototype,"Swapper");var Wand=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._itemId=ItemConstants.WAND,ABTest.get().getSetting(ABTest.NEW_INGAME_ITEM_LIMIT)?o._count=ABTest.NEW_INGAME_ITEM_LIMIT_COUNT:o._count=ItemTable.get().getTableDataByItemID(o._itemId).usage_times,o}return __extends(t,e),t.prototype.activate=function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ACTIVATE_WAND_EFFECT,!0,!1)),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION));var e={stage:this._board.getGameConf().totalLevel,prop_type:ItemConstants.WAND,act_type:"use"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,e,!0)},t}(IngameItem);__reflect(Wand.prototype,"Wand");var WandTarget=function(){function e(e,t){this._gridContainer=e,this._weight=t}return e.prototype.getGridContainer=function(){return this._gridContainer},e.prototype.getWeight=function(){return this._weight},e}();__reflect(WandTarget.prototype,"WandTarget");var WandTargetManager=function(){function e(e,t){void 0===t&&(t=!1),this._gridContainerList=[],this._wandTargetList=[],this._usedWandTargetList=[],this.WAND_TARGET_ELEMENTS=[ElementTypeConstants.NORMAL,ElementTypeConstants.TIME_BOMB,ElementTypeConstants.LUCKY_BAG,ElementTypeConstants.BOX,ElementTypeConstants.BLACK_HOLE],this.WAND_TARGET_BLOCKERS=[BlockerConstant.SLATE,BlockerConstant.CLOUD,BlockerConstant.LAYED_SLATE,BlockerConstant.SNOW],this._isCheck=t,this._board=e,this._isCheck&&this._board.setRandomHandlerForChecking(),this._wandTargetWeightCalculator=new WandTargetWeightCalculator(e),this._initGridContainerList(),this._initWandTargetList()}return e.prototype.getTarget=function(){if(!(this._wandTargetList.length<1)){for(var e=this._wandTargetList.pop(),t=this._usedWandTargetList.length-1;t>=0;t--)for(var i=this._usedWandTargetList[t];this._checkIfGridContainersAdjacent(e.getGridContainer(),i.getGridContainer());)e=this._wandTargetList.pop();return this._usedWandTargetList.push(e),e.getGridContainer()}},e.prototype._initGridContainerList=function(){var e=this._board,t=e.getBoardCols(),i=e.getBoardRows();this._gridContainerList=[];for(var n=0;t>n;n++)for(var o=0;i>o;o++){var a=e.getGridContainerAt(n,o);void 0!=a&&this._checkIfCanBeTransformedByWand(a)&&this._gridContainerList.push(a)}this._randomizeGridContainers()},e.prototype._checkIfCanBeTransformedByWand=function(e){if(e.hasElement()){var t=e.getElement();if(t.hasGiftWrapper())return!1;if(this.WAND_TARGET_ELEMENTS.indexOf(t.type)>-1)return!0}else if(e.hasBlocker()){var i=e.getBlocker();if(i.hasGiftWrapper())return!1;if(this.WAND_TARGET_BLOCKERS.indexOf(i.type)>-1)return!0}return!1},e.prototype._randomizeGridContainers=function(){for(var e=this._gridContainerList.length,t=0;e>t;t++){var i=this._isCheck?this._board.randomForChecking(0,e-1):this._board.random(0,e-1),n=this._gridContainerList[t];this._gridContainerList[t]=this._gridContainerList[i],this._gridContainerList[i]=n}},e.prototype._initWandTargetList=function(){this._wandTargetList=[];for(var e=0,t=this._gridContainerList;e<t.length;e++){var i=t[e],n=this._getWeightForTarget(i);this._wandTargetList.push(new WandTarget(i,n))}this._wandTargetList=this._wandTargetList.sort(function(e,t){return e.getWeight()<t.getWeight()?-1:e.getWeight()>t.getWeight()?1:0}),this._moveAdjacentTargets()},e.prototype._getWeightForTarget=function(e){return this._wandTargetWeightCalculator.calculateWeight(e)},e.prototype._moveAdjacentTargets=function(){for(var e=this._wandTargetList.length-1;e>0;e--){var t=this._wandTargetList[e],i=this._wandTargetList[e-1];this._checkIfGridContainersAdjacent(t.getGridContainer(),i.getGridContainer())&&(this._wandTargetList.splice(e-1,1),this._wandTargetList.splice(0,0,i),e--)}},e.prototype._checkIfGridContainersAdjacent=function(e,t){return Math.abs(e.getCol()-t.getCol())<=1&&Math.abs(e.getRow()-t.getRow())<=1?!0:!1},e.prototype.getWandTargets=function(){var e=[],t=this._wandTargetList.length-1;if(e.push(this._wandTargetList[t]),t--,0>t)return e;for(var i=0,n=e;i<n.length;i++)for(var o=n[i];this._checkIfGridContainersAdjacent(this._wandTargetList[t].getGridContainer(),o.getGridContainer());)t--;if(0>t)return e;if(e.push(this._wandTargetList[t]),t--,0>t)return e;for(var a=0,s=e;a<s.length;a++)for(var o=s[a];this._checkIfGridContainersAdjacent(this._wandTargetList[t].getGridContainer(),o.getGridContainer());)t--;return 0>t?e:(e.push(this._wandTargetList[t]),e)},e}();__reflect(WandTargetManager.prototype,"WandTargetManager");var WandTargetWeightCalculator=function(){function e(e){this._weightMap={},this.LAMP_WEIGHT=10,this.LOCKED_LAMP_MULTIPLIER=2,this.BLOCKER_ON_TOP_ROW_BONUS=1040,this._board=e,this._weightMap=(t={},t[CellConstants.NORMAL_ELEMENT]=1,t[CellConstants.BLACK_HOLE]=1,t[CellConstants.TORNADO]=5,t[CellConstants.BOX]=13,t[CellConstants.BOMB_COL]=0,t[CellConstants.BOMB_ROW]=0,t[CellConstants.BOMB_COLOR]=0,t[CellConstants.BOMB_SQUARE]=0,t[CellConstants.CRAYON]=0,t[CellConstants.SLATE]=15,t[CellConstants.LAYED_SLATE_1]=15,t[CellConstants.LAYED_SLATE_2]=44,t[CellConstants.LAYED_SLATE_3]=130,t[CellConstants.LAYED_SLATE_4]=350,t[CellConstants.LAYED_SLATE_5]=1e3,t[CellConstants.CLOUD]=20,t[CellConstants.CLOUD_MAKER]=0,t[CellConstants.PUZZLE]=3100,t);var t}return e.prototype.calculateWeight=function(e){var t=e.getCellConst();if(0>=t)return 0;if(t==CellConstants.TIME_BOMB)return this._calculateTimeBombWeight(e);if(CellConstants.LAMP_SET.indexOf(t)>-1)return this._calculateLampWeight(e);var i=this._calculateElementWeight(e),n=this._calculateBlockOnTopBonus(e);i+=n;var o=this._calculateBlockLampMultiplier(e),a=this._calculateLeafMuliplier(e);i=this._adjustForEmptyLeafCells(i,a);var s=this._calculateLockMulitplier(e);return i*o*a*s},e.prototype._calculateTimeBombWeight=function(e){var t=0,i=e.getElement(),n=i.getTicksToExplode(),o=this._board.getGameMode().getMovesLeft();return 1==n?1e4:t=n>=o?1:1e3*Math.max(11-o,1)*6},e.prototype._calculateLampWeight=function(e){var t=0,i=e.getElement();return t=i.isLocked()?this.LAMP_WEIGHT*this.LOCKED_LAMP_MULTIPLIER:this.LAMP_WEIGHT},e.prototype._calculateElementWeight=function(e){var t=e.getCellConst(),i=this._weightMap[t];return void 0!=i?i:0},e.prototype._calculateBlockOnTopBonus=function(e){return e.hasBlocker()&&0==e.getRow()?this.BLOCKER_ON_TOP_ROW_BONUS:0},e.prototype._calculateBlockLampMultiplier=function(e){for(var t=0,i=e.getCol(),n=e.getRow(),o=0;n>o;o++){var a=this._board.getElementAtGrid(i,o);a&&ElementTypeConstants.LAMP_SET.indexOf(a.type)>-1&&(t=t+9-n+o)}return 0==t?1:10*t},e.prototype._calculateLeafMuliplier=function(e){var t,i=1,n=this._board.getGameMode();if(n.hasLeaf()){var o=n;if(t=o.getLeafFacade(),void 0==t)return i;var a=e.getCol(),s=e.getRow(),r=t.getNumLayersAtGrid(a,s);r>0&&(i=50+30*r)}return i},e.prototype._adjustForEmptyLeafCells=function(e,t){return 0==e&&t>0?1:e},e.prototype._calculateLockMulitplier=function(e){var t=e.getLockType();return t==LOCK_TYPE.SHACKLE?1.3:t==LOCK_TYPE.ICE?1.2:1},e}();__reflect(WandTargetWeightCalculator.prototype,"WandTargetWeightCalculator");var PregameAddFiveSteps=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._board.getGameMode().addExtraMoves(5),o}return __extends(t,e),t.prototype.setOnBoard=function(){this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.ADD_FIVE_STEPS)},t}(PregameItem);__reflect(PregameAddFiveSteps.prototype,"PregameAddFiveSteps");var PregameAddThreeSteps=function(e){function t(t,i,n){var o=e.call(this,t,i,n)||this;return o._board.getGameMode().addExtraMoves(3),o}return __extends(t,e),t.prototype.setOnBoard=function(){this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.ADD_THREE_STEPS)},t}(PregameItem);__reflect(PregameAddThreeSteps.prototype,"PregameAddThreeSteps");var PregameColorBomb=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}return __extends(t,e),t.prototype.setOnBoard=function(){var e=this._board,t=e.getRandomNormalElement();if(!t)return this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_COLOR),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.COLOR_BOMB));var i=e.getElementFactory().create(t.col,t.row,0,ElementTypeConstants.BOMB_COLOR);e.replaceBoardElement(i,!0),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.COLOR_BOMB)},t}(PregameItem);__reflect(PregameColorBomb.prototype,"PregameColorBomb");var PregameCrayon=function(e){function t(t,i,n,o){var a=e.call(this,t,i,n)||this;return a._engine=o,a}return __extends(t,e),t.prototype.setOnBoard=function(){var e=this._board,t=e.getRandomNormalElement();if(!t)return this._board.addDropElementTypeForPregameItem(ElementTypeConstants.CRAYON),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.CRAYON));var i=e.getElementFactory().create(t.col,t.row,0,ElementTypeConstants.CRAYON);e.replaceBoardElement(i),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.CRAYON),this._initEvents()},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onRemoveElement=function(){this._engine.inGame()&&this.checkIfGenerate()&&this._board.addDropElementType(ElementTypeConstants.CRAYON)},t}(PregameItem);__reflect(PregameCrayon.prototype,"PregameCrayon");var BaseModel=function(){function e(){}return e.prototype.onRegister=function(){},e.prototype.registerEvent=function(e,t,i){xyd.EventDispatcher.outer().addEventListener(e,t,i)},e}();__reflect(BaseModel.prototype,"BaseModel");var PregameItemManager=function(){function e(e){this._ItemMap={},this._activedList=[],this._ItemMap=(t={},t[ItemConstants.COLOR_BOMB]=this._initPregameColorBomb,t[ItemConstants.LINE_SQUARE_BOMB_PACK]=this._initPregameLineSquarePack,t[ItemConstants.TORNADO]=this._initPregameTornado,t[ItemConstants.CRAYON]=this._initPregameCrayon,t[ItemConstants.ADD_THREE_STEPS]=this._initPregameAddThreeSteps,t[ItemConstants.ADD_FIVE_STEPS]=this._initPregameAddFiveSteps,t[ItemConstants.LINE_BOMB]=this._initPregameLineBomb,t[ItemConstants.COLOR_BOMB_TIME]=this._initPregameColorBomb,t[ItemConstants.LINE_SQUARE_BOMB_PACK_TIME]=this._initPregameLineSquarePack,t[ItemConstants.TORNADO_TIME]=this._initPregameTornado,t[ItemConstants.CRAYON_TIME]=this._initPregameCrayon,t[ItemConstants.LINE_BOMB_TIME]=this._initPregameLineBomb,t),this._engine=e;var t}return e.prototype.init=function(e,t){for(var i=0,n=e;i<n.length;i++){var o=n[i];SelfInfo.get().newUserBenefitsItemID==o?(this._ItemMap[o](t,this._activedList,!0,this._engine),SelfInfo.get().newUserBenefitsItemID=0):this._ItemMap[o](t,this._activedList,!1,this._engine)}if(!t.isRecovered()){var a=SelfInfo.get().getClearStreak()||0;logger.logStep("Streak:"+a),a=Math.min(a,ItemConstants.CLEAR_STREAK_REWARDS.length);for(var s=0;a>s;s++){var o=ItemConstants.CLEAR_STREAK_REWARDS[s];this._ItemMap[o](t,this._activedList,!0,this._engine)}}},e.prototype._initPregameColorBomb=function(e,t,i,n){t.push(new PregameColorBomb(PregameItemConstants.ColorBomb,e,i))},e.prototype._initPregameLineSquarePack=function(e,t,i,n){t.push(new PregameLineSquarePack(PregameItemConstants.LineSquarePack,e,i))},e.prototype._initPregameTornado=function(e,t,i,n){t.push(new PregameTornado(PregameItemConstants.Tornado,e,i))},e.prototype._initPregameCrayon=function(e,t,i,n){t.push(new PregameCrayon(PregameItemConstants.Crayon,e,i,n))},e.prototype._initPregameAddThreeSteps=function(e,t,i,n){t.push(new PregameAddThreeSteps(PregameItemConstants.Crayon,e,i))},e.prototype._initPregameAddFiveSteps=function(e,t,i,n){t.push(new PregameAddFiveSteps(PregameItemConstants.Crayon,e,i))},e.prototype._initPregameLineBomb=function(e,t,i,n){t.push(new PregameLineBomb(PregameItemConstants.LineBomb,e,i))},e.prototype.setOnBoard=function(){if(!(void 0==this._activedList||this._activedList.length<=0))for(var e=0,t=this._activedList;e<t.length;e++){var i=t[e];i.setOnBoard()}},e.prototype.dispose=function(){if(!(void 0==this._activedList||this._activedList.length<=0))for(var e=0,t=this._activedList;e<t.length;e++){var i=t[e];i.dispose()}},e}();__reflect(PregameItemManager.prototype,"PregameItemManager");var PregameLineBomb=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}return __extends(t,e),t.prototype.setOnBoard=function(){var e=this._board,t=e.getRandomNormalElement();if(!t)return e.random(0,1)%2==0?this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_COL):this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_ROW),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.LINE_BOMB));var i,n=t.color;i=e.random(0,1)%2==0?e.getElementFactory().create(t.col,t.row,n,ElementTypeConstants.BOMB_COL):e.getElementFactory().create(t.col,t.row,n,ElementTypeConstants.BOMB_ROW),e.replaceBoardElement(i),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.LINE_BOMB)},t}(PregameItem);__reflect(PregameLineBomb.prototype,"PregameLineBomb");var PregameLineSquarePack=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}return __extends(t,e),t.prototype.setOnBoard=function(){var e=this._board,t=e.getRandomNormalElement();if(!t)return this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_COL),this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_SQUARE),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.LINE_SQUARE_BOMB_PACK));var i=e.getElementFactory().create(t.col,t.row,t.color,e.random(ElementTypeConstants.BOMB_ROW,ElementTypeConstants.BOMB_COL));return e.replaceBoardElement(i),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),(t=e.getRandomNormalElement())?(i=e.getElementFactory().create(t.col,t.row,t.color,ElementTypeConstants.BOMB_SQUARE),e.replaceBoardElement(i),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.LINE_SQUARE_BOMB_PACK))):(this._board.addDropElementTypeForPregameItem(ElementTypeConstants.BOMB_SQUARE),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.LINE_SQUARE_BOMB_PACK)))},t}(PregameItem);__reflect(PregameLineSquarePack.prototype,"PregameLineSquarePack");var PregameTornado=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}return __extends(t,e),t.prototype.setOnBoard=function(){var e=this._board,t=e.getRandomNormalElement();if(!t)return this._board.addDropElementTypeForPregameItem(ElementTypeConstants.TORNADO),void(this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.TORNADO));var i=e.getElementFactory().create(t.col,t.row,t.color,ElementTypeConstants.TORNADO);e.replaceBoardElement(i),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CREATE_SPECIAL,!0,!1,i)),this._isFromStreak||SelfInfo.get().useItemNumByID(""+ItemConstants.TORNADO),this._initEvents()},t.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},t.prototype._onRemoveElement=function(){this.checkIfGenerate()&&this._board.addDropElementType(ElementTypeConstants.TORNADO)},t}(PregameItem);__reflect(PregameTornado.prototype,"PregameTornado");var CollectMissionHandler=function(){function e(){this._defaultCollectionMissionID=1001003,this._CollectItemColorMap=(e={},e[1001003]=CellConstants.COLOR_ORANGE,e),this._collectedElements={},this._initEvents();var e}return e.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype.initSaveData=function(){this._savedData&&this._savedData.mission&&(this._collectedElements=this._savedData.mission)},e.prototype._onRemoveElement=function(e){var t=e.data.ele,i=e.data.force;if(t&&!i){var n=t.color;n>0&&(this._collectedElements[n]||(this._collectedElements[n]=0),this._collectedElements[n]++)}},e.prototype.dispose=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_REMOVE_ELEMENT,this._onRemoveElement,this)},e.prototype.getGatheredNum=function(e){var t=this._CollectItemColorMap[e]||CellConstants.COLOR_ORANGE;return this._collectedElements[t]},e.prototype.getSaveData=function(e,t){e.mission=this._collectedElements},e.prototype.setSaveData=function(e){e.mission&&(this._savedData=e.mission)},e}();__reflect(CollectMissionHandler.prototype,"CollectMissionHandler");var ScoreHandler=function(){function e(e){this._scoreTarget=0,this._score=0,this._scoreTargets=e}return e.prototype.getScoreTargets=function(){return this._scoreTargets},e.prototype.getLowestScoreTarget=function(){return this._scoreTargets[0]},e.prototype.getScore=function(){return this._score},e.prototype.setScore=function(e){this._score=e},e.prototype.setScoreTarget=function(e){this._scoreTarget=e},e.prototype.getScoreTarget=function(){return this._scoreTarget},e.prototype.getNextScoreTarget=function(){var e=this._scoreTargets;this._scoreTarget=e[e.indexOf(this._scoreTarget)+1]},e.prototype.addScore=function(e){var t=this._score+e;xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_SCORE,!0,!1,{score:t})),this._score=t},e.prototype.calculateMatchedScore=function(e){var t;return 3==e?t=60:4==e?t=120:e>=5&&(t=40*e),t},e}();__reflect(ScoreHandler.prototype,"ScoreHandler");var GameScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this)},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(GameScene.prototype,"GameScene");var LoadingScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.get().getMainLayer())},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(LoadingScene.prototype,"LoadingScene");var ABTest=function(){function e(){this._setting={},this._setting[e.EXTRA_EDGE_SPACE]=!0,this._setting[e.EASIER_SCORE_TARGETS]=!0,this._setting[e.CAN_ENTER_HOME_MAP]=!1,this._setting[e.is_ITEMS_GUIDE]=!1,this._setting[e.NEWUSER_BENEFITS]=!1,this._setting[e.NEWUSER_STAGE_CASH_REWARD]=!1,this._setting[e.FIRST_TEN_LEVEL_PAY]=!1,this._setting[e.SMALL_SKIP_BTN]=!1,this._setting[e.PREGAME_SHOW_GOODS]=!1,this._setting[e.SEVEN_DAY_BUYING_GROUP]=!0,this._setting[e.EXTRA_THREE_STEPS]=!0,this._setting[e.WIN_GAME_CASH_REWARD]=!1,this._setting[e.SHOW_GOODS_BY_STEP]=!1,this._setting[e.SHOW_GOODS_COIN_AFTER_GAME]=!1,this._setting[e.SEVERN_MAP]=!1,this._setting[e.NEW_STAGE_MAP_STYLE]=!1,this._setting[e.ANDROID_STRONG_REMINDER]=!1,this._setting[e.NEW_INGAME_ITEM_LIMIT]=!1,this._setting[e.NEW_FUNDS_GUIDE]=!1,this._setting[e.MAP_RED_PACKET_STYLE]=!1}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.prototype.setData=function(t){if(t)for(var i=0,n=e.ab_tests;i<n.length;i++){var o=n[i],a=t[o];a&&(a==e.TEST_GROUP?this._setting[o]=!0:a==e.CONTROL_GROUP&&(this._setting[o]=!1))}},e.prototype.getSetting=function(e){return this._setting[e]?this._setting[e]:!1},e.INSTANCE=null,e.EXTRA_EDGE_SPACE="extra_edge_space",e.EASIER_SCORE_TARGETS="easier_score_targets",e.CAN_ENTER_HOME_MAP="can_enter_home_map",e.is_ITEMS_GUIDE="is_items_guide",e.NEWUSER_BENEFITS="newuser_benefits",e.NEWUSER_STAGE_CASH_REWARD="newuser_stage_cash_reward",e.FIRST_TEN_LEVEL_PAY="first_ten_level_pay",e.SMALL_SKIP_BTN="small_skip_btn",e.PREGAME_SHOW_GOODS="pregame_show_goods",e.SEVEN_DAY_BUYING_GROUP="seven_day_buying_group",e.EXTRA_THREE_STEPS="extra_three_steps",e.WIN_GAME_CASH_REWARD="win_game_cash_reward",e.SHOW_GOODS_BY_STEP="show_goods_by_step",e.SHOW_GOODS_COIN_AFTER_GAME="show_goods_coin_after_game",e.SEVERN_MAP="severn_map",e.NEW_STAGE_MAP_STYLE="new_stage_map_style",e.ANDROID_STRONG_REMINDER="android_strong_reminder",e.NEW_INGAME_ITEM_LIMIT="new_ingame_item_limit",e.NEW_FUNDS_GUIDE="new_funds_guide",e.MAP_RED_PACKET_STYLE="map_red_packet_style",e.TEST_GROUP="A",e.CONTROL_GROUP="B",e.NEW_INGAME_ITEM_LIMIT_COUNT=5,e.ab_tests=[e.CAN_ENTER_HOME_MAP,e.is_ITEMS_GUIDE,e.NEWUSER_BENEFITS,e.NEWUSER_STAGE_CASH_REWARD,e.FIRST_TEN_LEVEL_PAY,e.SMALL_SKIP_BTN,e.PREGAME_SHOW_GOODS,e.SEVEN_DAY_BUYING_GROUP,e.EXTRA_THREE_STEPS,e.WIN_GAME_CASH_REWARD,e.SHOW_GOODS_BY_STEP,e.SHOW_GOODS_COIN_AFTER_GAME,e.SEVERN_MAP,e.NEW_STAGE_MAP_STYLE,e.ANDROID_STRONG_REMINDER,e.NEW_INGAME_ITEM_LIMIT,e.NEW_FUNDS_GUIDE,e.MAP_RED_PACKET_STYLE],e
}();__reflect(ABTest.prototype,"ABTest");var xyd;!function(e){function t(e,t,i,n){for(var o=[],a=1;n>a;a++){var s=a/n,r=CalculateSquareBezierPoint(s,e,t,i);o.push(r)}return o}function i(e,t,i,n,o){for(var a=[],s=1;o>s;s++){var r=s/o,l=CalculateCubicBezierPoint(r,e,t,i,n);a.push(l)}return a}e.GetSquareBezierList=t,e.GetCubicBezierList=i}(xyd||(xyd={}));var Debug=function(){function e(){}return e.assert=function(e,t){e||console.log(t)},e}();__reflect(Debug.prototype,"Debug");var EffectFactory=function(){function e(){this.replaceTex={xiaoai_front_tex_png:"xiaoai_tex_png",xiaoai_west_tex_png:"xiaoai_tex_png",xiaoai_east_tex_png:"xiaoai_tex_png",kevin_west_tex_png:"kevin_tex_png",kevin_east_tex_png:"kevin_tex_png"},this.replaceJson={xiaoai_front_tex_json:"xiaoai_tex_json",xiaoai_west_tex_json:"xiaoai_tex_json",xiaoai_east_tex_json:"xiaoai_tex_json",kevin_east_tex_json:"kevin_tex_json",kevin_west_tex_json:"kevin_tex_json"},this.effectsPool_={}}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.prototype.pushBackEffect=function(e){if(null==e)return!1;var t=e.armature.name;return this.effectsPool_[t]||(this.effectsPool_[t]=[]),dragonBones.EgretFactory.factory.clock.remove(e.armature),e.visible=!1,e.scaleX=1,e.scaleY=1,e.anchorOffsetX=0,e.anchorOffsetY=0,e.rotation=0,this.effectsPool_[t].push(e),!0},e.prototype.popEffect=function(e){var t=this.effectsPool_[e];if(t&&t.length){var i=t.pop();return i.visible=!0,dragonBones.EgretFactory.factory.clock.add(i.armature),i}},e.prototype.relaceNameJson=function(e){return this.replaceJson[e]?this.replaceJson[e]:e},e.prototype.relaceNameTex=function(e){return this.replaceTex[e]?this.replaceTex[e]:e},e.prototype.cleanUp=function(){for(var e in this.effectsPool_){for(var t=this.effectsPool_[e];t&&t.length;){var i=t.pop();i.dispose()}delete this.effectsPool_[e]}},e.prototype.newEffect=function(e,t){function i(){var i=o.buildArmatureDisplay(e,e);i.armature.cacheFrameRate=i.armature.armatureData.frameRate,null!=t&&t(i)}var n=this.popEffect(e);if(n)return void t(n);var o=dragonBones.EgretFactory.factory;if(o.getDragonBonesData(e)&&o.getTextureAtlasData(e))i();else{var a=this.relaceNameTex(e+"_tex_png"),s=this.relaceNameJson(e+"_tex_json"),r=e+"_ske_dbbin";RES.getResAsync(a).then(function(t){if(void 0!=t){var n,a;a=allJsons[s]?allJsons[s]:RES.getRes(s),allJsons[e+"_ske_json"]?(n=allJsons[e+"_ske_json"],o.getDragonBonesData(e)||o.parseDragonBonesData(n,e),o.getTextureAtlasData(e)||o.parseTextureAtlasData(a,t,e),i()):n=RES.getResAsync(r).then(function(n){void 0!=n&&(o.getDragonBonesData(e)||o.parseDragonBonesData(n,e),o.getTextureAtlasData(e)||o.parseTextureAtlasData(a,t,e),i())})}})}},e.prototype.newEffectWithForceCallBack=function(e,t,i){function n(){var t=a.buildArmatureDisplay(e,e);t.armature.cacheFrameRate=t.armature.armatureData.frameRate,null!=i&&i(t)}var o=this.popEffect(e);if(o)return void i(o);var a=dragonBones.EgretFactory.factory;if(a.getDragonBonesData(e)&&a.getTextureAtlasData(e))n();else{var s=this.relaceNameTex(e+"_tex_png"),r=this.relaceNameJson(e+"_tex_json"),l=e+"_ske_dbbin";RES.getResAsync(s).then(function(i){if(void 0==i)return void(t&&t());var o,s;s=allJsons[r]?allJsons[r]:RES.getRes(r),allJsons[e+"_ske_json"]?(o=allJsons[e+"_ske_json"],a.getDragonBonesData(e)||a.parseDragonBonesData(o,e),a.getTextureAtlasData(e)||a.parseTextureAtlasData(s,i,e),n()):o=RES.getResAsync(l).then(function(o){return void 0==o?void(t&&t()):(a.getDragonBonesData(e)||a.parseDragonBonesData(o,e),a.getTextureAtlasData(e)||a.parseTextureAtlasData(s,i,e),void n())})})}},e}();__reflect(EffectFactory.prototype,"EffectFactory");var xyd;!function(e){var t;!function(e){e[e.LAYER_TYPE_BOTTOM_FREE=1]="LAYER_TYPE_BOTTOM_FREE",e[e.LAYER_TYPE_FULL_SCREEN_UI=2]="LAYER_TYPE_FULL_SCREEN_UI",e[e.LAYER_TYPE_FIXED_UI=3]="LAYER_TYPE_FIXED_UI",e[e.LAYER_TYPE_FLOATING_UI=4]="LAYER_TYPE_FLOATING_UI",e[e.LAYER_TYPE_FLOATING_CHILD_UI=5]="LAYER_TYPE_FLOATING_CHILD_UI",e[e.LAYER_TYPE_TOP_FREE=6]="LAYER_TYPE_TOP_FREE",e[e.LAYER_TYPE_TOP_MODAL=7]="LAYER_TYPE_TOP_MODAL",e[e.LAYER_TYPE_TOP=8]="LAYER_TYPE_TOP",e[e.LAYER_TYPE_MAX=22]="LAYER_TYPE_MAX"}(t=e.UILayerType||(e.UILayerType={}));var i;!function(e){e[e.LAYER_TYPE_BOTTOM_FREE=1e3]="LAYER_TYPE_BOTTOM_FREE",e[e.LAYER_TYPE_FULL_SCREEN_UI=2e3]="LAYER_TYPE_FULL_SCREEN_UI",e[e.LAYER_TYPE_FIXED_UI=3e3]="LAYER_TYPE_FIXED_UI",e[e.LAYER_TYPE_FLOATING_UI=4e3]="LAYER_TYPE_FLOATING_UI",e[e.LAYER_TYPE_FLOATING_CHILD_UI=5e3]="LAYER_TYPE_FLOATING_CHILD_UI",e[e.LAYER_TYPE_TOP_FREE=6e3]="LAYER_TYPE_TOP_FREE",e[e.LAYER_TYPE_TOP_MODAL=7e3]="LAYER_TYPE_TOP_MODAL",e[e.LAYER_TYPE_TOP=8e3]="LAYER_TYPE_TOP",e[e.LAYER_TYPE_MAX=22e3]="LAYER_TYPE_MAX"}(i=e.UILayerDepth||(e.UILayerDepth={}));var n;!function(e){e[e.CANCEL=0]="CANCEL",e[e.SUCCESS=1]="SUCCESS",e[e.START=2]="START",e[e.ENTER=3]="ENTER"}(n=e.ShareStatus||(e.ShareStatus={}));var o;!function(e){}(o=e.MessageHeader||(e.MessageHeader={}));var a;!function(e){e[e.CLICK=1]="CLICK",e[e.SCROLL=2]="SCROLL",e[e.ZOOM=3]="ZOOM",e[e.AUTO_ZOOM=4]="AUTO_ZOOM",e[e.AUTO_SCROLL=5]="AUTO_SCROLL"}(a=e.MapTouchType||(e.MapTouchType={}));var s;!function(e){e[e.SELF=1]="SELF",e[e.GUIDE=2]="GUIDE",e[e.TASK=3]="TASK",e[e.PLACE_MONSTER=4]="PLACE_MONSTER"}(s=e.TouchLimitType||(e.TouchLimitType={}));var r;!function(e){e[e.SELF_PLAYER=1]="SELF_PLAYER",e[e.SELF_BUILDING=2]="SELF_BUILDING",e[e.FRIEND_BUILDING=3]="FRIEND_BUILDING",e[e.STORY=3]="STORY",e[e.QUEST=4]="QUEST",e[e.FRIEND_QUEST=5]="FRIEND_QUEST",e[e.TOPIC=6]="TOPIC"}(r=e.ModelType||(e.ModelType={}));var l;!function(e){e[e.REMOVE=-2]="REMOVE",e[e.FREE=0]="FREE",e[e.TRAIN=3]="TRAIN",e[e.TREAT=4]="TREAT",e[e.BUILD_TRAP=5]="BUILD_TRAP",e[e.RESEARCH=6]="RESEARCH",e[e.BUILD=7]="BUILD",e[e.FORGE=8]="FORGE"}(l=e.HomeBuildingStatus||(e.HomeBuildingStatus={}));var _;!function(e){e[e.NORMAL=1]="NORMAL",e[e.FOCUS=2]="FOCUS",e[e.JUMP=3]="JUMP",e[e.JUMP_GUIDE=4]="JUMP_GUIDE",e[e.JUMP_FORCE_GUIDE=5]="JUMP_FORCE_GUIDE",e[e.FOLLOW=6]="FOLLOW"}(_=e.MoveType||(e.MoveType={}));var h;!function(e){e[e.SelfHomeMap=-2]="SelfHomeMap",e[e.FriendHomeMap=-3]="FriendHomeMap"}(h=e.MapType||(e.MapType={}));var c;!function(e){e[e.StageMap=1]="StageMap",e[e.HomeMap=2]="HomeMap",e[e.SevernMap=3]="SevernMap"}(c=e.MainStageType||(e.MainStageType={}));var d;!function(e){e[e.Main=1]="Main",e[e.Side_Mission_1=2]="Side_Mission_1"}(d=e.EnterLinkType||(e.EnterLinkType={}));var p;!function(e){e[e.VOID=0]="VOID",e[e.BOUNCE=1]="BOUNCE"}(p=e.MapClickAction||(e.MapClickAction={}))}(xyd||(xyd={}));var xyd;!function(e){var t=function(){function e(){}return e.OPEN_STAGE_WIN="__event_open_stage_win__",e.GAME_START="__event_game_start__",e.GAME_END="__event_game_end__",e.GAME_PRE_END="__event_game_pre_end__",e.GAME_RESUME="__event_game_resume__",e.GAME_WITHDRAW="__event_game_withdraw__",e.WINDOW_DISPLAY_INIT_STATUS="__event_window_display_init_status__",e.WINDOW_WILL_OPEN="__event_window_will_open__",e.WINDOW_DID_OPEN="__event_window_did_open__",e.WINDOW_WILL_CLOSE="__event_window_will_close__",e.WINDOW_DID_CLOSE="__event_window_did_close__",e.WINDOW_GAME_EXIT_START="__event_window_game_exit_start__",e.BOARD_INIT_DONE="__event_board_init_done__",e.BOARD_ADD_BASE="__event_board_add_element_base__",e.BOARD_ADD_ELEMENT="__event_board_add_element__",e.BOARD_REMOVE_ELEMENT="__event_board_remove_element__",e.BOARD_ACTIVE_ELEMENT="__event_board_active_element__",e.BOARD_REMOVE_EMPTY_CELL="__event_board_remove_empty_cell__",e.BOARD_REMOVE_ELEMENT_ANIMATION_BEGIN="__event_board_remove_element_animation_begin__",e.BOARD_REMOVE_ANIMATION_ELEMENT="__event_board_remove_element_animation__",e.BOARD_REMOVE_ANIMATION_ELEMENT_BY_PUZZLE="__event_board_remove_element_animation_by_puzzle__",e.BOARD_REMOVE_ANIMATION_SPECIAL="__event_board_remove_element_sepcial__",e.BOARD_REMOVE_ANIMATION_ROCKET="__event_board_remove_element_rocket__",e.BOARD_REPLACE_ELEMENT="event_board_replace_element__",e.BOARD_HAS_MATCHED="__event_board_has_matched__",e.BOARD_ENTER_ELEMENT="__event_board_enter_element__",e.BOARD_SWITCH_MADE="__event_board_switch_made__",e.BOARD_SPECIAL_SWITCH_MADE="__event_board_special_switch_made__",e.BOARD_SIZE="__event_board_size__",e.BOARD_STABLE="__event_board_stable__",e.BOARD_UNSTABLE="__event_board_unstable__",e.BOARD_ADD_BLOCKER="__event_board_add_blocker__",e.BOARD_ADD_EDGES="__evebt_board_add_edges__",e.BOARD_REMOVE_BLOCKER="__event_board_remove_blocker__",e.BOARD_HIDE_BLOCKER="__event_board_hide_blocker__",e.BOARD_ADD_LEAF="__event_board_add_leaf__",e.BOARD_REMOVE_LEAF="__event_board_remove_leaf___",e.BOARD_REPLACE_LEAF="__event_board_replace_leaf__",e.BOARD_REPLACE_BLOCK="__event_board_replace_block__",e.BOARD_ADD_LOCK="__event_board_add_lock__",e.BOARD_REMOVE_LOCK="__event_board_remove_lock__",e.BOARD_REPLACE_LOCK="__event_board_replace_lock__",e.BOARD_LEAVE_BOARD="__event_board_LEAVE_BOARD__",e.BOARD_TARGET="__event_board_target__",e.BOARD_ADD_PORTAL="__event_board_add_portal__",e.BOARD_ENTER_PORTAL="__event_enter_portal__",e.BOARD_EXIT_PORTAL="__event_exit_portal__",e.BOARD_ELEMENT_REACH_END="__event_board_element_reach_end__",e.BOARD_SET_BELT_STATE="__event_board_set_belt_state__",e.BOARD_SHOW_POSSIBLE_MOVE="__event_board_show_possible_move__",e.BOARD_LEAF_LIGHT="__event_board_leaf_light__",e.BOARD_UPDATE_LAMP_TARGET="__event_update_lamp_target__",e.BOARD_REMOVE_BOX="__event_board_remove_box__",e.BOARD_ADD_GENERATOR="__event_board_add_generator__",e.BOARD_USE_HAMMER_HINT="__event_board_use_hammer_hint__",e.BOARD_USE_WAND_HINT="__event_board_use_wand_hint__",e.BOARD_RELEASE_ITEM_HINT_ANIMATION="__event_board_release_item_hint_animation__",e.BOARD_RELEASE_ITEM_GRID_HINT_ANIMATION="__event_board_release_item_grid_hint_animation__",e.BOARD_ADD_PUZZLE="__event_board_add_puzzle__",e.BOARD_REMOVE_PUZZLE="__event_board_remove_puzzle__",e.BOARD_REMOVE_PUZZLE_COMPLETE="__event_board_remove_puzzle_complete__",e.BOARD_ADD_BELT_PORTAL="__event_board_add_belt_portal__",e.BOARD_ADD_BELT_CELL="__event_board_add_belt_cell__",e.BOARD_REPLACE_ROCKET="__event_board_replace_rocket__",e.BOARD_TRIGGER_ELEMENT_OR_BLOCKER="__event_board_trigger_element_or_blocker__",e.ROCKET_LAUNCH="__event_rocket_launch__",e.ROCKET_COVERED_BY_CLOUD="__event_rocket_covered_by_cloud__",e.ROCKT_RECOVER_FROM_CLOUD="__event_rocket_recover_from_cloud__",e.BOARD_STEP="__event_board_step__",e.BOARD_SCORE="__event_board_score__",e.BOARD_SCORE_TARGET="__event_board_score_target__",e.BOARD_STAGE="__event_board_stage__",e.BOARD_SHUFFLE="__event_board_shuffle__",e.BOARD_SHUFFLE_TIPS="__event_board_shuffle_tips__",e.ELEMENT_SLIDE_TO="__event_element_slide_to_",e.PUT_OFF_CLOUD="__event_put_off_cloud__",e.BOARD_ENTER="__event_board_enter__",e.BOARD_ENTER_COMPELETE="__event_board_enter_compelete__",e.BOARD_FAKE_ELEMENT_PORTAL="__event_board_fake_element_portal__",e.UPDATE_TIME_BOMB="__update_time_bomb__",e.TIME_BOMB_EXPLODE="__time_bomb_explode__",e.UPDATE_SNOW="__update_snow__",e.COLORMIXER_LAUNCH="__event_colormixer_launch__",e.COLORMIXER_ADD_COLOR="__event_colormixer_add_color__",e.BOARD_PREPARE_REMOVE_COLORMIXER="__event_board_prepare_remove_colormixer__",e.FAN_BLOCKER_LAUNCH="__event_fan_blocker_launch__",e.SHOW_SKIP_BTN="__event_show_skip_button__",e.CLICK_SKIP_BTN="__event_click_skip_button__",e.CLICK_EXIT_BTN="__event_click_exit_button__",e.JS_SOUND_POOL_INITED="__event_js_sound_pool_inited__",e.GAME_VIEW_SET_STAGE="__event_game_view_set_stage__",e.BOARD_COLLECT_COIN="__event_board_collect_coin__",e.BOARD_REMOVE_COIN="__event_board_remove_coin__",e.BOARD_ADD_COIN="__event_board_add_coin__",e.DP_SOUND_NORMAL="__event_dp_normal__",e.DP_LINE="__event_dp_line__",e.DP_BOMB="__event_dp_bomb__",e.DP_COLOR_INIT="__event_dp_color_init__",e.DP_COLOR_BEGIN="__event_dp_color_begin__",e.DP_COLOR_THUNDER="__event_dp_thunder__",e.DP_COLOR_TARGET_START="__event_dp_color_target_start__",e.DP_COLOR_COLOR_TARGET="__event_dp_color_color_target__",e.DP_COLOR_COLOR_INIT="__event_dp_color_color_init__",e.DP_COLOR_COLOR_INIT_EFFECT="__event_dp_color_color_init_effect__",e.DP_COLOR_COLOR_INIT_EXPLOSION="__event_dp_color_color_init_explosion__",e.DP_COLOR_COLOR_END="__event_dp_color_color_end__",e.DP_COLOR_TARGET_END="__event_dp_color_target_end__",e.DP_COLOR_END="__event_dp_color_end__",e.DP_COL_ROW_THREE="__event_dp_col_row_three__",e.SHAKE_BOARD="_event_shake_board__",e.CREATE_SPECIAL="__event_create_special__",e.BONUS_TIME="__event_bonus_time__",e.CLOUD_MAKER="__event_cloud_maker__",e.BONUS_TIME_START="__event_bonus_time_start__",e.TORNADO_SWING="__event_tornado_swing__",e.BLACK_HOLE_EFFECT="__event_black_hole_effect__",e.BLACK_HOLE_CHANGE_EFFECT="__event_black_hole_change_effect__",e.CRAYON_EFFECT="__event_crayon_effect__",e.CRAYON_INIT_EFFECT="__event_crayon_init_effect__",e.CRAYON_CHANGE_EFFECT="__event_crayon_change_effect__",e.MATCH_COMBO_EFFECT="__event_matach_combo_effect__",e.ACTIVATE_WAND_EFFECT="__event_activate_wand_effect__",e.WAND_INIT_EFFECT="__event_wand_init_effect__",e.WAND_DISAPPEAR_EFFECT="__event_wand_effect__",e.BELT_ELEMENT_MOVE="__event_belt_element_move__",e.ROCKET_CHECK_TARGET="__event_rocket_check_target__",e.ROCKET_CHECK_TARGET_SUCCESS="__event_rocket_check_target_success__",e.ROCKET_CHECK_TARGET_FINISH="__event_rocket_check_target_finish__",e.ANNA_HEAD_STATE="__event_anna_head_state__",e.UPDATE_FPS="__event_update_fps__",e.EFFECT_PRESSURE_TEST="__event_effect_pressure_test",e.CHECK_HOME_GUIDE="__event_check_home_guide__",e.IN_HOME_GUIDE="__event_in_home_guide__",e.TAP_HOME_GUIDE_TARGET="__event_tap_home_guide_target__",e.OPERATE_HOME_GUIDE="__event_operate_home_guide__",e.HANDLE_MAP_SCROLL="__event_handle_map_scroll__",e.HANDLE_MAP_CLICK="__event_handle_map_click__",e.HANDLE_MAP_ZOOM="__event_handle_map_zoom__",e.HANDLE_MAP_AUTO_ZOOM="__event_handle_map_auto_zoom__",e.HANDLE_UI_CLICK="__event_handle_ui_click__",e.CHANGE_MAP="__event_change_map__",e.ON_MAP_CHANGE_END="__event_on_map_change_end__",e.HANDLE_MAP_COLLECTION="__event_handle_map_collection__",e.MAP_UPDATE_POSITION="__event_map_update_position__",e.ON_APP_PAUSE="__event_on_app_pause__",e.HANDLE_MAP_SCROLL_END="__event_handle_map_scroll_end__",e.ON_MOUSE_WHEEL_SCROLL="__event_on_mouse_wheel_scroll__",e.HANDLE_LONG_PRESS_BEGIN="__event_handle_long_press_begin__",e.HANDLE_LONG_PRESS_END="__event_handle_long_press_end__",e.MAP_ACTION="__event_map_action__",e.MAP_ACTION_TIME_LINE="__event_map_action_time_line__",e.QUEST_CALL_ACTION="__event_quest_call_action__",e.QUEST_ACTION_RESUME="__event_quest_action_resume__",e.QUEST_ACTION_SKIP="__event_quest_action_skip__",e.QUEST_STORY_SKIP="__event_quest_story_skip__",e.QUEST_DIALOG="__event_quest_dialog__",e.OTHER_CHAR_QUEST_DIALOG="__event_other_char_quest_dialog__",e.CLOSE_NEW_QUEST="__event_close_new_quest__",e.MAP_ACTION_COMPLETE="__event_map_action_complete__",e.SET_MOVE_ACTION="__event_set_move_action__",e.ANIMAION_COMPELETE="__event_animation_compelete__",e.WAITING_ANIMAION="__event_waiting_animation__",e.REPAIR_CHANGE_TIME="__event_repair_change_time__",e.UPDATE_TEXT_POS="__event_update_text_pos__",e.SHOW_BOUND="__show_bound__",e.SHOW_ORDER="__show_order__",e.SHOW_PARTICLE="__show_particle__",e.MAP_DEBUG_COMPONENT_SHOW="__map_debug_component_show__",e.REMOVE_GM_DISPLAY="__remove_gm_display__",e.SET_TOUCH_LIMITS="__set_touch_limits__",e.ADD_PROGRESS_RING="__add_progress_ring__",e.INIT_HOME_MAP="__init_home_map__",e.BUILDING_INFOS="__building_infos__",e.CREATE_BUILDING="__create_building__",e.BUILDING_CHANGE_DRESS_VIEW="__event_building_change_dress_view__",e.BUILDING_CHANGE_DRESS_MODEL="__event_building_change_dress_model__",e.UPDATE_CHANGE_DRESS_UI="__event_update_change_dress_ui__",e.UPDATE_BUILDING_BY_GROUP_ID="__event_update_building_by_group_id__",e.QUEST_CHANGE_BUILDING_START="__event_map_change_building_start__",e.QUEST_CHANGE_BUILDING_COMFIRM="__event_map_change_building_comfirm__",e.QUEST_CHANGE_BUILDING="__event_quest_change_building__",e.POPUP_CHAGNE_BUILDING_COMPONENT="__event_popup_change_building_component__",e.QUEST_REPAIR_BUILDING_START="__event_quest_repair_building_start__",e.QUEST_REPAIR_BUILDING_COMPLETE="__event_quest_repair_building_complete__",e.NAVIGATE_BY_BUILDING_GROUPID="__event_navigate_by_building_groupid__",e.SET_BUILDING_POS="__event_set_building_pos__",e.CHANGE_REQUEST_STATE="__event_change_request_state__",e.PLAY_STORY_FINISHED="__event_play_story_finished__",e.SHOW_STORY="__event_show_story__",e.HIDE_STORY="__event_hide_story__",e.SHOW_QUEST_ICON="__show_quest_icon__",e.NEXT_STORY="__event_next_story__",e.HIDE_AND_REMOVE_TOUCH="__event_hide_and_remove_touch__",e.SHOW_AND_ENABLE_TOUCH="__event_show_and_enable_touch__",e.REMOVE_QUEST_VIEW="__event_remove_quest_view__",e.ACTIVE_QUEST_VIEW="__event_active_quest_view__",e.CHECK_QUEST_REWARD="__event_check_quest_reward__",e.CHECK_UI_DISPLAY="__event_check_ui_display__",e.CHECK_SHOW_QUEST_TIP="__check_show_quest_tip__",e.HIDE_ICON="__event_hide_icon__",e.CAMERA_ZOOM_MIN_OR_MAX="__event_camera_zoom_min_or_max__",e.CAMERA_POS="__event_camera_pos__",e.SHOW_TOPIC_PHOTO="__event_show_topic_photo__",e.SET_QUEST_BUBBLE="__event_set_quest_bubble__",e.SET_BUBBLE_VISIBLE="__event_set_bubble_visible__",e.REMOVE_QUEST_BUBBLE="__event_remove_quest_bubble__",e.SET_TIMER_RING_VISIBLE="__event_set_timer_ring_visible__",e.SET_TIMER_RING="__event_set_timer_ring__",e.REMOVE_TIMER_RING="__event_remove_timer_ring__",e.H5_IN_GAME_WINDOW="__event_h5_in_game_window__",e.ITEM_SPECIAL_SWITCH_MADE="__event_item_special_switch_made__",e}();e.event=t,__reflect(t.prototype,"xyd.event")}(xyd||(xyd={}));var xyd;!function(e){var t=function(e){function t(t){return void 0===t&&(t=null),e.call(this)||this}return __extends(t,e),t.outer=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.inner=function(){return null==t.INNER_INSTANCE&&(t.INNER_INSTANCE=new t),t.INNER_INSTANCE},t.loader=function(){return null==t.LOADER_INSTANCE&&(t.LOADER_INSTANCE=new t),t.LOADER_INSTANCE},t.INSTANCE=null,t.INNER_INSTANCE=null,t.LOADER_INSTANCE=null,t}(egret.EventDispatcher);e.EventDispatcher=t,__reflect(t.prototype,"xyd.EventDispatcher")}(xyd||(xyd={}));var EventProxy=function(){function e(e,t,i){this.eventDispatcher_=e,this.listenerObj_=t,this.handles_=new Array}return e.prototype.addEventListener=function(e,t,i){this.eventDispatcher_.addEventListener(e,t,i||this.listenerObj_);var n=this.handles_.length;return this.handles_[n]=[e,t,i||this.listenerObj_],n},e.prototype.removeEventListenerByName=function(e){for(var t=0;t<this.handles_.length;t++){var i=this.handles_[t];if(i&&i[0]==e){this.eventDispatcher_.removeEventListener(i[0],i[1],i[2]),this.handles_[t]=null;break}}},e.prototype.removeEventListener=function(e){var t=this.handles_[e];t&&(this.eventDispatcher_.removeEventListener(t[0],t[1],t[2]),this.handles_[e]=null)},e.prototype.removeAllSelfEventListenersForEvent=function(e){for(var t=0;t<this.handles_.length;t++){var i=this.handles_[t];i&&i[0]==e&&(this.eventDispatcher_.removeEventListener(i[0],i[1],i[2]),this.handles_[t]=null)}},e.prototype.getEventHandle=function(e){for(var t=0;t<this.handles_.length;t++){var i=this.handles_[t];if(i&&i[0]==e)return t}return-1},e.prototype.removeAllEventListeners=function(){for(var e=0;e<this.handles_.length;e++){var t=this.handles_[e];t&&this.eventDispatcher_.removeEventListener(t[0],t[1],t[2])}this.handles_=new Array},e}();__reflect(EventProxy.prototype,"EventProxy");var GameTimer=function(e){function t(){var t=e.call(this)||this;return t.running_=!1,t.updateBehaviours_=[],t.running_=!1,t.Reset(),t}return __extends(t,e),t.get=function(){return void 0==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.Reset=function(){if(this.running_&&this.Stop(),this.updateBehaviours_&&this.updateBehaviours_.length>0)for(var e=0,t=this.updateBehaviours_;e<t.length;e++){var i=t[e];i&&i.onClean&&i.onClean()}this.updateBehaviours_=[]},t.prototype.Start=function(){this.running_=!0,this.lastTimeStamp_=Date.now(),this.addEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},t.prototype.Stop=function(){this.running_=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},t.prototype.Pause=function(){this.running_=!1},t.prototype.Resume=function(){this.running_=!0},t.prototype.registerBehaviour=function(e){e&&e.onUpdate&&this.updateBehaviours_.push(e)},t.prototype.unregisterBehaviour=function(e){if(this.updateBehaviours_&&0!=this.updateBehaviours_.length)for(var t=0;t<this.updateBehaviours_.length;t++){var i=this.updateBehaviours_[t];if(e==i){this.updateBehaviours_.splice(t,1);break}}},t.prototype.onUpdate=function(){if(this.lastTimeStamp_=Date.now(),this.running_)for(var e=0,t=this.updateBehaviours_;e<t.length;e++){var i=t[e];i&&i.onUpdate&&i.onUpdate()}},t}(egret.DisplayObject);__reflect(GameTimer.prototype,"GameTimer");var xyd;!function(e){var t=function(){function t(){}return t.init=function(){t.reset()},t.reset=function(){t.serverDeltaTime=-1,t.mouseFocusHashCode=null;var i="100001a1";t.playerName=e.__(i);var n="100001a10";t.catName=e.__(n)},t.getBrowserLanguage=function(){var e=navigator.language.toLowerCase();return e.indexOf("zh")>-1?"zh_tw":"en_us"},t.playerName="安娜",t.lang="zh_cn",t.backendurl="",t.version="0.0.1",t}();e.Global=t,__reflect(t.prototype,"xyd.Global")}(xyd||(xyd={}));var LayerManager=function(){function e(){}return e.get=function(){return e.INSTANCE||(e.INSTANCE=new e),e.INSTANCE},e.prototype.setSceneLayer=function(e){this.sceneLayer_=e},e.prototype.setUILayer=function(e){this.uiLayer_=e},e.prototype.getSceneLayer=function(){return this.sceneLayer_},e.prototype.getUILayer=function(){return this.uiLayer_},e.prototype.setMainLayer=function(e){this.mainLayer_=e},e.prototype.getMainLayer=function(){return this.mainLayer_},e.prototype.clear=function(){this.sceneLayer_.removeChildren(),this.uiLayer_.removeChildren(),this.mainLayer_.removeChildren()},e}();__reflect(LayerManager.prototype,"LayerManager");var RandomHandler=function(){function e(e){void 0==e||0==e?this._randomSeed=xyd.random(1,23e4):this._randomSeed=e,console.log("RandomSeed: ",this._randomSeed),SelfInfo.get().addOperationLog("RandomSeed: "+this._randomSeed)}return e.prototype.next=function(e,t){t=t||0,e=e||0,this._randomSeed=(9301*this._randomSeed+49297)%233280;var i=this._randomSeed/233280;return e+i*(t-e+.999999999)},e.prototype.nextInt=function(e,t){return Math.floor(this.next(e,t))},e.prototype.nextDouble=function(){return this._randomSeed=(9301*this._randomSeed+49297)%233280,this._randomSeed/233280},e.prototype.getSeed=function(){return this._randomSeed},e}();__reflect(RandomHandler.prototype,"RandomHandler");var SceneConsts;!function(e){e[e.Game=1]="Game",e[e.UI=2]="UI",e[e.LOADING=3]="LOADING"}(SceneConsts||(SceneConsts={}));var SelfInfo=function(){function e(){this.letterCompleted=!1,this.mapInitCompleted=!1,this._currentLevel=1,this._enterHomeMapLevel=1,this._gems=0,this._stamina=0,this._clearStreak=0,this._records={},this._items={},this._soundBg=!0,this._soundEffect=!0,this._strongReminder=!0,this._operationLog="",this._shouldOpenGatherTaskWin=!1,this.showMonthCardGuide=!1,this.showLuckyWheel=!1,this._star=0,this._petIndex=0,this._catName="",this._serverTime=-1,this._timeDiff=0,this._isBanlist=!1,this._isSafe=!0,this._shareInfo={},this._uid="",this._firstWinLevel=!1,this.lastGameChooseItems=[!1,!1,!1,!1],this.lastGameLevel=0,this._skipPreWindow=!1,this.isFirstStreak=!1,this.newUserBenefitsItemID=0,this.isVip=!1,this.vipExtraStep=0,this.isInMission=!1,this.missionID=0,this.missionLevel=0,this.missionItemLock=!1,this.enterLinkType=xyd.EnterLinkType.Main}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.prototype.initSelf=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._syncGameInfo(e),[2]})})},e.prototype.syncData=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,platform.callMethod("GET_GAME_INFO",{}).then(function(t){e._syncGameInfo(t)})]})})},e.prototype.requestMapData=function(e,t){var i=this;return t=Math.min(t+20,xyd.MAX_STAGE),new Promise(function(n,o){for(var a=!1,s=e;t>s;s++)if(void 0==i._records[s]){a=!0;break}a?platform.callMethod("GET_GAME_RECORDS",{start:e,end:t}).then(function(e){i._syncGameRecords(e),n()})["catch"](function(e){console.log(e),o(e)}):n()})},e.prototype.setExtraData=function(e){e.avatar&&""!=e.avatar&&(this._avatar=e.avatar),e.nickname&&""!=e.nickname&&(this._nickname=e.nickname,xyd.Global.playerName=e.nickname),e.share_info&&(this._shareInfo=e.share_info),void 0!=e.uid&&(this._uid=e.uid)},e.prototype.getAvatar=function(){return this._avatar},e.prototype.getNickname=function(){return this._nickname},e.prototype.getShareInfoWithKey=function(e){return void 0==this._shareInfo?!0:void 0==this._shareInfo[e]?!0:0==this._shareInfo[e]?!1:!0},e.prototype._syncGameInfo=function(e){if(void 0!=e){if(1==e.is_banlist&&(this._isBanlist=!0),0==e.is_safe&&(this._isSafe=!1),e.gems&&(this._gems=e.gems),e.current_level&&(console.log("_syncGameInfo"),console.log(e.current_level),this._currentLevel=Math.min(e.current_level,xyd.MAX_STAGE)),e.monthly_card_level&&(this._monthlyCardLevel=e.monthly_card_level,void 0==this.lastMonthlyCardLevel&&(this.lastMonthlyCardLevel=this._monthlyCardLevel)),e.enter_home_map_level&&(this._enterHomeMapLevel=e.enter_home_map_level),void 0!=e.is_vip&&(this.isVip=e.is_vip),e.vip_extra_step&&(this.vipExtraStep=e.vip_extra_step),e.stamina&&(this._stamina=e.stamina),e.clear_streak?this.setClearStreak(e.clear_streak):this.setClearStreak(0),e.records)for(var t=0,i=e.records;t<i.length;t++){var n=i[t];n.level&&(this._records[n.level]=n)}e.items&&this._syncItem(e),e.gather_task&&(this._gatherTaskInfo=e.gather_task),e.enter_link_type&&(this.enterLinkType=e.enter_link_type),e.clear_stage_info?this.clearStagetInfo=e.clear_stage_info:this.clearStagetInfo=void 0,void 0!=e.red_packet_cash_amount&&(this.cashAmount=e.red_packet_cash_amount)}},e.prototype._syncGameRecords=function(e){if(e.records){for(var t=0,i=e.records;t<i.length;t++){var n=i[t];if(n.level){void 0==this._records[n.level]&&(this._records[n.level]={});for(var o in n)this._records[n.level][o]=n[o]}}return!0}return!1},e.prototype._syncItem=function(e){this._items={};for(var t in e.items){var i=e.items[t];i.expire_time&&i.expire_time.length>0&&i.expire_time.sort(),this._items[t]={quantity:i.quantity,expire_time:i.expire_time}}var n=ItemTable.get().getTableData();for(var t in n){var o=t;void 0==this._items[o]&&(this._items[o]={quantity:0,expire_time:void 0})}},e.prototype.getItems=function(){return this._items},e.prototype.getItemNumByID=function(e){var t=this._items[e];if(void 0!=t){var i=(t.quantity,t.expire_time);if(i&&i.length>0){for(var n=[],o=Math.ceil((new Date).getTime()/1e3),a=0;a<i.length;a++)i[a]>o&&n.push(i[a]);n.length>0?(n.sort(),t.expire_time=n,t.quantity=n.length):(t.quantity=0,t.expire_time=void 0)}return t.quantity}return 0},e.prototype.getItemExpireTimeByID=function(e){var t=this._items[e];if(void 0!=t&&t.quantity>0){var i=t.expire_time;if(i&&i.length>0)return i[0]}return-1},e.prototype.useItemNumByID=function(e){var t=this,i=String(Number(e)+ItemConstants.LIMITED_TIME_OFFSET),n=String(Number(e)+ItemConstants.UNLIMITED_TIME_OFFSET),o=this.getItemNumByID(i),a=this.getItemNumByID(n);if(a>0?e=n:o>0&&(e=i),e!=n){var s=this._items[e];s&&s.quantity>0&&(this._items[e].quantity-=1,s.expire_time&&s.expire_time.length>0&&(s.expire_time.sort(),s.expire_time.splice(0,1)))}platform.callMethod("GAME_USE_ITEM",{itemID:e}).then(function(i){i.success&&(i.quantity<=0?delete t._items[e]:(i.expire_time&&i.expire_time.length>0&&i.expire_time.sort(),t._items[e].quantity=i.quantity,t._items[e].expire_time=i.expire_time))})["catch"](function(e){return logger.error(e)})},e.prototype.buyItemByID=function(e,t){var i=this,n={stage:t,prop_type:Number(e),act_type:"buy"};return logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,n,!0),platform.callMethod("GAME_BUY_ITEM",{itemID:e}).then(function(n){if(n.success&&n.items&&n.items.length>0)for(var o=0,a=n.items;o<a.length;o++){var s=a[o];s.expire_time&&s.expire_time.length>0&&s.expire_time.sort(),i._items[s.itemID]={quantity:s.quantity,expire_time:s.expire_time};var r={stage:t,prop_type:Number(e),act_type:"buy_success"};logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_ITEM_CLICK,r,!0)}return n.success})},e.prototype.getStageInfo=function(e){return this._records[e]?this._records[e]:{level:e,stars:0,score:0,packet_type:0,packet_status:0}},e.prototype.isFirstTenLevel=function(e){var t=this.getStageInfo(e);return t.pay_level&&void 0!=t.pay_level&&ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY)?!0:!1},e.prototype.isInFirstTenLevel=function(e){return 10>=e&&this._currentLevel<=10&&ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY)},e.prototype.getNextPayLevel=function(e){if(e>10)return 0;for(var t=1,i=e;10>=i;i++){var n=this.getStageInfo(i);if(n.pay_level&&void 0!=n.pay_level&&i>=this._currentLevel)return t;t++}return 0},e.prototype.setStageInfo=function(e,t,i,n){this._firstWinLevel=!1;var o=this._records[e],a=0;n&&(void 0==o?(o={level:e,stars:t,score:i},this._records[e]=o):(a=o.stars,o.stars=Math.max(o.stars,t),o.score=Math.max(o.score,i)),this._currentLevel==e&&(this._currentLevel+=1,this._firstWinLevel=!0))},e.prototype.isFirstWin=function(){return this._firstWinLevel},e.prototype.setPacketOpenable=function(e){if(this._records[e]){var t=this._records[e];t.packet_type>0&&(t.packet_status=1)}},e.prototype.getCurrentLevel=function(){return Math.min(this._currentLevel,xyd.MAX_STAGE)},Object.defineProperty(e.prototype,"monthlyCardLevel",{get:function(){return this._monthlyCardLevel},set:function(e){this._monthlyCardLevel=e},enumerable:!0,configurable:!0}),e.prototype.getGems=function(){return this._gems},e.prototype.setGems=function(e){this._gems=e},e.prototype.getStamina=function(){return this._stamina},e.prototype.setStamina=function(e){this._stamina=e},e.prototype.getClearStreak=function(){return this._clearStreak},e.prototype.setClearStreak=function(e){e=Math.max(0,e),this._clearStreak=e},e.prototype.setSoundBg=function(e){this._soundBg=e,platform.callMethod("SYNC_GAME_SETTING",{soundBg:this._soundBg,soundEfx:this._soundEffect})["catch"](function(e){return logger.error(e)})},e.prototype.setSoundEffect=function(e){this._soundEffect=e,platform.callMethod("SYNC_GAME_SETTING",{soundBg:this._soundBg,soundEfx:this._soundEffect})["catch"](function(e){return logger.error(e)})},e.prototype.setStrongReminder=function(e){return new Promise(function(t,i){platform.callMethod("SET_STRONG_REMINDER",{value:e}).then(function(e){t(e)})})},e.prototype.setStrongReminderLocal=function(e){this._strongReminder=e},e.prototype.getSoundBg=function(){return this._soundBg},e.prototype.getSoundEffect=function(){return this._soundEffect},e.prototype.getStrongReminder=function(){return this._strongReminder},e.prototype.syncSoundSetting=function(){var e=this;platform.callMethod("SYNC_GAME_SETTING",void 0).then(function(t){e._soundBg=t.soundBg,e._soundEffect=t.soundEfx,e._strongReminder=t.strongReminder,SoundManager.getInstance().setBgOn(e._soundBg),SoundManager.getInstance().setEffectOn(e._soundEffect)})["catch"](function(e){return logger.error(e)})},e.prototype.syncGameData=function(e){if(void 0!=e){if(this.updateItems(e),this.updateVip(e),this._syncGameRecords(e)){var t=xyd.WindowManager.get().getWindow("stage_window");t&&t.update(e.records)}void 0!=e.red_packet_cash_amount&&this.updateCashAmount(e)}},e.prototype.updateVip=function(e){void 0!=e.is_vip&&(this.isVip=e.is_vip),e.vip_extra_step&&(this.vipExtraStep=e.vip_extra_step)},e.prototype.updateItems=function(e){if(e.items)for(var t in e.items){var i=e.items[t];i.expire_time&&i.expire_time.length>0&&i.expire_time.sort(),this._items[t]={quantity:i.quantity,expire_time:i.expire_time}}},e.prototype.getGatherTaskInfo=function(){return this._gatherTaskInfo},e.prototype.setGatherTaskInfo=function(e){this._gatherTaskInfo=e},e.prototype.addOperationLog=function(e){this.operationLog+=e,this.operationLog+="\n"
},Object.defineProperty(e.prototype,"operationLog",{get:function(){return this._operationLog},set:function(e){this._operationLog=e},enumerable:!0,configurable:!0}),e.prototype.claimPacket=function(e){var t=this;return new Promise(function(i,n){if(void 0!=t._records[e]){var o=t._records[e];o.packet_type&&o.packet_type>0&&1==o.packet_status?platform.callMethod("GAME_SHARE",{type:"collect_map_packet",params:{level:e}}).then(function(e){e.success?(o.packet_status=2,i(!0)):i(!1)})["catch"](function(e){i(!1)}):i(!1)}else i(!1)})},e.prototype.resetLastGameChoose=function(){this.lastGameChooseItems=[!1,!1,!1,!1],this.lastGameLevel=0},Object.defineProperty(e.prototype,"shouldOpenGatherTaskWin",{get:function(){return this._shouldOpenGatherTaskWin},set:function(e){this._shouldOpenGatherTaskWin=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"star",{get:function(){return this._star},set:function(e){this._star=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"petIndex",{get:function(){return this._petIndex},set:function(e){this._petIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"catName",{get:function(){return this._catName},set:function(e){this._catName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverTime",{get:function(){return this._serverTime},set:function(e){this._serverTime>0||(this._serverTime=e,this._timeDiff=e-Math.ceil((new Date).getTime()/1e3))},enumerable:!0,configurable:!0}),e.prototype.getTime=function(){return Math.ceil((new Date).getTime()/1e3)+this._timeDiff},Object.defineProperty(e.prototype,"isBanlist",{get:function(){return this._isBanlist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSafe",{get:function(){return this._isSafe},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastPos",{get:function(){return this._lastPos},set:function(e){this._lastPos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastLayer",{get:function(){return this._lastLayer},set:function(e){this._lastLayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friendHomeListData",{get:function(){return this._friendHomeListData},set:function(e){this._friendHomeListData=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friendHomeListScrollV",{get:function(){return this._friendHomeListScrollV},set:function(e){this._friendHomeListScrollV=e},enumerable:!0,configurable:!0}),e.prototype.getUid=function(){return this._uid},e.prototype.getEnterHomeMapLevel=function(){return this._enterHomeMapLevel},e.prototype.clearMissionInfo=function(){this.isInMission=!1,this.missionID=0,this.missionLevel=0,this.missionItemLock=!1},e.prototype.setSkipPreWindow=function(e){this._skipPreWindow=e},e.prototype.checkSkipPreWindow=function(){return this._skipPreWindow},e.prototype.setCashAmount=function(e){this.cashAmount=e},e.prototype.getCashAmount=function(){return this.cashAmount},e.prototype.getCashOpen=function(){return!(void 0==this.cashAmount)},e.prototype.updateCashAmount=function(e){this.setCashAmount(e.red_packet_cash_amount);var t=xyd.WindowManager.get().getWindow("stage_window");t&&t.updateView()},e.INSTANCE=null,e}();__reflect(SelfInfo.prototype,"SelfInfo");var Time=function(){function e(){}return e.getHour=function(e){return Math.floor(e/xyd.HOUR)},e.getMinute=function(e){return Math.floor(e%xyd.HOUR/xyd.MINUTE)},e.getSecond=function(e){return Math.floor(e%xyd.MINUTE/xyd.SECOND)},e}();__reflect(Time.prototype,"Time");var xyd;!function(e){function t(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return(n=TranslationTable.get()).translate.apply(n,[e].concat(t))||e;var n}function i(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var a=e.__.apply(e,[i].concat(n));null!=a.match(/<font.*>/g)?t.textFlow=$.parse(a):t.text=a}function n(e){return $.parse(e)}function o(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return e.replace(/\{\d+\}/g,function(e){return t[parseInt(e.substring(1,e.length-1))-1]})}function a(e,t,i,n,o){var a=[0,0,0,0,t,0,0,0,0,i,0,0,0,0,n,0,0,0,o/255,0],s=new egret.ColorMatrixFilter(a);e.filters=[s]}function s(e,t,i){if(void 0===i&&(i=!1),void 0!=e){if(e=String(e),""==e)return[];if(e&&t){var n=[],o=e.split(t);for(var a in o){var s=o[a];i&&(s=Number(s)),n.push(s)}return n}}}function r(e){}function l(e,t){return t?void(e&&(e.source=t+"_png")):void console.log("sprite undefined")}function _(e,t,i){t+="_png",RES.getResAsync(t,function(n,o){n&&(e.source=t),i&&i(t,e)},this)}function h(e,t){RES.getResByUrl(t,function(t,i){t?e.texture=t:console.log("Cannot get resource from "+i)},this,RES.ResourceItem.TYPE_IMAGE)}function c(e,t,i){void 0===i&&(i=null),RES.getResAsync(t,function(n,o){n&&(e.texture=n),i&&i(t,e)},this)}function d(e,t,i){void 0===i&&(i=null),t+="_png",RES.getResAsync(t,function(n,o){n&&(e.texture=n),i&&i(t,e)},this)}function p(e,t,i){void 0===i&&(i=null),t+="_jpg",RES.getResAsync(t,function(n,o){n&&(e.texture=n),i&&i(t,e)},this)}function u(e,t){RES.getResByUrl(t,function(t,i){t?e.texture=t:console.log("Cannot get resource from "+i)},this,RES.ResourceItem.TYPE_IMAGE)}function m(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};return null==t?null==e?Math.random():i(1,e):i(e,t)}function g(t,i,n){var o=function(e,t){var i,n;t?(i=e,n=t):(i=0,n=e);for(var o=[],a=i;n>a;a++)o.push(a);return o},a=o(t,i);if(n>i-t)return a;for(var s=0,r=[];n>0;)s=e.random(0,i-t-1),r.push(a[s]),a.splice(s,1),n-=1,t+=1;return r}function f(t,i,n){i=Math.max(t+1,i);for(var o=[],a=t;i>=a;a+=1)o.push(a);for(var s=o.length,r=[],a=0;n>a;a+=1){var l=e.random(0,s-1);r.push(o[l]),o[l]=o[s-1],s-=1}return r}function y(e){if(null==e||e==1/0)return"";for(var t="";e>=1e3;)t=","+(e%1e3+1e3).toString().substr(1,3)+t,e=Math.floor(e/1e3);return e+t}function E(e){return null==e||e==1/0?"":e>=1e10?y(Math.floor(e/1e9))+"B":e>=1e7?y(Math.floor(e/1e6))+"M":e>=1e5?y(Math.floor(e/1e3))+"K":y(e)}function v(e,t){var i=t.x-e.x,n=t.y-e.y;return 360*Math.atan2(-n,i)/(2*Math.PI)}function T(e){if(!e)return null;var t={};for(var i in e)t[i]=e[i];return t}function C(e,t){for(var i,n,o=1;o<e.length;o++){for(i=e[o],n=o-1;n>=0&&t(e[n],i)>0;)e[n+1]=e[n],n-=1;e[n+1]=i}return e}function L(e,t,i){if(void 0==e||0==e.length)return 0;for(var n=0,o=e.length-1,a=0,s=1;o>=n;)a=n+Math.floor((o-n)/2),t(e[a])<i?(n=a+1,s=a+1):(s=a,o=a-1);return s}function b(e,t){return e.x-t.x}function w(e,t){return e.y-t.y}function S(t){var i=Math.floor(t/e.DAY),n=Math.floor(t%e.DAY/e.HOUR),o=Math.floor(t%e.HOUR/e.MINUTE),a=t%e.MINUTE,s="";return i>0&&(s=s+i+"天"),n>0&&(10>n&&(s+="0"),s=s+n+"时"),10>o&&(s+="0"),s=s+o+"分",10>a&&(s+="0"),s=s+a+"秒"}function O(t){var i=Math.floor(t/e.DAY),n=Math.floor(t%e.DAY/e.HOUR),o=Math.floor(t%e.HOUR/e.MINUTE),a=t%e.MINUTE,s="";return i>0&&(s=s+i+"天"),n>0?(10>n&&(s+="0"),s=s+n+":"):s+="00:",10>o&&(s+="0"),s=s+o+":",10>a&&(s+="0"),s+=a}function A(t){var i=(Math.floor(t/e.DAY),Math.floor(t%e.DAY/e.HOUR)),n=Math.floor(t%e.HOUR/e.MINUTE),o=t%e.MINUTE,a="";return i>0?(10>i&&(a+="0"),a=a+i+":"):a+="00:",10>n&&(a+="0"),a=a+n+":",10>o&&(a+="0"),a+=o}function x(t){var i=(Math.floor(t/e.DAY),Math.floor(t%e.DAY/e.HOUR)),n=Math.floor(t%e.HOUR/e.MINUTE),o=t%e.MINUTE,a="";return i>0&&(10>i&&(a+="0"),a=a+i+":"),10>n&&(a+="0"),a=a+n+":",10>o&&(a+="0"),a+=o}function I(e){return 180*e/Math.PI}function M(e){return e*Math.PI/180}function R(e,t,i){if(void 0!=e){for(var n in e.$children)e.$children[n].touchEnabled=!1;e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.scaleX*=1.1,e.scaleY*=1.1},t),e.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.scaleX/=1.1,e.scaleY/=1.1},t),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.scaleX/=1.1,e.scaleY/=1.1},t),i&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,i,t)}}function D(t,i){var n=new TimelineMax;i.push(n),n.add(TweenLite.to(t,11*e.TweenDeltaTime,{}),0),n.add(TweenLite.to(t,1*e.TweenDeltaTime,{scaleX:1.11,scaleY:.86,ease:Linear.easeNone}),11*e.TweenDeltaTime),n.add(TweenLite.to(t,1*e.TweenDeltaTime,{scaleX:.98,scaleY:1.08,ease:Linear.easeNone}),12*e.TweenDeltaTime),n.add(TweenLite.to(t,1*e.TweenDeltaTime,{scaleX:.89,scaleY:1.18,ease:Linear.easeNone}),13*e.TweenDeltaTime),n.add(TweenLite.to(t,1*e.TweenDeltaTime,{rotation:1,ease:Linear.easeNone}),14*e.TweenDeltaTime),n.add(TweenLite.to(t,2*e.TweenDeltaTime,{scaleX:1.13,scaleY:1.02,ease:Linear.easeNone}),15*e.TweenDeltaTime),n.add(TweenLite.to(t,2*e.TweenDeltaTime,{scaleX:1,scaleY:1,rotation:0,ease:Linear.easeNone}),17*e.TweenDeltaTime),n.addCallback(function(){n.clear(),n.add(TweenLite.to(t,13*e.TweenDeltaTime,{scaleX:.95,scaleY:1.05,ease:Linear.easeNone}),0),n.add(TweenLite.to(t,13*e.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),13*e.TweenDeltaTime),n.repeat(-1),n.play()},19*e.TweenDeltaTime)}function B(t,i,n){if(void 0!=t){for(var o in t.$children)t.$children[o].touchEnabled=!1;t.scaleX,t.scaleY;t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){SoundManager.getInstance().playEffect("se_button_mp3"),t.filters=[e.darkFilter],t.y=t.y+2},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.filters=[],t.y=t.y-2},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.filters=[],t.y=t.y-2},i),n&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,n,i)}}function N(t,i,n){if(void 0!=t){for(var o in t.$children)t.$children[o].touchEnabled=!1;var a=.9,s=1.1,r=t.scaleX,l=t.scaleY;t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){SoundManager.getInstance().playEffect("se_button_mp3"),t.filters=[e.darkFilter],t.scaleX=r*a,t.scaleY=l*a},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.filters=[],t.y=t.y;var i=new TimelineLite;i.add(TweenLite.to(t,3*e.TweenDeltaTime,{scaleX:r*s,scaleY:l*s})),i.add(TweenLite.to(t,6*e.TweenDeltaTime,{scaleX:r,scaleY:l}))},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.filters=[],t.y=t.y;var i=new TimelineLite;i.add(TweenLite.to(t,1*e.TweenDeltaTime,{scaleX:r*a,scaleY:l*a})),i.add(TweenLite.to(t,3*e.TweenDeltaTime,{scaleX:r*s,scaleY:l*s})),i.add(TweenLite.to(t,6*e.TweenDeltaTime,{scaleX:r,scaleY:l}))},i),n&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,n,i)}}function P(t,i,n){if(void 0!=t){for(var o in t.$children)t.$children[o].touchEnabled=!1;var a=new TimelineMax({repeat:-1,yoyo:!0});a.add(TweenLite.to(t,.5,{scaleX:1.1,scaleY:1.1}),0),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){SoundManager.getInstance().playEffect("se_button_mp3"),t.filters=[e.darkFilter]},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.filters=[]},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.filters=[]},i),n&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,n,i)}}function k(t,i,n,o,a,s,r,l){if(t){if(t.breath?e.setBreathBtnBehavior(i,r,l):e.setDarkenBtnBehavior(i,r,l),t.color)switch(t.color){case"green":o.source="btn_luchang_png",n.strokeColor=3046665;break;case"yellow":o.source="btn_huangchang_1_png",n.strokeColor=12740615;break;case"pink":o.source="btn_fenchang_png",n.strokeColor=12389463}t.text&&""!=t.text&&(n.text=t.text),t.bubble&&(a.visible=!0),t.bubble_text&&""!=t.bubble_text&&(s.text=t.bubble_text)}else e.setDarkenBtnBehavior(i,r,l)}function G(e){var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],i=new egret.ColorMatrixFilter(t);e.filters=[i]}function F(e){e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2}function H(e,t,i,n,o){void 0===e&&(e=""),void 0===t&&(t=36),void 0===i&&(i=!1),void 0===n&&(n=0),void 0===o&&(o="left");var a=new eui.Label(e);return a.size=t,a.bold=i,a.textColor=n,a.textAlign=o,a.fontFamily="Microsoft YaHei",a}function W(e,t){var i=new eui.Group;return i.width=e.width+2*t,i.height=e.height+2*t,e.x=t+e.anchorOffsetX,e.y=t+e.anchorOffsetY,i.addChild(e),i}function U(e){var t="";return t=e.split("\\x").join("%"),decodeURIComponent(t)}function Y(e,t){e=e.split("."),t=t.split(".");for(var i=Math.max(e.length,t.length);e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(var n=0;i>n;n++){var o=parseInt(e[n]),a=parseInt(t[n]);if(o>a)return 1;if(a>o)return-1}return 0}function V(t,i){return-e.getAngle(t,i)+90}function K(){return StageUtils.getInstance().getHeight()}function X(){return StageUtils.getInstance().getWidth()}function j(e,t){for(var i=e.length-1;i>0;i--){var n=Math.floor(t()*(i+1)),o=e[i];e[i]=e[n],e[n]=o}}function z(e,t){return null==e||null==t?void Log.trace("error no time!!!!!"):e>=t}function q(){return Mathf.Round(e.Global.serverDeltaTime+Date.now()/1e3)}function Q(t){return t?e.Global.mouseFocusHashCode==t.hashCode:!1}function J(t){t?e.Global.mouseFocusHashCode=t.hashCode:e.Global.mouseFocusHashCode=null}function Z(e){var t=Math.floor(e/100);e%100==0&&t--;return RES.getResAsync("level_infos_"+t+"_json")}e.__=t;var $=new egret.HtmlTextParser;e.setLabelTranslate=i,e.parseHtmlText=n,e.stringFormat=o,e.setImageColor=a,e.split=s,e.setLordAvatar=r,e.setUISprite=l,e.setUISpriteAsync=_,e.setUISpriteByUrl=h,e.setBitmapAsyncNoPng=c,e.setBitmapAsync=d,e.setJpgBitmapAsync=p,e.setBitMapByUrl=u,e.random=m,e.randomEx=g,e.generateNoneRepeatedNumTable=f,e.getDisplayNumber=y,e.getShortDisplayNumber=E,e.getAngle=v,e.clone=T,e.insertionSort=C,e.binarySearchNext=L,e.displayObjectComparatorByX=b,e.displayObjectComparatorByY=w,e.SECOND=1,e.MINUTE=60*e.SECOND,e.HOUR=60*e.MINUTE,e.DAY=24*e.HOUR,e.secondsToString=S,e.secondsToTimeStringWithDay=O,e.secondsToTimeString=A,e.secondsNoHourToTimeString=x,e.radiansToDegrees=I,e.degreesToRadians=M,e.setEnlargeBtnBehavior=R,e.startAtcion=D,e.setNormalBtnBehavior=B,e.setDarkenBtnBehavior=N,e.setBreathBtnBehavior=P,e.setBtnBehavior=k,e.setImageGrey=G,e.anchorCenter=F,e.getStdLabel=H,e.padding=W;var et=function(){function e(){this.queue=[],this.offset=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length-this.offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0==this.length},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){this.queue.push(e)},e.prototype.dequeue=function(){if(0!=this.length){var t=this.queue[this.offset];return 2*++this.offset>=e.length&&(this.queue=this.queue.slice(this.offset),this.offset=0),t}},e.prototype.peek=function(){return this.queue.length>0?this.queue[this.offset]:void 0},e}();e.Queue=et,__reflect(et.prototype,"xyd.Queue"),e.utf8_to_str=U,e.compareVersion=Y,e.getRotation=V,e.getHeight=K,e.getWidth=X,e.shuffleArray=j,e.isTimeUp=z,e.getServerTime=q,e.checkMouseFocus=Q,e.setMouseFocus=J,e.loadJsonForLevel=Z;var tt=function(){function e(){this._nodesMap={}}return e.prototype.addNode=function(e,t,i){var n=this.getNode(e);if(!n)return!1;n.val=t;for(var o=0,a=i;o<a.length;o++){var s=a[o],r=this.getNode(s);r&&r.addChild(n)}return!0},e.prototype.getNode=function(e){if(e>0){var t=this._nodesMap[e];return void 0==t&&(t=new it(e,void 0),this._nodesMap[e]=t),t}},e}();e.SimpleGraph=tt,__reflect(tt.prototype,"xyd.SimpleGraph");var it=function(){function e(e,t){this._key=e,this._val=t,this._parent=[],this._children=[]}return e.prototype.addChild=function(e){for(var t=!1,i=0,n=this._children;i<n.length;i++){var o=n[i];o.key==e.key&&(t=!0)}t||(this._children.push(e),e.parent.push(this))},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},set:function(e){this._val=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e}();__reflect(it.prototype,"SimpleGraphNode")}(xyd||(xyd={}));var Cell=function(){function e(e,t){this._x=e,this._y=t,this._cellProperties=[];for(var i=0;i<CellConstants.NUM_OF_CELL_PROPERTIES;i++)this._cellProperties[i]=!1}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellProperties",{get:function(){return this._cellProperties},set:function(e){this._cellProperties=e},enumerable:!0,configurable:!0}),e.prototype.copyCellProperties=function(e){for(var t=e.cellProperties,i=0;i<t.length;i++)this.cellProperties[i]=t[i]},e.prototype.setProperty=function(e){this._cellProperties[e]=!0},e.prototype.hasProperty=function(e){return 1==this._cellProperties[e]},e.prototype.isEmpty=function(){var e=this.cellProperties;return e[0]?!0:!1},e.prototype.setNotEmpty=function(){this._cellProperties[0]=!1},e.prototype.propertiesToString=function(){for(var e="",t=1;t<CellConstants.NUM_OF_CELL_PROPERTIES;t++)this._cellProperties[t]&&(0!=e.length&&(e+="|"),e+=t);return""==e&&(e="0"),e},e.prototype.getPresetColor=function(){for(var e=0,t=CellConstants.COLOR_SET;e<t.length;e++){var i=t[e];if(this.hasProperty(i))return i}return 0},e}();__reflect(Cell.prototype,"Cell",["ICell"]);var CellUtils=function(){function e(){}return e.copy=function(e,t,i){var n=new Cell(t,i);return n.copyCellProperties(e),n},e.generateCellMapFromPropMap=function(e){var t=[];if(0==e.length||0==e[0].length)return t;for(var i,n=e.length,o=e[0].length,a=0;n>a;a++){for(var s=[],r=0;o>r;r++){for(var l=new Cell(r,a),_=e[a][r].split("|"),h=0,c=_;h<c.length;h++)i=c[h],l.setProperty(Number(i));s.push(l)}t.push(s)}return t},e.generateEmptyCellMap=function(){for(var e=[],t=9,i=9,n=0;t>n;n++){for(var o=[],a=0;i>a;a++){var s=new Cell(a,n);s.setProperty(CellConstants.VOID),o.push(s)}e.push(o)}return e},e}();__reflect(CellUtils.prototype,"CellUtils");var GameConf=function(){function e(){this._colorMixerElements=[],this.chapterId=-1,this.levelId=-1,this.totalLevel=-1,this.numOfColors=6,this.modeName="",this.portals=[],this.cellMap=CellUtils.generateEmptyCellMap(),this.randomSeed=0,this.scoreTargets=[1e4,2e4,3e4],this.moveLimit=50,this.lamps=[],this.movesNeedToGenerateLamp=1,this.minLampNumOnBoard=1,this.maxLampNumOnBoard=0,this._availableColors=[],this.movesNeedToGenerateBox=0,this.maxBoxNumOnBoard=0,this.movesNeedToGenerateTimeBomb=0,this.maxTimeBombNumOnBoard=0,this.timeBombExplosionMoves=0,this.objectives=[],this.movesNeedToGenerateLuckyBag=0,this.maxLuckyBagNumOnBoard=0,this.movesNeedToGenerateBlackHole=0,this.maxBlackHoleNumOnBoard=0,this.movesNeedToGenerateBombLine=0,this.maxBombLineNumOnBoard=0,this.movesNeedToGenerateBombCol=0,this.maxBombColNumOnBoard=0,this.movesNeedToGenerateBombRow=0,this.maxBombRowNumOnBoard=0,this.movesNeedToGenerateBombSquare=0,this.maxBombSquareNumOnBoard=0,this.movesNeedToGenerateGoldenEgg=0,this.maxGoldenEggNumOnBoard=0,this.handlerSet=[],this.pregameItemList=[],this.ingameItemList=[],this.beltInfo=[],this.rocketCapacity=6,this.maxScissorNumOnBoard=0,this.movesNeedToGenerateScissor=0,this.maxBombColorNumOnBoard=0,this.movesNeedToGenerateBombColor=0,this.maxTornadoNumOnBoard=0,this.movesNeedToGenerateTornado=0,this.maxCakeNumOnBoard=0,this.movesNeedToGenerateCake=0,this.colorMixerAmount=0,this.colorMixerElements=[],this.colorMixerInterval=0}return e.prototype.init=function(e){var t=this._getLevelData(e);this._setLevelData(t),this._addAdditionalHandlerInfo(),this._setHandlerSet(),this._setItemList(),this.scoreTagetsTest()},e.prototype.scoreTagetsTest=function(){var e=this.totalLevel;if(GuideHelper.hasGuideForLevel(e)){var t=GuideHelper.getNextGuideID(e,-1),i=GuideTable.get().getScoreTargets(t);i&&3==i.length&&(this._scoreTargets=i)}},e.prototype._setItemList=function(){this.modeName==GameModeConstants.LEAF||this.modeName==GameModeConstants.LEAF_OBJECTIVE?this.pregameItemList=[ItemConstants.COLOR_BOMB,ItemConstants.LINE_SQUARE_BOMB_PACK,ItemConstants.TORNADO,ItemConstants.LINE_BOMB]:this.pregameItemList=[ItemConstants.COLOR_BOMB,ItemConstants.LINE_SQUARE_BOMB_PACK,ItemConstants.CRAYON,ItemConstants.LINE_BOMB],this.ingameItemList=[ItemConstants.HAMMER,ItemConstants.SWAPPER,ItemConstants.WAND,ItemConstants.STICKER]},e.prototype._getLevelData=function(e){var t=Math.floor(e/100);e%100==0&&t--;var i=e%100==0?100:e%100,n=RES.getRes("level_infos_"+t+"_json"),o=n[i-1];return ABTest.get().getSetting(ABTest.EXTRA_THREE_STEPS)&&this.addThreeMoves(o),o},e.prototype.addThreeMoves=function(e){if(!e.data_modified){e.data_modified=!0;var t=e.level;(58==t||63==t||88==t||90==t||91==t)&&(e.moveLimit+=3)}},e.prototype._setLevelData=function(e){this.chapterId=e.chapter||this.chapterId,this.levelId=e.unit||this.levelId,this.totalLevel=e.level||this.totalLevel,this.numOfColors=Number(e.numOfColors)||this.numOfColors,this.modeName=e.modeName||this.modeName,this.portals=e.portals||this.portals,this.cellMap=CellUtils.generateCellMapFromPropMap(e.cellPropMap)||this.cellMap,this.randomSeed=Number(e.randomSeed)||this.randomSeed,this.scoreTargets=e.scoreTargets||this.scoreTargets,this.moveLimit=e.moveLimit||this.moveLimit,this.lamps=e.lamps||this.lamps,this.movesNeedToGenerateLamp=e.movesNeedToGenerateLamp||this.movesNeedToGenerateLamp,this.minLampNumOnBoard=e.minLampNumOnBoard||this.minLampNumOnBoard,this.maxLampNumOnBoard=e.maxLampNumOnBoard||this.maxLampNumOnBoard,this.movesNeedToGenerateBox=e.movesNeedToGenerateBox||this.movesNeedToGenerateBox,this.maxBoxNumOnBoard=e.maxBoxNumOnBoard||this.maxBoxNumOnBoard,this.movesNeedToGenerateTimeBomb=e.movesNeedToGenerateTimeBomb||this.movesNeedToGenerateTimeBomb,this.maxTimeBombNumOnBoard=e.maxTimeBombNumOnBoard||this.maxTimeBombNumOnBoard,this.timeBombExplosionMoves=e.timeBombExplosionMoves||this.timeBombExplosionMoves,this.objectives=e.objectives||this.objectives,this.movesNeedToGenerateLuckyBag=e.movesNeedToGenerateLuckyBag||this.movesNeedToGenerateLuckyBag,this.maxLuckyBagNumOnBoard=e.maxLuckyBagNumOnBoard||this.maxLuckyBagNumOnBoard,this.movesNeedToGenerateBlackHole=e.movesNeedToGenerateBlackHole||this.movesNeedToGenerateBlackHole,this.maxBlackHoleNumOnBoard=e.maxBlackHoleNumOnBoard||this.maxBlackHoleNumOnBoard,this.movesNeedToGenerateBombLine=e.movesNeedToGenerateBombLine||this.movesNeedToGenerateBombLine,this.maxBombLineNumOnBoard=e.maxBombLineNumOnBoard||this.maxBombLineNumOnBoard,this.movesNeedToGenerateBombCol=e.movesNeedToGenerateBombCol||this.movesNeedToGenerateBombCol,this.maxBombColNumOnBoard=e.maxBombColNumOnBoard||this.maxBombColNumOnBoard,this.movesNeedToGenerateBombRow=e.movesNeedToGenerateBombRow||this.movesNeedToGenerateBombRow,this.maxBombRowNumOnBoard=e.maxBombRowNumOnBoard||this.maxBombRowNumOnBoard,this.movesNeedToGenerateBombSquare=e.movesNeedToGenerateBombSquare||this.movesNeedToGenerateBombSquare,this.maxBombSquareNumOnBoard=e.maxBombSquareNumOnBoard||this.maxBombSquareNumOnBoard,this.movesNeedToGenerateGoldenEgg=e.movesNeedToGenerateGoldenEgg||this.movesNeedToGenerateGoldenEgg,this.maxGoldenEggNumOnBoard=e.maxGoldenEggNumOnBoard||this.maxGoldenEggNumOnBoard,this.beltInfo=e.belts||this.beltInfo,this.rocketCapacity=e.rocketCapacity||this.rocketCapacity,this.movesNeedToGenerateScissor=e.movesNeedToGenerateScissor||this.movesNeedToGenerateScissor,this.maxScissorNumOnBoard=e.maxScissorNumOnBoard||this.maxScissorNumOnBoard,this.maxCakeNumOnBoard=e.maxCakeNumOnBoard||this.maxCakeNumOnBoard,this.movesNeedToGenerateCake=e.movesNeedToGenerateCake||this.movesNeedToGenerateCake,this.colorMixerAmount=e.colorMixerAmount||this.colorMixerAmount,this.colorMixerInterval=e.colorMixerInterval||this.colorMixerInterval,this.colorMixerElements=e.colorMixerElements||this.colorMixerElements,this.maxBombColorNumOnBoard=e.maxBombColorNumOnBoard||this.maxBombColorNumOnBoard,this.movesNeedToGenerateBombColor=e.movesNeedToGenerateBombColor||this.movesNeedToGenerateBombColor,this.maxTornadoNumOnBoard=e.maxTornadoNumOnBoard||this.maxTornadoNumOnBoard,this.movesNeedToGenerateTornado=e.movesNeedToGenerateTornado||this.movesNeedToGenerateTornado},e.prototype._setHandlerSet=function(){HandlerInfo.HAS_BOX&&this._handlerSet.push(CellConstants.BOX),HandlerInfo.HAS_TIME_BOMB&&this._handlerSet.push(CellConstants.TIME_BOMB),HandlerInfo.HAS_LUCKY_BAG&&this._handlerSet.push(CellConstants.LUCKY_BAG),HandlerInfo.HAS_BLACK_HOLE&&this._handlerSet.push(CellConstants.BLACK_HOLE),HandlerInfo.HAS_BOMB_LINE_GENERATOR&&this._handlerSet.push(CellConstants.GENERATOR_BOMB_LINE),HandlerInfo.HAS_BOMB_COL_GENERATOR&&this._handlerSet.push(CellConstants.GENERATOR_BOMB_COL),HandlerInfo.HAS_BOMB_ROW_GENERATOR&&this._handlerSet.push(CellConstants.GENERATOR_BOMB_ROW),HandlerInfo.HAS_BOMB_SQUARE_GENERATOR&&this._handlerSet.push(CellConstants.GENERATOR_BOMB_SQUARE),HandlerInfo.HAS_GOLDEN_EGG&&this._handlerSet.push(CellConstants.GOLDEN_EGG),HandlerInfo.HAS_SCISSOR&&this._handlerSet.push(CellConstants.SCISSOR),HandlerInfo.HAS_CAKE&&this._handlerSet.push(CellConstants.CAKE_1),HandlerInfo.HAS_COLOR_BOMB&&this._handlerSet.push(CellConstants.BOMB_COLOR),HandlerInfo.HAS_TORNADO&&this._handlerSet.push(CellConstants.TORNADO)},e.prototype.needGenerateHandler=function(e){return HandlerInfo.hasElementOfType(e)},Object.defineProperty(e.prototype,"chapterId",{get:function(){return this._chapterId},set:function(e){this._chapterId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"levelId",{get:function(){return this._levelId},set:function(e){this._levelId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalLevel",{get:function(){return this._totalLevel},set:function(e){this._totalLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numOfColors",{get:function(){return this._numOfColors},set:function(e){this._numOfColors=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modeName",{get:function(){return this._modeName},set:function(e){this._modeName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"portals",{get:function(){for(var e=[],t=0,i=this._portals;t<i.length;t++){var n=i[t];e.push([n[0],n[1]])}return e},set:function(e){this._portals=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._portals.push([n[0],n[1]])}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beltInfo",{get:function(){for(var e=[],t=0,i=this._beltInfo;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._beltInfo=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._beltInfo.push(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellMap",{get:function(){var e=[];if(0==this._cellMap.length||0==this._cellMap[0].length)return e;for(var t=this._cellMap.length,i=this._cellMap[0].length,n=0;t>n;n++){for(var o=[],a=0;i>a;a++)o.push(CellUtils.copy(this._cellMap[n][a],a,n));e.push(o)}return e},set:function(e){if(this._cellMap=[],0!=e.length&&0!=e[0].length)for(var t=e.length,i=e[0].length,n=0;t>n;n++){for(var o=[],a=0;i>a;a++)o.push(CellUtils.copy(e[n][a],a,n)),this._addHandlerInfo(CellUtils.copy(e[n][a],a,n));this._cellMap.push(o)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lamps",{get:function(){for(var e=[],t=0,i=this._lamps;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._lamps=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];0==n&&(n=-1),this._lamps.push(n)}this._lamps.length<2&&this._lamps.push(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"randomSeed",{get:function(){return this._randomSeed},set:function(e){this._randomSeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreTargets",{get:function(){return this._scoreTargets},set:function(e){var t=e.length;e.length<=0&&console.log("There are no scoretargets!"),this._scoreTargets=[];for(var i=0;t>i;)this._scoreTargets.push(e[i]),i++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moveLimit",{get:function(){return this._moveLimit},set:function(e){this._moveLimit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateLamp",{get:function(){return this._movesNeedToGenerateLamp},set:function(e){this._movesNeedToGenerateLamp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minLampNumOnBoard",{get:function(){return this._minLampNumOnBoard},set:function(e){this._minLampNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLampNumOnBoard",{get:function(){return this._maxLampNumOnBoard},set:function(e){this._maxLampNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBox",{get:function(){return this._movesNeedToGenerateBox},set:function(e){this._movesNeedToGenerateBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBoxNumOnBoard",{get:function(){return this._maxBoxNumOnBoard},set:function(e){this._maxBoxNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateTimeBomb",{get:function(){return this._movesNeedToGenerateTimeBomb},set:function(e){this._movesNeedToGenerateTimeBomb=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTimeBombNumOnBoard",{get:function(){return this._maxTimeBombNumOnBoard},set:function(e){this._maxTimeBombNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeBombExplosionMoves",{get:function(){return this._timeBombExplosionMoves},set:function(e){this._timeBombExplosionMoves=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateLuckyBag",{get:function(){return this._movesNeedToGenerateLuckyBag},set:function(e){this._movesNeedToGenerateLuckyBag=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLuckyBagNumOnBoard",{get:function(){return this._maxLuckyBagNumOnBoard},set:function(e){this._maxLuckyBagNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBlackHole",{get:function(){return this._movesNeedToGenerateBlackHole},set:function(e){this._movesNeedToGenerateBlackHole=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBlackHoleNumOnBoard",{get:function(){return this._maxBlackHoleNumOnBoard},set:function(e){this._maxBlackHoleNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBombLine",{get:function(){return this._movesNeedToGenerateBombLine},set:function(e){this._movesNeedToGenerateBombLine=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBombLineNumOnBoard",{get:function(){return this._maxBombLineNumOnBoard},set:function(e){this._maxBombLineNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateGoldenEgg",{get:function(){return this._movesNeedToGenerateGoldenEgg},set:function(e){this._movesNeedToGenerateGoldenEgg=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGoldenEggNumOnBoard",{get:function(){return this._maxGoldenEggNumOnBoard},set:function(e){this._maxGoldenEggNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateScissor",{get:function(){return this._movesNeedToGenerateScissor},set:function(e){this._movesNeedToGenerateScissor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScissorNumOnBoard",{get:function(){return this._maxScissorNumOnBoard},set:function(e){this._maxScissorNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBombCol",{get:function(){return this._movesNeedToGenerateBombCol},set:function(e){this._movesNeedToGenerateBombCol=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBombColNumOnBoard",{get:function(){return this._maxBombColNumOnBoard},set:function(e){this._maxBombColNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBombRow",{get:function(){return this._movesNeedToGenerateBombRow
},set:function(e){this._movesNeedToGenerateBombRow=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBombRowNumOnBoard",{get:function(){return this._maxBombRowNumOnBoard},set:function(e){this._maxBombRowNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBombSquare",{get:function(){return this._movesNeedToGenerateBombSquare},set:function(e){this._movesNeedToGenerateBombSquare=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBombSquareNumOnBoard",{get:function(){return this._maxBombSquareNumOnBoard},set:function(e){this._maxBombSquareNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectives",{get:function(){for(var e=[],t=0,i=this._objectives;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._objectives=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._objectives.push(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handlerSet",{get:function(){for(var e=[],t=0,i=this._handlerSet;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._handlerSet=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._handlerSet.push(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateCake",{get:function(){return this._movesNeedToGenerateCake},set:function(e){this._movesNeedToGenerateCake=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCakeNumOnBoard",{get:function(){return this._maxCakeNumOnBoard},set:function(e){this._maxCakeNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateTornado",{get:function(){return this._movesNeedToGenerateTornado},set:function(e){this._movesNeedToGenerateTornado=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTornadoNumOnBoard",{get:function(){return this._maxTornadoNumOnBoard},set:function(e){this._maxTornadoNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movesNeedToGenerateBombColor",{get:function(){return this._movesNeedToGenerateBombColor},set:function(e){this._movesNeedToGenerateBombColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxBombColorNumOnBoard",{get:function(){return this._maxBombColorNumOnBoard},set:function(e){this._maxBombColorNumOnBoard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableColors",{get:function(){if(6==this._numOfColors)return CellConstants.COLOR_SET;this._availableColors=[];for(var e=(this._cellMap.length,this._cellMap[0].length,0);e<this.numOfColors;e++)this._availableColors.push(CellConstants.COLOR_SET[e]);return this._availableColors},set:function(e){this._availableColors=e},enumerable:!0,configurable:!0}),e.prototype._addHandlerInfo=function(e){e.hasProperty(CellConstants.LUCKY_BAG)?HandlerInfo.HAS_LUCKY_BAG=!0:e.hasProperty(CellConstants.BOX)?HandlerInfo.HAS_BOX=!0:e.hasProperty(CellConstants.TIME_BOMB)?HandlerInfo.HAS_TIME_BOMB=!0:e.hasProperty(CellConstants.BLACK_HOLE)?HandlerInfo.HAS_BLACK_HOLE=!0:e.hasProperty(CellConstants.CLOUD||e.hasProperty(CellConstants.CLOUD_MAKER))?HandlerInfo.HAS_CLOUD=!0:e.hasProperty(CellConstants.TORNADO)?HandlerInfo.HAS_TORNADO=!0:e.hasProperty(CellConstants.GOLDEN_EGG)?HandlerInfo.HAS_GOLDEN_EGG=!0:e.hasProperty(CellConstants.SCISSOR)?HandlerInfo.HAS_SCISSOR=!0:e.hasProperty(CellConstants.CAKE_1)?HandlerInfo.HAS_CAKE=!0:e.hasProperty(CellConstants.CAKE_2)?HandlerInfo.HAS_CAKE=!0:e.hasProperty(CellConstants.CAKE_3)?HandlerInfo.HAS_CAKE=!0:e.hasProperty(CellConstants.CAKE_4)?HandlerInfo.HAS_CAKE=!0:e.hasProperty(CellConstants.CAKE_5)&&(HandlerInfo.HAS_CAKE=!0)},e.prototype._addAdditionalHandlerInfo=function(){(this.movesNeedToGenerateBox>0||this.maxBoxNumOnBoard>0)&&(HandlerInfo.HAS_BOX=!0),(this.movesNeedToGenerateTimeBomb>0||this.maxTimeBombNumOnBoard>0)&&(HandlerInfo.HAS_TIME_BOMB=!0),(this.movesNeedToGenerateLuckyBag>0||this.maxLuckyBagNumOnBoard>0)&&(HandlerInfo.HAS_LUCKY_BAG=!0),(this.movesNeedToGenerateBlackHole>0||this.maxBlackHoleNumOnBoard>0)&&(HandlerInfo.HAS_BLACK_HOLE=!0),(this.movesNeedToGenerateBombLine>0||this.maxBombLineNumOnBoard>0)&&(HandlerInfo.HAS_BOMB_LINE_GENERATOR=!0),(this.movesNeedToGenerateBombCol>0||this.maxBombColNumOnBoard>0)&&(HandlerInfo.HAS_BOMB_COL_GENERATOR=!0),(this.movesNeedToGenerateBombRow>0||this.maxBombRowNumOnBoard>0)&&(HandlerInfo.HAS_BOMB_ROW_GENERATOR=!0),(this.movesNeedToGenerateBombSquare>0||this.maxBombSquareNumOnBoard>0)&&(HandlerInfo.HAS_BOMB_SQUARE_GENERATOR=!0),(this.movesNeedToGenerateGoldenEgg>0||this.maxGoldenEggNumOnBoard>0)&&(HandlerInfo.HAS_GOLDEN_EGG=!0),(this.movesNeedToGenerateScissor>0||this.maxScissorNumOnBoard>0)&&(HandlerInfo.HAS_SCISSOR=!0),(this.movesNeedToGenerateCake>0||this.maxCakeNumOnBoard>0)&&(HandlerInfo.HAS_CAKE=!0),(this.maxBombColorNumOnBoard>0||this.movesNeedToGenerateBombColor>0)&&(HandlerInfo.HAS_COLOR_BOMB=!0),(this.maxTornadoNumOnBoard>0||this.movesNeedToGenerateTornado>0)&&(HandlerInfo.HAS_TORNADO=!0)},Object.defineProperty(e.prototype,"pregameItemList",{get:function(){for(var e=[],t=0,i=this._pregameItemList;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._pregameItemList=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._pregameItemList.push(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ingameItemList",{get:function(){for(var e=[],t=0,i=this._ingameItemList;t<i.length;t++){var n=i[t];e.push(n)}return e},set:function(e){this._ingameItemList=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._ingameItemList.push(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rocketCapacity",{get:function(){return this._rocketCapacity},set:function(e){this._rocketCapacity=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMixerAmount",{get:function(){return this._colorMixerAmount},set:function(e){this._colorMixerAmount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMixerInterval",{get:function(){return this._colorMixerInterval},set:function(e){this._colorMixerInterval=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMixerElements",{get:function(){return this._colorMixerElements},set:function(e){this._colorMixerElements=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._colorMixerElements.push(n)}},enumerable:!0,configurable:!0}),e}();__reflect(GameConf.prototype,"GameConf",["IGameConf"]);var HandlerInfo=function(){function e(){}return e.hasElementOfType=function(t){return e.TYPE_MAP[t]},e.HAS_BOX=!1,e.HAS_TIME_BOMB=!1,e.HAS_LUCKY_BAG=!1,e.HAS_BLACK_HOLE=!1,e.HAS_CLOUD=!1,e.HAS_TORNADO=!1,e.HAS_BOMB_SQUARE_GENERATOR=!1,e.HAS_BOMB_LINE_GENERATOR=!1,e.HAS_BOMB_COL_GENERATOR=!1,e.HAS_BOMB_ROW_GENERATOR=!1,e.HAS_GOLDEN_EGG=!1,e.HAS_SCISSOR=!1,e.HAS_CAKE=!1,e.HAS_COLOR_BOMB=!1,e.TYPE_MAP=(_a={},_a[CellConstants.BOX]=e.HAS_BOX,_a[CellConstants.TIME_BOMB]=e.HAS_TIME_BOMB,_a[CellConstants.LUCKY_BAG]=e.HAS_LUCKY_BAG,_a[CellConstants.BLACK_HOLE]=e.HAS_BLACK_HOLE,_a[CellConstants.CLOUD]=e.HAS_CLOUD,_a[CellConstants.TORNADO]=e.HAS_TORNADO,_a[CellConstants.GENERATOR_BOMB_COL]=e.HAS_BOMB_COL_GENERATOR,_a[CellConstants.GENERATOR_BOMB_ROW]=e.HAS_BOMB_ROW_GENERATOR,_a[CellConstants.GENERATOR_BOMB_LINE]=e.HAS_BOMB_LINE_GENERATOR,_a[CellConstants.GENERATOR_BOMB_SQUARE]=e.HAS_BOMB_SQUARE_GENERATOR,_a[CellConstants.GOLDEN_EGG]=e.HAS_GOLDEN_EGG,_a[CellConstants.SCISSOR]=e.HAS_SCISSOR,_a[CellConstants.CAKE_1]=e.HAS_CAKE,_a[CellConstants.CAKE_2]=e.HAS_CAKE,_a[CellConstants.CAKE_3]=e.HAS_CAKE,_a[CellConstants.CAKE_4]=e.HAS_CAKE,_a[CellConstants.CAKE_5]=e.HAS_CAKE,_a[CellConstants.BOMB_COLOR]=e.HAS_COLOR_BOMB,_a),e}();__reflect(HandlerInfo.prototype,"HandlerInfo");var _a,ScoreTargetProvider=function(){function e(e){this.scoreTargets=e}return Object.defineProperty(e.prototype,"scoreTargets",{get:function(){return this._scoreTargets},set:function(e){var t=e.length;e.length<=0&&console.log("There are no scoretargets!"),this._scoreTargets=[];for(var i=0;t>i;)this._scoreTargets.push(e[i]),i++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextScoreTarget",{get:function(){return this._nextScoreTarget},set:function(e){this._nextScoreTarget=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lowestScoreTarget",{get:function(){return this._scoreTargets[0]},enumerable:!0,configurable:!0}),e}();__reflect(ScoreTargetProvider.prototype,"ScoreTargetProvider");var BeltConstants=function(){function e(){}return e.UP=0,e.RIGHT=1,e.DOWN=2,e.LEFT=3,e.PORTAL_NONE=0,e.PORTAL_RED=1,e.PORTAL_BLUE=2,e.PORTAL_GREEN=3,e.PORTAL_IN=0,e.PORTAL_OUT=1,e.ANIMATION_TICKS=30,e.DX=[0,1,0,-1],e.DY=[-1,0,1,0],e.COLOR_TO_EFFECT_MAP=(_a={},_a[e.PORTAL_RED]=["texiao03","texiao04"],_a[e.PORTAL_GREEN]=["texiao05","texiao06"],_a[e.PORTAL_BLUE]=["texiao07","texiao08"],_a),e.PORTAL_DIRECTION_EFFECT_MAP=(_b={},_b[e.UP]=[0,2,-62],_b[e.RIGHT]=[90,59,0],_b[e.DOWN]=[180,2,62],_b[e.LEFT]=[270,-59,0],_b),e}();__reflect(BeltConstants.prototype,"BeltConstants");var _a,_b,BaseEuiView=function(e){function t(t,i){var n=e.call(this)||this;return n._resources=null,n._controller=t,n._myParent=i,n._isInit=!1,n.percentHeight=100,n.percentWidth=100,n}return __extends(t,e),Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),t.prototype.setResources=function(e){this._resources=e},t.prototype.isInit=function(){return this._isInit},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},t.prototype.initUI=function(){this._isInit=!0},t.prototype.initData=function(){},t.prototype.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.loadResource=function(e,t){this._resources&&this._resources.length>0?(App.ResourceUtils.loadResource(this._resources,[],e,null,this),this.once(eui.UIEvent.CREATION_COMPLETE,t,this)):(e(),t())},t.prototype.setVisible=function(e){this.visible=e},t}(eui.Component);__reflect(BaseEuiView.prototype,"BaseEuiView",["IBaseView"]);var BaseSpriteView=function(e){function t(t,i){var n=e.call(this)||this;return n._resources=null,n._controller=t,n._myParent=i,n._isInit=!1,App.StageUtils.getStage().addEventListener(egret.Event.RESIZE,n.onResize,n),n}return __extends(t,e),t.prototype.setResources=function(e){this._resources=e},Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),t.prototype.isInit=function(){return this._isInit},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},t.prototype.initUI=function(){this._isInit=!0},t.prototype.initData=function(){},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},t.prototype.onResize=function(){},t.prototype.loadResource=function(e,t){this._resources&&this._resources.length>0?App.ResourceUtils.loadResource(this._resources,[],function(){e(),t()},null,this):(e(),t())},t.prototype.setVisible=function(e){this.visible=e},t}(egret.DisplayObjectContainer);__reflect(BaseSpriteView.prototype,"BaseSpriteView",["IBaseView"]);var DisplayConstants=function(){function e(){e.ElementDisplaySourceMap[0]="bg_xiaochu_png",e.ElementDisplaySourceMap[1]="bg_xiaochu2_png",e.ElementDisplaySourceMap[e.DROP_DOWN]="icon_drop_png",e.ElementDisplaySourceMap[CellConstants.COLOR_RED]="ele_red_png",e.ElementDisplaySourceMap[CellConstants.COLOR_ORANGE]="ele_orange_png",e.ElementDisplaySourceMap[CellConstants.COLOR_PINK]="ele_pink_png",e.ElementDisplaySourceMap[CellConstants.COLOR_GREEN]="ele_green_png",e.ElementDisplaySourceMap[CellConstants.COLOR_BLUE]="ele_blue_png",e.ElementDisplaySourceMap[CellConstants.COLOR_PURPLE]="ele_purple_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_RED]="ele_red_row_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_ORANGE]="ele_orange_row_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_PINK]="ele_pink_row_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_GREEN]="ele_green_row_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_BLUE]="ele_blue_row_png",e.ElementDisplaySourceMap[20+CellConstants.COLOR_PURPLE]="ele_purple_row_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_RED]="ele_red_col_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_ORANGE]="ele_orange_col_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_PINK]="ele_pink_col_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_GREEN]="ele_green_col_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_BLUE]="ele_blue_col_png",e.ElementDisplaySourceMap[30+CellConstants.COLOR_PURPLE]="ele_purple_col_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_RED]="ele_red_bomb_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_ORANGE]="ele_orange_bomb_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_PINK]="ele_pink_bomb_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_GREEN]="ele_green_bomb_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_BLUE]="ele_blue_bomb_png",e.ElementDisplaySourceMap[40+CellConstants.COLOR_PURPLE]="ele_purple_bomb_png",e.ElementDisplaySourceMap[50]="ele_color_bomb_png",e.ElementDisplaySourceMap[52]="ele_color_bomb_png",e.ElementDisplaySourceMap[53]="ele_color_bomb_png",e.ElementDisplaySourceMap[54]="ele_color_bomb_png",e.ElementDisplaySourceMap[55]="ele_color_bomb_png",e.ElementDisplaySourceMap[56]="ele_color_bomb_png",e.ElementDisplaySourceMap[57]="ele_color_bomb_png",e.ElementDisplaySourceMap[60]="lantern_1_png",e.ElementDisplaySourceMap[70]="lantern_2_png",e.ElementDisplaySourceMap[80]="icon_xiangzi_png",e.ElementDisplaySourceMap[90]="icon_zhadanhong_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_RED]="icon_zhadanhong_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_ORANGE]="icon_zhadancheng_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_PINK]="icon_zhadanzi_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_GREEN]="icon_zhadanlv_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_BLUE]="icon_zhadanqing_png",e.ElementDisplaySourceMap[90+CellConstants.COLOR_PURPLE]="icon_zhadanlan_png",e.ElementDisplaySourceMap[100]="ele_red_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_RED]="ele_red_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_ORANGE]="ele_orange_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_PINK]="ele_pink_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_GREEN]="ele_green_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_BLUE]="ele_blue_bag_png",e.ElementDisplaySourceMap[100+CellConstants.COLOR_PURPLE]="ele_purple_bag_png",e.ElementDisplaySourceMap[120]="icon_longjuanfenghong_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_RED]="icon_longjuanfenghong_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_ORANGE]="icon_longjuanfengcheng_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_PINK]="icon_longjuanfengfen_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_GREEN]="icon_longjuanfenglv_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_BLUE]="icon_longjuanfengqing_png",e.ElementDisplaySourceMap[120+CellConstants.COLOR_PURPLE]="icon_longjuanfenglan_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_RED]="ele_red_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_ORANGE]="ele_orange_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_PINK]="ele_pink_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_GREEN]="ele_green_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_BLUE]="ele_blue_png",e.ElementDisplaySourceMap[130+CellConstants.COLOR_PURPLE]="ele_purple_png",e.ElementDisplaySourceMap[110]="icon_labi_png",e.ElementDisplaySourceMap[150]="ele_wand_png",e.ElementDisplaySourceMap[160]="ele_egg_red_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_RED]="ele_egg_red_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_ORANGE]="ele_egg_orange_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_PINK]="ele_egg_pink_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_GREEN]="ele_egg_green_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_BLUE]="ele_egg_blue_png",e.ElementDisplaySourceMap[160+CellConstants.COLOR_PURPLE]="ele_egg_purple_png",e.ElementDisplaySourceMap[170]="rocket_huojianhong1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_RED]="rocket_huojianhong1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_ORANGE]="rocket_huojiancheng1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_PINK]="rocket_huojianfen1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_GREEN]="rocket_huojianlv1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_BLUE]="rocket_huojianqing1_png",e.ElementDisplaySourceMap[170+CellConstants.COLOR_PURPLE]="rocket_huojianlan1_png",e.ElementDisplaySourceMap[180]="icon_scissor_orange_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_RED]="icon_scissor_red_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_ORANGE]="icon_scissor_orange_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_PINK]="icon_scissor_pink_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_GREEN]="icon_scissor_green_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_BLUE]="icon_scissor_blue_png",e.ElementDisplaySourceMap[180+CellConstants.COLOR_PURPLE]="icon_scissor_purple_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.SLATE]="block_stone_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.CLOUD]="yun1_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.CLOUD_ROCKET]="rocket_huojianxue_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.FAN]="icon_fengshan_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.FENCE]="icon_jingjiheng0_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.CURLS]="icon_jingjiheng1_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.CURLS+1]="icon_jingjiheng2_png",e.ElementDisplaySourceMap[e.BLOCKER_TYPE_START+BlockerConstant.CURLS+2]="icon_jingjiheng3_png",e.LayedSlateSourceMap=["block_slate_png","block_slate2_png","block_slate3_png","block_slate4_png","block_slate5_png"],e.puzzleSourceMap=["puzzle_11_png","puzzle_12_png",void 0,"puzzle_21_png","puzzle_22_png",void 0,"puzzle_31_png","puzzle_32_png",void 0,"puzzle_41_png","puzzle_42_png",void 0,"puzzle_5_png","puzzle_6_png","puzzle_13_png","puzzle_23_png","puzzle_33_png","puzzle_43_png"],e.ElementDisplaySourceMap[2001]="leaf_1_png",e.ElementDisplaySourceMap[2002]="leaf_2_png",e.ElementDisplaySourceMap[3001]="lock_1_png",e.ElementDisplaySourceMap[3002]="icon_bingkuai_png",e.ElementDisplaySourceMap[4001]="bg_bian_png",e.ElementDisplaySourceMap[4002]="bg_coner1_png",e.ElementDisplaySourceMap[4003]="bg_coner2_png",e.CloudSourceMap[0]="yun1_png",e.CloudSourceMap[1]="yun2_png",e.CloudSourceMap[2]="yun3_png",e.CloudSourceMap[3]="yun4_png",e.CloudSourceMap[4]="yun5_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_RED]]="ele_red_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_PINK]]="ele_pink_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_ORANGE]]="ele_orange_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_BLUE]]="ele_blue_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_PURPLE]]="ele_purple_png",e.TargetSourceMap[ObjectiveConstants.CELL_COLOR_TO_TARGET[CellConstants.COLOR_GREEN]]="ele_green_png",e.TargetSourceMap[7]="icon_renwufang_png",e.TargetSourceMap[8]="icon_renwuheng_png",e.TargetSourceMap[9]="icon_fengche_png",e.TargetSourceMap[10]="icon_renwuhengshu_png",e.TargetSourceMap[11]="icon_renwuhengfang_png",e.TargetSourceMap[12]="icon_renwuhengche_png",e.TargetSourceMap[13]="icon_renwufengche_png",e.TargetSourceMap[14]="icon_renwufangche_png",e.TargetSourceMap[15]="icon_renwufangfang_png",e.TargetSourceMap[16]="icon_renwuyun_png",e.TargetSourceMap[17]="block_slate3_png",e.TargetSourceMap[18]="icon_balloon1_png",e.TargetSourceMap[19]="icon_xiangzi_png",e.TargetSourceMap[20]="icon_renwuzhadan_png",e.TargetSourceMap[21]="icon_renwufeng_png",e.TargetSourceMap[22]="icon_renwupintu_png",e.TargetSourceMap[23]="icon_bao_png",e.TargetSourceMap[24]="icon_bao_png",e.TargetSourceMap[25]="icon_dangao3_png",e.TargetSourceMap[26]="snowman_png",e.TargetSourceMap[99]="block_stone_png",e.TargetSourceMap.leaf="icon_renwucao_png",e.TargetSourceMap.lamp1="lantern_1_png",e.TargetSourceMap.lamp2="lantern_2_png",e.GeneratorSourceMap[CellConstants.GENERATOR_LAMP]="lantern_1_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BOX]="icon_xiangzi_png",e.GeneratorSourceMap[CellConstants.GENERATOR_TIME_BOMB]="icon_renwuzhadan_png",e.GeneratorSourceMap[CellConstants.GENERATOR_LUCKY_BAG]="icon_bao_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BOMB_LINE]="icon_renwuheng_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BOMB_SQUARE]="icon_renwufang_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BLACK_HOLE]="blackhole_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BOMB_ROW]="ele_purple_row_png",e.GeneratorSourceMap[CellConstants.GENERATOR_BOMB_COL]="ele_purple_col_png",e.GeneratorSourceMap[CellConstants.GENERATOR_GOLDEN_EGG]="ele_egg_red_png",e.GeneratorSourceMap[CellConstants.GENERATOR_SCISSOR]="icon_scissor_red_png",e.GeneratorSourceMap[CellConstants.GENERATOR_CAKE]="icon_dangao3_png",e.GeneratorSourceMap[CellConstants.GENERATOR_COLOR_BOMB]="icon_fengche_png",e.GeneratorSourceMap[CellConstants.GENERATOR_TORNADO]="icon_longjuanfengfen_png",e.ItemSourceMap[1001]="icon_fengche",e.ItemSourceMap[1002]="icon_longjuanfeng",e.ItemSourceMap[1003]="icon_labi",e.ItemSourceMap[1004]="icon_mobang",e.ItemSourceMap[1005]="icon_chuizi",e.ItemSourceMap[1006]="icon_teshuqizi",e.ItemSourceMap[1007]="icon_weizhijiaohuan",e.ItemSourceMap[1008]="icon_tiezhi",e.ItemSourceMap[1009]="icon_longjuanfeng",e.ItemSourceMap[1010]="icon_add5",e.ItemSourceMap[1011]="icon_tili",e.ItemSourceMap[1012]="icon_tili",e.ItemSourceMap[1013]="icon_tili",e.ItemSourceMap[1014]="icon_tili",e.ItemSourceMap[1015]="icon_tili",e.ItemSourceMap[1016]="icon_add3",e.ItemSourceMap[1017]="icon_hengshuxiao",e.ItemSourceMap[2001]="icon_fengche",e.ItemSourceMap[2002]="icon_longjuanfeng",e.ItemSourceMap[2003]="icon_labi",e.ItemSourceMap[2004]="icon_mobang",e.ItemSourceMap[2005]="icon_chuizi",e.ItemSourceMap[2006]="icon_teshuqizi",e.ItemSourceMap[2007]="icon_weizhijiaohuan",e.ItemSourceMap[2008]="icon_tiezhi",e.ItemSourceMap[2009]="icon_longjuanfeng",e.ItemSourceMap[2010]="icon_add5",e.ItemSourceMap[2017]="icon_hengshuxiao",e.ItemSourceMap[3002]="icon_zuanshi",e.ItemSourceMap[3003]="icon_tili",e.EffectColorMap[CellConstants.CELL_COLOR_RANDOM]="texiao01",e.EffectColorMap[CellConstants.COLOR_RED]="texiao01",e.EffectColorMap[CellConstants.COLOR_ORANGE]="texiao02",e.EffectColorMap[CellConstants.COLOR_PINK]="texiao03",e.EffectColorMap[CellConstants.COLOR_GREEN]="texiao04",e.EffectColorMap[CellConstants.COLOR_BLUE]="texiao05",e.EffectColorMap[CellConstants.COLOR_PURPLE]="texiao06",e.MatchComboEffect[MatchComboConstants.TYPE_GOOD]=["text_good_blur_png","text_good_png","text_effect_good"],e.MatchComboEffect[MatchComboConstants.TYPE_GREAT]=["text_great_blur_png","text_great_png","text_effect_great"],e.MatchComboEffect[MatchComboConstants.TYPE_WONDERFUL]=["text_wonderful_blur_png","text_wonderful_png","text_effect_wonderful"],e.MatchComboEffect[MatchComboConstants.TYPE_FANTASTIC]=["text_fantastic_blur_png","text_fantastic_png","text_effect_fantastic"],e.RocketStateSourceMap[CellConstants.CELL_COLOR_RANDOM]=["rocket_huojianfengche1_png","rocket_huojianfengche2_png","rocket_huojianfengche2_png"],e.RocketStateSourceMap[CellConstants.COLOR_RED]=["rocket_huojianhong1_png","rocket_huojianhong2_png","rocket_huojianhong2_png"],e.RocketStateSourceMap[CellConstants.COLOR_ORANGE]=["rocket_huojiancheng1_png","rocket_huojiancheng2_png","rocket_huojiancheng2_png"],e.RocketStateSourceMap[CellConstants.COLOR_PINK]=["rocket_huojianfen1_png","rocket_huojianfen2_png","rocket_huojianfen2_png"],e.RocketStateSourceMap[CellConstants.COLOR_GREEN]=["rocket_huojianlv1_png","rocket_huojianlv2_png","rocket_huojianlv2_png"],e.RocketStateSourceMap[CellConstants.COLOR_BLUE]=["rocket_huojianqing1_png","rocket_huojianqing2_png","rocket_huojianqing2_png"],e.RocketStateSourceMap[CellConstants.COLOR_PURPLE]=["rocket_huojianlan1_png","rocket_huojianlan2_png","rocket_huojianlan2_png"],e.RocketTypeSourceMap[CellConstants.CELL_COLOR_RANDOM]=["","","",""],e.RocketTypeSourceMap[CellConstants.COLOR_RED]=["","rocket_henghong_png","rocket_shuhong_png","rocket_9xiaohong_png",""],e.RocketTypeSourceMap[CellConstants.COLOR_ORANGE]=["","rocket_hengcheng_png","rocket_shucheng_png","rocket_9xiaocheng_png",""],e.RocketTypeSourceMap[CellConstants.COLOR_PINK]=["","rocket_hengfen_png","rocket_shufen_png","rocket_9xiaofen_png",""],e.RocketTypeSourceMap[CellConstants.COLOR_GREEN]=["","rocket_henglv_png","rocket_shulv_png","rocket_9xiaolv_png",""],e.RocketTypeSourceMap[CellConstants.COLOR_BLUE]=["","rocket_hengqing_png","rocket_shuqing_png","rocket_9xiaoqing_png",""],e.RocketTypeSourceMap[CellConstants.COLOR_PURPLE]=["","rocket_henglan_png","rocket_shulan_png","rocket_9xiaolan_png",""],e.CakeMap[1]="texiao01",e.CakeMap[2]="texiao02",e.CakeMap[3]="texiao03",e.CakeMap[4]="texiao04",e.CakeMap[5]="texiao05",e.BalloonMap[1]="texiao03",e.BalloonMap[2]="texiao02",e.BalloonMap[3]="texiao01",e.snowPiecesSourceMap[0]="layered_snow1_png",e.snowPiecesSourceMap[1]="layered_snow2_png",e.snowPiecesSourceMap[2]="layered_snow3_png",e.snowPiecesSourceMap[3]="layered_snow4_png",e.snowPiecesSourceMap[4]="layered_snow5_png",e.colorMixerSourceMap[2]=["color_mixer_bad_2_png","color_mixer_bad_2_png","color_mixer_bad_2_png","color_mixer_bad_2_png","color_mixer_2_png"],e.colorMixerSourceMap[3]=["color_mixer_bad_3_png","color_mixer_bad_3_png","color_mixer_bad_3_png","color_mixer_bad_3_png","color_mixer_3_png"],e.colorMixerSourceMap[4]=["color_mixer_bad_4_png","color_mixer_bad_4_png","color_mixer_bad_4_png","color_mixer_bad_4_png","color_mixer_4_png"],e.colorLineBombIconImgMap=(t={},t[CellConstants.COLOR_PINK]="icon_fhfen",t[CellConstants.COLOR_RED]="icon_fhhong",t[CellConstants.COLOR_ORANGE]="icon_fhhuang",t[CellConstants.COLOR_BLUE]="icon_fhlan",t[CellConstants.COLOR_GREEN]="icon_fhlv",t[CellConstants.COLOR_PURPLE]="icon_fhzi",t),e.colorSquareBombIconImgMap=(i={},i[CellConstants.COLOR_PINK]="icon_fzfen",i[CellConstants.COLOR_RED]="icon_fzhong",i[CellConstants.COLOR_ORANGE]="icon_fzhuang",i[CellConstants.COLOR_BLUE]="icon_fzlan",i[CellConstants.COLOR_GREEN]="icon_fzlv",i[CellConstants.COLOR_PURPLE]="icon_fzzi",i),e.elememtLineColorIconImgMap=(n={},n[CellConstants.COLOR_PINK]="ele_pink_col",n[CellConstants.COLOR_RED]="ele_red_col",n[CellConstants.COLOR_ORANGE]="ele_orange_row",n[CellConstants.COLOR_BLUE]="ele_blue_row",n[CellConstants.COLOR_GREEN]="ele_green_row",n[CellConstants.COLOR_PURPLE]="ele_purple_row",n),e.elememtSquareColorIconImgMap=(o={},o[CellConstants.COLOR_PINK]="ele_pink_bomb",o[CellConstants.COLOR_RED]="ele_red_bomb",o[CellConstants.COLOR_ORANGE]="ele_orange_bomb",o[CellConstants.COLOR_BLUE]="ele_blue_bomb",o[CellConstants.COLOR_GREEN]="ele_green_bomb",o[CellConstants.COLOR_PURPLE]="ele_purple_bomb",o);var t,i,n,o}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.ElementDisplaySourceMap={},e.CloudSourceMap={},e.TargetSourceMap={},e.GeneratorSourceMap={},e.ItemSourceMap={},e.EffectColorMap={},e.RocketTypeSourceMap={},e.RocketStateSourceMap={},e.CakeMap={},e.BalloonMap={},e.MatchComboEffect={},e.LayedSlateSourceMap={},e.puzzleSourceMap={},e.snowPiecesSourceMap={},e.colorMixerSourceMap={},e.colorLineBombIconImgMap={},e.colorSquareBombIconImgMap={},e.elememtLineColorIconImgMap={},e.elememtSquareColorIconImgMap={},e.BLOCKER_TYPE_START=1e3,e.LEAF_TYPE_START=2e3,e.LOCK_TYPE_START=3e3,e.BOUNDARY_TYPE_START=4e3,e.ELEMENT_TYPE_START=10,e.PUZZLE_BOTTOM=12,e.PUZZLE_FAKE_START=14,e.PUZZLE_ANCHORX_1=-25,e.PUZZLE_ANCHORY_1=-24,e.PUZZLE_ANCHORX_2=-xyd.TILE_WIDTH_HALF,e.PUZZLE_ANCHORY_2=-xyd.TILE_HEIGHT_HALF,e.DROP_DOWN=9,e.INSTANCE=null,e}();__reflect(DisplayConstants.prototype,"DisplayConstants");var EffectConstants=function(){function e(){}return e.NORMAL_DESTRUCTION_RED="normal_distruction_red",e.NORMAL_DESTRUCTION_ORANGE="normal_distruction_orange",e.NORMAL_DESTRUCTION_PINK="normal_distruction_violet",e.NORMAL_DESTRUCTION_GREEN="normal_distruction_green",e.NORMAL_DESTRUCTION_BLUE="normal_distruction_blue",e.NORMAL_DESTRUCTION_PURPLE="normal_distruction_yellow",e.ELEMENT_DESTRUCTION_JAR="blocker_distruction_jar",e.ELEMENT_DESTRUCTION_CAKE="special_distruction_cake",e.ELEMENT_DESTRUCTION_TIMBBOMB="blocker_distruction_bomb",e.ELEMENT_DESTRUCTION_LUCKYBAG="special_element_lucky_bag",e.ELEMENT_DESTRUCTION_GOLDENEGG="special_distruction_lucky_egg",e.ELEMENT_DESTRUCTION_BALLOON="special_effect_baloon",e.ELEMENT_DESTRUCTION_TORNADO="spetial_distruction_tornado",e.ELEMENT_DESTRUCTION_ACTIVE_TORNADO="spetial_active_tornado",e.ELEMENT_DESTRUCTION_CRAYON="special_effect_crayon",e.ELEMENT_DESTRUCTION_CRAYON_RUN="special_run_crayon",e.ROCKET_CLEAR="rocketclear",e.ROCKET_CLOUD="rocketcloud",e.ROCKET_BOOM="rocketboom",e.ROCKET_FIRE="rocketfire",e.COLORMIXER_ATTACK=["palette_attack_2","palette_attack_3","palette_attack_4"],e.COLORMIXER_FINISH="palette_finish",e.COLORMIXER_PAINT="palette_paint",e.BLOCKER_DESTRUCTION_COLORMIXER="palette_broken",e.BLOCKER_DESTRUCTION_SLATE="blocker_distruction_box",e.BLOCKER_DESTRUCTION_LAYED_SLATE="blocker_distruction_box",e.BLOCKER_DESTRUCTION_PUZZLE="blocker_jigsaw_showup",e.BLOCK_DESTRUCTION_CLOUD="blocker_cloud_disdruction",e.BLOCK_CLOUD_GENERATION="blocker_cloud_generation",e.BLOCK_SNOW_GENERATION="blocker_cloud_generation",e.BLOCKER_DESTRUCTION_SNOW="blocker_cloud_disdruction",e.BLOCKER_FAN_TRIGGER="special_effect_fan",e.LEAF_DESTRUCTION="blocker_distruction_leaf",e.LOCK_DESTRUCTION_SHACKLE="blocker_distruction_chain",e.LOCK_DESTRUCTION_ICE="blocker_distruction_ice",e.SPECIAL_GENERATION="special_generation",e.SPECIAL_GENERATION_SPEEDLINE="special_speed_line",e.SPECIAL_DESTRUCTION_COLOR_EFFECT="spetial_distruction_color_c",e.SPECIAL_DESTRUCTION_COLOR_THUNDER="spetial_distruction_color_l",e.SPECIAL_DESTRUCTION_COLOR_TARGET="spetial_distruction_color_b",e.SPECIAL_DESTRUCTION_COLOR_SINGLE="special_distruction_color_single",e.SPECIAL_DESTRUCTION_COLOR_DOUBLE="special_distruction_color_double",e.SPECIAL_DESTRUCTION_SQUARE="spetial_distruction_bomb",e.SPECIAL_DESTRUCTION_LINE="spetial_distruction_row",e.ITEM_WAND_EFFECT="item_effect_wand",e.ITEM_WAND_ACTIVE="special_wand_active",e.RECEIVE_STAR_EFFECT="xxl_jiaxing",e.STEPS_REMINDER="xxl_bushuguang",e.LEAF_HINT="leaf_hint",e.BASKET_EFFECT="lanzi",e.TIMEBOMB_EXPLODE="blocker_explode_bomb",e.TARGET_COLLECT_NORMAL="target_collect_normal",e.CHICKEN_JIGSAW="chicken_jigsaw",e.CHICKEN_JIGSAW_EFFECT="chicken_jigsaw_effect",e.BLOCKER_JIGSAW_DISTRUCTION="blocker_jigsaw_distruction",e.BOMB_FIREWORK="jigsaw_firework",e.JIGSAW_FIREWORK="fireworks_jigsaw",e.PORTAL_IN="portal_in",e.PORTAL_OUT="portal_out",e.CHICKEN_GUIDE="chicken_guide",e.ANNA_BOUNS_TIME="anna_bonus_time",e.CHICKEN_BOUNS_TIME="chicken_bonus_time",e.BOUNS_TIME="bonus_time",e.SHOOTING_STAR="bonus_time_star",e.COOK_PROGRESS_BAR="cook_progress_bar",e.COOK_PORGRESS_BAR_MASK="cook_progress_bar_mask",e.FURNITURE_ICON_HIGHLIGHT="furniture_icon_highlight",e.LATTER="latter",e.FURNITURE_DONE_LIGHT="furniture_done_light",e.NIGHT="normal_illuminant",e.BlACK_CURTAIN="Story_conversion",e.ADDITIVE_SPINE=["floor_polishing"],e.VIP_ADD_MOVES="vip_add_moves",e.VIP_MOVES_GLOW="vip_moves_glow",e
}();__reflect(EffectConstants.prototype,"EffectConstants");var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}return Object.defineProperty(e.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:!0,configurable:!0}),e.prototype.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},e.prototype.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,i=e.length;i>t;t++){var n=e[t];this._dataCache[n]=null,delete this._dataCache[n]}},e.prototype.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),i=0,n=t.length;n>i;i++){var o=t[i],a=this._dataCache[o];e.push(a)}return e},e.prototype.isCache=function(e){return this._dataCache[e]},e}();__reflect(DynamicChange.prototype,"DynamicChange");var GameEndInfo=function(){function e(){}return e.MOVES_LEFT="moves_left",e.MOVES_USED="moves_used",e.END_REASON="end_reason",e.SCORE="score",e.STARS="stars",e.LEAF_TARGET="leaf_target",e.LEAF_REMAIN="leaf_remain",e.LAMP_TARGET="lamp_target",e.LAMP_REMAIN="lamp_remain",e.CHAPTER="chapter",e.LEVEL="level",e.TOTAL_LEVEL="total_level",e.MODE="mode",e.LOWEST_SCORE_TARGET="lowest_score_target",e.TIME_BOMB_EXPLODED="time_bomb_exploded",e.OBJECTIVES_TARGET="objectives_target",e.OBJECTIVES_REMAIN="objectives_remain",e.GATHER_TASK="gather_task",e.GAME_COUNT="game_count",e.SPECIAL_DROPS="funds_count",e}();__reflect(GameEndInfo.prototype,"GameEndInfo");var GameEndReason=function(){function e(){}return e.Victory=0,e.ScoreTooLow=1,e.ClearLeafFailed=2,e.CollectLampsFailed=3,e.PlayerQuit=4,e.NoPossibleMoves=5,e.TimeBombExploded=6,e.CollectObjectivesFailed=7,e.BackBtnPressed=8,e.ColorMixerDestroyed=9,e}();__reflect(GameEndReason.prototype,"GameEndReason");var GameModeConstants=function(){function e(){}return e.CLASSIC_MOVES="Move",e.LEAF="Leaf",e.LAMP="Lamp",e.OBJECTIVE="Objective",e.LEAF_OBJECTIVE="LeafObjective",e.LEAF_LAMP="LeafLamp",e}();__reflect(GameModeConstants.prototype,"GameModeConstants");var GameViewConstants=function(){function e(){}return e.COLOR_NONE=0,e.COLOR_BLUE=1,e.COLOR_GREEN=2,e.COLOR_ORANGE=3,e.COLOR_PURPLE=4,e.COLOR_RED=5,e.COLOR_YELLOW=6,e.COLOR_BROWN=7,e.VIEW_PREPARE_COMPLETE="viewPrepareComplete",e.Z_ITEM=0,e.FEEDBACK_SWEET=0,e.FEEDBACK_TASTY=1,e.FEEDBACK_DELICIOUS=2,e.FEEDBACK_DIVINE=3,e.FEEDBACK_SUGARCRUSH=99,e.FEEDBACK_FROGTASTIC=98,e}();__reflect(GameViewConstants.prototype,"GameViewConstants");var GameWindowConstants=function(){function e(){}return e.NORMAL=1e3,e.WAND=1004,e.HAMMER=1005,e.SWAP=1007,e.STICK=1008,e.INGAME_ADD_FIVE_STEPS=1018,e.COLOR_LINE_BOMB_PACK=1019,e.COLOR_SQUARE_BOMB_PACK=1020,e}();__reflect(GameWindowConstants.prototype,"GameWindowConstants");var GeneratorConstant=function(){function e(){}return e.GENERATOR_MAP=(_a={},_a[ElementTypeConstants.BOX]=CellConstants.GENERATOR_BOX,_a[ElementTypeConstants.TIME_BOMB]=CellConstants.GENERATOR_TIME_BOMB,_a[ElementTypeConstants.LAMP_1]=CellConstants.GENERATOR_LAMP,_a[ElementTypeConstants.LAMP_2]=CellConstants.GENERATOR_LAMP,_a[ElementTypeConstants.LUCKY_BAG]=CellConstants.GENERATOR_LUCKY_BAG,_a[ElementTypeConstants.BLACK_HOLE]=CellConstants.GENERATOR_BLACK_HOLE,_a[ElementTypeConstants.BOMB_COL]=CellConstants.GENERATOR_BOMB_COL,_a[ElementTypeConstants.BOMB_ROW]=CellConstants.GENERATOR_BOMB_ROW,_a[ElementTypeConstants.BOMB_SQUARE]=CellConstants.GENERATOR_BOMB_SQUARE,_a[ElementTypeConstants.SCISSOR]=CellConstants.GENERATOR_SCISSOR,_a[ElementTypeConstants.CAKE]=CellConstants.GENERATOR_CAKE,_a[ElementTypeConstants.GOLDEN_EGG]=CellConstants.GENERATOR_GOLDEN_EGG,_a[ElementTypeConstants.BOMB_COLOR]=CellConstants.GENERATOR_COLOR_BOMB,_a[ElementTypeConstants.TORNADO]=CellConstants.GENERATOR_TORNADO,_a),e}();__reflect(GeneratorConstant.prototype,"GeneratorConstant");var _a,ItemConstants=function(){function e(){}return e.LIMITED_TIME_OFFSET=1e3,e.UNLIMITED_TIME_OFFSET=2e3,e.ROCKET=999,e.NORMAL=1e3,e.COLOR_BOMB=1001,e.TORNADO=1002,e.CRAYON=1003,e.WAND=1004,e.HAMMER=1005,e.LINE_SQUARE_BOMB_PACK=1006,e.SWAPPER=1007,e.STICKER=1008,e.ADD_FIVE_STEPS=1010,e.HALF_HOUR_STAMINA=1012,e.ONE_HOUR_STAMINA=1014,e.TWO_HOUR_STAMINA=1015,e.ADD_THREE_STEPS=1016,e.LINE_BOMB=1017,e.INGAME_ADD_FIVE_STEPS=1018,e.COLOR_LINE_BOMB_PACK=1019,e.COLOR_SQUARE_BOMB_PACK=1020,e.COLOR_BOMB_TIME=2001,e.TORNADO_TIME=2002,e.CRAYON_TIME=2003,e.WAND_TIME=2004,e.HAMMER_TIME=2005,e.LINE_SQUARE_BOMB_PACK_TIME=2006,e.SWAPPER_TIME=2007,e.STICKER_TIME=2008,e.LINE_BOMB_TIME=2017,e.INGAME_ADD_FIVE_STEPS_TIME=2018,e.COLOR_LINE_BOMB_PACK_TIME=2019,e.COLOR_SQUARE_BOMB_PACK_TIME=2020,e.COLOR_BOMB_UNLIMITED_TIME=3001,e.TORNADO_UNLIMITED_TIME=3002,e.CRAYON_UNLIMITED_TIME=3003,e.WAND_UNLIMITED_TIME=3004,e.HAMMER_UNLIMITED_TIME=3005,e.LINE_SQUARE_BOMB_PACK_UNLIMITED_TIME=3006,e.SWAPPER_UNLIMITED_TIME=3007,e.STICK_UNLIMITED_TIME=3008,e.LINE_BOMB_UNLIMITED_TIME=3017,e.HAMMER_IMG="icon_chuizi_png",e.SWAPPER_IMG="icon_weizhijiaohuan_png",e.WAND_IMG="icon_mobang_png",e.STICKER_IMG="icon_tiezhi_png",e.HAMMER_TIP="HAMMER_TIPS",e.SWAPPER_TIP="SWAPPER_TIPS",e.WAND_TIP="",e.STICKER_TIP="STICKER_TIPS",e.ROCKET_TIP="ROCKET_TIPS",e.ITEM_IMGS=[e.HAMMER_IMG,e.SWAPPER_IMG,e.WAND_IMG,e.STICKER_IMG],e.ITEM_TIPS=[e.HAMMER_TIP,e.SWAPPER_TIP,e.WAND_TIP,e.STICKER_TIP],e.CLEAR_STREAK_REWARDS=[e.COLOR_BOMB,e.LINE_SQUARE_BOMB_PACK,e.ADD_THREE_STEPS,e.LINE_SQUARE_BOMB_PACK,e.COLOR_BOMB],e.ITEM_PRICE={1001:20,1002:40,1003:100,1004:100,1005:40,1006:40,1007:50,1008:80,1010:50,1011:100,1017:20,1018:100,1019:400,1020:400},e.INF_STAMINA_IDS=[e.HALF_HOUR_STAMINA,e.ONE_HOUR_STAMINA,e.TWO_HOUR_STAMINA],e}();__reflect(ItemConstants.prototype,"ItemConstants");var ItemRemovalReasonConstants=function(){function e(){}return e.DEFAULT=0,e.INGREDIENT_COLLECTED=1,e.MULOCK_KEY_COLLECTED=2,e}();__reflect(ItemRemovalReasonConstants.prototype,"ItemRemovalReasonConstants");var MatchComboConstants=function(){function e(){}return e.GOOD_NUM=4,e.GREAT_NUM=6,e.WONDERFUL_NUM=9,e.FANTASTIC_NUM=12,e.TYPE_GOOD=1,e.TYPE_GREAT=2,e.TYPE_WONDERFUL=3,e.TYPE_FANTASTIC=4,e}();__reflect(MatchComboConstants.prototype,"MatchComboConstants");var ProxyUpdate=function(){function e(e){this._cache=e}return e.prototype.isArray=function(e){return e instanceof Array},e.prototype.isObject=function(e){return e.indexOf("object")>-1},e.prototype.isNormal=function(e){var t=e.indexOf("@")>-1,i=e.indexOf(".")>-1,n=e.indexOf("_")>-1;return!t&&!i&&!n},e.prototype.isAddToArray=function(e){return"@a"==e},e.prototype.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},e.prototype.isFilter=function(e){var t=e.split("_");return"@f"==t[0]},e.prototype.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},e.prototype._updateObject=function(e,t,i){var n=e.split(".");"@a"==n[0]||"@s"==n[0]?i[n[1]]=t:"@d"==n[0]&&delete i[n[1]]},e.prototype._getFilterObject=function(e,t){if(t){var i=e.split("_");if(3==i.length&&"@f"==i[0]&&this.isArray(t))for(var n=i[1],o=i[2],a=0;a<t.length;a++){var s=t[a];if(3==i.length&&this.isObject(s.toString())){var r=s[n];if(r&&("@"==o[0]&&(o=o.replace("@","")),o==r))return s}}}return null},e.prototype._addObjectToArray=function(e,t){if(this.isArray(t))for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t)},e.prototype._removeObjectFromArray=function(e,t,i){var n=t.split("_");if(n.length<=3&&"@d"==n[0]&&this.isArray(e))for(var o=e.length,a=o-1;a>=0;a--){var s=e[a];if(3==n.length){if(s.hasOwnProperty(n[1])){var r=n[2];"@"==r[0]&&(r=r.replace("@","")),r==s[n[1]]&&e.splice(a,1)}}else 2==n.length&&s.hasOwnProperty(n[1])?i==s[n[1]]&&e.splice(a,1):1==n.length&&i==s&&e.splice(a,1)}},e.prototype.update=function(e,t){if(this._cache[e]=t,t.hasOwnProperty("c"))for(var i=t.c,n=Object.keys(i),o=0,a=n.length;a>o;o++){var s=n[o];this._cache[s]&&(this._update(this._cache[s],i[s]),App.MessageCenter.dispatch(s+"_HttpUpdate"))}},e.prototype._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var i=Object.keys(t),n=0,o=i.length;o>n;n++){var a=i[n],s=t[a];if(this.isNormal(a)&&this.isObject(s.toString()))e.hasOwnProperty(a)&&this._update(e[a],s);else if(this.isNormal(a)&&this.isNumeric(s)){var r=e[a];e[a]=r+s}else if(this.isNormal(a))e[a]=s;else if(this.isAddToArray(a))this._addObjectToArray(e,s);else if(this.isRemoveToArray(a))this._removeObjectFromArray(e,a,s);else if(this.isFilter(a)){var l=this._getFilterObject(a,e);l&&this._update(l,s)}else this._updateObject(a,s,e)}},e}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var ObjectiveConstants=function(){function e(){}return e.getObjectiveScore=function(t){return e.OBJECTIVE_SCORE[t]||0},e.TARGET_COLOR_1=1,e.TARGET_COLOR_2=2,e.TARGET_COLOR_3=3,e.TARGET_COLOR_4=4,e.TARGET_COLOR_5=5,e.TARGET_COLOR_6=6,e.CELL_COLOR_TO_TARGET=(_a={},_a[CellConstants.CELL_COLOR_A]=e.TARGET_COLOR_1,_a[CellConstants.CELL_COLOR_C]=e.TARGET_COLOR_2,_a[CellConstants.CELL_COLOR_B]=e.TARGET_COLOR_3,_a[CellConstants.CELL_COLOR_E]=e.TARGET_COLOR_4,_a[CellConstants.CELL_COLOR_F]=e.TARGET_COLOR_5,_a[CellConstants.CELL_COLOR_D]=e.TARGET_COLOR_6,_a),e.BOMB_SQUARE=7,e.BOMB_LINE=8,e.BOMB_COLOR=9,e.LINE_LINE_SWAP=10,e.LINE_SQUARE_SWAP=11,e.COLOR_LINE_SWAP=12,e.COLOR_COLOR_SWAP=13,e.COLOR_SQUARE_SWAP=14,e.SQUARE_SQUARE_SWAP=15,e.CLOUD=16,e.SLATE=17,e.BALLOON=18,e.BOX=19,e.TIME_BOMB=20,e.TORNADO=21,e.PUZZLE=22,e.LUCKY_BAG=23,e.COLOR_MIXER=24,e.CAKE=25,e.SNOW=26,e.STONE=99,e.OBJECTIVE_SCORE=(_b={},_b[e.TARGET_COLOR_1]=100,_b[e.TARGET_COLOR_2]=100,_b[e.TARGET_COLOR_3]=100,_b[e.TARGET_COLOR_4]=100,_b[e.TARGET_COLOR_5]=100,_b[e.TARGET_COLOR_6]=100,_b[e.BOMB_SQUARE]=1e3,_b[e.BOMB_LINE]=1e3,_b[e.BOMB_COLOR]=1e3,_b[e.LINE_LINE_SWAP]=5e3,_b[e.LINE_SQUARE_SWAP]=5e3,_b[e.COLOR_LINE_SWAP]=5e3,_b[e.COLOR_COLOR_SWAP]=5e3,_b[e.COLOR_SQUARE_SWAP]=5e3,_b[e.CLOUD]=100,_b[e.SLATE]=100,_b[e.BOX]=100,_b[e.TIME_BOMB]=100,_b[e.TORNADO]=100,_b[e.PUZZLE]=100,_b[e.CAKE]=100,_b[e.LUCKY_BAG]=100,_b),e.OBJECTIVE_TO_ELEMENTTYPE_MAP=(_c={},_c[e.SQUARE_SQUARE_SWAP]=[ElementTypeConstants.BOMB_SQUARE],_c[e.BOMB_SQUARE]=[ElementTypeConstants.BOMB_SQUARE],_c[e.BOMB_LINE]=[ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_ROW],_c[e.BOMB_COLOR]=[ElementTypeConstants.BOMB_COLOR],_c[e.LINE_LINE_SWAP]=[ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_ROW],_c[e.LINE_SQUARE_SWAP]=[ElementTypeConstants.BOMB_SQUARE,ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_ROW],_c[e.COLOR_LINE_SWAP]=[ElementTypeConstants.BOMB_COL,ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_ROW],_c[e.COLOR_COLOR_SWAP]=[ElementTypeConstants.BOMB_COLOR],_c[e.COLOR_SQUARE_SWAP]=[ElementTypeConstants.BOMB_COLOR,ElementTypeConstants.BOMB_SQUARE],_c[e.BOX]=[ElementTypeConstants.BOX],_c[e.TIME_BOMB]=[ElementTypeConstants.TIME_BOMB],_c[e.TORNADO]=[ElementTypeConstants.TORNADO],_c[e.CAKE]=[ElementTypeConstants.CAKE],_c[e.LUCKY_BAG]=[ElementTypeConstants.LUCKY_BAG],_c[e.BALLOON]=[ElementTypeConstants.BALLOON],_c),e.OBJECTIVE_TO_BLOCKER_MAP=(_d={},_d[e.CLOUD]=[BlockerConstant.CLOUD],_d[e.SLATE]=[BlockerConstant.SLATE,BlockerConstant.LAYED_SLATE],_d[e.PUZZLE]=[BlockerConstant.PUZZLE],_d[e.SNOW]=[BlockerConstant.SNOW],_d[e.COLOR_MIXER]=[BlockerConstant.COLOR_MIXER],_d),e.OBJECTIVE_COUNT_ELEMENTTYPE_MAP=(_e={},_e[ElementTypeConstants.CAKE]=1,_e),e.OBJECTIVE_COUNT_BLOCKER_MAP=(_f={},_f[BlockerConstant.LAYED_SLATE]=1,_f),e.OBJECTIVE_TO_COLOR_MAP=(_g={},_g[e.TARGET_COLOR_1]=CellConstants.CELL_COLOR_A,_g[e.TARGET_COLOR_2]=CellConstants.CELL_COLOR_C,_g[e.TARGET_COLOR_3]=CellConstants.CELL_COLOR_B,_g[e.TARGET_COLOR_4]=CellConstants.CELL_COLOR_E,_g[e.TARGET_COLOR_5]=CellConstants.CELL_COLOR_F,_g[e.TARGET_COLOR_6]=CellConstants.CELL_COLOR_D,_g),e.BLOCKER_OBJECTIVES_SET=[e.CLOUD,e.SLATE,e.SNOW,e.COLOR_MIXER],e.OBJECTIVE_TO_MIXERTYPE_MAP=(_h={},_h[e.CLOUD]=BlockerConstant.CLOUD,_h[e.BOX]=ElementTypeConstants.BOX,_h[e.SLATE]=BlockerConstant.LAYED_SLATE,_h),e}();__reflect(ObjectiveConstants.prototype,"ObjectiveConstants");var _a,_b,_c,_d,_e,_f,_g,_h,PregameItemConstants=function(){function e(){}return e.ColorBomb=0,e.LineSquarePack=0,e.Tornado=.5,e.Crayon=.3,e.LineBomb=0,e}();__reflect(PregameItemConstants.prototype,"PregameItemConstants");var ScoreConstants=function(){function e(){}return e.LEAF=1e3,e.ELEMENT=20,e.SPEICAL_ELEMENT=3e3,e.LAMP=1e4,e.BOX=20,e.TIME_BOMB=3e3,e.BOMB_COLOR=1e4,e.BOMB_SQUARE=540,e.TORNADO=20,e.ELEMENET_IN_DP_LINE=60,e.PUZZLE=6e3,e.COLOR_MIXER=700,e}();__reflect(ScoreConstants.prototype,"ScoreConstants");var SpecialSwapConstants=function(){function e(){}return e.NONE="None",e.LINE_LINE_SWAP="LineLineSwap",e.LINE_SQUARE_SWAP="LineSquareSwap",e.COLOR_LINE_SWAP="ColorLineSwap",e.COLOR_COLOR_SWAP="ColorColorSwap",e.COLOR_SQUARE_SWAP="ColorSquareSwap",e.SQUARE_SQUARE_SWAP="SquareSquareSwap",e.NORMAL_COLOR_SWAP="NormalColorSwap",e.CRAYON_SWAP="CrayonSwap",e.NORMAL_CRAYON_SWAP="NormalCrayonSwap",e.WAND_ELEMENT_SWAP="WandElementSwap",e.TORNADO_SPECIAL_SWAP="TornadoSpecialeSwap",e.ROCKET_SPECIAL_SWAP="RocketSpecialSwap",e.COLOR_TORNADO_SWAP="ColorTornadoSwap",e}();__reflect(SpecialSwapConstants.prototype,"SpecialSwapConstants");var TypeConverter=function(){function e(){}return e.getCellPropertyForELement=function(t){var i=-1;if(t)if(i=e.ELEMENT_TO_CELL_MAP[t.type],t.type==ElementTypeConstants.CAKE){var n=t,o=n.hp;i=i+o-1}else if(t.type==ElementTypeConstants.BALLOON){var a=t,o=a.hp;i=i+o-1}return i},e.getCellPropertyForBlocker=function(t){var i=-1;if(t)if(i=e.BLOCKER_TO_CELL_MAP[t.type],t.type==BlockerConstant.LAYED_SLATE)i+=t.health-1;else if(t.type==BlockerConstant.PUZZLE)i+=t.health;else if(t.type==BlockerConstant.SNOW)i+=t.health-1;else if(t.type==BlockerConstant.COLOR_MIXER)i+=t.health-1;else if(t.type==BlockerConstant.FENCE){var n=t;i+=n.direction}else if(t.type==BlockerConstant.CURLS){var o=t;i+=4*(o.health-1)+o.direction}return i},e.ELEMENT_TO_CELL_MAP=(_a={},_a[ElementTypeConstants.NORMAL]=CellConstants.NORMAL_ELEMENT,_a[ElementTypeConstants.BOMB_COL]=CellConstants.BOMB_COL,_a[ElementTypeConstants.BOMB_ROW]=CellConstants.BOMB_ROW,_a[ElementTypeConstants.BOMB_SQUARE]=CellConstants.BOMB_SQUARE,_a[ElementTypeConstants.BOMB_COLOR]=CellConstants.BOMB_COLOR,_a[ElementTypeConstants.LAMP_1]=CellConstants.LAMP1,_a[ElementTypeConstants.LAMP_2]=CellConstants.LAMP2,_a[ElementTypeConstants.BOX]=CellConstants.BOX,_a[ElementTypeConstants.TIME_BOMB]=CellConstants.TIME_BOMB,_a[ElementTypeConstants.LUCKY_BAG]=CellConstants.LUCKY_BAG,_a[ElementTypeConstants.CRAYON]=CellConstants.CRAYON,_a[ElementTypeConstants.TORNADO]=CellConstants.TORNADO,_a[ElementTypeConstants.BLACK_HOLE]=CellConstants.BLACK_HOLE,_a[ElementTypeConstants.CAKE]=CellConstants.CAKE_1,_a[ElementTypeConstants.WAND]=CellConstants.WAND,_a[ElementTypeConstants.GOLDEN_EGG]=CellConstants.GOLDEN_EGG,_a[ElementTypeConstants.ROCKET]=CellConstants.ROCKET,_a[ElementTypeConstants.SCISSOR]=CellConstants.SCISSOR,_a[ElementTypeConstants.BALLOON]=CellConstants.BALLOON_1,_a),e.BLOCKER_TO_CELL_MAP=(_b={},_b[BlockerConstant.SLATE]=CellConstants.SLATE,_b[BlockerConstant.CLOUD]=CellConstants.CLOUD,_b[BlockerConstant.CLOUD_MAKER]=CellConstants.CLOUD_MAKER,_b[BlockerConstant.LAYED_SLATE]=CellConstants.LAYED_SLATE_1,_b[BlockerConstant.PUZZLE]=CellConstants.PUZZLE,_b[BlockerConstant.CLOUD_ROCKET]=CellConstants.CLOUD_ROCKET,_b[BlockerConstant.SNOW]=CellConstants.SNOW_1,_b[BlockerConstant.COLOR_MIXER]=CellConstants.COLOR_MIXER_1,_b[BlockerConstant.FAN]=CellConstants.FAN,_b[BlockerConstant.FENCE]=CellConstants.FENCE_UP,_b[BlockerConstant.CURLS]=CellConstants.CURLS_UP_1,_b),e.LOCK_TO_CELL_MAP=(_c={},_c[LOCK_TYPE.GIFT_WRAPPER]=CellConstants.GIFT_WRAPPER_1,_c[LOCK_TYPE.ICE]=CellConstants.ICE,_c[LOCK_TYPE.SHACKLE]=CellConstants.SHACKLE,_c),e.CELL_TO_COLORMIXER_ELEMENTS_INDEX_MAP=(_d={},_d[CellConstants.TIME_BOMB]=1,_d[CellConstants.BOX]=2,_d[CellConstants.SLATE]=3,_d[CellConstants.LAYED_SLATE_2]=4,_d[CellConstants.LAYED_SLATE_3]=5,_d[CellConstants.LAYED_SLATE_4]=6,_d[CellConstants.LAYED_SLATE_5]=7,_d[CellConstants.CLOUD]=8,_d[CellConstants.SHACKLE]=9,_d[CellConstants.ICE]=10,_d),e}();__reflect(TypeConverter.prototype,"TypeConverter");var _a,_b,_c,_d,Http=function(e){function t(){var t=e.call(this)||this;return t.msgUrl=platform.getMsgUrl(),t._data=new DynamicChange,t._cache=[],t._request=new egret.URLRequest,t._request.method=egret.URLRequestMethod.POST,t._urlLoader=new egret.URLLoader,t._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,t.onError,t),t}return __extends(t,e),t.get=function(){return t.getInstance()},Object.defineProperty(t.prototype,"Data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.onError=function(e){this._callback&&this._callback(null,!1),this.nextPost()},t.prototype.send=function(e,t,i){this._cache.push([i,t,e]),this.post()},t.prototype.post=function(){if(!this._isRequesting&&0!=this._cache.length){var e=this._cache.shift(),t=e[0],i=e[1];this._callback=t,this._request.url=e[2],this._request.data=i,this._request.method=egret.URLRequestMethod.POST,this._urlLoader.dataFormat=egret.URLLoaderDataFormat.VARIABLES,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.load(this._request),this._isRequesting=!0}},t.prototype.onLoaderComplete=function(e){console.log(this._urlLoader.data),this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this);var t=JSON.parse(this._urlLoader.data);this._callback&&this._callback(t,!0),this.nextPost()},t.prototype.nextPost=function(){this._isRequesting=!1,this.post()},t.prototype.getPayLoad=function(e,t){t.mid=e,t.version=platform.getVersion();var i=new egret.URLVariables;return i.variables={payload:JSON.stringify(t)},i},t.prototype.sendMessage=function(e,i,n){var o=this;return void 0===n&&(n=!1),new Promise(function(n,a){try{t.getInstance().send(o.msgUrl,o.getPayLoad(e,i),function(t,i){i?n(t):a("Network Error on SendMessage "+e)})}catch(s){a("Network Error on SendMessage "+e)}})},t}(BaseClass);__reflect(Http.prototype,"Http");var GuideTable=function(e){function t(){var t=e.call(this,"guide_json")||this;t._levelToGuides={},t._levelToTest={},t._data={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t._data[o]={};for(var s in i){var r=i[s],l=Number(a[r]);isNaN(l)?a[r].indexOf("|")<0?t._data[o][s]=a[r]:t._data[o][s]=xyd.split(a[r],"|",!0):0!=l?(t._data[o][s]=l,"total_level"==s?(void 0==t._levelToGuides[l]&&(t._levelToGuides[l]=[]),t._levelToGuides[l].push(o)):("highlight"==s||"element_type"==s)&&(t._data[o][s]=[l])):t._data[o][s]=void 0}}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.getTableRow=function(){return this.tableJson.rows},t.prototype.getTableData=function(e){return this._data[e]},t.prototype.hasGuideID=function(e){return void 0!=this._data[e]?!0:!1},t.prototype.getGuideIDsByLevel=function(e){var t=[];if(this._levelToGuides[e]){var i=this._levelToGuides[e][0],n=this._data[i];if(1!=n.has_abtest)return this._levelToGuides[e];var o=n.abtest_name,a=ABTest.CONTROL_GROUP;if("seven_day_buying_group"==o&&ABTest.get().getSetting(ABTest.NEW_FUNDS_GUIDE)&&MainController.get().getGame()&&MainController.get().getGame().getEngine()&&MainController.get().getGame().getEngine().getBoard()&&MainController.get().getGame().getEngine().getBoard().getSpecialDropHandler()){for(var s=0,r=this._levelToGuides[e];s<r.length;s++){var l=r[s],_=this._data[l];"red_bag_guide"==_.abtest_name&&t.push(l)}return t}ABTest.get().getSetting(o)&&!SelfInfo.get().isInMission&&(a=ABTest.TEST_GROUP);for(var h=0,c=this._levelToGuides[e];h<c.length;h++){var l=c[h],_=this._data[l];_.abtest_group==a&&t.push(l)}}return t},t.prototype.getTotalLevel=function(e){return this._data[e].total_level},t.prototype.getRandomSeed=function(e){return this._data[e].random_seed},t.prototype.getCharacterPos=function(e){return this._data[e].character_pos},t.prototype.getTipPos=function(e){return this._data[e].tip_pos},t.prototype.getCharacterAct=function(e){return this._data[e].character_act},t.prototype.getHighlight=function(e){return this._data[e].highlight},t.prototype.getElementType=function(e){return this._data[e].element_type},t.prototype.getHighlighType=function(e){return this._data[e].highlight_type},t.prototype.getManual=function(e){var t=this._data[e].manual;return t instanceof Array?t:!isNaN(Number(t))&&t>0?[t]:void 0},t.prototype.getTipText=function(e){return this._data[e].tip_text},t.prototype.getTipText2=function(e){return this._data[e].tip_text_1},t.prototype.getTipText3=function(e){return this._data[e].tip_text_2},t.prototype.getTipText4=function(e){return this._data[e].tip_text_3},t.prototype.getTipPic=function(e){return this._data[e].image_1},t.prototype.getTipPic2=function(e){return this._data[e].image_2},t.prototype.getItemType=function(e){return this._data[e].item_type},t.prototype.getCanSkip=function(e){return this._data[e].can_skip&&1==this._data[e].can_skip?!0:!1},t.prototype.hasAbtest=function(e){return this._data[e].has_abtest&&1==this._data[e].has_abtest?!0:!1},t.prototype.getAbtestName=function(e){return this._data[e].abtest_name},t.prototype.getAbtestGroup=function(e){return this._data[e].abtest_group},t.prototype.getScoreTargets=function(e){return this._data[e].score_targets},t.INSTANCE=null,t}(BaseTable);__reflect(GuideTable.prototype,"GuideTable");var ItemTable=function(e){function t(){var t=e.call(this,"item_json")||this;t.dataParams_={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t.dataParams_[o]={};a[1];for(var s in i){var r=i[s],l=Number(a[r]);isNaN(l)?a[r].indexOf("|")<0?t.dataParams_[o][s]=a[r]:t.dataParams_[o][s]=xyd.split(a[r],"|",!0):t.dataParams_[o][s]=l}}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.getTableData=function(){return this.tableJson.rows},t.prototype.getTableDataByItemID=function(e){return void 0!=e?this.dataParams_[e]:void 0},t.INSTANCE=null,t}(BaseTable);__reflect(ItemTable.prototype,"ItemTable");var LevelTable=function(e){function t(){var t=e.call(this,"level_config_json")||this;t.lastIndex=0,t.nowWrapMapStartIndex=0,t.wrapMapCount=[],t.maxWrap=0,t.blankLineNum=0,t.lastIndexNoWheel=0,t.nowWrapMapStartIndexNoWheel=0,t.wrapMapCountNoWheel=[],t.maxWrapNoWheel=0,t.blankLineNumNoWheel=0,t.dataParamsLength=0,t.isClip=!1,t.dataParams_={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t.dataParams_[o]={};for(var s in i){var r=i[s],l=Number(a[r]);isNaN(l)?a[r].indexOf("|")<0?t.dataParams_[o][s]=a[r]:t.dataParams_[o][s]=xyd.split(a[r],"|",!0):t.dataParams_[o][s]=l}t.dataParamsLength++}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.init=function(){for(var e in this.tableJson.rows){var t=Number(e),i=Number(this.dataParams_[t].map);0!=i?(i!=this.lastIndex&&(this.nowWrapMapStartIndex=t,this.wrapMapCount.push(this.nowWrapMapStartIndex),this.lastIndex=i,this.maxWrap=this.wrapMapCount.length),this.dataParams_[t].wrap=this.wrapMapCount.length):this.blankLineNum++;var n=Number(this.dataParams_[t].map_new);0!=n?(n!=this.lastIndexNoWheel&&(this.nowWrapMapStartIndexNoWheel=t,this.wrapMapCountNoWheel.push(this.nowWrapMapStartIndexNoWheel),this.lastIndexNoWheel=n,this.maxWrapNoWheel=this.wrapMapCountNoWheel.length),this.dataParams_[t].wrapNoWheel=this.wrapMapCountNoWheel.length):this.blankLineNumNoWheel++}},t.prototype.Clip=function(){if(!this.isClip){var e=!0,t=this.dataParamsLength;if(e)for(var i=0;i<this.blankLineNumNoWheel;i++)delete this.dataParams_[t-i];else for(var i=0;i<this.blankLineNum;i++)delete this.dataParams_[t-i];this.isClip=!0}},t.prototype.getTableRow=function(){return this.tableJson.rows},t.prototype.getWrapMapStartLevel=function(e,t){if(t){if(e<=this.wrapMapCountNoWheel.length)return this.wrapMapCountNoWheel[e-1]}else if(e<=this.wrapMapCount.length)return this.wrapMapCount[e-1]},t.prototype.getTableData=function(e){return this.dataParams_[e]},t.prototype.getNextPacket=function(e){return this.dataParams_[e].next_packet},t.prototype.getNextPacketGuide=function(e){return this.dataParams_[e].next_packet_guide},t.prototype.getMaxWarp=function(e){return e?this.maxWrapNoWheel:this.maxWrap},t.prototype.getNextWheel=function(e){return this.dataParams_[e].next_wheel},t.prototype.getNextWheelStage=function(e){for(var t=e;;t++){if(!this.dataParams_[t])return 0;var i=this.dataParams_[t].lucky_wheel;if(i)return t}},t.INSTANCE=null,t}(BaseTable);__reflect(LevelTable.prototype,"LevelTable");var MapEffectTable=function(e){function t(){var t=e.call(this,"map_effect_json")||this;t.dataParams_={},t.dataMaps_={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t.dataParams_[o]={};var s=a[1];void 0==t.dataMaps_[s]?(t.dataMaps_[s]=[],t.dataMaps_[s].push(o)):t.dataMaps_[s].push(o);for(var r in i){var l=i[r],_=Number(a[l]);isNaN(_)?a[l].indexOf("|")<0?t.dataParams_[o][r]=a[l]:t.dataParams_[o][r]=xyd.split(a[l],"|",!0):t.dataParams_[o][r]=_}}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.getTableData=function(){return this.tableJson.rows},t.prototype.getTableDataByMapType=function(e){return this.dataMaps_[e]},t.prototype.getTableDataByIndex=function(e){return this.dataParams_[e]},t.INSTANCE=null,t}(BaseTable);__reflect(MapEffectTable.prototype,"MapEffectTable");var MapPosTable=function(e){function t(){var t=e.call(this,"map_pos_json")||this;t.dataParams_={},t.dataMaps_={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t.dataParams_[o]={};var s=a[1];void 0==t.dataMaps_[s]?(t.dataMaps_[s]=[],t.dataMaps_[s].push(a)):t.dataMaps_[s].push(a);for(var r in i){var l=i[r],_=Number(a[l]);isNaN(_)?a[l].indexOf("|")<0?t.dataParams_[o][r]=a[l]:t.dataParams_[o][r]=xyd.split(a[l],"|",!0):t.dataParams_[o][r]=_}}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.getTableData=function(){return this.tableJson.rows},t.prototype.getTableDataByTileType=function(e){return this.dataMaps_[e+1]},t.prototype.getTableDataByChapterID=function(e){return this.dataParams_[e]},t.INSTANCE=null,t}(BaseTable);__reflect(MapPosTable.prototype,"MapPosTable");var SoundPriorityTable=function(e){function t(){var t=e.call(this,"sound_priority_json")||this;t.soundParams_={},t._maxPriority=0,t.dataParams_={};var i=t.tableJson.keys;for(var n in t.tableJson.rows){var o=Number(n),a=t.tableJson.rows[o];t.dataParams_[o]={};a[1];for(var s in i){var r=i[s],l=Number(a[r]);if(isNaN(l)?a[r].indexOf("|")<0?t.dataParams_[o][s]=a[r]:t.dataParams_[o][s]=xyd.split(a[r],"|",!0):t.dataParams_[o][s]=l,"priority"==s){var _=Number(t.dataParams_[o][s]);_>t._maxPriority&&(t._maxPriority=_)}}t.soundParams_[t.dataParams_[o].name]={},t.soundParams_[t.dataParams_[o].name]=t.dataParams_[o]}return t}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.getAllSoundPriorityInfo=function(){return this.dataParams_},t.prototype.getMaxSoundPriority=function(){return this._maxPriority},t.prototype.getSoundPriority=function(e){return this.soundParams_[e]?this.soundParams_[e].priority?this.soundParams_[e].priority:void 0:0},t.prototype.getSoundTime=function(e){return this.soundParams_[e]?this.soundParams_[e].sound_time?this.soundParams_[e].sound_time:void 0:0},t.prototype.getUnloadType=function(e){return this.soundParams_[e]?this.soundParams_[e].unload_type:0},t.prototype.getSoundCd=function(e){return this.soundParams_[e]&&this.soundParams_[e].random_upper?new egret.Point(this.soundParams_[e].random_lower,this.soundParams_[e].random_upper):new egret.Point(0,0)},t.INSTANCE=null,t}(BaseTable);__reflect(SoundPriorityTable.prototype,"SoundPriorityTable");var TranslationTable=function(e){function t(){return e.call(this,"translation_"+xyd.Global.lang.toLowerCase()+"_json")||this}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.translation=function(e){var t=String(e).split("|");if(t.length>1){var i=Math.round(Math.random()*(t.length-1));return this.tableJson.rows[t[i]]}return this.tableJson.rows[e]||""},t.prototype.translate=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=this.translation(e),o=t.slice(0,t.length);o.splice(0,0,n);var a=xyd.stringFormat.apply(null,o).replace(/{BOSS}/g,xyd.Global.playerName).replace(/undefined/g,"").replace(/\\n/g,"\n").replace(/{cat}/g,xyd.Global.catName);return a},t.prototype.update=function(e){var t=e,i=t.keys,n=(i.translation,t.rows);for(var o in n){var a=xyd.utf8_to_str(o),s=xyd.utf8_to_str(n[o]);this.tableJson.rows[a]=s}},t}(BaseTable);__reflect(TranslationTable.prototype,"TranslationTable");var WindowTable=function(e){function t(){return e.call(this,"window_json")||this}return __extends(t,e),t.get=function(){return null==t.INSTANCE&&(t.INSTANCE=new t),t.INSTANCE},t.prototype.hasWindow=function(e){return null!=this.getString(e,"class")},t.prototype.className=function(e){return this.getString(e,"class")},t.prototype.layerType=function(e){return this.getNumber(e,"layer_type")},t.prototype.backType=function(e){return this.getNumber(e,"back_type")},t.prototype.showLoading=function(e){return this.getNumber(e,"show_loading")>0},t.prototype.openAnimation=function(e){return this.getNumber(e,"open_animation")>0},t.INSTANCE=null,t}(BaseTable);__reflect(WindowTable.prototype,"WindowTable");var BeltCellView=function(e){function t(t){var i=e.call(this)||this;return i._isDisposed=!1,i._beltCell=t,i._preBeltCell=t.preBeltCell,i._beltDirecton=i._beltCell.getDirection(),i._initBitmap(),i}return __extends(t,e),t.prototype._initBitmap=function(){var e=t.NORMAL_BELTCELL_ICON_MAP[this._preBeltCell.getDirection()][this._beltCell.getDirection()];0!=this._beltCell.getPortalType()&&this._beltCell.getPortalInOrOut()==BeltConstants.PORTAL_OUT&&(e=t.NORMAL_BELTCELL_ICON_MAP[this._beltCell.getDirection()][this._beltCell.getDirection()]);var i=e.picName,n=e.scale;EffectFactory.get().newEffect("conveyor_belt",function(t){t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.rotation=e.rotation,t.scaleX=n[0],t.scaleY=n[1],t.animation.gotoAndStopByFrame(i,1),this.addChild(t),this._eff=t}.bind(this)),this._animName=i},t.prototype.playAmination=function(){this._eff&&(this._eff.animation.timeScale=3,this._eff.animation.play(this._animName,3))},t.prototype.setGameView=function(e){this._gameView=e},t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._eff&&(this._eff.animation.stop(),this._eff.parent&&this._eff.parent.removeChild(this._eff),this._eff.dispose()))},t.prototype.isDisposed=function(){return this._isDisposed},t.NORMAL_BELTCELL_ICON_MAP=[[(_a={},_a.picName="texiao01",_a.rotation=270,_a.scale=[62/59,59/62],_a),(_b={},_b.picName="texiao02",_b.rotation=0,_b.scale=[1,1],_b),(_c={},_c.picName="texiao01",_c.rotation=90,_c.scale=[62/59,59/62],_c),(_d={},_d.picName="texiao03",_d.rotation=90,_d.scale=[62/59,59/62],_d)],[(_e={},_e.picName="texiao03",_e.rotation=180,_e.scale=[1,1],_e),(_f={},_f.picName="texiao01",_f.rotation=0,_f.scale=[1,1],_f),(_g={},_g.picName="texiao02",_g.rotation=90,_g.scale=[62/59,59/62],_g),(_h={},_h.picName="texiao01",_h.rotation=180,_h.scale=[1,1],_h)],[(_j={},_j.picName="texiao01",_j.rotation=270,_j.scale=[62/59,59/62],_j),(_k={},_k.picName="texiao03",_k.rotation=270,_k.scale=[62/59,59/62],_k),(_l={},_l.picName="texiao01",_l.rotation=90,_l.scale=[62/59,59/62],_l),(_m={},_m.picName="texiao02",_m.rotation=180,_m.scale=[1,1],_m)],[(_o={},_o.picName="texiao02",_o.rotation=270,_o.scale=[62/59,59/62],_o),(_p={},_p.picName="texiao01",_p.rotation=0,_p.scale=[1,1],_p),(_q={},_q.picName="texiao03",_q.rotation=0,_q.scale=[1,1],_q),(_r={},_r.picName="texiao01",_r.rotation=180,_r.scale=[1,1],_r)]],t.PORTAL_BELTCELL_ICON_MAP=[(_s={},_s.picName="texiao01",_s.rotation=270,_s.scale=[62/59,59/62],_s),(_t={},_t.picName="texiao01",_t.rotation=0,_t.scale=[1,1],_t),(_u={},_u.picName="texiao01",_u.rotation=90,_u.scale=[62/59,59/62],_u),(_v={},_v.picName="texiao01",_v.rotation=180,_v.scale=[1,1],_v)],t
}(egret.DisplayObjectContainer);__reflect(BeltCellView.prototype,"BeltCellView");var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,CashWalletComponent=function(e){function t(t,i){void 0===i&&(i=!1);var n=e.call(this)||this;return n._balance=0,n._balance=t||0,n._isNotDot=i,n.skinName="resource/skins/CashWalletComponentSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t="";this._isNotDot?(t=(this._balance/100).toFixed(0),this.money_icon.visible=!1):t=(this._balance/100).toFixed(2),this._numPic=xyd.bitmapNumber.createNumPic(Number(t),"non_p_"),this._balanceNumGroup.addChild(this._numPic),this._balanceNumGroup.visible=!0},t.prototype.setBalance=function(e){this._balance=e;var t="";t=this._isNotDot?(this._balance/100).toFixed(0):(this._balance/100).toFixed(2),xyd.bitmapNumber.changeNum(this._numPic,Number(t),"non_p_")},t.prototype.setDeltaBalance=function(e){this._balance=e;var t=(this._balance/100).toFixed(2);xyd.bitmapNumber.changeNum(this._numPic,Number(t),"non_p_",!1,!0)},t.prototype.dispose=function(){xyd.bitmapNumber.destroyNumPic(this._numPic)},t}(eui.Component);__reflect(CashWalletComponent.prototype,"CashWalletComponent");var ClassicMovesModeView=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t}(GameView);__reflect(ClassicMovesModeView.prototype,"ClassicMovesModeView");var ComboEffectView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t._textMap_blur=void 0,t._textMap=void 0,t._scanEffect=void 0,t._tw=void 0,t}return __extends(t,e),t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._tw&&(this._tw.stop(),this._tw.kill()),this._scanEffect&&(this._scanEffect.animation.stop(),this._scanEffect.parent&&this._scanEffect.parent.removeChild(this._scanEffect),this._scanEffect.dispose(),this._scanEffect=void 0),this._textMap&&this._textMap.parent&&this._textMap.parent.removeChild(this._textMap),this._textMap_blur&&this._textMap_blur.parent&&this._textMap_blur.parent.removeChild(this._textMap_blur),this.parent&&this.parent.removeChild(this))},t.prototype.setAnimation=function(e){var i=1/.7;EffectFactory.get().newEffect(e[t.SCAN_EFFECT_RES],function(n){var o=this;this._scanEffect=n,this._textMap_blur=new egret.Bitmap,this._textMap_blur.texture=RES.getRes(e[t.BLUR_TEXT_MAP_RES]),this._textMap_blur.anchorOffsetX=.5*this._textMap_blur.width,this._textMap_blur.anchorOffsetY=.5*this._textMap_blur.height,this._textMap_blur.x=xyd.stageWidth/2,this._textMap_blur.y=0,this._textMap_blur.scaleX=2,this._textMap_blur.scaleY=2,this.addChild(this._textMap_blur),this._tw=new TimelineMax,this._tw.add(TweenLite.to(this._textMap_blur,7*xyd.TweenDeltaTime,{y:xyd.stageHeight/2-1*xyd.TILE_HEIGHT})),this._textMap=new egret.Bitmap,this._textMap.texture=RES.getRes(e[t.TEXT_MAP_RES]),this._textMap.anchorOffsetX=.5*this._textMap.width,this._textMap.anchorOffsetY=.5*this._textMap.height,this._textMap.x=xyd.stageWidth/2,this._textMap.y=xyd.stageHeight/2-1*xyd.TILE_HEIGHT+(.5*this._textMap_blur.height-this._textMap.height)/2;var a=this._textMap_blur.width*this._textMap_blur.scaleX/this._textMap.width,s=1*i;this._textMap.scaleX=a,this._textMap.scaleY=s,this._textMap.alpha=0,this.addChild(this._textMap),this._tw.add(TweenLite.to(this._textMap,5*xyd.TweenDeltaTime,{alpha:1}),7*xyd.TweenDeltaTime),this._tw.add(TweenLite.to(this._textMap_blur,5*xyd.TweenDeltaTime,{alpha:0}),7*xyd.TweenDeltaTime),this._tw.call(function(){o._scanEffect.scaleX=a/i,o._scanEffect.scaleY=s/i,o._scanEffect.x=xyd.stageWidth/2,o._scanEffect.y=o._textMap.y,o._scanEffect.animation.play("texiao01",1),o.addChild(o._scanEffect);var e=function(t){this._scanEffect&&(this._scanEffect.removeDBEventListener("complete",e,this),this._scanEffect.animation.stop(),this._scanEffect.parent&&this._scanEffect.parent.removeChild(this._scanEffect),EffectFactory.get().pushBackEffect(this._scanEffect),this._scanEffect=void 0)};o._scanEffect.addDBEventListener("complete",e,o)},void 0,void 0,12*xyd.TweenDeltaTime),this._tw.add(TweenLite.to(this._textMap,24*xyd.TweenDeltaTime,{scaleX:.95*i,scaleY:.95*i}),12*xyd.TweenDeltaTime),this._tw.add(TweenLite.to(this._scanEffect,24*xyd.TweenDeltaTime,{scaleX:.95,scaleY:.95}),12*xyd.TweenDeltaTime),this._tw.add(TweenLite.to(this._textMap,7*xyd.TweenDeltaTime,{scaleX:2*i,scaleY:2*i,alpha:0}),36*xyd.TweenDeltaTime),this._tw.call(function(){o.dispose()},void 0,void 0,43*xyd.TweenDeltaTime)}.bind(this))},t.BLUR_TEXT_MAP_RES=0,t.TEXT_MAP_RES=1,t.SCAN_EFFECT_RES=2,t}(egret.DisplayObjectContainer);__reflect(ComboEffectView.prototype,"ComboEffectView");var DropDownModeView=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t}(GameView);__reflect(DropDownModeView.prototype,"DropDownModeView");var ElementView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._light=!1,t._possibleMovelight=!1,t._lightFrames=0,t._clouds=[],t._snows=[],t._isDisposed=!1,t._isLock=!1,t._ya=0,t._moveFrame=0,t._color=0,t._lastX=0,t._lastY=0,t._nowPngName={},t}return __extends(t,e),t.prototype.setProp=function(e,i,n,o,a,s){var r=this;if(void 0===o&&(o=1),this._color=n,this.x=e,this.y=i,this._type=o,0!=this._type||0!=n){this._displayGroup=new egret.DisplayObjectContainer,n==DisplayConstants.DROP_DOWN?(this.anchorOffsetX=22.5,this.anchorOffsetY=22.5):(this.anchorOffsetX=xyd.TILE_WIDTH_HALF,this.anchorOffsetY=xyd.TILE_HEIGHT_HALF),this._displayGroup.width=xyd.TILE_WIDTH,this._displayGroup.height=xyd.TILE_HEIGHT,this._displayGroup.anchorOffsetX=xyd.TILE_WIDTH_HALF,this._displayGroup.anchorOffsetY=xyd.TILE_HEIGHT_HALF,this._displayGroup.x=xyd.TILE_WIDTH_HALF,this._displayGroup.y=xyd.TILE_HEIGHT_HALF,this.addChild(this._displayGroup);var l;if(l=n==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.LAYED_SLATE?DisplayConstants.LayedSlateSourceMap[a]:n==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.PUZZLE?DisplayConstants.puzzleSourceMap[a]:this._type==ElementTypeConstants.NORMAL?DisplayConstants.ElementDisplaySourceMap[n]:n==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.COLOR_MIXER?DisplayConstants.colorMixerSourceMap[this._type][a]:DisplayConstants.ElementDisplaySourceMap[n+o*DisplayConstants.ELEMENT_TYPE_START],this._bitmap||(this._bitmap=new egret.Bitmap),l?(this._bitmap.visible=!0,this.setBitmapAsyncNoPng(this._bitmap,l),this._bitmap.anchorOffsetX=xyd.TILE_WIDTH_HALF,this._bitmap.anchorOffsetY=xyd.TILE_HEIGHT_HALF,this._bitmap.x=xyd.TILE_WIDTH_HALF,this._bitmap.y=xyd.TILE_HEIGHT_HALF):this._bitmap.visible=!1,n==DisplayConstants.LOCK_TYPE_START+LOCK_TYPE.GIFT_WRAPPER&&this._initWrapper(a),n==BlockerConstant.CLOUD_MAKER+DisplayConstants.BLOCKER_TYPE_START&&this.initCloudMaker(),n==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.SNOW&&this._initSnow(a+1),this._type==ElementTypeConstants.BLACK_HOLE&&this.initBlackHole(),(n+o*DisplayConstants.ELEMENT_TYPE_START==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.CLOUD||n+o*DisplayConstants.ELEMENT_TYPE_START==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.CLOUD_ROCKET)&&(n+o*DisplayConstants.ELEMENT_TYPE_START==DisplayConstants.BLOCKER_TYPE_START+BlockerConstant.CLOUD&&(this._bitmap.visible=!1),0==this._clouds.length))for(var _=0;4>_;_++){var h=new egret.Bitmap,c=DisplayConstants.CloudSourceMap[3];switch(this.setBitmapAsyncNoPng(h,c,void 0,_),h.rotation=0,h.x+=xyd.TILE_WIDTH_HALF,h.y+=xyd.TILE_HEIGHT_HALF,h.anchorOffsetX=1,h.anchorOffsetY=1,_){case 0:break;case 1:h.scaleX=-1;break;case 2:h.scaleX=-1,h.scaleY=-1;break;case 3:h.scaleY=-1}this._clouds.push(h),this._displayGroup.addChild(h)}this._displayGroup.addChild(this._bitmap),s&&o==ElementTypeConstants.NORMAL&&(this._dropBitmap&&this._dropBitmap.parent&&(this._dropBitmap.parent.removeChild(this._dropBitmap),this._dropBitmap=void 0),this._dropBitmap=new egret.Bitmap,xyd.setBitmapAsync(this._dropBitmap,"fund_hongbao_icon",function(){r._dropBitmap.width=t.DROP_BITMAP_WIDTH,r._dropBitmap.height=t.DROP_BITMAP_HEIGHT,r._dropBitmap.x=r._displayGroup.width-t.DROP_BITMAP_WIDTH,r._dropBitmap.y=r._displayGroup.height-t.DROP_BITMAP_HEIGHT}),this._displayGroup.addChild(this._dropBitmap))}},t.prototype.setAnchor=function(e,t){this._bitmap.anchorOffsetX=e,this._bitmap.anchorOffsetY=t},t.prototype.setGameView=function(e){this._gameView=e},t.prototype.getbitmap=function(){return this._bitmap},t.prototype.getDropBitmap=function(){return this._dropBitmap},t.prototype.update=function(){},t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this.filters=[],this.parent&&(this._chooseMask&&this.parent.removeChild(this._chooseMask),this.parent.removeChild(this)),this._timer&&this._timer.stop(),this._moveTl&&this._moveTl.kill(),this._displayTl&&this._displayTl.kill(),this._clouds&&(this._clouds=[]),this._snows&&(this._snows=[]),this._chooseMask&&(this.parent&&this.parent.removeChild(this._chooseMask),this._chooseMask=void 0),this._timeLabel1&&this._timeLabel2&&(xyd.bitmapNumber.destroyNumPic(this._timeLabel1),xyd.bitmapNumber.destroyNumPic(this._timeLabel2)),this._displayGroup&&(this._displayGroup.visible=!1),this._effDisplay&&(this._effDisplay.animation&&this._effDisplay.animation.stop(),this._effDisplay.parent&&this._effDisplay.parent.removeChild(this._effDisplay),this._effDisplay.dispose(),this._effDisplay=void 0),this._effWarning&&(this._effWarning.animation.stop(),this._effWarning.parent&&this._effWarning.parent.removeChild(this._effWarning),EffectFactory.get().pushBackEffect(this._effWarning)),this._bombNumberDisplayGroup&&this._bombNumberDisplayGroup.parent&&(TweenLite.killTweensOf(this._bombNumberDisplayGroup),this._bombNumberDisplayGroup.parent.removeChild(this._bombNumberDisplayGroup)),this._effColorMixer&&this.clearColorMixerEff(),this._dropBitmap&&(this._dropBitmap.parent&&this._dropBitmap.parent.removeChild(this._dropBitmap),this._dropBitmap=void 0))},t.prototype.updatePos=function(e,t,i){void 0===i&&(i=!1),this.clearMoveTween(),this._lastX=this.x,this._lastY=this.y,this.x=this._gameView.logicToviewSimpleX(e),this.y=this._gameView.logicToviewSimpleY(t);var n=this.mask;if(void 0!=n){var o=this._lastY-this.y;o>=-xyd.MAX_YA*xyd.TILE_HEIGHT&&(n.y+=o)}i?(this.scaleX=1,this.scaleY=1.25):(this.scaleX=1,this.scaleY=1)},t.prototype.onTimer=function(){this._light?(this._lightFrames++,this._lightFrames=this._lightFrames%(3*xyd.frameLightFilter.length),this.filters=[xyd.frameLightFilter[Math.floor(this._lightFrames/3%xyd.frameLightFilter.length)]]):this._possibleMovelight&&(this._lightFrames++,this._lightFrames>=43&&(this._lightFrames=0),this._lightFrames>=20?this.filters=[]:this.filters=[xyd.frameLightFilter[Math.floor(this._lightFrames%xyd.frameLightFilter.length)]])},t.prototype.setPossibleMoveLight=function(e){this._possibleMovelight=e,e?(this._lightFrames=0,this._timer||(this._timer=new egret.Timer(66,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)),this._timer.start()):(this._timer&&this._timer.stop(),this.filters=[])},t.prototype.setLight=function(e){this._light=e,e?(this._lightFrames=0,this._timer||(this._timer=new egret.Timer(50,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)),this._timer.start()):(this._timer&&this._timer.stop(),this.filters=[])},t.prototype.setSelect=function(e,t,i){if(this._light=e,e){if(!this._chooseMask){this._chooseMask=new egret.Bitmap,this.setBitmapAsyncNoPng(this._chooseMask,"icon_xuanzhongjiaobiao_png");var n=this.x-xyd.TILE_WIDTH_HALF,o=this.y-xyd.TILE_HEIGHT_HALF;if(void 0!=t&&void 0!=i){var a=this._gameView.logicToView(new egret.Point(t,i));n=a.x-xyd.TILE_WIDTH_HALF,o=a.y-xyd.TILE_HEIGHT_HALF}this._chooseMask.x=n,this._chooseMask.y=o,this.parent.addChild(this._chooseMask)}}else this._chooseMask&&(this.parent&&this.parent.removeChild(this._chooseMask),this._chooseMask=void 0)},t.prototype.setMoveTween=function(e){void 0!=this._moveTl&&this._moveTl.kill(),this._moveTl=e},t.prototype.clearMoveTween=function(){void 0!=this._moveTl&&this._moveTl.kill(),this._moveTl=void 0},t.prototype.setDisplayTween=function(e){void 0!=this._displayTl&&(this._displayGroup.x=xyd.TILE_WIDTH_HALF,this._displayGroup.y=xyd.TILE_HEIGHT_HALF,this._displayGroup.name="_displayGroup",this._displayGroup.scaleX=1,this._displayGroup.scaleY=1,this._displayGroup.rotation=0,this.filters=[],this.rotation=0,this._bombNumberDisplayGroup&&(this._bombNumberDisplayGroup.scaleX=1,this._bombNumberDisplayGroup.scaleY=1),this._displayTl.kill()),this._displayTl=e},t.prototype.clearDisplayTween=function(){void 0!=this._displayTl&&this._displayTl.kill(),this._displayTl=void 0,this.displayGroup.scaleX=1,this.displayGroup.scaleY=1,this._displayGroup.x=xyd.TILE_WIDTH_HALF,this._displayGroup.y=xyd.TILE_HEIGHT_HALF,this._displayGroup.rotation=0,this._bombNumberDisplayGroup&&(this._bombNumberDisplayGroup.scaleX=1,this._bombNumberDisplayGroup.scaleY=1)},t.prototype.resetPossibleMove=function(){this.rotation=0,this.setPossibleMoveLight(!1),this.scaleX=1,this.scaleY=1},t.prototype.setSnowPiecesBitmaps=function(){if(0==this._snows.length)for(var e=0;4>e;e++){var t=new egret.Bitmap,i=DisplayConstants.snowPiecesSourceMap[3];switch(this.setBitmapAsyncNoPng(t,i,void 0,e),t.rotation=0,t.x+=xyd.TILE_WIDTH_HALF,t.y+=xyd.TILE_HEIGHT_HALF,t.anchorOffsetX=1,t.anchorOffsetY=1,e){case 0:break;case 1:t.scaleX=-1;break;case 2:t.scaleX=-1,t.scaleY=-1;break;case 3:t.scaleY=-1}this._snows.push(t),this._displayGroup.addChild(t)}},t.prototype.setBitmapAsyncNoPng=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=-1),this._nowPngName[n]=t,RES.getResAsync(t,function(o,a){o&&t==this._nowPngName[n]&&(e.texture=o),i&&i(t,e)},this)},t.prototype.checkNearSnow=function(e){e[1]||e[3]||this.setBitmapAsyncNoPng(this._snows[0],DisplayConstants.snowPiecesSourceMap[3],void 0,0),e[1]&&!e[3]&&this.setBitmapAsyncNoPng(this._snows[0],DisplayConstants.snowPiecesSourceMap[2],void 0,0),!e[1]&&e[3]&&this.setBitmapAsyncNoPng(this._snows[0],DisplayConstants.snowPiecesSourceMap[4],void 0,0),e[1]&&e[3]&&!e[7]&&this.setBitmapAsyncNoPng(this._snows[0],DisplayConstants.snowPiecesSourceMap[1],void 0,0),e[1]&&e[3]&&e[7]&&this.setBitmapAsyncNoPng(this._snows[0],DisplayConstants.snowPiecesSourceMap[0],void 0,0),e[0]||e[3]||this.setBitmapAsyncNoPng(this._snows[1],DisplayConstants.snowPiecesSourceMap[3],void 0,1),e[0]&&!e[3]&&this.setBitmapAsyncNoPng(this._snows[1],DisplayConstants.snowPiecesSourceMap[2],void 0,1),!e[0]&&e[3]&&this.setBitmapAsyncNoPng(this._snows[1],DisplayConstants.snowPiecesSourceMap[4],void 0,1),e[0]&&e[3]&&!e[6]&&this.setBitmapAsyncNoPng(this._snows[1],DisplayConstants.snowPiecesSourceMap[1],void 0,1),e[0]&&e[3]&&e[6]&&(this.setBitmapAsyncNoPng(this._snows[1],DisplayConstants.snowPiecesSourceMap[0]),1),e[0]||e[2]||this.setBitmapAsyncNoPng(this._snows[2],DisplayConstants.snowPiecesSourceMap[3],void 0,2),e[0]&&!e[2]&&this.setBitmapAsyncNoPng(this._snows[2],DisplayConstants.snowPiecesSourceMap[2],void 0,2),!e[0]&&e[2]&&this.setBitmapAsyncNoPng(this._snows[2],DisplayConstants.snowPiecesSourceMap[4],void 0,2),e[0]&&e[2]&&!e[4]&&this.setBitmapAsyncNoPng(this._snows[2],DisplayConstants.snowPiecesSourceMap[1],void 0,2),e[0]&&e[2]&&e[4]&&this.setBitmapAsyncNoPng(this._snows[2],DisplayConstants.snowPiecesSourceMap[0],void 0,2),e[1]||e[2]||this.setBitmapAsyncNoPng(this._snows[3],DisplayConstants.snowPiecesSourceMap[3],void 0,3),e[1]&&!e[2]&&this.setBitmapAsyncNoPng(this._snows[3],DisplayConstants.snowPiecesSourceMap[2],void 0,3),!e[1]&&e[2]&&this.setBitmapAsyncNoPng(this._snows[3],DisplayConstants.snowPiecesSourceMap[4],void 0,3),e[1]&&e[2]&&!e[5]&&this.setBitmapAsyncNoPng(this._snows[3],DisplayConstants.snowPiecesSourceMap[1],void 0,3),e[1]&&e[2]&&e[5]&&this.setBitmapAsyncNoPng(this._snows[3],DisplayConstants.snowPiecesSourceMap[0],void 0,3)},t.prototype.checkNearCloud=function(e){e[1]||e[3]||this.setBitmapAsyncNoPng(this._clouds[0],DisplayConstants.CloudSourceMap[3],void 0,0),e[1]&&!e[3]&&this.setBitmapAsyncNoPng(this._clouds[0],DisplayConstants.CloudSourceMap[2],void 0,0),!e[1]&&e[3]&&this.setBitmapAsyncNoPng(this._clouds[0],DisplayConstants.CloudSourceMap[4],void 0,0),e[1]&&e[3]&&!e[7]&&this.setBitmapAsyncNoPng(this._clouds[0],DisplayConstants.CloudSourceMap[1],void 0,0),e[1]&&e[3]&&e[7]&&this.setBitmapAsyncNoPng(this._clouds[0],DisplayConstants.CloudSourceMap[0],void 0,0),e[0]||e[3]||this.setBitmapAsyncNoPng(this._clouds[1],DisplayConstants.CloudSourceMap[3],void 0,1),e[0]&&!e[3]&&this.setBitmapAsyncNoPng(this._clouds[1],DisplayConstants.CloudSourceMap[2],void 0,1),!e[0]&&e[3]&&this.setBitmapAsyncNoPng(this._clouds[1],DisplayConstants.CloudSourceMap[4],void 0,1),e[0]&&e[3]&&!e[6]&&this.setBitmapAsyncNoPng(this._clouds[1],DisplayConstants.CloudSourceMap[1],void 0,1),e[0]&&e[3]&&e[6]&&this.setBitmapAsyncNoPng(this._clouds[1],DisplayConstants.CloudSourceMap[0],void 0,1),e[0]||e[2]||this.setBitmapAsyncNoPng(this._clouds[2],DisplayConstants.CloudSourceMap[3],void 0,2),e[0]&&!e[2]&&this.setBitmapAsyncNoPng(this._clouds[2],DisplayConstants.CloudSourceMap[2],void 0,2),!e[0]&&e[2]&&this.setBitmapAsyncNoPng(this._clouds[2],DisplayConstants.CloudSourceMap[4],void 0,2),e[0]&&e[2]&&!e[4]&&this.setBitmapAsyncNoPng(this._clouds[2],DisplayConstants.CloudSourceMap[1],void 0,2),e[0]&&e[2]&&e[4]&&this.setBitmapAsyncNoPng(this._clouds[2],DisplayConstants.CloudSourceMap[0],void 0,2),e[1]||e[2]||this.setBitmapAsyncNoPng(this._clouds[3],DisplayConstants.CloudSourceMap[3],void 0,3),e[1]&&!e[2]&&this.setBitmapAsyncNoPng(this._clouds[3],DisplayConstants.CloudSourceMap[2],void 0,3),!e[1]&&e[2]&&this.setBitmapAsyncNoPng(this._clouds[3],DisplayConstants.CloudSourceMap[4],void 0,3),e[1]&&e[2]&&!e[5]&&this.setBitmapAsyncNoPng(this._clouds[3],DisplayConstants.CloudSourceMap[1],void 0,3),e[1]&&e[2]&&e[5]&&this.setBitmapAsyncNoPng(this._clouds[3],DisplayConstants.CloudSourceMap[0],void 0,3)},t.prototype.getTen=function(e){return Math.floor(e/10)},t.prototype.getOne=function(e){return e%10},t.prototype.playBlackHoleEffect=function(){this._effDisplay&&(this._effDisplay.animation.isPlaying&&this._effDisplay.animation.stop(),this._effDisplay.visible=!0,this._effDisplay.animation.play("texiao01",-1))},t.prototype.stopBlackHoleEffect=function(){this._effDisplay&&(this._effDisplay.animation.stop(),this._effDisplay.visible=!1)},t.prototype.blackHoleEff=function(e,t){var i=this,n=DisplayConstants.ElementDisplaySourceMap[e+t*DisplayConstants.ELEMENT_TYPE_START],o=new TimelineLite;o.add(TweenLite.to(this._bitmap,10*xyd.TweenDeltaTime,{rotation:360,scaleX:0,scaleY:0})),o.call(function(){i.setBitmapAsyncNoPng(i._bitmap,n)}),o.add(TweenLite.to(this._bitmap,10*xyd.TweenDeltaTime,{rotation:0,scaleX:1,scaleY:1}))},t.prototype.initBlackHole=function(){EffectFactory.get().newEffect("special_effect_black_hole",function(e){this.addChildAt(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,this._effDisplay.scaleX=1.2,this._effDisplay.scaleY=1.2,this._effDisplay.animation.play("texiao01",-1)}.bind(this))},t.prototype.checkTimeBomb=function(e){3>=e?this.timeBombWarning():this.clearTimeBombWarning()},t.prototype.initTimeBomb=function(e){this._bombNumberDisplayGroup=new egret.DisplayObjectContainer,this._displayGroup.addChild(this._bombNumberDisplayGroup),e>=0&&(this._timeLabel1=xyd.bitmapNumber.createNumPic(this.getTen(e),"bomb_"),this._timeLabel2=xyd.bitmapNumber.createNumPic(this.getOne(e),"bomb_"),this._timeLabel1.x=55,this._timeLabel1.y=47,this._timeLabel2.x=78,this._timeLabel2.y=47,this._bombNumberDisplayGroup.addChild(this._timeLabel1),this._bombNumberDisplayGroup.addChild(this._timeLabel2)),EffectFactory.get().newEffect("blocker_effect_bomb",function(e){this.displayGroup.addChildAt(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,e.animation.play("texiao01",-1)}.bind(this)),3>=e&&this.timeBombWarning()},t.prototype.giftWrapperRemove=function(){if(this._effDisplay){var e=this._effDisplay,t="texiao01";e.animation.play(t,1);var i=function(t){e.removeDBEventListener("complete",i,this),this.dispose()};e.addDBEventListener("complete",i,this)}else this.dispose()},t.prototype.replaceWrapper=function(e){if(this._effDisplay){var t=this._effDisplay,i="texiao0"+(e+1);t.animation.play(i,1);var n=function(i){t.removeDBEventListener("complete",n,this);var o="texiao0"+e;t.animation.gotoAndStopByFrame(o,0)};t.addDBEventListener("complete",n,this)}},t.prototype._initWrapper=function(e){EffectFactory.get().newEffect("giftwrapper",function(t){this.addChildAt(t,0),this._effDisplay=t,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF;var i="texiao0"+e;t.animation.gotoAndStopByFrame(i,0)}.bind(this))},t.prototype.initCloudMaker=function(){EffectFactory.get().newEffect("blocker_effect_snow_maker",function(e){this.addChildAt(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,e.animation.play("texiao01",-1)}.bind(this))},t.prototype.rocketTween=function(){this.displayGroup.scaleX=1.02,this.displayGroup.scaleY=1.02;var e=new TimelineMax;e.add(TweenMax.to(this.displayGroup,20*xyd.TweenDeltaTime,{y:xyd.TILE_HEIGHT_HALF-4,scaleX:1.06,scaleY:1.06}),0),e.add(TweenMax.to(this.displayGroup,20*xyd.TweenDeltaTime,{y:xyd.TILE_HEIGHT_HALF,scaleX:1.02,scaleY:1.02}),20*xyd.TweenDeltaTime);for(var t=0;20>=t;t++)e.add(TweenMax.to(this.displayGroup,1*xyd.TweenDeltaTime,{rotation:-1}),2*t*xyd.TweenDeltaTime),e.add(TweenMax.to(this.displayGroup,1*xyd.TweenDeltaTime,{rotation:1}),(2*t+1)*xyd.TweenDeltaTime);e.play(),e.repeat(-1),this.setDisplayTween(e)},t.prototype.rocketFire=function(e){0==e?(this._effDisplay&&(this._effDisplay.animation.stop(),this._effDisplay.visible=!1),this.clearDisplayTween()):1==e?this._effDisplay?(this._effDisplay.visible=!0,this._effDisplay.animation.play("texiao01",-1)):EffectFactory.get().newEffect(EffectConstants.ROCKET_FIRE,function(e){this.displayGroup.addChild(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_HEIGHT_HALF+2,this._effDisplay.animation.play("texiao01",-1)}.bind(this)):(this._effDisplay?(this._effDisplay.visible=!0,this._effDisplay.animation.play("texiao02",-1)):EffectFactory.get().newEffect(EffectConstants.ROCKET_FIRE,function(e){this.displayGroup.addChild(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_HEIGHT_HALF+2,this._effDisplay.animation.play("texiao02",-1)}.bind(this)),this.rocketTween())},t.prototype._initSnow=function(e){this.setSnowPiecesBitmaps();var t="texiao01",i=0;e>1&&(t="texiao02"),e>2&&(i=41),this._effDisplay?this._effDisplay.animation.gotoAndStopByFrame(t,i):EffectFactory.get().newEffect("blocker_effect_snowman",function(e){this._displayGroup.addChild(e),e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_WIDTH_HALF,e.animation.gotoAndStopByFrame(t,i),this._effDisplay=e}.bind(this))},t.prototype.fanBlockerTriggerAnimation=function(){void 0==this._effDisplay?EffectFactory.get().newEffect(EffectConstants.BLOCKER_FAN_TRIGGER,function(e){this._displayGroup.addChild(e),e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_WIDTH_HALF,e.animation.play("texiao01",1),this._effDisplay=e}.bind(this)):this._effDisplay.animation.play("texiao01",1)},t.prototype.changeRocket=function(e,t,i){var n=this;if(i==RocketConstants.SPECIAL_COLOR_BOMBED){this._rocketTypeBitmap&&(this._rocketTypeBitmap.parent.removeChild(this._rocketTypeBitmap),this._rocketTypeBitmap=void 0);var o;return o=t==RocketConstants.STATE_DARK?DisplayConstants.RocketStateSourceMap[CellConstants.CELL_COLOR_RANDOM][t]:DisplayConstants.RocketStateSourceMap[CellConstants.CELL_COLOR_RANDOM][RocketConstants.STATE_LIGHT],this.setBitmapAsyncNoPng(this._bitmap,o),void this.rocketFire(t)}var a=DisplayConstants.RocketStateSourceMap[e][t],s=DisplayConstants.RocketTypeSourceMap[e][i];s&&""!=s?this._rocketTypeBitmap||(this._rocketTypeBitmap=new egret.Bitmap,this.setBitmapAsyncNoPng(this._rocketTypeBitmap,s,function(){n._rocketTypeBitmap&&(n._rocketTypeBitmap.anchorOffsetX=n._rocketTypeBitmap.width/2,n._rocketTypeBitmap.anchorOffsetY=n._rocketTypeBitmap.height/2,n._rocketTypeBitmap.x=xyd.TILE_WIDTH_HALF,n._rocketTypeBitmap.y=.66*xyd.TILE_HEIGHT)},1),this.displayGroup.addChild(this._rocketTypeBitmap)):this._rocketTypeBitmap&&(this._rocketTypeBitmap.parent.removeChild(this._rocketTypeBitmap),this._rocketTypeBitmap=void 0),a&&""!=a?(this._bitmap.visible=!0,this.setBitmapAsyncNoPng(this._bitmap,a)):this._bitmap&&(this._bitmap.visible=!1),this.rocketFire(t)},t.prototype.initCake=function(e,t){if(void 0===t&&(t=!1),t){var i=DisplayConstants.CakeMap[e+1];if(void 0==i)return;EffectFactory.get().newEffect("special_distruction_cake",function(e){this.displayGroup.addChildAt(e,0),this._effDisplay=e,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,e.animation.play(i,1)}.bind(this))}else EffectFactory.get().newEffect("special_distruction_cake",function(t){this.displayGroup.addChildAt(t,0),this._effDisplay=t,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,t.animation.gotoAndStopByFrame(DisplayConstants.CakeMap[e],1)}.bind(this))},t.prototype.initBalloon=function(e,t){if(void 0===t&&(t=!1),t){var i=DisplayConstants.BalloonMap[e+1];if(void 0==i)return;EffectFactory.get().newEffect("special_effect_baloon",function(t){this.displayGroup.addChildAt(t,0),this._effDisplay=t,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,t.animation.play(i,1);var n=function(e){t.removeDBEventListener("complete",n,this),t.animation.play("texiao03",-1)};1==e&&t.addDBEventListener("complete",n,this)}.bind(this))}else EffectFactory.get().newEffect("special_effect_baloon",function(t){this.displayGroup.addChildAt(t,0),this._effDisplay=t,this._effDisplay.x=xyd.TILE_WIDTH_HALF,this._effDisplay.y=xyd.TILE_WIDTH_HALF,1==e?t.animation.play(DisplayConstants.BalloonMap[e],-1):t.animation.gotoAndStopByFrame(DisplayConstants.BalloonMap[e],1)}.bind(this))},t.prototype.playCloudMakerAnimation=function(){!this.isDisposed()&&this._effDisplay&&this._effDisplay.animation.play("texiao02",1)},t.prototype.clearTimeBombWarning=function(){this._isLock&&(TweenLite.killTweensOf(this._bombNumberDisplayGroup),this._bombNumberDisplayGroup.x=this.x,this._bombNumberDisplayGroup.y=this.y,this._bombNumberDisplayGroup.scaleX=0,this._bombNumberDisplayGroup.scaleY=0,this._bombNumberDisplayGroup.rotation=0),this.clearDisplayTween()},t.prototype.timeBombWarning=function(){this.clearDisplayTween();var e=new TimelineMax;if(this.displayGroup.scaleX=1,this.displayGroup.scaleY=1,this.displayGroup.rotation=0,e.add(TweenLite.to(this.displayGroup,3*xyd.TweenDeltaTime,{rotation:10,scaleX:1.05,scaleY:1.05})),e.add(TweenLite.to(this.displayGroup,3*xyd.TweenDeltaTime,{rotation:0,scaleX:1,scaleY:1})),e.repeat(-1),e.play(),this.setDisplayTween(e),this._effWarning?this._effWarning.visible=!0:EffectFactory.get().newEffect("blocker_warning_bomb",function(e){this.displayGroup.addChild(e),this._effWarning=e,this._effWarning.x=xyd.TILE_WIDTH_HALF,this._effWarning.y=xyd.TILE_WIDTH_HALF,e.animation.play("texiao01",-1)}.bind(this)),this._isLock){var t=new TimelineMax;this._bombNumberDisplayGroup.scaleX=1,this._bombNumberDisplayGroup.scaleY=1,this._bombNumberDisplayGroup.rotation=0,t.add(TweenLite.to(this._bombNumberDisplayGroup,3*xyd.TweenDeltaTime,{rotation:10,scaleX:1.05,scaleY:1.05})),t.add(TweenLite.to(this._bombNumberDisplayGroup,3*xyd.TweenDeltaTime,{rotation:0,scaleX:1,scaleY:1})),t.repeat(-1),t.play()}},t.prototype.changeNumTimeBomb=function(e){this._timeLabel1&&this._timeLabel2&&(xyd.bitmapNumber.changeNum(this._timeLabel1,this.getTen(e),"bomb_"),xyd.bitmapNumber.changeNum(this._timeLabel2,this.getOne(e),"bomb_"),this._effWarning&&(this._effWarning.visible=!1)),3>=e?this.timeBombWarning():this.clearTimeBombWarning()},t.prototype.clearColorMixerEff=function(){for(;this._effColorMixer.$children.length>0;){var e=this._effColorMixer.$children[0];e.animation.stop(),EffectFactory.get().pushBackEffect(e),e&&e.parent&&e.parent.removeChild(e)}},t.prototype.changeColorMixer=function(e,t){var i="texiao"+t.toString()+e.toString();this._effColorMixer||(this._effColorMixer=new egret.DisplayObjectContainer,this.addChild(this._effColorMixer)),e>0?EffectFactory.get().newEffect(EffectConstants.COLORMIXER_PAINT,function(e){this._effColorMixer.addChild(e),e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_WIDTH_HALF,e.animation.play(i,1)}.bind(this)):this.clearColorMixerEff()},t.prototype.replaceColorMixer=function(e,t){3>e||this.setBitmapAsyncNoPng(this._bitmap,DisplayConstants.colorMixerSourceMap[t][e])},t.prototype.colorMixerRemove=function(){EffectFactory.get().newEffect(EffectConstants.BLOCKER_DESTRUCTION_COLORMIXER,function(e){this.addChild(e),e.x=xyd.TILE_WIDTH_HALF,e.y=xyd.TILE_HEIGHT_HALF+2,e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this))},t.prototype.updateSnow=function(e){if(!this.isDisposed()){var t="texiao01";e>2&&(t="texiao02"),this._effDisplay&&this._effDisplay.animation.play(t,1)}},Object.defineProperty(t.prototype,"displayGroup",{get:function(){return this._displayGroup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bombNumberGroup",{get:function(){return this._bombNumberDisplayGroup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectDisplay",{get:function(){return this._effDisplay},set:function(e){this._effDisplay=e},enumerable:!0,configurable:!0}),t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.getLockState=function(){return this._isLock},t.prototype.setTimeLabelLock=function(e){this._isLock=e,this._bombNumberDisplayGroup&&(e?(this._bombNumberDisplayGroup.anchorOffsetX=xyd.TILE_WIDTH_HALF,this._bombNumberDisplayGroup.anchorOffsetY=xyd.TILE_HEIGHT_HALF,this._bombNumberDisplayGroup.x=this.x,this._bombNumberDisplayGroup.y=this.y,this._gameView.effectLayer.addChild(this._bombNumberDisplayGroup)):(TweenLite.killTweensOf(this._bombNumberDisplayGroup),this._bombNumberDisplayGroup.anchorOffsetX=0,this._bombNumberDisplayGroup.anchorOffsetY=0,this._bombNumberDisplayGroup.x=0,this._bombNumberDisplayGroup.y=0,this._bombNumberDisplayGroup.rotation=0,this._bombNumberDisplayGroup.scaleX=1,this._bombNumberDisplayGroup.scaleY=1,this._displayGroup.addChild(this._bombNumberDisplayGroup)))},t.prototype.setFilter=function(e){this.filters=e},Object.defineProperty(t.prototype,"ya",{get:function(){return this._ya},set:function(e){this._ya=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moveFrame",{get:function(){return this._moveFrame},set:function(e){this._moveFrame=e},enumerable:!0,configurable:!0}),t.DROP_BITMAP_WIDTH=58,t.DROP_BITMAP_HEIGHT=62,t}(egret.DisplayObjectContainer);__reflect(ElementView.prototype,"ElementView",["IElementView"]);var GameTargetDisplay=function(e){function t(t,i,n){var o=e.call(this)||this;o.settedPressFunc=!1,o.skinName="resource/skins/GameTargetDisplaySkin.exml",o._displayTargetLabels=n,o._key=t,o._val=i;var a=DisplayConstants.TargetSourceMap[t];return a||console.log("boardTarget unknowType"),o.img_.source=a,o.img_.scaleX=.9,o.img_.scaleY=.9,("icon_fengche_png"==a||"block_slate3_png"==a)&&(o.img_.scaleX=.8,o.img_.scaleY=.8),o.name=a,o.checkImg_.visible=!1,o.labelNum_=xyd.bitmapNumber.createNumPic(i,"non_11_"),o.labelNum_.scaleX=.82,o.labelNum_.scaleY=.82,xyd.bitmapNumber.setNumGap(o.labelNum_,-10),o.label_group.horizontalCenter=0-(o.labelNum_.numChildren-1)*xyd.bitmapNumber.getWidth(o.labelNum_)/o.labelNum_.numChildren*.5,o._displayTargetLabels.push(o.labelNum_),o.group_num.addChild(o.labelNum_),i>999&&(o.group_num.scaleX=.8,o.group_num.scaleY=.8),0==i?(o.checkImg_.visible=!0,o.label_group.visible=!1):(o.checkImg_.visible=!1,o.label_group.visible=!0),o
}return __extends(t,e),t.prototype.changeSlateToStone=function(){this.img_.source=DisplayConstants.TargetSourceMap[ObjectiveConstants.STONE]},t.prototype.resetData=function(e){xyd.bitmapNumber.changeNum(this.labelNum_,e,"non_11_"),xyd.bitmapNumber.setNumGap(this.labelNum_,-10),this.label_group.horizontalCenter=0-(this.labelNum_.numChildren-1)*xyd.bitmapNumber.getWidth(this.labelNum_)/this.labelNum_.numChildren*.5,0==e?(this.checkImg_.visible||EffectFactory.get().newEffect("goal_complete",function(e){e.x=this.checkImg_.x+.9*this.checkImg_.width/2,e.y=this.checkImg_.y+.9*this.checkImg_.height/2,SoundManager.getInstance().playEffect("se_target_collect_mp3"),e.animation.play("texiao01",1),this.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),this.removeChild(e),this.checkImg_.visible=!0,EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(this)),this.label_group.visible=!1):(this.checkImg_.visible=!1,this.label_group.visible=!0)},t}(eui.Component);__reflect(GameTargetDisplay.prototype,"GameTargetDisplay");var GameTargetView=function(e){function t(t,i,n){var o=e.call(this)||this;o.settedPressFunc=!1,o.skinName="resource/skins/GameTargetViewSkin.exml",o._displayTargetLabels=n,o._key=t,o._val=i;var a=DisplayConstants.TargetSourceMap[t];if(a||console.log("boardTarget unknowType"),o.img_.source=a,("block_slate3_png"==a||"icon_dangao3_png"==a)&&(o.img_.scaleX*=.8,o.img_.scaleY*=.8),o.name=a,0==i)return o.img_x.visible=!1,o;o.labelNum_=xyd.bitmapNumber.createNumPic(i,"non_k_"),xyd.bitmapNumber.setNumGap(o.labelNum_,-10),o._displayTargetLabels.push(o.labelNum_),o.group_num.addChild(o.labelNum_);var s=xyd.bitmapNumber.getWidth(o.labelNum_);return i>=100&&(o.label_group.scaleX=o.label_group.scaleY=.8,s=.8*s),o.label_group.x=(o.width-s)/2,o.labelNum_.y=(o.group_num.height-xyd.bitmapNumber.getHeight(o.labelNum_))/2,o}return __extends(t,e),t.prototype.changeSlateToStone=function(){this.img_.source=DisplayConstants.TargetSourceMap[ObjectiveConstants.STONE]},t.prototype.getImgString=function(){return this.name},t}(eui.Component);__reflect(GameTargetView.prototype,"GameTargetView");var Guide=function(e){function t(i,n,o,a){var s=e.call(this)||this;s.isDisposed_=!1,s._points=[],s._baseViews=[],s._baseViewLocs=[],s._shouldLogGuideLoss=!1,s._isActiveType=!1,s._usingTweens=[],s._highlightType=0,s._canSkip=!1,s._shouldHighlighElement=!1,s._shouldShowGuideUI=!0,s._forceUpdate=!1,s.isFirstInit=!0,s._boardScale=1,s.skinName="resource/skins/GuideSkin.exml",s._gameView=n,s._gameWin=i,s._guideID=o,s._boardScale=a;var r=GuideTable.get();r.getCanSkip(o)&&(s._canSkip=!0);var l=r.getTotalLevel(o);if(s._totalLevel=l,l&&1==l&&(s._shouldLogGuideLoss=!0),s._highlightType=r.getHighlighType(o),1==s._highlightType||2==s._highlightType||4==s._highlightType){var _=r.getHighlight(o);if(_)for(var h=0,c=_;h<c.length;h++){var d=c[h],p=d%9,u=Math.floor(d/9);s._points.push(new egret.Point(u,p))}}else 3==s._highlightType?t.ITEM_DEMO_Y_OFFSET=.5*xyd.getHeight()-1.5*t.ITEM_DEMO_HEIGHT-t.CHICK_LEFT_Y-s._charHolder.height+120:4==s._highlightType&&(s._shouldHighlighElement=!1);s._manual=r.getManual(o),(s._manual&&2==s._manual.length||4==s._highlightType||5==s._highlightType)&&(s._isActiveType=!0),void 0==t.highlightTexture_&&(t.highlightTexture_=new egret.RenderTexture),void 0==t.renderTexture_&&(t.renderTexture_=new egret.RenderTexture);for(var m=0;m<s._points.length;m++)s._baseViews[m]=void 0,s._baseViewLocs[m]=void 0;return s._itemID=GuideTable.get().getItemType(s._guideID),s}return __extends(t,e),t.prototype.childrenCreated=function(){var t=this;if(this._skipLabel.textFlow=new Array({text:"跳过>>",style:{underline:!0}}),this._canSkip&&egret.setTimeout(function(){t._isActiveType?(xyd.setDarkenBtnBehavior(t._skipBtn,t,t._skipGuide),t._skipLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,t._skipGuide,t)):(xyd.setDarkenBtnBehavior(t._skipBtn,t,t._nextGuide),t._skipLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,t._nextGuide,t))},this,500),e.prototype.childrenCreated.call(this),3==this._highlightType){var i={};i[this._itemID]=1,xyd.WindowManager.get().openWindow("item_reward_window",{items:i,onComplete:function(){t._gameWin.updateItemCountByID(t._itemID),t.initUIComponent()}});var n=this._gameWin.getItemByID(this._itemID);n&&n.addTempNum(1)}else this.initUIComponent()},t.prototype.initUIComponent=function(){this.timer_=new egret.Timer(500,0),this.timer_.addEventListener(egret.TimerEvent.TIMER,this._onUpdate,this),this.timer_.start(),this.buildUIComponent(),this._playEnterAnimation()},t.prototype.buildUIComponent=function(){var e=this;this._touchText.visible=!1,this.touchEnabled=!1,this.height=xyd.getHeight(),this.width=xyd.getWidth();var i=.3,n=new egret.DisplayObjectContainer,o=new egret.Shape;o.graphics.beginFill(0,.6);var a=StageUtils.getInstance().getWidth(),s=StageUtils.getInstance().getHeight();if(o.graphics.drawRect(0,0,a*i,s*i),o.graphics.endFill(),n.addChild(o),!this.isFirstInit)if(1==this._highlightType||2==this._highlightType)this._cutoutToHighlightElements(n,i);else if(3==this._highlightType){var r="guide_"+this._itemID+"_demo_png",l=new egret.Bitmap;l.x=(xyd.getWidth()-t.ITEM_DEMO_WIDTH)/2,l.y=(xyd.getHeight()-t.ITEM_DEMO_HEIGHT)/2,RES.getResAsync(r).then(function(t){e.isDisposed_||(l.texture=t,e.addChildAt(l,1))})}else if(4==this._highlightType)this._cutoutToHighlightItem(n,i),this._shouldHighlighElement&&this._cutoutToHighlightElements(n,i),this._guideBanner.visible=this._shouldShowGuideUI,this._charHolder.visible=this._shouldShowGuideUI;else if(5==this._highlightType){var _=this._getGridFromUniloc(this._manual[0]),h=this._gameView.getBaseViewAt(_.x,_.y),c=h.localToGlobal(),d=new egret.Shape;d.graphics.beginFill(0,1);var p=xyd.TILE_HEIGHT;d.graphics.drawCircle(p*this._boardScale*i,p*this._boardScale*i,p*this._boardScale*i),d.graphics.endFill();var u=c.x-xyd.TILE_HEIGHT_HALF*this._boardScale,m=c.y-xyd.TILE_HEIGHT_HALF*this._boardScale;d.x=u*i,d.y=m*i,n.addChild(d),d.blendMode=egret.BlendMode.ERASE}t.renderTexture_.drawToTexture(n),this._guideBg=new egret.Bitmap(t.renderTexture_),this._guideBg.width=this._guideBg.width/i,this._guideBg.height=this._guideBg.height/i,this._isActiveType?this._setSwapTypeGuide():this._setTouchTypeGuide(),this.addChildAt(this._guideBg,0),this._guideBg.touchEnabled=!0;var g=GuideTable.get(),f=g.getTipText(this._guideID)||"";1001==this._guideID&&(ABTest.get().getSetting(ABTest.NEWUSER_STAGE_CASH_REWARD)||ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY))&&(f=xyd.__("GUIDE_PAY_TIPS"));var y=g.getTipPic(this._guideID);y?(this._guideImg.source=y,this._guideText.visible=!1,this._guideText1.text=f,this._guideText2.text=g.getTipText2(this._guideID),this._guideText3.text=g.getTipText3(this._guideID),this._guideText4.text=g.getTipText4(this._guideID),y=g.getTipPic2(this._guideID),y?this._guideImg2.source=y:this._guideImg2.visible=!1,""!=this._guideText4.text?(this._guideText4.visible=!0,this._guideGroup.y=4):(this._guideText4.visible=!1,this._guideGroup.y=49)):(this._guideGroup.visible=!1,this._guideText.text=f,this._guideText4.visible=!1);var E=g.getCharacterPos(this._guideID);1==E?this._charHolder.top=t.CHAR_TOP_Y-(this._charHolder.height-this._guideBanner.height):2==E?this._charHolder.bottom=t.CHAR_BOT_Y:3==E?this._charHolder.verticalCenter=t.CHAR_CENTER_Y:this._charHolder.visible=!1;var v=g.getTipPos(this._guideID);if(1==v?this._guideBanner.top=t.BANNER_TOP_Y:2==v?this._guideBanner.bottom=t.BANNER_BOT_Y:3==v?this._guideBanner.verticalCenter=0:this._guideBanner.visible=!1,void 0!=this._manual&&2==this._manual.length&&4!=this._highlightType){var T=this._manual[1],C=Math.floor(T/9),L=T%9,b=this._manual[0],w=Math.floor(b/9),S=b%9,O=w==C?[0,S-L]:[w-C,0];this.setGuideFingerAtGrid(w,S,O)}else if(4==this._highlightType)if(this._shouldHighlighElement){var A=this._manual.length;if(1==A){var b=this._manual[0],w=Math.floor(b/9),S=b%9,h=this._gameView.getBaseViewAt(w,S),c=h.localToGlobal();this.setGuideFingerAtLoc(c.x+1.5*xyd.TILE_WIDTH,c.y+1.5*xyd.TILE_HEIGHT)}else if(2==A){var T=this._manual[1],C=Math.floor(T/9),L=T%9,b=this._manual[0],w=Math.floor(b/9),S=b%9,O=w==C?[0,S-L]:[w-C,0];this.setGuideFingerAtGrid(w,S,O)}}else{var x=this._toHighlightItem;if(x){var c=x.localToGlobal();this.setGuideFingerAtLoc(c.x+x.width,c.y+x.height)}}else if(5==this._highlightType){var b=this._manual[0],w=Math.floor(b/9),S=b%9,h=this._gameView.getBaseViewAt(w,S),c=h.localToGlobal();this.setGuideFingerAtLoc(c.x+1.5*xyd.TILE_WIDTH,c.y+1.5*xyd.TILE_HEIGHT)}if(1091==this._guideID)this.guide_redbag_1.visible=!0;else if(1092==this._guideID){this.guide_redbag_2.visible=!0;var I=this._points[1],h=this._gameView.getBaseViewAt(I.x,I.y);if(void 0!=h){var _=h.localToGlobal();this.guide_redbag_2.x=_.x,this.guide_redbag_2.y=_.y+xyd.TILE_HEIGHT/2}this._gameWin.changeBoardElementToSpecialDrop(this._points[0].x,this._points[0].y),this._gameWin.changeBoardElementToSpecialDrop(this._points[1].x,this._points[1].y),this._gameWin.changeBoardElementToSpecialDrop(this._points[3].x,this._points[3].y)}else if(1093==this._guideID){var _=this._gameWin.getFundHead().localToGlobal();this.guide_redbag_3.visible=!0,this.guide_redbag_3.x=_.x,this.guide_redbag_3.y=_.y-10}this._gameView.highlightElementsInGuide(this._guideID)},t.prototype._setSwapTypeGuide=function(){var e=this;this._guideBg.pixelHitTest=!0,egret.setTimeout(function(){e._guideBg.addEventListener(egret.TouchEvent.TOUCH_TAP,e._voidClick,e)},this,500)},t.prototype._setTouchTypeGuide=function(){var e=this;this._touchText.visible=!0,egret.setTimeout(function(){e._guideBg.addEventListener(egret.TouchEvent.TOUCH_TAP,e._nextGuide,e)},this,500)},t.prototype._cutoutToHighlightElements=function(e,i){for(var n=t.ELEMENT_BASE_OFFSET,o=0;o<this._points.length;o++){var a=this._points[o],s=this._gameView.getBaseViewAt(a.x,a.y);if(void 0!=s){this._baseViews[o]=s;var r=new egret.Shape;r.graphics.beginFill(0,1),2==this._highlightType?r.graphics.drawRect(0,0,(xyd.TILE_WIDTH*this._boardScale+2*n)*i,(xyd.TILE_HEIGHT*this._boardScale+2*n)*i/2):r.graphics.drawRect(0,0,(xyd.TILE_WIDTH*this._boardScale+2*n)*i,(xyd.TILE_HEIGHT*this._boardScale+2*n)*i),r.graphics.endFill();var l=s.localToGlobal();this._baseViewLocs[o]=l,r.x=(l.x-n)*i,1==this._highlightType||4==this._highlightType?r.y=(l.y-n)*i:r.y=(l.y+xyd.TILE_HEIGHT-n)*i,e.addChild(r),r.blendMode=egret.BlendMode.ERASE}}},t.prototype._cutoutRedBagHold=function(e,t){var i=new egret.Shape;i.graphics.beginFill(0,1),i.graphics.drawCircle(0,0,86),i.graphics.endFill(),i.x=27,i.y=65,e.addChild(i),i.blendMode=egret.BlendMode.ERASE},t.prototype._cutoutToHighlightItem=function(e,i){var n=t.ITEM_CENTER_X_OFFSET,o=t.ITEM_CENTER_Y_OFFSET;if(this._toHighlightItem=this._gameWin.getBottomItemGroup(this._itemID),this._toHighlighItemPos=new egret.Point(this._toHighlightItem.x,this._toHighlightItem.y),void 0!=this._toHighlightItem){this._gameWin.setBottomItemInUse(this._itemID);var a=new egret.Shape;a.graphics.beginFill(0,1);var s=this._toHighlightItem.height*this._toHighlightItem.scaleY/2;a.graphics.drawCircle((s+n)*i,(s+o)*i,s*i),a.graphics.endFill();var r=this._toHighlightItem.localToGlobal();a.x=r.x*i,a.y=r.y*i,e.addChild(a),a.blendMode=egret.BlendMode.ERASE}else this._isActiveType=!1},t.prototype._onUpdate=function(){if(!this.isDisposed_){var e=!1;this.isFirstInit&&(e=!0,this.isFirstInit=!1);for(var t=0;t<this._baseViews.length;t++){var i=this._baseViews[t];if(void 0!=i){var n=i.localToGlobal(),o=this._baseViewLocs[t];if(void 0==o||n.x!=o.x||n.y!=o.y){e=!0;break}}}if(void 0!=this._itemID){var a=this._gameWin.getBottomItemGroup(this._itemID);void 0!=this._toHighlighItemPos&&(this._toHighlighItemPos.x!=a.x||this._toHighlighItemPos.y!=a.y)&&(e=!0)}1==this._forceUpdate&&(e=!0,this._forceUpdate=!1),e&&(this._guideBg&&this._guideBg.parent&&this._guideBg.parent.removeChild(this._guideBg),this._guideFinger&&this._guideFinger.parent&&this._guideFinger.parent.removeChild(this._guideFinger),this._gameView.clearPossibleMove(),this._fingerTween&&(this._fingerTween.kill(),this._fingerTween=void 0),this.buildUIComponent())}},t.prototype._showCharImg=function(){if(void 0!=GuideTable.get().getCharacterAct(this._guideID)){var e=GuideTable.get().getCharacterAct(this._guideID).toString();this._charImg.visible=!0,this._charImg.source="girl"+e+"_png"}},t.prototype._showCharAnimation=function(){if(void 0!=GuideTable.get().getCharacterAct(this._guideID)){var e=["celebration","appluad","yeah"],t=GuideTable.get().getCharacterAct(this._guideID).toString(),i="anna_guide_"+e[Number(t)-1];EffectFactory.get().newEffect("anna_guide"+t,function(e){e.x=156.5,e.y=470,e.animation.play(i+"1",1),e.touchEnabled=!1,this._charEff=e,this._charEffHolder.addChild(e);var t=function(n){e.removeDBEventListener("complete",t,this),e.animation.play(i+"2",-1)};e.addDBEventListener("complete",t,this)}.bind(this))}},t.prototype._playEnterAnimation=function(){this._charHolder.visible=!0,this._canSkip&&(ABTest.get().getSetting(ABTest.SMALL_SKIP_BTN)&&1==this._totalLevel?this._skipLabel.visible=!0:this._skipBtn.visible=!0),void 0!=GuideTable.get().getTipPos(this._guideID)&&this._shouldShowGuideUI&&(this._guideBanner.visible=!0,xyd.isiOS8?this._showCharImg():this._showCharAnimation())},t.prototype.getGuideID=function(){return this._guideID},t.prototype._nextGuide=function(){this._gameView.tryNextGuide(),this._shouldLogGuideLoss&&logger.logGuideLoss(3,this._guideID)},t.prototype._voidClick=function(){this._shouldLogGuideLoss&&logger.logGuideLoss(2,this._guideID)},t.prototype._skipGuide=function(){this._gameView.skipGuide(),this._shouldLogGuideLoss&&logger.logGuideLoss(1,this._guideID)},t.prototype.isTouchType=function(){return this.isTouchType},t.prototype.setGuideFingerAtLoc=function(e,t){this._guideFinger=new eui.Image("icon_shou_png"),this._guideFinger.x=e,this._guideFinger.y=t,this._guideFinger.anchorOffsetX=120,this._guideFinger.anchorOffsetY=120,this.addChildAt(this._guideFinger,1),this._guideFinger.touchEnabled=!1;var i=new TimelineMax({repeat:-1});this._fingerTween=i,i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:0,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)},t.prototype.setGuideFingerAtGrid=function(e,t,i){this._guideFinger=new eui.Image("icon_shou_png"),this.addChildAt(this._guideFinger,1),this._guideFinger.touchEnabled=!1;var n=this._gameView.getBaseViewAt(e,t);if(void 0!=n){var o=n.localToGlobal();this._guideFinger.x=o.x+xyd.TILE_WIDTH_HALF*this._boardScale,this._guideFinger.y=o.y+xyd.TILE_HEIGHT_HALF*this._boardScale;var a=new TimelineMax({repeat:-1});this._fingerTween=a;var s=0==i[0];if(s){var r=o.y,l=i[1]<0?xyd.TILE_HEIGHT_HALF:-xyd.TILE_HEIGHT_HALF;a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15,y:r},{rotation:0,y:r+l,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0,y:r+l},{rotation:15,y:r,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15,y:r},{rotation:0,y:r+l,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0,y:r+l},{rotation:15,y:r,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)}else{var _=o.x,l=i[0]<0?xyd.TILE_WIDTH_HALF:-xyd.TILE_WIDTH_HALF;a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15,x:_},{rotation:1,x:_+l,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0,x:_+l},{rotation:15,x:_,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15,x:_},{rotation:0,x:_+l,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),a.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0,x:_+l},{rotation:15,x:_,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)}}},t.prototype._getGridFromUniloc=function(e){var t=(this._manual[0],Math.floor(e/9)),i=e%9;return new egret.Point(t,i)},t.prototype.canHighlightELements=function(e){4==this._highlightType&&(this._shouldHighlighElement=e,this._forceUpdate=!0,this._onUpdate())},t.prototype.isItemGuide=function(){return void 0!=this._itemID},t.prototype.getItemID=function(){return this._itemID},t.prototype.showGuideUI=function(e){this._charHolder.visible=e,this._guideBanner.visible=e,this._shouldShowGuideUI=e},t.prototype.updateDisplay=function(){this._forceUpdate=!0,this._onUpdate},t.prototype.close=function(){if(!this.isDisposed_){this.isDisposed_=!0,this.timer_&&(this.timer_.stop(),this.timer_=void 0),this.parent&&this.parent.removeChild(this),t.highlightTexture_&&t.highlightTexture_.$renderBuffer.resize(0,0),t.renderTexture_&&t.renderTexture_.$renderBuffer.resize(0,0),this._fingerTween&&this._fingerTween.kill(),this._charEff&&(this._charEff.animation.stop(),this._charEff.dispose(),this._charEff=void 0);for(var e=0,i=this._usingTweens;e<i.length;e++){var n=i[e];n.kill()}this._usingTweens=[]}},t.highlightTexture_=void 0,t.renderTexture_=void 0,t.ELEMENT_BASE_OFFSET=3,t.ITEM_CENTER_X_OFFSET=5,t.ITEM_CENTER_Y_OFFSET=-5,t.ITEM_DEMO_Y_OFFSET=-400,t.ITEM_DEMO_WIDTH=892,t.ITEM_DEMO_HEIGHT=384,t.CHICK_LEFT_X=200,t.CHICK_LEFT_Y=200,t.CHAR_TOP_Y=165,t.CHAR_BOT_Y=395,t.CHAR_CENTER_Y=-110,t.BANNER_TOP_Y=200,t.BANNER_BOT_Y=360,t}(eui.Component);__reflect(Guide.prototype,"Guide");var JellyModeView=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t}(GameView);__reflect(JellyModeView.prototype,"JellyModeView");var LevelButton=function(e){function t(i,n,o){var a=e.call(this)||this;a.settedPressFunc_=!1,a.BTN_WIDTH_HALF=57,a.BTN_HEIGHT_HALF=47,a.SMALL_PACKET_WIDTH=166,a.SMALL_PACKET_HEIGHT=181,a.BIG_PACKET_WIDTH=205,a.BIG_PACKET_HEIGHT=225,a.MAX_LEVEL_NUM_WIDTH=90,a.hasTween_=!1,a.star_positions_=[{x:-5,y:80},{x:37,y:90},{x:79,y:80}],a.star_positions_packet_=[{x:-5,y:160},{x:37,y:170},{x:79,y:160}],a.img_=new egret.Bitmap,a.packetImg_=new egret.Bitmap,a.width=2*a.BTN_WIDTH_HALF,a.height=2*a.BTN_HEIGHT_HALF,a.anchorOffsetX=a.BTN_WIDTH_HALF,a.anchorOffsetY=2*a.BTN_HEIGHT_HALF,a.x=i,a.y=n-2*a.BTN_HEIGHT_HALF,a.win_=o,a.touchEnabled=!0,a.img_.touchEnabled=!1,a.packetImg_.touchEnabled=!1,a.img_.anchorOffsetX=a.BTN_WIDTH_HALF,a.img_.anchorOffsetY=a.BTN_HEIGHT_HALF,a.img_.x=a.BTN_WIDTH_HALF,a.img_.y=a.BTN_HEIGHT_HALF,a.addChild(a.img_),a.addChild(a.packetImg_),a.levelNumber_=xyd.bitmapNumber.createNumPic(1,"non_o_"),a.levelNumber_.y=12,a.addChild(a.levelNumber_),a.scaleLevelNumPic(1),a.centerLevelNumPic(),a.openImg_=new egret.Bitmap,a.openImg_.touchEnabled=!1,a.openImg_.x=-25,a.openImg_.y=90,a.openImg_.touchEnabled=!1,xyd.setBitmapAsync(a.openImg_,"icon_kekaiqi",function(){a.drawImg()}),a.addChild(a.openImg_),a.openLabel_=new eui.Label,a.openLabel_.textAlign="center",a.openLabel_.text="",a.openLabel_.width=200,a.openLabel_.anchorOffsetX=100,a.openLabel_.x=a.BTN_WIDTH_HALF,a.openLabel_.y=80,a.openLabel_.size=36,a.openLabel_.textColor=16777215,a.openLabel_.bold=!0,a.openLabel_.touchEnabled=!1,a.addChild(a.openLabel_),a.stars_=[];for(var s=0;s<t.MAX_STARS;s++){var r=new egret.Bitmap;r.scaleX=.8,r.scaleY=.8,r.x=a.star_positions_[s].x,r.y=a.star_positions_[s].y,r.visible=!0,a.stars_.push(r),a.addChild(r)}return a.setStarNum(0),a}return __extends(t,e),t.prototype.updatePos=function(e,t){this.x=e,this.y=t+2*this.BTN_HEIGHT_HALF},Object.defineProperty(t.prototype,"label",{get:function(){return this.levelNumber_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"img",{get:function(){return this.img_},enumerable:!0,configurable:!0}),t.prototype.getStar=function(e){return this.stars_[e]},Object.defineProperty(t.prototype,"level",{get:function(){return this.level_},enumerable:!0,configurable:!0}),t.prototype.setStarNum=function(e){this.starNum_=e;for(var i=function(t){n.stars_[t].visible=!0;var i=e>t?"icon_star1_png":"icon_star2_png";RES.getResAsync(i,function(e,i){if(e){var n=t<this.starNum_?"icon_star1_png":"icon_star2_png";i==n&&(this.stars_[t].texture=e)}},n)},n=this,o=0;o<t.MAX_STARS;o++)i(o)},t.prototype.setStarVisible=function(e){for(var i=0;i<t.MAX_STARS;i++)this.stars_[i].visible=e},t.prototype.centerLevelNumPic=function(){var e=xyd.bitmapNumber.getWidth(this.levelNumber_);this.levelNumber_.x=.5*(this.width-e)},t.prototype.scaleLevelNumPic=function(e){xyd.bitmapNumber.getWidth(this.levelNumber_);this.levelNumber_.scaleX=this.levelNumber_.scaleY=e},t.prototype.updateLevel=function(e){this.level_=e,this.name="Level_"+e,xyd.bitmapNumber.changeNum(this.levelNumber_,e,"non_o_");var t=1;e>999?t=.6:e>99&&(t=.8),this.scaleLevelNumPic(t),this.centerLevelNumPic(),xyd.bitmapNumber.setNumGap(this.levelNumber_,-8),this.centerLevelNumPic()},t.prototype.setRedPacketData=function(e,t){this.hasTween_&&(this.tw_.stop(),this.tw_.kill(),this.hasTween_=!1,this.packetImg_.rotation=0),this.type_=e,this.openState_=t,this.drawImg()},t.prototype.addOpenTween=function(e){},t.prototype.drawImg=function(){var e=this;this.img_.visible=!0,this.packetImg_.visible=!1,this.openLabel_.visible=!1,this.openImg_.visible=!1;for(var i=0;i<t.MAX_STARS;i++){var n=this.stars_[i];n.x=this.star_positions_[i].x,n.y=this.star_positions_[i].y}this.win_&&(this.settedPressFunc_||(xyd.setDarkenBtnBehavior(this,this,function(){0!=e.win_.canClick()&&e.level_&&(e.level_>xyd.MAX_STAGE?xyd.WindowManager.get().openWindow("commingsoon_window"):e.win_.enterStage(e.level_))}),this.settedPressFunc_=!0))},Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openState",{get:function(){return this.openState_},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){xyd.bitmapNumber.destroyNumPic(this.levelNumber_)},t.MAX_STARS=3,t}(eui.Group);__reflect(LevelButton.prototype,"LevelButton");var MapWrap=function(){function e(e,t,i,n,o){this.iconGroups_=[],this.MAX_WRAP_MAP_COUNT=13,this.mapEffects_=[],this.mapDragonBones_=[],this.mapDragonBoneAnimationStr_=[],this.EFFECT_SCALE=1.44,this.STAGE_OFFSET=40,this.PACKET_OFFSET=-80,this._isInited=!1,this.WHEEL_OFFSET=50,this.mapIndex_=0,this._movingEffectData=[],this._playedMovingEffect=!1,this._hasInitedEffects=!1,this._playingMapEffect=!1,this.MIDDLE_HEIGHT=2131,this.stageMap_=e;var a=new egret.Bitmap;this.bg_=a,this.topContainer_=new egret.DisplayObjectContainer,this.topContainer_.name="TopContainer",a.width=i,a.height=n,this.topContainer_.width=i,this.topContainer_.height=n,this.topOneContainer_=new egret.DisplayObjectContainer,this.topOneContainer_.name="TopOneContainer",this.topOneContainer_.width=i,this.topOneContainer_.height=n,this.btnGroups_=[],this.tileType_=o,this.addBtnToMap()}return Object.defineProperty(e.prototype,"bg",{get:function(){return this.bg_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topContainer",{get:function(){return this.topContainer_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topOneContainer",{get:function(){return this.topOneContainer_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnGroups",{get:function(){return this.btnGroups_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheelGroups",{get:function(){return this.iconGroups_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileIdx",{get:function(){return this.tileIdx_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapIdx",{get:function(){return this.mapIndex_},enumerable:!0,configurable:!0}),e.prototype.updateStartLevel=function(){var e=!ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE);this.startLevel_=LevelTable.get().getWrapMapStartLevel(this.tileIdx,e)},e.prototype.updateRecord=function(e){var t=e.level;if(t>=this.startLevel_&&t<this.startLevel_+this.btnGroups_.length){var i=SelfInfo.get().getStageInfo(t);this.btnGroups_[t-this.startLevel_].setRedPacketData(i.packet_type,i.packet_status)}},e.prototype.addBtnToMap=function(){for(var e=0;e<this.MAX_WRAP_MAP_COUNT;e++){var t=0,i=0,n=new LevelButton(t,i,this.stageMap_);n.name="init_button",this.topContainer_.addChild(n),this.btnGroups_.push(n)}this.tileType_==TileType.HEAD&&this.update(1),this.tileType_==TileType.TAIL&&this.update(StageMap.MAX_PAGE_COUNT)},e.prototype.update=function(e){var t=this;this.tileIdx_=e,this.updateStartLevel();var i=this.startLevel_,n=this.startLevel_+this.btnGroups_.length-1;i>SelfInfo.get().getCurrentLevel()?this.updateBtns():(this.disableBtns(),SelfInfo.get().requestMapData(i,n).then(function(){i==t.startLevel_&&t.updateBtns()}))},e.prototype.disableBtns=function(){for(var e=!ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE),t=0;t<this.btnGroups_.length;t++)this.btnGroups_[t].visible=!1;if(this.startLevel_=LevelTable.get().getWrapMapStartLevel(this.tileIdx,e),this.startLevel_){var i,n=LevelTable.get().getTableData(this.startLevel_);i=e?n.map_new-1:n.map-1,0>i&&(i=e?7:1);var o=this.stageMap_.stageBgPng_[i];xyd.setBitmapAsync(this.bg_,o)}},e.prototype.updateBtns=function(){var e=!ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE);if(this.startLevel_=LevelTable.get().getWrapMapStartLevel(this.tileIdx,e),this.startLevel_){for(var t=this.startLevel_,i=-1,n=SelfInfo.get().getCurrentLevel(),o=0,a=function(a){s.btnGroups_[a].visible=!0;var r=LevelTable.get().getTableData(t),l=SelfInfo.get().getStageInfo(t);if(void 0==r)return s.btnGroups_[a].visible=!1,"continue";var _=r,h=void 0,c=void 0;if(e?(h=_.x_pos_new,c=s.bg.height-_.y_pos_new-s.STAGE_OFFSET):(h=_.x_pos,c=s.bg.height-_.y_pos-s.STAGE_OFFSET),0==a){var d=void 0;d=e?r.map_new-1:r.map-1,0>d&&(d=e?7:1),s.mapIndex_=d;var p=s.stageMap_.stageBgPng_[d];xyd.setBitmapAsync(s.bg_,p),i=e?r.map_new:r.map,s.updateMapEffect(i)}var u=0;r&&(u=r.difficulty);var m=s.btnGroups_[a],g=m.img,f="";if(m.updateLevel(t),m.updatePos(h,c),e?r.map_new==i?(m.visible=!0,t==n&&s.stageMap_.setAvatarPos(s,a)):m.visible=!1:r.map==i?(m.visible=!0,t==n&&s.stageMap_.setAvatarPos(s,a)):m.visible=!1,!e&&r.lucky_wheel&&m.visible){for(var y=r.wheel_x_pos,E=s.bg.height-r.wheel_y_pos-s.STAGE_OFFSET;o>=s.iconGroups_.length;){var v=new WheelButton(y,E,s.stageMap_);s.iconGroups_.push(v),s.topContainer_.addChild(v)}var T=s.iconGroups_[o];T.setIconData(y,E+s.WHEEL_OFFSET,t,1,l.packet_status),o++}if(t>xyd.MAX_STAGE||t>n)m.label.visible=!1,f="btn_stage_lock_png",m.setStarVisible(!1),m.img.touchEnabled=!1;else{switch(m.setStarVisible(!0),m.label.visible=!0,m.img.touchEnabled=!0,f="btn_stage_up_png",u){case 1:f="btn_guanqiakunnan_png";break;case 2:f="btn_guanqiakunnan_png";break;case 3:f="btn_guanqiakunnan_png"}if(t==n-1&&s.stageMap_.canPlayAvatarAnim());else{var C=SelfInfo.get().getStageInfo(t).stars;m.setStarNum(C)}}var L=t;RES.getResAsync(f,function(e,t){e&&m.level==L&&(g.texture=e)},s),m.setRedPacketData(l.packet_type,l.packet_status),s._lastLevel=t,t++},s=this,r=0;r<this.btnGroups_.length;r++)a(r);this._isInited=!0,this.stageMap_.setFriendAvatarsOnMapWrap(this),this.stageMap_.setGiftBoxOnMapWrap(this)}},e.prototype.updateMapEffectState=function(e){var t=e-(this.tileIdx_-1)*this.MIDDLE_HEIGHT/2,i=e-this.tileIdx_*this.MIDDLE_HEIGHT/2,n=(t+i)/2,o=!1;if(n<this.MIDDLE_HEIGHT/2&&n>-this.MIDDLE_HEIGHT/2&&(o=!0),o!=this._playingMapEffect){if(o){for(var a=0;a<this.mapDragonBones_.length;a++)if(this.mapDragonBones_[a]&&this.mapDragonBones_[a].animation){var s=this.mapDragonBoneAnimationStr_[a];this.mapDragonBones_[a].animation.play(s,-1)}}else for(var a=0;a<this.mapDragonBones_.length;a++)this.mapDragonBones_[a]&&this.mapDragonBones_[a].animation&&this.mapDragonBones_[a].animation.stop();this._playingMapEffect=o}},e.prototype.updateMapMovingEffect=function(e){if(!this._playedMovingEffect&&this._movingEffectData.length>0&&void 0!=this._movingEffect){var t=0,i=this._movingEffectData[t],n=i.start_effect_y,o=i.end_effect_y,a=i.animation,s=e-(this.tileIdx_-1)*this.MIDDLE_HEIGHT/2,r=e-this.tileIdx_*this.MIDDLE_HEIGHT/2,l=(s+r)/2;if(l>n&&o>l){this._playedMovingEffect=!0;var _=this._movingEffect;_.animation.stop(),_.animation.timeScale=1,_.animation.play(a,1);var h=function(e){_.removeDBEventListener("complete",h,this),_.animation.stop()};_.addDBEventListener("complete",h,this)}}},e.prototype.updateMapEffect=function(e){var t=this;this._playedMovingEffect=!1;for(var i=MapEffectTable.get().getTableDataByMapType(e),n=0;n<this.mapEffects_.length;n++)this.mapEffects_[n].parent&&this.topContainer_.removeChild(this.mapEffects_[n]);if(this.mapEffects_=[],this._movingEffectData=[],i)for(var o=function(e){var n=MapEffectTable.get().getTableDataByIndex(i[e]);n.start_effect_y&&0!=n.start_effect_y&&n.end_effect_y&&a._movingEffectData.push(n);var o=n.effect_type,s=n.effect_name,r=n.animation,l=n.x_pos,_=a.bg.height-n.y_pos;if(1==o){var h=new egret.Bitmap;xyd.setBitmapAsync(h,s,function(){h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,h.scaleX=t.EFFECT_SCALE,h.scaleY=t.EFFECT_SCALE}),h.x=l,h.y=_,a.topContainer_.addChildAt(h,0),a.mapEffects_.push(h)}else if(!xyd.isLowEndDevice)if(n.start_effect_y&&0!=n.start_effect_y&&n.end_effect_y){if(a._movingEffect)return a._playedMovingEffect=!1,a._movingEffect.animation.timeScale=0,a._movingEffect.animation.play(r,-1),"continue";EffectFactory.get().newEffect(s,function(e){e.x=l,e.y=_,e.scaleX=this.EFFECT_SCALE,e.scaleY=this.EFFECT_SCALE,this.topOneContainer_.addChildAt(e,0),e.animation.timeScale=0,e.animation.play(r,-1),this._movingEffect=e}.bind(a))}else a._hasInitedEffects||EffectFactory.get().newEffect(s,function(e){e.x=l,e.y=_,e.scaleX=this.EFFECT_SCALE,e.scaleY=this.EFFECT_SCALE,e.animation.play(r,-1),ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE)?this.topOneContainer_.addChildAt(e,0):this.topContainer_.addChildAt(e,0),this.mapDragonBones_.push(e),this.mapDragonBoneAnimationStr_.push(r)}.bind(a))},a=this,n=0;n<i.length;n++)o(n);this._hasInitedEffects=!0},e.prototype.playEffect=function(e,t,i,n){EffectFactory.get().newEffect(e,function(e){e.x=i,e.y=n,e.scaleX=this.EFFECT_SCALE,e.scaleY=this.EFFECT_SCALE,e.animation.play(t,1),this.topOneContainer_.addChildAt(e,0);var o=function(t){e.removeDBEventListener("complete",o,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",o,this)}.bind(this))},e.prototype.getStartLevel=function(){return this.startLevel_},e.prototype.getEndLevel=function(){return this._lastLevel},e.prototype.isInited=function(){return this._isInited},e.prototype.dispose=function(){for(var e=0;e<this.mapDragonBones_.length;e++)this.mapDragonBones_[e]&&this.mapDragonBones_[e].animation&&(this.mapDragonBones_[e].animation.stop(),this.mapDragonBones_[e]&&this.mapDragonBones_[e].parent&&this.mapDragonBones_[e].parent.removeChild(this.mapDragonBones_[e]),EffectFactory.get().pushBackEffect(this.mapDragonBones_[e]));if(this._movingEffect){var t=this._movingEffect;t.animation.stop(),t.animation.stop(),t.parent&&t.parent.removeChild(t),EffectFactory.get().pushBackEffect(t),this._movingEffect=void 0}for(var i=0,n=this.btnGroups_;i<n.length;i++){var o=n[i];TweenLite.killTweensOf(o),o.dispose()}this.mapDragonBones_=[],this.mapDragonBoneAnimationStr_=[]},e}();__reflect(MapWrap.prototype,"MapWrap");var MovesTargetComponent=function(e){function t(t){var i=e.call(this)||this;return i._numPics=[],i.skinName="resource/skins/MovesTargetComponentSkin.exml",i._score=t.score||0,i._targetScore=t.targetScore||0,i}return __extends(t,e),t.prototype.childrenCreated=function(){var e=0,t=xyd.bitmapNumber.createNumPic(this._score,"non_e_");t.scaleX=.82,t.scaleY=.82,this._targetNumGroup.addChild(t),this._numPics.push(t),e+=xyd.bitmapNumber.getWidth(t);
var i=new egret.TextField;i.text="/",i.textColor=611459,i.size=48,i.bold=!0,i.fontFamily="Microsoft YaHei",this._targetNumGroup.addChild(i),e+=25;var n=xyd.bitmapNumber.createNumPic(this._targetScore,"non_c_");n.scaleX=.43,n.scaleY=.43,this._targetNumGroup.addChild(n),this._numPics.push(n),e+=xyd.bitmapNumber.getWidth(n);var o=(this._targetNumGroup.width-e)/2;t.x=o,t.y=(this._targetNumGroup.height-xyd.bitmapNumber.getHeight(t))/2,o+=t.width,i.x=o,i.y=(this._targetNumGroup.height-i.height)/2-2,o+=25,n.x=o,n.y=(this._targetNumGroup.height-xyd.bitmapNumber.getHeight(n))/2},t.prototype.dispose=function(){for(var e=0,t=this._numPics;e<t.length;e++){var i=t[e];xyd.bitmapNumber.destroyNumPic(i)}},t}(eui.Component);__reflect(MovesTargetComponent.prototype,"MovesTargetComponent");var ObjectTargetComponent=function(e){function t(t){var i=e.call(this)||this;return i._numPics=[],i.skinName="resource/skins/ObjectTargetComponentSkin.exml",i._score=t.score||0,i._targetScore=t.targetScore||0,i._targetType=t.targetType,i._targetStatus=t.targetStatus||0,i}return __extends(t,e),t.prototype.childrenCreated=function(){this._targetImg.source=DisplayConstants.TargetSourceMap[this._targetType],void 0==this._targetImg.source&&console.log("unknow target type"),("icon_fengche_png"==this._targetImg.source||"block_slate3_png"==this._targetImg.source)&&(this._targetImg.scaleX=.8,this._targetImg.scaleY=.8);var e=1;this._targetScore>=1e3&&(e=.75);var t,i=0;1==this._targetStatus?(this._statusImg.source="icon_duihao_png",t=xyd.bitmapNumber.createNumPic(this._score,"non_p_"),t.scaleX=e,t.scaleY=e,this._targetNumGroup.addChild(t),this._numPics.push(t),i+=xyd.bitmapNumber.getWidth(t)):(this._statusImg.source="icon_chahao_png",t=xyd.bitmapNumber.createNumPic(this._score,"non_w_"),t.scaleX=e,t.scaleY=e,this._targetNumGroup.addChild(t),this._numPics.push(t),i+=xyd.bitmapNumber.getWidth(t));var n=new egret.TextField;n.text="/",n.textColor=9064502,n.size=48,n.bold=!0,n.fontFamily="Microsoft YaHei",this._targetNumGroup.addChild(n),i+=25;var o=xyd.bitmapNumber.createNumPic(this._targetScore,"non_p_");o.scaleX=e,o.scaleY=e,this._targetNumGroup.addChild(o),this._numPics.push(o),i+=xyd.bitmapNumber.getWidth(o);var a=(this._targetNumGroup.width-i)/2;t.x=a,t.y=(this._targetNumGroup.height-xyd.bitmapNumber.getHeight(t))/2,a+=xyd.bitmapNumber.getWidth(t),n.x=a+2,n.y=(this._targetNumGroup.height-n.height)/2-5,a+=25,o.x=a,o.y=(this._targetNumGroup.height-xyd.bitmapNumber.getHeight(o))/2},t.prototype.dispose=function(){for(var e=0,t=this._numPics;e<t.length;e++){var i=t[e];xyd.bitmapNumber.destroyNumPic(i)}},t}(eui.Component);__reflect(ObjectTargetComponent.prototype,"ObjectTargetComponent");var PlayerAvatar=function(e){function t(t){var i=e.call(this)||this;i.group_all=new egret.DisplayObjectContainer,i.addChild(i.group_all),t&&SelfInfo.get().getCashAmount()&&(i.group_all.visible=!1),i.name="PlayerAvatar";var n=new egret.Bitmap;i.group_all.addChild(n);var o=new egret.Bitmap;if(xyd.setBitmapAsync(o,"touxiangmengban"),o.width=104,o.height=104,o.x=17,o.y=12,i.group_all.addChild(o),"canvas"!=xyd.renderMode){var a=new egret.Bitmap;xyd.setBitmapAsync(a,"touxiangmengban"),a.width=104,a.height=104,a.x=17,a.y=12,i.group_all.addChild(a),o.mask=a}i.avatar_=o,i.anchorOffsetX=69,i.anchorOffsetY=152;var s="touxiang_bg_2";return t&&(s="touxiang_bg_1"),xyd.setBitmapAsync(n,s),i}return __extends(t,e),t.prototype.setAvatar=function(e){xyd.setBitMapByUrl(this.avatar_,e)},t.prototype.showView=function(){this.group_all.visible=!0},t.prototype.hideView=function(){this.group_all.visible=!1},t}(egret.DisplayObjectContainer);__reflect(PlayerAvatar.prototype,"PlayerAvatar");var PlayerAvatarCash=function(e){function t(){var t=e.call(this)||this;return t.logged=!1,t.setPlayerAvatarCash(),t}return __extends(t,e),t.prototype.setPlayerAvatarCash=function(){ABTest.get().getSetting(ABTest.MAP_RED_PACKET_STYLE)?(this.group_all=new egret.DisplayObjectContainer,SelfInfo.get().getCashOpen()?this.logged||(this.logged=!0,Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_FUND_STAGE)):this.group_all.visible=!1,this.addChild(this.group_all),this.name="PlayerAvatarCash",this.bg=new egret.Bitmap,this.group_all.addChild(this.bg),xyd.setBitmapAsync(this.bg,"fund_hongbaodakai"),this.cashAmount=SelfInfo.get().getCashAmount(),this.btn=new egret.Bitmap,xyd.setBitmapAsync(this.btn,"icon_anniu1"),void 0!=this.cashAmount&&(this.cashNumLabel_B=new egret.TextField,this.cashNumLabel_Mark=new egret.TextField,this.cashNumLabel_Mark.textFlow=[{text:"¥",style:{size:28,bold:!0,fontFamily:"Microsoft YaHei",textColor:14034970}}],this.cashNumLabel_B.textFlow=[{text:this.cashAmount.toString(),style:{size:58,bold:!0,fontFamily:"Microsoft YaHei",textColor:14034970}}],this.cashNumLabel_Mark.height=55,this.cashNumLabel_Mark.width=20,this.cashNumLabel_Mark.textAlign="center",this.group_all.addChild(this.cashNumLabel_Mark),this.cashNumLabel_Mark.x=17,this.cashNumLabel_Mark.y=75,this.cashNumLabel_B.height=55,this.cashNumLabel_B.width=180,this.cashNumLabel_B.textAlign="center",this.group_all.addChild(this.cashNumLabel_B),this.cashNumLabel_B.x=20,this.cashNumLabel_B.y=58),this.confirm_label=new eui.Label,this.confirm_label.text="提现",this.confirm_label.size=28,this.confirm_label.textColor=10363912,this.confirm_label.textAlign="center",this.confirm_label.fontFamily="Microsoft YaHei",this.confirm_label.bold=!0,this.confirm_label.width=140,this.group_all.addChild(this.btn),this.group_all.addChild(this.confirm_label),this.btn.x=12,this.btn.y=155,this.confirm_label.x=34,this.confirm_label.y=170,this.title=new egret.Bitmap,xyd.setBitmapAsync(this.title,"icon-weixindakuan"),this.group_all.addChild(this.title),this.title.x=58,this.title.y=18,this.width=209,this.height=230,this.group_all.width=this.width,this.group_all.height=this.height,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getMoney,this)):(this.group_all=new egret.DisplayObjectContainer,SelfInfo.get().getCashOpen()?this.logged||(this.logged=!0,Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_FUND_STAGE)):this.group_all.visible=!1,this.addChild(this.group_all),this.name="PlayerAvatarCash",this.bg=new egret.Bitmap,this.group_all.addChild(this.bg),xyd.setBitmapAsync(this.bg,"guide_redbag_open"),this.bg.scaleX=this.bg.scaleY=.27,this.cashAmount=SelfInfo.get().getCashAmount(),this.btn=new egret.Bitmap,xyd.setBitmapAsync(this.btn,"icon_anniu1"),void 0!=this.cashAmount&&(this.cashNumLabel=new eui.Label,this.cashNumLabel.height=55,this.cashNumLabel.width=200,this.cashNumLabel.text="¥"+this.cashAmount.toString(),this.cashNumLabel.size=44,this.cashNumLabel.textColor=14034970,this.cashNumLabel.textAlign="center",this.cashNumLabel.fontFamily="Microsoft YaHei",this.group_all.addChild(this.cashNumLabel),this.cashNumLabel.x=-20,this.cashNumLabel.y=30),this.confirm_label=new eui.Label,this.confirm_label.text="提现",this.confirm_label.size=25,this.confirm_label.textColor=10363912,this.confirm_label.textAlign="center",this.confirm_label.fontFamily="Microsoft YaHei",this.confirm_label.bold=!0,this.confirm_label.width=140,this.btn.scaleX=this.btn.scaleY=.8,this.group_all.addChild(this.btn),this.group_all.addChild(this.confirm_label),this.btn.x=8,this.btn.y=138,this.confirm_label.x=10,this.confirm_label.y=148,this.width=164,this.height=190,this.group_all.width=this.width,this.group_all.height=this.height,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getMoney,this))},t.prototype.setAvatar=function(e){},t.prototype.getMoney=function(){platform.callMethod("RED_PACKET_CASH_CLICK_BUTTON",{})["catch"](function(e){logger.error(e)}),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_FUND_STAGE)},t.prototype.changeNum=function(){if(ABTest.get().getSetting(ABTest.MAP_RED_PACKET_STYLE)){var e=SelfInfo.get().getCashAmount();void 0!=this.cashAmount?(e!=this.cashAmount&&(this.cashNumLabel_B.textFlow=[{text:e.toString(),style:{size:58,bold:!0,fontFamily:"Microsoft YaHei",textColor:14034970}}]),this.cashAmount=e):(this.cashAmount=SelfInfo.get().getCashAmount(),this.cashNumLabel_B=new egret.TextField,this.cashNumLabel_Mark=new egret.TextField,this.cashNumLabel_Mark.textFlow=[{text:"¥",style:{size:28,bold:!0,fontFamily:"Microsoft YaHei",textColor:14034970}}],this.cashNumLabel_B.textFlow=[{text:this.cashAmount.toString(),style:{size:58,bold:!0,fontFamily:"Microsoft YaHei",textColor:14034970}}],this.cashNumLabel_Mark.height=55,this.cashNumLabel_Mark.width=20,this.cashNumLabel_Mark.textAlign="center",this.group_all.addChild(this.cashNumLabel_Mark),this.cashNumLabel_Mark.x=17,this.cashNumLabel_Mark.y=75,this.cashNumLabel_B.height=55,this.cashNumLabel_B.width=180,this.cashNumLabel_B.textAlign="center",this.group_all.addChild(this.cashNumLabel_B),this.cashNumLabel_B.x=20,this.cashNumLabel_B.y=58)}else{var e=SelfInfo.get().getCashAmount();void 0!=this.cashAmount?(e!=this.cashAmount&&(this.cashNumLabel.text="¥"+e.toString()),this.cashAmount=e):(this.cashAmount=SelfInfo.get().getCashAmount(),this.cashNumLabel=new eui.Label,this.cashNumLabel.height=55,this.cashNumLabel.width=200,this.cashNumLabel.text="¥"+this.cashAmount.toString(),this.cashNumLabel.size=44,this.cashNumLabel.textColor=14034970,this.cashNumLabel.textAlign="center",this.cashNumLabel.fontFamily="Microsoft YaHei",this.group_all.addChild(this.cashNumLabel),this.cashNumLabel.x=-18,this.cashNumLabel.y=30)}},t.prototype.dispose=function(){this.destroyNum(),this.parent&&this.parent.removeChild(this)},t.prototype.showView=function(){this.logged||(this.logged=!0,Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_FUND_STAGE)),this.group_all.visible=!0},t.prototype.hideView=function(){this.group_all.visible=!1},t.prototype.destroyNum=function(){this.cashAmount=void 0},t}(egret.DisplayObjectContainer);__reflect(PlayerAvatarCash.prototype,"PlayerAvatarCash");var RankingListItemRenderer=function(e){function t(){var t=e.call(this)||this;return t._numPics=[],t.skinName="resource/skins/RankListItemSkin.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),xyd.setNormalBtnBehavior(this.btn_single_recall,this,this.onBtnSingleRecall),xyd.setNormalBtnBehavior(this.btn_all_recall,this,this.onBtnAllRecall),xyd.setNormalBtnBehavior(this.img_plus,this,this.onBtnAllRecall)},t.prototype.onBtnSingleRecall=function(){platform.callMethod("GAME_SHARE",{type:"score_rank_recall",params:{is_single:!0,recall_list:[this.data]}})["catch"](function(e){return logger.error(e)}),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SCORE_RANK_SINGLE_RECALL_BTN)},t.prototype.onBtnAllRecall=function(){platform.callMethod("GAME_SHARE",{type:"score_rank_recall",params:{is_single:!1,recall_list:this.data.recall_list}})["catch"](function(e){return logger.error(e)}),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SCORE_RANK_ALL_RECALL_BTN)},t.prototype.dataChanged=function(){if(this.listImg_.visible=!1,this.data.recall_all)return void(this.currentState="recall_all");this.data.can_recall&&SelfInfo.get().getShareInfoWithKey("score_rank_recall")?(this.currentState="single_recall",Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SCORE_RANK_ALL_RECALL_BTN)):this.currentState="normal";var e=this.data.nickname;this.data.nickname.length>4&&(e=e.substring(0,3)+"..."),this.nameLabel_.text=e,this.avatarImg_.mask=this.maskImg_,this.setRank(this.data.rank,!1),this.setHeadIcon(this.data.avatar),this.setDiamondNum(this.data.recall_diamond),this.scoreLabel_.text=this.data.score},t.prototype.setDiamondNum=function(e){this.data.can_recall&&(this.txt_diamond_num.text="x"+e.toString())},t.prototype.setHeadIcon=function(e){this.avatarImg_.source=e},t.prototype.setRank=function(e,t){if(1==e)this.listImg_.visible=!0,this.rank_group_.visible=!1,this.listImg_.source="stage_rank_1_png";else if(2==e)this.listImg_.visible=!0,this.rank_group_.visible=!1,this.listImg_.source="stage_rank_2_png";else if(3==e)this.listImg_.visible=!0,this.rank_group_.visible=!1,this.listImg_.source="stage_rank_3_png";else{this.listImg_.visible=!1,this.rank_group_.visible=!0;var i="non_p_";i="non_p_",this._rankNumPic?xyd.bitmapNumber.changeNum(this._rankNumPic,e,i):(this._rankNumPic=xyd.bitmapNumber.createNumPic(e,i),this.rank_group_.addChild(this._rankNumPic),this._numPics.push(this._rankNumPic)),this._rankNumPic.scaleX=this._rankNumPic.scaleY=.75,xyd.bitmapNumber.setNumGap(this._rankNumPic,-5),this._rankNumPic.x=.5*(this.rank_group_.width-xyd.bitmapNumber.getWidth(this._rankNumPic)),this._rankNumPic.y=.5*(this.rank_group_.height-xyd.bitmapNumber.getHeight(this._rankNumPic))}},t.prototype.dispose=function(){for(var e=0,t=this._numPics;e<t.length;e++){var i=t[e];i.parent&&(i.parent.removeChild(i),xyd.bitmapNumber.destroyNumPic(i))}},t}(eui.ItemRenderer);__reflect(RankingListItemRenderer.prototype,"RankingListItemRenderer");var SendStaminaListItemRender=function(e){function t(t){var i=e.call(this)||this;return i.skinName="resource/skins/SendStaminaItemSkin.exml",(void 0==t||""==t)&&(t="bg_jiazaitouxiang_png"),i._avatar.source=t,i}return __extends(t,e),t}(eui.Component);__reflect(SendStaminaListItemRender.prototype,"SendStaminaListItemRender");var StageConversationComponent=function(e){function t(t){var i=e.call(this)||this;return i._jiantou_width=57,i._jiantou_height=45,i._isStoryFinished=!1,i._usingTimelines=[],i._text1=new egret.TextField,i._text2=new egret.TextField,i._text3=new egret.TextField,i._text_bg=new egret.Bitmap,i._jiantou=new egret.Bitmap,i.addChild(i._text_bg),i.addChild(i._jiantou),i.addChild(i._text1),i.addChild(i._text2),i.addChild(i._text3),xyd.setBitmapAsync(i._text_bg,"bg_neijuqin",function(e,t){t.anchorOffsetX=0,t.anchorOffsetY=0,t.scale9Grid=new egret.Rectangle(48,35,1,1)}),xyd.setBitmapAsync(i._jiantou,"bg_neijuqinjiantou",function(e,t){t.width=i._jiantou_width,t.height=i._jiantou_height,t.anchorOffsetX=0,t.anchorOffsetY=0}),i._text1.size=36,i._text1.x=30,i._text1.y=30,i._text1.textColor=8989188,i._text1.lineSpacing=20,i._text1.$setBold(!0),i._text1.fontFamily="Microsoft YaHei",i._text1.visible=!1,i.setStageCount(t),i._scale=1,i.setDisplay(),i.touchChildren=!1,i}return __extends(t,e),t.prototype.getTextFlowElement=function(e,t){return{text:e,style:{textColor:t,size:36,fontFamily:"Microsoft YaHei"}}},t.prototype.setStageCount=function(e){var t=[];e>0?(t.push(this.getTextFlowElement("再过",8989188)),t.push(this.getTextFlowElement(e+"关",16270848)),t.push(this.getTextFlowElement("，立即获得一次抽奖机会!",8989188)),this._text1.textFlow=t,this._text2.visible=!0,this._text1.width=610,this._text_bg.width=610):(t.push(this.getTextFlowElement("通过当前关，立即获得一次抽奖机会!",8989188)),this._text1.textFlow=t,this._text2.visible=!1,this._text1.width=620,this._text_bg.width=650)},t.prototype.setDisplay=function(){this._text_bg.height=this._text1.height+60,this._jiantou.scaleX=-1,this._jiantou.y=this._text_bg.height-20,this._jiantou.x=480,this.x+=this._jiantou.x,this.y+=this._jiantou.y,this.anchorOffsetX=this._jiantou.x,this.anchorOffsetY=this._jiantou.y,this.UIAnimation()},t.prototype.getConversationHeight=function(){return this._text_bg.height+25},t.prototype.UIAnimation=function(){var e=new TimelineMax;this._usingTimelines.push(e),this.scaleX=0,this.scaleY=0,this._text1.visible=!0,e.add(TweenLite.to(this,6*xyd.TweenDeltaTime,{scaleX:1.15*this._scale,scaleY:1.15*this._scale,ease:Linear.easeNone}),0),e.add(TweenLite.to(this,3*xyd.TweenDeltaTime,{scaleX:this._scale,scaleY:this._scale,ease:Linear.easeNone}),6*xyd.TweenDeltaTime)},t.prototype.UICloseAnimation=function(e){var t=new TimelineMax;this._usingTimelines.push(t),t.add(TweenLite.to(this,3*xyd.TweenDeltaTime,{scaleX:1.15*this._scale,scaleY:1.15*this._scale,ease:Linear.easeNone}),0),t.add(TweenLite.to(this,6*xyd.TweenDeltaTime,{scaleX:0,scaleY:0,ease:Linear.easeNone}),3*xyd.TweenDeltaTime),egret.setTimeout(function(){e&&e()},this,9e3*xyd.TweenDeltaTime)},t.prototype.dispose=function(){this.touchChildren=!0;for(var e=0,t=this._usingTimelines;e<t.length;e++){var i=t[e];i.kill()}},t.prototype.updatePos=function(e,t){this.x=e+this.anchorOffsetX*this._scale,this.y=t+this.anchorOffsetY*this._scale},t}(egret.DisplayObjectContainer);__reflect(StageConversationComponent.prototype,"StageConversationComponent");var StageGiftBox=function(e){function t(t,i){var n=e.call(this)||this;n.ITEM_INTERVAL=155,n._numOfReward=0,n._lastIndex=0,n.x=i.x,n.y=i.y,n.width=155,n.height=140,DisplayConstants.get(),n.name="GiftBox",n._items=t;for(var o in t)n._numOfReward++;return n._initUIComponent(),n}return __extends(t,e),t.prototype._initUIComponent=function(){this._imgGiftBox=new eui.Image,xyd.setUISpriteAsync(this._imgGiftBox,"icon_giftbox",null),this._imgGiftBox.name="GiftBox",this.addChild(this._imgGiftBox),this._imgGiftBox.width=155,this._imgGiftBox.height=140,this._rewardGroup=new eui.Group,this._rewardGroup.name="RewardGroup",this.addChild(this._rewardGroup),this._rewardGroup.width=this._imgGiftBox.width,this._rewardGroup.height=this._imgGiftBox.height,this._rewardGroup.visible=!1;var e=new eui.Image;xyd.setUISpriteAsync(e,"bubble_arrow",null),e.name="BubbleArrow",this._rewardGroup.addChild(e),e.x=this._rewardGroup.width/2-15,e.y=5;var t=new eui.Image;xyd.setUISpriteAsync(t,"bubble_square",null),t.name="BubbleSquare",this._rewardGroup.addChildAt(t,0);var i=new eui.Group;i.name="ItemGroup",this._rewardGroup.addChild(i),t.scale9Grid=new egret.Rectangle(21,55,60,36),i.width=t.width=this._numOfReward*this.ITEM_INTERVAL+50,i.height=t.height=146;var n=[30,-(t.width-this._imgGiftBox.width+30)],o=-(t.width-this._rewardGroup.width)/2;this.x<=300?i.x=t.x=n[0]:this.x+this._imgGiftBox.width>=xyd.getWidth()-300?i.x=t.x=n[1]:i.x=t.x=o,i.y=t.y=-t.height+20;for(var a in this._items){var s=this._createSingleItem(a,this._items[a]);s&&i.addChild(s)}var r=new eui.HorizontalLayout;r.gap=10,r.paddingTop=8,r.horizontalAlign=egret.HorizontalAlign.CENTER,i.layout=r,this._imgGiftBox.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onTabGiftBox,this)},t.prototype._onTabGiftBox=function(){var e=this;this._rewardGroup.visible||(this.parent&&(this._lastIndex=this.parent.getChildIndex(this),this.parent.setChildIndex(this,this.parent.numChildren-1)),this._bubbleVisibleTimeout&&egret.clearTimeout(this._bubbleVisibleTimeout),this._rewardGroup.visible=!this._rewardGroup.visible,this._rewardGroup.visible&&(this._bubbleVisibleTimeout=egret.setTimeout(function(){e.parent.setChildIndex(e,e._lastIndex),e._rewardGroup.visible&&(e._rewardGroup.visible=!1)},this,3e3)))},t.prototype.dispose=function(){this._bubbleVisibleTimeout&&egret.clearTimeout(this._bubbleVisibleTimeout),this._imgGiftBox.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onTabGiftBox,this)},t.prototype._createSingleItem=function(e,t){var i=e.split("=");if(!i||2!=i.length)return null;var n=Number(i[0]),o=Number(i[1]);1==n&&(o+=2e3);var a=DisplayConstants.ItemSourceMap[o];if(!a)return logger.errorStr("ERROR: No Img for this item, itemID :"+o),null;var s=new eui.Group;s.name="Item",s.width=this.ITEM_INTERVAL,s.height=130;var r=new eui.Image;if(s.addChild(r),xyd.setUISpriteAsync(r,a,function(e,t){t.height>110&&(t.width=110*t.width/t.height,t.height=110)}),r.x=1,ItemConstants.INF_STAMINA_IDS.indexOf(o)>=0){var l=new egret.Bitmap;xyd.setBitmapAsync(l,"icon_infinity",function(){l.anchorOffsetX=l.width/2,l.anchorOffsetY=.8*l.height}),l.x=62,l.y=57,s.addChild(l)}var _=new eui.Label;return s.addChild(_),_.textFlow=[{text:"x"+t,style:{textColor:16777215,bold:!0,size:40,fontFamily:"Microsoft YaHei",stroke:2,strokeColor:12078916}}],_.filters=[new egret.DropShadowFilter(4,90,12078916)],_.x=s.width-_.textWidth,_.y=70,s},t}(egret.DisplayObjectContainer);__reflect(StageGiftBox.prototype,"StageGiftBox");var StageRankListItemRender=function(e){function t(){var t=e.call(this)||this;return t._labelNums=[],t.skinName="resource/skins/StageRankListItemSkin.exml",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this;this.data.isMe&&(this.data.can_send_stamina=!1),this.targetImg_.touchEnabled=!1,xyd.setDarkenBtnBehavior(this.targetImg_,this,this.onBtn),this.data.can_send_stamina?(this.targetImg_.touchEnabled=!0,this.targetImg_.source="icon_songtili_png"):this.targetImg_.source="icon_songtilihui_png";var t=this.nameLabel_.height;if(this.nameLabel_.text=this.data.nickname,this.nameLabel_.height>t){var i=Math.floor(this.nameLabel_.text.length/2);i>5&&(i=5),this.nameLabel_.text=this.nameLabel_.text.slice(0,i)+"..."}""==this.data.avatar&&(this.data.avatar="bg_jiazaitouxiang_png"),this.uid_=this.data.uin,xyd.setUISpriteAsync(this.avatarImg_,"bg_jiazaitouxiang",function(){xyd.setUISpriteByUrl(e.avatarImg_,e.data.avatar)}),this.avatarImg_.mask=this.maskImg_;var n="non_p_",o="non_p_",a=.32,s=.9;if(this.data.isMe?(this.bg_.source="bg_neiban_4_png",this.img_txt_bg_.source="rank_bg_text_2_png",this.nameLabel_.textColor=1398151,this.targetImg_.visible=!1,n="non_s_",o="non_t_",a=1,s=1,this.starLabelX_.source="non_t_x_png"):(this.bg_.source="bg_neiban_3_png",this.img_txt_bg_.source="rank_bg_text_1_png",this.nameLabel_.textColor=9590074,this.targetImg_.visible=!0,n="non_p_",a=1,this.starLabelX_.source="non_p_x_png"),this.stageLabelCont_.text=this.data.level.toString(),void 0==this.starLabelPic?(this.starLabelPic=xyd.bitmapNumber.createNumPic(this.data.stars,o),this.starLabelCont_.addChild(this.starLabelPic),this._labelNums.push(this.starLabelPic)):xyd.bitmapNumber.changeNum(this.starLabelPic,this.data.stars,o),this.starLabelPic.scaleX=s,this.starLabelPic.scaleY=s,xyd.bitmapNumber.setNumGap(this.starLabelPic,-5),this.starLabelPic.x=0,this.starLabelPic.y=(this.starLabelCont_.height-xyd.bitmapNumber.getHeight(this.starLabelPic))/2,void 0!=this.rankLabelPic&&(this.rankLabelPic.visible=!1),1==this.data.rank)this.listImg_.visible=!0,this.listImg_.source="stage_rank_1_png";else if(2==this.data.rank)this.listImg_.visible=!0,this.listImg_.source="stage_rank_2_png";else if(3==this.data.rank)this.listImg_.visible=!0,this.listImg_.source="stage_rank_3_png";else{this.listImg_.visible=!1,void 0==this.rankLabelPic?(this.rankLabelPic=xyd.bitmapNumber.createNumPic(this.data.rank,n),this.rank_group_.addChild(this.rankLabelPic),this._labelNums.push(this.rankLabelPic)):xyd.bitmapNumber.changeNum(this.rankLabelPic,this.data.rank,n),this.rankLabelPic.scaleX=a,this.rankLabelPic.scaleY=a,xyd.bitmapNumber.setNumGap(this.rankLabelPic,-5);var r=xyd.bitmapNumber.getWidth(this.rankLabelPic),l=xyd.bitmapNumber.getHeight(this.rankLabelPic);this.rankLabelPic.x=.5*(this.rank_group_.width-r),this.rankLabelPic.y=.5*(this.rank_group_.height-l),this.rankLabelPic.visible=!0}},t.prototype.onBtn=function(){platform.callMethod("LEADERBOARD_SEND_STAMINA",{uin_list:[this.uid_]})["catch"](function(e){logger.error(e)}),this.targetImg_.touchEnabled=!1,this.data.can_send_stamina=!1,this.targetImg_.source="icon_songtilihui_png",Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_LEADERBOARD_MAIN_SEND_BTN)},t.prototype.dispose=function(){for(var e=0,t=this._labelNums;e<t.length;e++){var i=t[e];i.parent&&(i.parent.removeChild(i),xyd.bitmapNumber.destroyNumPic(i))}},t}(eui.ItemRenderer);__reflect(StageRankListItemRender.prototype,"StageRankListItemRender");var TargetListItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/TargetListItemSkin.exml",t}return __extends(t,e),t.prototype.dataChanged=function(){this.nameLabel_.text=this.data.nickname,this.rankLabel_.text=this.data.rank,""==this.data.avatar&&(this.data.avatar="bg_jiazaitouxiang_png"),this.avatarImg_.source=this.data.avatar,this.avatarImg_.mask=this.maskImg_,this.gatheredLabel_.text=this.data.gathered_num,this.data.isMe?(this.bg_.source="bg_paihangban2_png",this.rankLabel_.textColor=12139038,this.nameLabel_.textColor=10559760,this.gatheredLabel_.textColor=12139038):(this.bg_.source="bg_paihangban1_png",this.rankLabel_.textColor=10707478,this.nameLabel_.textColor=9136716,this.gatheredLabel_.textColor=10707478),1==this.data.rank?(this.rankLabel_.visible=!1,this.listImg_.visible=!0,this.listImg_.source="icon_diyi_png"):2==this.data.rank?(this.rankLabel_.visible=!1,this.listImg_.visible=!0,this.listImg_.source="icon_dier_png"):3==this.data.rank?(this.rankLabel_.visible=!1,this.listImg_.visible=!0,this.listImg_.source="icon_disan_png"):(this.listImg_.visible=!1,this.rankLabel_.visible=!0)},t.prototype.dispose=function(){},t}(eui.ItemRenderer);__reflect(TargetListItemRenderer.prototype,"TargetListItemRenderer");var WheelButton=function(e){function t(t,i,n){var o=e.call(this)||this;return o.BTN_WHEEL_WIDTH_HALF=121,o.BTN_WHEEL_HEIGHT_HALF=120,o.settedPressFunc_=!1,o.BTN_WIDTH_HALF=57,o.BTN_HEIGHT_HALF=47,o.SMALL_PACKET_WIDTH=166,o.SMALL_PACKET_HEIGHT=181,o.BIG_PACKET_WIDTH=205,o.BIG_PACKET_HEIGHT=225,o.hasTween_=!1,o.img_=new egret.Bitmap,o.width=2*o.BTN_WHEEL_WIDTH_HALF,o.height=2*o.BTN_WHEEL_HEIGHT_HALF,o.anchorOffsetX=o.BTN_WHEEL_WIDTH_HALF,o.anchorOffsetY=o.BTN_WHEEL_HEIGHT_HALF,o.x=t,o.y=i,o.win_=n,o.touchEnabled=!0,o.img_.touchEnabled=!1,o.addChild(o.img_),o}return __extends(t,e),t.prototype.setIconData=function(e,t,i,n,o){this.name="Wheel"+i,this.x=e,this.y=t,this.type_=n,this.level_=i,this.state_=o,this.drawWheelImg()},Object.defineProperty(t.prototype,"img",{get:function(){return this.img_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.level_},enumerable:!0,configurable:!0}),t.prototype.drawRedpacketImg=function(){var e=this;switch(this.hasTween_&&(this.tw_.stop(),this.tw_.kill(),this.hasTween_=!1,this.packetImg_.rotation=0),this.packetImg_||(this.width=2*this.BTN_WIDTH_HALF,this.height=2*this.BTN_HEIGHT_HALF,this.anchorOffsetX=this.BTN_WIDTH_HALF,this.anchorOffsetY=this.BTN_HEIGHT_HALF,this.packetImg_=new egret.Bitmap,this.packetImg_.touchEnabled=!1,this.addChild(this.packetImg_)),this.openImg_||(this.openImg_=new egret.Bitmap,this.openImg_.touchEnabled=!1,this.openImg_.x=-25,this.openImg_.y=90,this.openImg_.touchEnabled=!1,xyd.setBitmapAsync(this.openImg_,"icon_kekaiqi",function(){}),this.addChild(this.openImg_)),this.openLabel_||(this.openLabel_=new eui.Label,this.openLabel_.textAlign="center",this.openLabel_.text="",this.openLabel_.width=200,this.openLabel_.anchorOffsetX=100,this.openLabel_.x=this.BTN_WIDTH_HALF,this.openLabel_.y=80,this.openLabel_.size=36,this.openLabel_.textColor=16777215,this.openLabel_.bold=!0,this.openLabel_.touchEnabled=!1,this.addChild(this.openLabel_)),this.type_){case 0:case 1:case 2:this.img_.visible=!1,this.packetImg_.visible=!0}switch(this.type_){case 0:case 1:0==this.state_?(xyd.setBitmapAsync(this.packetImg_,"icon_weikaiqixiao",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.SMALL_PACKET_WIDTH,e.packetImg_.height=e.SMALL_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.openLabel_.visible=!1,this.openImg_.visible=!1):1==this.state_?(xyd.setBitmapAsync(this.packetImg_,"icon_hongbao",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.SMALL_PACKET_WIDTH,e.packetImg_.height=e.SMALL_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.addOpenTween(this.packetImg_),this.openLabel_.visible=!1,this.openImg_.visible=!0):2==this.state_&&(xyd.setBitmapAsync(this.packetImg_,"icon_hongbaodakai",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.SMALL_PACKET_WIDTH,e.packetImg_.height=1.2*e.SMALL_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.openLabel_.visible=!1,this.img_.visible=!1,this.openImg_.visible=!1);break;case 2:this.packetImg_.visible=!0,0==this.state_?(xyd.setBitmapAsync(this.packetImg_,"icon_weikaiqida",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.BIG_PACKET_WIDTH,e.packetImg_.height=e.BIG_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.openLabel_.visible=!1,this.openImg_.visible=!1):1==this.state_?(xyd.setBitmapAsync(this.packetImg_,"icon_huangbao",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.BIG_PACKET_WIDTH,e.packetImg_.height=e.BIG_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.addOpenTween(this.packetImg_),this.openLabel_.visible=!1,this.openImg_.visible=!0):2==this.state_&&(xyd.setBitmapAsync(this.packetImg_,"icon_huangbaodakai",function(){e.packetImg_.scaleX=1,e.packetImg_.scaleY=1,e.packetImg_.width=e.SMALL_PACKET_WIDTH,e.packetImg_.height=1.2*e.SMALL_PACKET_HEIGHT,e.packetImg_.x=e.BTN_WIDTH_HALF,e.packetImg_.y=e.BTN_HEIGHT_HALF,e.packetImg_.anchorOffsetX=e.packetImg_.width/2,e.packetImg_.anchorOffsetY=e.packetImg_.height/2}),this.openLabel_.visible=!1,this.img_.visible=!1,this.openImg_.visible=!1)}this.win_&&(this.settedPressFunc_||(xyd.setDarkenBtnBehavior(this,this,function(){if(0!=e.win_.canClick()&&e.level_)if(e.level_>xyd.MAX_STAGE)xyd.WindowManager.get().openWindow("commingsoon_window");else{if(1!=e.state_)return;xyd.WindowManager.get().openWindow("open_map_packet_window",{stageMap:e.win_,level:e.level_,levelBtn:e,hideEnterBtn:!0})}}),this.settedPressFunc_=!0))},t.prototype.addOpenTween=function(e){if(!this.hasTween_){var t=new TimelineMax;t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:-10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:-15})),t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:15})),t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:-10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:0})),t.add(TweenMax.to(e,120*xyd.TweenDeltaTime,{})),t.repeat(-1),t.play(),this.win_.getUsingTween().push(t),this.hasTween_=!0,this.tw_=t}},t.prototype.drawWheelImg=function(){var e=this;switch(this.state_){case 0:xyd.setBitmapAsync(this.img_,"icon_zhuanpansuo",function(){e.img_.anchorOffsetX=e.BTN_WIDTH_HALF,e.img_.anchorOffsetY=e.BTN_HEIGHT_HALF,e.img_.x=e.BTN_WIDTH_HALF,e.img_.y=e.BTN_HEIGHT_HALF});break;case 1:xyd.setBitmapAsync(this.img_,"icon_zhuanpan",function(){e.img_.anchorOffsetX=e.BTN_WIDTH_HALF,e.img_.anchorOffsetY=e.BTN_HEIGHT_HALF,e.img_.x=e.BTN_WIDTH_HALF,e.img_.y=e.BTN_HEIGHT_HALF});break;case 2:xyd.setBitmapAsync(this.img_,"icon_zhuanpanhui",function(){e.img_.anchorOffsetX=e.BTN_WIDTH_HALF,e.img_.anchorOffsetY=e.BTN_HEIGHT_HALF,e.img_.x=e.BTN_WIDTH_HALF,e.img_.y=e.BTN_HEIGHT_HALF})}this.win_&&(this.settedPressFunc_||(xyd.setDarkenBtnBehavior(this,this,function(){0!=e.win_.canClick()&&e.level_&&(e.level_>xyd.MAX_STAGE?xyd.WindowManager.get().openWindow("commingsoon_window"):e.win_.openIcon(e.level_))}),this.settedPressFunc_=!0))},Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.state_},enumerable:!0,configurable:!0}),t}(eui.Group);__reflect(WheelButton.prototype,"WheelButton");var Logger=function(){function e(){}return e.get=function(){return null==e.INSTANCE&&(e.INSTANCE=new e),e.INSTANCE},e.prototype.error=function(e,t){void 0===t&&(t=!1),void 0!=e&&(platform.inDebugMode()&&console.log(e),platform.callMethod("LOG_ERROR",e)["catch"](function(){}))},e.prototype.errorStr=function(e){e&&""!=e&&this.error({error_message:e})},e.prototype.logStep=function(e){e&&""!=e&&(platform.inDebugMode()&&console.log(e),this.log({op:"error",event:"hms_game_steps",message:e}))
},e.prototype.logGuideLoss=function(e,t){platform.inDebugMode()&&console.log("Log guide loss "+e+", "+t),this.log({op:"event",sub_op:"guide_loss",type:e,value:t})},e.prototype.logOp=function(e,t,i,n){void 0===n&&(n=!1);var o={op:e,page_sn:LoggerConst.PAGE_SN_GAME,page_el_sn:t};if(i)for(var a in i)o[a]=i[a];n&&(o.stage_id=[SelfInfo.get().getUid(),SelfInfo.get().getTime(),1e4+Math.ceil(9999*Math.random())].join("_")),this.log(o)},e.prototype.log=function(e){platform.callMethod("LOGGER",e)["catch"](function(e){return console.log(e)})},e.INSTANCE=null,e}();__reflect(Logger.prototype,"Logger");var BtnCtrl=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.params_=i,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent()},t.prototype.initUIComponent=function(){},t}(BaseWindow);__reflect(BtnCtrl.prototype,"BtnCtrl");var ClearStreakRewardWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._display=[],n._bagX=xyd.getWidth()-200,n._bagY=xyd.getHeight()/2+500,n._animationCenterX=xyd.getWidth()/2,n._animationCenterY=xyd.getHeight()/2+200,n._distance=600,n._displayTargetLabel=[],n._twAnimtions=[],n._rewardItems=[{1001:1},{1001:1,1006:1},{1001:1,1006:1,1016:1},{1001:1,1006:2,1016:1},{1001:2,1006:2,1016:1}],n.skinName="resource/skins/ClearStreakRewardWindowSkin.exml",n._params=i,i&&i.onComplete&&(n._callBack=i.onComplete),n._rewardLevel=SelfInfo.get().getClearStreak()||0,n._rewardLevel>5&&(n._rewardLevel=5),n._rewardLevel>0&&(n._items=n._rewardItems[n._rewardLevel-1]),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent()},t.prototype.initUIComponent=function(){this._rewardLevel<=0&&xyd.WindowManager.get().closeWindow(this),DisplayConstants.get();var e=function(e){var i=t._items[e],n=DisplayConstants.ItemSourceMap[e];if(!n||0>=i)return"continue";var o=new egret.Bitmap;xyd.setBitmapAsync(o,n,function(){o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,"icon_tili"==n&&(o.scaleX=.5,o.scaleY=.5)});var a=new egret.DisplayObjectContainer;a.x=t._animationCenterX,a.y=t._animationCenterY,a.addChild(o),a.visible=!1;var s=Number(e),r=0;if(1012==s?r=30:1014==s?r=1:1015==s?r=2:s>1999&&3e3>s&&(r=2),r>0){var l=new egret.Bitmap;xyd.setBitmapAsync(l,"icon_time_limit",function(){l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2}),l.x=60,l.y=40,a.addChild(l);var _=xyd.bitmapNumber.createNumPic(r,"non_d_");_.x=l.x-30,_.y=l.y-22,_.scaleX=.76,_.scaleY=.76;var h="";30==r?(_.x=l.x-50,h="text_m"):h="text_h",t._displayTargetLabel.push(_),a.addChild(_);var c=new egret.Bitmap;xyd.setBitmapAsync(c,h,function(){c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height/2}),c.x=l.x+25,c.y=l.y-2,a.addChild(c)}else{var d=xyd.bitmapNumber.createNumPic(i,"non_b_");d.scaleX=.6,d.scaleY=.6,d.x=0,1>=i?d.visible=!1:10>i?d.x=25:d.x=15,d.y=10,t._displayTargetLabel.push(d),a.addChild(d)}t.addChild(a),t._display.push(a)},t=this;for(var i in this._items)e(i);this.itemAnimation();this.ok_btn.visible=!1,this.skip_btn.visible=!0,this.ok_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OKBtnClick,this),this.skip_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skipBtnClick,this),this._imgDes=new eui.Image,this._imgDes.source="text_lianshengjiangli_png",this._imgDes.top=this.ok_btn.bottom-150,this._imgDes.horizontalCenter=0,this._imgDes.visible=!1,this.addChild(this._imgDes)},t.prototype.OKBtnClick=function(){this.ok_btn.visible=!1,this.step2()},t.prototype.skipBtnClick=function(){SoundManager.getInstance().playEffect("se_special_gain_2_mp3"),this.skip_btn.visible=!1;for(var e=0,t=this._twAnimtions;e<t.length;e++){var i=t[e];i.stop(),i.kill()}this._tw.kill(),this._eff&&this._eff.animation.play("texiao02",-1),this.ok_btn.visible=!0,this._imgDes.visible=!0;for(var n=20/180*Math.PI,o=0;o<this._display.length;o++){this._display[o].visible=!0,this._display[o].scaleX=1,this._display[o].scaleY=1;var i=new TimelineMax,a=-((this._display.length-1)/2)*n+o*n+Math.PI,s=Math.sin(a)*this._distance,r=Math.cos(a)*this._distance;this._display[o].x=this._animationCenterX+s,this._display[o].y=this._animationCenterY+r,i.add(TweenLite.to(this._display[o],10*xyd.TweenDeltaTime,{x:this._animationCenterX+s,y:this._animationCenterY+r+5})),i.add(TweenLite.to(this._display[o],10*xyd.TweenDeltaTime,{x:this._animationCenterX+s,y:this._animationCenterY+r})),i.repeat(-1),this._twAnimtions.push(i)}},t.prototype.itemAnimation=function(){var e=this;SoundManager.getInstance().playEffect("se_special_gain_1_mp3");var t=0;for(var i in this._items)t++;1==t&&(this._distance=500),EffectFactory.get().newEffect("chicken_reward",function(e){if(this.isDisposed_)return void EffectFactory.get().pushBackEffect(this._eff);this._eff=e,this._eff.x=this._animationCenterX,this._eff.y=this._animationCenterY,this.addChildAt(e,1),this._eff.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),this._eff.animation.play("texiao02",-1)};e.addDBEventListener("complete",t,this)}.bind(this)),this._tw=new TimelineLite,this._tw.add(TweenLite.to(this,60*xyd.TweenDeltaTime,{})),this._tw.call(function(){e.step1()})},t.prototype.step1=function(){var e=this;SoundManager.getInstance().playEffectDelay("se_special_gain_2_mp3",300),this.skip_btn.visible=!0;for(var t=20/180*Math.PI,i=function(i){n._display[i].visible=!0,n._display[i].scaleX=.5,n._display[i].scaleY=.5;var o=new TimelineLite,a=new TimelineMax,s=-((n._display.length-1)/2)*t+i*t+Math.PI,r=Math.sin(s)*n._distance,l=Math.cos(s)*n._distance;o.add(TweenLite.to(n._display[i],10*xyd.TweenDeltaTime,{x:n._animationCenterX+r,y:n._animationCenterY+l,scaleX:1,scaleY:1})),o.call(function(){e.ok_btn.visible=!0,e._imgDes.visible=!0,a.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l+5,scaleX:1,scaleY:1})),a.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l,scaleX:1,scaleY:1})),a.repeat(-1),e._twAnimtions.push(a)})},n=this,o=0;o<this._display.length;o++)i(o)},t.prototype.step2=function(){for(var e=this,t=0,i=this._twAnimtions;t<i.length;t++){var n=i[t];n.stop(),n.kill()}this.skip_btn.visible=!1,this._tw=new TimelineLite;for(var o=function(t){a._display[t].visible=!0;var i=new TimelineLite;i.add(TweenLite.to(a._display[t],3*t*xyd.TweenDeltaTime,{})),i.add(TweenLite.to(a._display[t],10*xyd.TweenDeltaTime,{scaleY:0,scaleX:0})),i.call(function(){e._display[t].visible=!1}),t==a._display.length-1&&i.call(function(){e.step3()})},a=this,s=0;s<this._display.length;s++)o(s);if(this._eff){this._eff.animation.play("texiao03",1);var r=function(e){this._eff.removeDBEventListener("complete",r,this),this._eff.visible=!1};this._eff.addDBEventListener("complete",r,this)}},t.prototype.step3=function(){this._callBack&&this._callBack(),xyd.WindowManager.get().closeWindow(this)},t.prototype.dispose=function(){this._eff&&(this._eff.animation.stop(),this._eff.parent&&this._eff.parent.removeChild(this._eff),this._eff.dispose());for(var t=0,i=this._displayTargetLabel;t<i.length;t++){var n=i[t];n&&xyd.bitmapNumber.destroyNumPic(n)}e.prototype.dispose.call(this)},t.prototype.willClose=function(){this._callBack=void 0},t}(BaseWindow);__reflect(ClearStreakRewardWindow.prototype,"ClearStreakRewardWindow");var ClearStreakWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._rewardLevel=0,n._rewardImages=["ele_color_bomb_png","icon_teshuqizi_png","icon_add3_png","icon_teshuqizi_png","ele_color_bomb_png"],n._rewardPos={1:{1:{x:450,y:200}},2:{1:{x:300,y:200},2:{x:600,y:200}},3:{1:{x:150,y:200},2:{x:450,y:130},3:{x:770,y:200}},4:{1:{x:150,y:200},2:{x:450,y:130},3:{x:770,y:200},4:{x:450,y:350}},5:{1:{x:150,y:200},2:{x:450,y:130},3:{x:770,y:200},4:{x:330,y:300},5:{x:570,y:310}}},i&&i.onComplete&&(n._callBack=i.onComplete),n.skinName="resource/skins/ClearStreakWindowSkin.exml",n._rewardLevel=SelfInfo.get().getClearStreak()||0,n}return __extends(t,e),t.prototype.childrenCreated=function(){this.playOpenAnimation(),this.initUIComponent()},t.prototype.initUIComponent=function(){this.next_reward_status.visible=!1,this.huangguan_image.visible=!1,this.max_level_text_group.visible=!0,this.text_group.visible=!1,this.no_reward_group.visible=!1,this.reward_group.visible=!0;var e=5;this._showNextReward(e),xyd.setDarkenBtnBehavior(this.start_btn,this,this._onStartBtnClick),xyd.setDarkenBtnBehavior(this.group_close,this,this._onStartBtnClick)},t.prototype.playOpenAnimation=function(){var e=(xyd.getHeight()-1920)/2;this.main_group.y=-1370+e;var t=new TimelineLite;t.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:e}),0),t.add(TweenLite.to(this.main_group,3*xyd.TweenDeltaTime,{y:86+e}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:e}),7*xyd.TweenDeltaTime)},t.prototype._getNextRewardImage=function(e){return e>this._rewardImages.length&&(e=this._rewardImages.length),this._rewardImages[e]},t.prototype._onStartBtnClick=function(){this._disableTouch(),this._callBack&&this._callBack(),xyd.WindowManager.get().closeWindow(this)},t.prototype._disableTouch=function(){this.start_btn.touchEnabled=!1},t.prototype._showNextReward=function(e){for(var t=1;e>=t;t++){var i=this._createOneReward(t-1);i.x=this._rewardPos[e][t].x,i.y=this._rewardPos[e][t].y,this.reward_group.addChild(i)}},t.prototype._createOneReward=function(e){var t=197,i=118,n=124,o=new eui.Group,a=new eui.Image,s=new eui.Image;s.source="paopao4_png",s.anchorOffsetX=t/2,s.anchorOffsetY=t/2,s.x=t/2,s.y=t/2,s.scaleX=.5,s.scaleY=.5,o.width=t,o.height=t,o.addChild(s);var r=this._getNextRewardImage(e);return a.source=r,a.anchorOffsetX=i/2,a.anchorOffsetY=n/2,a.x=t/2,a.y=t/2,o.anchorOffsetX=t/2,o.anchorOffsetY=t/2,o.addChild(a),o},t.prototype.willClose=function(){this._callBack=void 0},t}(BaseWindow);__reflect(ClearStreakWindow.prototype,"ClearStreakWindow");var CommingSoonWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.skinName="resource/skins/CommingSoonWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.skip_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t.prototype.initUIComponent=function(){EffectFactory.get().newEffect("comingsoon",function(e){return this.isDisposed_?void e.dispose():(e.scaleX=e.scaleY=1.2,this._eff=e,this.effect_gp.addChild(e),void this._eff.animation.play("texiao01",1))}.bind(this))},t.prototype.close=function(){xyd.WindowManager.get().closeWindow(this)},t.prototype.dispose=function(){this._eff&&this._eff.dispose(),e.prototype.dispose.call(this)},t}(BaseWindow);__reflect(CommingSoonWindow.prototype,"CommingSoonWindow");var CookingWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.KEDU_INTERVAL=42,n.MAX_LEVEL=20,n.isRewardedLevel=[],n.ITEM_INTERVAL=200,n.progress_width=840,n._rewardItems=[],n._rewardNums=[],n._displayTargetLabel=[],n._dayNumLabel=[],n._progressNow=11,n._distance=600,n._twAnimtions=[],n._display=[],n._items={},n._animationCenterX=0,n._animationCenterY=0,n._rewardedStageLevels=[],n._onConfirmCallback=void 0,n._cookingInfo=i.cooking_info,n._progressNow=n._cookingInfo.cooking_level,n._stageLevel=i.totalStageLevel,n._onConfirmCallback=i.onConfirmCallback,n._endTime=n._cookingInfo.end_time,n._rewards=n._cookingInfo.rewards,n.skinName="resource/skins/CookingWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){this.initUIComponent()},t.prototype.initUIComponent=function(){this._initRewardInfo(),this._initRewardDisplay(),this.get_btn.visible=!1,xyd.setDarkenBtnBehavior(this.start_btn,this,this._onStartBtnClick),xyd.setDarkenBtnBehavior(this.get_btn,this,this._onGetBtnClick),this.invisibleTouchLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this._clearShowedRewardGroup,this),this.image_food1.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onFood1,this),this.image_food2.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onFood2,this),this.image_food3.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onFood3,this),this._animationCenterX=0,this._animationCenterY=0;var e=this._endTime-(new Date).getTime()/1e3;e/=86400,this.left_days.text=Math.ceil(e)+"天",this.initProgressBar(this._progressNow),this.progress_bar_group.mask=this.progress_mask,this._initRewardedLevels(),this.chickenMoreMoreAnimation()},t.prototype._clearShowedRewardGroup=function(){for(var e=0,t=this._displayTargetLabel;e<t.length;e++){var i=t[e];i&&xyd.bitmapNumber.destroyNumPic(i)}this._displayTargetLabel=[],this._showRewardGroup&&this._showRewardGroup.parent&&this._showRewardGroup.parent.removeChild(this._showRewardGroup),this._showRewardGroup=void 0},t.prototype._initRewardDisplay=function(){this._rewardsIcons=[this.image_food1,this.image_food2,this.image_food3];for(var e=0;e<this._rewardsIcons.length;e++)this._rewardsIcons[e].visible=!1;for(var t=0,e=1;e<=this.MAX_LEVEL;e++){var i=new eui.Image;if(i.source="kedu_duan_png",this.isRewardedLevel[e]){i.source="kedu_chang_png";var n=void 0;n=xyd.bitmapNumber.createNumPic(e,"non_8_"),n.scaleX=.9,n.scaleY=.9,n.anchorOffsetX=n.width/2,n.x=e*this.KEDU_INTERVAL+this.progress_mask.x,n.y=0,this.progress_group.addChild(n),this._dayNumLabel.push(n);var o=this._rewardsIcons[t];o.visible=!0,o.x=n.x-80,t++}i.x=e*this.KEDU_INTERVAL,i.y=0,this.kedu_group.addChild(i),e==this.MAX_LEVEL&&(i.visible=!1)}},t.prototype._initRewardInfo=function(){this.MAX_LEVEL=0;for(var e=0,t=this._rewards;e<t.length;e++){var i=t[e];this.isRewardedLevel[i.level]=!0;var n=0,o={};this.MAX_LEVEL<i.level&&(this.MAX_LEVEL=i.level);for(var a in i.reward_list){var s=i.reward_list[a],r=a.split("=");if(r&&2==r.length){n++;var l=Number(r[0]),_=Number(r[1]);1==l?(_+=2e3,o[_]=s):o[_]=s}}i.level==this._progressNow&&(this._items=o),this._rewardItems[this._rewardItems.length]=o,this._rewardNums[this._rewardNums.length]=n}this.KEDU_INTERVAL=this.progress_width/this.MAX_LEVEL},t.prototype._initRewardedLevels=function(){for(var e=this._stageLevel-this._progressNow,t=0,i=0;i<=this.MAX_LEVEL;i++)this.isRewardedLevel[i]&&(this._rewardedStageLevels[t]=e+i,t++)},t.prototype.chickenMoreMoreAnimation=function(){this.isRewardedLevel[this._progressNow]?this.chickenMoreMoreRewardAnimation():this.chickenMoreMoreCookAnimation()},t.prototype.chickenMoreMoreRewardAnimation=function(){this.start_btn.visible=!1,this.invisibleTouchLayer.touchEnabled=!1,EffectFactory.get().newEffect("chicken_cook",function(e){if(this.isDisposed_)return void EffectFactory.get().pushBackEffect(e);this._effChickenMoreMore=e,this.chicken_group.addChild(e),this._effChickenMoreMore.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),this._effChickenMoreMore.animation.play("texiao06",0),this.get_btn.visible=!0},i=function(n){var o=this;if(e.removeDBEventListener("complete",i,this),this._showRewardGroup){for(var a=0,s=this._displayTargetLabel;a<s.length;a++){var r=s[a];r&&xyd.bitmapNumber.destroyNumPic(r)}this._displayTargetLabel=[],this._showRewardGroup.parent&&this._showRewardGroup.parent.removeChild(this._showRewardGroup),this._showRewardGroup=void 0}this.image_food1.touchEnabled=!1,this.image_food2.touchEnabled=!1,this.image_food3.touchEnabled=!1;var l=new TimelineLite;l.add(TweenLite.to(this.frame_group,20*xyd.TweenDeltaTime,{alpha:0}),40*xyd.TweenDeltaTime),l.call(function(){o.displayRewardItems()},void 0,void 0,74*xyd.TweenDeltaTime),SoundManager.getInstance().playEffect("se_chef_reward_mp3"),this._effChickenMoreMore.animation.play("texiao05",1),e.addDBEventListener("complete",t,this)};e.addDBEventListener("complete",i,this)}.bind(this))},t.prototype.chickenMoreMoreCookAnimation=function(){var e=xyd.random(2,4),t="texiao0"+e;EffectFactory.get().newEffect("chicken_cook",function(i){if(this.isDisposed_)return void EffectFactory.get().pushBackEffect(i);this._effChickenMoreMore=i,this.chicken_group.addChild(i),i.animation.play(t,1),2==e?SoundManager.getInstance().playEffectDelay("se_chef_salt_mp3",1100):3==e?SoundManager.getInstance().playEffectDelay("se_chef_vegetable_mp3",1e3):SoundManager.getInstance().playEffectDelay("se_chef_sauce_mp3",1500);var n=function(e){i.removeDBEventListener("complete",n,this),i.animation.play("texiao01",0)};i.addDBEventListener("complete",n,this)}.bind(this))},t.prototype.initProgressBar=function(e){EffectFactory.get().newEffect(EffectConstants.COOK_PORGRESS_BAR_MASK,function(t){return this.isDisposed_?void EffectFactory.get().pushBackEffect(t):(this._effMaskProgress=t,t.x=this._progress.width/2,t.y=this._progress.height/2,t.animation.play("texiao01",0),this.progress_bar_group.addChild(t),void this.setProgress(e))}.bind(this))},t.prototype.setProgress=function(e){EffectFactory.get().newEffect(EffectConstants.COOK_PROGRESS_BAR,function(t){if(this.isDisposed_)return void EffectFactory.get().pushBackEffect(t);var i=Math.min(1,(e-1)/this.MAX_LEVEL),n=Math.min(1,e/this.MAX_LEVEL);this._effProgress=t,this.progress_group.addChild(t),t.y=this.progress_mask.y+.5*this.progress_mask.height,t.x=this.progress_width*i+this.progress_mask.x,t.animation.play("texiao01",0),this.progress_mask.width=this.progress_width*i;var o=new TimelineLite;o.add(TweenLite.to(this.progress_mask,30*xyd.TweenDeltaTime,{width:this.progress_width*n}),20*xyd.TweenDeltaTime),o.add(TweenLite.to(this._effProgress,30*xyd.TweenDeltaTime,{x:this.progress_width*n+this.progress_mask.x}),20*xyd.TweenDeltaTime),o.add(TweenLite.to(this._effProgress,10*xyd.TweenDeltaTime,{alpha:0}),50*xyd.TweenDeltaTime)}.bind(this))},t.prototype.showCookingReward=function(e){this._clearShowedRewardGroup(),e-=1;var t=this._rewardItems[e],i=new egret.DisplayObjectContainer;this._showRewardGroup=i,this.main_group.addChild(i),i.width=xyd.getWidth(),i.height=xyd.getHeight(),DisplayConstants.get();var n=0,o=new eui.Image;o.source="bg_xinxi_png",o.scale9Grid=new egret.Rectangle(70,65,1,1),o.width=this._rewardNums[e]*this.ITEM_INTERVAL+150,o.height=250;var a=new eui.Image;a.source="jiantou_png",a.x=this._basicPosX+20,a.y=this._basicPosY+15,a.rotation=90,o.x=(this.main_group.width-o.width)/2,o.y=this._basicPosY-o.height+35,this._basicPosX<o.x+100?o.x=this._basicPosX-100:this._basicPosX>o.x+o.width-100&&(o.x=this._basicPosX+100-o.width);var s=o.x-50;i.addChild(o),i.addChild(a);var r=this._rewardedStageLevels[e],l=new eui.Label;l.size=43,l.textColor=9064502,l.text="通过第"+r+"关即可获得",l.anchorOffsetX=l.width/2,l.textAlign="center",l.fontFamily="Microsoft YaHei",l.horizontalCenter=0,l.x=o.x+o.width/2,l.y=o.y+175,i.addChild(l);for(var _ in t){var h=t[_],c=DisplayConstants.ItemSourceMap[_];if(c&&!(0>=h)){n++;var d=this._getItemGroup(_,h,0);d.x=n*this.ITEM_INTERVAL+s,d.y=this._basicPosY-125,i.addChild(d)}}},t.prototype._getItemGroup=function(e,t,i){var n=[["non_p_","non_p_","text_m_shengse","text_h_shengse"],["non_d_","non_b_","text_m","text_h"]],o=n[i],a=[[.9,.9],[.76,.6]],s=a[i],r=DisplayConstants.ItemSourceMap[e],l=new egret.Bitmap;xyd.setBitmapAsync(l,r,function(){l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,"icon_tili"==r&&(l.scaleX=.5,l.scaleY=.5)});var _=new egret.DisplayObjectContainer;_.addChild(l);var h=Number(e),c=!1,d=0;if(1012==h?(d=30,c=!0):1014==h?(d=1,c=!0):1015==h?(d=2,c=!0):h>1999&&3e3>h&&(d=2),d>0){if(1==i){var p=new egret.Bitmap;xyd.setBitmapAsync(p,"icon_time_limit",function(){p.anchorOffsetX=p.width/2,p.anchorOffsetY=p.height/2}),p.x=60,p.y=40,_.addChild(p)}var u=xyd.bitmapNumber.createNumPic(d,o[0]);u.x=30,u.y=18,u.scaleX=s[0],u.scaleY=s[0];var m="";30==d?(u.x=10,m=o[2]):m=o[3],this._displayTargetLabel.push(u),_.addChild(u);var g=new egret.Bitmap;xyd.setBitmapAsync(g,m,function(){g.anchorOffsetX=0,g.anchorOffsetY=g.height}),g.x=75,g.y=18+u.height*s[0],_.addChild(g)}else{var f=xyd.bitmapNumber.createNumPic(t,o[1]);f.scaleX=s[1],f.scaleY=s[1],f.x=0,1>=t?f.visible=!1:10>t?f.x=50:f.x=40,f.y=18,this._displayTargetLabel.push(f),_.addChild(f)}if(c){var y=new egret.Bitmap;xyd.setBitmapAsync(y,"icon_infinity",function(){y.anchorOffsetX=y.width/2,y.anchorOffsetY=.8*y.height}),y.x=0,y.y=0,_.addChild(y)}return _},t.prototype.initDisplayedItems=function(){DisplayConstants.get();for(var e in this._items){var t=this._items[e],i=DisplayConstants.ItemSourceMap[e];if(i&&!(0>=t)){var n=this._getItemGroup(e,t,1);n.visible=!1,n.x=this._animationCenterX,n.y=this._animationCenterY,this.chicken_group.addChild(n),this._display.push(n)}}},t.prototype.displayRewardItems=function(){var e=this;this.initDisplayedItems();var t=25/180*Math.PI,i=0;for(var n in this._items)i++;this._distance=500;for(var o=function(i){a._display[i].visible=!0,a._display[i].scaleX=.5,a._display[i].scaleY=.5;var n=new TimelineLite,o=new TimelineMax,s=-((a._display.length-1)/2)*t+i*t+Math.PI,r=Math.sin(s)*a._distance,l=Math.cos(s)*a._distance;n.add(TweenLite.to(a._display[i],10*xyd.TweenDeltaTime,{x:a._animationCenterX+r,y:a._animationCenterY+l,scaleX:1,scaleY:1})),n.call(function(){o.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l+5,scaleX:1,scaleY:1})),o.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l,scaleX:1,scaleY:1})),o.repeat(-1),e._twAnimtions.push(o)})},a=this,s=0;s<this._display.length;s++)o(s)},t.prototype._onFood1=function(){this._basicPosX=this.image_food1.x+this.image_food1.width/2,this._basicPosY=this.image_food1.y-this.image_food1.height/2,this.showCookingReward(1)},t.prototype._onFood2=function(){this._basicPosX=this.image_food2.x+this.image_food2.width/2,this._basicPosY=this.image_food2.y-this.image_food2.height/2,this.showCookingReward(2)},t.prototype._onFood3=function(){this._basicPosX=this.image_food3.x+this.image_food3.width/2,this._basicPosY=this.image_food3.y-this.image_food3.height/2,this.showCookingReward(3)},t.prototype.playOpenAnimation=function(){var e=xyd.getHeight()/1920,t=(xyd.getHeight()-1920)/2;e>.75?e=1:t=0,this.main_group.scaleX=e,this.main_group.scaleY=e,this.main_group.y=-1370+t;var i=new TimelineLite;i.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:t}),0),i.add(TweenLite.to(this.main_group,3*xyd.TweenDeltaTime,{y:86+t}),4*xyd.TweenDeltaTime),i.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:t}),7*xyd.TweenDeltaTime)},t.prototype._onGetBtnClick=function(){this._disableTouch();for(var e=0,t=this._twAnimtions;e<t.length;e++){var i=t[e];i.stop(),i.kill()}for(var n=0;n<this._display.length;n++){var i=new TimelineLite;i.add(TweenLite.to(this._display[n],10*xyd.TweenDeltaTime,{x:this._animationCenterX,y:this._animationCenterY,alpha:0}))}egret.setTimeout(this._onGetBtnClickStep2,this,1e4*xyd.TweenDeltaTime)},t.prototype._onGetBtnClickStep2=function(){if(this._effChickenMoreMore){this._effChickenMoreMore.animation.play("texiao07",1);var e=function(t){this._effChickenMoreMore.removeDBEventListener("complete",e,this),xyd.WindowManager.get().closeWindow(this)};this._effChickenMoreMore.addDBEventListener("complete",e,this)}else xyd.WindowManager.get().closeWindow(this)},t.prototype._onStartBtnClick=function(){this._disableTouch(),xyd.WindowManager.get().closeWindow(this)},t.prototype._disableTouch=function(){this.start_btn.touchEnabled=!1,this.get_btn.touchEnabled=!1},t.prototype.willClose=function(){for(var e=0,t=this._dayNumLabel;e<t.length;e++){var i=t[e];i&&xyd.bitmapNumber.destroyNumPic(i)}for(var n=0,o=this._displayTargetLabel;n<o.length;n++){var i=o[n];i&&xyd.bitmapNumber.destroyNumPic(i)}this._effChickenMoreMore&&(this._effChickenMoreMore.animation.stop(),this.chicken_group.removeChild(this._effChickenMoreMore),this._effChickenMoreMore.dispose()),this._effProgress&&(this._effProgress.animation.stop(),this._effProgress.parent&&this._effProgress.parent.removeChild(this._effProgress),this._effProgress.dispose()),this._effMaskProgress&&(this._effMaskProgress.animation.stop(),this._effMaskProgress.parent&&this._effMaskProgress.parent.removeChild(this._effMaskProgress),this._effMaskProgress.dispose()),this._onConfirmCallback&&this._onConfirmCallback()},t}(BaseWindow);__reflect(CookingWindow.prototype,"CookingWindow");var DirectlyEnterGameTipsWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._engineCallback=i.engineCallback,n.skinName="resource/skins/DirectlyEnterGameTipsWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){this.playOpenAnimation(),this.initUIComponent()},t.prototype.initUIComponent=function(){var e=SelfInfo.get().getCurrentLevel(),t=LevelTable.get(),i=t.getNextWheelStage(e),n=i-e+1;n>0&&(this._desc.text="再玩"+n+"关就能获得免费抽奖啦~"),xyd.setDarkenBtnBehavior(this.group_btn_start,this,this._onStartBtnClick),xyd.setDarkenBtnBehavior(this.group_close,this,this._onStartBtnClick)},t.prototype.playOpenAnimation=function(){this.main_group.scaleX=.5,this.main_group.scaleY=.5,this.main_group.alpha=.5;var e=new TimelineLite;e.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{scaleX:.97,scaleY:.97,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),e.add(TweenLite.to(this.main_group,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime)},t.prototype._onStartBtnClick=function(){var e=this,t=new TimelineLite;this.main_group.scaleX=1,this.main_group.scaleY=1,t.add(TweenLite.to(this.main_group,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.main_group,5*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),t.add(TweenLite.to(this.main_group,5*xyd.TweenDeltaTime,{scaleX:.5,scaleY:.5,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),t.call(function(){xyd.WindowManager.get().closeWindow(e)})},t.prototype.didClose=function(){this._engineCallback&&this._engineCallback();var e=xyd.WindowManager.get().getWindow("game_window");e&&e.setCanTouch(!0)},t}(BaseWindow);__reflect(DirectlyEnterGameTipsWindow.prototype,"DirectlyEnterGameTipsWindow");var EndGameWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingTimelines=[],n._needPopup=!1,n._needPopupClearStreak=!1,n._needPopupPacket=!1,n._selfLevel=1,n._canShare=!1,n._shouldChangeShareBtn=!0,n._targetComponents=[],n.skinName="resource/skins/EndGameWindowSkin.exml",n._report=i.report,n._gameEndCallback=i.gameEndCallback,n._gameResumeCallback=i.gameResumeCallback,n._selfLevel=SelfInfo.get().getCurrentLevel(),n}return __extends(t,e),t.prototype.childrenCreated=function(){this.initUIComponent(),this.UIAnimation(),this.initMission(),this.initClearStreakInfo(),this.initPacketInfo()},t.prototype.initMission=function(){var e=MainController.get().getGame();if(e&&e.getEngine()&&e.getEngine().getBoard()){var t=e.getEngine().getBoard().getSpecialDropHandler();t&&t.getCollectedEleNum()>0&&(this.group_mission.visible=!0,this._annaHolder.visible=!1)}},t.prototype.initClearStreakInfo=function(){var e=SelfInfo.get().getClearStreak();if(e>=1){this._needPopupClearStreak=!0;var t=[];t.push({text:xyd.__("ENDGAME_CLEARSTREAK_TIPS1"),style:{textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}}),t.push({text:xyd.__("ENDGAME_CLEARSTREAK_TIPS2"),style:{textColor:15411202,size:42,fontFamily:"Microsoft YaHei"}}),t.push({text:xyd.__("EXCLAMATION_MARK"),style:{textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}}),this._label_desc.textFlow=t;var i=Math.min(5,e);this._icon_reward.source="icon_jiangli"+i+"_png"}this.group_clearstreak.visible=!1},t.prototype.initPacketInfo=function(){var e=this._report.total_level;if(10>=e){this._needPopupPacket=!0;var t=[];if(SelfInfo.get().isFirstTenLevel(e))t.push({text:xyd.__("ENDGAME_PACKET_TIPS"),style:{bold:!0,textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}});else{var i=SelfInfo.get().getNextPayLevel(e);i>0&&ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY)?(t.push({text:xyd.__("ENDGAME_PACKET_TIPS1"),style:{bold:!0,textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}}),t.push({text:i.toString(),style:{bold:!0,textColor:15411202,size:52,fontFamily:"Microsoft YaHei"}}),t.push({text:xyd.__("ENDGAME_PACKET_TIPS2"),style:{bold:!0,textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}})):this._needPopupPacket=!1}this._label_packet.textFlow=t}this._packetInfo.visible=!1},t.prototype.UIAnimation=function(){var e=new TimelineMax;this.group_bg.scaleX=.5,this.group_bg.scaleY=.5,this.group_bg.alpha=.5,this._usingTimelines.push(e),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:.97,scaleY:.97,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),e.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime)},t.prototype.initUIComponent=function(){var e=this;xyd.setDarkenBtnBehavior(this._closeBtn,this,this._onWithdrawBtnClick),xyd.setDarkenBtnBehavior(this._withdrawBtn,this,this._onWithdrawBtnClick),this._report[GameEndInfo.END_REASON]!=GameEndReason.NoPossibleMoves?platform.callMethod("GAME_PRE_END",{chapter:this._report.chapter,level:this._report.level,total_level:this._report.total_level,callback:function(t){t&&(e.isDisposed_||e._onShareSuccess())}}).then(function(t){t.success?e.isDisposed_||(e._shareText.text=t.text,xyd.setBtnBehavior(t.btn_info,e._shareBtn,e._shareText,e._shareBtnBg,e._bubble,e._bubble_text,e,t.callback),t.img_url&&""!=t.img_url&&xyd.setUISpriteByUrl(e._shareBtnImg,t.img_url),e._shouldChangeShareBtn&&(e._shareBtn.visible=!0),e._withdrawBtn.visible=!0,e._shouldChangeShareBtn&&(e._canShare=!0),!t.is_reach_coin_limit&&ABTest.get().getSetting(ABTest.SHOW_GOODS_COIN_AFTER_GAME)&&(e.group_show_coin.visible=!0,e._annaHolder.visible=!1,e._showCoinNumPic=xyd.bitmapNumber.createNumPic(30,"non_10_"),e.show_coin_num_container.addChild(e._showCoinNumPic))):e.isDisposed_||(e._withdrawBtn.visible=!0,e._withdrawBtn.horizontalCenter=0)})["catch"](function(e){return logger.error(e)}):(this._withdrawBtn.visible=!0,this._withdrawBtn.horizontalCenter=0);var t=this._report.mode;if(this._report.end_reason==GameEndReason.NoPossibleMoves?(this._reasonGroup.visible=!0,this._targetGroup.visible=!1,this._reason_label.text=xyd.__("ENDGAME_REASON_NOPOSSIBLEMOVES"),this._reason_img_swap.visible=!0,this._reason_img_bomb.visible=!1):this._report.end_reason==GameEndReason.TimeBombExploded?(this._reasonGroup.visible=!0,this._targetGroup.visible=!1,this._reason_label.text=xyd.__("ENDGAME_REASON_BOMB"),this._reason_img_bomb.visible=!0,this._reason_img_swap.visible=!1):this._report.end_reason==GameEndReason.ColorMixerDestroyed&&(this._reasonGroup.visible=!0,this._targetGroup.visible=!1,this._reason_label.text=xyd.__("ENDGAME_REASON_COLORMIXER"),this._reason_img_color_mixer.visible=!0,this._reason_img_swap.visible=!1,this._shouldChangeShareBtn=!1,this._canShare=!1,this._shareBtn.visible=!1,this._withdrawBtn.visible=!0,this._withdrawBtn.horizontalCenter=0),"Move"==t){var i=this._report.score,n=this._report.lowest_score_target||0,o=new MovesTargetComponent({score:i,targetScore:n});this._targetGroup.addChild(o),this._targetComponents.push(o)}else if("Leaf"==t){var i=this._report.leaf_target-this._report.leaf_remain,n=this._report.leaf_target,o=new ObjectTargetComponent({score:i,targetScore:n,targetStatus:0,targetType:"leaf"});this._targetGroup.addChild(o),this._targetComponents.push(o)}else if(t==GameModeConstants.LEAF_OBJECTIVE){var a=this._report[GameEndInfo.OBJECTIVES_REMAIN],s=this._report[GameEndInfo.OBJECTIVES_TARGET];for(var r in a){var l=s[r]-a[r],_=s[r],h=new ObjectTargetComponent({score:l,targetScore:_,targetStatus:l>=_?1:0,targetType:r});this._targetGroup.addChild(h),this._targetComponents.push(h)}var i=this._report.leaf_target-this._report.leaf_remain,n=this._report.leaf_target,o=new ObjectTargetComponent({score:i,targetScore:n,targetStatus:i>=n?1:0,targetType:"leaf"});
this._targetGroup.addChild(o),this._targetComponents.push(o)}else if(t==GameModeConstants.OBJECTIVE){var a=this._report[GameEndInfo.OBJECTIVES_REMAIN],s=this._report[GameEndInfo.OBJECTIVES_TARGET];for(var r in a){var l=s[r]-a[r],_=s[r],o=new ObjectTargetComponent({score:l,targetScore:_,targetStatus:l>=_?1:0,targetType:r});this._targetGroup.addChild(o),this._targetComponents.push(o)}}else if("Lamp"==t){var c=this._report.lamp_target,d=this._report.lamp_remain,p=[c[0]-d[0],c[1]-d[1]];if(c[0]>0){var o=new ObjectTargetComponent({score:p[0],targetScore:c[0],targetStatus:p[0]==c[0]?1:0,targetType:"lamp1"});this._targetGroup.addChild(o),this._targetComponents.push(o)}if(c[1]>0){var o=new ObjectTargetComponent({score:p[1],targetScore:c[1],targetStatus:p[1]==c[1]?1:0,targetType:"lamp2"});this._targetGroup.addChild(o),this._targetComponents.push(o)}}else if(t==GameModeConstants.LEAF_LAMP){var i=this._report.leaf_target-this._report.leaf_remain,n=this._report.leaf_target,o=new ObjectTargetComponent({score:i,targetScore:n,targetStatus:i>=n?1:0,targetType:"leaf"});this._targetGroup.addChild(o),this._targetComponents.push(o);var c=this._report.lamp_target,d=this._report.lamp_remain,p=[c[0]-d[0],c[1]-d[1]];if(c[0]>0){var u=new ObjectTargetComponent({score:p[0],targetScore:c[0],targetStatus:p[0]==c[0]?1:0,targetType:"lamp1"});this._targetGroup.addChild(u),this._targetComponents.push(u)}if(c[1]>0){var m=new ObjectTargetComponent({score:p[1],targetScore:c[1],targetStatus:p[1]==c[1]?1:0,targetType:"lamp2"});this._targetGroup.addChild(m),this._targetComponents.push(m)}}this._withdrawNum=xyd.bitmapNumber.createNumPic(1,"non_v_"),this._withdrawNumHolder.addChild(this._withdrawNum),xyd.isiOS8?this._showCharImg():this._showCharAnimation(),platform.inAutoMode()&&egret.setTimeout(function(){e._onWithdrawBtnClick()},this,500),this._title.text=xyd.__("GAME_FAILED"),this._shareText.text=xyd.__("INVITE_FRIEND"),this._label_withdraw.text=xyd.__("WITHDRAW")},t.prototype._showCharImg=function(){this._annaImg.visible=!0,this._annaImg.scaleX*=1.1,this._annaImg.scaleY*=1.1,this._annaImg.mask=this._annaMask},t.prototype._showCharAnimation=function(){EffectFactory.get().newEffect("anna_lose",function(e){e.x=this._annaHolder.width/2,e.y=this._annaHolder.height+175,e.scaleX*=1.3,e.scaleY*=1.3,e.mask=this._annaMask,this._annaEff=e,this._annaHolder.addChild(e),e.animation.play("texiao01",-1)}.bind(this))},t.prototype._onShareSuccess=function(){this._disableBtns(),this._gameResumeCallback(),xyd.WindowManager.get().closeWindow(this)},t.prototype._onWithdrawAnimation=function(e,t,i,n){if(void 0!=i){e.visible=!0;var o=new TimelineMax({useFrames:!0,onComplete:function(){var e=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0}),n=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0});e.fromTo(t,34*xyd.frameScale,{scaleX:a,scaleY:s},{scaleX:1.0247*a,scaleY:1.0247*s}),n.fromTo(i,34*xyd.frameScale,{scaleX:r,scaleY:r},{scaleX:1.05*r,scaleY:1.05*r})}});i.alpha=0;var a=t.scaleX,s=t.scaleY,r=i.scaleX;i.scaleX=.5*r,i.scaleY=.5*r,o.add(TweenLite.to(i,3*xyd.frameScale,{alpha:1}),0),o.add(TweenLite.to(i,9*xyd.frameScale,{scaleX:1.06*r,scaleY:1.06*r}),0),o.add(TweenLite.to(i,9*xyd.frameScale,{scaleX:r,scaleY:r}),9*xyd.frameScale),t.alpha=0,t.scaleX=.58*a,t.scaleY=.58*s,o.add(TweenLite.to(t,6*xyd.frameScale,{alpha:1}),15*xyd.frameScale),o.add(TweenLite.to(t,12*xyd.frameScale,{scaleX:1.015*a,scaleY:1.015*s}),15*xyd.frameScale),o.add(TweenLite.to(t,12*xyd.frameScale,{scaleX:a,scaleY:s})),n.alpha=0,o.add(TweenLite.to(n,6*xyd.frameScale,{alpha:1}),18*xyd.frameScale),this._tw=o}else{e.visible=!0,e.alpha=0;var l=e.scaleX,_=t.scaleX,o=new TimelineMax({onComplete:function(){var e=new TimelineMax({repeat:-1,yoyo:!0});e.fromTo(t,35*xyd.TweenDeltaTime,{scaleX:_,scaleY:_},{scaleX:1.02*_,scaleY:1.02*_})}});e.scaleX*=.1,e.scaleY*=.1,o.to(e,10*xyd.TweenDeltaTime,{alpha:1,scaleX:l,scaleY:l}),this._tw=o}},t.prototype._onWithdrawBtnClick=function(){var e=this;if(!this._needPopupPacket||this._packetInfo.visible||this._packetInfo.visible||platform.inAutoMode())if(!this._needPopupClearStreak||this.group_clearstreak.visible||this._packetInfo.visible||platform.inAutoMode()){this._disableBtns();var t=0;(this.group_mission.visible||this.group_clearstreak.visible||this._packetInfo.visible)&&(this._tw?(this._tw.timeScale(3),this._tw.reverse(),t=.15):(this.group_mission.visible=!1,this.group_clearstreak.visible=!1,this._packetInfo.visible=!1));var i=new TimelineLite({delay:t});this.group_bg.scaleX=1,this.group_bg.scaleY=1,this._usingTimelines.push(i),i.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:.5,scaleY:.5,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),i.call(function(){e._gameEndCallback&&e._gameEndCallback(),xyd.WindowManager.get().closeWindow(e)})}else{var i=new TimelineLite({onComplete:function(){e._annaHolder.visible=!0,e._onWithdrawAnimation(e.group_clearstreak,e._bubble2,void 0,e._inBubbleGroup2)}});i.add(TweenLite.to(this._annaHolder,10*xyd.TweenDeltaTime,{x:-30}),0)}else{var i=new TimelineLite({onComplete:function(){e._onWithdrawAnimation(e._packetInfo,e._bubble3,e._bubble3S,e._label_packet)}});i.add(TweenLite.to(this._annaHolder,10*xyd.TweenDeltaTime,{x:-30}),0)}},t.prototype._disableBtns=function(){this._shareBtn.touchEnabled=!1,this._withdrawBtn.touchEnabled=!1,this._closeBtn.touchEnabled=!1},t.prototype._enableBtns=function(){this._shareBtn.touchEnabled=!0,this._withdrawBtn.touchEnabled=!0,this._closeBtn.touchEnabled=!0},t.prototype.willClose=function(){e.prototype.willClose.call(this);for(var t=0,i=this._targetComponents;t<i.length;t++){var n=i[t];n.dispose()}this._annaEff&&this._annaEff.dispose(),this._withdrawNum&&xyd.bitmapNumber.destroyNumPic(this._withdrawNum),this._showCoinNumPic&&xyd.bitmapNumber.destroyNumPic(this._showCoinNumPic),this._tw&&this._tw.kill();for(var o=0,a=this._usingTimelines;o<a.length;o++){var s=a[o];s.kill()}TweenLite.killTweensOf(this._withdrawBtn),TweenLite.killTweensOf(this._shareBtn)},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t}(BaseWindow);__reflect(EndGameWindow.prototype,"EndGameWindow");var ExitComFirmWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingTimelines=[],n._needPopup=!1,n._needPopupClearStreak=!1,n._selfLevel=1,n.CONST_BAR_HEIGHT=65,n.skinName="resource/skins/ExitComfirmWindowSkin.exml",n.params_=i,n.stageLevel_=i.stageLevel,n._selfLevel=SelfInfo.get().getCurrentLevel(),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent()},t.prototype.initUIComponent=function(){var e=this,t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];new egret.ColorMatrixFilter(t);xyd.setDarkenBtnBehavior(this._continueBtn,this,this.onClose),xyd.setDarkenBtnBehavior(this._returnBtn,this,this.onExit),xyd.setDarkenBtnBehavior(this._closeBtn,this,this.onClose),this._title.text=xyd.__("EXIT_CONFIRM_TITLE"),this._desc.text=" "+xyd.__("EXIT_CONFIRM_DESC"),this._continueLabel.text=xyd.__("CONTINUE"),this._returnLabel.text=xyd.__("EXIT_GAME"),this._withdrawNum=xyd.bitmapNumber.createNumPic(1,"non_v_"),this._withdrawNumHolder.addChild(this._withdrawNum),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.WINDOW_GAME_EXIT_START,!1,{isShowMask:!0}),this.group_mission.visible=!1,SelfInfo.get().isInMission&&(xyd.setUISpriteAsync(this._stanima_icon,"energy_minus1",function(){e._stanima_icon.height=154,e._stanima_icon.width=124}),this._withdrawNum.visible=!1,this._stanima_minus.visible=!1),this.UIAnimation(),this.initMission(),this.initClearStreakInfo()},t.prototype.initMission=function(){var e=MainController.get().getGame();if(e&&e.getEngine()&&e.getEngine().getBoard()){var t=e.getEngine().getBoard().getSpecialDropHandler();t&&t.getCollectedEleNum()>0&&(this.group_mission.visible=!0,this._targetGroup.visible=!1)}},t.prototype.initClearStreakInfo=function(){var e=SelfInfo.get().getClearStreak();if(e>=1){this._needPopupClearStreak=!0,this._label_desc.textFlow=xyd.parseHtmlText(__("EXIT_CONFIRM_CLEARSTREAK_TIPS"));var t=Math.min(5,e);this._icon_reward.source="icon_jiangli"+t+"_png"}this.group_clearstreak.visible=!1},t.prototype.UIAnimation=function(){this.group_bg.verticalCenter;this.group_bg.verticalCenter=1e3;var e=new TimelineLite;e.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{verticalCenter:-25,ease:Linear.easeNone})),e.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{verticalCenter:12,ease:Linear.easeNone})),e.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{verticalCenter:-12,ease:Linear.easeNone})),e.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{verticalCenter:0,ease:Linear.easeNone}))},t.prototype.onClose=function(){var e=0;this._tw&&(this._tw.eventCallback("onComplete",null),this._tw.timeScale(3),this._tw.reverse(),e=.5);var t=new TimelineLite;t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{verticalCenter:1500}),e),t.call(function(){xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.WINDOW_GAME_EXIT_START,!1,{isShowMask:!1}),xyd.WindowManager.get().closeWindow("exit_comfirm_window")})},t.prototype.onExit=function(){if(SelfInfo.get().isInMission&&(this._needPopupClearStreak=!1),!this._needPopupClearStreak||this.group_clearstreak.visible||platform.inAutoMode()){var e=0;this._tw&&(this._tw.eventCallback("onComplete",null),this._tw.timeScale(3),this._tw.reverse(),e=.5);var t=new TimelineLite;t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{verticalCenter:1500}),e),t.call(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.CLICK_EXIT_BTN)),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.WINDOW_GAME_EXIT_START,!1,{isShowMask:!1}),xyd.WindowManager.get().closeWindow("exit_comfirm_window")})}else this._onExitAnimation(this.group_clearstreak,this._anna2,this._bubble_big2,this._bubble_small2,this._inBubbleGroup2)},t.prototype._onExitAnimation=function(e,t,i,n,o){e.visible=!0;var a=i.scaleX,s=new TimelineMax({useFrames:!0,onComplete:function(){var e=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0}),t=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0});e.fromTo(i,34*xyd.frameScale,{scaleX:a,scaleY:a},{scaleX:1.0247*a,scaleY:1.0247*a}),t.fromTo(n,36*xyd.frameScale,{scaleX:r,scaleY:r},{scaleX:1.05*r,scaleY:1.05*r})}});s.timeScale(2),t.alpha=0,s.to(t,8*xyd.frameScale,{alpha:1}),n.alpha=0;var r=n.scaleX;n.scaleX=.5*r,n.scaleY=.5*r,s.to(n,3*xyd.frameScale,{alpha:1}).to(n,9*xyd.frameScale,{scaleX:1.06*r,scaleY:1.06*r},"-=3").to(n,9*xyd.frameScale,{scaleX:r,scaleY:r}),i.alpha=0,i.scaleX=.78*a,i.scaleY=.78*a,s.to(i,9*xyd.frameScale,{alpha:1},"-=24").to(i,12*xyd.frameScale,{scaleX:1.015*a,scaleY:1.015*a},"-=24").to(i,12*xyd.frameScale,{scaleX:a,scaleY:a}),o.alpha=0,s.to(o,6*xyd.frameScale,{alpha:1},"-=24"),this._tw=s},t.prototype.dispose=function(){this._tw&&this._tw.kill();for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}this._withdrawNum&&xyd.bitmapNumber.destroyNumPic(this._withdrawNum),e.prototype.dispose.call(this)},t}(BaseWindow);__reflect(ExitComFirmWindow.prototype,"ExitComFirmWindow");var GameWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.BOARD_MAX_WIDTH=1062,n.BOARD_MAX_HEIGHT=1116,n.BOARD_ELE_WIDTH=118,n.BOARD_ELE_HEIGHT=124,n.ITEM_GROUP_SCALE=.9,n.ITEM_UNLOCK_STAGE=(o={},o[ItemConstants.HAMMER]=8,o[ItemConstants.SWAPPER]=12,o[ItemConstants.STICKER]=14,o[ItemConstants.WAND]=9,o[ItemConstants.INGAME_ADD_FIVE_STEPS]=10,o[ItemConstants.COLOR_LINE_BOMB_PACK]=10,o[ItemConstants.COLOR_SQUARE_BOMB_PACK]=10,o),n.ITEM_ICON_SOURCES=["icon_chuizi_png","icon_weizhijiaohuan_png","icon_mobang_png","icon_tiezhi_png"],n.NEW_ITME_ICON_SOURCE=(a={},a[ItemConstants.INGAME_ADD_FIVE_STEPS]="icon_add5_png",a[ItemConstants.COLOR_LINE_BOMB_PACK]="icon_fhlv_png",a[ItemConstants.COLOR_SQUARE_BOMB_PACK]="icon_fzlv_png",a),n.canTouch=!0,n.itemCanTouch=!0,n._gameOver=!1,n.labelItemNum=[],n.item_reach_limit=[],n.time_limited_img=[],n.item_reach_limit_img=[],n.timer_group=[],n.timer_img=[],n.NEW_ITEN_BUBBLE_TEXT=(s={},s[ItemConstants.INGAME_ADD_FIVE_STEPS]="使用后剩余步数+5",s[ItemConstants.COLOR_LINE_BOMB_PACK]="使用后很容易就过关了",s[ItemConstants.COLOR_SQUARE_BOMB_PACK]="使用后很容易就过关了",s),n.expired_time_cache=[],n.timer_label=[],n._status=ItemConstants.NORMAL,n._settingState=0,n._settingCanTouch=!0,n._boardScale=1,n.stick_choosed=0,n.stick_show=!1,n.bottomItemListMap={},n._showItemHint=!1,n._showWandHint=!1,n.inf_items=!1,n.pre_item_cnt=[],n._guangXiaoEffectGroup=[],n._isRequestingGameBuyItem=!1,n._isDirectly=!1,n._h5InGameWindows={},n.hasTimerOnItem_1=!1,n.hasTimerOnItem_2=!1,n.hasTimerOnItem_3=!1,n.hasTimerOnItem_4=!1,n.hasTimerOnItem=[],n.selectedColor=0,n._strongRemider=!1,n._strongRemiderScale=1.2,n.skinName="resource/skins/GameWindowSkin.exml",n.params_=i,n._board=i.board,n._gameView=i.view,n._isDirectly=i.isDirectly,n;var o,a,s}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.initSetting(),this._initEvents(),this._gameView.init(),this._gameView.setWindow(this),SelfInfo.get().isInMission?this.setStage(SelfInfo.get().missionLevel):this.setStage(this._board.getGameConf().totalLevel),this._board.init(),this.hasTimerOnItem=[this.hasTimerOnItem_1,this.hasTimerOnItem_2,this.hasTimerOnItem_3,this.hasTimerOnItem_4],this._bottomItemList=this._board.getIngameItemList(),this._ingameItemManager=new IngameItemManager,this._ingameItemManager.init(this._bottomItemList,this._board,this,this._gameView),this._gameView.checkGuide(),this.selfInfo_=SelfInfo.get(),this.timerCallback(),this.ITEM_ICON_SOURCES.push(this.NEW_ITME_ICON_SOURCE[this._bottomItemList[4]]);for(var t=0;t<this._bottomItemList.length;t++)this.initItemNumByIndex(t,this["item_num_"+t.toString()]),this.bottomItemListMap[this._bottomItemList[t]]=t,this.setItemIconByIndex(t);this.params.engineCallback&&(this.params.engineCallback(),delete this.params.engineCallback),this.UIAnimation(),this.initTimer(),this._gameView.boardStar(),xyd.isiPhoneX&&this.iPhoneXBottom(),SelfInfo.get().enterLinkType==xyd.EnterLinkType.Main&&1==SelfInfo.get().getCurrentLevel()&&(this.setting_btn.visible=!1,this.group_bottom.visible=!1),xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_VIEW_SET_STAGE,!0,!1,{stage:this._board.getGameConf().totalLevel}))},t.prototype.initSetting=function(){this.start_bottom=xyd.getHeight()-72.5,this.bg_shezhi.y=xyd.getHeight()-0,this.group_sound_bg.visible=!1,this.group_sound_effect.visible=!1,this.group_exit.visible=!1,this.group_question.visible=!1,this.bg_shezhi.visible=!1,this._settingBgGroup.touchEnabled=!1},t.prototype._initEvents=function(){xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION,this._realseItemHintAnimation,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_RELEASE_ITEM_GRID_HINT_ANIMATION,this._releaseItemGirdHintAnimation,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_USE_HAMMER_HINT,this._useHammerHint,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_USE_WAND_HINT,this._useWandHint,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ROCKET_CHECK_TARGET_FINISH,this.releaseRocketMask,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.WINDOW_WILL_OPEN,this.onWindowOpen,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.H5_IN_GAME_WINDOW,this.onH5InGameWindow,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.WINDOW_GAME_EXIT_START,this.onShowExitMask,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.ANNA_HEAD_STATE,this.annaHeadState,this),xyd.EventDispatcher.inner().addEventListener(xyd.event.BOARD_STEP,this._checkLastFiveRemainMoves,this),this.addEventListener(egret.Event.RESIZE,this._updateBoardPos,this)},t.prototype._removeEvents=function(){xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION,this._realseItemHintAnimation,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_RELEASE_ITEM_GRID_HINT_ANIMATION,this._releaseItemGirdHintAnimation,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_USE_HAMMER_HINT,this._useHammerHint,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_USE_WAND_HINT,this._useWandHint,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ROCKET_CHECK_TARGET_FINISH,this.releaseRocketMask,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.WINDOW_WILL_OPEN,this.onWindowOpen,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.H5_IN_GAME_WINDOW,this.onH5InGameWindow,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.WINDOW_GAME_EXIT_START,this.onShowExitMask,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.ANNA_HEAD_STATE,this.annaHeadState,this),xyd.EventDispatcher.inner().removeEventListener(xyd.event.BOARD_STEP,this._checkLastFiveRemainMoves,this),this.removeEventListener(egret.Event.RESIZE,this._updateBoardPos,this)},t.prototype.UIAnimation=function(){var e=this.group_board.horizontalCenter,t=this.group_top.top;this.group_top.top=t-278,this.group_board.horizontalCenter=e+1099,this.group_item1.scaleX=0,this.group_item1.scaleY=0,this.group_item2.scaleX=0,this.group_item2.scaleY=0,this.group_item3.scaleX=0,this.group_item3.scaleY=0,this.group_item0.scaleX=0,this.group_item0.scaleY=0,this.setting_btn.alpha=0;var i=new TimelineLite;i.add(TweenLite.to(this.group_top,6*xyd.TweenDeltaTime,{top:t,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_top,1*xyd.TweenDeltaTime,{top:t-21,ease:Linear.easeNone}),6*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_top,2*xyd.TweenDeltaTime,{top:t,ease:Linear.easeNone}),7*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_board,7*xyd.TweenDeltaTime,{horizontalCenter:e,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_board,1*xyd.TweenDeltaTime,{horizontalCenter:e-30,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_board,1*xyd.TweenDeltaTime,{horizontalCenter:e,ease:Linear.easeNone}),9*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item0,7*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_item0,1*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),7*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item0,1*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item1,6*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_item1,1*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),6*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item1,1*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),7*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item2,9*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_item2,1*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),9*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_item3,8*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.setting_btn,8*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0)},t.prototype.fiveItemAppearAnimation=function(){var e=this;if(this._canShowFiveItem()&&!this.group_item4.visible){var t=new TimelineLite;t.add(TweenLite.to(this.group_item0,9*xyd.TweenDeltaTime,{x:272.5,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_item1,9*xyd.TweenDeltaTime,{x:445,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_item2,9*xyd.TweenDeltaTime,{x:617.5,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_item3,9*xyd.TweenDeltaTime,{x:790,ease:Linear.easeNone}),0),t.call(function(){e.group_item4.visible=!0,e.group_item4_bubble.visible=!0,e._startItem4BubbleDisApperaTimer(),e.item4_bubble_text.text=e.NEW_ITEN_BUBBLE_TEXT[e._bottomItemList[4]],e._playFiveItemIconAnimaton()})}},t.prototype._startItem4BubbleDisApperaTimer=function(){void 0!=this._item4BubbleTimer&&(this._item4BubbleTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._onITem4BubbleTimerComplate,this),this._item4BubbleTimer.stop(),this._item4BubbleTimer=void 0),this._item4BubbleTimer=new egret.Timer(3e3,1),this._item4BubbleTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._onITem4BubbleTimerComplate.bind(this),this),this._item4BubbleTimer.start()},t.prototype._onITem4BubbleTimerComplate=function(){this.group_item4_bubble.visible=!1},t.prototype._playFiveItemIconAnimaton=function(){this.fiveItemTimeMax&&(this.fiveItemTimeMax.stop(),this.fiveItemTimeMax.kill()),this.fiveItemTimeMax=new TimelineMax,this.fiveItemTimeMax.add(TweenLite.to(this.group_item4,30*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),0),this.fiveItemTimeMax.add(TweenLite.to(this.group_item4,60*xyd.TweenDeltaTime,{scaleX:.8,scaleY:.8,ease:Linear.easeNone}),30*xyd.TweenDeltaTime),this.fiveItemTimeMax.add(TweenLite.to(this.group_item4,30*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),90*xyd.TweenDeltaTime),this.fiveItemTimeMax.repeat(-1)},t.prototype.fiveItemDisappearAnimation=function(){this.group_item4.visible=!1;var e=new TimelineLite;e.add(TweenLite.to(this.group_item0,18*xyd.TweenDeltaTime,{x:130,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_item1,18*xyd.TweenDeltaTime,{x:330,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_item2,18*xyd.TweenDeltaTime,{x:530,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_item3,18*xyd.TweenDeltaTime,{x:730,ease:Linear.easeNone}),0)},t.prototype.initUIComponent=function(){ABTest.get().getSetting(ABTest.ANDROID_STRONG_REMINDER)&&(this._strongRemider=!0),platform.inDebugMode()?this.initGmComponent():this.group_gm.parent&&this.group_gm.parent.removeChild(this.group_gm),this.group_top.top=xyd.statusBarHeight,this.group_item_tip.top+=xyd.statusBarHeight,this.black_mask.y-=xyd.statusBarHeight,this.canTouch=!1,this.boardLayer=new egret.DisplayObjectContainer,this.blockerLayer=new egret.DisplayObjectContainer,this.elementLayer=new egret.DisplayObjectContainer,this.leafLayer=new egret.DisplayObjectContainer,this.maskLayer=new egret.DisplayObjectContainer,this.effectLayer=new egret.DisplayObjectContainer,this.edgeLayer=new egret.DisplayObjectContainer,this.lockLayer=new egret.DisplayObjectContainer,this.beltLayer=new egret.DisplayObjectContainer,this.bottomLayer=new egret.DisplayObjectContainer,this.group_board.addChild(this.boardLayer),this.boardLayer.addChild(this.bottomLayer),this.boardLayer.addChild(this.leafLayer),this.boardLayer.addChild(this.beltLayer),this.boardLayer.addChild(this.elementLayer),this.boardLayer.addChild(this.blockerLayer),this.boardLayer.addChild(this.maskLayer),this.boardLayer.addChild(this.lockLayer),this.boardLayer.addChild(this.edgeLayer),this.boardLayer.addChild(this.effectLayer),platform.inDebugMode()&&(this.debugLayer=new egret.DisplayObjectContainer,this.boardLayer.addChild(this.debugLayer)),this.touchArea_=new egret.Bitmap,this.touchArea_.touchEnabled=!0,this.touchArea_.height=this.BOARD_MAX_HEIGHT,this.touchArea_.width=this.BOARD_MAX_WIDTH,this.group_board.addChild(this.touchArea_),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpDown,this),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragOnMainField,this),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_END,this.onOpUp,this),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onOutside,this),this.group_item0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem0,this),this.group_item1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem1,this),this.group_item2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem2,this),this.group_item3_normal.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem3,this),this.group_item4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem4,this),this.guide_area.touchEnabled=!1,this.guide_area.width=xyd.getWidth(),this.guide_area.height=xyd.getHeight(),this.score_bar_.mask=new egret.Rectangle(0,0,0,40),this._group_item4_bubble_bg.addEventListener(egret.TouchEvent.TOUCH_END,this.onItem4Bubble,this),this._settingBgGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onSetting,this),xyd.setDarkenBtnBehavior(this.group_sound_bg,this,this.onSoundBg),xyd.setDarkenBtnBehavior(this.group_sound_effect,this,this.onSoundEffect),xyd.setDarkenBtnBehavior(this.group_question,this,this.onBtnQuestion),SelfInfo.get().getCurrentLevel()<=SelfInfo.get().getEnterHomeMapLevel()&&!SelfInfo.get().isInMission?xyd.setImageGrey(this.group_exit):xyd.setDarkenBtnBehavior(this.group_exit,this,this.onBtnExit),xyd.setDarkenBtnBehavior(this.setting_btn,this,this.onSetting),this._strongRemider&&xyd.setDarkenBtnBehavior(this.group_remider,this,this.onBtnRemainder),this.group_items=[this.group_item0,this.group_item1,this.group_item2,this.group_item3,this.group_item4],this.item_reach_limit_img=[this.item0_reach_limit_img,this.item1_reach_limit_img,this.item2_reach_limit_img,this.item3_reach_limit_img],this.timer_group=[this.timer0_group,this.timer1_group,this.timer2_group,this.timer3_group,this.timer4_group],this.timer_label=[this.timer0_label,this.timer1_label,this.timer2_label,this.timer3_label,this.timer4_label],this.time_limited_img=[this.time_limited_img0,this.time_limited_img1,this.time_limited_img2,this.time_limited_img3,this.time_limited_img4],this.timer_img=[this.timer0_img,this.timer1_img,this.timer2_img,this.timer3_img,this.timer4_img],this.lastElementChoose=void 0,xyd.isLowEndDevice?this._bgImg.source="game_bg0_low_png":this._bgImg.source="game_bg0_png";var e=this._board.getSpecialDropHandler();if(e?this.setFund(e.getCollectedEleNum()):this.setAnnaHead(),ABTest.get().getSetting(ABTest.NEWUSER_STAGE_CASH_REWARD)&&1==SelfInfo.get().getCurrentLevel())this.group_newuser_redpacket.visible=!0;else if(ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY)){this.group_first_ten.visible=!1;var t=this._board.getGameConf().totalLevel;if(SelfInfo.get().isInFirstTenLevel(t)){this.group_first_ten.visible=!0;var i=[];if(SelfInfo.get().isFirstTenLevel(t))t<SelfInfo.get().getCurrentLevel()?this.group_first_ten.visible=!1:(i.push({text:xyd.__("NEW_USER_REDPACKET1"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:xyd.__("NEW_USER_REDPACKET2"),style:{textColor:15546382,size:42,fontFamily:"Microsoft YaHei",bold:!0}}));else{var n=SelfInfo.get().getNextPayLevel(t);i.push({text:xyd.__("FIRST_TEN_TIPS1"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:n.toString(),style:{textColor:15546382,size:42,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:xyd.__("FIRST_TEN_TIPS2"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),0==n&&(this.group_first_ten.visible=!1)}this.label_first_ten.textFlow=i}}else if(ABTest.get().getSetting(ABTest.WIN_GAME_CASH_REWARD)){var o=this._board.getGameConf().totalLevel,a=SelfInfo.get().getCurrentLevel();if(o==a&&10>=o){var s=SelfInfo.get().getStageInfo(o),i=[];if(void 0!=s.pay_level&&1==s.pay_level)i.push({text:xyd.__("NEW_USER_REDPACKET1"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:xyd.__("NEW_USER_REDPACKET2"),style:{textColor:15546382,size:42,fontFamily:"Microsoft YaHei",bold:!0}}),this.label_get_cash.textFlow=i,this.group_get_cash.visible=!0;else{var r=SelfInfo.get().getNextPayLevel(o);r>0&&(i.push({text:xyd.__("FIRST_TEN_TIPS1"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:r.toString(),style:{textColor:15546382,size:42,fontFamily:"Microsoft YaHei",bold:!0}}),i.push({text:xyd.__("FIRST_TEN_TIPS2"),style:{textColor:10508333,size:36,fontFamily:"Microsoft YaHei",bold:!0}}),this.label_get_cash.textFlow=i,this.group_get_cash.visible=!0)}}}this.label_item3_col.text=xyd.__("COL_USE"),this.label_item3_row.text=xyd.__("ROW_USE"),this.label_redpacket1.text=xyd.__("NEW_USER_REDPACKET1"),this.label_redpacket2.text=xyd.__("NEW_USER_REDPACKET2")+xyd.__("EXCLAMATION_MARK"),this.item_tip.text=xyd.__("ROCKET_TIPS"),this.label_shuffle.text=xyd.__("SHUFFLE_TIPS"),this.mode1_score1.text=xyd.__("GAME_MODE1_TIPS1"),this.mode1_score2.text=xyd.__("GAME_MODE1_TIPS2"),this.mode1_score3.text=xyd.__("GAME_MODE1_TIPS3"),this.label_mode2_tips1.text=xyd.__("GAME_MODE2_TIPS1"),this.label_mode2_tips2.text=xyd.__("GAME_MODE2_TIPS2"),this.label_mode3_tips1.text=xyd.__("GAME_MODE3_TIPS1"),this.label_mode3_tips2.text=xyd.__("GAME_MODE3_TIPS2"),this.label_mode4_tips.text=xyd.__("GAME_MODE4_TIPS"),this.label_skip.text=xyd.__("GAME_SKIP_TIPS")},t.prototype.onShowExitMask=function(e){e.data.isShowMask?(this.black_mask.visible=!0,this.black_mask.alpha=.6,this.black_mask.height=xyd.getHeight(),this.setChildIndex(this.group_top,this.numChildren-1)):(this.black_mask.visible=!1,this.setChildIndex(this.group_top,1))},t.prototype.iPhoneXBottom=function(){var e=38;this.start_bottom-=e,this.setting_btn.y-=e,this.group_sound_bg.y-=e,this.group_sound_effect.y-=e,this.group_question.y-=e,this.group_exit.y-=e,this.bg_shezhi.y-=e,this.group_bottom.bottom+=e},t.prototype.confirmBtnClick=function(){if(this._board.isStable()){if(""!=this.text_input.text){var e=this.text_input.text.split(" ");switch(e.length){case 1:if(1==parseInt(e[0])&&this._board.setAutoWin(),0==parseInt(e[0])&&this._board.setMovesLeft(0),3==parseInt(e[0])&&MainController.get()._onBackBtn(),2==parseInt(e[0])&&(platform.switchAutoMode(),this._gameView.setTestMove(),this._board.switchMoveTime()),10==parseInt(e[0])){var i=this._board.getScoreTargets();this.setScore(i[0],0,!0),this._board.setSavedScore(i[0]),this._board.setAutoWin()}if(11==parseInt(e[0])){var i=this._board.getScoreTargets();this.setScore(i[1],0,!0),this._board.setSavedScore(i[1]),this._board.setAutoWin()}if(12==parseInt(e[0])){var i=this._board.getScoreTargets();this.setScore(i[2],0,!0),this._board.setSavedScore(i[2]),this._board.setAutoWin()}break;case 2:if("item"===e[0].toLowerCase()&&"inf"===e[1].toLowerCase()){console.log("items inf");for(var n=0;n<t.INGAME_ITEM_NUM;n++){var o=this._bottomItemList[n],a=this._ingameItemManager.getItemById(o);this.pre_item_cnt.push(a.getTotalNum()),this.item_reach_limit[n]=!1,this.checkItemIsUnlocked(n)&&(a.addTempNum(999-a.getTotalNum()),this.setItemNumByIndex(n,a.getTotalNum()))}this.inf_items=!0}else if("item"===e[0].toLowerCase()&&"nom"===e[1].toLowerCase()){if(0==this.pre_item_cnt.length)break;this.inf_items=!1;for(var n=0;n<t.INGAME_ITEM_NUM;n++){var o=this._bottomItemList[n],a=this._ingameItemManager.getItemById(o);this.checkItemIsUnlocked(n)&&(a.addTempNum(this.pre_item_cnt[n]-a.getTotalNum()),this.setItemNumByIndex(n,a.getTotalNum()))}this.pre_item_cnt=[]}else{var s=parseInt(e[1]),r=e[0].toLowerCase();"ss"===r?this._board.setMovesLeft(s):"sc"===r&&this._board.setSavedScore(s)}break;case 3:var r=e[0].toLowerCase(),l=parseInt(e[1]);if("add"===r&&l>=0&&4>l&&this.checkItemIsUnlocked(l)&&!this.item_reach_limit[l]){var o=this._bottomItemList[l],a=this._ingameItemManager.getItemById(o);a.addTempNum(parseInt(e[2])),this.setItemNumByIndex(l,a.getTotalNum())}var _=e[1].toLowerCase(),h=e[2].toLowerCase();"show"==r&&"new"==_&&"item"==h&&this.fiveItemAppearAnimation();break;case 4:var r=e[0].toLowerCase();if("rd"==r){var c=this._board.getElementFactory().create(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),1);this._board.replaceTo(c);var d=new egret.Bitmap;xyd.setBitmapAsync(d,"fund_hongbao_icon",function(){d.width=ElementView.DROP_BITMAP_WIDTH,d.height=ElementView.DROP_BITMAP_HEIGHT,d.x=c.view.displayGroup.width-ElementView.DROP_BITMAP_WIDTH,d.y=c.view.displayGroup.height-ElementView.DROP_BITMAP_HEIGHT}),c.view.displayGroup.addChild(d)}else{var p=void 0;p=this._board.getElementFactory().create(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3])),this._board.replaceTo(p)
}break;case 5:var p=void 0;p=this._board.getElementFactory().create(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),void 0,parseInt(e[4])),this._board.replaceTo(p)}}this.text_input.text=""}},t.prototype.initGmComponent=function(){this.group_gm.visible=!0,this.group_gm.top=-30,xyd.setDarkenBtnBehavior(this.btn_confirm,this,this.confirmBtnClick)},t.prototype.initTimer=function(){this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerCallback,this),this.timer.start()},t.prototype.initItemNumByIndex=function(e,t){var i=this.selfInfo_,n=this._bottomItemList[e],o=n+ItemConstants.LIMITED_TIME_OFFSET,a=n+ItemConstants.UNLIMITED_TIME_OFFSET,s=this._ingameItemManager.getItemById(n);(void 0==s||void 0==o)&&console.log("Can't fint item: "+n+", "+o);var r=i.getItemNumByID(String(n)),l=i.getItemNumByID(String(o)),_=i.getItemNumByID(String(a));(l>0||_>0)&&this.checkItemIsUnlocked(e)&&(this.timer_group[e].visible=!0);var h,c,d=r+l;_>0?(this.timer_img[e].source="bg_unlimited_daojishi_png",c=xyd.bitmapNumber.createNumPicWithPunctuation("",h)):(this.timer_group[e].visible?(this.timer_img[e].source="bg_xianshidaoju_png",h="non_5_"):h="non_4_",c=xyd.bitmapNumber.createNumPic(d,h),this.adjustItemNumPos(e,c)),this.labelItemNum[e]=c,t.addChild(this.labelItemNum[e]),s.count-this._board.getItemUsedCount()[e]<=0&&(this.item_reach_limit[e]=!0,this.item_reach_limit_img[e].visible=!0),this.inf_items&&platform.inDebugMode()&&(this.item_reach_limit[e]=!1,this.item_reach_limit_img[e].visible=!1)},t.prototype.adjustItemNumPos=function(e,t){var i=xyd.bitmapNumber.getWidth(t),n=xyd.bitmapNumber.getHeight(t),o=this["item_num_"+e.toString()];t.x=.43*(o.width-i),t.y=.5*(o.height-n)},t.prototype.setAllItemNum=function(){for(var e=0;e<this._bottomItemList.length;e++){var t=this._bottomItemList[e],i=this._ingameItemManager.getItemById(t);this.checkItemIsUnlocked(e)&&this.setItemNumByIndex(e,i.getTotalNum())}},t.prototype.setItemNumByIndex=function(e,t){var i,n=this.labelItemNum[e],o=SelfInfo.get(),a=this._bottomItemList[e],s=a+ItemConstants.UNLIMITED_TIME_OFFSET,r=o.getItemNumByID(String(s));r>0?(i="non_5_",xyd.bitmapNumber.changeNumWithPunctuation(n,"",i)):(i=this.timer_group[e].visible?"non_5_":"non_4_",xyd.bitmapNumber.changeNum(n,t,i),this.adjustItemNumPos(e,n))},t.prototype.gameEnd=function(){this.touchArea_.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpDown,this),this.touchArea_.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragOnMainField,this),this.touchArea_.removeEventListener(egret.TouchEvent.TOUCH_END,this.onOpUp,this),this.group_item0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem0,this),this.group_item1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem1,this),this.group_item2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem2,this),this.group_item3_normal.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem3,this),this.group_item4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem4,this)},t.prototype.gameResume=function(){this.group_skip.visible=!1,this._showAllIcons(),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpDown,this),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragOnMainField,this),this.touchArea_.addEventListener(egret.TouchEvent.TOUCH_END,this.onOpUp,this),this.group_item0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem0,this),this.group_item1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem1,this),this.group_item2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem2,this),this.group_item3_normal.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem3,this),this.group_item4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem4,this)},t.prototype.setScore=function(e,t,i){i?(this.scoreNum=xyd.bitmapNumber.createNumPic(e,"non_11_"),this.scoreNum.scaleX=.6,this.scoreNum.scaleY=.6):xyd.bitmapNumber.changeNum(this.scoreNum,e,"non_11_"),this.score_.addChild(this.scoreNum),xyd.bitmapNumber.setNumGap(this.scoreNum,-8),this.score_.right=xyd.bitmapNumber.getWidth(this.scoreNum),this.scoreTimeline_&&(this.scoreTimeline_.stop(),this.scoreTimeline_.kill()),this.scoreTimeline_=new TimelineLite;var n=10*xyd.TweenDeltaTime,o=this.score_bar_.mask;t=1==t?1.1:t;var a=this.score_bar_.width*t;void 0!=o&&this.scoreTimeline_.add(TweenLite.to(o,n,{width:a}),0)},t.prototype.setStep=function(e,t){0==e?this._gameOver=!0:e>0&&(this._gameOver=!1),t?this.stepNum=xyd.bitmapNumber.createNumPic(e,"non_10_"):xyd.bitmapNumber.changeNum(this.stepNum,e,"non_10_"),xyd.bitmapNumber.setNumGap(this.stepNum,-5),this.stepNum.anchorOffsetX=xyd.bitmapNumber.getWidth(this.stepNum)/2/this.stepNum.scaleX,this.stepNum.anchorOffsetY=xyd.bitmapNumber.getHeight(this.stepNum)/2/this.stepNum.scaleY,this.stepNum.x=this.step_.width/2,this.stepNum.y=this.step_.height/2,this.stepNum.name="stepNum",this.step_.addChild(this.stepNum)},t.prototype.setStage=function(e){this.stageNum=xyd.bitmapNumber.createNumPic(e,"non_10_"),xyd.bitmapNumber.setNumGap(this.stageNum,-5),this.stageNum.x=(this.stage_.width-.42*xyd.bitmapNumber.getWidth(this.stageNum))/2,this.stageNum.y=(this.stage_.height-.42*xyd.bitmapNumber.getHeight(this.stageNum))/2,this.stageNum.scaleX=.42,this.stageNum.scaleY=.42,this.stage_.addChild(this.stageNum),this.stageLevel_=e},t.prototype.moveElement=function(e,t){if(this.lastLogicPoint&&this._gameView.unselectElement(this.lastLogicPoint.x,this.lastLogicPoint.y),this._gameView.isStableElement(t.x,t.y))return void(this.lastLogicPoint=void 0);this.setCanTouch(!1);var i=new SwapInfo(e,t);if(void 0!=this._guide){var n=this._guide.getGuideID();GuideHelper.isValidMoveInGuide(n,e,t)&&this._board.isValidSwap(i)?(this._gameView.doSwap(i),SoundManager.getInstance().playEffect("se_switch_mp3")):this.setCanTouch(!0)}else this._board.isValidSwap(i)?(this._gameView.doSwap(i),SoundManager.getInstance().playEffect("se_switch_mp3")):(this._gameView.doInValidSwap(i),SoundManager.getInstance().playEffect("se_switch_2_mp3"));this.lastLogicPoint=void 0},t.prototype.setBoardPos=function(e,t,i,n){this._maxWidth=e,this._minWidth=t,this._maxHeight=i,this._minHeight=n,this._originBoardX=this.group_board.x,this._originBoardY=this.group_board.y,this._updateBoardPos()},t.prototype._updateBoardPos=function(){var e=this._maxWidth-this._minWidth+1,i=-this._minWidth;i+=8-this._maxWidth,i*=xyd.TILE_WIDTH_HALF;var n=(this._maxHeight-this._minHeight+1,-this._minHeight);n+=8-this._maxHeight,n*=xyd.TILE_HEIGHT_HALF,e%2==0?this.group_board.x=i+this._originBoardX:this.group_board.x=i+this._originBoardX;var o=xyd.getHeight()-t.TOP_UI_HEIGHT-t.BOTTOM_UI_HEIGHT,a=1;o<this.group_board.height&&(a=o/t.MAX_BOARD_HEIGHT);var s=9,r=.5;ABTest.get().getSetting(ABTest.EXTRA_EDGE_SPACE)&&(r=1),xyd.isApp&&(r=0);var l=(s-r)/s;a>l&&(a=l),this._boardScale=a,this.group_board.scaleX=a,this.group_board.scaleY=a,this.group_board.y=(o-this.group_board.height*a)/2+t.TOP_UI_HEIGHT+this.group_board.anchorOffsetY+n,xyd.getHeight()>1920&&(this.group_bg.scaleX=(xyd.getHeight()+xyd.statusBarHeight)/1920,this.group_bg.scaleY=(xyd.getHeight()+xyd.statusBarHeight)/1920),this.group_first_ten.visible?(this.group_first_ten.y=this.group_board.y-10-(4.5-this._minHeight)*xyd.TILE_HEIGHT*a,this.group_first_ten.scaleX=a,this.group_first_ten.scaleY=a):this.group_newuser_redpacket.visible?(this.group_newuser_redpacket.y=this.group_board.y-10-(4.5-this._minHeight)*xyd.TILE_HEIGHT*a,this.group_newuser_redpacket.scaleX=a,this.group_newuser_redpacket.scaleY=a):this.group_get_cash.visible&&(this.group_get_cash.y=this.group_board.y-10-(4.5-this._minHeight)*xyd.TILE_HEIGHT*a,this.group_get_cash.scaleX=a,this.group_get_cash.scaleY=a),this.GROUP_BOARD_X=this.group_board.x,this.GROUP_BOARD_Y=this.group_board.y},t.prototype.touchMoved=function(e,t){},t.prototype.onOutside=function(e){if(void 0!=this._status){if(this._status==ItemConstants.NORMAL)return this.onOpUpNormal(e),void(this.lastLogicPoint=void 0);if(this._status==ItemConstants.ROCKET)return void(this.lastLogicPoint=void 0);var t=this._ingameItemManager.getItemById(this._status);t.onOpUp(e),this.lastLogicPoint=void 0}},t.prototype.onOpUp=function(e){if(void 0!=this._status){if(this._status==ItemConstants.NORMAL)return this.onOpUpNormal(e),void(this.lastLogicPoint=void 0);if(this._status==ItemConstants.ROCKET)return void(this.lastLogicPoint=void 0);this._status==ItemConstants.STICKER&&this.img_item3&&(this.img_item3.rotation=0);var t=this._ingameItemManager.getItemById(this._status);t.onOpUp(e),this.lastLogicPoint=void 0}},t.prototype.onOpDown=function(e){if(void 0!=this._status){if(this._status==ItemConstants.NORMAL)return void this.onOpDownNormal(e);if(this._status==ItemConstants.ROCKET)return void this.onOpDownRocket(e);var t=this._ingameItemManager.getItemById(this._status);t.onOpDown(e)}},t.prototype.onDragOnMainField=function(e){if(void 0!=this._status){if(this._status==ItemConstants.NORMAL)return void this.onDragOnMainFieldNormal(e);if(this._status!=ItemConstants.ROCKET){var t=this._ingameItemManager.getItemById(this._status);t.onDragOnMainField(e)}}},t.prototype.setCanTouch=function(e){this.canTouch=e},t.prototype.setStatus=function(e){this._status=e,this._status!=ItemConstants.NORMAL&&this._gameView.clearLeafLight()},t.prototype.onOpUpNormal=function(e){if(this.lastLogicPoint&&this._gameView.unselectElement(this.lastLogicPoint.x,this.lastLogicPoint.y),0!=this.canTouch){var t=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));if(void 0!=this._guide){var i=this._guide.getGuideID();if(!GuideHelper.isValidSelectionInGuide(i,t))return}if(this.lastElementChoose){if(this.lastElementChoose.x==t.x&&1==Math.abs(this.lastElementChoose.y-t.y)||this.lastElementChoose.y==t.y&&1==Math.abs(this.lastElementChoose.x-t.x))return this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this._gameView.unselectElement(t.x,t.y),this.moveElement(this.lastElementChoose,t),this.lastMousePos=void 0,this.curMousePos=void 0,this.lastLogicPoint=void 0,void(this.lastElementChoose=void 0);t.x==this.lastElementChoose.x&&t.y==this.lastElementChoose.y?(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0):(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this._gameView.selectElement(t.x,t.y),this.lastElementChoose=t)}if(this.lastLogicPoint&&t.x==this.lastLogicPoint.x&&t.y==this.lastLogicPoint.y){this.lastElementChoose=t,this._gameView.selectElement(t.x,t.y);var n=this._board.getElementAtGrid(this.lastElementChoose.x,this.lastElementChoose.y);if(n&&n.type==ElementTypeConstants.ROCKET){var o=n;o.rocketState==RocketConstants.STATE_READY&&(this.useItemMask(ItemConstants.ROCKET),this._setItemMaskExcludeIndex(-1),this._guide&&(this._guide.visible=!1),this.group_item_tip.visible=!0,o.rocketType==RocketConstants.SPECIAL_COLOR_BOMBED?this.item_img.source=DisplayConstants.RocketStateSourceMap[CellConstants.CELL_COLOR_RANDOM][0]:this.item_img.source=DisplayConstants.ElementDisplaySourceMap[170+o.color],this.item_tip.text=xyd.__(ItemConstants.ROCKET_TIP))}}this.lastLogicPoint=t,this._gameOver||void 0!=this.lastLogicPoint&&(t.x==this.lastLogicPoint.x&&(t.y==this.lastLogicPoint.y+1||t.y==this.lastLogicPoint.y-1)&&this.moveElement(this.lastLogicPoint,t),t.y==this.lastLogicPoint.y&&(t.x==this.lastLogicPoint.x+1||t.x==this.lastLogicPoint.x-1)&&this.moveElement(this.lastLogicPoint,t),this.clearMouseData())}},t.prototype.onOpDownNormal=function(e){if(!this._gameOver&&0!=this.canTouch&&!(e.localX>this.BOARD_MAX_WIDTH||e.localY>this.BOARD_MAX_HEIGHT)){this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));if(this.lastLogicPoint=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY)),this._gameView.isStableElement(this.lastLogicPoint.x,this.lastLogicPoint.y))return void(this.lastLogicPoint=void 0);this._gameView.selectElement(this.lastLogicPoint.x,this.lastLogicPoint.y),0!=e.stageX||0!=e.stageY?(this.lastMousePos=new egret.Point(e.stageX,e.stageY),this.curMousePos=new egret.Point(e.stageX,e.stageY)):(this.lastMousePos=new egret.Point(-1e3,-1e3),this.curMousePos=new egret.Point(-1e3,-1e3))}},t.prototype.onOpDownRocket=function(e){if(!this._gameOver&&0!=this.canTouch&&!(e.localX>this.BOARD_MAX_WIDTH)&&!(e.localY>this.BOARD_MAX_HEIGHT)&&this.lastElementChoose){var t=this._gameView.viewToLogicTouch(new egret.Point(e.localX,e.localY));t.equals(this.lastElementChoose)?(this.unuseItemMask(),this._gameView.checkPossibleMove(),this._guide&&(this._guide.visible=!0)):xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ROCKET_CHECK_TARGET,!0,!1,{to:t,from:this.lastElementChoose}))}},t.prototype.onDragOnMainFieldNormal=function(e){if(0!=this.canTouch&&!this._gameOver&&void 0!=this.lastLogicPoint){void 0==this.curMousePos?this.curMousePos=new egret.Point(e.stageX,e.stageY):(this.curMousePos.x=e.stageX,this.curMousePos.y=e.stageY);var t=new egret.Point;return t.x=this.lastLogicPoint.x,t.y=this.lastLogicPoint.y,Math.abs(this.curMousePos.x-this.lastMousePos.x)>this.BOARD_ELE_WIDTH/4?(this.curMousePos.x-this.lastMousePos.x>0?t.x++:t.x--,t.y=this.lastLogicPoint.y,this.lastElementChoose&&(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0),this.moveElement(this.lastLogicPoint,t),void(this.lastLogicPoint=void 0)):Math.abs(this.curMousePos.y-this.lastMousePos.y)>this.BOARD_ELE_WIDTH/4?(this.curMousePos.y-this.lastMousePos.y>0?t.y++:t.y--,t.x=this.lastLogicPoint.x,this.lastElementChoose&&(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0),this.moveElement(this.lastLogicPoint,t),void(this.lastLogicPoint=void 0)):void 0}},t.prototype.onItem0=function(e){return this.checkItemIsUnlocked(0)?void this.listenOnItemByIndex(0):void xyd.WindowManager.get().openWindow("item_lock_window")},t.prototype.onItem1=function(e){return this.checkItemIsUnlocked(1)?void this.listenOnItemByIndex(1):void xyd.WindowManager.get().openWindow("item_lock_window")},t.prototype.onItem2=function(e){return this.checkItemIsUnlocked(2)?void this.listenOnWand():void xyd.WindowManager.get().openWindow("item_lock_window")},t.prototype.onItem3=function(e){return this.checkItemIsUnlocked(3)?void this.listenOnItemByIndex(3):void xyd.WindowManager.get().openWindow("item_lock_window")},t.prototype.onItem4=function(e){this.listenOnFiveItem()},t.prototype.listenOnFiveItem=function(){var e=this;if(this.lastElementChoose&&(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0),this.canTouch&&this.itemCanTouch&&(void 0==this._item_lisenter_index||4==this._item_lisenter_index)){var t=this._bottomItemList[4],i=this._ingameItemManager.getItemById(t);if(this._status==ItemConstants.NORMAL)if(t==ItemConstants.INGAME_ADD_FIVE_STEPS){var n=i.getTotalNum();if(0>=n){if(this._isRequestingGameBuyItem)return;return this._isRequestingGameBuyItem=!0,egret.setTimeout(function(){e._isRequestingGameBuyItem=!1},this,600),void this.selfInfo_.buyItemByID(""+t,this.stageLevel_).then(function(t){t&&(e.setAllItemNum(),i.getTotalNum()>0&&(e._item_lisenter_index=4,e._gameView.clearPossibleMove(),e.setCanTouch(!1),i.inUse(),e.removeGuide(),e.playInGameAddFiveStepsAnimation(i),e._item_lisenter_index=void 0))})["catch"](function(e){return console.log(e)})}this._item_lisenter_index=4,i.inUse(),this.removeGuide(),this.playInGameAddFiveStepsAnimation(i),this._item_lisenter_index=void 0}else{var n=i.getTotalNum();if(0>=n){if(this._isRequestingGameBuyItem)return;return this._isRequestingGameBuyItem=!0,egret.setTimeout(function(){e._isRequestingGameBuyItem=!1},this,600),void this.selfInfo_.buyItemByID(""+t,this.stageLevel_).then(function(n){n&&(e.setAllItemNum(),i.getTotalNum()>0&&(e.useItemMask(t),e._showColorSelectPannel(),e._setItemMaskExcludeIndex(4),e._item_lisenter_index=4))})["catch"](function(e){return console.log(e)})}this.useItemMask(t),this._showColorSelectPannel(),this._setItemMaskExcludeIndex(4),this._item_lisenter_index=4}else this._status=ItemConstants.NORMAL,this.unuseItemMask(),this._item4_mask.visible=!1,this._gameView.checkPossibleMove(),this._hideColorSelectPannel()}},t.prototype._hideColorSelectPannel=function(){this.group_color_select.visible=!1;for(var e=2;6>=e;e++)this["group_"+e+"_color_select"].visible=!1;this._item4_tips_label.visible=!1,null!=this.selectedColorEff&&(this.selectedColorEff.animation.stop(),this.selectedColorEffGroup.removeChild(this.selectedColorEff),EffectFactory.get().pushBackEffect(this.selectedColorEff),this.selectedColorEff=null)},t.prototype._showColorSelectPannel=function(){this.selectedColor=0,this._item4_tips_label.visible=!0,this.group_color_select.visible=!0,this.boardColors=this._getBaordColorCount(),this.colorNum=this.boardColors.length,2==this.colorNum?this._setColorSelectPannel(this.colorNum,this.boardColors):3==this.colorNum?this._setColorSelectPannel(this.colorNum,this.boardColors):4==this.colorNum?this._setColorSelectPannel(this.colorNum,this.boardColors):5==this.colorNum?this._setColorSelectPannel(this.colorNum,this.boardColors):6==this.colorNum?this._setColorSelectPannel(this.colorNum,this.boardColors):console.error("错误的颜色种类！！！！")},t.prototype._setColorSelectPannel=function(e,t){this.group_color_select.visible=!0,this["group_"+e+"_color_select"].visible=!0;this.color_select_confirm_btn.visible=!1;for(var i=1;e>=i;i++)this["group_"+e+"_color_select_"+i].visible=!0;if(this._status==ItemConstants.COLOR_LINE_BOMB_PACK)for(var i=1;e>=i;i++)this["btn_"+e+"_color_select_"+i+"_Img"].source=DisplayConstants.colorLineBombIconImgMap[this.boardColors[i-1]]+"_png";else if(this._status==ItemConstants.COLOR_SQUARE_BOMB_PACK)for(var i=1;e>=i;i++)this["btn_"+e+"_color_select_"+i+"_Img"].source=DisplayConstants.colorSquareBombIconImgMap[this.boardColors[i-1]]+"_png";for(var i=1;i<=this.colorNum;i++)this["group_"+e+"_color_select_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedColor.bind(this,i-1),this);this.color_select_confirm_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedColorConfirm,this)},t.prototype.onSelectedColorConfirm=function(){0!=this.selectedColor&&(console.info("selected Color "+this.selectedColor.toString()+"!!!!!!!!!"),this._gameView.checkPossibleMove(),this._hideColorSelectPannel(),this.playColorLineBomeItemAnimation())},t.prototype.onSelectedColor=function(e){this.colorIndex=e,this.color_select_confirm_btn.visible=!0,this._item4_tips_label.visible=!1,this.playColorSelectedEffByIndex(e)},t.prototype.playColorLineBomeItemAnimation=function(){var e,t=this,i=new egret.Bitmap,n=new egret.Bitmap;xyd.setBitmapAsync(i,"ele_color_bomb",function(){i.scaleX=1.5,i.scaleY=1.5,i.$anchorOffsetX=i.width/2,i.$anchorOffsetY=i.height/2,i.x=200,i.y=xyd.stageHeight/2+xyd.TILE_HEIGHT_HALF}),this._status==ItemConstants.COLOR_LINE_BOMB_PACK?e=DisplayConstants.elememtLineColorIconImgMap[this.boardColors[this.colorIndex]]:this._status==ItemConstants.COLOR_SQUARE_BOMB_PACK&&(e=DisplayConstants.elememtSquareColorIconImgMap[this.boardColors[this.colorIndex]]),xyd.setBitmapAsync(n,e,function(){n.scaleX=1.5,n.scaleY=1.5,n.$anchorOffsetX=n.width/2,n.$anchorOffsetY=n.height/2,n.x=880,n.y=xyd.stageHeight/2+xyd.TILE_HEIGHT_HALF}),this.addChild(n),this.addChild(i);var o=new TimelineLite;o.add(TweenLite.to(i,15*xyd.TweenDeltaTime,{x:xyd.stageWidth/2,ease:Linear.easeNone}),0),o.add(TweenLite.to(n,15*xyd.TweenDeltaTime,{x:xyd.stageWidth/2,ease:Linear.easeNone}),0),o.call(function(){EffectFactory.get().newEffect(EffectConstants.SPECIAL_DESTRUCTION_COLOR_EFFECT,function(e){e.scaleX=1.5,e.scaleY=1.5,e.x=xyd.stageWidth/2,e.y=xyd.stageHeight/2+xyd.TILE_HEIGHT_HALF,e.animation.play("texiao01",2),this.addChild(e);var t=this._bottomItemList[4],o=this._ingameItemManager.getItemById(t);o.setSourceColor(this.boardColors[this.colorIndex]),o.activate();var a=function(o){e.removeDBEventListener("complete",a,this),e.animation.stop(),this.removeChild(e),this.removeChild(i),this.removeChild(n),xyd.EventDispatcher.inner().dispatchEventWith(xyd.event.ITEM_SPECIAL_SWITCH_MADE,!1,{itemType:t,elementColor:this.boardColors[this.colorIndex]}),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",a,this)}.bind(t))}),o.add(TweenLite.to(this._item4_mask,15*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),15*xyd.TweenDeltaTime),o.call(function(){t._item4_mask.alpha=.6,t._item4_mask.visible=!1,t.unuseItemMask()})},t.prototype.playColorSelectedEffByIndex=function(e){this.selectedColor!=this.boardColors[this.colorIndex]&&(this.selectedColor=this.boardColors[e],null!=this.selectedColorEff&&(this.selectedColorEff.animation.stop(),this.selectedColorEffGroup.removeChild(this.selectedColorEff),EffectFactory.get().pushBackEffect(this.selectedColorEff),this.selectedColorEff=null),this.playColorSelectedEff(e+1))},t.prototype.playColorSelectedEff=function(e){EffectFactory.get().newEffect("item_use_hint",function(t){t.scaleX=1.5,t.scaleY=1.5;var i=this.boardColors.length;t.x=112,t.y=112,t.animation.play("texiao01",-1),this.selectedColorEffGroup=this["group_"+i+"_color_select_"+e.toString()],this.selectedColorEffGroup.addChild(t),this.selectedColorEff=t}.bind(this))},t.prototype._getBaordColorCount=function(){var e=this._board.getAllElements(),t=[];return e.forEach(function(e){e.busy||0==e.color||-1!=t.indexOf(e.color)||t.push(e.color)}),t},t.prototype.setItemIconByIndex=function(e){var t=this["img_item"+e.toString()];this.checkItemIsUnlocked(e)?(t.source=this.ITEM_ICON_SOURCES[e],this["item_num_group"+e.toString()].visible=!0):(t.source="icon_lock_png",this["item_num_group"+e.toString()].visible=!1)},t.prototype.checkItemIsUnlocked=function(e){if(SelfInfo.get().isInMission)return!SelfInfo.get().missionItemLock;var t=this._bottomItemList[e],i=this.ITEM_UNLOCK_STAGE[t];return void 0==i||void 0==this.stageLevel_?!1:SelfInfo.get().getCurrentLevel()==i?GuideHelper.hasGuideForLevel(this.stageLevel_):SelfInfo.get().getCurrentLevel()>i},t.prototype.listenOnItemByIndex=function(e){var t=this;if(this.lastElementChoose&&(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0),this.canTouch&&this.itemCanTouch&&(void 0==this._item_lisenter_index||this._item_lisenter_index==e)){var i=this._bottomItemList[e],n=this._ingameItemManager.getItemById(i);if(!this.item_reach_limit[e])if(this._status==ItemConstants.NORMAL){var o=n.getTotalNum();if(0>=o){if(this._isRequestingGameBuyItem)return;return this._isRequestingGameBuyItem=!0,egret.setTimeout(function(){t._isRequestingGameBuyItem=!1},this,600),void this.selfInfo_.buyItemByID(""+i,this.stageLevel_).then(function(o){if(o&&(t.setAllItemNum(),n.getTotalNum()>0&&(t.group_item_tip.visible=!0,t.item_img.source=ItemConstants.ITEM_IMGS[e],t.item_tip.text=xyd.__(ItemConstants.ITEM_TIPS[e]),t.useItemMask(i),t._setItemMaskExcludeIndex(e),t._item_lisenter_index=e,i==ItemConstants.STICKER))){if(t.stick_choosed!=Sticker.CHOOSE_NONE)return void(t.stick_choosed=Sticker.CHOOSE_NONE);t.itemCanTouch=!1,t.show_sticker_effect()}})["catch"](function(e){return console.log(e)})}if(this.group_item_tip.visible=!0,this.item_img.source=ItemConstants.ITEM_IMGS[e],this.item_tip.text=xyd.__(ItemConstants.ITEM_TIPS[e]),this.useItemMask(i),this._setItemMaskExcludeIndex(e),this._item_lisenter_index=e,i==ItemConstants.STICKER){if(this.stick_choosed!=Sticker.CHOOSE_NONE)return void(this.stick_choosed=Sticker.CHOOSE_NONE);this.itemCanTouch=!1,this.show_sticker_effect()}}else if(this._status=ItemConstants.NORMAL,this.unuseItemMask(),this._gameView.checkPossibleMove(),i==ItemConstants.STICKER&&this.img_item3){if(this.img_item3.rotation=0,this.stick_choosed!=Sticker.CHOOSE_NONE)return void(this.stick_choosed=Sticker.CHOOSE_NONE);this.stick_show&&this.unshow_sticker_effect()}}},t.prototype.listenOnWand=function(){var e=this;if(this.lastElementChoose&&(this._gameView.unselectElement(this.lastElementChoose.x,this.lastElementChoose.y),this.lastElementChoose=void 0),this.canTouch&&this.itemCanTouch&&!(void 0!=this._item_lisenter_index&&2!=this._item_lisenter_index||this._board.getNormalElementLengthForWand()<3)){var t=this._ingameItemManager.getItemById(ItemConstants.WAND);if(!this.item_reach_limit[2]&&this._status==ItemConstants.NORMAL){var i=this._bottomItemList[2],n=t.getTotalNum();if(0>=n){if(this._isRequestingGameBuyItem)return;return this._isRequestingGameBuyItem=!0,egret.setTimeout(function(){e._isRequestingGameBuyItem=!1},this,600),void this.selfInfo_.buyItemByID(""+i,this.stageLevel_).then(function(i){i&&(e.setAllItemNum(),t.getTotalNum()>0&&(e._item_lisenter_index=2,e._gameView.clearPossibleMove(),e.setCanTouch(!1),t.inUse(),e.removeGuide(),t.activate(),e._item_lisenter_index=void 0))})["catch"](function(e){return console.log(e)})}this._item_lisenter_index=2,this._gameView.clearPossibleMove(),this.setCanTouch(!1),t.inUse(),this.removeGuide(),t.activate(),this._item_lisenter_index=void 0}}},t.prototype.choose_sticker_col=function(e){this.stick_choosed=Sticker.CHOOSE_COL,this.unshow_sticker_effect(),this.img_item3&&(this.img_item3.rotation=0)},t.prototype.choose_sticker_row=function(e){this.stick_choosed=Sticker.CHOOSE_ROW,this.unshow_sticker_effect(),void 0!=this._guide&&this._guide.canHighlightELements(!0),this.img_item3&&(this.img_item3.rotation=90)},t.prototype.playInGameAddFiveStepsAnimation=function(e){this.setCanTouch(!1);var t=new egret.Bitmap,i=new egret.Bitmap;xyd.setBitmapAsync(t,"bg_black",function(){t.height=xyd.stageHeight,t.width=xyd.stageWidth,t.alpha=.6}),xyd.setBitmapAsync(i,"icon_five_moves",function(){i.scaleX=2,i.scaleY=2,i.$anchorOffsetX=i.width/2,i.$anchorOffsetY=i.height/2}),this.addChild(t);EffectFactory.get().newEffect("win_coin_glow",function(e){var n=this;e.x=xyd.stageWidth/2,e.y=xyd.stageHeight/2,e.alpha=1,e.animation.play("texiao01",1),this.addChild(e),i.x=xyd.stageWidth/2,i.y=xyd.stageHeight/2,this.addChild(i);var o=this.step_.localToGlobal();o.x+=75,o.y+=25;var a=new Vector2(xyd.stageWidth/2,xyd.stageHeight/2),s=new Vector2(0,0);s.x=(a.x+o.x)/2+200,s.y=(a.y+o.y)/2;var r=new TimelineMax,l=20*xyd.TweenDeltaTime;r.add(TweenMax.to(e,60*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),l),r.call(function(){e.animation.stop(),n.removeChild(e),EffectFactory.get().pushBackEffect(e)}),r.add(TweenMax.to(i,l,{bezier:[{x:a.x,y:a.y},{x:s.x,y:s.y},{x:o.x,y:o.y,scaleX:.5,scaleY:.5}],ease:Power1.easeIn,autoRotate:!1}),60*xyd.TweenDeltaTime),r.call(function(){n.removeChild(t),n.removeChild(i),n.playInGameAddFiveStepsAnimation2()})}.bind(this))},t.prototype.playInGameAddFiveStepsAnimation2=function(){var e=new Vector2(0,0);e.x+=75,e.y+=25,EffectFactory.get().newEffect(EffectConstants.VIP_MOVES_GLOW,function(t){t.x=e.x,t.y=e.y,t.animation.play("texiao01",1),this.step_.addChildAt(t,0);var i=function(e){t.removeDBEventListener("complete",i,this),t.animation.stop(),this.step_.removeChild(t),t.dispose(),this.clearMouseData()};t.addDBEventListener("complete",i,this)}.bind(this));var t=this._bottomItemList[4];t!=ItemConstants.INGAME_ADD_FIVE_STEPS&&console.error("itemId 错误！！！！！");var i=this._ingameItemManager.getItemById(t);i.activate()},t.prototype.addStepAnimation=function(e){var t=this,i=this._board.getGameMode().getMovesLeft(),n=i,o=this._board.getGameMode().getMovesLeft()+e,a=this.stepNum,s=new TimelineLite;s.add(TweenLite.to(a,3*xyd.TweenDeltaTime,{scaleX:.62,scaleY:.62,ease:Linear.easeNone})),s.add(TweenLite.to(a,3*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone}));for(var r=0;o-i>r;r++)s.add(TweenLite.to(a,6*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone})),s.call(function(){n+=1,t._board.setMovesLeft(n)}),s.add(TweenLite.to(a,3*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone}));s.add(TweenLite.to(a,2*xyd.TweenDeltaTime,{scaleX:.8,scaleY:.8,ease:Linear.easeNone})),s.add(TweenLite.to(a,36*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone})),s.call(function(){t._board.saveToJson(),t.setCanTouch(!0)})},t.prototype.show_sticker_effect=function(){var e=this;this.group_item3_col.visible=!0,this.group_item3_row.visible=!0;new TimelineMax;this.stick_show=!0;var t=new TimelineLite;t.add(TweenLite.to(this.group_item3_row,6*xyd.TweenDeltaTime,{x:this.group_item3_row.x-254,ease:Power2.easeOut}),0),t.add(TweenLite.to(this.group_item3_row,12*xyd.TweenDeltaTime,{x:this.group_item3_row.x-224,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_item3_col,6*xyd.TweenDeltaTime,{y:this.group_item3_col.y-246,ease:Power2.easeOut}),0),t.add(TweenLite.to(this.group_item3_col,12*xyd.TweenDeltaTime,{y:this.group_item3_col.y-216,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),t.call(function(){if(e.label_item3_row.visible=!0,e.label_item3_col.visible=!0,0==e._guangXiaoEffectGroup.length)e._initGuangXiaoEffect();else for(var t=0,i=e._guangXiaoEffectGroup;t<i.length;t++){var n=i[t];n.animation.play("texiao01",0)}e.itemCanTouch=!0}),this.group_item3_col.addEventListener(egret.TouchEvent.TOUCH_TAP,this.choose_sticker_col,this),this.group_item3_row.addEventListener(egret.TouchEvent.TOUCH_TAP,this.choose_sticker_row,this)},t.prototype.unshow_sticker_effect=function(){var e=this;if(this._guangXiaoEffectGroup.length>0)for(var t=0,i=this._guangXiaoEffectGroup;t<i.length;t++){var n=i[t];n.animation&&n.animation.stop()}void 0!=this._guide&&(this._guide.canHighlightELements(!1),this._guide.showGuideUI(!1)),this.label_item3_row.visible=!1,this.label_item3_col.visible=!1,this.itemCanTouch=!1;var o=new TimelineLite;o.add(TweenLite.to(this.group_item3_row,10*xyd.TweenDeltaTime,{x:this.group_item3_row.x+224}),0),o.add(TweenLite.to(this.group_item3_col,10*xyd.TweenDeltaTime,{y:this.group_item3_col.y+218}),0),o.call(function(){e.group_item3_col.visible=!1,e.group_item3_row.visible=!1,e.itemCanTouch=!0}),this.stick_show=!1,this.group_item3_col.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.choose_sticker_col,this),this.group_item3_row.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.choose_sticker_row,this)},t.prototype._initGuangXiaoEffect=function(){EffectFactory.get().newEffect("guangxiao",function(e){e.x+=this.group_item3_row.width/2+10,e.y+=this.group_item3_row.height/2-4,e.scaleX/=.9,e.scaleY/=.9,e.animation.play("texiao01",0),this.group_item3_row.addChild(e),this._guangXiaoEffectGroup.push(e)}.bind(this)),EffectFactory.get().newEffect("guangxiao",function(e){e.x+=this.group_item3_col.width/2+8,e.y+=this.group_item3_col.height/2-4,e.scaleX/=.9,e.scaleY/=.9,e.animation.play("texiao01",0),this.group_item3_col.addChild(e),this._guangXiaoEffectGroup.push(e)}.bind(this))},t.prototype._setItemMaskExcludeIndex=function(e){for(var t=0;t<this.group_items.length;t++)t!=e&&(this.group_items[t].filters=[xyd.useItemFilter]);this.setting_btn.filters=[xyd.useItemFilter]},t.prototype._clearItemMask=function(){for(var e=0;e<this.group_items.length;e++)this.group_items[e].filters=[];this.setting_btn.filters=[]},t.prototype.dispose=function(){this._removeEvents(),this.removeGuide(),this._headtimer&&egret.clearTimeout(this._headtimer);for(var t=0,i=this.labelItemNum;t<i.length;t++){var n=i[t];n&&xyd.bitmapNumber.destroyNumPic(n)}if(this.scoreNum&&xyd.bitmapNumber.destroyNumPic(this.scoreNum),this.stepNum&&xyd.bitmapNumber.destroyNumPic(this.stepNum),this.stageNum&&xyd.bitmapNumber.destroyNumPic(this.stageNum),this._guangXiaoEffectGroup.length>0){for(var o=0,a=this._guangXiaoEffectGroup;o<a.length;o++){var s=a[o];s.dispose()}this._guangXiaoEffectGroup=[]}this._headEff&&(this._headEff.animation.stop(),this._headEff.parent&&this._headEff.parent.removeChild(this._headEff),this._headEff.dispose(),this._headEff=void 0),this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerCallback,this),this.timer.stop(),this.timer=void 0),this._item4BubbleTimer&&(this._item4BubbleTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._onITem4BubbleTimerComplate,this),this._item4BubbleTimer.stop(),this._item4BubbleTimer=void 0),this.fiveItemTimeMax&&(this.fiveItemTimeMax.stop(),this.fiveItemTimeMax.kill(),this.fiveItemTimeMax=void 0),this._fundAmount&&(this._fundAmount.getChildAt(0)&&(this._fundAmount.getChildAt(0).y=0),xyd.bitmapNumber.destroyNumPic(this._fundAmount)),this._realseItemHintAnimation(!0),this._releaseItemGirdHintAnimation(!0),EffectFactory.get().cleanUp(),this.touchArea_&&this.touchArea_.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onOutside,this),this._settingBgGroup&&this._settingBgGroup.removeEventListener(egret.TouchEvent.TOUCH_END,this.onSetting,this),e.prototype.dispose.call(this)
},t.prototype.useItemMask=function(e){e!=GameWindowConstants.COLOR_LINE_BOMB_PACK&&e!=GameWindowConstants.COLOR_SQUARE_BOMB_PACK?this._gameView.useItemMask(!0):this._item4_mask.visible=!0,this._gameView.clearPossibleMove(),this.setStatus(e),e==GameWindowConstants.HAMMER&&1==this._showItemHint&&this._showHammerGridHintEffect(),void 0!=this._guide&&e!=ItemConstants.ROCKET&&(this._guide.isItemGuide()&&this._guide.getItemID()!=ItemConstants.STICKER&&this._guide.canHighlightELements(!0),this._guide.showGuideUI(!1),this._gameView.useItemMask(!1))},t.prototype._showHammerGridHintEffect=function(){if(this._itemGridHintPos){var e=this._gameView.logicToView(this._itemGridHintPos);EffectFactory.get().newEffect("item_grid_hint",function(t){t.x=e.x,t.y=e.y,this.beltLayer.addChild(t),t.animation.play("texiao01",0),this._itemGridHintEff=t}.bind(this))}},t.prototype.unuseItemMask=function(){this._gameView.useItemMask(!1),this._item_lisenter_index=void 0,this.group_item_tip.visible=!1,this._clearItemMask(),this._releaseItemGirdHintAnimation(),this._status=ItemConstants.NORMAL,void 0!=this._guide&&(this._guide.canHighlightELements(!1),this._guide.showGuideUI(!0))},t.prototype.releaseRocketMask=function(e){var t=e.data.from;this.unuseItemMask(),this._gameView.unselectElement(t.x,t.y)},t.prototype.getGuide=function(){return this._guide},t.prototype.setGuide=function(e){this._guide&&this.removeGuide(),this._guide=new Guide(this,this._gameView,e,this._boardScale),this.guide_area.addChild(this._guide),1==this._settingState&&this.onSetting()},t.prototype.removeGuide=function(){this._guide&&(this._guide.close(),this._guide=void 0)},t.prototype.onBtnQuestion=function(){var e={stage:this._board.getGameConf().totalLevel,setting_type:"tip"};Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_SETTING_BTN_CLICK,e,!0),platform.callMethod("SHOW_RULES_WINDOW",{}),this.onSetting()},t.prototype.onBtnExit=function(){var e={stage:this._board.getGameConf().totalLevel,setting_type:"close"};Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_SETTING_BTN_CLICK,e,!0),xyd.WindowManager.get().openWindow("exit_comfirm_window",{stageLevel:this.stageLevel_})},t.prototype.onSoundEffect=function(){var e={stage:this._board.getGameConf().totalLevel,setting_type:"sound_effect"};Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_SETTING_BTN_CLICK,e,!0);var t=SoundManager.getInstance(),i=t.getEffectOn();i?(t.setEffectOn(!1),SelfInfo.get().setSoundEffect(!1),this.sound_eff_disable.visible=!0):(t.setEffectOn(!0),SelfInfo.get().setSoundEffect(!0),this.sound_eff_disable.visible=!1)},t.prototype.onSoundBg=function(){var e={stage:this._board.getGameConf().totalLevel,setting_type:"sound_bg"};Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_IN_GAME_SETTING_BTN_CLICK,e,!0);var t=SoundManager.getInstance(),i=t.getBgOn();i?(t.setBgOn(!1),SelfInfo.get().setSoundBg(!1),this.sound_bg_disable.visible=!0):(t.setBgOn(!0),SelfInfo.get().setSoundBg(!0),this.sound_bg_disable.visible=!1)},t.prototype.onItem4Bubble=function(){this._status!=ItemConstants.NORMAL||this._gameView.getCurrentGuideID()>0||(this._group_item4_bubble_bg.touchEnabled=!1,this.group_item4_bubble.visible&&(this.group_item4_bubble.visible=!1))},t.prototype.onSetting=function(){this._status!=ItemConstants.NORMAL||this._gameView.getCurrentGuideID()>0||this._settingCanTouch&&(1==this._settingState?(this._settingCanTouch=!1,this._strongRemider?this.hideSettingRemider():this.hideSetting(),this._settingState=0):(this._settingCanTouch=!1,this._strongRemider?this.showSettingRemider():this.showSetting(),this._settingState=1))},t.prototype.hideSetting=function(){var e=this;this.bg_shezhi.visible=!0,SelfInfo.get().isInMission?this.bg_shezhi.scaleY=.8:this.bg_shezhi.scaleY=1,this._settingBgGroup.touchEnabled=!1,this.group_sound_bg.visible=!0,this.group_sound_bg.verticalCenter=this.setting_btn.verticalCenter-120,this.group_sound_effect.visible=!0,this.group_sound_effect.verticalCenter=this.setting_btn.verticalCenter-240,SelfInfo.get().isInMission?(this.group_exit.visible=!0,this.group_exit.verticalCenter=this.setting_btn.verticalCenter-360):(this.group_question.visible=!0,this.group_question.verticalCenter=this.setting_btn.verticalCenter-360,this.group_exit.visible=!0,this.group_exit.verticalCenter=this.setting_btn.verticalCenter-480);var t=new TimelineLite;t.add(TweenLite.to(this.group_sound_bg,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_sound_effect,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),SelfInfo.get().isInMission?t.add(TweenLite.to(this.group_exit,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0):(t.add(TweenLite.to(this.group_question,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_exit,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0)),t.add(TweenLite.to(this.bg_shezhi,10*xyd.TweenDeltaTime,{alpha:0,scaleY:0,ease:Linear.easeNone}),0),t.call(function(){e.group_sound_bg.visible=!1,e.group_sound_effect.visible=!1,e.group_question.visible=!1,e.group_exit.visible=!1,e.sound_eff_disable.visible=!1,e.sound_bg_disable.visible=!1}),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:.9,scaleY:1.05,ease:Linear.easeNone}),10*xyd.TweenDeltaTime),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:.9,ease:Linear.easeNone}),12*xyd.TweenDeltaTime),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),14*xyd.TweenDeltaTime),t.call(function(){e._settingCanTouch=!0})},t.prototype.showSetting=function(){var e=this;this._settingBgGroup.touchEnabled=!0,this.bg_shezhi.visible=!0,this.bg_shezhi.scaleY=.3,this.bg_shezhi.alpha=0,this.group_sound_bg.visible=!0,this.group_sound_bg.verticalCenter=this.setting_btn.verticalCenter,this.group_sound_bg.scaleX=.8,this.group_sound_bg.scaleY=.8,this.group_sound_effect.visible=!0,this.group_sound_effect.verticalCenter=this.setting_btn.verticalCenter,this.group_sound_effect.scaleX=.8,this.group_sound_effect.scaleY=.8,this.group_question.visible=!0,this.group_question.verticalCenter=this.setting_btn.verticalCenter,this.group_question.scaleX=.8,this.group_question.scaleY=.8;var t=void 0;SelfInfo.get().isInMission&&(this.group_question.visible=!1,t=.8),this.group_exit.visible=!0,this.group_exit.verticalCenter=this.setting_btn.verticalCenter,this.group_exit.scaleX=.8,this.group_exit.scaleY=.8;var i=SoundManager.getInstance(),n=i.getEffectOn();n?this.sound_eff_disable.visible=!1:this.sound_eff_disable.visible=!0;var o=i.getBgOn();o?this.sound_bg_disable.visible=!1:this.sound_bg_disable.visible=!0;var a=new TimelineLite;this.bg_shezhi.alpha=.33,a.add(TweenLite.to(this.bg_shezhi,2*xyd.TweenDeltaTime,{alpha:1,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.bg_shezhi,6*xyd.TweenDeltaTime,{scaleY:(t||1)+.07,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.bg_shezhi,9*xyd.TweenDeltaTime,{scaleY:t||1,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_sound_bg,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-130,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_sound_effect,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-260,ease:Power2.easeOut}),0),SelfInfo.get().isInMission?a.add(TweenLite.to(this.group_exit,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-390,ease:Power2.easeOut}),0):(a.add(TweenLite.to(this.group_question,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-390,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_exit,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-520,ease:Power2.easeOut}),0)),a.add(TweenLite.to(this.group_sound_bg,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-120,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_sound_effect,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-240,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),SelfInfo.get().isInMission?a.add(TweenLite.to(this.group_exit,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-360,ease:Power2.easeOut}),6*xyd.TweenDeltaTime):(a.add(TweenLite.to(this.group_question,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-360,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_exit,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-480,ease:Power2.easeOut}),6*xyd.TweenDeltaTime)),a.call(function(){e._settingCanTouch=!0})},t.prototype.getStatus=function(){return this._status},t.prototype.clearMouseData=function(){this.lastMousePos=void 0,this.curMousePos=void 0,this.lastLogicPoint=void 0},t.prototype.touchAble=function(){return this.canTouch},t.prototype.isGameOver=function(){return this._gameOver},t.prototype.useItemReachLimitById=function(e){if(this.inf_items&&platform.inDebugMode()){var t=this.bottomItemListMap[e];return this.item_reach_limit[t]=!1,void(this.item_reach_limit_img[t].visible=!1)}var i=this.bottomItemListMap[e];this.item_reach_limit[i]=!0,this.item_reach_limit_img[i].visible=!0},t.prototype.useItemById=function(e){var t=this._ingameItemManager.getItemById(e),i=this.bottomItemListMap[e];this.selfInfo_;this._board.increaseItemUsedCount(i),this.expired_time_cache[i]=void 0;var n=t.getTotalNum();this.setItemNumByIndex(i,n),void 0!=this._guide&&(this.removeGuide(),this._gameView.tryNextGuide())},t.prototype.timerCallback=function(){for(var e=Math.ceil((new Date).getTime()/1e3),t=0;t<this._bottomItemList.length;t++)this.timerHelper(t,e)},t.prototype.timerHelper=function(e,t){var i=this.expired_time_cache[e];if(void 0==i||0>=i-t){var n=this.selfInfo_,o=this._bottomItemList[e],a=String(this._bottomItemList[e]),s=String(this._bottomItemList[e]+ItemConstants.LIMITED_TIME_OFFSET),r=String(this._bottomItemList[e]+ItemConstants.UNLIMITED_TIME_OFFSET),l=(n.getItemNumByID(a),n.getItemNumByID(s)),_=n.getItemNumByID(r),h=this._ingameItemManager.getItemById(o);if(void 0!=_&&_>0)return this.hasTimerOnItem[e]||(this.timer_group[e].visible=!0,this.timer_img[e].source="bg_unlimited_daojishi_png",this.time_limited_img[e].source="icon_unlimited_subscript_png",this.hasTimerOnItem[e]=!0),i=n.getItemExpireTimeByID(r),this.expired_time_cache[e]=i,void this.updateItemCountByIndex(e,h.getTotalNum());if(!l||0>=l)return this.timer_group[e].visible=!1,this.timer_img[e].source="bg_xianshidaoju_png",this.time_limited_img[e].source="icon_shuliang_png",this.hasTimerOnItem[e]=!1,this.updateItemCountByIndex(e,h.getTotalNum()),void(this.expired_time_cache[e]=void 0);this.timer_img[e].source="bg_xianshidaoju_png",this.time_limited_img[e].source="icon_xianshi_png",this.hasTimerOnItem[e]=!0,i=n.getItemExpireTimeByID(s),this.expired_time_cache[e]=i,this.updateItemCountByIndex(e,h.getTotalNum())}var c=i-t;this.timer_label[e].text=xyd.secondsToTimeString(c)},t.prototype.updateItemCountByIndex=function(e,t){var i=this.labelItemNum[e];if(void 0!=i){var n;n=this.timer_group[e].visible?"non_m_":"non_l_",xyd.bitmapNumber.changeNum(i,t,n),this.setItemNumByIndex(e,t)}},t.prototype.shakeBoard=function(e){this.shakeTween&&this.shakeTween.kill(),this.shakeTween=new TimelineLite;var t=1;this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X-1*e,y:this.GROUP_BOARD_Y-2*e}),0*t*xyd.TweenDeltaTime),this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X+1*e,y:this.GROUP_BOARD_Y+2*e}),1*t*xyd.TweenDeltaTime),this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X-1*e,y:this.GROUP_BOARD_Y-2*e}),2*t*xyd.TweenDeltaTime),this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X+1*e,y:this.GROUP_BOARD_Y+2*e}),3*t*xyd.TweenDeltaTime),this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X-1*e,y:this.GROUP_BOARD_Y-2*e}),4*t*xyd.TweenDeltaTime),this.shakeTween.add(TweenLite.to(this.group_board,t*xyd.TweenDeltaTime,{x:this.GROUP_BOARD_X,y:this.GROUP_BOARD_Y}),5*t*xyd.TweenDeltaTime)},t.prototype._getRandomShakeDistance=function(e){var t=1;return t+Math.random()*t},t.prototype.getCollectNum=function(e){return this._board.getCollectNum(e)},t.prototype.getBottomItemGroup=function(e){return e==ItemConstants.WAND?this.group_bottom.getChildAt(2):e==ItemConstants.HAMMER?this.group_bottom.getChildAt(0):e==ItemConstants.STICKER?void 0!=this._guide&&this._guide.isItemGuide()?this.group_item3_row:this.group_bottom.getChildAt(3):e==ItemConstants.SWAPPER?this.group_bottom.getChildAt(1):void 0},t.prototype.setBottomItemInUse=function(e){e==ItemConstants.WAND&&(this._item_lisenter_index=2)},t.prototype.clearBottmItemInUse=function(){this._item_lisenter_index=void 0},t.prototype.getItemByID=function(e){return this._ingameItemManager.getItemById(e)},t.prototype.updateItemCountByID=function(e){var t=this._ingameItemManager.getItemById(e),i=this.bottomItemListMap[e];t&&void 0!=i&&this.updateItemCountByIndex(i,t.getTotalNum())},t.prototype._useHammerHint=function(e){if(this.checkItemIsUnlocked(0)){var t=this.bottomItemListMap[ItemConstants.HAMMER];if(!this.item_reach_limit[t]){var i=e.data.x,n=e.data.y;this._itemGridHintPos=new egret.Point(i,n),this._itemHintAnimation(this.group_item0),this._itemHintGroupIndex=t}}},t.prototype._useWandHint=function(e){if(this.checkItemIsUnlocked(2)){var t=this.bottomItemListMap[ItemConstants.WAND];this.item_reach_limit[t]||(this._wandHintAnimation(this.group_item2),this._itemHintGroupIndex=t)}},t.prototype._wandHintAnimation=function(e){if(!this._showWandHint){this._showWandHint=!0;e.localToGlobal();EffectFactory.get().newEffect("item_use_hint",function(t){t.x+=.88*e.width/2,t.y+=e.height/2,t.animation.play("texiao01",0),e.addChildAt(t,3),this._wandHintEff=t}.bind(this))}},t.prototype._itemHintAnimation=function(e){if(!this._showItemHint){this._showItemHint=!0;e.localToGlobal();EffectFactory.get().newEffect("item_use_hint",function(t){t.x+=.88*e.width/2,t.y+=e.height/2,t.animation.play("texiao01",0),e.addChildAt(t,3),this._itemHintEff=t}.bind(this))}},t.prototype._releaseItemGirdHintAnimation=function(e){void 0===e&&(e=!1),this._itemGridHintEff&&(this._itemGridHintEff.animation.stop(),this.beltLayer.removeChild(this._itemGridHintEff),0==e&&EffectFactory.get().pushBackEffect(this._itemGridHintEff),this._itemGridHintEff=void 0)},t.prototype._realseItemHintAnimation=function(e){void 0===e&&(e=!1),(this._showItemHint||this._showWandHint)&&(this._itemHintTween&&(this._itemHintTween.kill(),this._itemHintTween=void 0,this.group_items[this._itemHintGroupIndex].scaleX=this.ITEM_GROUP_SCALE,this.group_items[this._itemHintGroupIndex].scaleY=this.ITEM_GROUP_SCALE),this._itemHintEff&&(this._itemHintEff.animation.stop(),this._itemHintEff.parent&&this._itemHintEff.parent.removeChild(this._itemHintEff),0==e&&EffectFactory.get().pushBackEffect(this._itemHintEff),this._itemHintEff=void 0),this._wandHintEff&&(this._wandHintEff.animation.stop(),this._wandHintEff.parent&&this._wandHintEff.parent.removeChild(this._wandHintEff),0==e&&EffectFactory.get().pushBackEffect(this._wandHintEff),this._wandHintEff=void 0),this._itemGridHintPos&&(this._itemGridHintPos=void 0),this._releaseItemGirdHintAnimation(),this._showItemHint=!1,this._showWandHint=!1)},t.prototype.onWindowOpen=function(e){e.data&&("pre_game_window"==e.data.windowName||"win_game_window"==e.data.windowName||"cooking_window"==e.data.windowName||"end_game_window"==e.data.windowName)&&this._hideAllIcons()},t.prototype.onH5InGameWindow=function(e){e.data&&e.data.window_name&&(this._h5InGameWindows[e.data.window_name]?0==e.data.window_state&&(this._h5InGameWindows[e.data.window_name]=!1,this._showAllIcons()):1==e.data.window_state&&(this._h5InGameWindows[e.data.window_name]=!0,this._hideAllIcons()))},t.prototype._hideAllIcons=function(){this.group_top.visible=!1,this.setting_group.visible=!1,this.group_bottom.visible=!1,xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.BOARD_RELEASE_ITEM_HINT_ANIMATION))},t.prototype._showAllIcons=function(){this.group_top.visible=!0,this.setting_group.visible=!0,this.group_bottom.visible=!0},t.prototype.updateFPS=function(e,t,i){this.fps_label.text="FPS: "+e+" AVG: "+t+"\n"+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "},t.prototype.setAnnaHead=function(){xyd.isLowEndDevice||EffectFactory.get().newEffect("touxiang",function(e){this._annahead.visible=!1,this._annaheadbg.visible=!1,e.animation.play("idle",-1),this.head.addChild(e),this._headEff=e,e.scaleX=.5,e.scaleY=.5,e.x=this.head.width/2,e.y=180+this.head.height/2,e.mask=this._headmask,this.headState=1,this.headtimer=egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ANNA_HEAD_STATE,!1,!1,2))},this,5e3)}.bind(this))},t.prototype.setFund=function(e){this._annahead.visible=!1,this._fundHead.visible=!0,this.fundNum=e,this._fundAmount=xyd.bitmapNumber.createNumPicWithPunctuation("x"+e.toString(),"non_11_"),this._fundAmount.getChildAt(0)&&(this._fundAmount.getChildAt(0).y=5),xyd.anchorCenter(this._fundAmount),this.head.addChild(this._fundAmount),xyd.bitmapNumber.setNumGap(this._fundAmount,-10),this._fundAmount.y=150,this._fundAmount.x=this.head.width/2},t.prototype.fundSet=function(e){this._fundAmount&&(this.fundNum=e,xyd.bitmapNumber.changeNumWithPunctuation(this._fundAmount,"x"+e.toString(),"non_11_"),xyd.bitmapNumber.setNumGap(this._fundAmount,-10),xyd.anchorCenter(this._fundAmount),this._fundAmount.y=150,this._fundAmount.x=this.head.width/2)},t.prototype.annaHeadState=function(e){var t,i=e.data;if(this._headEff){var n=function(e){this._headEff.removeDBEventListener("complete",this._headCallback,this),this._headCallback=void 0,this._headEff.animation.play("idle",-1),this.headState=1,this._headtimer&&egret.clearTimeout(this._headtimer),this._headtimer=egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ANNA_HEAD_STATE,!1,!1,2))},this,6e3)}.bind(this);if(4==i){if(4==this.headState)return;t="encourage"}if(3==i){if(this.headState>2)return;t="praise"}if(2==i){if(this.headState>1)return;if(this._board.getGameMode().getMovesLeft()<=3)return this._headtimer&&egret.clearTimeout(this._headtimer),void(this._headtimer=egret.setTimeout(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.ANNA_HEAD_STATE,!1,!1,2))},this,6e3));t="smile"}this._headEff.animation.reset(),this._headEff.animation.play(t,1),this._headCallback&&this._headEff.removeDBEventListener("complete",this._headCallback,this),this._headCallback=n,this._headEff.addDBEventListener("complete",this._headCallback,this),this.headState=i}},t.prototype.setpAnimation=function(){var e=this,t=this._board.getGameMode().getMovesLeft(),i=t,n=this._board.getGameMode().getMovesLeft()+SelfInfo.get().vipExtraStep,o=this.stepNum,a=new TimelineLite;a.add(TweenLite.to(o,3*xyd.TweenDeltaTime,{scaleX:.62,scaleY:.62,ease:Linear.easeNone})),a.add(TweenLite.to(o,3*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone}));for(var s=0;n-t>s;s++)a.add(TweenLite.to(o,10*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone})),a.call(function(){i+=1,e._board.setMovesLeft(i)}),a.add(TweenLite.to(o,5*xyd.TweenDeltaTime,{scaleX:1.6,scaleY:1.6,ease:Linear.easeNone}));a.add(TweenLite.to(o,2*xyd.TweenDeltaTime,{scaleX:.8,scaleY:.8,ease:Linear.easeNone})),a.add(TweenLite.to(o,36*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone})),a.call(function(){e._board.saveToJson(),e.setCanTouch(!0)})},t.prototype.onBtnRemainder=function(){var e=this,t=SelfInfo.get().getStrongReminder(),i=!t;SelfInfo.get().setStrongReminder(t).then(function(t){t.success&&(e.remider_disable.visible=!i,SelfInfo.get().setStrongReminderLocal(i))})["catch"](function(e){return logger.error(e)})},t.prototype.hideSettingRemider=function(){var e=this;this.bg_shezhi.visible=!0,this.bg_shezhi.scaleY=this._strongRemiderScale,this._settingBgGroup.touchEnabled=!1,this.group_sound_bg.visible=!0,this.group_sound_bg.verticalCenter=this.setting_btn.verticalCenter-120,this.group_sound_effect.visible=!0,this.group_sound_effect.verticalCenter=this.setting_btn.verticalCenter-240,this.group_question.visible=!0,this.group_question.verticalCenter=this.setting_btn.verticalCenter-360,this.group_remider.visible=!0,this.group_remider.verticalCenter=this.setting_btn.verticalCenter-480,this.group_exit.visible=!0,this.group_exit.verticalCenter=this.setting_btn.verticalCenter-600;var t=new TimelineLite;t.add(TweenLite.to(this.group_sound_bg,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_sound_effect,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_question,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_remider,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_exit,10*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.bg_shezhi,10*xyd.TweenDeltaTime,{alpha:0,scaleY:0,ease:Linear.easeNone}),0),t.call(function(){e.group_sound_bg.visible=!1,e.group_sound_effect.visible=!1,e.group_question.visible=!1,e.group_remider.visible=!1,e.group_exit.visible=!1,e.sound_eff_disable.visible=!1,e.sound_bg_disable.visible=!1}),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:.9,scaleY:1.05,ease:Linear.easeNone}),10*xyd.TweenDeltaTime),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:.9,ease:Linear.easeNone}),12*xyd.TweenDeltaTime),t.add(TweenLite.to(this.setting_btn,2*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),14*xyd.TweenDeltaTime),t.call(function(){e._settingCanTouch=!0})},t.prototype.showSettingRemider=function(){var e=this;this._settingBgGroup.touchEnabled=!0,this.bg_shezhi.visible=!0,this.bg_shezhi.scaleY=.3,this.bg_shezhi.alpha=0,this.group_sound_bg.visible=!0,this.group_sound_bg.verticalCenter=this.setting_btn.verticalCenter,this.group_sound_bg.scaleX=.8,this.group_sound_bg.scaleY=.8,this.group_sound_effect.visible=!0,this.group_sound_effect.verticalCenter=this.setting_btn.verticalCenter,this.group_sound_effect.scaleX=.8,this.group_sound_effect.scaleY=.8,this.group_question.visible=!0,this.group_question.verticalCenter=this.setting_btn.verticalCenter,this.group_question.scaleX=.8,this.group_question.scaleY=.8,this.group_exit.visible=!0,this.group_exit.verticalCenter=this.setting_btn.verticalCenter,this.group_exit.scaleX=.8,this.group_exit.scaleY=.8,this.group_remider.visible=!0,this.group_remider.verticalCenter=this.setting_btn.verticalCenter,this.group_remider.scaleX=.8,this.group_remider.scaleY=.8;var t=SoundManager.getInstance(),i=t.getEffectOn();i?this.sound_eff_disable.visible=!1:this.sound_eff_disable.visible=!0;var n=t.getBgOn();n?this.sound_bg_disable.visible=!1:this.sound_bg_disable.visible=!0;var o=SelfInfo.get().getStrongReminder();o?this.remider_disable.visible=!1:this.remider_disable.visible=!0;var a=new TimelineLite;this.bg_shezhi.alpha=.33,a.add(TweenLite.to(this.bg_shezhi,2*xyd.TweenDeltaTime,{alpha:1,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.bg_shezhi,6*xyd.TweenDeltaTime,{scaleY:this._strongRemiderScale+.07,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.bg_shezhi,9*xyd.TweenDeltaTime,{scaleY:this._strongRemiderScale,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_sound_bg,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-130,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_sound_effect,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-260,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_question,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-390,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_remider,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-520,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_exit,6*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-650,ease:Power2.easeOut}),0),a.add(TweenLite.to(this.group_sound_bg,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-120,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_sound_effect,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-240,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_question,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-360,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_remider,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-480,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.add(TweenLite.to(this.group_exit,9*xyd.TweenDeltaTime,{verticalCenter:this.setting_btn.verticalCenter-600,ease:Power2.easeOut}),6*xyd.TweenDeltaTime),a.call(function(){e._settingCanTouch=!0})},t.prototype._canShowFiveItem=function(){return this._board.getGameConf().totalLevel>10},t.prototype._checkLastFiveRemainMoves=function(e){var t=e.data.step;this._board.getLastExplodeState()||5>=t&&this.fiveItemAppearAnimation()},t.prototype.getFundHead=function(){return this._fundHead},t.prototype.changeBoardElementToSpecialDrop=function(e,t){var i=this._board.getElementAtGrid(e,t);if(i&&!i.getSpecialDrop()){var n=this._board.getElementFactory().create(i.col,i.row,i.color,ElementTypeConstants.NORMAL);n.getSpecialDrop()||(n.setSpecialDrop(!0),this._board.replaceBoardElement(n))}},t.INGAME_ITEM_NUM=5,t.TOP_UI_HEIGHT=270,t.BOTTOM_UI_HEIGHT=220,t.MAX_BOARD_HEIGHT=1160,t}(BaseWindow);__reflect(GameWindow.prototype,"GameWindow");var ItemLockWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingTimelines=[],n.skinName="resource/skins/ItemLockWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.UIAnimation()},t.prototype.initUIComponent=function(){xyd.setNormalBtnBehavior(this.group_close,this,this.onBtnExit),this.bg_exit_.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExit,this)},t.prototype.UIAnimation=function(){var e=this.group_all.verticalCenter;this.group_all.verticalCenter=e-1444;var t=new TimelineMax;this._usingTimelines.push(t),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_all,3*xyd.TweenDeltaTime,{verticalCenter:e+86,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),7*xyd.TweenDeltaTime)},t.prototype.onBtnExit=function(){TweenLite.killTweensOf(this.group_all);var e=new TimelineLite;this._usingTimelines.push(e),e.add(TweenLite.to(this.group_all,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),egret.setTimeout(function(){xyd.WindowManager.get().closeWindow("item_lock_window")},this,5e3*xyd.TweenDeltaTime)},t.prototype.dispose=function(){for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}TweenLite.killTweensOf(this.group_all),e.prototype.dispose.call(this)},t}(BaseWindow);__reflect(ItemLockWindow.prototype,"ItemLockWindow");var ItemRewardWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._display=[],n._bagX=xyd.getWidth()-200,n._bagY=xyd.getHeight()/2+500,n._animationCenterX=xyd.getWidth()/2,n._animationCenterY=xyd.getHeight()/2+200,n._distance=600,n._displayTargetLabel=[],n._tw=[],n._twAnimtions=[],n._from="",n.skinName="resource/skins/ItemRewardWindowSkin.exml",n._params=i,i&&i.onComplete&&(n._callBack=i.onComplete),i&&i.items&&(n._items=i.items),i&&i.from&&(n._from=i.from),i&&i.progress&&(n._progress=i.progress),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent()},t.prototype.initUIComponent=function(){var e=this,t=!1;"quest"==this._from&&100==this._progress&&(t=!0,EffectFactory.get().newEffect("text_end_day",function(e){return this.isDisposed_?void EffectFactory.get().pushBackEffect(e):(this._textEff=e,e.x=this._animationCenterX,e.y=this._animationCenterY-400,this.addChildAt(e,2),void e.animation.play("texiao",1))}.bind(this))),DisplayConstants.get();var i=function(e){var t=n._items[e],i=DisplayConstants.ItemSourceMap[e];if(!i||0>=t)return"continue";var o=new egret.Bitmap;xyd.setBitmapAsync(o,i,function(){o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,"icon_tili"==i&&(o.scaleX=.5,o.scaleY=.5)});var a=new egret.DisplayObjectContainer;a.x=n._animationCenterX,a.y=n._animationCenterY,a.addChild(o),a.visible=!1;var s=Number(e),r=0;if(1012==s?r=30:1014==s?r=1:1015==s?r=2:s>1999&&3e3>s&&(r=2),r>0){var l=new egret.Bitmap;xyd.setBitmapAsync(l,"icon_time_limit",function(){l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2}),l.x=60,l.y=40,a.addChild(l);var _=xyd.bitmapNumber.createNumPic(r,"non_d_");_.x=l.x-30,_.y=l.y-22,_.scaleX=.76,_.scaleY=.76;var h="";30==r?(_.x=l.x-50,h="text_m"):h="text_h",n._displayTargetLabel.push(_),a.addChild(_);var c=new egret.Bitmap;xyd.setBitmapAsync(c,h,function(){c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height/2}),c.x=l.x+25,c.y=l.y-2,a.addChild(c)}else{var d=xyd.bitmapNumber.createNumPic(t,"non_b_");d.scaleX=.6,d.scaleY=.6,d.x=0,1>=t?d.visible=!1:10>t?d.x=25:d.x=15,d.y=10,n._displayTargetLabel.push(d),a.addChild(d)}n.addChild(a),n._display.push(a)},n=this;for(var o in this._items)i(o);t?egret.setTimeout(function(){e.itemAnimation()},this,2e3):this.itemAnimation(),this.ok_btn.visible=!1,this.skip_btn.visible=!0,this.ok_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OKBtnClick,this),this.skip_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skipBtnClick,this)},t.prototype.OKBtnClick=function(){this.ok_btn.visible=!1,this.step2()},t.prototype.skipBtnClick=function(){SoundManager.getInstance().playEffect("se_special_gain_2_mp3"),this.skip_btn.visible=!1;for(var e=0,t=this._twAnimtions;e<t.length;e++){var i=t[e];i.stop(),i.kill()}for(var n=0,o=this._tw;n<o.length;n++){var i=o[n];i.stop(),i.kill()}this._eff&&this._eff.animation.play("texiao02",-1),this._textEff&&(this._textEff.animation.stop(),this._textEff.visible=!1),this.ok_btn.visible=!0;for(var a=20/180*Math.PI,s=0;s<this._display.length;s++){this._display[s].visible=!0,this._display[s].scaleX=1,this._display[s].scaleY=1;var i=new TimelineMax,r=-((this._display.length-1)/2)*a+s*a+Math.PI,l=Math.sin(r)*this._distance,_=Math.cos(r)*this._distance;this._display[s].x=this._animationCenterX+l,this._display[s].y=this._animationCenterY+_,i.add(TweenLite.to(this._display[s],10*xyd.TweenDeltaTime,{x:this._animationCenterX+l,y:this._animationCenterY+_+5})),i.add(TweenLite.to(this._display[s],10*xyd.TweenDeltaTime,{x:this._animationCenterX+l,y:this._animationCenterY+_})),i.repeat(-1),this._twAnimtions.push(i)}},t.prototype.itemAnimation=function(){var e=this;SoundManager.getInstance().playEffect("se_special_gain_1_mp3");var t=0;for(var i in this._items)t++;1==t&&(this._distance=460),EffectFactory.get().newEffect("day_reward_big",function(e){if(this.isDisposed_)return void EffectFactory.get().pushBackEffect(this._eff);this._eff=e,this._eff.x=this._animationCenterX,this._eff.y=this._animationCenterY,this.addChildAt(e,1),this._eff.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),this._eff.animation.play("texiao02",-1)};e.addDBEventListener("complete",t,this)}.bind(this)),this._bagImg=new egret.Bitmap,xyd.setBitmapAsync(this._bagImg,"icon_beibao",function(){e._bagImg.anchorOffsetX=e._bagImg.width/2,e._bagImg.anchorOffsetY=e._bagImg.height/2,e._bagImg.x=e._bagX,e._bagImg.y=e._bagY
}),this.addChild(this._bagImg);var n=new TimelineLite;n.add(TweenLite.to(this,30*xyd.TweenDeltaTime,{})),n.call(function(){e.step1()}),this._tw.push(n)},t.prototype.step1=function(){var e=this,t=20/180*Math.PI;SoundManager.getInstance().playEffectDelay("se_special_gain_2_mp3",300);for(var i=function(i){n._display[i].visible=!0,n._display[i].scaleX=.5,n._display[i].scaleY=.5;var o=new TimelineLite,a=new TimelineMax,s=-((n._display.length-1)/2)*t+i*t+Math.PI,r=Math.sin(s)*n._distance,l=Math.cos(s)*n._distance;o.add(TweenLite.to(n._display[i],10*xyd.TweenDeltaTime,{x:n._animationCenterX+r,y:n._animationCenterY+l,scaleX:1,scaleY:1})),o.call(function(){e.ok_btn.visible=!0,a.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l+5,scaleX:1,scaleY:1})),a.add(TweenLite.to(e._display[i],10*xyd.TweenDeltaTime,{x:e._animationCenterX+r,y:e._animationCenterY+l,scaleX:1,scaleY:1})),a.repeat(-1),e._twAnimtions.push(a)}),n._tw.push(o)},n=this,o=0;o<this._display.length;o++)i(o)},t.prototype.step2=function(){for(var e=this,t=0,i=this._twAnimtions;t<i.length;t++){var n=i[t];n.stop(),n.kill()}this.skip_btn.visible=!1;for(var o=function(t){a._display[t].visible=!0;var i=new TimelineLite;i.add(TweenLite.to(a._display[t],8*xyd.TweenDeltaTime,{x:a._animationCenterX,y:a._animationCenterY-a._distance})),i.add(TweenLite.to(a._display[t],3*t*xyd.TweenDeltaTime,{})),i.add(TweenLite.to(a._display[t],10*xyd.TweenDeltaTime,{bezier:[{x:a._animationCenterX+200,y:a._animationCenterX},{x:a._bagX,y:a._bagY}],ease:Linear.easeNone,autoRotate:!1})),i.call(function(){e._display[t].visible=!1}),i.add(TweenLite.to(a._bagImg,2*xyd.TweenDeltaTime,{scaleY:.5})),i.add(TweenLite.to(a._bagImg,2*xyd.TweenDeltaTime,{scaleY:1})),t==a._display.length-1&&i.call(function(){e.step3()}),a._tw.push(i)},a=this,s=0;s<this._display.length;s++)o(s);if(0==this._display.length)return void this.step3();if(this._eff){this._eff.animation.play("texiao03",1);var r=function(e){this._eff.removeDBEventListener("complete",r,this),this._eff.visible=!1};this._eff.addDBEventListener("complete",r,this)}},t.prototype.step3=function(){xyd.WindowManager.get().closeWindow(this)},t.prototype.willClose=function(){e.prototype.willClose.call(this),this._eff&&(this._eff.animation.stop(),this._eff.parent&&this._eff.parent.removeChild(this._eff),this._eff.dispose()),this._textEff&&(this._textEff.animation.stop(),this._textEff.parent&&this._textEff.parent.removeChild(this._textEff),this._textEff.dispose());for(var t=0,i=this._displayTargetLabel;t<i.length;t++){var n=i[t];n&&xyd.bitmapNumber.destroyNumPic(n)}},t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0,i=this._twAnimtions;t<i.length;t++){var n=i[t];n.stop(),n.kill()}this._twAnimtions=[];for(var o=0,a=this._tw;o<a.length;o++){var n=a[o];n.stop(),n.kill()}this._tw=[],this._callBack&&this._callBack()},t}(BaseWindow);__reflect(ItemRewardWindow.prototype,"ItemRewardWindow");var ItemSupplyWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;n._needBuy=!0,n._useItems=[],n._buyItems=[],n._notUse=!1,n._TEXT_BUY=xyd.__("EXCHANGE"),n._TEXT_NOT_USE=xyd.__("NOT_USE"),n._TEXT_USE_DESC=xyd.__("USE_TIPS"),n._TEXT_BUY_DESC=xyd.__("EXCHANGE_TIPS"),void 0!=i&&(n._params=i);var o=i.totalLevel||i.total_level;if(i&&o){n._gameConf=new GameConf,n._gameConf.init(o);var a=n._gameConf.pregameItemList;if(a.length<4)for(var s=0;s<4-a.length;s++)a.push(0);var r=SelfInfo.get();n.selfInfo_=r;for(var l=[],s=0;s<a.length;s++){var _=r.getItemNumByID(String(a[s]));_>0&&(n._needBuy=!1,l.push(a[s]))}if(n._needBuy){var h=xyd.random(4);n._buyItems.push(a[h-1])}else if(l.length>2){var h=xyd.generateNoneRepeatedNumTable(1,l.length,2);n._useItems.push(l[h[0]-1]),n._useItems.push(l[h[1]-1])}else n._useItems=l}return n.skinName="resource/skins/ItemSupplyWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){this.playOpenAnimation(),this.initUIComponent(),this.showItems()},t.prototype.initUIComponent=function(){this._needBuy?(this._desc.text=this._TEXT_BUY_DESC,this.group_btnuse.visible=!1,this._label_not_use.visible=!1,this.group_btnbuy.visible=!0,xyd.setDarkenBtnBehavior(this.group_btnbuy,this,this._onBuyBtnClick),xyd.setDarkenBtnBehavior(this.group_close,this,this._onBuyCloseBtnClick),this.btn_text_buy.text=ItemConstants.ITEM_PRICE[this._buyItems[0]]+this._TEXT_BUY,this._bg.height-=100,Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_ITEM_SUPPLY_BUY),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_ITEM_SUPPLY_BUY_CLOSE)):(this._desc.text=this._TEXT_USE_DESC,this.group_btnuse.visible=!0,this._label_not_use.visible=!0,this.group_btnbuy.visible=!1,this._label_not_use.textFlow=[{text:this._TEXT_NOT_USE,style:{underline:!0}}],xyd.setDarkenBtnBehavior(this.group_btnuse,this,this._onUseBtnClick),xyd.setDarkenBtnBehavior(this.group_close,this,this._onUseCloseBtnClick),this._label_not_use.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onNotUseBtnClick,this),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_ITEM_SUPPLY_USE),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_ITEM_SUPPLY_USE_CLOSE),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_ITEM_SUPPLY_NOT_USE))},t.prototype.showItems=function(){DisplayConstants.get();var e;e=this._needBuy?this._buyItems:this._useItems;for(var t=132,i=320,n=this.reward_group.width/2-(e.length-1)*i/2-t/2,o=this.reward_group.height/2-t/2,a=1;a<=e.length;a++){var s=e[a-1],r=DisplayConstants.ItemSourceMap[s]+"_png",l=new eui.Image;l.source=r,l.x=n+(a-1)*i,l.y=o,this.reward_group.addChild(l)}},t.prototype.playOpenAnimation=function(){var e=(xyd.getHeight()-1920)/2;this.main_group.y=-1370+e;var t=new TimelineLite;t.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:e}),0),t.add(TweenLite.to(this.main_group,3*xyd.TweenDeltaTime,{y:86+e}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.main_group,4*xyd.TweenDeltaTime,{y:e}),7*xyd.TweenDeltaTime)},t.prototype._onBuyCloseBtnClick=function(){Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ITEM_SUPPLY_BUY_CLOSE),this._nextStage()},t.prototype._onNotUseBtnClick=function(){Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ITEM_SUPPLY_NOT_USE),this._notUse=!0,this._nextStage()},t.prototype._onUseCloseBtnClick=function(){Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ITEM_SUPPLY_USE_CLOSE),this._nextStage()},t.prototype._onBuyBtnClick=function(){var e=this;Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ITEM_SUPPLY_BUY),this.group_btnbuy.touchEnabled=!1,platform.callMethod("GET_DIAMOND_NUM",{}).then(function(t){var i=t.diamond_num;i>=ItemConstants.ITEM_PRICE[e._buyItems[0]]?e.selfInfo_.buyItemByID(String(e._buyItems[0]),e._gameConf.totalLevel).then(function(t){t?e._nextStage(e._buyItems):e.group_btnbuy.touchEnabled=!0})["catch"](function(t){e.group_btnbuy.touchEnabled=!0,console.log(t)}):(platform.callMethod("NOT_ENOUGH_DIAMOND",{type:"game_buy_item",item_id:e._buyItems[0]})["catch"](function(e){return logger.error(e)}),e.group_btnbuy.touchEnabled=!0)})["catch"](function(t){e.group_btnbuy.touchEnabled=!0,console.log(t)})},t.prototype._onUseBtnClick=function(){Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_ITEM_SUPPLY_USE),this._nextStage(this._useItems)},t.prototype._nextStage=function(e){this.params.items=e,this.params.notUse=this._notUse,xyd.WindowManager.get().closeWindow(this),xyd.WindowManager.get().openWindow("pre_game_window",this.params)},t.prototype.willClose=function(){},t}(BaseWindow);__reflect(ItemSupplyWindow.prototype,"ItemSupplyWindow");var OpenMapPacketWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._hideEnterBtn=!1,n.skinName="resource/skins/OpenMapPacketWindowSkin.exml",n._level=i.level,n._stageMap=i.stageMap,n._levelBtn=i.levelBtn,i.hideEnterBtn&&(n._hideEnterBtn=i.hideEnterBtn),n._onCloseCallback=i.onCloseCallback,n}return __extends(t,e),t.prototype.childrenCreated=function(){this._playOpenAnimation()},t.prototype._playOpenAnimation=function(){var e=this,t=this._getPeopleCount();this._claimedNumText.text="已有"+t+"人领取";var i=(xyd.getHeight()-1920)/2;this.group_bg.y=-1370+i;var n=new TimelineLite;n.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{y:i}),0),n.add(TweenLite.to(this.group_bg,3*xyd.TweenDeltaTime,{y:86+i}),4*xyd.TweenDeltaTime),n.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{y:i}),7*xyd.TweenDeltaTime),n.call(function(){e.isDisposed_||e.initUIComponent()})},t.prototype.initUIComponent=function(){this._hideEnterBtn?this._enterBtn.visible=!1:(this._enterBtn.visible=!0,xyd.setDarkenBtnBehavior(this._enterBtn,this,this._onEnterBtnClick)),xyd.setDarkenBtnBehavior(this._closeBtn,this,this._onCloseBtnClick),xyd.setDarkenBtnBehavior(this._shareBtn,this,this._onShareBtnClick)},t.prototype._onCloseBtnClick=function(){this._disableTouch(),xyd.WindowManager.get().closeWindow(this)},t.prototype._onShareBtnClick=function(){var e=this;this._disableTouch(),SelfInfo.get().claimPacket(this._level).then(function(e){e?(xyd.WindowManager.get().closeWindow(this),this._level&&this._stageMap&&this._stageMap.iconClose(this._level)):this._enableTouch()}.bind(this))["catch"](function(t){e._enableTouch()})},t.prototype._onEnterBtnClick=function(){this._disableTouch(),xyd.WindowManager.get().closeWindow(this),this._stageMap&&this._stageMap.enterStage(this._level)},t.prototype._enableTouch=function(){this._closeBtn.touchEnabled=!0,this._shareBtn.touchEnabled=!0,this._enterBtn.touchEnabled=!0},t.prototype._disableTouch=function(){this._closeBtn.touchEnabled=!1,this._shareBtn.touchEnabled=!1,this._enterBtn.touchEnabled=!1},t.prototype.willClose=function(){e.prototype.willClose.call(this),this._onCloseCallback&&this._onCloseCallback()},t.prototype._getPeopleCount=function(){var e=new Date("2018/12/02").getTime(),t=Date.now(),i=Math.floor((t-e)/1e3/60/60/24);return Math.round(997+Math.pow(i,.75)/(2+this._level/5)*1e4)},t}(BaseWindow);__reflect(OpenMapPacketWindow.prototype,"OpenMapPacketWindow");var PacketGuideWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._packetPosMap=(o={},o[2]={x:780,y:581,stage:0},o[6]={x:543,y:1027,stage:300},o[10]={x:552,y:1033,stage:800},o),n._defaultPacketPos={x:765,y:256,stage:0},n._packetOffset={x:0,y:0},n._chickOffset={x:-333,y:150},n._fingerOffset={x:67,y:-11},n.skinName="resource/skins/PacketGuideWindowSkin.exml",n._level=i.level,n._stageMap=i.stageMap,n._onComplete=i.onComplete,n;var o}return __extends(t,e),t.prototype.childrenCreated=function(){this.initUIComponent()},t.prototype.initUIComponent=function(){var e=this,t=this._packetPosMap[this._level];if(void 0==t&&(t=this._defaultPacketPos),this._stageMap&&this._stageMap.setScrollDistance(t.stage),t.x+=this._packetOffset.x,t.y+=this._packetOffset.y,this._redPacket.x=t.x,this._redPacket.y=xyd.getHeight()-t.y,this._fingerHolder.x=t.x+this._fingerOffset.x,this._fingerHolder.y=this._redPacket.y-this._fingerOffset.y,t.y<xyd.getHeight()/2?this._guideBanner.y=300:this._guideBanner.y=xyd.getHeight()-622,this._chickHolder.x=t.x+this._chickOffset.x,this._chickHolder.y=this._redPacket.y+this._chickOffset.y,this._level>2){var i=new TimelineLite;i.add(TweenLite.fromTo(this._redPacket,1,{scaleX:1,scaleY:1},{scaleX:2.8,scaleY:2.8})),i.call(function(){e._clickGroup.touchEnabled=!1,xyd.setDarkenBtnBehavior(e._redPacket,e,e._onRedPacketClick),e._addChickAnim(),e._addGuideFinger()})}else{this._redPacket.visible=!1,this._guideText.text="通关获得的所有星星都将转化为现金~",this._addChickAnim();var n=new eui.Group;n.width=xyd.getWidth(),n.height=xyd.getHeight(),this.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.parent){n.parent.removeChild(n),e._guideText.text="通过红包关卡可以额外获得更多现金哦~",e._redPacket.visible=!0;var t=new TimelineLite;t.add(TweenLite.fromTo(e._redPacket,1,{scaleX:1,scaleY:1},{scaleX:2.8,scaleY:2.8})),t.call(function(){e._clickGroup.touchEnabled=!1,xyd.setDarkenBtnBehavior(e._redPacket,e,e._onRedPacketClick),e._addGuideFinger()})}},this);var o=SelfInfo.get().getStageInfo(1),a=3;o&&(a=o.stars);var s=new CashWalletComponent(10*a);s.top=15,s.right=25,n.addChild(s)}platform.inTestMode()&&platform.inAutoMode()&&egret.setTimeout(function(){e._onRedPacketClick()},this,500)},t.prototype._addGuideFinger=function(){this._guideFinger=new eui.Image("icon_shou_png"),this._guideFinger.x=120,this._guideFinger.y=120,this._guideFinger.anchorOffsetX=120,this._guideFinger.anchorOffsetY=120,this._fingerHolder.addChildAt(this._guideFinger,1),this._guideFinger.touchEnabled=!1;var e=new TimelineMax({repeat:-1});this._fingerTween=e,e.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),e.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),e.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:0,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),e.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),38*xyd.TweenDeltaTime)},t.prototype._addChickAnim=function(){EffectFactory.get().newEffect("chicken_guide",function(e){e.x=0,e.y=0,e.animation.play("02",1),e.touchEnabled=!1,this._chickEff=e,this._chickHolder.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.play("04",1);var n=function(t){e.removeDBEventListener("complete",n,this),e.animation.play("01",-1)};e.addDBEventListener("complete",n,this)};e.addDBEventListener("complete",t,this)}.bind(this))},t.prototype._onRedPacketClick=function(){this._onComplete(),xyd.WindowManager.get().closeWindow(this)},t.prototype.willClose=function(){this._fingerTween&&this._fingerTween.kill(),this._chickEff&&(this._chickEff.animation.stop(),EffectFactory.get().pushBackEffect(this._chickEff)),this._onComplete=void 0},t}(BaseWindow);__reflect(PacketGuideWindow.prototype,"PacketGuideWindow");var PacketInfoWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingAnimations=[],n.skinName="resource/skins/PacketInfoWindowSkin.exml",n._level=i.level,n._onComplete=i.onComplete,n}return __extends(t,e),t.prototype.childrenCreated=function(){this.initUIComponent()},t.prototype.initUIComponent=function(){var e=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onClose,this),this._addChickAnim();var t=this._level-SelfInfo.get().getCurrentLevel()+1;this._desc.text=""+t,platform.inTestMode()&&platform.inAutoMode()&&egret.setTimeout(function(){e._onClose()},this,500),this._label.text="关还能进行下一次抽奖！"},t.prototype._addChickAnim=function(){EffectFactory.get().newEffect("chicken_guide",function(e){e.x=0,e.y=0,e.animation.play("02",1),e.touchEnabled=!1,this._chickEff=e,this._effectGroup.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.play("04",1);var n=function(t){e.removeDBEventListener("complete",n,this),e.animation.play("01",-1)};e.addDBEventListener("complete",n,this)};e.addDBEventListener("complete",t,this)}.bind(this))},t.prototype._onClose=function(){this._onComplete&&this._onComplete(),xyd.WindowManager.get().closeWindow(this)},t.prototype.willClose=function(){this._onComplete=void 0;for(var e=0,t=this._usingAnimations;e<t.length;e++){var i=t[e];i.kill()}this._chickEff&&(this._chickEff.animation.stop(),EffectFactory.get().pushBackEffect(this._chickEff))},t}(BaseWindow);__reflect(PacketInfoWindow.prototype,"PacketInfoWindow");var PreGameWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;n.time_limited_img=[],n.expired_time_cache=[],n.timer_group=[],n.timer_label=[],n.timer_img=[],n.img_add=[],n.item_image=[],n._itemSelect1=!1,n._itemSelect2=!1,n._itemSelect3=!1,n._itemSelect4=!1,n._itemSelect=[],n._itemIDs=[],n._retry=!1,n._diff=0,n._useItems=[],n._notUse=!1,n.labelItemNum=[],n.labeTarget=[],n._usingTimelines=[],n._callingMethods={},n._needReplaceLeardboard=!1,n._changeSlateToStone=!1,n._btnLabelMap=(_={},_[1011]="",_[1012]="",_[1013]="text_anniu_xiadan_png",_[1089]="text_anniu_xiadan_png",_[1014]="text_anniu_yaoqing_png",_[1015]="text_anniu_guang_png",_[1087]="text_anniu_guang_png",_),n._missionTextMap=(h={},h[1011]="",h[1012]="三星通关可获得",h[1013]="下单领",h[1089]="下单领",h[1014]="好友助力得",h[1015]="逛商城领取",h[1087]="逛商城领取",h),n.hasTimerOnItem_1=!1,n.hasTimerOnItem_2=!1,n.hasTimerOnItem_3=!1,n.hasTimerOnItem_4=!1,n.hasTimerOnItem=[],n.skinName="resource/skins/PreGameWindowSkin.exml",n.params_=i,n._sceneID=i.scene_id,n._needReplaceLeardboard=i.needReplaceLeaderboard,DisplayConstants.get();var o=i.totalLevel||i.total_level;n._totalLevel=o,i.retry&&(n._retry=i.retry),i.items&&(n._useItems=i.items),i.notUse&&(n._notUse=i.notUse),void 0==n.labelStage&&(n.labelStage=xyd.bitmapNumber.createNumPic(Number(o),"non_k_"),n.stage_container_.addChild(n.labelStage),n.stage_container_.width=xyd.bitmapNumber.getWidth(n.labelStage),n.stage_container_.height=n.stage_txt1_.height,n.labelStage.x=(n.stage_container_.width-xyd.bitmapNumber.getWidth(n.labelStage))/2,n.labelStage.y=(n.stage_container_.height-xyd.bitmapNumber.getHeight(n.labelStage))/2+5);var a=-1,s=-1;if(10>=o)a=1,s=o;else if(20>=o)a=2,s=o-10;else{var r=o-5;a=Math.floor(r/15)+2,r%=15,0==r?(a--,s=15):s=r}n._chapter=a,n._level=s;var l=LevelTable.get().getTableData(n._totalLevel);return l&&(n._diff=l.difficulty),n._gameConf=new GameConf,n._gameConf.init(o),n.timer_group=[n.timer1_group,n.timer2_group,n.timer3_group,n.timer4_group],n.timer_label=[n.timer1_label,n.timer2_label,n.timer3_label,n.timer4_label],n.timer_img=[n.timer1_img,n.timer2_img,n.timer3_img,n.timer4_img],n.time_limited_img=[n.time_limited_img1,n.time_limited_img2,n.time_limited_img3,n.time_limited_img4],n._itemSelect=[n._itemSelect1,n._itemSelect2,n._itemSelect3,n._itemSelect4],n.img_add=[n.img_add_1,n.img_add_2,n.img_add_3,n.img_add_4],n.hasTimerOnItem=[n.hasTimerOnItem_1,n.hasTimerOnItem_2,n.hasTimerOnItem_3,n.hasTimerOnItem_4],n;var _,h}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initDiff(),this.initUIComponent(),this.timerCallback(),this.UIAnimation(),this.initUnderAreaUI(),this.initTimer(),this.initStreak(),this.initClearStageBox()},t.prototype.initTimer=function(){this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerCallback,this),this.timer.start()},t.prototype.initUnderAreaUI=function(){return this._rankPanel.visible=!1,this.params.lottery_text?void(this._retainPanel.visible=!0):void this._initBanner()},t.prototype._initShowGoodsBanner=function(e){if(e&&e.status){var t=void 0,i=function(){platform.callMethod("PREGAME_SHOW_GOODS_OPEN_WINDOW",{status:e.status,mission_id:t})["catch"](function(e){return logger.error(e)})};if(e.goods_info&&e.goods_info.img_url){var n=e.goods_info.img_url;RES.getResByUrl(n,function(e,t){e?(this.goods_icon.texture=e,this.goods_icon.height=this.goods_icon.width=this.goods_icon.parent.width,this.goods_icon.mask=this.goods_mask):console.log("Cannot get resource from "+t)},this,RES.ResourceItem.TYPE_IMAGE)}switch(e.status){case 0:case 4:break;case 1:xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i),this._banner1.visible=!0,this._showGoodsPanel.visible=!0;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner1_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o);break;case 2:var a=e.mission_list;if(void 0==a||0==a.length)break;var s=this._selectRandomTaskBanner(a);if(-1==s)break;var r=a[s];t=r.mission_id;var l=e.current_coin/e.target_coin,_=e.current_coin+"/"+e.target_coin;ABTest.get().getSetting(ABTest.SHOW_GOODS_BY_STEP)&&(l=e.phase_info.progress/1e4,_=(100*l).toFixed(2)+"%"),this._coinBar.width=40>610*l?40:610*l,this._barLabel.textFlow=[{text:_,style:{textColor:16776693,size:32,fontFamily:"Microsoft YaHei",strokeColor:11224048,stroke:1}}];var h=void 0;this._missionTextMap[t]&&""!=this._missionTextMap[t]&&(this._missionLabel1.text=this._missionTextMap[t],this._missionLabel2.text=r.reward_list[0].count.toString(),this._missionLabel3.text="金币",h=this._missionLabel1.width+this._missionLabel2.width+this._missionLabel3.width),this._btnLabelMap[t]&&""!=this._btnLabelMap[t]&&(this._banner2_textBtn.source=this._btnLabelMap[t],this._banner2_btnGroup.visible=!0,xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i));var c=335;if(this._banner2_btnGroup.visible){c=260;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner2_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o)}this._missionLabel1.x=c-h/2,this._missionLabel2.x=this._missionLabel1.x+this._missionLabel1.width,this._missionLabel3.x=this._missionLabel2.x+this._missionLabel2.width,this._banner2.visible=!0,this._showGoodsPanel.visible=!0;break;case 3:this._banner1_textBtn.source="text_anniu_lingqu_png",this._banner1_textImg.source="text2_png",this._banner1.visible=!0,xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i),this._showGoodsPanel.visible=!0;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner1_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o)}}},t.prototype._selectRandomTaskBanner=function(e){for(var t=e.length,i=Math.floor(Math.random()*t),n=e[i],o=0;!(n.completed_times<n.total_times&&1011!=n.mission_id);)if(o++,i=(i+1)%t,n=e[i],o>t)return-1;return i},t.prototype._initRankScroller=function(e){this.rankingCollection_=new eui.ArrayCollection([]),e&&e.rank_data&&e.rank_data.length>0?(SelfInfo.get().getShareInfoWithKey("score_rank_recall")&&(e.rank_data.splice(0,0,{recall_all:!0,recall_list:e.recall_list}),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SCORE_RANK_ALL_RECALL_BTN)),this.rankingCollection_.source=e.rank_data,this.rankingList_.dataProvider=this.rankingCollection_,this.rankingList_.itemRenderer=RankingListItemRenderer,this.rankingCollection_.refresh(),this.rankingScroller.visible=!0,this._rankPanel.visible=!0,this.validateNow()):this._rankPanel.visible=!1},t.prototype.initDiff=function(){switch(this._diff){case 0:this.icon_diff.visible=!1;break;case 1:this.bg_rank.source="bg_jinan_png",this.rank_img.source="bg_paiming_hong_png",this.selectItemText_.strokeColor=12199702,this.icon_diff.source="icon_difficulty_1_png",this.bg_kuang.source="bg_kaishi2_png",this.bg_title.source="bg_titledi2_png",this.close_btn.source="icon_guanbi_2_png",this.btn_bg_.source="bg_anniudi2_png",this.share_btn_bg_.source="bg_anniudi2_png",this.stage_txt1_.strokeColor=this.stage_txt2_.strokeColor=12199702;break;case 2:this.selectItemText_.strokeColor=12199702,this.icon_diff.source="icon_difficulty_2_png",this.bg_kuang.source="bg_kaishi2_png",this.bg_title.source="bg_titledi2_png",this.close_btn.source="icon_guanbi_2_png",this.btn_bg_.source="bg_anniudi2_png",this.share_btn_bg_.source="bg_anniudi2_png",this.stage_txt1_.strokeColor=this.stage_txt2_.strokeColor=12199702;break;case 3:this.bg_rank.source="bg_emeng_png",this.rank_img.source="bg_paiming_zi_png",this.selectItemText_.strokeColor=9973468,this.icon_diff.source="icon_difficulty_3_png",this.bg_kuang.source="bg_kaishi3_png",this.bg_title.source="bg_titledi3_png",this.close_btn.source="icon_guanbi_3_png",this.btn_bg_.source="bg_anniudi3_png",this.share_btn_bg_.source="bg_anniudi3_png",this.stage_txt1_.strokeColor=this.stage_txt2_.strokeColor=9973468}},t.prototype.initStreak=function(){var e=this.selfInfo_.getClearStreak();0==e?(this.icon_liansheng.visible=!1,this.lianshengText_.visible=!1,this.lianshengNumber_.visible=!1):(this.lianshengNumber_.text=String(e),this.icon_liansheng.visible=!0,this.lianshengText_.visible=!0,this.lianshengNumber_.visible=!0,xyd.setDarkenBtnBehavior(this.liansheng_scope,this,this.onWinStreakGuide))},t.prototype.onWinStreakGuide=function(){xyd.WindowManager.get().openWindow("clear_streak_window")},t.prototype.btnSingleAnimation=function(e,t){var i=new TimelineLite;e.scaleX=0,e.scaleY=0,this._usingTimelines.push(i),i.add(TweenLite.to(e,4*xyd.TweenDeltaTime,{}),0),i.add(TweenLite.to(e,4*xyd.TweenDeltaTime,{scaleX:1.2,scaleY:1.2,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),i.add(TweenLite.to(e,5*xyd.TweenDeltaTime,{scaleX:.9,scaleY:.9,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.to(e,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),14*xyd.TweenDeltaTime)},t.prototype.UIAnimation=function(){var e=(this.group_bg.verticalCenter,new TimelineMax);this.group_bg.scaleX=.5,this.group_bg.scaleY=.5,this.group_bg.alpha=.5,this._usingTimelines.push(e),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:.97,scaleY:.97,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),e.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),this.btnSingleAnimation(this.group_item1,4),this.btnSingleAnimation(this.group_item2,4),this.btnSingleAnimation(this.group_item3,4),this.btnSingleAnimation(this.group_item4,4),e.addCallback(function(){e.clear()},32*xyd.TweenDeltaTime)},t.prototype.initUIComponent=function(){var e=this;xyd.setDarkenBtnBehavior(this.start_btn,this,this.startBtnClick),xyd.setDarkenBtnBehavior(this.close_btn,this,this.closeBtnClick),SelfInfo.get().getCurrentLevel()<=SelfInfo.get().getEnterHomeMapLevel()&&(this.close_btn.visible=!1),this._retry?this.start_btn_text.text=xyd.__("RESTART"):this.start_btn_text.text=xyd.__("START"),this.selectItemText_.text=xyd.__("PREGAME_SELECTITEM"),this.taget_.text=xyd.__("TEXT_TARGET"),this.lianshengText_.text=xyd.__("CLEAR_STREAK"),this.stage_txt1_.text=xyd.__("DI"),this.stage_txt2_.text=xyd.__("LEVEL"),this.gacha_.text=xyd.__("PREGAME_GACHA_TIPS1"),this.gacha_reward_.text=xyd.__("PREGAME_GACHA_TIPS2"),this.share_btn_text.text=xyd.__("PREGAME_REWARD"),platform.callMethod("GAME_PRE_BEGIN",{show:!0,confirmed:!1,chapter:this._chapter,level:this._level,total_level:this._totalLevel}).then(function(t){var i=xyd.WindowManager.get().getWindow("pre_game_window");if(void 0!=i){var n=t.total_level,o=t.has_pre_game_reward,a=t.btn_text;e._preRewardTimes=t.pre_reward_times,a&&""!=a&&(e.share_btn_text.text=a),1==o&&n==i.getTotalLevel()&&(i.showShareBtn(),xyd.setBtnBehavior(t.btn_info,e.share_btn,e.share_btn_text,e.share_btn_up_bg,e.shate_btn_bubble,e.shate_btn_bubble_text,e,e.shareBtnClick))}})["catch"](function(e){return logger.error(e)});var t=SelfInfo.get();if(this.selfInfo_=t,this.selfInfo_.isVip?this.group_vip.visible=!0:this.group_vip.visible=!1,this._itemIDs=this._gameConf.pregameItemList,this._itemIDs.length<4)for(var i=0;i<4-this._itemIDs.length;i++)this._itemIDs.push(0);var n=String(this._itemIDs[0]),o=String(this._itemIDs[0]+ItemConstants.LIMITED_TIME_OFFSET),a=String(this._itemIDs[0]+ItemConstants.UNLIMITED_TIME_OFFSET),s=String(this._itemIDs[1]),r=String(this._itemIDs[1]+ItemConstants.LIMITED_TIME_OFFSET),l=String(this._itemIDs[1]+ItemConstants.UNLIMITED_TIME_OFFSET),_=String(this._itemIDs[2]),h=String(this._itemIDs[2]+ItemConstants.LIMITED_TIME_OFFSET),c=String(this._itemIDs[2]+ItemConstants.UNLIMITED_TIME_OFFSET),d=String(this._itemIDs[3]),p=String(this._itemIDs[3]+ItemConstants.LIMITED_TIME_OFFSET),u=String(this._itemIDs[3]+ItemConstants.UNLIMITED_TIME_OFFSET),m=t.getItemNumByID(n),g=t.getItemNumByID(o),f=t.getItemNumByID(a),y=t.getItemNumByID(s),E=t.getItemNumByID(r),v=t.getItemNumByID(l),T=t.getItemNumByID(_),C=t.getItemNumByID(h),L=t.getItemNumByID(c),b=t.getItemNumByID(d),w=t.getItemNumByID(p),S=t.getItemNumByID(u),O=!1,A=!1,x=!1,I=!1;if(this._useItems&&this._useItems.length>0)for(var i=1;i<=this._useItems.length;i++)this._useItems[i-1]!=this._itemIDs[0]?this._useItems[i-1]!=this._itemIDs[1]?this._useItems[i-1]!=this._itemIDs[2]?this._useItems[i-1]!=this._itemIDs[3]||(I=!0):x=!0:A=!0:O=!0;var M="non_4_",R="non_4_",D="non_4_",B="non_4_";this.item_image.push(this.item_img_1),this.item_image.push(this.item_img_2),this.item_image.push(this.item_img_3),this.item_image.push(this.item_img_4),f>0?(this.timer1_group.visible=!0,this.time_limited_img1.source="icon_unlimited_subscript_png",this.hasTimerOnItem[0]=!0,M="non_5_"):g>0&&(this.timer1_group.visible=!0,this.time_limited_img1.source="icon_xianshi_png",this.hasTimerOnItem[0]=!0,M="non_5_"),v>0?(this.timer2_group.visible=!0,this.time_limited_img2.source="icon_unlimited_subscript_png",this.hasTimerOnItem[1]=!0,R="non_5_"):E>0&&(this.timer2_group.visible=!0,this.time_limited_img2.source="icon_xianshi_png",this.hasTimerOnItem[1]=!0,R="non_5_"),L>0?(this.timer3_group.visible=!0,this.time_limited_img3.source="icon_unlimited_subscript_png",this.hasTimerOnItem[2]=!0,D="non_5_"):C>0&&(this.timer3_group.visible=!0,this.time_limited_img3.source="icon_xianshi_png",this.hasTimerOnItem[2]=!0,D="non_5_"),S>0?(this.timer4_group.visible=!0,this.time_limited_img4.source="icon_unlimited_subscript_png",this.hasTimerOnItem[3]=!0,B="non_5_"):w>0&&(this.timer4_group.visible=!0,this.time_limited_img4.source="icon_xianshi_png",this.hasTimerOnItem[3]=!0,B="non_5_");for(var i=0;4>i;i++)this.item_image[i].source=DisplayConstants.ItemSourceMap[this._itemIDs[i]]+"_png";if(f>0){var N=m+g;this.labelItemNum1=xyd.bitmapNumber.createNumPicWithPunctuation("",M),this.num_container_1.addChild(this.labelItemNum1),xyd.setDarkenBtnBehavior(this.group_item1,this,this.itemClick1),this.labelItemNum.push(this.labelItemNum1),this.updateItemCountByIndex(0,N,g)}else if(m+g>=0){var N=m+g;this.labelItemNum1=xyd.bitmapNumber.createNumPic(N,M),this.num_container_1.addChild(this.labelItemNum1),this.labelItemNum1.x=(this.num_container_1.width-xyd.bitmapNumber.getWidth(this.labelItemNum1))/2,this.labelItemNum1.y=(this.num_container_1.height-xyd.bitmapNumber.getHeight(this.labelItemNum1))/2,xyd.setDarkenBtnBehavior(this.group_item1,this,this.itemClick1),this.labelItemNum.push(this.labelItemNum1),this.updateItemCountByIndex(0,N,g)}if((f>0||g>0||O||m>0&&this.selfInfo_.lastGameChooseItems[0]&&this.selfInfo_.lastGameLevel==this._totalLevel&&!this._notUse)&&this.itemClick1(),v>0){var N=y+E;this.labelItemNum2=xyd.bitmapNumber.createNumPicWithPunctuation("",R),this.num_container_2.addChild(this.labelItemNum2),xyd.setDarkenBtnBehavior(this.group_item2,this,this.itemClick2),this.labelItemNum.push(this.labelItemNum2),this.updateItemCountByIndex(1,N,E)}else if(y+E>=0){var N=y+E;this.labelItemNum2=xyd.bitmapNumber.createNumPic(N,R),this.num_container_2.addChild(this.labelItemNum2),this.labelItemNum2.x=(this.num_container_2.width-xyd.bitmapNumber.getWidth(this.labelItemNum2))/2,this.labelItemNum2.y=(this.num_container_2.height-xyd.bitmapNumber.getHeight(this.labelItemNum2))/2,xyd.setDarkenBtnBehavior(this.group_item2,this,this.itemClick2),this.labelItemNum.push(this.labelItemNum2),this.updateItemCountByIndex(1,N,E)}if((v>0||E>0||A||y>0&&this.selfInfo_.lastGameChooseItems[1]&&this.selfInfo_.lastGameLevel==this._totalLevel&&!this._notUse)&&this.itemClick2(),L>0){this.group_item3.visible=!0;var N=T+C;this.labelItemNum3=xyd.bitmapNumber.createNumPicWithPunctuation("",D),this.num_container_3.addChild(this.labelItemNum3),xyd.setDarkenBtnBehavior(this.group_item3,this,this.itemClick3),this.labelItemNum.push(this.labelItemNum3),this.updateItemCountByIndex(2,N,C)}else if(T+C>=0){this.group_item3.visible=!0;var N=T+C;this.labelItemNum3=xyd.bitmapNumber.createNumPic(N,D),this.num_container_3.addChild(this.labelItemNum3),this.labelItemNum3.x=(this.num_container_3.width-xyd.bitmapNumber.getWidth(this.labelItemNum3))/2,this.labelItemNum3.y=(this.num_container_3.height-xyd.bitmapNumber.getHeight(this.labelItemNum3))/2,xyd.setDarkenBtnBehavior(this.group_item3,this,this.itemClick3),this.labelItemNum.push(this.labelItemNum3),this.updateItemCountByIndex(2,N,C)}if((L>0||C>0||x||T>0&&this.selfInfo_.lastGameChooseItems[2]&&this.selfInfo_.lastGameLevel==this._totalLevel&&!this._notUse)&&this.itemClick3(),S>0){this.group_item4.visible=!0;var N=b+w;this.labelItemNum4=xyd.bitmapNumber.createNumPicWithPunctuation("",B),this.num_container_4.addChild(this.labelItemNum4),xyd.setDarkenBtnBehavior(this.group_item4,this,this.itemClick4),this.labelItemNum.push(this.labelItemNum4),this.updateItemCountByIndex(3,N,w)
}else if(b+w>=0){this.group_item4.visible=!0;var N=b+w;this.labelItemNum4=xyd.bitmapNumber.createNumPic(N,B),this.num_container_4.addChild(this.labelItemNum4),this.labelItemNum4.x=(this.num_container_4.width-xyd.bitmapNumber.getWidth(this.labelItemNum4))/2,this.labelItemNum4.y=(this.num_container_4.height-xyd.bitmapNumber.getHeight(this.labelItemNum4))/2,xyd.setDarkenBtnBehavior(this.group_item4,this,this.itemClick4),this.labelItemNum.push(this.labelItemNum4),this.updateItemCountByIndex(3,N,w)}(S>0||w>0||I||b>0&&this.selfInfo_.lastGameChooseItems[3]&&this.selfInfo_.lastGameLevel==this._totalLevel&&!this._notUse)&&this.itemClick4();var P=t.getStageInfo(this._totalLevel),k=0,G=0;switch(void 0!=P&&(k=P.stars,G=P.score),k){case 0:G=this._gameConf.scoreTargets[0],this.star_1.source="icon_big_star_2_png",this.star_2.source="icon_big_star_2_png",this.star_3.source="icon_big_star_2_png";break;case 1:G=this._gameConf.scoreTargets[1],this.star_1.source="icon_big_star_1_png",this.star_2.source="icon_big_star_2_png",this.star_3.source="icon_big_star_2_png";break;case 2:G=this._gameConf.scoreTargets[2],this.star_1.source="icon_big_star_1_png",this.star_2.source="icon_big_star_1_png",this.star_3.source="icon_big_star_2_png";break;case 3:this.star_1.source="icon_big_star_1_png",this.star_2.source="icon_big_star_1_png",this.star_3.source="icon_big_star_1_png"}this.taget_.visible=!1;var F=this._gameConf.modeName;switch(F){case GameModeConstants.CLASSIC_MOVES:this.taget_.visible=!0,this.labelScore=xyd.bitmapNumber.createNumPic(G,"non_k_"),this.score_.addChild(this.labelScore),this.labelScore.y=.5*(this.score_.height-xyd.bitmapNumber.getHeight(this.labelScore))-.15*this.stage_txt1_.height;break;case GameModeConstants.OBJECTIVE:for(var H=this._gameConf.objectives,i=0;i<H.length;i++)this._updateTarget(String(H[i].item),H[i].quantity);break;case GameModeConstants.LEAF_OBJECTIVE:for(var W=0,U=this._gameConf.cellMap,Y=0,V=9;V>Y;Y++)for(var K=0,X=9;X>K;K++){var j=U[Y][K];(j.hasProperty(CellConstants.LEAF_1)||j.hasProperty(CellConstants.LEAF_2))&&W++}this._updateTarget("leaf",W);for(var H=this._gameConf.objectives,i=0;i<H.length;i++)this._updateTarget(String(H[i].item),H[i].quantity);break;case GameModeConstants.LAMP:var z=this._gameConf.lamps,q=0,Q=0;z.length>=1&&(q=this._gameConf.lamps[0]),z.length>=2&&(Q=this._gameConf.lamps[1]),this._updateTarget("lamp1",q),this._updateTarget("lamp2",Q);break;case GameModeConstants.LEAF:for(var W=0,U=this._gameConf.cellMap,Y=0,V=9;V>Y;Y++)for(var K=0,X=9;X>K;K++){var j=U[Y][K];(j.hasProperty(CellConstants.LEAF_1)||j.hasProperty(CellConstants.LEAF_2))&&W++}this._updateTarget("leaf",W);break;case GameModeConstants.LEAF_LAMP:for(var W=0,U=this._gameConf.cellMap,Y=0,V=9;V>Y;Y++)for(var K=0,X=9;X>K;K++){var j=U[Y][K];(j.hasProperty(CellConstants.LEAF_1)||j.hasProperty(CellConstants.LEAF_2))&&W++}this._updateTarget("leaf",W);var z=this._gameConf.lamps,q=0,Q=0;z.length>=1&&(q=this._gameConf.lamps[0]),z.length>=2&&(Q=this._gameConf.lamps[1]),q>0&&this._updateTarget("lamp1",q),Q>0&&this._updateTarget("lamp2",Q)}if(this.params.bonus_items)for(var J=0,Z=this.params.bonus_items;J<Z.length;J++){var $=Z[J];this.selectItem($)}this._scoreTarget=G,platform.inAutoMode()&&egret.setTimeout(function(){e.startBtnClick()},this,500),this._needReplaceLeardboard?(this._leardboard.visible=!1,this._enteranceGuide.visible=!0):(this._leardboard.visible=!0,this._enteranceGuide.visible=!1),ABTest.get().getSetting(ABTest.NEWUSER_BENEFITS)&&this._newUserBenefits(),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_CLOSE_BTN),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_START_RETRY_BTN,{scene_id:this._sceneID}),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_ITEM_1),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_ITEM_2),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_ITEM_3),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_ITEM_4)},t.prototype.updateAllItemCount=function(){for(var e=SelfInfo.get(),t=0;4>t;t++){var i=String(this._itemIDs[t]),n=String(this._itemIDs[t]+ItemConstants.LIMITED_TIME_OFFSET),o=e.getItemNumByID(i),a=e.getItemNumByID(n);this.updateItemCountByIndex(t,o+a,a)}},t.prototype.updateItemCountByIndex=function(e,t,i){var n=this.labelItemNum[e];if(void 0!=n){var o,a=SelfInfo.get(),s=this._itemIDs[e],r=s+ItemConstants.UNLIMITED_TIME_OFFSET,l=a.getItemNumByID(String(r));if(0>=t&&0>=l)return this.img_add[e].visible=!0,this.hasTimerOnItem[e]&&(this.time_limited_img[e].source="icon_shuliang_png",this.hasTimerOnItem[e]=!1),void(this.labelItemNum[e].visible=!1);l>0?(o="non_5_",xyd.bitmapNumber.changeNumWithPunctuation(n,"",o),this.timer_img[e].source="bg_unlimited_daojishi_png"):(i>0?(o="non_5_",this.timer_img[e].source="bg_xianshidaoju_png"):(o="non_4_",this.timer_img[e].source="bg_xianshidaoju_png"),xyd.bitmapNumber.changeNum(n,t,o)),this.img_add[e].visible=!1,this.labelItemNum[e].visible=!0,n.parent&&(n.x=(n.parent.width-xyd.bitmapNumber.getWidth(n))/2,n.y=(n.parent.height-xyd.bitmapNumber.getHeight(n))/2)}},t.prototype._newUserBenefits=function(){if(SelfInfo.get().getCurrentLevel()>=11&&SelfInfo.get().getCurrentLevel()<=50){var e=Math.ceil(4*Math.random());this["group_item"+e.toString()].touchEnabled=!1,this["group_item"+e.toString()].touchChildren=!1,this.selectItem(this._itemIDs[e-1]),this.updateItems(),this["num_group_"+e.toString()].visible=!1,this["newuser_benefits_img_"+e.toString()].visible=!0,this["item_bg_"+e.toString()].source="bg_icondi_liang_png",SelfInfo.get().newUserBenefitsItemID=this._itemIDs[e-1]}},t.prototype.checkHasCellStone=function(){for(var e=this._gameConf.cellMap,t=e.length,i=e[0].length,n=0;t>n;n++)for(var o=0;i>o;o++){var a=e[n][o];if(a.hasProperty(CellConstants.SLATE))return!0}return!1},t.prototype._updateTarget=function(e,t){if(-1!=t){if(Number(e)==ObjectiveConstants.SLATE){var i=this.checkHasCellStone();i&&(this._changeSlateToStone=!0)}var n=new GameTargetView(e,t,this.labeTarget);this._changeSlateToStone&&Number(e)==ObjectiveConstants.SLATE&&n.changeSlateToStone(),this.group_target.addChild(n)}},t.prototype.PreStartGame=function(){var e=this;if(!this._callingMethods.GAME_PRE_BEGIN){this._callingMethods.GAME_PRE_BEGIN=!0;var t=(String(this._itemIDs[0]),String(this._itemIDs[0]+ItemConstants.LIMITED_TIME_OFFSET)),i=(String(this._itemIDs[1]),String(this._itemIDs[1]+ItemConstants.LIMITED_TIME_OFFSET)),n=(String(this._itemIDs[2]),String(this._itemIDs[2]+ItemConstants.LIMITED_TIME_OFFSET)),o=(String(this._itemIDs[3]),String(this._itemIDs[3]+ItemConstants.LIMITED_TIME_OFFSET)),a=SelfInfo.get(),s=a.getItemNumByID(t),r=a.getItemNumByID(i),l=a.getItemNumByID(n),_=a.getItemNumByID(o);this._itemSelect1&&0>=s?(SelfInfo.get().lastGameLevel=this._totalLevel,SelfInfo.get().lastGameChooseItems[0]=!0):SelfInfo.get().lastGameChooseItems[0]=!1,this._itemSelect2&&0>=r?(SelfInfo.get().lastGameLevel=this._totalLevel,SelfInfo.get().lastGameChooseItems[1]=!0):SelfInfo.get().lastGameChooseItems[1]=!1,this._itemSelect3&&0>=l?(SelfInfo.get().lastGameLevel=this._totalLevel,SelfInfo.get().lastGameChooseItems[2]=!0):SelfInfo.get().lastGameChooseItems[2]=!1,this._itemSelect4&&0>=_?(SelfInfo.get().lastGameLevel=this._totalLevel,SelfInfo.get().lastGameChooseItems[3]=!0):SelfInfo.get().lastGameChooseItems[3]=!1,platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!0,chapter:this._chapter,level:this._level,total_level:this._totalLevel}).then(function(t){if(t.success){EffectFactory.get().cleanUp(),e._disableBtns();var i=new TimelineLite;i.add(TweenLite.to(e.group_bg,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),i.call(function(){SoundManager.getInstance().playBg("bgm_level_mp3");var i=MainController.get().initGameFromConf(e._gameConf);i.setScoreTarget(e._scoreTarget),t.funds&&i.setFundActivity(t.funds.init_count,t.funds.drop_count),xyd.WindowManager.get().closeWindow("stage_window");var n=xyd.WindowManager.get().getWindow("map_window");n&&xyd.WindowManager.get().closeWindow("map_window"),xyd.WindowManager.get().closeWindow("severn_map_window"),xyd.WindowManager.get().closeWindow("pre_game_window");var o=[];e._itemSelect1&&(o.push(e._itemIDs[0]),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_ITEM_1)),e._itemSelect2&&(o.push(e._itemIDs[1]),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_ITEM_2)),e._itemSelect3&&(o.push(e._itemIDs[2]),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_ITEM_3)),e._itemSelect4&&(o.push(e._itemIDs[3]),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_ITEM_4)),o.length>0&&i.setActiveItemList(o);var a=[RES.loadGroup("game")];Promise.all(a).then(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START))})})}else e.closeBtnClick(),e._retry&&(MainController.get().clearGame(),xyd.WindowManager.get().openWindow("stage_window"));e._callingMethods.GAME_PRE_BEGIN=!1})["catch"](function(t){e._callingMethods.GAME_PRE_BEGIN=!1,e._enableBtns(),logger.error(t)})}},t.prototype.startBtnClick=function(){this.PreStartGame(),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_START_RETRY_BTN,{scene_id:this._sceneID})},t.prototype.shareBtnClick=function(){var e=this;platform.callMethod("GET_PRE_GAME_REWARD",{total_level:this._totalLevel}).then(function(t){t.success&&(e.share_btn_group.visible=!1,e.share_btn_group.includeInLayout=!1,e.updateItems())})["catch"](function(e){logger.error(e)}),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_SHARE_BTN,{pre_reward_times:this._preRewardTimes})},t.prototype.updateItems=function(){var e=SelfInfo.get(),t=String(this._itemIDs[0]),i=String(this._itemIDs[0]+ItemConstants.LIMITED_TIME_OFFSET),n=String(this._itemIDs[0]+ItemConstants.UNLIMITED_TIME_OFFSET),o=String(this._itemIDs[1]),a=String(this._itemIDs[1]+ItemConstants.LIMITED_TIME_OFFSET),s=String(this._itemIDs[1]+ItemConstants.UNLIMITED_TIME_OFFSET),r=String(this._itemIDs[2]),l=String(this._itemIDs[2]+ItemConstants.LIMITED_TIME_OFFSET),_=String(this._itemIDs[2]+ItemConstants.UNLIMITED_TIME_OFFSET),h=String(this._itemIDs[3]),c=String(this._itemIDs[3]+ItemConstants.LIMITED_TIME_OFFSET),d=String(this._itemIDs[3]+ItemConstants.UNLIMITED_TIME_OFFSET),p=e.getItemNumByID(t),u=e.getItemNumByID(i),m=e.getItemNumByID(n),g=e.getItemNumByID(o),f=e.getItemNumByID(a),y=e.getItemNumByID(s),E=e.getItemNumByID(r),v=e.getItemNumByID(l),T=e.getItemNumByID(_),C=e.getItemNumByID(h),L=e.getItemNumByID(c),b=e.getItemNumByID(d);this.timer1_group.visible=!1,this.timer2_group.visible=!1,this.timer3_group.visible=!1,this.timer4_group.visible=!1;var w="non_4_",S="non_4_",O="non_4_",A="non_4_";if(m>0?(this.timer1_group.visible=!0,this.time_limited_img1.source="icon_unlimited_subscript_png",this.hasTimerOnItem[0]=!0,w="non_5_"):u>0&&(this.timer1_group.visible=!0,this.time_limited_img1.source="icon_xianshi_png",this.hasTimerOnItem[0]=!0,w="non_5_"),y>0?(this.timer2_group.visible=!0,this.time_limited_img2.source="icon_unlimited_subscript_png",this.hasTimerOnItem[1]=!0,w="non_5_"):f>0&&(this.timer2_group.visible=!0,this.time_limited_img2.source="icon_xianshi_png",this.hasTimerOnItem[1]=!0,S="non_5_"),T>0?(this.timer3_group.visible=!0,this.time_limited_img3.source="icon_unlimited_subscript_png",this.hasTimerOnItem[2]=!0,w="non_5_"):v>0&&(this.timer3_group.visible=!0,this.time_limited_img3.source="icon_xianshi_png",this.hasTimerOnItem[2]=!0,O="non_5_"),b>0?(this.timer4_group.visible=!0,this.time_limited_img4.source="icon_unlimited_subscript_png",this.hasTimerOnItem[3]=!0,w="non_5_"):L>0&&(this.timer4_group.visible=!0,this.time_limited_img4.source="icon_xianshi_png",this.hasTimerOnItem[3]=!0,A="non_5_"),m>0){var x=p+u;this.labelItemNum1?this.labelItemNum1=xyd.bitmapNumber.createNumPicWithPunctuation("",w):(this.labelItemNum1=xyd.bitmapNumber.createNumPicWithPunctuation("",w),this.num_container_1.addChild(this.labelItemNum1),xyd.setDarkenBtnBehavior(this.group_item1,this,this.itemClick1),this.labelItemNum.push(this.labelItemNum1)),this.updateItemCountByIndex(0,x,u)}else if(p+u>=0){var x=p+u;this.labelItemNum1?xyd.bitmapNumber.changeNum(this.labelItemNum1,x,w):(this.labelItemNum1=xyd.bitmapNumber.createNumPic(x,w),this.num_container_1.addChild(this.labelItemNum1),xyd.setDarkenBtnBehavior(this.group_item1,this,this.itemClick1),this.labelItemNum.push(this.labelItemNum1)),this.labelItemNum1.x=(this.num_container_1.width-xyd.bitmapNumber.getWidth(this.labelItemNum1))/2,this.labelItemNum1.y=(this.num_container_1.height-xyd.bitmapNumber.getHeight(this.labelItemNum1))/2,this.updateItemCountByIndex(0,x,u)}if((m>0||u>0)&&(this._itemSelect1=!1,this.itemClick1()),y>0){var x=g+f;this.labelItemNum2?this.labelItemNum2=xyd.bitmapNumber.createNumPicWithPunctuation("",S):(this.labelItemNum2=xyd.bitmapNumber.createNumPicWithPunctuation("",S),this.num_container_2.addChild(this.labelItemNum2),xyd.setDarkenBtnBehavior(this.group_item2,this,this.itemClick2),this.labelItemNum.push(this.labelItemNum2)),this.updateItemCountByIndex(0,x,f)}else if(g+f>=0){var x=g+f;this.labelItemNum2?xyd.bitmapNumber.changeNum(this.labelItemNum2,x,S):(this.labelItemNum2=xyd.bitmapNumber.createNumPic(x,S),this.num_container_2.addChild(this.labelItemNum2),xyd.setDarkenBtnBehavior(this.group_item2,this,this.itemClick2),this.labelItemNum.push(this.labelItemNum2)),this.labelItemNum2.x=(this.num_container_2.width-xyd.bitmapNumber.getWidth(this.labelItemNum2))/2,this.labelItemNum2.y=(this.num_container_2.height-xyd.bitmapNumber.getHeight(this.labelItemNum2))/2,this.updateItemCountByIndex(1,x,f)}if((y>0||f>0)&&(this._itemSelect2=!1,this.itemClick2()),T>0){this.group_item3.visible=!0;var x=E+v;this.labelItemNum3?this.labelItemNum3=xyd.bitmapNumber.createNumPicWithPunctuation("",O):(this.labelItemNum3=xyd.bitmapNumber.createNumPicWithPunctuation("",O),this.num_container_3.addChild(this.labelItemNum3),xyd.setDarkenBtnBehavior(this.group_item3,this,this.itemClick3),this.labelItemNum.push(this.labelItemNum3)),this.updateItemCountByIndex(2,x,v)}else if(E+v>=0){this.group_item3.visible=!0;var x=E+v;this.labelItemNum3?xyd.bitmapNumber.changeNum(this.labelItemNum3,x,O):(this.labelItemNum3=xyd.bitmapNumber.createNumPic(x,O),this.num_container_3.addChild(this.labelItemNum3),xyd.setDarkenBtnBehavior(this.group_item3,this,this.itemClick3),this.labelItemNum.push(this.labelItemNum3)),this.labelItemNum3.x=(this.num_container_3.width-xyd.bitmapNumber.getWidth(this.labelItemNum3))/2,this.labelItemNum3.y=(this.num_container_3.height-xyd.bitmapNumber.getHeight(this.labelItemNum3))/2,this.updateItemCountByIndex(2,x,v)}if((b>0||v>0)&&(this._itemSelect3=!1,this.itemClick3()),b>0){this.group_item4.visible=!0;var x=C+L;this.labelItemNum4?this.labelItemNum4=xyd.bitmapNumber.createNumPicWithPunctuation("",A):(this.labelItemNum4=xyd.bitmapNumber.createNumPicWithPunctuation("",A),this.num_container_4.addChild(this.labelItemNum4),xyd.setDarkenBtnBehavior(this.group_item4,this,this.itemClick4),this.labelItemNum.push(this.labelItemNum4)),this.updateItemCountByIndex(3,x,L)}else if(C+L>=0){this.group_item4.visible=!0;var x=C+L;this.labelItemNum4?xyd.bitmapNumber.changeNum(this.labelItemNum4,x,A):(this.labelItemNum4=xyd.bitmapNumber.createNumPic(x,A),this.num_container_4.addChild(this.labelItemNum4),xyd.setDarkenBtnBehavior(this.group_item4,this,this.itemClick4),this.labelItemNum.push(this.labelItemNum4)),this.labelItemNum4.x=(this.num_container_4.width-xyd.bitmapNumber.getWidth(this.labelItemNum4))/2,this.labelItemNum4.y=(this.num_container_4.height-xyd.bitmapNumber.getHeight(this.labelItemNum4))/2,this.updateItemCountByIndex(3,x,L)}(b>0||L>0)&&(this._itemSelect4=!1,this.itemClick4())},t.prototype.closeBtnClick=function(){var e=this,t=xyd.WindowManager.get().getWindow("stage_window");t&&t.onOperation();var i=new TimelineLite,n=this._chapter,o=this._level,a=this._totalLevel;this.group_bg.scaleX=1,this.group_bg.scaleY=1,this._usingTimelines.push(i),i.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05,ease:Linear.easeNone}),0),i.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),i.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:.5,scaleY:.5,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),i.call(function(){e._disableBtns(),platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!1,chapter:n,level:o,total_level:a}).then(function(){})["catch"](function(e){return logger.error(e)}),xyd.WindowManager.get().closeWindow("pre_game_window");var t=xyd.WindowManager.get().getWindow("stage_window"),i=xyd.WindowManager.get().getWindow("map_window"),s=xyd.WindowManager.get().getWindow("severn_map_window");t||i||s||MainController.get().goToMap(null)}),logger.logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_PREGAME_CLOSE_BTN)},t.prototype.willClose=function(){e.prototype.willClose.call(this),TweenLite.killTweensOf(this.start_btn),this.labelItemNum1&&xyd.bitmapNumber.destroyNumPic(this.labelItemNum1),this.labelItemNum2&&xyd.bitmapNumber.destroyNumPic(this.labelItemNum2),this.labelItemNum3&&xyd.bitmapNumber.destroyNumPic(this.labelItemNum3),this.labelScore&&xyd.bitmapNumber.destroyNumPic(this.labelScore),this.labelStage&&xyd.bitmapNumber.destroyNumPic(this.labelStage);for(var t=0;t<this.labeTarget.length;t++)xyd.bitmapNumber.destroyNumPic(this.labeTarget[t]);for(var i=0,n=this._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}this.timer.stop()},t.prototype.dispose=function(){for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}this._usingTimelines=[],this.params.callBack&&this.params.callBack(),this.fundTimer&&(this.fundTimer.stop(),this.fundTimer=void 0),e.prototype.dispose.call(this)},t.prototype._disableBtns=function(){this.start_btn.touchEnabled=!1,this.close_btn.touchEnabled=!1,this.bg_exit_.touchEnabled=!1},t.prototype._enableBtns=function(){this.start_btn.touchEnabled=!0,this.close_btn.touchEnabled=!0,this.bg_exit_.touchEnabled=!0},t.prototype.selectItem=function(e){var t=e%1e3+1e3;t==this._itemIDs[0]?(this._itemSelect1=!0,this.select_1.visible=!0,this.timer1_group.visible=!1):t==this._itemIDs[1]?(this._itemSelect2=!0,this.select_2.visible=!0,this.timer2_group.visible=!1):t==this._itemIDs[2]?(this._itemSelect3=!0,this.select_3.visible=!0,this.timer3_group.visible=!1):t==this._itemIDs[3]&&(this._itemSelect4=!0,this.select_4.visible=!0,this.timer4_group.visible=!1)},t.prototype.itemClick1=function(){var e=this,t=this.selfInfo_,i=String(this._itemIDs[0]),n=String(this._itemIDs[0]+ItemConstants.LIMITED_TIME_OFFSET),o=String(this._itemIDs[0]+ItemConstants.UNLIMITED_TIME_OFFSET),a=t.getItemNumByID(i),s=t.getItemNumByID(n),r=t.getItemNumByID(o),l=a+s+r;return 0>=l?void this.selfInfo_.buyItemByID(i,this._totalLevel).then(function(o){o&&(e.updateAllItemCount(),a=t.getItemNumByID(i),s=t.getItemNumByID(n),(a+s>0||s>0)&&(e._itemSelect1=!0,e.select_1.visible=!0,e.timer1_group.visible=!1))})["catch"](function(e){return console.log(e)}):void(this._itemSelect1?(this._itemSelect1=!1,this.select_1.visible=!1,this.expired_time_cache[0]&&(this.timer1_group.visible=!0)):(this._itemSelect1=!0,this.select_1.visible=!0,this.timer1_group.visible=!1))},t.prototype.itemClick2=function(){var e=this,t=this.selfInfo_,i=String(this._itemIDs[1]),n=String(this._itemIDs[1]+ItemConstants.LIMITED_TIME_OFFSET),o=String(this._itemIDs[1]+ItemConstants.UNLIMITED_TIME_OFFSET),a=t.getItemNumByID(i),s=t.getItemNumByID(n),r=t.getItemNumByID(o),l=a+s+r;return 0>=l?void this.selfInfo_.buyItemByID(i,this._totalLevel).then(function(o){o&&(e.updateAllItemCount(),a=t.getItemNumByID(i),s=t.getItemNumByID(n),(a+s>0||s>0)&&(e._itemSelect2=!0,e.select_2.visible=!0,e.timer2_group.visible=!1))})["catch"](function(e){return console.log(e)}):void(this._itemSelect2?(this._itemSelect2=!1,this.select_2.visible=!1,this.expired_time_cache[1]&&(this.timer2_group.visible=!0)):(this._itemSelect2=!0,this.select_2.visible=!0,this.timer2_group.visible=!1))},t.prototype.itemClick3=function(){var e=this,t=this.selfInfo_,i=String(this._itemIDs[2]),n=String(this._itemIDs[2]+ItemConstants.LIMITED_TIME_OFFSET),o=String(this._itemIDs[2]+ItemConstants.UNLIMITED_TIME_OFFSET),a=t.getItemNumByID(i),s=t.getItemNumByID(n),r=t.getItemNumByID(o),l=a+s+r;return 0>=l?void this.selfInfo_.buyItemByID(i,this._totalLevel).then(function(o){o&&(e.updateAllItemCount(),a=t.getItemNumByID(i),s=t.getItemNumByID(n),(a+s>0||s>0)&&(e._itemSelect3=!0,e.select_3.visible=!0,e.timer3_group.visible=!1))})["catch"](function(e){return console.log(e)}):void(this._itemSelect3?(this._itemSelect3=!1,this.select_3.visible=!1,this.expired_time_cache[2]&&(this.timer3_group.visible=!0)):(this._itemSelect3=!0,this.select_3.visible=!0,this.timer3_group.visible=!1))},t.prototype.itemClick4=function(){var e=this,t=this.selfInfo_,i=String(this._itemIDs[3]),n=String(this._itemIDs[3]+ItemConstants.LIMITED_TIME_OFFSET),o=String(this._itemIDs[3]+ItemConstants.UNLIMITED_TIME_OFFSET),a=t.getItemNumByID(i),s=t.getItemNumByID(n),r=t.getItemNumByID(o),l=a+s+r;return 0>=l?void this.selfInfo_.buyItemByID(i,this._totalLevel).then(function(o){o&&(e.updateAllItemCount(),a=t.getItemNumByID(i),s=t.getItemNumByID(n),(a+s>0||s>0)&&(e._itemSelect4=!0,e.select_4.visible=!0,e.timer4_group.visible=!1))})["catch"](function(e){return console.log(e)}):void(this._itemSelect4?(this._itemSelect4=!1,this.select_4.visible=!1,this.expired_time_cache[3]&&(this.timer4_group.visible=!0)):(this._itemSelect4=!0,this.select_4.visible=!0,this.timer4_group.visible=!1))},t.prototype.timerCallback=function(){for(var e=Math.ceil((new Date).getTime()/1e3),t=0;4>t;t++)this.timerHelper(t,e)},t.prototype.timerHelper=function(e,t){var i=this.expired_time_cache[e];if(void 0==i||0>=i-t){var n=this.selfInfo_,o=String(this._itemIDs[e]),a=String(this._itemIDs[e]+ItemConstants.LIMITED_TIME_OFFSET),s=String(this._itemIDs[e]+ItemConstants.UNLIMITED_TIME_OFFSET),r=n.getItemNumByID(o),l=n.getItemNumByID(a),_=n.getItemNumByID(s);if(void 0!=_&&_>0)return this.hasTimerOnItem[e]||(this.timer_group[e].visible=!0,this.timer_img[e].source="bg_unlimited_daojishi_png",this.time_limited_img[e].source="icon_unlimited_subscript_png",this.hasTimerOnItem[e]=!0),i=n.getItemExpireTimeByID(s),this.expired_time_cache[e]=i,void this.updateItemCountByIndex(e,r,l);if(!l||0>=l)return this.timer_group[e].visible=!1,this.timer_img[e].source="bg_xianshidaoju_png",this.time_limited_img[e].source="icon_shuliang_png",this.hasTimerOnItem[e]=!1,this.updateItemCountByIndex(e,r,0),void(this.expired_time_cache[e]=void 0);this.timer_img[e].source="bg_xianshidaoju_png",this.time_limited_img[e].source="icon_xianshi_png",this.hasTimerOnItem[e]=!0,i=n.getItemExpireTimeByID(a),this.expired_time_cache[e]=i,this.updateItemCountByIndex(e,r+l,l)}var h=i-t;h>0?this.timer_label[e].text=xyd.secondsToTimeString(h):this.timer_label[e].text=xyd.secondsToTimeString(0)},t.prototype.getTotalLevel=function(){return this._totalLevel},t.prototype.showShareBtn=function(){this.share_btn_group.includeInLayout=!0,this.share_btn_group.visible=!0,logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_PREGAME_SHARE_BTN,{pre_reward_times:this._preRewardTimes})},t.prototype.initClearStageBox=function(){var e=this;platform.callMethod("GET_CLEAR_STAGE_INFO",null).then(function(t){if(!e.isDisposed_&&t&&t.success){var i=t.remaining_level,n=new eui.Group;n.name="GiftBoxGroup",n.width=181,n.height=173;var o=new eui.Image;xyd.setUISpriteAsync(o,"icon_giftbox",null),n.addChild(o);var a=new eui.Image;xyd.setUISpriteAsync(a,"icon_under_giftbox",null),n.addChild(a),a.horizontalCenter=0,a.y=135;var s=new eui.Label;n.addChild(s),s.horizontalCenter=0,s.textAlign=egret.HorizontalAlign.CENTER,s.y=150,s.size=28,s.fontFamily="Microsoft YaHei",0>=i?s.text="通关可领":s.text=i+"关后可领",n.x=880,n.y=640,e.group_bg.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.callMethod("SHOW_CLEAR_STAGE_REWARD",null)},e);var r=new TimelineMax({repeat:-1,yoyo:!0});r.fromTo(o,15*xyd.TweenDeltaTime,{y:-3},{y:3}),e._usingTimelines.push(r)}})["catch"](function(e){logger.error(e)})},t.prototype._initBanner=function(){var e=this;platform.callMethod("GET_BANNER_INFO",{level:this._totalLevel}).then(function(t){e.isDisposed_||t&&t.type&&("severn"==t.type?e._initShowGoodsBanner(t.data):"ranking"==t.type?e._initRankScroller(t.data):"funds"==t.type&&e._initFunds(t.data))})["catch"](function(e){logger.error(e)})},t.prototype._initFunds=function(e){this._fundInfoPanel.visible=!0,this.fund_text_amount.text="￥"+(e.funds_account.amount/100).toString(),this.fundTime=e.funds_account.expired_at,void 0!=this.fundTime?(this.fund_time.visible=!0,this.fund_text_time.visible=!0,this.fundTimer=new egret.Timer(1e3,0),this.fundTimer.addEventListener(egret.TimerEvent.TIMER,this.updateTime.bind(this),this),this.fundTimer.start(),this.updateTime()):(this.fund_time.visible=!1,this.fund_text_time.visible=!1),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_FUND_BANNER_PREGAME)},t.prototype.updateTime=function(){var e=floor(this.fundTime-Date.now()/1e3);return 0>e?(this._fundInfoPanel.visible=!1,void this.fundTimer.stop()):void(this.fund_text_time.text=xyd.secondsToTimeStringWithDay(e)+"后活动结束")},t}(BaseWindow);__reflect(PreGameWindow.prototype,"PreGameWindow");var RedPacketWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.PROGRESS_BAR_WIDTH=737,n.OPEN_SCALE=1.2,n._usingTimelines=[],n.skinName="resource/skins/RedPacketWindowSkin.exml",n.params_=i,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.UIAnimation()},t.prototype.UIAnimation=function(){var e=this.group_all.verticalCenter;this.group_all.verticalCenter=e-1444;var t=new TimelineMax;this._usingTimelines.push(t),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_all,3*xyd.TweenDeltaTime,{verticalCenter:e+86,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),7*xyd.TweenDeltaTime)},t.prototype.initUIComponent=function(){var e=this,t=xyd.getHeight()/1920;t>1&&(t=1),this.group_all.scaleX=t,this.group_all.scaleY=t,this._barProgress.mask=this._barProgressMask,xyd.setNormalBtnBehavior(this.group_close,this,this.onBtnExit),xyd.setDarkenBtnBehavior(this._threeBonus,this,this.onThreeBonus),xyd.setDarkenBtnBehavior(this.group_share,this,this.onBtnShare),xyd.setDarkenBtnBehavior(this._helpImg,this,this.onBtnHelp),platform.callMethod("GET_GATHER_TASK_GROUP_INFO",{})["catch"](function(e){return console.log(e)}).then(function(t){e.setTaskData(t)}),this.rankingScroller.addEventListener(egret.Event.CHANGE,this.onScroller,this),this.rankingScroller.addEventListener(egret.Event.COMPLETE,this.onScrollerEnd,this)},t.prototype.onScroller=function(e){var t=this.rankingScroller.viewport.scrollV;this.updateIconMe(t)},t.prototype.onScrollerEnd=function(e){var t=this.rankingScroller.viewport.y;this.updateIconMe(t)},t.prototype.updateIconMe=function(e){var t=314,i=-218,n=this.targetMe_;e<this._myScollerYMin?(this._groupMe.visible=!0,this._groupMe.verticalCenter=t,n.bg_mask_.source="mengbanxia_png"):e>this._myScollerYMax?(this._groupMe.visible=!0,this._groupMe.verticalCenter=i,n.bg_mask_.source="mengbanshang_png"):this._groupMe.visible=!1},t.prototype.updateGatheredNum=function(e,t){var i=t[0];e>t[1]?i=t[2]:e>t[0]&&(i=t[1]),this._targetLabel.text=e+"/"+i},t.prototype.addOpenTween=function(e){var t=new TimelineMax;t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:-10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:-15})),t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:15})),t.add(TweenMax.to(e,3*xyd.TweenDeltaTime,{rotation:-10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:10})),t.add(TweenMax.to(e,4*xyd.TweenDeltaTime,{rotation:0})),t.add(TweenMax.to(e,120*xyd.TweenDeltaTime,{})),t.repeat(-1),t.play(),this._usingTimelines.push(t)},t.prototype.setTaskData=function(e){if(e){var t=e,i=t.end_time-(new Date).getTime()/1e3;i/=86400,this._leftTimeLabel.text=Math.ceil(i)+"天",this.updateGatheredNum(t.gathered_num,t.packet_score),0==t.has_extra_reward&&(this._threeBonus.visible=!1,this._threeText.visible=!1);var n=1*t.gathered_num/t.packet_score[2];n>1&&(n=1),this._barProgressMask.scaleX=n;var o=t.packet_status;this._target1.x=Math.floor(t.packet_score[0]*this.PROGRESS_BAR_WIDTH/t.packet_score[2]),this._target2.x=Math.floor(t.packet_score[1]*this.PROGRESS_BAR_WIDTH/t.packet_score[2]),this._target1.visible=!0,this._target2.visible=!0,this._target3.visible=!0,1==o[0]?(this.addOpenTween(this._target1),xyd.setNormalBtnBehavior(this._target1,this,this.onTarget1)):2==o[0]&&(this._target1.source="red_packet_open_png",this._target1.scaleX=.82*this.OPEN_SCALE,this._target1.scaleY=.82*this.OPEN_SCALE),1==o[1]?(this.addOpenTween(this._target2),xyd.setNormalBtnBehavior(this._target2,this,this.onTarget2)):2==o[1]&&(this._target2.source="red_packet_open_png",this._target2.scaleX=.94*this.OPEN_SCALE,this._target2.scaleY=.94*this.OPEN_SCALE),1==o[2]?(this.addOpenTween(this._target3),xyd.setNormalBtnBehavior(this._target3,this,this.onTarget3)):2==o[2]&&(this._target3.source="red_packet_open_png",this._target3.scaleX=this.OPEN_SCALE,this._target3.scaleY=this.OPEN_SCALE),this._myRank=t.self_index,this._myScollerYMin=153*(this._myRank+1)-675,this._myScollerYMax=153*this._myRank,t.rank_data[t.self_index].isMe=!0,this.initScroller(t.rank_data),this.initMe(t.rank_data[t.self_index]),this.updateIconMe(0),t.rank_data.length<5?(this._threeText.text=xyd.__("REDPACKET_TIPS"),this._threeText.visible=!0):this._lineDown&&0==t.has_extra_reward&&(this._lineDown.y+=100,this.rankingList_.height+=100,this.rankingScroller.height+=100)}},t.prototype.initMe=function(e){""==e.avatar&&(e.avatar="bg_jiazaitouxiang_png");var t=this.targetMe_;t.nameLabel_.text=e.nickname,t.rankLabel_.text=e.rank,t.maskImg_.source="touxiangmengban_png",t.avatarImg_.mask=t.maskImg_,t.avatarImg_.source=e.avatar,t.gatheredLabel_.text=e.gathered_num,t.bg_.source="bg_paihangban2_png",1==e.rank?(t.rankLabel_.visible=!1,t.listImg_.visible=!0,t.listImg_.source="stage_rank_1_png"):2==e.rank?(t.rankLabel_.visible=!1,t.listImg_.visible=!0,t.listImg_.source="stage_rank_2_png"):3==e.rank?(t.rankLabel_.visible=!1,t.listImg_.visible=!0,t.listImg_.source="stage_rank_3_png"):(t.listImg_.visible=!1,t.rankLabel_.visible=!0),t.rankLabel_.textColor=12139038,t.nameLabel_.textColor=10559760,t.gatheredLabel_.textColor=12139038},t.prototype.onTarget1=function(){var e=this;platform.callMethod("GAME_SHARE",{type:"collect_mission_packet",params:{index:0}}).then(function(t){if(t.success){e._target1.touchEnabled=!1,e._target1.source="red_packet_open_png",e._target1.scaleX=.82*e.OPEN_SCALE,e._target1.scaleY=.82*e.OPEN_SCALE;for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}e._target1.rotation=0}})["catch"](function(t){for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}logger.error(t)})},t.prototype.onTarget2=function(){var e=this;platform.callMethod("GAME_SHARE",{type:"collect_mission_packet",params:{index:1}}).then(function(t){if(t.success){e._target2.touchEnabled=!1,e._target2.source="red_packet_open_png",e._target2.scaleX=.94*e.OPEN_SCALE,e._target2.scaleY=.94*e.OPEN_SCALE;for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}e._target2.rotation=0}})["catch"](function(t){for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}logger.error(t)})},t.prototype.onTarget3=function(){var e=this;platform.callMethod("GAME_SHARE",{type:"collect_mission_packet",params:{index:2}}).then(function(t){if(t.success){e._target3.touchEnabled=!1,e._target3.source="red_packet_open_png",e._target3.scaleX=e.OPEN_SCALE,e._target3.scaleY=e.OPEN_SCALE;for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}e._target3.rotation=0}})["catch"](function(t){for(var i=0,n=e._usingTimelines;i<n.length;i++){var o=n[i];o.kill()}logger.error(t)})},t.prototype.setTargetProgress=function(){},t.prototype.dispose=function(){for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];
n.kill()}e.prototype.dispose.call(this)},t.prototype.onBtnHelp=function(){xyd.WindowManager.get().openWindow("task_guide_window")},t.prototype.onBtnExit=function(){var e=new TimelineLite;e.add(TweenLite.to(this.group_all,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),e.add(TweenLite.to(this.group_all,2*xyd.TweenDeltaTime,{})),e.call(function(){xyd.WindowManager.get().closeWindow("red_packet_window")})},t.prototype.onThreeBonus=function(){},t.prototype.onBtnShare=function(){platform.callMethod("GAME_SHARE",{type:"general_invite"})["catch"](function(e){return logger.error(e)})},t.prototype.initScroller=function(e){this.rankingCollection_=new eui.ArrayCollection([]);this.rankingCollection_.source=e,this.rankingList_.dataProvider=this.rankingCollection_,this.rankingList_.itemRenderer=TargetListItemRenderer,this.rankingCollection_.refresh(),this.rankingScroller.visible=!0,this.validateNow()},t.prototype.willClose=function(){e.prototype.willClose.call(this),this.params&&this.params.onComplete&&this.params.onComplete()},t}(BaseWindow);__reflect(RedPacketWindow.prototype,"RedPacketWindow");var SevernMapWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._gotoType=0,n.skinName="resource/skins/SevernMapWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){SoundManager.getInstance().playBg("bgm_map_mp3"),e.prototype.childrenCreated.call(this),this.initUIComponent()},t.prototype.initUIComponent=function(){platform.inDebugMode()&&(this.btn_test1.visible=!0,this.btn_test2.visible=!0,this.btn_level.visible=!0,this.btn_pdd_spring_fes.visible=!0,xyd.setNormalBtnBehavior(this.btn_test1,this,this.onBtnTest1),xyd.setNormalBtnBehavior(this.btn_test2,this,this.onBtnTest2),xyd.setNormalBtnBehavior(this.btn_level,this,this.onBtnLevel),xyd.setDarkenBtnBehavior(this.btn_pdd_spring_fes,this,this.onBtnLevelSpringFes),xyd.setDarkenBtnBehavior(this.pre_game_pdd_spring_fes,this,this.onStartSpringFes))},t.prototype.onBtnTest1=function(){this._gotoType=1,ABTest.get().getSetting(ABTest.SEVERN_MAP)&&MainController.get().h5GoToMap(xyd.MainStageType.StageMap)},t.prototype.onBtnTest2=function(){this._gotoType=2,ABTest.get().getSetting(ABTest.SEVERN_MAP)&&MainController.get().h5GoToMap(xyd.MainStageType.HomeMap)},t.prototype.onBtnLevel=function(){var e={};if(!MainController.get().isInGame()){var t=SelfInfo.get().getCurrentLevel(),i=!1;t=void 0==e||void 0==e.level||isNaN(e.level)?SelfInfo.get().getCurrentLevel():e.level>t?SelfInfo.get().getCurrentLevel():e.level;var n;e&&(i=e.lottery_text,n=e.scene_id);var o;e&&(o=e.need_replace_leaderboard),t=Math.min(t,xyd.MAX_STAGE),xyd.WindowManager.get().closeWindow("pre_game_window"),logger.logStep("E:start-"+t),xyd.WindowManager.get().openWindow("pre_game_window",{totalLevel:t,lottery_text:i,scene_id:n,needReplaceLeaderboard:o})}},t.prototype.onBtnLevelSpringFes=function(){this.pre_game_pdd_spring_fes.visible=!this.pre_game_pdd_spring_fes.visible},t.prototype.onStartSpringFes=function(){var e={level:1,mission_info:{mission_id:1,mission_level:2,active_item_list:[ItemConstants.COLOR_BOMB_TIME,ItemConstants.LINE_SQUARE_BOMB_PACK,ItemConstants.CRAYON_TIME,ItemConstants.LINE_BOMB],item_lock:!1}};e&&e.mission_info&&(SelfInfo.get().isInMission=!0);var t=[];if(SelfInfo.get().isInMission){var i=e.mission_info.active_item_list;if(i&&i.length>0)for(var n=0,o=i;n<o.length;n++){var a=o[n];t.push(Number(a))}SelfInfo.get().missionLevel=e.mission_info.mission_level||0,SelfInfo.get().missionID=e.mission_info.mission_id||0,SelfInfo.get().missionItemLock=1==e.mission_info.item_lock}var s=Math.min(SelfInfo.get().getCurrentLevel(),xyd.MAX_STAGE);e&&e.level&&(s=SelfInfo.get().isInMission?e.level:Math.min(s,e.level));var r=-1,l=-1;if(10>=s)r=1,l=s;else if(20>=s)r=2,l=s-10;else{var _=s-5;r=Math.floor(_/15)+2,_%=15,0==_?(r--,l=15):l=_}platform.callMethod("GAME_PRE_BEGIN",{show:!1,confirmed:!0,chapter:r,level:l,total_level:s}).then(function(e){if(e.success){SoundManager.getInstance().playBg("bgm_level_mp3"),xyd.WindowManager.get().closeWindow("stage_window"),xyd.WindowManager.get().closeWindow("pre_game_window"),xyd.WindowManager.get().closeWindow("severn_map_window"),xyd.WindowManager.get().closeWindow("map_window");var i=new GameConf;i.init(s);var n=MainController.get().initGameFromConf(i),o=i.scoreTargets[0];if(n.setScoreTarget(o),e.funds&&n.setFundActivity(e.funds.init_count,e.funds.drop_count),SelfInfo.get().isInMission)n.setActiveItemList(t);else{var a=i.pregameItemList;if(ABTest.get().getSetting(ABTest.NEWUSER_BENEFITS)&&SelfInfo.get().getCurrentLevel()>=11&&SelfInfo.get().getCurrentLevel()<=50){var r=Math.ceil(4*Math.random());SelfInfo.get().newUserBenefitsItemID=a[r-1]}for(var l=[],_=0,h=a;_<h.length;_++){var c=h[_],d=String(ItemConstants.LIMITED_TIME_OFFSET+c),p=SelfInfo.get().getItemNumByID(d);(p||SelfInfo.get().newUserBenefitsItemID==c)&&l.push(c)}n.setActiveItemList(l)}var u=[RES.loadGroup("game"),RES.loadGroup("game_eff")];Promise.all(u).then(function(){xyd.EventDispatcher.inner().dispatchEvent(new egret.Event(xyd.event.GAME_START,!1,!1,{isDirectly:!0}))})}})["catch"](function(e){logger.error(e)})},t}(BaseWindow);__reflect(SevernMapWindow.prototype,"SevernMapWindow");var TileType;!function(e){e[e.HEAD=0]="HEAD",e[e.MIDDLE_1=1]="MIDDLE_1",e[e.MIDDLE_2=2]="MIDDLE_2",e[e.TAIL=3]="TAIL"}(TileType||(TileType={}));var StageMap=function(e){function t(t,i){var n=e.call(this)||this;return n.usingEff_=[],n._isDisposed=!1,n._usingTween=[],n._canPlayAvatarAnim=!1,n._hasCheckedWinPacket=!1,n._shouldOpenNextLevel=!1,n._hasCheckedPacketGuide=!1,n._hasPlayedAvatarAnim=!1,n._playAnimAfterLoad=!1,n._hasCheckedPddPopups=!1,n._hasCheckedClearStreakRewardPopups=!1,n._hasCheckedClearStreakGuidePopups=!1,n._hasCheckedGatherTask=!0,n._hasCheckedMonthCardGuide=!0,n._hasCheckedMonthCardLevelUp=!1,n._firstWin=!1,n.STAGE_EFF_OFFSET_Y=42,n._friendsRanking={},n._friendsRankDataGot=!1,n._friendAvarts=[],n.ICON_ME_HEIGHT=152,n.ICON_ME_WIDTH=138,n.LEVEL_BTN_HEIGHT=92,n._lastScrollY=0,n._clearStageGifts={},n.userTriggeredClick=!1,n.MIDDLE_HEIGHT=2131,n.minY=0,n.maxY=0,n.nowMapIndex=0,n.minScrollerY=0,n.maxScrollerY=0,n.centerScrollerY=0,n._isDragging=!1,n.AUTO_SCROLL_TIME=1e3,n.MAX_SPEED=1.92,n.lastTime_=0,n.speed_=void 0,n.acc_=void 0,n.parent_=t,n.params_=i,platform.callMethod("GET_FRIENDS_RANKING",{}).then(function(e){void 0!=e&&void 0!=e.rank_data&&n._setFriendRankingInfo(e.rank_data)})["catch"](function(e){return logger.error(e)}),n}return __extends(t,e),t.prototype._setFriendRankingInfo=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];this._friendsRanking[n.level]=n}this._friendsRankDataGot=!0;for(var o=0,a=this.wraps_;o<a.length;o++){var s=a[o];this.setFriendAvatarsOnMapWrap(s)}},t.prototype.init=function(){if(this.initMap(),this.params_){if(this.params_.win){var e=this.params_.total_level,t=(SelfInfo.get().getCurrentLevel(),SelfInfo.get().getClearStreak());e==xyd.MAX_STAGE?(this._canPlayAvatarAnim=!1,this._hasCheckedPacketGuide=!0):this.params_.is_first_win?(this._canPlayAvatarAnim=!0,this._shouldOpenNextLevel=!0,this._firstWin=!0):this._hasCheckedPacketGuide=!0,1>t?this._hasCheckedClearStreakRewardPopups=!0:1!=t&&(this._hasCheckedClearStreakGuidePopups=!0),SelfInfo.get().shouldOpenGatherTaskWin&&(SelfInfo.get().shouldOpenGatherTaskWin=!1,this._hasCheckedGatherTask=!1),SelfInfo.get().showMonthCardGuide&&(SelfInfo.get().showMonthCardGuide=!1,this._hasCheckedMonthCardGuide=!1)}else this._hasCheckedPddPopups=!0;this._updatePopups()}else this._hasCheckedPddPopups=!0,this._hasCheckedClearStreakRewardPopups=!0,this._hasCheckedClearStreakGuidePopups=!0,this._updatePopups()},t.prototype.initMap=function(){t.MAX_PAGE_COUNT=LevelTable.get().getMaxWarp(!ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE)),this.selfInfo=SelfInfo.get(),this.totalMap_=8,this.selfMap_=this.selfInfo.getCurrentLevel(),this.stageBgHeight_=[1536,1066,1066,1785],xyd.isLowEndDevice?ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE)?this.stageBgPng_=["stage_head_low","stage_middle1_low","stage_middle2_low","stage_middle1_low","stage_middle2_low","stage_tail2_low","stage_head_low","stage_tail2_low"]:this.stageBgPng_=["stage_head_low","stage_middle1_low","stage_middle2_low","stage_middle3_low","stage_middle4_low","stage_tail_low","stage_head_new_low","stage_tail2_low"]:ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE)?this.stageBgPng_=["stage_head","stage_middle1","stage_middle2","stage_middle1","stage_middle2","stage_tail2","stage_head","stage_tail2"]:this.stageBgPng_=["stage_head","stage_middle1","stage_middle2","stage_middle3","stage_middle4","stage_tail","stage_head_new","stage_tail2"],this.scrollView_=new egret.DisplayObjectContainer,this.scrollView_.width=xyd.mapWidth,this.addChild(this.scrollView_),this.scrollViewDisplay_=new egret.DisplayObjectContainer,this.scrollViewDisplay_.name="ScrollViewDisplay",this.scrollViewDisplay_.width=xyd.mapWidth,this.scrollView_.addChild(this.scrollViewDisplay_),this.scrollVieTopMe_=new egret.DisplayObjectContainer,this.scrollVieTopMe_.width=xyd.mapWidth,this.scrollView_.addChild(this.scrollVieTopMe_),this.wraps_=[],this.wrapIconMe_=new PlayerAvatar(!0),this.wrapIconMeCash_=new PlayerAvatarCash,this.wrapIconMe_.x=-500,this.wrapIconMe_.visible=!1,this.wrapIconMeCash_.x=-500,this.wrapIconMeCash_.visible=!1,this.canPlayAvatarAnim()||(this.wrapIconMe_.visible=!0,this.wrapIconMeCash_.visible=!0),this.MIDDLE_HEIGHT=this.getBgHeight(TileType.MIDDLE_1);var e=this.totalMap_-1,i=this.getBgPngName(TileType.TAIL),n=this.getBgHeight(TileType.TAIL)+1;this.wraps_[e]=new MapWrap(this,i,xyd.mapWidth,n,TileType.TAIL),this.wraps_[e].topContainer.y=-((t.MAX_PAGE_COUNT-1-1)*this.MIDDLE_HEIGHT+n),this.wraps_[e].topOneContainer.y=-((t.MAX_PAGE_COUNT-1-1)*this.MIDDLE_HEIGHT+n),this.wraps_[e].bg.y=-((t.MAX_PAGE_COUNT-1-1)*this.MIDDLE_HEIGHT+n),this.wraps_[e].bg.y+=1,this.maxY=(t.MAX_PAGE_COUNT-1-1)*this.MIDDLE_HEIGHT+n,this.scrollViewDisplay_.addChildAt(this.wraps_[e].bg,0),this.scrollViewDisplay_.addChildAt(this.wraps_[e].topContainer,209),this.wraps_[e].update(t.MAX_PAGE_COUNT);var o=-(this.MIDDLE_HEIGHT*(this.totalMap_-2));for(e=this.totalMap_-2;e>=0;e--){var a=this.getTileTypeByIndex(e+1),s=this.getBgPngName(a);n=this.getBgHeight(a)+1,this.wraps_[e]=new MapWrap(this,s,xyd.mapWidth,n,a),0==e&&(o-=8),this.wraps_[e].bg.y=o,this.wraps_[e].topContainer.y=o,this.wraps_[e].topOneContainer.y=o,o+=n,0==e?this.scrollViewDisplay_.addChildAt(this.wraps_[e].bg,5):this.scrollViewDisplay_.addChildAt(this.wraps_[e].bg,0),this.scrollViewDisplay_.addChildAt(this.wraps_[e].topContainer,99)}this.minY=-(o-xyd.getHeight());var r;if(this._canPlayAvatarAnim||(r=MainController.get().lastStageY,this.params_&&this.params_.win&&this.params_.total_level+1==this.selfMap_&&(r=void 0)),r)this.scrollView_.y=r;else{var l=LevelTable.get().getTableData(this.selfMap_),_=!ABTest.get().getSetting(ABTest.NEW_STAGE_MAP_STYLE),h=void 0;h=_?l.wrapNoWheel:l.wrap;var c=void 0;c=_?l.y_pos_new:l.y_pos,r=(h-2)*this.stageBgHeight_[1]+xyd.getHeight()/2+c,this.selfMap_<8?this.scrollView_.y=xyd.getHeight()-(this.getBgHeight(TileType.HEAD)-4):this.scrollView_.y=r}this.UpdatePos(),this.initTouch();var d=SelfInfo.get().getAvatar();for(d&&""!=d&&(this.wrapIconMe_.setAvatar(d),this.wrapIconMeCash_.setAvatar(d)),this.scrollVieTopMe_.addChild(this.wrapIconMe_),this.scrollVieTopMe_.addChild(this.wrapIconMeCash_),e=this.totalMap_-1,this.scrollViewDisplay_.addChildAt(this.wraps_[e].topOneContainer,210),e=this.totalMap_-2;e>=0;e--)this.scrollViewDisplay_.addChildAt(this.wraps_[e].topOneContainer,100);this._timer=new egret.Timer(200,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.checkMapEffect,this),this._timer.start()},t.prototype.updateRecords=function(e){for(var t=0;t<this.wraps_.length;t++)this.wraps_[t].updateRecord(e)},t.prototype.playNextStageAnimation=function(){var e;if(void 0==this._animationWrap)return void(1==this._playAnimAfterLoad);var t=this._animationWrap,i=this._animationIndex,n=t.topContainer.y;if(i>0)e=t.btnGroups[i-1];else if(t.tileIdx>1)for(var o=this.getWrapByTileIdx(t.tileIdx-1),a=o.btnGroups.length-1;a>=0;a--)if(o.btnGroups[a].visible){e=o.btnGroups[a],n=o.topContainer.y;break}e&&this.playAnim(e.x,e.y+n-this.LEVEL_BTN_HEIGHT,this.wrapIconMe_.x,this.wrapIconMe_.y,e)},t.prototype.setGiftBoxOnMapWrap=function(e){if(SelfInfo.get().clearStagetInfo&&e.isInited())for(var t=SelfInfo.get().getCurrentLevel(),i=0;i<e.btnGroups.length;i++){var n=e.btnGroups[i];if(n.visible&&n.level&&n.level>=t&&void 0==this._clearStageGifts[n.level]&&void 0!=SelfInfo.get().clearStagetInfo[String(n.level)]){var o=new egret.Point(n.x-80,n.y+e.topContainer.y-150-this.LEVEL_BTN_HEIGHT),a=SelfInfo.get().clearStagetInfo[String(n.level)],s=new StageGiftBox(a,o);this.scrollViewDisplay_.addChild(s),this._clearStageGifts[n.level]=s}}},t.prototype.setFriendAvatarsOnMapWrap=function(e){if(this._friendsRankDataGot&&e.isInited())for(var t=0;t<e.btnGroups.length;t++){var i=e.btnGroups[t];if(i.visible&&i.level){if(SelfInfo.get().clearStagetInfo&&i.level>=SelfInfo.get().getCurrentLevel()&&void 0!=SelfInfo.get().clearStagetInfo[String(i.level)])continue;void 0!=this._friendsRanking[i.level]&&this._setFriendAvatarOnBtn(e,t,i.level)}}},t.prototype._setFriendAvatarOnBtn=function(e,t,i){if(void 0==this._friendAvarts[i]){var n=new PlayerAvatar(!1);n.touchEnabled=!1;var o=this._friendsRanking[i];void 0!=o&&""!=o.avatar&&n.setAvatar(o.avatar);var a=e.btnGroups[t];n.y=a.y+e.topContainer.y-this.LEVEL_BTN_HEIGHT,n.x=a.x,this.scrollViewDisplay_.addChild(n),this._friendAvarts[i]=n}},t.prototype.setAvatarPos=function(e,t){var i=e.btnGroups[t];i&&(this._animationIndex&&0!=this.wrapIconMe_.x||(this.wrapIconMe_.y=i.y+e.topContainer.y-this.LEVEL_BTN_HEIGHT,this.wrapIconMe_.x=i.x,this.wrapIconMeCash_.y=this.wrapIconMe_.y,this.wrapIconMeCash_.x=this.wrapIconMe_.x),this.firstWin()&&(this.wrapIconMe_.visible=!1,this.wrapIconMeCash_.visible=!1),this._canPlayAvatarAnim||(this.wrapIconMe_.visible=!0,this.wrapIconMeCash_.visible=!0),this._animationWrap=e,this._animationIndex=t,this._stageEff||(this.firstWin()||xyd.isLowEndDevice||EffectFactory.get().newEffect("fx_ui_kuoquan",function(e){return this._disposed||this._stageEff?void EffectFactory.get().pushBackEffect(e):(this._stageEff=e,this.firstWin()&&(this._stageEff.visible=!1),e.y=this.ICON_ME_HEIGHT+this.STAGE_EFF_OFFSET_Y,e.x=this.ICON_ME_WIDTH/2,this.wrapIconMe_.addChild(e),void e.animation.play("texiao01",-1))}.bind(this)),(this._playAnimAfterLoad||this._canPlayAvatarAnim&&this._hasCheckedWinPacket)&&(this.playNextStageAnimation(),this._canPlayAvatarAnim=!1,this._playAnimAfterLoad=!1)))},t.prototype.initTouch=function(){var e=this;this.scrollView_.touchEnabled=!0,this.scrollView_.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpDown,this),this.scrollView_.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDrag,this),this.scrollView_.addEventListener(egret.TouchEvent.TOUCH_END,this.onOpUp,this),this.scrollView_.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){egret.setTimeout(function(){e._isDragging=!1},e,50)},this),this.scrollView_.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){egret.setTimeout(function(){e._isDragging=!1},e,50)},this)},t.prototype.UpdatePos=function(){this.parent_.onOperation();var e=1;e=this.scrollView_.y<=0?1:this.scrollView_.y>=(t.MAX_PAGE_COUNT-1-1)*this.MIDDLE_HEIGHT?t.MAX_PAGE_COUNT:Math.ceil(this.scrollView_.y/this.MIDDLE_HEIGHT)+1;for(var i=e-3;e+1>=i;i++)if(!(1>=i||i>=t.MAX_PAGE_COUNT)){var n=this.getWrapByTileIdx(i),o=-(i-1)*this.MIDDLE_HEIGHT;(n.bg.y!=o||n.tileIdx!=i)&&(n.topContainer.y=o,n.topOneContainer.y=o,n.bg.y=o,n.update(i))}},t.prototype.checkMapEffect=function(){for(var e=0;e<this.totalMap_;e++){var t=this.wraps_[e];t&&t.updateMapEffectState(this.scrollView_.y)}if(this._lastScrollY==this.scrollView_.y)for(var e=0;e<this.totalMap_;e++){var t=this.wraps_[e];t&&t.updateMapMovingEffect(this.scrollView_.y)}else this._lastScrollY=this.scrollView_.y},t.prototype.getWrapByTileIdx=function(e){if(1>=e)return this.wraps_[0];if(e>=t.MAX_PAGE_COUNT)return this.wraps_[this.totalMap_-1];var i=(e-2)%(this.totalMap_-2)+1;return this.wraps_[i]},t.prototype.onUpdate=function(){},t.prototype.dispose=function(){this._isDisposed=!0,this.parent&&this.parent.removeChild(this);for(var e=0,t=this._usingTween;e<t.length;e++){var i=t[e];i.kill()}this._timer&&this._timer.stop();for(var n in this._clearStageGifts)this._clearStageGifts[n].dispose();if(this._clearStageGifts={},this.usingEff_)for(var o=0,a=this.usingEff_;o<a.length;o++){var s=a[o];s.animation.stop(),s.parent&&s.parent.removeChild(s),EffectFactory.get().pushBackEffect(s)}for(var r=0,l=this.wraps_;r<l.length;r++){var _=l[r];_.dispose()}this._stageEff&&(this._stageEff.animation.stop(),this._stageEff.parent&&this._stageEff.parent.removeChild(this._stageEff),EffectFactory.get().pushBackEffect(this._stageEff)),this.wrapIconMeCash_&&this.wrapIconMeCash_.dispose(),this.removeEventListener(egret.Event.ENTER_FRAME,this.autoScroll,this)},t.prototype.getBgHeight=function(e){return this.stageBgHeight_[e]},t.prototype.getBgPngName=function(e){return e==TileType.HEAD?this.stageBgPng_[6]:e==TileType.TAIL?this.stageBgPng_[5]:this.stageBgPng_[e+2]},t.prototype.getTileTypeByIndex=function(e){return e>=t.MAX_PAGE_COUNT?TileType.TAIL:1>=e?TileType.HEAD:e%2==0?TileType.MIDDLE_1:TileType.MIDDLE_2},t.prototype.onOpUp=function(e){var t=this;if(this._lastTouchID==e.touchPointID){egret.setTimeout(function(){t._isDragging=!1},this,500);var i=Date.now();this.lastTime_&&this.speed_?i-this.lastTime_<=30&&0!=this.speed_?(Math.abs(this.speed_)>this.MAX_SPEED&&(this.speed_=this.speed_/Math.abs(this.speed_)*this.MAX_SPEED),this.acc_=(0-this.speed_)/this.AUTO_SCROLL_TIME,this.addEventListener(egret.Event.ENTER_FRAME,this.autoScroll,this)):(this.lastTime_=void 0,this.speed_=void 0):this.lastTime_=void 0,this.lastMousePosX_=void 0,this.lastMousePosY_=void 0,this.nowMousePosX_=void 0,this.nowMousePosY_=void 0}},t.prototype.onOpDown=function(e){this._lastTouchID=e.touchPointID,0!=e.stageX||0!=e.stageY?(this.lastMousePosX_=e.stageX,this.lastMousePosY_=e.stageY,this.nowMousePosX_=e.stageX,this.nowMousePosY_=e.stageY,this.lastTime_=Date.now(),this.speed_&&(this.speed_=void 0,this.removeEventListener(egret.Event.ENTER_FRAME,this.autoScroll,this))):(this.lastMousePosX_=void 0,this.lastMousePosY_=void 0,this.nowMousePosX_=void 0,this.nowMousePosY_=void 0)},t.prototype.onDrag=function(e){if(this._lastTouchID==e.touchPointID&&void 0!=this.lastMousePosX_&&void 0!=this.lastMousePosY_){var t=Date.now();this.nowMousePosX_=e.stageX,this.nowMousePosY_=e.stageY;var i=1,n=(this.nowMousePosY_-this.lastMousePosY_)*i;this.lastTime_&&(this.speed_=n/(t-this.lastTime_),Math.abs(n)>5&&(this._isDragging=!0)),this.scrollView_.y+=n,this.scrollView_.y>=this.maxY?(this.scrollView_.y=this.maxY,this.speed_=0):this.scrollView_.y<=this.minY&&(this.scrollView_.y=this.minY,this.speed_=0),this.lastMousePosX_=e.stageX,this.lastMousePosY_=e.stageY,this.lastTime_=t,this.UpdatePos()}},t.prototype.autoScroll=function(){if(this.lastTime_){var e=Date.now(),t=e-this.lastTime_;this.lastTime_=e,this.scrollView_.y+=this.speed_*t,this.scrollView_.y>=this.maxY?(this.scrollView_.y=this.maxY,this.speed_=0):this.scrollView_.y<=this.minY?(this.scrollView_.y=this.minY,this.speed_=0):this.speed_+=this.acc_*t,(0==this.speed_||this.speed_/this.acc_>0)&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.autoScroll,this),this.acc_=void 0,this.speed_=void 0,this.lastTime_=void 0),this.UpdatePos()}},t.prototype.enterStage=function(e){this.parent_.onOperation(),e>this.selfMap_&&!platform.inAutoMode()||e>xyd.MAX_STAGE||this._isDragging||this.canClick()&&(this.userTriggeredClick=!0,MainController.get().lastStageY=this.scrollView_.y,MainController.get().onPreGame(e))},t.prototype.openIcon=function(e){e>=this.selfMap_&&!platform.inAutoMode()||e>xyd.MAX_STAGE||this._isDragging||!this.canClick()},t.prototype.iconClose=function(e){},t.prototype.redPacketOpen=function(e){if(!this._isDragging){for(var t,i=0;i<this.wraps_.length;i++){var n=this.wraps_[i],o=n.getStartLevel(),a=n.getEndLevel();if(e>=o&&a>e){var s=e-o;if(n.btnGroups[s].visible){t=n.btnGroups[s];break}}}t&&t.setRedPacketData(t.type,2)}},t.prototype._updatePopups=function(){this._hasPlayedAvatarAnim?this._updatePopupsAfterAnim():this._updatePopupsBeforeAnim()},t.prototype._updatePopupsBeforeAnim=function(){var e=this;this._hasCheckedWinPacket?this._hasCheckedPddPopups?this._canPlayAvatarAnim?(this.playNextStageAnimation(),egret.setTimeout(function(){e._hasPlayedAvatarAnim=!0,e._canPlayAvatarAnim=!1,e._updatePopups()},this,3e3)):(this._hasPlayedAvatarAnim=!0,this._updatePopupsAfterAnim()):this._checkPddPopups():this._checkWinPacket()},t.prototype._updatePopupsAfterAnim=function(){this._hasCheckedPacketGuide?this._hasCheckedMonthCardLevelUp?this._hasCheckedClearStreakRewardPopups?this._hasCheckedClearStreakGuidePopups?this._hasCheckedGatherTask?this._hasCheckedMonthCardGuide?this._shouldOpenNextLevel&&(this.enterStage(this.selfMap_),this._shouldOpenNextLevel=!1,this._updatePopups()):this._checkMonthCardGuide():this._checkGatherTaskWin():this._checkClearStreakGuide():this._checkClearStreakReward():this._checkMonthCardLevelUp():this._checkPacketGuide()},t.prototype._checkClearStreakReward=function(){var e=this;this._hasCheckedClearStreakRewardPopups=!0;var t=function(){e._updatePopups()},i=SelfInfo.get().getClearStreak();i>=1?xyd.WindowManager.get().openWindow("clear_streak_reward_window",{onComplete:t}):this._updatePopups()},t.prototype._checkClearStreakGuide=function(){var e=this;this._hasCheckedClearStreakGuidePopups=!0;var t=function(){e._updatePopups()},i=SelfInfo.get().getClearStreak();i>=1?xyd.WindowManager.get().openWindow("clear_streak_window",{onComplete:t}):this._updatePopups()},t.prototype._checkGatherTaskWin=function(){var e=this;if(this._hasCheckedGatherTask=!0,!SelfInfo.get().getShareInfoWithKey("collect_mission_packet"))return void this._updatePopups();var t=function(){e._updatePopups()};xyd.WindowManager.get().openWindow("red_packet_window",{onComplete:t})},t.prototype.canClick=function(){return this._hasCheckedPddPopups&&!this._canPlayAvatarAnim&&this._hasCheckedWinPacket&&this._hasCheckedPacketGuide&&this._hasCheckedClearStreakRewardPopups&&this._hasCheckedClearStreakGuidePopups},t.prototype._checkWinPacket=function(){var e=this,t=function(){e._hasCheckedWinPacket=!0,e._updatePopups()};if(this.params_&&this.params_.win){var i=ABTest.get().getSetting(ABTest.NEWUSER_STAGE_CASH_REWARD)&&1==this.params_.total_level&&SelfInfo.get().isFirstWin(),n=SelfInfo.get().isFirstTenLevel(this.params_.total_level)&&SelfInfo.get().isFirstWin();if(i||n)return void platform.callMethod("NEWUSER_STAGE_CASH_REWARD",{}).then(t)["catch"](t)}if(this.params_&&this.params_.win){this.params_.total_level;SelfInfo.get().showLuckyWheel?SelfInfo.get().showLuckyWheel=!1:t()}else t()},t.prototype._checkPddPopups=function(){var e=this,t=function(){e._hasCheckedPddPopups=!0,e._updatePopups()};platform.callMethod("GAME_SHOW_MAP_POPUPS",this.params_).then(t)["catch"](t)},t.prototype._checkMonthCardLevelUp=function(){var e=this;this._hasCheckedMonthCardLevelUp=!0;var t=function(){e._updatePopups()};if(void 0==SelfInfo.get().lastMonthlyCardLevel||void 0==SelfInfo.get().monthlyCardLevel)return void t();if(SelfInfo.get().lastMonthlyCardLevel<SelfInfo.get().monthlyCardLevel){var i=SelfInfo.get().lastMonthlyCardLevel,n=SelfInfo.get().monthlyCardLevel;SelfInfo.get().lastMonthlyCardLevel=SelfInfo.get().monthlyCardLevel,xyd.WindowManager.get().openWindow("month_card_level_up_window",{old_level:i,new_level:n,onComplete:t})}else t()},t.prototype._checkMonthCardGuide=function(){var e=this;this._hasCheckedMonthCardGuide=!0;var t=function(){e._updatePopups()};xyd.WindowManager.get().openWindow("month_card_window",{has_guide:!0,guide_step:-1,onComplete:t})},t.prototype._checkPacketGuide=function(){var e=this;this._hasCheckedPacketGuide=!0;var t=LevelTable.get(),i=function(){e._updatePopups()};if(this.params_&&this.params_.win){var n=this.params_.total_level,o=t.getNextPacketGuide(n);2==o?i():this._updatePopups()}else this._updatePopups()},t.prototype.setScrollDistance=function(e){var t=xyd.getHeight()-(this.getBgHeight(TileType.HEAD)-4);this.scrollView_.y=e+t,this.UpdatePos(),this.parent_.validateNow()},t.prototype.playAnim=function(e,t,i,n,o){var a=this;this.wrapIconMe_.x=e,this.wrapIconMe_.y=t,this.wrapIconMe_.visible=!0,this.wrapIconMeCash_.x=e,this.wrapIconMeCash_.y=t,this.wrapIconMeCash_.visible=!0,this._stageEff&&(this._stageEff.visible=!0);var s=3;this.params_&&(s=this.params_.stars);for(var r=0;3>r;r++){var l=o.getStar(r);l.texture=RES.getRes("icon_star2_png")}var _=0;s>=1&&EffectFactory.get().newEffect("xxl_huoxing",function(i){i.x=e-62+19,i.y=t+75+19+_,this.scrollView_.addChild(i),i.animation.play("texiao01",1);var n=function(e){i.removeDBEventListener("complete",n,this),i.animation.stop(),o.getStar(0).texture=RES.getRes("icon_star1_png"),i.parent&&i.parent.removeChild(i),EffectFactory.get().pushBackEffect(i)};i.addDBEventListener("complete",n,this)}.bind(this)),s>=2&&egret.setTimeout(function(){EffectFactory.get().newEffect("xxl_huoxing",function(i){i.x=e-20+19,i.y=t+85+17+_,this.scrollView_.addChild(i),i.animation.play("texiao01",1);var n=function(e){i.removeDBEventListener("complete",n,this),o.getStar(1).texture=RES.getRes("icon_star1_png"),i.animation.stop(),i.parent&&i.parent.removeChild(i),EffectFactory.get().pushBackEffect(i)};i.addDBEventListener("complete",n,this)}.bind(a))},this,500),s>=3&&egret.setTimeout(function(){EffectFactory.get().newEffect("xxl_huoxing",function(i){i.x=e+22+19,i.y=t+75+19+_,this.scrollView_.addChild(i),i.animation.play("texiao01",1);var n=function(e){i.removeDBEventListener("complete",n,this),i.animation.stop(),o.getStar(2).texture=RES.getRes("icon_star1_png"),i.parent&&i.parent.removeChild(i),EffectFactory.get().pushBackEffect(i)};i.addDBEventListener("complete",n,this)}.bind(a))},this,1e3);var h=new TimelineMax;this._usingTween.push(h);var c=10*xyd.TweenDeltaTime;h.add(TweenMax.to(this.wrapIconMe_,2*s*c,{})),h.add(TweenMax.to(this.wrapIconMe_,2*c,{bezier:[{x:(i+e)/2,y:(n+t)/2-180},{x:i,y:n}],ease:Sine.easeIn,autoRotate:!1})),h.add(TweenLite.to(this.wrapIconMeCash_,2*c,{bezier:[{x:(i+e)/2,y:(n+t)/2-180},{x:i,y:n}],ease:Sine.easeIn,autoRotate:!1})),h.add(TweenLite.to(this.wrapIconMe_,4*xyd.TweenDeltaTime,{scaleX:1.06,scaleY:.93}),7*c),h.add(TweenLite.to(this.wrapIconMe_,3*xyd.TweenDeltaTime,{scaleX:.99,scaleY:1.02}),8*c+4*xyd.TweenDeltaTime),h.add(TweenLite.to(this.wrapIconMe_,3*xyd.TweenDeltaTime,{scaleX:1,scaleY:1}),8*c+7*xyd.TweenDeltaTime),h.call(function(){a._stageEff||EffectFactory.get().newEffect("fx_ui_kuoquan",function(e){return this._disposed||this._stageEff?void EffectFactory.get().pushBackEffect(e):(this._stageEff=e,e.y=this.ICON_ME_HEIGHT+this.STAGE_EFF_OFFSET_Y,e.x=this.ICON_ME_WIDTH/2,this.wrapIconMe_.addChild(e),void e.animation.play("texiao01",-1))}.bind(a))}),h.add(TweenLite.to(this.wrapIconMe_,25*xyd.TweenDeltaTime,{}),8*c+10*xyd.TweenDeltaTime),h.call(function(){a.wrapIconMe_.visible=!0,a.wrapIconMeCash_.visible=!0,a._hasPlayedAvatarAnim=!0,a._canPlayAvatarAnim=!1})},t.prototype.canPlayAvatarAnim=function(){return this._canPlayAvatarAnim},t.prototype.getUsingTween=function(){return this._usingTween},t.prototype.firstWin=function(){return this._firstWin},t.prototype.iconMe=function(){return this.wrapIconMe_},t.prototype.checkHasPlayedAvatarAnim=function(){return this._hasPlayedAvatarAnim},t.prototype.updateView=function(){SelfInfo.get().getCashOpen()?(this.wrapIconMeCash_.showView(),this.wrapIconMeCash_.changeNum(),this.wrapIconMe_.hideView()):(this.wrapIconMe_.showView(),this.wrapIconMeCash_.hideView(),this.wrapIconMeCash_.destroyNum())},t.stageBgCount_=[8,11,12,10],t.MAX_PAGE_COUNT=1,t}(egret.DisplayObjectContainer);__reflect(StageMap.prototype,"StageMap");var StageRankSendWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.OPEN_SCALE=1.2,n._usingTimelines=[],n._alreadyReceived=!1,n._isRequestingClaim=!1,n._isRequestingSend=!1,n.skinName="resource/skins/StageRankSendWindowSkin.exml",n.params_=i,n._receivedStamina=i.receivedStamina,n._sendBackStaminaList=[],n._canSendCount=0,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.UIAnimation()},t.prototype.UIAnimation=function(){var e=this.group_all.verticalCenter;this.group_all.verticalCenter=e-1444;var t=new TimelineLite;this._usingTimelines.push(t),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_all,3*xyd.TweenDeltaTime,{verticalCenter:e+86,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),7*xyd.TweenDeltaTime)},t.prototype.onReceive=function(){var e=this;if(!this._isRequestingClaim){this._isRequestingClaim=!0;for(var t=[],i=0,n=this._receivedStamina;i<n.length;i++){var o=n[i];t.push(o.uin)}platform.callMethod("LEADERBOARD_CLAIM_STAMINA",{uin_list:t}).then(function(t){if(e._isRequestingClaim=!1,t.success){var i=xyd.WindowManager.get().getWindow("stage_rank_window");i&&i.updateReceiveNum(e._receivedStamina.length),t.send_list.length>0?(e._sendBtnText.visible=!0,e._receivedNumText.text=xyd.__("STAGERANK_SENDBACK"),e._alreadyReceived=!0,e._heart.visible=!1,e._receiveBtnText.visible=!1,e._receiveNum.visible=!1,e._sendBackStaminaList=t.send_list,e.refreshScroller(e._sendBackStaminaList),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_LEADERBOARD_ONE_CLICK_SEND_BTN)):xyd.WindowManager.get().closeWindow("stage_rank_send_window")}})["catch"](function(t){logger.error(t),e._isRequestingClaim=!1})}},t.prototype.onSend=function(){var e=this;if(!this._isRequestingSend){this._isRequestingSend=!0;for(var t=[],i=0,n=this._sendBackStaminaList;i<n.length;i++){var o=n[i];t.push(o.uin)}platform.callMethod("LEADERBOARD_SEND_STAMINA",{uin_list:t}).then(function(i){if(e._isRequestingSend=!1,i.success){var n=xyd.WindowManager.get().getWindow("stage_rank_window");n&&n.updateSteminaSendStatus(t),xyd.WindowManager.get().closeWindow("stage_rank_send_window")}})["catch"](function(t){logger.error(t),e._isRequestingSend=!1})}},t.prototype.onClickReceiveBtn=function(){this._alreadyReceived?(Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_LEADERBOARD_ONE_CLICK_SEND_BTN),this.onSend()):(Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_LEADERBOARD_ONE_CLICK_CLAIM_BTN),this.onReceive())},t.prototype.initUIComponent=function(){xyd.setNormalBtnBehavior(this._closeBtn,this,this.onBtnExit),xyd.setNormalBtnBehavior(this._receiveBtn,this,this.onClickReceiveBtn);var e=xyd.getHeight()/1920;e>1&&(e=1);var t=this._receivedStamina.length;this.group_all.scaleX=e,this.group_all.scaleY=e,this._receivedNumText.text=xyd.__("STAGERANK_SEND_TIPS1")+t+xyd.__("STAGERANK_SEND_TIPS2"),this._receiveNum.text="x"+t,this._sendBtnText.visible=!1,this.refreshScroller(this._receivedStamina),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_LEADERBOARD_ONE_CLICK_CLAIM_BTN)},t.prototype.dispose=function(){for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}e.prototype.dispose.call(this)},t.prototype.onBtnExit=function(){TweenLite.killTweensOf(this.group_all);var e=new TimelineLite;e.add(TweenLite.to(this.group_all,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),egret.setTimeout(function(){xyd.WindowManager.get().closeWindow("stage_rank_send_window")},this,5e3*xyd.TweenDeltaTime)},t.prototype.refreshScroller=function(e){this.rankingList_.removeChildren(),this.rankingScroller.viewport.scrollH=0;for(var t=0,i=e;t<i.length;t++){var n=i[t],o=new SendStaminaListItemRender(n.avatar);this.rankingList_.addChild(o)}},t.prototype.willClose=function(){e.prototype.willClose.call(this),TweenLite.killTweensOf(this.group_all)},t}(BaseWindow);__reflect(StageRankSendWindow.prototype,"StageRankSendWindow");
var StageRankWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.OPEN_SCALE=1.2,n._usingTimelines=[],n.MAX_PAGE_FRIENDS=20,n._currentFriendNum=1,n._isRankRequesting=!1,n._isRankReachEnd=!1,n.FRIEND_ITEM_HEIGHT=180,n._labelNums=[],n.MAX_SEND=5,n.skinName="resource/skins/StageRankWindowSkin.exml",n.params_=i,n.rankingCollection_=new eui.ArrayCollection,n.rankingList_.dataProvider=n.rankingCollection_,n.rankingList_.itemRenderer=StageRankListItemRender,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.adjustTotalHeight(),this.initUIComponent(),this.UIAnimation(),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_LEADERBOARD_MAIN_INVITE_BTN)},t.prototype.UIAnimation=function(){var e=this.group_all.verticalCenter;this.group_all.verticalCenter=e-1444;var t=new TimelineMax;this._usingTimelines.push(t),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_all,3*xyd.TweenDeltaTime,{verticalCenter:e+86,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_all,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),7*xyd.TweenDeltaTime)},t.prototype.initUIComponent=function(){var e=this;xyd.setNormalBtnBehavior(this.group_close,this,this.onBtnExit),xyd.setNormalBtnBehavior(this.group_beibao,this,this.onBtnBeibao),xyd.setNormalBtnBehavior(this.group_hongbao,this,this.onBtnHongbao),SelfInfo.get().isBanlist?(this.group_goto_play.visible=!0,this.group_list.visible=!1,this.today_receive_label.visible=!1,this._now_receive.visible=!1,this.play_to_get_star_label.visible=!0,this.btn_goto_play.visible=!0,this.btn_send_all.visible=!1,this._groupMe.visible=!1,xyd.setDarkenBtnBehavior(this.btn_goto_play,this,this.onBtnGotoPlay),platform.callMethod("LEADERBOARD_GET_INFO",{start:this._currentFriendNum,end:this._currentFriendNum+this.MAX_PAGE_FRIENDS-1}).then(function(t){var i=t.self_data;e.avatarImg_.source=i.avatar;var n=e.nameLabel_.height;if(e.nameLabel_.text=i.nickname,e.nameLabel_.height>n){var o=Math.floor(e.nameLabel_.text.length/2);o>5&&(o=5),e.nameLabel_.text=e.nameLabel_.text.slice(0,o)+"..."}e.avatarImg_.mask=e.maskImg_})["catch"](function(e){return logger.error(e)})):(SelfInfo.get().getShareInfoWithKey("leaderboard_invite")&&(this.group_share.visible=!0,this.btn_send_all.horizontalCenter=206),this.score_bar_.mask=this.score_bar_1,this._groupMe.visible=!1,xyd.setDarkenBtnBehavior(this.group_share,this,this.onBtnShare),xyd.setDarkenBtnBehavior(this.btn_send_all,this,this.onBtnSendAll),this._isRankRequesting=!0,platform.callMethod("LEADERBOARD_STAMINA_STATUS",{}).then(function(e){e.received_list.length>0&&xyd.WindowManager.get().openWindow("stage_rank_send_window",{receivedStamina:e.received_list})})["catch"](function(e){return logger.error(e)}),this.rankingScroller.addEventListener(egret.Event.CHANGE,this.onScroller,this),this.rankingScroller.addEventListener(egret.Event.COMPLETE,this.onScrollerEnd,this),this.requestInitialRankData())},t.prototype.adjustTotalHeight=function(){var e=xyd.stageHeight-this.group_all.bottom-this.group_all.top;e>1820&&(this.group_all.bottom+=e-1820)},t.prototype.onScroller=function(e){var t=this.rankingScroller.viewport.scrollV;this.updateIconMe(t),this.checkRequestData(t)},t.prototype.onScrollerEnd=function(e){var t=this.rankingScroller.viewport.y;this.updateIconMe(t),this.checkRequestData(t)},t.prototype.checkRequestData=function(e){var t=e/this.FRIEND_ITEM_HEIGHT;t>=this._currentFriendNum-8&&this.requestData()},t.prototype.requestData=function(){var e=this;this._isRankRequesting||this._isRankReachEnd||(this._isRankRequesting=!0,platform.callMethod("LEADERBOARD_GET_INFO",{start:this._currentFriendNum,end:this._currentFriendNum+this.MAX_PAGE_FRIENDS-1}).then(function(t){e._isRankRequesting=!1,e._currentFriendNum=e._currentFriendNum+e.MAX_PAGE_FRIENDS,e.updateRankData(t),e.setBtnSendAll()})["catch"](function(t){logger.error(t),e._isRankRequesting=!1}))},t.prototype.updateRankData=function(e){var t=e.rank_data;(void 0==t||t.length<this.MAX_PAGE_FRIENDS)&&(this._isRankReachEnd=!0);for(var i=0,n=t;i<n.length;i++){var o=n[i];this._friendRankData.push(o),o.rank==this._myRank?o.isMe=!0:o.isMe=!1}this.validateNow()},t.prototype.updateNowSend=function(e){var t=e.received_num;0>t&&(t=0),this._now_receive.textFlow=[{text:String(t),style:{textColor:1111078,bold:!1,size:34,fontFamily:"Microsoft YaHei"}},{text:" / 5",style:{textColor:16575413,bold:!1,size:34,fontFamily:"Microsoft YaHei"}}]},t.prototype.updateReceiveNum=function(e){e=parseInt(this._now_receive.text)+e,0>e&&(e=0),e=e>5?5:e,this._now_receive.textFlow=[{text:String(e),style:{textColor:1111078,bold:!1,size:34,fontFamily:"Microsoft YaHei"}},{text:"/5",style:{textColor:16575413,bold:!1,size:34,fontFamily:"Microsoft YaHei"}}]},t.prototype.updateIconMe=function(e){this._myScollerYMin=180*this._myRank-this.group_list.height,this._myScollerYMax=180*(this._myRank-1);this.targetMe_;e<this._myScollerYMin?(this._groupMe.visible=!0,this._groupMe.top=void 0,this._groupMe.bottom=0):e>this._myScollerYMax?(this._groupMe.visible=!0,this._groupMe.top=0,this._groupMe.bottom=void 0):this._groupMe.visible=!1},t.prototype.updateSteminaSendStatus=function(e){for(var t=0,i=e;t<i.length;t++)for(var n=i[t],o=0,a=this._friendRankData;o<a.length;o++){var s=a[o];if(n==s.uin){s.can_send_stamina=!1;break}}this.rankingCollection_.refresh(),this.validateNow()},t.prototype.setBtnSendAll=function(){var e,t=0;if(e=this._friendRankData,e&&0!=e.length){for(var i=0,n=e;i<n.length;i++){var o=n[i];o.can_send_stamina||t++}t==e.length?(this.btn_send_all.touchEnabled=!1,xyd.setImageGrey(this.btn_send_all)):(this.btn_send_all.touchEnabled=!0,this.btn_send_all.filters=[])}},t.prototype.onBtnHongbao=function(){platform.callMethod("OPEN_WALLET",{})["catch"](function(e){return logger.error(e)})},t.prototype.onBtnBeibao=function(){platform.callMethod("OPEN_BACKPACK",{})["catch"](function(e){return logger.error(e)})},t.prototype.onBtnGotoPlay=function(){xyd.WindowManager.get().closeWindow(this,function(){var e=SelfInfo.get().getCurrentLevel();xyd.loadJsonForLevel(e).then(function(t){return t?void xyd.WindowManager.get().openWindow("pre_game_window",{totalLevel:e}):void logger.error("load leveldata fail")})["catch"](function(e){logger.error("load leveldata fail")})})},t.prototype.onBtnSendAll=function(){var e=this;platform.callMethod("LEADERBOARD_SEND_STAMINA",{uin_list:[]}).then(function(t){if(t&&t.success){e.btn_send_all.touchEnabled=!1,xyd.setImageGrey(e.btn_send_all);for(var i=0,n=e.rankingCollection_.source;i<n.length;i++){var o=n[i];o.can_send_stamina=!1,e.rankingCollection_.itemUpdated(o)}}})["catch"](function(e){logger.error(e)})},t.prototype.setExp=function(){var e=this;platform.callMethod("MONTHLY_CARD_GET_LEVEL_INFO",{}).then(function(t){0==t.upgrade_exp&&(t.current_exp=t.upgrade_exp=1),e.score_bar_1.scaleX=t.current_exp/t.upgrade_exp;var i=t.level;void 0==e._levelNum?(e._levelNum=xyd.bitmapNumber.createNumPic(i,"non_p_"),e._labelNums.push(e._levelNum),e.level_.addChild(e._levelNum)):xyd.bitmapNumber.changeNum(e._levelNum,i,"non_p_"),xyd.bitmapNumber.setNumGap(e._levelNum,-5),e._levelNum.x=.5*(e.level_.width-xyd.bitmapNumber.getWidth(e._levelNum)),e._levelNum.y=.5*(e.level_.height-xyd.bitmapNumber.getHeight(e._levelNum))})["catch"](function(e){return logger.error(e)})},t.prototype.requestInitialRankData=function(){var e=this;platform.callMethod("LEADERBOARD_GET_INFO",{start:this._currentFriendNum,end:this._currentFriendNum+this.MAX_PAGE_FRIENDS-1}).then(function(t){e._isRankRequesting=!1,e._currentFriendNum=e._currentFriendNum+e.MAX_PAGE_FRIENDS,e.setRankData(t),e.setBtnSendAll()})["catch"](function(t){logger.error(t),e._isRankRequesting=!1})},t.prototype.setRankData=function(e){var t=e;this._myRank=t.self_index+1,this._friendRankData=t.rank_data,(void 0==t.rank_data||t.rank_data.length<this.MAX_PAGE_FRIENDS)&&(this._isRankReachEnd=!0);var i=t.self_data;this.avatarImg_.source=i.avatar;var n=this.nameLabel_.height;if(this.nameLabel_.text=i.nickname,this.nameLabel_.height>n){var o=Math.floor(this.nameLabel_.text.length/2);o>5&&(o=5),this.nameLabel_.text=this.nameLabel_.text.slice(0,o)+"..."}this.avatarImg_.mask=this.maskImg_;for(var a=0,s=t.rank_data;a<s.length;a++){var r=s[a];r.rank==i.rank?r.isMe=!0:r.isMe=!1}this.initScroller(this._friendRankData),this.initMe(i),this.updateIconMe(0),this.updateNowSend(e),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_LEADERBOARD_MAIN_SEND_BTN)},t.prototype.initMe=function(e){e.isMe=!0;this.targetMe_;this.targetMe_.data=e,this.targetMe_.touchEnabled=!1},t.prototype.onBtnExit=function(){TweenLite.killTweensOf(this.group_all);var e=new TimelineLite;this._usingTimelines.push(e),e.add(TweenLite.to(this.group_all,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),egret.setTimeout(function(){xyd.WindowManager.get().closeWindow("stage_rank_window")},this,5e3*xyd.TweenDeltaTime)},t.prototype.onBtnShare=function(){Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_LEADERBOARD_MAIN_INVITE_BTN),platform.callMethod("GAME_SHARE",{type:"leaderboard_invite"})["catch"](function(e){return logger.error(e)})},t.prototype.initScroller=function(e){this.rankingCollection_.source=e,this.rankingCollection_.refresh(),this.rankingScroller.visible=!0,this.validateNow()},t.prototype.onTabChange=function(){this.validateNow(),this.setBtnSendAll();var e=this.rankingScroller.viewport.scrollV;this.updateIconMe(e)},t.prototype.willClose=function(){e.prototype.willClose.call(this);var t=this.rankingList_.$children;this.targetMe_&&this.targetMe_.dispose();for(var i=0,n=t;i<n.length;i++){var o=n[i],a=o;a.dispose()}for(var s=0,r=this._usingTimelines;s<r.length;s++){var l=r[s];l.kill()}for(var _=0,h=this._labelNums;_<h.length;_++){var c=h[_];c.parent&&(c.parent.removeChild(c),xyd.bitmapNumber.destroyNumPic(c))}TweenLite.killTweensOf(this.group_all)},t}(BaseWindow);__reflect(StageRankWindow.prototype,"StageRankWindow");var StageSettingWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingTimelines=[],n.skinName="resource/skins/StageSettingWindowSkin.exml",n._params=i,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.UIAnimation()},t.prototype.initUIComponent=function(){var e=SoundManager.getInstance(),t=e.getBgOn();t?this._sound_bg_disable.visible=!1:this._sound_bg_disable.visible=!0;var i=e.getEffectOn();i?this._sound_effect_disable.visible=!1:this._sound_effect_disable.visible=!0,xyd.setDarkenBtnBehavior(this._btn_close,this,this.onBtnCloseWindow),xyd.setDarkenBtnBehavior(this._btn_exit,this,this.onBtnExit),xyd.setDarkenBtnBehavior(this._btn_question,this,this.onBtnQuestion),xyd.setDarkenBtnBehavior(this._btn_pack,this,this.onBtnPack),xyd.setDarkenBtnBehavior(this._btn_rank,this,this.onBtnRank),xyd.setDarkenBtnBehavior(this._btn_sound_effect,this,this.onBtnSoundEffect),xyd.setDarkenBtnBehavior(this._btn_sound_bg,this,this.onBtnSoundBg),SelfInfo.get().getAvatar()&&(this._avatarImg.source=SelfInfo.get().getAvatar(),this._avatarImg.mask=this._maskImg,this._playerName.text=SelfInfo.get().getNickname())},t.prototype.UIAnimation=function(){var e=(this.group_bg.verticalCenter,new TimelineMax);this.group_bg.scaleX=.5,this.group_bg.scaleY=.5,this.group_bg.alpha=.5,this._usingTimelines.push(e),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),e.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:.97,scaleY:.97,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),e.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),e.addCallback(function(){e.clear()},32*xyd.TweenDeltaTime)},t.prototype.onBtnExit=function(){var e=this;platform.callMethod("GAME_ON_LEAVE",{}).then(function(t){0==t.success&&e.onSetting()})["catch"](function(e){return logger.error(e)})},t.prototype.onBtnPack=function(){platform.callMethod("OPEN_BACKPACK",{})["catch"](function(e){return logger.error(e)}),this.onSetting()},t.prototype.onBtnRank=function(){xyd.WindowManager.get().closeWindow(this,function(){platform.showGotoApp(!0)}),xyd.WindowManager.get().openWindow("stage_rank_window"),this.onSetting()},t.prototype.onBtnQuestion=function(){platform.callMethod("SHOW_RULES_WINDOW",{}),this.onSetting()},t.prototype.onBtnSoundEffect=function(){var e=SoundManager.getInstance(),t=e.getEffectOn();t?(e.setEffectOn(!1),SelfInfo.get().setSoundEffect(!1),this._sound_effect_disable.visible=!0):(e.setEffectOn(!0),SelfInfo.get().setSoundEffect(!0),this._sound_effect_disable.visible=!1)},t.prototype.onBtnSoundBg=function(){var e=SoundManager.getInstance(),t=e.getBgOn();t?(e.setBgOn(!1),SelfInfo.get().setSoundBg(!1),this._sound_bg_disable.visible=!0):(e.setBgOn(!0),SelfInfo.get().setSoundBg(!0),this._sound_bg_disable.visible=!1)},t.prototype.onBtnCloseWindow=function(){xyd.WindowManager.get().closeWindow(this,function(){platform.showGotoApp(!0)})},t.prototype.onSetting=function(){},t.prototype.willClose=function(){e.prototype.willClose.call(this);for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}},t}(BaseWindow);__reflect(StageSettingWindow.prototype,"StageSettingWindow");var StageWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.MAX_STAGE=xyd.MAX_STAGE,n.LOOP_STAGE1=11,n.LOOP_STAGE2=9,n._settingState=0,n._settingCanTouch=!0,n.selfMap_=0,n._isDisposed=!1,n._strongRemider=!1,n._strongRemiderScale=1.2,n.skinName="resource/skins/StageWindowSkin.exml",n.params_=i,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),SoundManager.getInstance().loadBgSound("bgm_level_mp3"),SoundManager.getInstance().loadBgSound("bgm_map_mp3"),SoundManager.getInstance().playBg("bgm_map_mp3"),this.initSetting()},t.prototype.initSetting=function(){this.start_bottom=xyd.getHeight()-98},t.prototype.onSetting=function(){if(this.onOperation(),platform.inDebugMode()){(new Date).getTime()/1e3+864e3}this._settingCanTouch&&(SoundManager.getInstance().playEffect("se_button_mp3"),platform.showGotoApp(!1),xyd.WindowManager.get().openWindow("stage_setting_window"))},t.prototype.initUIComponent=function(){var e=this;if(ABTest.get().getSetting(ABTest.ANDROID_STRONG_REMINDER)&&(this._strongRemider=!0),this.stageBgHeight_=[1522,1522,1051,1051,1809],this.nowStage=10,this._map=new StageMap(this,this.params_),this._map.init(),this.group_bg.addChild(this._map),RES.createGroup("pre_effect",["pre_effect"],!0),RES.loadGroup("pre_effect"),this.selfMap_=Math.min(xyd.MAX_STAGE,SelfInfo.get().getCurrentLevel()),platform.inAutoMode()){var t;t=platform.inTestMode()?xyd.AUTO_TEST_LEVEL:xyd.TEST_LEVEL,egret.setTimeout(function(){e._map.enterStage(t)},this,1e3)}this._fingerTimer=new egret.Timer(8e3,0),this._fingerTimer.addEventListener(egret.TimerEvent.TIMER,this.onFingerTimer,this),this._fingerTimer.start(),0==xyd.statusBarHeight?this.group_extend_.visible=!1:(this.group_extend_.height=xyd.statusBarHeight,this.png_extend_.height=xyd.statusBarHeight),logger.logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_MAIN_START_BTN),platform.inDebugMode()?this.init_GmComponent():this._group_GM.parent&&this._group_GM.parent.removeChild(this._group_GM)},t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._map.dispose(),this._guideFinger&&this._guideFinger.parent&&this._guideFinger.parent.removeChild(this._guideFinger),this._fingerTween&&(this._fingerTween.kill(),this._fingerTween=void 0),this._fingerTimer&&(this._fingerTimer.removeEventListener(egret.TimerEvent.TIMER,this.onFingerTimer,this),this._fingerTimer.stop(),this._fingerTimer=void 0),e.prototype.dispose.call(this))},t.prototype.iconClose=function(e){this._map.iconClose(e)},t.prototype.onBtnQuestion=function(){platform.callMethod("SHOW_RULES_WINDOW",{}),this.onSetting()},t.prototype.onBtnExit=function(){var e=this;platform.callMethod("GAME_ON_LEAVE",{}).then(function(t){0==t.success&&e.onSetting()})["catch"](function(e){return logger.error(e)})},t.prototype.update=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];this._map.updateRecords(n)}},t.prototype.updateView=function(){this._map.updateView()},t.prototype.onOperation=function(){void 0!=this._fingerTimer&&(this.removeFinger(),this._fingerTimer.reset(),this._fingerTimer.start())},t.prototype.onFingerTimer=function(){if(void 0!=this._fingerTimer){var e=0,t=xyd.WindowManager.get().getWindowContexts();for(var i in t)e++;return 1!=e?void this._fingerTimer.reset():void 0}},t.prototype.getRemainWheel=function(){var e=SelfInfo.get().getCurrentLevel(),t=LevelTable.get(),i=t.getNextWheelStage(e),n=i-e+1;return 0>n?-1:n},t.prototype.setBubble=function(e,t){var i=this;egret.clearTimeout(this._bubbleTimeOut),this._bubbleTimeOut=void 0;var n=this.getRemainWheel();0>n||(this._conversation?(this._conversation.setStageCount(n),this._conversation.visible=!0,this._conversation.UIAnimation()):(this._conversation=new StageConversationComponent(n),this.addChild(this._conversation),this._conversation.visible=!0),this._conversation.x=e,this._conversation.y=t,this._bubbleTimeOut=egret.setTimeout(function(){i._conversation.UICloseAnimation()},this,3e3))},t.prototype.setGuideFingerAtLoc=function(e,t){if(SelfInfo.get().getCurrentLevel()!=xyd.MAX_STAGE&&(this._guideFinger?this._guideFinger.visible=!0:(this._guideFinger=new eui.Image("icon_shou_png"),this.removeFinger()),this._guideFinger.x=e,this._guideFinger.y=t,this._guideFinger.anchorOffsetX=120,this._guideFinger.anchorOffsetY=120,this.addChild(this._guideFinger),this._guideFinger.touchEnabled=!1,!this._fingerTween)){platform.callMethod("FINGER_SHOW",{})["catch"](function(e){logger.error(e)});var i=new TimelineMax({repeat:-1});this._fingerTween=i,i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:0,ease:Linear.easeNone}),18*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:0},{rotation:15,ease:Linear.easeNone}),28*xyd.TweenDeltaTime),i.add(TweenLite.fromTo(this._guideFinger,10*xyd.TweenDeltaTime,{rotation:15},{rotation:0,ease:Linear.easeNone}),38*xyd.TweenDeltaTime),i.add(TweenLite.to(this._guideFinger,10*xyd.TweenDeltaTime,{}),48*xyd.TweenDeltaTime)}},t.prototype.removeFinger=function(){this._fingerTween&&(this._fingerTween.kill(),this._fingerTween=void 0),this._guideFinger&&(this._guideFinger.visible=!1)},t.prototype.commandBtnClick=function(){var e=this;if(""!=this._text_input.text){var t=this._text_input.text.split(" "),i=Number(t[0]),n=new GameConf;if(n.init(i),t.length>1){var o=0,a=0,s=new Array(5);"leaf"==t[t.length-1]&&(a=1);for(var r=1,l=0;r<t.length-a;r++,l++)s[l]=Number(t[r]);i=1;for(var r=0;1950>r;r++,i++)if(n=null,n=new GameConf,n.init(i),"Move"!=n.modeName){if("leaf"==t[1]&&"lamp"==t[2]){if("LeafLamp"==n.modeName)break}else if("leaf"==t[1]&&t.length<3){if("Leaf"==n.modeName)break}else if("lamp"==t[1]&&"Lamp"==n.modeName)break;if(!(n.objectives.length<t.length-1-a)){for(var l=0;l<n.objectives.length;l++)for(var _=0;_<t.length-1-a;_++)n.objectives[l].item==s[_]&&o++;if(o==t.length-1-a){if(0==a&&"Objective"==n.modeName)break;if(1==a&&"LeafObjective"==n.modeName)break}else o=0,a=0}}}MainController.get().initGameFromConf(n);egret.setTimeout(function(){e._map.enterStage(i)},this,1e3)}this._text_input.text=""},t.prototype.init_GmComponent=function(){this._group_GM.visible=!0,this._group_GM.top=-30,xyd.setDarkenBtnBehavior(this._btn_command,this,this.commandBtnClick)},t}(BaseWindow);__reflect(StageWindow.prototype,"StageWindow");var TaskGuideWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._usingTimelines=[],n.skinName="resource/skins/TaskGuideWindowSkin.exml",n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initUIComponent(),this.UIAnimation()},t.prototype.UIAnimation=function(){var e=this.group_bg.verticalCenter;this.group_bg.verticalCenter=e-1444;var t=new TimelineMax;this._usingTimelines.push(t),t.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_bg,3*xyd.TweenDeltaTime,{verticalCenter:e+86,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{verticalCenter:e,ease:Linear.easeNone}),7*xyd.TweenDeltaTime)},t.prototype.dispose=function(){for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}e.prototype.dispose.call(this)},t.prototype.initUIComponent=function(){this._label1.textFlow=[{text:"1. ",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"成功闯过最新关",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"收集橙子",style:{textColor:15480832,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"，你和好友们的橙子总数\n    达到目标就能",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"获得一个红包",style:{textColor:15480832,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"。",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}}],this._label2.textFlow=[{text:"2. ",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"好友越多",style:{textColor:15480832,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"，收集橙子速度越快！",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}}],this._label3.textFlow=[{text:"3. ",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"在活动结束时，如果你的排名在",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"前三名",style:{textColor:15480832,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"，还能领取\n",style:{textColor:9064502,bold:!0,size:36,fontFamily:"Microsoft YaHei"}},{text:"    额外奖励哦~",style:{textColor:15480832,bold:!0,size:36,fontFamily:"Microsoft YaHei"}}],xyd.setDarkenBtnBehavior(this._closeBtn,this,this._onCloseBtn)},t.prototype._onCloseBtn=function(){var e=this,t=new TimelineLite;t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{verticalCenter:-1500})),t.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{})),t.call(function(){xyd.WindowManager.get().closeWindow(e)})},t}(BaseWindow);__reflect(TaskGuideWindow.prototype,"TaskGuideWindow");var WinGameWindow=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._totalLevelNum=0,n._starsNum=0,n._scoreNum=0,n._usingTimelines=[],n._shouldLogGuideLoss=!1,n._oldStars=0,n._oldBalance=0,n._newBalance=0,n._balanceStep=1,n._cooking_info=void 0,n._canOpenCookingWin=!1,n._btnLabelMap=(o={},o[1011]="",o[1012]="",o[1013]="text_anniu_xiadan_png",o[1014]="text_anniu_yaoqing_png",o[1015]="text_anniu_guang_png",o),n._missionTextMap=(a={},a[1011]="",a[1012]="三星通关可获得",a[1013]="下单领",a[1014]="好友助力得",a[1015]="逛商城领取",a),n.skinName="resource/skins/WinGameWindowSkin.exml",n._report=i.report,n._totalLevelNum=n._report.total_level||0,n._starsNum=n._report.stars||0,n._scoreNum=n._report.score||0,n._onConfirmCallback=i.onConfirmCallback,n._shouldLogGuideLoss=i.shouldLogGuideLoss,n;var o,a}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.group_bg.visible=!1,this.bg_exit_.visible=!1,this._winGame(),SelfInfo.get().resetLastGameChoose()},t.prototype._initRankScroller=function(e){this.rankingCollection_=new eui.ArrayCollection([]),e&&e.rank_data&&e.rank_data.length>0?(SelfInfo.get().getShareInfoWithKey("score_rank_recall")&&(e.rank_data.splice(0,0,{recall_all:!0,recall_list:e.recall_list}),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SCORE_RANK_ALL_RECALL_BTN)),this.rankingCollection_.source=e.rank_data,this.rankingList_.dataProvider=this.rankingCollection_,this.rankingList_.itemRenderer=RankingListItemRenderer,this.rankingCollection_.refresh(),this.rankingScroller.visible=!0,this._rankPanel.visible=!0,this.validateNow()):this._rankPanel.visible=!1},t.prototype.initStreak=function(e){var t=e;0==t?(this.icon_liansheng.visible=!1,this.lianshengText_.visible=!1,this.lianshengNumber_.visible=!1):(xyd.setDarkenBtnBehavior(this.liansheng_scope,this,this.onWinStreakGuide),this.lianshengNumber_.text=String(t),this.icon_liansheng.visible=!0,this.lianshengText_.visible=!0,this.lianshengNumber_.visible=!0)},t.prototype.UIAnimation=function(e){var t=new TimelineMax;this.group_bg.scaleX=.5,this.group_bg.scaleY=.5,this.group_bg.alpha=.5,this._usingTimelines.push(t),t.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{alpha:1,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:1.1,scaleY:1.1,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_bg,4*xyd.TweenDeltaTime,{scaleX:.97,scaleY:.97,ease:Linear.easeNone}),4*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,ease:Linear.easeNone}),8*xyd.TweenDeltaTime),t.call(function(){e()})},t.prototype.closeUIAndDoNext=function(){this._onConfirmCallback&&this._onConfirmCallback(),xyd.WindowManager.get().closeWindow(this)},t.prototype._onCloseWin=function(){var e=this;if(!this.isDisposed_){var t=new TimelineLite;this.group_bg.scaleX=1,this.group_bg.scaleY=1,this._usingTimelines.push(t),t.add(TweenLite.to(this.group_bg,2*xyd.TweenDeltaTime,{scaleX:1.05,scaleY:1.05,ease:Linear.easeNone}),0),t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{alpha:0,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),t.add(TweenLite.to(this.group_bg,5*xyd.TweenDeltaTime,{scaleX:.5,scaleY:.5,ease:Linear.easeNone}),2*xyd.TweenDeltaTime),t.call(function(){e._canOpenCookingWin&&e._cooking_info?(e._canOpenCookingWin=!1,xyd.WindowManager.get().openWindow("cooking_window",{cooking_info:e._cooking_info,totalStageLevel:e._totalLevelNum,onConfirmCallback:e._onConfirmCallback})):e._onConfirmCallback&&e._onConfirmCallback(),xyd.WindowManager.get().closeWindow(e)})}},t.prototype._checkShareBtnVisible=function(e){return e&&(e.clear_reward_type&&e.clear_reward_type>0||void 0!=e.billion_cash_status)?!0:!1},t.prototype.showBtn=function(e){this.bg_exit_.touchEnabled=e,this._nextBtn.visible=e,this._closeBtn.visible=e,this._checkShareBtnVisible(this._netData)&&(this._shareBtn.visible=e)},t.prototype.winWindowClose=function(){this._onCloseWin(),this._shouldLogGuideLoss&&logger.logGuideLoss(4,1)},t.prototype.onNextBtn=function(){this.winWindowClose(),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_WINGAME_NEXT_BTN)},t.prototype.onWinStreakGuide=function(){xyd.WindowManager.get().openWindow("clear_streak_window")},t.prototype.onCloseBtn=function(){this._onCloseWin(),this._shouldLogGuideLoss&&logger.logGuideLoss(4,2),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_WINGAME_CLOSE_BTN)},t.prototype.onBgBtn=function(){this._onCloseWin(),this._shouldLogGuideLoss&&logger.logGuideLoss(4,3)},t.prototype._winGame=function(){var e=this;platform.callMethod("GAME_WIN",this._report).then(function(t){t.cooking_info&&t.cooking_info.cooking_level&&t.cooking_info.rewards&&t.cooking_info.end_time&&(e._canOpenCookingWin=!0,e._cooking_info=t.cooking_info),SelfInfo.get().syncData()["catch"](function(e){logger.error(e)}),t.show_privilege_guide&&(SelfInfo.get().showMonthCardGuide=!0),t.has_spin?SelfInfo.get().showLuckyWheel=!0:SelfInfo.get().showLuckyWheel=!1,t.first_streak?SelfInfo.get().isFirstStreak=!0:SelfInfo.get().isFirstStreak=!1,e._netData=t})["catch"](function(t){SelfInfo.get().syncData()["catch"](function(e){logger.error(e)}),e._netData={}})},t.prototype.showUI=function(){var e=this;this.group_bg.visible=!0,this.bg_exit_.visible=!0,this.initUIComponent(),this.UIAnimation(function(){var t=xyd.WindowManager.get().getWindow("win_game_window");t&&t.update(e._netData)}),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_WINGAME_NEXT_BTN),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_WINGAME_SHARE_BTN),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_WINGAME_CLOSE_BTN)},t.prototype.initUIComponent=function(){var e=this;this._label_spin.text=xyd.__("SPIN_HIDE_TIPS"),this.showBtn(this._totalLevelNum>1),this._packetInfo.visible=!1,this._nextBtn.horizontalCenter=0,this._shareBtn.visible=!1,this._starsNum=Math.min(this._starsNum,3);[this._star1,this._star2,this._star3];this._totalLevelNumPic=xyd.bitmapNumber.createNumPic(this._totalLevelNum,"non_k_"),this._totalLevelNumPic.scaleX=.64,this._totalLevelNumPic.scaleY=.64,this._totalLevelNumPic.x=(this._totalLevel.width-xyd.bitmapNumber.getWidth(this._totalLevelNumPic))/2,this._totalLevelNumPic.y=(this._totalLevel.height-xyd.bitmapNumber.getHeight(this._totalLevelNumPic))/2,this._totalLevel.addChild(this._totalLevelNumPic);var t=xyd.bitmapNumber.getWidth(this._totalLevelNumPic)/2;if(this._title_left.horizontalCenter=-t-30,this._title_right.horizontalCenter=t+30,this._scoreNumPic=xyd.bitmapNumber.createNumPic(this._scoreNum,"non_k_"),this._scoreNumPic.scaleX=.8,this._scoreNumPic.scaleY=.8,this._scoreNumPic.x=(this._scoreHolder.width-xyd.bitmapNumber.getWidth(this._scoreNumPic))/2,this._scoreNumPic.y=(this._scoreHolder.height-xyd.bitmapNumber.getHeight(this._scoreNumPic))/2,this._scoreHolder.addChild(this._scoreNumPic),xyd.isiOS8?this._showCharImg():this._showCharAnimation(),!SelfInfo.get().isFirstTenLevel(this._totalLevelNum)&&ABTest.get().getSetting(ABTest.FIRST_TEN_LEVEL_PAY)&&SelfInfo.get().getNextPayLevel(this._totalLevelNum+1)>0){var i=[];i.push({text:xyd.__("FIRST_TEN_WIN_TIPS1"),style:{bold:!0,textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}}),i.push({text:SelfInfo.get().getNextPayLevel(this._totalLevelNum+1).toString(),style:{bold:!0,textColor:15411202,size:52,fontFamily:"Microsoft YaHei"}}),i.push({text:xyd.__("FIRST_TEN_WIN_TIPS2"),style:{bold:!0,textColor:9064502,size:42,fontFamily:"Microsoft YaHei"}}),this._label_desc.textFlow=i,egret.setTimeout(function(){var t=new TimelineLite({onComplete:function(){e._bubbleAnimation(e._packetInfo,e._bubble,e._bubbleS,e._label_desc)}});t.to(e._annaHolder,10*xyd.TweenDeltaTime,{x:20}),e._usingTimelines.push(t)},this,300)}platform.inAutoMode()&&egret.setTimeout(function(){e._onConfirmCallback(),xyd.WindowManager.get().closeWindow(e)},this,500),this._nextBtnText.text=xyd.__("NEXT_LEVEL"),this._rewardText.text=xyd.__("GET_WINGAME_REWARD"),this._title_left.text=xyd.__("DI"),this._title_right.text=xyd.__("LEVEL"),this.lianshengText_.text=xyd.__("CLEAR_STREAK")},t.prototype._bubbleAnimation=function(e,t,i,n){var o=this;e.visible=!0;var a=new TimelineMax({useFrames:!0,onComplete:function(){var e=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0}),n=new TimelineMax({repeat:-1,yoyo:!0,useFrames:!0});o._usingTimelines.push(e),o._usingTimelines.push(n),e.fromTo(t,34*xyd.frameScale,{scaleX:s,scaleY:r},{scaleX:1.0247*s,scaleY:1.0247*r}),n.fromTo(i,34*xyd.frameScale,{scaleX:l,scaleY:l},{scaleX:1.05*l,scaleY:1.05*l})}});i.alpha=0;var s=t.scaleX,r=t.scaleY,l=i.scaleX;i.scaleX=.5*l,i.scaleY=.5*l,a.add(TweenLite.to(i,3*xyd.frameScale,{alpha:1}),0),a.add(TweenLite.to(i,9*xyd.frameScale,{scaleX:1.06*l,scaleY:1.06*l}),0),a.add(TweenLite.to(i,9*xyd.frameScale,{scaleX:l,scaleY:l}),9*xyd.frameScale),t.alpha=0,t.scaleX=.58*s,t.scaleY=.58*r,a.add(TweenLite.to(t,6*xyd.frameScale,{alpha:1}),15*xyd.frameScale),a.add(TweenLite.to(t,12*xyd.frameScale,{scaleX:1.015*s,scaleY:1.015*r}),15*xyd.frameScale),a.add(TweenLite.to(t,12*xyd.frameScale,{scaleX:s,scaleY:r})),n.alpha=0,a.add(TweenLite.to(n,6*xyd.frameScale,{alpha:1}),18*xyd.frameScale),this._usingTimelines.push(a)},t.prototype._showCharImg=function(){this._annaImg.visible=!0,this._annaImg.mask=this._annaMask,this._annaImg.y+=60},t.prototype._showCharAnimation=function(){EffectFactory.get().newEffect("anna_win",function(e){e.x=this._annaHolder.width/2,e.y=this._annaHolder.height+60,e.mask=this._annaMask,this._annaEff=e,this._annaHolder.addChild(e),e.animation.play("texiao01",1),e.touchEnabled=!1;
var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.play("texiao02",-1)};e.addDBEventListener("complete",t,this)}.bind(this))},t.prototype.willClose=function(){e.prototype.willClose.call(this),xyd.bitmapNumber.destroyNumPic(this._scoreNumPic),this._annaEff&&this._annaEff.dispose(),this._totalLevelNumPic&&(xyd.bitmapNumber.destroyNumPic(this._totalLevelNumPic),this._totalLevelNumPic=void 0),this._showCoinNumPic&&(xyd.bitmapNumber.destroyNumPic(this._showCoinNumPic),this._showCoinNumPic=void 0);for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}this._cashWallet&&this._cashWallet.dispose(),this.fundTimer&&(this.fundTimer.stop(),this.fundTimer=void 0),this._usingTimelines=[],TweenLite.killTweensOf(this._nextBtn),TweenLite.killTweensOf(this._shareBtn)},t.prototype.starSingleAnimation=function(e,t){var i=new TimelineLite,n=1;e.visible=!0,e.scaleX=4*n,e.scaleY=4*n,e.alpha=0,i.add(TweenLite.to(e,(11+t)*xyd.TweenDeltaTime,{}),0),i.add(TweenLite.to(e,5*xyd.TweenDeltaTime,{alpha:1,scaleX:.84*n,scaleY:.84*n,ease:Linear.easeNone}),(11+t)*xyd.TweenDeltaTime),i.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{scaleX:.84*n,scaleY:.84*n,ease:Linear.easeNone}),(16+t)*xyd.TweenDeltaTime),i.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{scaleX:1.12*n,scaleY:1.12*n,ease:Linear.easeNone}),(19+t)*xyd.TweenDeltaTime),i.add(TweenLite.to(e,3*xyd.TweenDeltaTime,{scaleX:1*n,scaleY:1*n,ease:Linear.easeNone}),(22+t)*xyd.TweenDeltaTime),this._usingTimelines.push(i)},t.prototype.singleCashAnimation=function(e,t,i,n){var o=this,a=this._star2.localToGlobal(),s=a;1==t?(s.x-=191,s.y+=23):3==t&&(s.x+=191,s.y+=23),s.x+=.8*e.anchorOffsetX+25,s.y+=.8*e.anchorOffsetY+25;var r=new egret.Point(this._cashWallet.x+65,this._cashWallet.y+57);r.x+=25,r.y+=10,EffectFactory.get().newEffect("rolling_coin_effect",function(e){e.x=s.x,e.y=s.y,e.rotation=15*(t-2),e.animation.play("texiao01",1),this.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(this)),egret.setTimeout(function(){EffectFactory.get().newEffect("rolling_coin_effect",function(e){e.x=r.x-12,e.y=r.y+5,e.rotation=0,e.animation.play("texiao02",1),this.addChild(e);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(o))},this,4e4*xyd.TweenDeltaTime);var l=2e4*xyd.TweenDeltaTime;3==t&&(l+=5e3*xyd.TweenDeltaTime),egret.setTimeout(function(){EffectFactory.get().newEffect("rolling_coin_effect",function(e){e.x=r.x-100,e.y=r.y+100,e.rotation=0,e.animation.play("texiao0"+(t+2),1),this.addChild(e);var i=function(t){e.removeDBEventListener("complete",i,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",i,this)}.bind(o))},this,l),EffectFactory.get().newEffect("rolling_coin",function(e){var t=this;e.x=s.x,e.y=s.y,e.animation.play("taxiao01",1),this.addChild(e);var o=new TimelineMax;this._usingTimelines.push(o),o.add(TweenMax.to(e,20*xyd.TweenDeltaTime,{})),o.add(TweenMax.to(e,20*xyd.TweenDeltaTime,{bezier:[{x:s.x+75,y:s.y+75},{x:s.x+150,y:s.y},{x:s.x+50,y:s.y-200},{x:r.x,y:r.y}],ease:Linear.easeNone,autoRotate:!1})),o.call(function(){i>t._newBalance&&(i=t._newBalance),ABTest.get().getSetting(ABTest.SHOW_GOODS_BY_STEP)?t._cashWallet.setDeltaBalance(n):t._cashWallet.setBalance(i),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)}),o.add(TweenMax.to(e,90*xyd.TweenDeltaTime,{})),o.call(function(){t._cashWallet.visible=!1})}.bind(this))},t.prototype.cashAnimation=function(){var e=this,t=[this._star1,this._star2,this._star3],i=(this._starsNum-this._oldStars,!1);1!=this._balanceStep&&(i=!0),ABTest.get().getSetting(ABTest.SHOW_GOODS_BY_STEP)&&(this._oldBalance=0),this._cashWallet=new CashWalletComponent(this._oldBalance,i),this._cashWallet.top=15+xyd.statusBarHeight,this._cashWallet.right=25,this.addChild(this._cashWallet),this._cashWallet.visible=!1,egret.setTimeout(function(){e.showBtn(!0)},this,3e4*xyd.TweenDeltaTime);for(var n=0,o=0,a=function(i){o++,egret.setTimeout(function(){e._cashWallet.visible=!0,n+=e._balanceStep;var o=Math.min(e._oldBalance+n,e._newBalance);e.singleCashAnimation(t[i],i+1,o,n)},s,1e3*o*10*xyd.TweenDeltaTime)},s=this,r=this._oldStars;r<this._starsNum;r++)a(r)},t.prototype.starAnimation=function(){for(var e=this,t=[this._star1,this._star2,this._star3],i=0;3>i;i++)t[i].visible=!1;this._starsNum-this._oldStars;this._starsNum>=1&&(this.starSingleAnimation(t[0],0),egret.setTimeout(function(){1==e._starsNum&&e.cashAnimation(),SoundManager.getInstance().playEffect("se_win_star1_mp3")},this,1e4*xyd.TweenDeltaTime)),this._starsNum>=2&&(this.starSingleAnimation(t[1],10),egret.setTimeout(function(){2==e._starsNum&&e.cashAnimation(),SoundManager.getInstance().playEffect("se_win_star2_mp3")},this,2e4*xyd.TweenDeltaTime)),this._starsNum>=3&&(this.starSingleAnimation(t[2],20),egret.setTimeout(function(){3==e._starsNum&&e.cashAnimation(),SoundManager.getInstance().playEffect("se_win_star3_mp3")},this,3e4*xyd.TweenDeltaTime))},t.prototype.update=function(e){var t=this;if(!this.isDisposed_){xyd.setDarkenBtnBehavior(this._closeBtn,this,this.onCloseBtn),xyd.setDarkenBtnBehavior(this._nextBtn,this,this.onNextBtn),e.funds_packet&&this.showFundPacket(e.funds_packet);var i="show_off";e&&(e.funds_packet&&1==e.funds_packet.type?(i="fund",this._rewardText.text="打开红包"):1==e.billion_cash_status||3==e.billion_cash_status?(this._rewardText.text="瓜分1000万",i="billion_cash",Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_BILLION_CASH_BTN)):2==e.billion_cash_status?(this._rewardText.text="瓜分1000万",this._spin_tips.visible=!0,this._label_spin.text="点击领取奖励",i="billion_cash",Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_BILLION_CASH_BTN)):e.clear_reward_type&&5==e.clear_reward_type?this._rewardText.text=xyd.__("GET_CASH_COUPON"):e.clear_reward_type&&7==e.clear_reward_type&&(SelfInfo.get().showLuckyWheel=!1,this._rewardText.text=xyd.__("GO_TO_SPIN"),this._saveHideSpinTime(),i="lucky_wheel"),this._checkShareBtnVisible(e)&&(this._nextBtn.horizontalCenter=-214,this._shareBtn.horizontalCenter=214,1==this._nextBtn.visible&&(this._shareBtn.visible=!0)),e.has_packet&&SelfInfo.get().setPacketOpenable(this._totalLevelNum));var n;n="billion_cash"==i?function(){t._spin_tips.visible=!1,Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_BILLION_CASH_BTN),platform.callMethod("BILLION_CASH_CLICK_BUTTON",{}).then(function(){t._onCloseWin()})["catch"](function(e){return logger.error(e)})}:"fund"==i?function(){t._spin_tips.visible=!1,t._nextBtn.horizontalCenter=0,t._shareBtn.visible=!1,t._redpackHolder.visible=!1,platform.callMethod("GAME_END_CLICK_PACKET",{funds_packet_sn:e.funds_packet.funds_packet_sn}).then(function(){})["catch"](function(e){return logger.error(e)})}:function(){platform.callMethod("GAME_CLEAR_REWARD",{level:t._totalLevelNum}).then(function(e){e.success&&t._onCloseWin()})["catch"](function(e){return logger.error(e)}),Logger.get().logOp(LoggerConst.OP_CLICK,LoggerConst.EL_SN_WINGAME_SHARE_BTN)};var o;e&&(o=e.btn_info),xyd.setBtnBehavior(o,this._shareBtn,this._rewardText,this._shareBtnBg,this._spin_tips,this._label_spin,this,n),this._oldStars=e.old_stars,this.initStreak(e.clear_streak);var a=this._starsNum-this._oldStars;void 0!=e.old_coin?(this._oldBalance=100*e.old_coin,this._newBalance=100*e.new_coin,this._balanceStep=(this._newBalance-this._oldBalance)/a):(this._oldBalance=e.old_balance,this._newBalance=e.new_balance,this._balanceStep=1,void 0==e.old_balance&&(this._oldStars=3)),void 0==this._oldStars&&(this._oldStars=3,this._oldBalance=0,this._newBalance=0),this.starAnimation(),this._initBanner()}},t.prototype._initShowGoodsBanner=function(e){if(e&&e.status){var t=void 0,i=function(){platform.callMethod("PREGAME_SHOW_GOODS_OPEN_WINDOW",{status:e.status,mission_id:t})["catch"](function(e){return logger.error(e)})};if(e.goods_info&&e.goods_info.img_url){var n=e.goods_info.img_url;RES.getResByUrl(n,function(e,t){e?(this.goods_icon.texture=e,this.goods_icon.height=this.goods_icon.width=this.goods_icon.parent.width,this.goods_icon.mask=this.goods_mask):console.log("Cannot get resource from "+t)},this,RES.ResourceItem.TYPE_IMAGE)}switch(e.status){case 0:case 4:break;case 1:xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i),this._banner1.visible=!0,this._showGoodsPanel.visible=!0;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner1_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o);break;case 2:var a=e.mission_list;if(void 0==a||0==a.length)break;var s=this._selectRandomTaskBanner(a);if(-1==s)break;var r=a[s];t=r.mission_id;var l=e.current_coin/e.target_coin,_=e.current_coin+"/"+e.target_coin;ABTest.get().getSetting(ABTest.SHOW_GOODS_BY_STEP)&&(l=e.phase_info.progress/1e4,_=(100*l).toFixed(2)+"%"),this._coinBar.width=40>610*l?40:610*l,this._barLabel.textFlow=[{text:_,style:{textColor:16776693,size:32,fontFamily:"Microsoft YaHei",strokeColor:11224048,stroke:1}}];var h=void 0;this._missionTextMap[t]&&""!=this._missionTextMap[t]&&(this._missionLabel1.text=this._missionTextMap[t],this._missionLabel2.text=r.reward_list[0].count.toString(),this._missionLabel3.text="金币",h=this._missionLabel1.width+this._missionLabel2.width+this._missionLabel3.width),this._btnLabelMap[t]&&""!=this._btnLabelMap[t]&&(this._banner2_textBtn.source=this._btnLabelMap[t],this._banner2_btnGroup.visible=!0,xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i));var c=335;if(this._banner2_btnGroup.visible){c=260;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner2_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o)}if(this._missionLabel1.x=c-h/2,this._missionLabel2.x=this._missionLabel1.x+this._missionLabel1.width,this._missionLabel3.x=this._missionLabel2.x+this._missionLabel2.width,this._banner2.visible=!0,ABTest.get().getSetting(ABTest.SHOW_GOODS_COIN_AFTER_GAME)&&this._oldStars<this._starsNum){this.group_show_coin.visible=!0,this._showCoinNumPic=xyd.bitmapNumber.createNumPic(10*this._starsNum,"non_10_"),this.show_coin_num_container.addChild(this._showCoinNumPic),EffectFactory.get().newEffect("win_coin_glow",function(e){this._coinEff=e,this._coinEff.scaleX=.5,this._coinEff.scaleY=.5,this._coinHolder.addChild(e),e.animation.play("texiao01",-1),e.touchEnabled=!1}.bind(this));var d=new TimelineMax;this._usingTimelines.push(d);var p=this._annaHolder.x-200,u=this.group_show_coin.x+120;d.add(TweenLite.to(this._annaHolder,20*xyd.TweenDeltaTime,{x:p,ease:Linear.easeNone}),0),d.add(TweenLite.to(this.group_show_coin,20*xyd.TweenDeltaTime,{x:u,ease:Linear.easeNone}),0),d.call(function(){})}break;case 3:this._banner1_textBtn.source="text_anniu_lingqu_png",this._banner1_textImg.source="text2_png",this._banner1.visible=!0,xyd.setNormalBtnBehavior(this._showGoodsPanel,this,i),this._showGoodsPanel.visible=!0;var o=new TimelineMax({repeat:-1,yoyo:!0});o.add(TweenLite.to(this._banner1_btnGroup,.5,{scaleX:1.1,scaleY:1.1}),0),this._usingTimelines.push(o)}}},t.prototype._selectRandomTaskBanner=function(e){for(var t=e.length,i=Math.floor(Math.random()*t),n=e[i],o=0;!(n.completed_times<n.total_times&&1011!=n.mission_id);)if(o++,i=(i+1)%t,n=e[i],o>t)return-1;return i},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._coinEff&&EffectFactory.get().pushBackEffect(this._coinEff),this._onConfirmCallback&&(this._onConfirmCallback=void 0);for(var t=0,i=this._usingTimelines;t<i.length;t++){var n=i[t];n.kill()}this._usingTimelines=[]},t.prototype._saveHideSpinTime=function(){var e=this;platform.callMethod("GET_STORAGE",{key:"hideSpinTime"}).then(function(t){var i=t,n=0;i&&void 0!=i.time&&(n=i.time),n=e._getTime(n);var o=e._getTime(SelfInfo.get().getTime());if(n==o);else{e._showBubble();var a={};a.time=SelfInfo.get().getTime(),platform.callMethod("SET_STORAGE",{hideSpinTime:a})}})["catch"](function(e){return logger.error(e)})},t.prototype._getTime=function(e){var t=new Date(1e3*e);t.setHours(0),t.setMinutes(0),t.setSeconds(0);var i=t.toLocaleDateString(),n=i.replace(/\//g,"");return Number(n)},t.prototype._showBubble=function(){this._spin_tips.visible=!0},t.prototype._initBanner=function(){var e=this;platform.callMethod("GET_BANNER_INFO",{level:this._totalLevelNum}).then(function(t){e.isDisposed_||t&&t.type&&("severn"==t.type?e._initShowGoodsBanner(t.data):"ranking"==t.type?e._initRankScroller(t.data):"funds"==t.type&&e._initFunds(t.data))})["catch"](function(e){logger.error(e)})},t.prototype._initFunds=function(e){this._fundInfoPanel.visible=!0,this.fund_text_amount.text="￥"+(e.funds_account.amount/100).toString(),this.fundAmount=e.funds_account.amount,this.fundTime=e.funds_account.expired_at,void 0!=this.fundTime?(this.fund_time.visible=!0,this.fund_text_time.visible=!0,this.fundTimer=new egret.Timer(1e3,0),this.fundTimer.addEventListener(egret.TimerEvent.TIMER,this.updateTime.bind(this),this),this.fundTimer.start(),this.updateTime()):(this.fund_time.visible=!1,this.fund_text_time.visible=!1),Logger.get().logOp(LoggerConst.OP_IMPR,LoggerConst.EL_SN_FUND_BANNER_WINGAME)},t.prototype.updateTime=function(){var e=floor(this.fundTime-Date.now()/1e3);return 0>e?(this._fundInfoPanel.visible=!1,void this.fundTimer.stop()):void(this.fund_text_time.text=xyd.secondsToTimeStringWithDay(e)+"后活动结束")},t.prototype.showFundPacket=function(e){this._redpackHolder.visible=!0,0==e.type&&egret.setTimeout(function(){var t=this;platform.callMethod("GAME_END_CLICK_PACKET",{funds_packet_sn:e.funds_packet_sn}).then(function(e){if(e&&0==e.status){t._pack_image.source="fund_hongbaodakai_png",t._pack_text.visible=!0,t._pack_text.text="¥"+(e.amount/100).toString();var i=new TimelineLite;t._usingTimelines.push(i);var n=30;i.add(TweenLite.to(t._redpackHolder,n*xyd.TweenDeltaTime,{})),i.add(TweenLite.to(t._redpackHolder,7*xyd.TweenDeltaTime,{scaleX:.4,scaleY:.4}),n*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,5*xyd.TweenDeltaTime,{y:1002}),(7+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,5*xyd.TweenDeltaTime,{y:922,ease:Sine.easeOut}),(12+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,8*xyd.TweenDeltaTime,{y:1392,ease:Sine.easeOut}),(17+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,13*xyd.TweenDeltaTime,{scaleX:.8,scaleY:.8,ease:Sine.easeInOut}),(12+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,3*xyd.TweenDeltaTime,{alpha:0}),(22+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t._redpackHolder,13*xyd.TweenDeltaTime,{x:244,ease:Sine.easeInOut}),(12+n)*xyd.TweenDeltaTime),i.call(function(){if(t._redpackHolder.visible=!1,void 0!=t.fundAmount){EffectFactory.get().newEffect("win_rp_grow_light",function(e){this._fundInfoPanel.addChildAt(e,7),e.x=200,e.y=200,e.scaleY=1.4,e.scaleX=1.4,e.animation.play("texiao01",1);var t=function(i){e.removeDBEventListener("complete",t,this),e.animation.stop(),e.parent&&e.parent.removeChild(e),EffectFactory.get().pushBackEffect(e)};e.addDBEventListener("complete",t,this)}.bind(t));var o=function(){this.fund_text_amount.text="￥"+(this.fundAmount/100).toFixed(2).toString()};i.add(TweenLite.to(t.fund_text_amount,4*xyd.TweenDeltaTime,{scaleX:1.08,scaleY:1.15,y:154,ease:Sine.easeOut}),(25+n)*xyd.TweenDeltaTime);var a=t.fundAmount+e.amount,s=Math.min(e.amount/2+5,35);i.add(TweenLite.fromTo(t,s*xyd.TweenDeltaTime,{fundAmount:t.fundAmount},{fundAmount:a,onUpdate:o.bind(t)}),(25+n)*xyd.TweenDeltaTime),i.call(function(){t.fund_text_amount.text="￥"+(a/100).toString()}),i.add(TweenLite.to(t.fund_text_amount,4*xyd.TweenDeltaTime,{scaleX:.98,scaleY:.98,y:163}),(24+s+n)*xyd.TweenDeltaTime),i.add(TweenLite.to(t.fund_text_amount,3*xyd.TweenDeltaTime,{scaleX:1,scaleY:1,y:162}),(27+s+n)*xyd.TweenDeltaTime)}})}})["catch"](function(e){return logger.error(e)})},this,200)},t}(BaseWindow);__reflect(WinGameWindow.prototype,"WinGameWindow");
window.platform=new WebPlatform();
