(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){"use strict";function objectOrFunction(x){var type=typeof x;return x!==null&&(type==="object"||type==="function")}function isFunction(x){return typeof x==="function"}var _isArray=void 0;if(Array.isArray){_isArray=Array.isArray}else{_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}var isArray=_isArray;var len=0;var vertxNext=void 0;var customSchedulerFn=void 0;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){if(customSchedulerFn){customSchedulerFn(flush)}else{scheduleFlush()}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined"){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var vertx=Function("return this")().require("vertx");vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=void 0;if(isNode){scheduleFlush=useNextTick()}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver()}else if(isWorker){scheduleFlush=useMessageChannel()}else if(browserWindow===undefined&&typeof require==="function"){scheduleFlush=attemptVertx()}else{scheduleFlush=useSetTimeout()}function then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child)}var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function resolve$1(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(noop);resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(2);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var TRY_CATCH_ERROR={error:null};function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){TRY_CATCH_ERROR.error=error;return TRY_CATCH_ERROR}}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=false;var error=tryThen(then$$1,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){resolve(promise,value)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$1){if(maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1){handleOwnThenable(promise,maybeThenable)}else{if(then$$1===TRY_CATCH_ERROR){reject(promise,TRY_CATCH_ERROR.error);TRY_CATCH_ERROR.error=null}else if(then$$1===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$1)){handleForeignThenable(promise,maybeThenable,then$$1)}else{fulfill(promise,maybeThenable)}}}function resolve(promise,value){if(promise===value){reject(promise,selfFulfillment())}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise)}}function reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child=void 0,callback=void 0,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value.error=null}else{succeeded=true}if(promise===value){reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){resolve(promise,value)}else if(failed){reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){reject(promise,value)}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){resolve(promise,value)},function rejectPromise(reason){reject(promise,reason)})}catch(e){reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function validationError(){return new Error("Array Methods must be provided an Array")}var Enumerator=function(){function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise)}if(isArray(input)){this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate(input);if(this._remaining===0){fulfill(this.promise,this._result)}}}else{reject(this.promise,validationError())}}Enumerator.prototype._enumerate=function _enumerate(input){for(var i=0;this._state===PENDING&&i<input.length;i++){this._eachEntry(input[i],i)}};Enumerator.prototype._eachEntry=function _eachEntry(entry,i){var c=this._instanceConstructor;var resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise$2){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry)}),i)}}else{this._willSettleAt(resolve$$1(entry),i)}};Enumerator.prototype._settledAt=function _settledAt(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._willSettleAt=function _willSettleAt(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};return Enumerator}();function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}function reject$1(reason){var Constructor=this;var promise=new Constructor(noop);reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Promise$2=function(){function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.prototype.catch=function _catch(onRejection){return this.then(null,onRejection)};Promise.prototype.finally=function _finally(callback){var promise=this;var constructor=promise.constructor;if(isFunction(callback)){return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){throw reason})})}return promise.then(callback,callback)};return Promise}();Promise$2.prototype.then=then;Promise$2.all=all;Promise$2.race=race;Promise$2.resolve=resolve$1;Promise$2.reject=reject$1;Promise$2._setScheduler=setScheduler;Promise$2._setAsap=setAsap;Promise$2._asap=asap;function polyfill(){var local=void 0;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast){return}}local.Promise=Promise$2}Promise$2.polyfill=polyfill;Promise$2.Promise=Promise$2;Promise$2.polyfill();return Promise$2});(function(global){"use strict";global=global&&global.hasOwnProperty("default")?global["default"]:global;var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};function __extends(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];return t}function __decorate(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function __exportStar(m,exports){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}function __values(o){var m=typeof Symbol==="function"&&o[Symbol.iterator],i=0;if(m)return m.call(o);return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}}}function __read(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){if(g[n])i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})}}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){if(f(v),q.shift(),q.length)resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:n==="return"}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator],i;return m?m.call(o):(o=typeof __values==="function"?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){v=o[n](v),settle(resolve,reject,v.done,v.value)})}}function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)}}function __makeTemplateObject(cooked,raw){if(Object.defineProperty){Object.defineProperty(cooked,"raw",{value:raw})}else{cooked.raw=raw}return cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(Object.hasOwnProperty.call(mod,k))result[k]=mod[k];result.default=mod;return result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}var tslib_1=Object.freeze({__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault});global.pinbridge=function(){var FUNCTION_NAME_PREFIX="__aimi_function_";var callIDSeed=0;var callbackContexts={};var encodeFunctions=function(params){if(typeof params!=="object"){return params}var paramsCopy={};if(Object.prototype.toString.call(params)==="[object Array]"){paramsCopy=[]}for(var key in params){if(!params.hasOwnProperty(key)){continue}var value=params[key];if(typeof value==="function"){var callID=++callIDSeed;callbackContexts[callID]={func:value};paramsCopy[key]=FUNCTION_NAME_PREFIX+callID}else if(typeof value==="object"){paramsCopy[key]=encodeFunctions(value)}else{paramsCopy[key]=value}}return paramsCopy};var callNativeImpl=function(target,method,params,callID){console.log("callNativeImpl excuted");params=__assign({},params,{_lego_js_timestamp:Date.now()});var result=global._fastJsN.callNative(target,method,params?JSON.stringify(params):"",callID);result=result?JSON.parse(result):null;if(result&&result.hasOwnProperty("errorCode")){global.callback(result.callID,result.errorCode,result.data);global.removeCallback(result.callID)}return result};global.callback=function(callID,error,params){console.log("callback excuted");params=params||{};var callbackContext=callbackContexts[callID];if(!callbackContext){return}if(callbackContext.func){callbackContext.func(error,params)}else{if(error===0&&callbackContext.onSuccess){callbackContext.onSuccess(params)}else if(error!==0&&callbackContext.onError){callbackContext.onError(params,error)}}};global.removeCallback=function(callID){console.log("removeCallback excuted");delete callbackContexts[callID]};return{callback:global.callback,removeCallback:global.removeCallback,callNative:function(target,method,params,onSuccess,onError){params=params||{};var callID=++callIDSeed;callbackContexts[callID]={onSuccess:onSuccess,onError:onError};params=encodeFunctions(params);return callNativeImpl(target,method,params,callID)},callbackFromNative:function(callID,error,params){global.callback(callID,error,params)},decodeFunctions:function(params){if(typeof params!=="object"){return}var self=this;var _loop_1=function(key){if(!params.hasOwnProperty(key)){return"continue"}var value=params[key];if(typeof value==="string"&&value.indexOf(FUNCTION_NAME_PREFIX)===0){var tokens_1=value.substring(FUNCTION_NAME_PREFIX.length).split("_");if(tokens_1.length===3){(function(){var callID=parseInt(tokens_1[0]);var bridgeID=parseInt(tokens_1[1]);var contextID=parseInt(tokens_1[2]);if(callID!==NaN&&bridgeID!==NaN&&contextID!==NaN){params[key]=function(errorCode,response){self.callNative("AMBridgeAPI","callback",{bridge_id:bridgeID,context_id:contextID,call_id:callID,error_code:errorCode,response:response})}}})()}}else if(typeof value==="object"){self.decodeFunctions(value)}};for(var key in params){_loop_1(key)}}}}();var pinbridge=global.pinbridge;function load(pageController){global.onCreate=pageController.onCreate||function(param){console.log("default onCreate")};global.init=pageController.onCreate||function(param){console.log("default onCreate")};global.loadMore=pageController.loadMore||function(){console.log("default loadMore")};global.onRefresh=pageController.onRefresh||function(param){console.log("default onRefresh")};global.onAppear=pageController.onAppear||function(){console.log("default onAppear")};global.onActive=pageController.onActive||function(){console.log("default onActive")};global.onDestroy=pageController.onDestroy||function(params){console.log("default onDestory")};global.LegoEventDispatcher=function(event){console.log("type = "+JSON.stringify(event));try{var m=event.method;var args=event.args;if(Array.isArray(args)){event=__assign({},event,{args:args[0]})}if(pageController.methods&&pageController.methods.hasOwnProperty(m)){var func=pageController.methods[m];if(typeof func==="function"){func.call(pageController,event)}}else{console.log("not find method:"+m)}}catch(e){console.log(e)}}}function isError(param){return param.__type__==="error"}function bridge(module,command,param){return new Promise(function(resolve){pinbridge.callNative(module,command,param,resolve,function(_,code){resolve({code:code,__type__:"error"})})})}function bridgeNoError(module,command,param){return __awaiter(this,void 0,void 0,function(){var res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(module,command,param)];case 1:res=_a.sent();return[2,isError(res)?null:res]}})})}var AMShare="AMShare";function showSharePage(shareData){return __awaiter(this,void 0,void 0,function(){var res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(AMShare,"showSharePage",shareData)];case 1:res=_a.sent();return[2,!isError(res)]}})})}function doShare(shareData){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve,_){return __awaiter(_this,void 0,void 0,function(){var shareInfo,launchShare;return __generator(this,function(_a){switch(_a.label){case 0:shareInfo=__assign({},shareData,{share_callback:function share_callback(code,result){console.log(">>>> share_callback: "+JSON.stringify(result)+" "+JSON.stringify(code));resolve({shareSuccess:code===0,code:code,callbackResult:result})}});return[4,showSharePage(shareInfo)];case 1:launchShare=_a.sent();if(!launchShare){resolve({shareSuccess:false,code:6e4,callbackResult:null})}return[2]}})})})]})})}var sid_start_index=0;function sidify(o){if(Array.isArray(o)){var a=o;return a.map(function(o){if(typeof o==="object"){return sidify(o)}else{return o}})}if(o.__sid__===undefined){o.__sid__=sid_start_index;sid_start_index++;return o}return{__sid__:o.__sid__}}function sidOperation(data){var result={};for(var item in data){if(Array.isArray(data[item])||typeof data[item]==="object"){result[item]=sidify(data[item])}else{result[item]=data[item]}}return result}var LegoPageEngine="LegoPageEngine";function setupConfig(config){pinbridge.callNative(LegoPageEngine,"setupConfig",config==null?{}:config)}function setData(componentList){var config={components:componentList==null?[]:componentList};pinbridge.callNative(LegoPageEngine,"setData",config)}function renderData(data){var result=sidOperation(data);setData(result)}function updateState(state){pinbridge.callNative(LegoPageEngine,"updateState",state)}function clickTrack(stat_track){pinbridge.callNative(LegoPageEngine,"clickTrack",stat_track)}var NotificationModule="AMUserNotification";var CalendarModule="PDDCalendarNotification";var FloatWindowModule="PDDFloatWindow";function checkNotifyPromise(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NotificationModule,"checkNotify",{})];case 1:result=_a.sent();if(isError(result)){return[2,{is_enabled:false,is_sound_enabled:false}]}return[2,{is_enabled:!!result.is_enabled,is_sound_enabled:!!result.is_sound_enabled}]}})})}function enableNotify(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NotificationModule,"enableNotify",{})];case 1:result=_a.sent();if(isError(result)){return[2,false]}return[2,result]}})})}function register(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NotificationModule,"register",params)];case 1:result=_a.sent();if(isError(result)){return[2,false]}return[2,result]}})})}function unregister(params){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NotificationModule,"unregister",params)];case 1:_a.sent();return[2]}})})}function query(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NotificationModule,"query",params)];case 1:result=_a.sent();if(isError(result)){return[2,{notification_id:"",message:"",alert_time:0,title:"",content:"",timestamp:0}]}return[2,result]}})})}function addCalendarEvent(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(CalendarModule,"addCalendarEvent",params)];case 1:result=_a.sent();if(isError(result)){return[2,false]}return[2,result&&result.success===1]}})})}function removeCalendarEvent(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(CalendarModule,"removeCalendarEvent",params)];case 1:result=_a.sent();if(isError(result)){return[2,false]}return[2,result&&result.success===1]}})})}function getAllCalendarEvent(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(CalendarModule,"getAllCalendarEvent",params)];case 1:result=_a.sent();if(isError(result)){return[2,{events:[]}]}return[2,result]}})})}function checkFloatPermission(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(FloatWindowModule,"checkFloatPermission",{})];case 1:result=_a.sent();return[2,!isError(result)]}})})}function checkCalendarFromNative(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(CalendarModule,"checkAuthorization",{})];case 1:result=_a.sent();if(isError(result)){return[2,false]}if(result&&(result.status==="Authorized"||result.status==="NotDetermined")){return[2,true]}else{return[2,false]}return[2]}})})}function needPopupReminder(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(FloatWindowModule,"needPopupReminder",params)];case 1:result=_a.sent();if(isError(result)){return[2,{show_popup:false,result:1}]}return[2,result]}})})}function cancelFloatReminder(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(FloatWindowModule,"cancelFloatReminder",params)];case 1:result=_a.sent();if(isError(result)){return[2,false]}return[2,result&&result.cancel_result]}})})}function queryFloatReminder(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(FloatWindowModule,"queryFloatReminder",params)];case 1:result=_a.sent();if(isError(result)){return[2,{query_result:[],time_map:{},permission_enable:false}]}return[2,result]}})})}function setupFloatReminder(params){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(FloatWindowModule,"setupFloatReminder",params)];case 1:result=_a.sent();if(isError(result)){return[2,{setup_result:-1}]}return[2,result]}})})}var LegoNotify=Object.freeze({checkNotifyPromise:checkNotifyPromise,enableNotify:enableNotify,register:register,unregister:unregister,query:query,addCalendarEvent:addCalendarEvent,removeCalendarEvent:removeCalendarEvent,getAllCalendarEvent:getAllCalendarEvent,checkFloatPermission:checkFloatPermission,checkCalendarFromNative:checkCalendarFromNative,needPopupReminder:needPopupReminder,cancelFloatReminder:cancelFloatReminder,queryFloatReminder:queryFloatReminder,setupFloatReminder:setupFloatReminder});function showAlert(params){return __awaiter(this,void 0,void 0,function(){var res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("JSAlert","showAlert",params)];case 1:res=_a.sent();return[2,(res?res.index:null)===0?"ok":"cancel"]}})})}function toast(message){bridgeNoError("JSAlert","toast",{message:message})}function get(key){return __awaiter(this,void 0,void 0,function(){var res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("AMStorage","get",{key:key})];case 1:res=_a.sent();return[2,res?res.value:""]}})})}function set(key,value){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("AMStorage","set",{key:key,value:value})];case 1:_a.sent();return[2]}})})}function remove(key){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("AMStorage","set",{key:key})];case 1:_a.sent();return[2]}})})}var NavigatorModule="JSNavigation";var Types={LOGIN:"login"};function modal(config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NavigatorModule,"modal",config)];case 1:_a.sent();return[2]}})})}function forward(config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridge(NavigatorModule,"forward",config)];case 1:_a.sent();return[2]}})})}function getAccessToken(){return __awaiter(this,void 0,void 0,function(){var res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("AMUser","getAccessToken",{})];case 1:res=_a.sent();return[2,res?res.access_token:""]}})})}function getUserInfo(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,bridgeNoError("PDDUserInfo","getUserInfo",{})];case 1:return[2,_a.sent()||{nick_name:""}]}})})}function getNickName(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,getUserInfo()];case 1:return[2,_a.sent().nick_name]}})})}function requireUserLogin(onLogin,onNotLogin,onLoginBack){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,getAccessToken()];case 1:if(_a.sent()){onLogin()}else{modal({type:Types.LOGIN,props:{complete:onLoginBack}});if(!!onNotLogin){onNotLogin()}}return[2]}})})}var CODE_SUCCESS=200;var AUTH_HEADER={"p-lego":1};function parseResult(result){try{var status_1=result.status;if(status_1===CODE_SUCCESS){return JSON.parse(decodeURIComponent(result.response))}else{return null}}catch(e){}return null}function get$1(url){var config={method:"GET",url:url};return request(config)}function post(url,headers,data){var config={method:"POST",url:url,data:data,headers:headers};return request(config)}function request(config){return __awaiter(this,void 0,void 0,function(){var headers,conf,response;return __generator(this,function(_a){switch(_a.label){case 0:headers=config.headers||{};conf=__assign({},config,{headers:__assign({},headers,AUTH_HEADER)});return[4,bridge("JSNetwork","request",conf)];case 1:response=_a.sent();if(isError(response)){return[2,{code:response.code,result:undefined}]}return[2,{code:response.status,result:parseResult(response)}]}})})}function requestUid(){return __awaiter(this,void 0,void 0,function(){var api,config,respT;return __generator(this,function(_a){switch(_a.label){case 0:api="https://api.yangkeduo.com/api/spike/v4/backup";config={method:"GET",url:api,headers:{"p-lego":1}};return[4,request(config)];case 1:respT=_a.sent();if(respT.code===CODE_SUCCESS&&respT.result){return[2,respT.result.u]}return[2,""]}})})}function uuid(len,radix){var chars="0123456789abcdefghijklmnopqrstuvwxyz".split("");var uuid=[];var i;radix=radix||chars.length;if(len){for(i=0;i<len;i++){uuid[i]=chars[0|Math.random()*radix]}}else{var r=void 0;uuid[8]=uuid[13]=uuid[18]=uuid[23]="-";uuid[14]="4";for(i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[i===19?r&3|8:r]}}}return uuid.join("")}global.setLegoEnvironment=function(env){global.legoEnvironment=env};function environment(){return global.legoEnvironment}var Visible;(function(Visible){Visible["visible"]="visible";Visible["gone"]="gone"})(Visible||(Visible={}));function btnCancelRemind(goodsId,startTime){return{action:"@callJs:cancelRemind?goodsId="+goodsId+"&startTime="+startTime,background:"#FCE7B1",pressedBackground:"#FFCF4C",text:"取消提醒",textColor:"#DEA412",width:"144rp"}}function btnRemindMe(goodsId,startTime){return{action:"@callJs:remindMe?goodsId="+goodsId+"&startTime="+startTime,background:"#FFFFC42A",pressedBackground:"#F69E20",leftIcon:"",text:"提醒我",textColor:"#ffffff",width:"144rp"}}function reserveGray(){return{background:"#ffffff",text:"已预约",textColor:"#999999",width:"144rp"}}function merge(source,newObj){var merged=source;if(typeof newObj==="string"||typeof newObj==="number"||typeof newObj==="boolean"){if(source!==newObj){return newObj}return source}if(isArray(newObj)){return newObj}for(var key in newObj){if(newObj.hasOwnProperty(key)){var value=newObj[key];var hasValue=merged.hasOwnProperty(key);var nextValue=hasValue?merge(merged[key],value):value;if(!hasValue||nextValue!==merged[key]){merged=shallowCopy(merged)}merged[key]=nextValue}}return merged}function isArray(o){return Array.isArray(o)}function shallowCopy(from){if(isArray(from)){return from.slice()}var to={};for(var key in from){if(from.hasOwnProperty(key)){to[key]=from[key]}}return to}function deleteKey(d,key){if(!d[key]){return d}var copy=merge({},d);delete copy[key];return copy}var REMIND_PREFIX="spike_";var FloatWindowPermissionMsg={titleReserve:"已获取抢购资格",title:"预约成功",content:"开启桌面提醒，抢购成功率提升75%",okBtn:"去开启",cancelBtn:"知道了",addSuccess:"添加成功"};var NotifyPermissionMsg={title:"您还没有打开通知提醒哦",content:"",okBtn:"去打开",cancelBtn:"知道了"};var NotifyTips={REMIND_PREFIX:"spike_",BEFORE_TIME:180,FIVE_MINUTES:300,CALENDAR_LANG_REMIND:"开抢前"+5+"分钟将会提醒你哦",RemindInfo:{Title:"你有一个秒杀提醒，即将开抢",contentUrl:"native_forward?type=pdd_goods_detail&goods_id={0}"},LANG_REMIND_FAIL:"提醒失败 请更改日历或者通知权限~",FLOAT_REMIND_CODE:"spike",CALENDAR_BIZ:"spike"};var SetFloatRemindResult;(function(SetFloatRemindResult){SetFloatRemindResult[SetFloatRemindResult["SUCCESS"]=1]="SUCCESS";SetFloatRemindResult[SetFloatRemindResult["NEED_2_SETTING"]=2]="NEED_2_SETTING"})(SetFloatRemindResult||(SetFloatRemindResult={}));var ShowConfigPopupReason;(function(ShowConfigPopupReason){ShowConfigPopupReason[ShowConfigPopupReason["DONT_SHOW"]=0]="DONT_SHOW";ShowConfigPopupReason[ShowConfigPopupReason["UN_REGISTER"]=1]="UN_REGISTER";ShowConfigPopupReason[ShowConfigPopupReason["NO_PERMISSION"]=2]="NO_PERMISSION";ShowConfigPopupReason[ShowConfigPopupReason["FIRST_TRIAL"]=3]="FIRST_TRIAL"})(ShowConfigPopupReason||(ShowConfigPopupReason={}));var ThreeDay=3*24*3600*1e3;var CacheKey={notification:"notification",calendar:"calendar",floatWindow:"floatWindow"};function requestEnableNotification(){return __awaiter(this,void 0,void 0,function(){var title,content,okBtn,cancelBtn,res;return __generator(this,function(_a){switch(_a.label){case 0:return[4,isRefused3Times(CacheKey.notification)];case 1:if(_a.sent()){return[2,true]}title=NotifyPermissionMsg.title,content=NotifyPermissionMsg.content,okBtn=NotifyPermissionMsg.okBtn,cancelBtn=NotifyPermissionMsg.cancelBtn;return[4,showAlert({title:title,text:content,ok_label:okBtn,cancel_label:cancelBtn})];case 2:res=_a.sent();if(!(res==="cancel"))return[3,4];return[4,cacheRefuseByUser(CacheKey.notification,Date.now())];case 3:_a.sent();return[3,6];case 4:return[4,enableNotify()];case 5:_a.sent();_a.label=6;case 6:return[2,false]}})})}function startTimeNotifyId(startTime){return REMIND_PREFIX+"start_time_"+startTime}function addRemindInPush(startTime){var notification=buildNotification(startTime);register(notification)}function buildUnregisterData(notifyId,timestamp){return timestamp?{notification_id:notifyId,timestamp:timestamp}:{notification_id:notifyId}}function removeRemindInPush(startTime){var notificationId=startTimeNotifyId(startTime);query(notificationId).then(function(result){console.log(">>> query notification: "+notificationId+": "+JSON.stringify(result))});unregister(buildUnregisterData(notificationId))}function buildNotification(startTime){return{notification_id:startTimeNotifyId(startTime),title:"您预约的秒杀商品即将开抢，快点进来看看！",message:"",content:"spike.html?tab_index=1&_ex_campaign=spike_push&start_time="+startTime,alert_time:startTime-NotifyTips.BEFORE_TIME,timestamp:Math.floor(Date.now()/1e3)}}function isRefused3Times(cacheKey){return __awaiter(this,void 0,void 0,function(){var res,list,delta;return __generator(this,function(_a){switch(_a.label){case 0:return[4,get(cacheKey)];case 1:res=_a.sent();if(!res){return[2,false]}list=JSON.parse(res);if(!list||!Array.isArray(list)||list.length<3){return[2,false]}delta=list[list.length-1]-list[list.length-3];return[2,delta<ThreeDay]}})})}function cacheRefuseByUser(cacheKey,timestamp){return __awaiter(this,void 0,void 0,function(){var res,list;return __generator(this,function(_a){switch(_a.label){case 0:return[4,get(cacheKey)];case 1:res=_a.sent();list=[];if(res){list=JSON.parse(res)}list.push(timestamp);return[4,set(cacheKey,JSON.stringify(list))];case 2:_a.sent();return[2,true]}})})}function checkCalendarPermission(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,checkCalendarFromNative()];case 1:result=_a.sent();return[2,result]}})})}function queryInCalendar(startTime){return __awaiter(this,void 0,void 0,function(){var data,event;return __generator(this,function(_a){switch(_a.label){case 0:return[4,getAllCalendarEvent({event_id:startTime,biz_name:NotifyTips.CALENDAR_BIZ})];case 1:data=_a.sent();if(!(data.events&&data.events.length)){return[2,{}]}event=data.events[0];if(!(event&&event.event_data)){return[2,{}]}if(typeof event.event_data==="string"){return[2,JSON.parse(event.event_data)]}else{return[2,event.event_data]}return[2]}})})}function requestCalendarPermission(goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var isRefused,addedInCalendar;return __generator(this,function(_a){switch(_a.label){case 0:return[4,isRefused3Times(CacheKey.calendar)];case 1:isRefused=_a.sent();if(isRefused){return[2,false]}return[4,addRemindInCalendar(goodsId,startTime)];case 2:addedInCalendar=_a.sent();console.log(">>> request calendar permission "+JSON.stringify(addedInCalendar));if(!!addedInCalendar)return[3,4];console.log(">>> cache calendar refuse");return[4,cacheRefuseByUser(CacheKey.calendar,startTime)];case 3:_a.sent();_a.label=4;case 4:return[2,addedInCalendar]}})})}function addRemindInCalendar(goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var _a,eventData,result,_b,_c,_d,_e;return __generator(this,function(_f){switch(_f.label){case 0:return[4,queryInCalendar(startTime)];case 1:eventData=_f.sent();eventData=__assign({},eventData,(_a={},_a[goodsId]=startTime,_a));if(!(Object.keys(eventData).length>0))return[3,4];_c=(_b=LegoNotify).addCalendarEvent;_d=newCalendarData;_e=[startTime];return[4,getNickName()];case 2:return[4,_c.apply(_b,[_d.apply(void 0,_e.concat([_f.sent(),eventData]))])];case 3:result=_f.sent();return[2,result];case 4:return[2,false]}})})}function removeRemindInCalendar(goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var eventData,_a,_b,_c,_d;return __generator(this,function(_e){switch(_e.label){case 0:return[4,queryInCalendar(startTime)];case 1:eventData=_e.sent();eventData=deleteKey(eventData,String(goodsId));if(Object.keys(eventData).length===0){return[2,removeCalendarEvent({event_id:startTime,biz_name:NotifyTips.CALENDAR_BIZ})]}_b=(_a=LegoNotify).addCalendarEvent;_c=newCalendarData;_d=[startTime];return[4,getNickName()];case 2:return[2,_b.apply(_a,[_c.apply(void 0,_d.concat([_e.sent(),eventData]))])]}})})}function newCalendarData(startTime,nickName,eventData){console.log(">>> 预约商品数量： "+Object.keys(eventData).length);console.log(startTime);return{event_data:eventData,event_id:startTime,biz_name:NotifyTips.CALENDAR_BIZ,start_time:startTime,end_time:startTime+NotifyTips.FIVE_MINUTES,alarm_time:startTime-NotifyTips.FIVE_MINUTES,title:"拼多多："+(nickName?nickName+"，":"")+"您预约的"+Object.keys(eventData).length+"个秒杀商品还有5分钟开抢",notes:"点击下方链接提前查看您预约的商品，防止过期售罄：\npinduoduo://com.xunmeng.pinduoduo/spike.html?tab_index=1&_ex_campaign=spike_calendar&start_time="+startTime}}function checkForceAlert(goods,startTime,isReserveOnly){return __awaiter(this,void 0,void 0,function(){var title,titleReserve,content,okBtn,cancelBtn,addSuccess,res,remindAdded;return __generator(this,function(_a){switch(_a.label){case 0:return[4,isRefused3Times(CacheKey.floatWindow)];case 1:if(_a.sent()){return[2,false]}title=FloatWindowPermissionMsg.title,titleReserve=FloatWindowPermissionMsg.titleReserve,content=FloatWindowPermissionMsg.content,okBtn=FloatWindowPermissionMsg.okBtn,cancelBtn=FloatWindowPermissionMsg.cancelBtn,addSuccess=FloatWindowPermissionMsg.addSuccess;return[4,showAlert({title:isReserveOnly?title:titleReserve,text:content,ok_label:okBtn,cancel_label:cancelBtn})];case 2:res=_a.sent();if(!(res==="cancel"))return[3,4];return[4,cacheRefuseByUser(CacheKey.floatWindow,Date.now())];case 3:_a.sent();return[2,false];case 4:return[4,addFloatWindowRemind(goods,startTime)];case 5:remindAdded=_a.sent();console.log(">>> addFloatWindowRemind in refuse: "+remindAdded);if(remindAdded){toast(addSuccess)}return[2,true]}})})}function addFloatWindowRemind(goods,startTime){return __awaiter(this,void 0,void 0,function(){var bizData,result;return __generator(this,function(_a){switch(_a.label){case 0:bizData={dynamic_param:{goods_id:goods.goodsId,goods_type:3},btn_prompt:"立即抢购",title:"你预约的商品即将开抢",content:goods.name,price:goods.marketPrice,discount_price:goods.salePrice,pic_url:goods.imgUrl};return[4,setupFloatReminder({remind_id:buildNotificationId(goods.goodsId,startTime),config_id:10001,biz_code:NotifyTips.FLOAT_REMIND_CODE,biz_time:startTime*1e3,biz_data:bizData})];case 1:result=_a.sent();return[2,result.setup_result===SetFloatRemindResult.SUCCESS]}})})}function removeFloatWindowRemind(goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,cancelFloatReminder({remind_id:buildNotificationId(goodsId,startTime)})];case 1:result=_a.sent();return[2,result]}})})}function buildNotificationId(goodsId,timestamp){return""+NotifyTips.REMIND_PREFIX+goodsId+"_"+timestamp}var remindMeApi="http://apiv4.yangkeduo.com/api/massage/push/add";var removeRemindMeApi="http://apiv4.yangkeduo.com/api/massage/push/remove";var shareMaterialApi="http://apiv4.yangkeduo.com/api/aquila/query/share_material";function getSpikeGoods(spikeServeApi,pageKey,page,listID,antiContent,passed){return __awaiter(this,void 0,void 0,function(){var str,api,resp;return __generator(this,function(_a){switch(_a.label){case 0:str=Object.getOwnPropertyNames(passed).map(function(k){return k+"="+passed[k]}).join("&");api=""+spikeServeApi+pageKey+"?page="+page+"&list_id="+listID+"&size=20"+(str?"&"+str:"");if(antiContent){api+="&anti_content="+antiContent}console.log(">>> get spike data api: "+api);return[4,get$1(api)];case 1:resp=_a.sent();return[2,resp.result?resp.result:null]}})})}function addRemindMe(goodsId,startTime,goodsName){return __awaiter(this,void 0,void 0,function(){var body,resp;return __generator(this,function(_a){switch(_a.label){case 0:body=JSON.stringify({spikeType:1,goodsId:goodsId,startTime:startTime,goodsName:goodsName});return[4,post(remindMeApi,{},body)];case 1:resp=_a.sent();return[2,resp.result?resp.result:null]}})})}function removeRemindMe(goodsId){return __awaiter(this,void 0,void 0,function(){var body,resp;return __generator(this,function(_a){switch(_a.label){case 0:body=JSON.stringify({spikeType:1,goodsId:goodsId});return[4,post(removeRemindMeApi,{},body)];case 1:resp=_a.sent();return[2,resp.result?resp.result.success:false]}})})}function reserveGray$1(goodsId){return __awaiter(this,void 0,void 0,function(){var body,resp;return __generator(this,function(_a){switch(_a.label){case 0:body=JSON.stringify({share_type:1,id:goodsId});return[4,post(shareMaterialApi,{},body)];case 1:resp=_a.sent();return[2,resp.result?resp.result:null]}})})}function filterGoods(items,goodsId){var list=items.filter(function(item){return matchGoodsId(item,goodsId)});if(list.length===0){return undefined}var cell=list[0];return cell.data}function filterGoodAndIndex(items,goodsId){var j=0;var goods;for(j=0;j<items.length;j++){if(matchGoodsId(items[j],goodsId)){goods=items[j].data;break}}if(!goods){return{goods:undefined,index:-1}}return{goods:goods,index:j}}function matchGoodsId(item,goodsId){if(item&&item.data){return String(item.data.goodsId)===String(goodsId)}return false}function updateGoodsInfo(items,goodsId,newGoods){if(!items||!newGoods){return items}return items.map(function(item){if(matchGoodsId(item,goodsId)){return{cellType:item.cellType,data:__assign({},item.data,newGoods)}}return item})}function trueAndFalseToBool(obj){if(typeof obj==="string"){if(obj.toLowerCase()==="false"){return false}if(obj.toLowerCase()==="true"){return true}}return obj}function getUuid(){return uuid(10,36)}function clickEventTrack(currentPage,goodsId,goodsStat){var items=currentPage.data.items;var _a=filterGoodAndIndex(items,goodsId),goods=_a.goods,index=_a.index;if(!goods){return}var statTrack=__assign({},goodsStat,{goods_id:goods.goodsId,reserve_only_type:goods.reserveOnlyType||0,is_share:0,start_time:goods.startTime||0,spike_goods_status:getGoodsStatue(currentPage.type,goods),target_tab_idx:getTimeTypeTag(currentPage.type),idx:index||0});clickTrack(statTrack)}function getTimeTypeTag(timeType){if(timeType==="ongoing"){return 1}if(timeType==="future"){return 2}if(timeType==="more"){return 3}return 0}function getGoodsStatue(timeType,goods){if(timeType==="ongoing"){if(goods.sellOut){return 2}else{return 1}}return 0}var RemindTips={LANG_REMIND:"开抢前"+3+"分钟将会提醒你哦",LANG_CANCEL_REMIND:"提醒已取消，你可能会抢不到哦",RESP_ERROR:"数据请求出错了"};function doRemindMe(currentPage,params,onSuccess){return __awaiter(this,void 0,void 0,function(){var _a,goodsId,startTime,items,pageType,goods,success,btnInfo,newItems;return __generator(this,function(_b){switch(_b.label){case 0:if(!(currentPage&&currentPage.data)){return[2]}_a=params.args,goodsId=_a.goodsId,startTime=_a.startTime;items=currentPage.data.items;pageType=currentPage.type;goods=filterGoods(items,goodsId);if(!goods){return[2]}clickEventTrack(currentPage,goodsId,{page_sn:10025,page_name:"seckill",page_el_sn:"99678",page_section:"goods_list",page_element:"remind_me_btn"});return[4,requestAddRemind(goods,goodsId,startTime,false).catch(function(err){console.log("requestAddRemind catch error "+JSON.stringify(err))})];case 1:success=_b.sent();if(!success){console.log("requestAddRemind failed");return[2]}btnInfo=btnCancelRemind(goodsId,startTime);newItems=updateGoodsInfo(items,goodsId,{buttonInfo:btnInfo,subscribe:true});if(onSuccess){onSuccess(newItems,pageType)}toast(RemindTips.LANG_REMIND);return[2]}})})}function checkPushAuth(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,checkNotifyPromise()];case 1:return[2,_a.sent().is_enabled]}})})}function requestAddRemind(goods,goodsId,startTime,isReserve){return __awaiter(this,void 0,void 0,function(){var addPushSuccess,isRefused,addCalSuccess,isAdded,addFloatWindow;return __generator(this,function(_a){switch(_a.label){case 0:return[4,doRegisterPush(startTime)];case 1:addPushSuccess=_a.sent();console.log(">>> doRegisterPush: "+addPushSuccess);if(!!addPushSuccess)return[3,3];return[4,requestEnableNotification()];case 2:isRefused=_a.sent();console.log(">>> isRefused3Times.push: "+JSON.stringify(isRefused));if(!isRefused){return[2,false]}_a.label=3;case 3:return[4,doAddRemindInCalendar(goodsId,startTime)];case 4:addCalSuccess=_a.sent();console.log(">>> doAddRemindInCalendar: "+addCalSuccess);isAdded=addPushSuccess||addCalSuccess;return[4,doAddFloatWindow(goods,startTime,isReserve,isAdded)];case 5:addFloatWindow=_a.sent();console.log(">>> doAddFloatWindow: "+addFloatWindow);if(addPushSuccess||addCalSuccess||addFloatWindow){console.log(">>> requestAddRemind: "+addPushSuccess+", "+addCalSuccess+" "+addFloatWindow);return[2,requestSubscribeServices(goods,goodsId,startTime)]}else{console.log(">>> all failed")}return[2,false]}})})}function doRegisterPush(startTime){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,checkPushAuth()];case 1:if(!_a.sent())return[3,3];return[4,addRemindInPush(startTime)];case 2:_a.sent();return[2,true];case 3:return[2,false]}})})}function requestSubscribeServices(goods,goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var goodsName,data;return __generator(this,function(_a){switch(_a.label){case 0:updateState({loading:true});goodsName=goods&&goods.name?goods.name:"";return[4,addRemindMe(goodsId,startTime,goodsName)];case 1:data=_a.sent();updateState({loading:false});return[2,!!data&&data.success]}})})}function doAddFloatWindow(goods,startTime,isReserve,isAdded){return __awaiter(this,void 0,void 0,function(){var env,hasPermission,remindAdded,isAlerted,_a;return __generator(this,function(_b){switch(_b.label){case 0:env=environment();if(!(env&&env.os==="Android")){return[2,false]}return[4,checkFloatPermission()];case 1:hasPermission=_b.sent();console.log(">>> floatWindowEnabled: "+hasPermission);if(!(hasPermission||!isAdded))return[3,3];return[4,addFloatWindowRemind(goods,startTime)];case 2:remindAdded=_b.sent();console.log(">>> addFloatWindowRemind: "+JSON.stringify(remindAdded));return[2,remindAdded];case 3:if(!isAdded)return[3,9];return[4,checkForceAlert(goods,startTime,isReserve)];case 4:isAlerted=_b.sent();console.log(">>> checkForceAlert: "+isAlerted);_a=!isAlerted&&!isAdded;if(!_a)return[3,6];return[4,checkPushAuth()];case 5:_a=!_b.sent();_b.label=6;case 6:if(!_a)return[3,9];return[4,remove(CacheKey.notification)];case 7:_b.sent();return[4,requestEnableNotification()];case 8:_b.sent();_b.label=9;case 9:return[2,false]}})})}function doAddRemindInCalendar(goodsId,startTime){return __awaiter(this,void 0,void 0,function(){var enabled,addedInCalendar;return __generator(this,function(_a){switch(_a.label){case 0:return[4,checkCalendarPermission()];case 1:enabled=_a.sent();console.log(">>> checkAndRequestCalendarPermission: "+JSON.stringify(enabled));if(!enabled)return[3,3];return[4,addRemindInCalendar(goodsId,startTime)];case 2:addedInCalendar=_a.sent();console.log(">>> addRemindInCalendar "+JSON.stringify(addedInCalendar));return[2,addedInCalendar];case 3:return[2,requestCalendarPermission(goodsId,startTime)]}})})}function doCancelRemind(currentPage,params,onSuccess){if(currentPage&&currentPage.data){var _a=params.args,goodsId=_a.goodsId,startTime=_a.startTime;requestCancelRemind(currentPage,goodsId,startTime,onSuccess)}}function requestCancelRemind(currentPage,goodsId,startTime,onSuccess){return __awaiter(this,void 0,void 0,function(){var items,pageType,removeRemind,enabled,removeSuccess,env,removeFloatWindow,btnInfo,newItems;return __generator(this,function(_a){switch(_a.label){case 0:if(!(currentPage&&currentPage.data&&goodsId&&startTime)){return[2]}updateState({loading:true});items=currentPage.data.items;pageType=currentPage.type;return[4,removeRemindMe(goodsId)];case 1:removeRemind=_a.sent();if(!removeRemind)return[3,7];clickEventTrack(currentPage,goodsId,{page_sn:10025,page_name:"seckill",page_el_sn:"99677",page_section:"goods_list",page_element:"cancel_remind_btn"});removeRemindInPush(startTime);return[4,checkCalendarPermission()];case 2:enabled=_a.sent();if(!enabled)return[3,4];return[4,removeRemindInCalendar(goodsId,startTime)];case 3:removeSuccess=_a.sent();console.log(">>> removeRemindInCalendar: "+removeSuccess);_a.label=4;case 4:env=environment();if(!(env&&env.os==="Android"))return[3,6];return[4,removeFloatWindowRemind(goodsId,startTime)];case 5:removeFloatWindow=_a.sent();console.log(">>> removeFloatWindowRemind: "+removeFloatWindow);_a.label=6;case 6:btnInfo=btnRemindMe(goodsId,startTime);newItems=updateGoodsInfo(items,goodsId,{buttonInfo:btnInfo,subscribe:false});if(onSuccess){onSuccess(newItems,pageType)}toast(RemindTips.LANG_CANCEL_REMIND);return[3,8];case 7:toast(RemindTips.RESP_ERROR);_a.label=8;case 8:updateState({loading:false});console.log(">>> cancel remind success: "+JSON.stringify(removeRemind));return[2]}})})}var ReserveTips={RESERVE_TIMEOUT:"开抢前5分钟无法预约，下次早点来哦",RESERVE_GRAY_SUBSCRIBE:"已获取抢购资格，开抢前3分钟将会提醒你哦"};var shareBuy="2";var shareSubscribeBuy="1";function doReserveGray(currentPage,params,onSuccess){return __awaiter(this,void 0,void 0,function(){var _a,goodsId,startTime,futureBuy,reserveOnlyType,items,pageType,results,currentItem,newItems,subscribe,reserveResp,shareResult,imageUrl,shareUrl,shareSuccess,addRemind,statTrackBaseInfo;return __generator(this,function(_b){switch(_b.label){case 0:if(!(params&&params.args&&currentPage&&currentPage.data)){return[2]}_a=params.args,goodsId=_a.goodsId,startTime=_a.startTime;futureBuy=trueAndFalseToBool(params.args.futureBuy)||false;reserveOnlyType=params.args.reserveOnlyType||0;console.log("reserve params:"+JSON.stringify(params.args));items=currentPage.data.items;pageType=currentPage.type;if(!(goodsId&&items)){return[2]}results=items.filter(function(item){return matchGoodsId$1(item,goodsId)});if(!results||!results.length){return[2]}currentItem={};newItems=items.map(function(item){if(matchGoodsId$1(item,goodsId)){var newBtn=reserveGray();currentItem=item;return{cellType:item.cellType,data:__assign({},item.data,{buttonInfo:newBtn,subscribe:true})}}return item});subscribe=currentItem.data&&currentItem.data.subscribe;if(reserveOnlyType&&reserveOnlyType===shareSubscribeBuy&&!subscribe&&futureBuy){toast(ReserveTips.RESERVE_TIMEOUT);return[2]}updateState({loading:true});return[4,reserveGray$1(goodsId)];case 1:reserveResp=_b.sent();if(!(reserveResp&&reserveResp.success&&reserveResp.result))return[3,8];shareResult=reserveResp.result;imageUrl=currentItem.data.imgUrl||"";if(imageUrl.length===0&&currentItem&&currentItem.data){imageUrl=currentItem.data.imgUrl||""}return[4,getShareUrl(goodsId)];case 2:shareUrl=_b.sent();return[4,doShare$1(shareResult,imageUrl,shareUrl)];case 3:shareSuccess=_b.sent();if(!shareSuccess)return[3,7];if(!(futureBuy&&reserveOnlyType===shareBuy))return[3,4];if(onSuccess){onSuccess(newItems,pageType)}return[3,6];case 4:return[4,requestAddRemind(currentItem.data,goodsId,startTime,true)];case 5:addRemind=_b.sent();if(addRemind){toast(ReserveTips.RESERVE_GRAY_SUBSCRIBE);if(onSuccess){onSuccess(newItems,pageType)}}_b.label=6;case 6:console.log(">>> share success: "+JSON.stringify(shareResult));_b.label=7;case 7:updateState({loading:false});return[3,9];case 8:console.log(">>> cancel remind failed");_b.label=9;case 9:statTrackBaseInfo={page_sn:10025,page_name:"seckill",page_el_sn:"503684",page_section:"goods_list"};clickEventTrack(currentPage,goodsId,statTrackBaseInfo);return[2]}})})}function getShareUrl(goodsId){return __awaiter(this,void 0,void 0,function(){var shareUidStr;return __generator(this,function(_a){switch(_a.label){case 0:return[4,requestUid()];case 1:shareUidStr=_a.sent();return[2,"spike.html?refer_goods_id="+goodsId+"&force_use_web_bundle=1&share_uin="+shareUidStr]}})})}function doShare$1(shareData,imageUrl,shareUrl){return __awaiter(this,void 0,void 0,function(){var shareInfo,shareResult;return __generator(this,function(_a){switch(_a.label){case 0:shareInfo={title:shareData.main_title||"【和我一起抢】我正在拼多多抢购秒杀，官方每天补贴100万，抢到就赚到！",message:shareData.sub_title||"限时低价秒杀一元起，商家款款血亏，每日限时限量开售，抢到赚到，点一点得优惠>>",thumb_url:imageUrl||"http://pinduoduoimg.yangkeduo.com/share/spike.jpg",share_url:shareUrl,disabled_channels:[4],hint:[{text:"分享成功后即可",color:"#FFFFFF"},{text:"获得抢购资格",color:"#E02E24"}]};return[4,doShare(shareInfo)];case 1:shareResult=_a.sent();return[2,shareResult.shareSuccess]}})})}function matchGoodsId$1(item,goodsId){if(item&&item.data){return String(item.data.goodsId)===String(goodsId)}return false}var tailApiPath="/api/tail-gateway/spike/v1/";function wrapOnCreateParam(params){return{listID:params.listID||getUuid(),firstPageData:wrapFirstPageData(params.firstPageData),serveApi:""+tailApiPath,antiContent:params.antiContent||""}}function wrapFirstPageData(params){var result=params||{items:[]};return __assign({hideBrandTab:false,brandTabHeight:"108rp"},result)}function wrapRemindMeParam(params){if(!params){return undefined}if(!params.args){return undefined}if(!params.args.goodsId){return undefined}if(!params.args.startTime){return undefined}var time=String(params.args.startTime);return __assign({},params,{args:__assign({},params.args,{startTime:parseInt(time,10)})})}function go2detailAction(currentPage,params){return __awaiter(this,void 0,void 0,function(){var goodsId,items,_a,goods,index,url,config,statTrack;return __generator(this,function(_b){switch(_b.label){case 0:if(!(params&&params.args&&currentPage&&currentPage.data)){return[2]}goodsId=params.args.goodsId;items=currentPage.data.items;_a=filterGoodAndIndex(items,goodsId),goods=_a.goods,index=_a.index;if(!goods||!goods.linkUrl){return[2]}url=goods.linkUrl+"&is_spike=1&page_from=2&_oc_spike_type=1";config={type:"",url:url,props:{url:url}};return[4,forward(config)];case 1:_b.sent();statTrack={page_sn:10025,page_name:"seckill",goods_id:goodsId,reserve_only_type:goods.reserveOnlyType||0,is_share:0,start_time:goods.startTime||0,spike_goods_status:getGoodsStatue$1(currentPage.type,goods),target_tab_idx:getTimeTypeTag$1(currentPage.type),idx:index||0,page_el_sn:"99673",page_section:"goods_list",page_element:"goods"};clickTrack(statTrack);return[2]}})})}function getTimeTypeTag$1(timeType){if(timeType==="ongoing"){return 1}if(timeType==="future"){return 2}if(timeType==="more"){return 3}return 0}function getGoodsStatue$1(timeType,goods){if(timeType==="ongoing"){if(goods.sellOut){return 2}else{return 1}}return 0}function go2BrandAction(currentPage,params){return __awaiter(this,void 0,void 0,function(){var _a,spike_brand_id,top_goods,linkUrl,config,statTrack;return __generator(this,function(_b){switch(_b.label){case 0:if(!(params&&params.args)){return[2]}_a=params.args,spike_brand_id=_a.spike_brand_id,top_goods=_a.top_goods;linkUrl="brand_spike.html?"+"spike_brand_id="+spike_brand_id+"&top_goods="+top_goods+"&page_from=2&is_spike=1";config={type:"",url:linkUrl,props:{url:linkUrl}};return[4,forward(config)];case 1:_b.sent();statTrack={page_sn:10025,page_el_sn:"503641",spike_brand_id:spike_brand_id,tab_idx:getTimeTypeTag$2(currentPage.type),is_share:0};clickTrack(statTrack);return[2]}})})}function getTimeTypeTag$2(timeType){if(timeType==="ongoing"){return 1}if(timeType==="future"){return 2}if(timeType==="more"){return 3}return 0}var keys=["last_time","last_cell_type","goods_count"];var passedData=function(){var map={};function get(key){var obj=map[key]||{};var res={};keys.forEach(function(k){var _a;return obj[k]&&(res=__assign({},res,(_a={},_a[k]=obj[k],_a)))});return res}function set(key,data){var _a;map=__assign({},map,(_a={},_a[key]=data,_a))}function reset(){map={}}return{get:get,set:set,reset:reset}}();function go2BrandPage(currentPage){return __awaiter(this,void 0,void 0,function(){var url,config,statTrack;return __generator(this,function(_a){switch(_a.label){case 0:url="luxury_spike.html?refer_page_sn=10025";config={type:"",url:url,props:{url:url}};return[4,forward(config)];case 1:_a.sent();statTrack={page_sn:10025,page_name:"seckill",is_share:0,target_tab_idx:getTimeTypeTag$1(currentPage.type),page_el_sn:"248395",tab_type:1};clickTrack(statTrack);return[2]}})})}var AppShareInfo={title:"限时秒杀",message:"限时低价秒杀一元起，商家款款血亏，每日限时限量开售，抢到赚到>>",thumbnailURL:"http://pinduoduoimg.yangkeduo.com/share/spike.jpg",shareURL:"https://mobile.yangkeduo.com/spike.html",disableCopyLink:true};var controller=function(){var ongoingPage={page:1,type:"ongoing",uuid:getUuid(),data:{items:[]}};var futurePage={page:1,type:"future",uuid:getUuid(),data:{items:[]}};var morePage={page:1,type:"more",uuid:getUuid(),data:{items:[]}};var pageVisible={v0:Visible.visible,v1:Visible.gone,v2:Visible.gone};var serveApi;var currentPage=ongoingPage;var nextRefreshTime=Number.MAX_VALUE;var refreshTimeoutId;var antiContent;var hideBrandTab=false;var brandTabHeight="108rp";var passedDataManager=passedData;var TIMEOUT_DELAY=3;function onCreate(params){setupConfig({backgroundColor:"#ffffff",showBackToTopButton:true,mjFooterNoMoreDataTitle:" ",title:"限时秒杀",shareInfo:AppShareInfo});var initParams=wrapOnCreateParam(params);antiContent=params.antiContent||"";var firstPageData=initParams.firstPageData;hideBrandTab=firstPageData.hideBrandTab;brandTabHeight=firstPageData.brandTabHeight;serveApi=initParams.serveApi;console.log(">>> serveApi = "+serveApi);ongoingPage=__assign({},ongoingPage,{page:1,uuid:initParams.listID,data:firstPageData});currentPage=ongoingPage;pageVisible={v0:Visible.visible,v1:Visible.gone,v2:Visible.gone};passedDataManager.set("ongoing",firstPageData);resetTimer(firstPageData)}function onAppear(){console.log(">>> empty onAppear")}function onActive(){console.log(">>> empty onActive")}function onDestroy(){if(refreshTimeoutId!==undefined){clearTimeout(refreshTimeoutId)}}function resetTimer(data){if(!data){return}if(data.next_time&&data.next_time<nextRefreshTime){nextRefreshTime=data.next_time}var serverTime=data.server_time||0;console.log(">>> resetTimer: "+nextRefreshTime+" - "+serverTime+" = "+(nextRefreshTime-serverTime));startCountDown(nextRefreshTime-serverTime)}function startCountDown(timeout){if(refreshTimeoutId!==undefined){clearTimeout(refreshTimeoutId)}if(timeout<0){console.log(">>> timer is not set, because timeout "+timeout+" < 0");return}var delta=timeout+TIMEOUT_DELAY;console.log(">>> set a timer: "+delta);refreshTimeoutId=setTimeout(function(){onRefresh();clearTimeout(refreshTimeoutId);nextRefreshTime=Number.MAX_VALUE},delta*1e3)}function onRefresh(){console.log(">>> do onRefresh");ongoingPage=__assign({},ongoingPage,{page:1,uuid:getUuid(),data:{items:[]}});futurePage=__assign({},futurePage,{page:1,uuid:getUuid(),data:{items:[]}});morePage=__assign({},morePage,{page:1,uuid:getUuid(),data:{items:[]}});passedDataManager.reset();switchOngoing()}function preRenderData(){if(!currentPage){return}var pageDatas=__assign({},pageVisible,currentPage.data,{more:morePage.data.items,future:futurePage.data.items,items:ongoingPage.data.items,hideBrandTab:hideBrandTab,brandTabHeight:brandTabHeight});renderData(pageDatas);updateState({loading:false})}function loadMore(){console.log(">>> empty load more")}function getSpikeGoods$1(state,page){var pageType=state.type;var passed=passedDataManager.get(pageType);getSpikeGoods(serveApi,pageType,page,state.uuid,antiContent,passed).then(function(data){if(!data){onError();return}resetTimer(data);var _a=data.items,items=_a===void 0?[]:_a,rest=__rest(data,["items"]);var pageResult=state.data;if(page===1){pageResult={items:[]}}var allItems=pageResult.items.concat(items).filter(function(x){return x!==null});var hasMore=items.length>0;var newResult=__assign({},pageResult,rest,{items:allItems,hasMore:hasMore});if(pageType==="more"){currentPage=morePage=__assign({},morePage,{page:page,data:newResult})}else if(pageType==="future"){currentPage=futurePage=__assign({},futurePage,{page:page,data:newResult})}else{currentPage=ongoingPage=__assign({},ongoingPage,{page:page,data:newResult})}passedDataManager.set(pageType,data);preRenderData()},function(_){onError()}).catch(function(_){onError()})}function onError(){toast("手机网络不太通畅，请重试");preRenderData()}function onRefreshOngoing(){ongoingPage=__assign({},ongoingPage,{uuid:getUuid()});passedDataManager.set("ongoing",null);getSpikeGoods$1(ongoingPage,1)}function onRefreshFuture(){futurePage=__assign({},futurePage,{uuid:getUuid()});passedDataManager.set("future",null);getSpikeGoods$1(futurePage,1)}function onRefreshMore(){morePage=__assign({},morePage,{uuid:getUuid()});passedDataManager.set("more",null);getSpikeGoods$1(morePage,1)}function switchOngoing(){currentPage=ongoingPage;pageVisible={v0:Visible.visible,v1:Visible.gone,v2:Visible.gone};getGoodsAndRender();tabClickTrack(0)}function switchFuture(){currentPage=futurePage;pageVisible={v0:Visible.gone,v1:Visible.visible,v2:Visible.gone};getGoodsAndRender();tabClickTrack(1)}function switchMore(){currentPage=morePage;pageVisible={v0:Visible.gone,v1:Visible.gone,v2:Visible.visible};getGoodsAndRender();tabClickTrack(2)}function getGoodsAndRender(){preRenderData();if(!currentPage.data.items.length){updateState({loading:true});getSpikeGoods$1(currentPage,1)}}function onLoadMoreOnGoing(){getSpikeGoods$1(ongoingPage,ongoingPage.page+1)}function onLoadMoreFuture(){getSpikeGoods$1(futurePage,futurePage.page+1)}function onLoadMoreMore(){getSpikeGoods$1(morePage,morePage.page+1)}function remindMe(params){var newParams=wrapRemindMeParam(params);if(!newParams){return}requireUserLogin(function(){doRemindMe(currentPage,newParams,updateGoodsAndUI)})}function cancelRemind(params){var newParams=wrapRemindMeParam(params);if(!newParams){return}requireUserLogin(function(){doCancelRemind(currentPage,newParams,updateGoodsAndUI)})}function updateGoodsAndUI(newItems,pageType){if(pageType==="more"){currentPage=morePage=__assign({},morePage,{data:__assign({},morePage.data,{items:newItems})})}else if(pageType==="future"){currentPage=futurePage=__assign({},futurePage,{data:__assign({},futurePage.data,{items:newItems})})}else{currentPage=ongoingPage=__assign({},ongoingPage,{data:__assign({},ongoingPage.data,{items:newItems})})}preRenderData()}function tabClickTrack(targetTabIdx){var statTrack={page_sn:10025,page_name:"seckill",page_el_sn:"99404",reserve_only_type:0,is_share:0,target_tab_idx:targetTabIdx};clickTrack(statTrack)}function reserveGray(params){var newParams=wrapRemindMeParam(params);if(!newParams){return}requireUserLogin(function(){doReserveGray(currentPage,newParams,updateGoodsAndUI)},undefined,function(_,loginInfo){if(loginInfo){onRefresh()}})}function go2detail(params){go2detailAction(currentPage,params)}function go2brand(params){go2BrandAction(currentPage,params)}function tab2brand(){console.log("tab2brand");go2BrandPage(currentPage)}return{onCreate:onCreate,onDestroy:onDestroy,loadMore:loadMore,onRefresh:onRefresh,onAppear:onAppear,onActive:onActive,methods:{onRefresh0:onRefreshOngoing,onRefresh1:onRefreshFuture,onRefresh2:onRefreshMore,switchTab0:switchOngoing,switchTab1:switchFuture,switchTab2:switchMore,onLoadMore0:onLoadMoreOnGoing,onLoadMore1:onLoadMoreFuture,onLoadMore2:onLoadMoreMore,remindMe:remindMe,cancelRemind:cancelRemind,reserveGray:reserveGray,go2detail:go2detail,go2brand:go2brand,tab2brand:tab2brand}}}();load(controller)})(this);