webpackJsonp([2],{714:function(e,o,n){"use strict";function t(e){e=e||{},this.api=f.API_URL,this.list=e?e.list:[],this.totalSize=e?e.totalSize:0}function i(e){e=e||{},this.couponExpireList=new t({list:e.list||[],totalSize:e.totalSize||0}),this.vm=null,this.currentId=e.id||"index-coupon-expire-popup",this.container=e.container||document.body,this.isAppMask=e.isAppMask||!1,this.maskCompleteFunc=e.maskComplete||null,this.view=null,this.loadCallback=e.loadCallback||null,this.viewLoaded=!1,this.couponListInfo={couponList:[],couponCount:0},this.cacheInfo=null,this.isShowed=!1,this.dataLoadCallback=e.dataLoadCallback||null}var p=n(1),r=n(46),c=n(14),a=n(13),s=n(20),u=(n(6),n(11).page.getInstance()),l=n(737),d=n(52),m="cfgp-body-container",f=n(760),_=n(145),g=n(763),h=Math.max((p.ui.getWindowHeight()-365)/2,0)+"px",C=function(e){return p.isArray(e)&&e.toString()==a.GoodsType.MOBILE_FARE},v=c.Current===c.IOS&&c.isModuleVersion,y=f.CouponType,b=f.CouponScope,k=f.CouponTitle,w=f.CouponName,A=f.CouponUseText,x=f.ForwardURL;t.prototype.formatItem=function(e){if(!e)return null;var o=parseInt(e.end_time,10),n=function(e){return e.type===a.CouponBatchType.GroupFreeCoupon?y.GroupFree:e.mall_id&&e.mall_name?y.Mall:e.display_type===a.CouponDisplayType.Category||e.type===a.CouponBatchType.CategoryCoupon?y.Category:e.display_type===a.CouponDisplayType.App?y.App:e.display_type===a.CouponDisplayType.AppMobileFare?y.AppMobileFare:e.min_amount===e.discount?y.Cash:y.Bound},t=n(e),i={type:t,expiredTime:o,endTime:p.StdFormat.time(o,"YYYY.MM.dd")};return t===y.GroupFree?(i.isGroupFree=!0,i.title=k.GroupFree,i.useText=A.GroupFree):(i.isGroupFree=!1,i.discount=p.StdFormat.price(parseInt(e.discount,10)||0,100),i.minAmount=p.StdFormat.price(parseInt(e.min_amount,10)||0,100),i.title=p.format(k.Bound,i.minAmount,i.discount),i.couponId=e.coupon_id||"",i.useText=A.Bound,i.goodsType=e.goods_type,t===y.Bound?(i.scope=b.Bound,i.name=w.Bound):t===y.Category?(i.name=w.Category,i.isCategory=!0,i.scope=e.rules_desc||"",i.forwardUrl=e.link_url||"",C(i.goodsType)&&(i.scope=b.MobileFare)):t===y.App?(i.name=w.App,i.isApp=!0,i.scope=b.App):t===y.AppMobileFare?(i.name=w.App,i.isApp=!0,i.scope=b.AppMobileFare,i.forwardUrl=e.link_url||""):t===y.Mall?(i.scope=p.format(b.Mall,e.mall_name),i.name=w.Mall,i.isMall=!0,i.mallID=parseInt(e.mall_id,10)):(i.minAmount=p.StdFormat.price(parseInt(e.min_amount+1,10)||0,100),i.title=k.Cash,i.scope=p.format(b.Cash,i.minAmount),i.name=w.Bound)),i},t.prototype.formatList=function(e){var o=[];if(e&&e.length>0)for(var n=0,t=e.length;n<t;n++){var i=this.formatItem(e[n]);i&&o.push(i)}return o},t.prototype.request=function(e){var o,n,t=this;if(t.list.length>0){o=t.formatList(t.list),n=t.totalSize||o.length;try{e({couponList:o,couponCount:n})}catch(o){e()}}else{var i=p.format(this.api,parseInt((Date.now()+f.SEVEN_DAY_MILISEC)/1e3,10));p.apiRequest("GET",i,null,function(i){o=t.formatList(i.coupons),n=parseInt(i.total_size,10)||o.length;try{e({couponList:o,couponCount:n})}catch(o){e()}},function(){e()},!1,!1,!0)}},i.prototype.load=function(){var e=this;e.viewLoaded||(e.view=p.createNodeFromHTML(p.format(l,e.currentId)),e.container.appendChild(e.view),e.setupModel(),e.prepareView(),e.couponExpireList.request(function(o){o&&(e.couponListInfo=o,e.update(),e.dataLoadCallback&&p.call(e.dataLoadCallback,o))}),e.viewLoaded=!0,e.loadCallback&&(p.call(e.loadCallback,!0),e.loadCallback=null))},i.prototype.setupModel=function(){var e=this;e.vm||(e.vm=avalon.define({$id:e.currentId,visible:!1,isIosApp:v,couponList:[],couponCount:0,top:h,hide:function(){e.hide(),e.isAppMask&&s.maskComplete({confirmed:!1},e.maskCompleteFunc)},forwardFunc:function(o){var n;switch(o.type){case y.GroupFree:n=p.extend(g.CouponClick,{coupon_type:"free_group"}),p.trackingRecord(n,function(){e.forward(p.fullURL(x.GroupFree))});break;case y.Mall:n=p.extend(g.CouponClick,{coupon_type:"shop"}),p.trackingRecord(n,function(){e.forward(p.format(x.Mall,o.mallID))});break;case y.Bound:n=p.extend(g.CouponClick,{coupon_type:"limit"}),p.trackingRecord(n,function(){e.forward(p.format(x.Bound,o.discount,o.minAmount,o.expiredTime,o.couponId))});break;case y.Category:n=p.extend(g.CouponClick,{coupon_type:"category"}),p.trackingRecord(n,function(){e.forward(o.forwardUrl)}),C(o.goodsType)&&(n=p.extend(g.CouponClick,{coupon_type:"phone_charge"}),p.trackingRecord(n,function(){e.forward(p.format(x.MobileFare,o.discount,o.minAmount,o.expiredTime,o.goodsType))}));break;case y.App:case y.AppMobileFare:p.isNativePlatform()?(n=p.extend(g.CouponClick,{coupon_type:"app_coupon"}),p.trackingRecord(n,function(){o.type===y.AppMobileFare?e.forward(o.forwardUrl):e.forward(p.format(x.Bound,o.discount,o.minAmount,o.expiredTime,o.couponId))})):p.showJSAlert(a.AlertType.Confirm.ConfirmAppDownload,function(){p.ui.disableScroll(m),r.forward(_.AppDownloadUrl.CouponList)},function(){p.ui.disableScroll(m)});break;default:n=p.extend(g.CouponClick,{coupon_type:"not_limit"}),p.trackingRecord(n,function(){e.forward(p.format(x.Bound,o.discount,o.minAmount,o.couponId,o.expiredTime))})}},onScroll:function(){e.cacheNodes(),d.lazyLoadOnScroller(e.cacheInfo.scroller,null,{onlyInScroller:!0,pageVerticalRatio:0},e.cacheInfo.wrapper)},goCoupons:function(){e.forward(x.Coupons)}}))},i.prototype.prepareView=function(){this.view&&avalon.scan(this.view),this.cacheNodes()},i.prototype.update=function(){this.vm&&(this.vm.couponList=[],this.vm.couponList=this.couponListInfo.couponList,this.vm.couponCount=this.couponListInfo.couponCount,this.vm.couponCount>0&&this.show(),this.vm.onScroll())},i.prototype.forward=function(e){if(this.isAppMask){var o=u.getPageInfoByUrl(e);e=p.fullURL(e);var n="web",t={url:e};o.checkNativePageVersion(c.Current,p.getAppVersion())&&(n=o.getNativePageName(c.Current),t=p.extend(o.getNativeQuery(c.Current),{url:e})),s.maskComplete({type:n,props:t},this.maskCompleteFunc)}else r.forward(e)},i.prototype.cacheNodes=function(){if(!this.cacheInfo){var e=document.getElementById("cfgp-body-container"),o=document.getElementById("cfgp-body-wrapper");e&&(this.cacheInfo={scroller:e,wrapper:o})}},i.prototype.didMount=function(){p.trackingRecord(g.CouponExpireShow)},i.prototype.show=function(){this.vm&&(this.vm.visible=this.vm.couponList.length>0,!v&&p.ui.disableScroll("cfgp-body-container"),this.vm.visible&&!this.isShowed&&(this.isShowed=!0,this.didMount()))},i.prototype.hide=function(){this.vm&&(this.vm.visible=!1,!v&&p.ui.enableScroll("cfgp-body-container")),p.trackingRecord(g.HideBtnClick)},e.exports=i},737:function(e,o){e.exports='<div ms-controller="{0}" id="coupon-expire-popup" ms-visible="visible">\n    <div class="cfgp-popup-wrapper" ms-css-top="top">\n        <div class="cfgp-close-btn" ms-click="hide"></div>\n        <div class="ice-popup-title">\n            <div class="ice-main-title">\n                <p>您有<i>{{couponCount}}</i>张优惠券即将过期</p>\n            </div>\n        </div>\n        <div id="cfgp-body-wrapper" class="cfgp-body-wrapper">\n            <ul id="cfgp-body-container" class="ice-body-container" ms-scroll="onScroll" ms-class="cfgp-ios-bounce: isIosApp">\n                <li ms-repeat-item="couponList" class="ice-coupon-item" ms-click="forwardFunc(item)">\n                    <div class="ice-content-left">\n                        <div class="ice-left-nogroup" ms-if="!item.isGroupFree" ms-class-1="ice-left-nogroup-mall: item.isMall"\n                        ms-class-2="ice-left-nogroup-category: item.isCategory"\n                        ms-class-3="ice-left-nogroup-app: item.isApp">\n                            <p class="icec-nogroup-discount"><i>￥</i>{{item.discount}}</p>\n                            <p class="icec-nogroup-name">{{item.name}}</p>\n                        </div>\n                        <div class="ice-left-group" ms-if="item.isGroupFree"></div>\n                    </div>\n                    <div class="ice-content-center">\n                        <div class="ice-center-nogroup" ms-if="!item.isGroupFree">\n                            <p class="icec-nogroup-title" ms-class-1="icec-nogroup-title-mall: item.isMall"\n                            ms-class-2="icec-nogroup-title-category: item.isCategory"\n                            ms-class-3="icec-nogroup-title-app: item.isApp">{{item.title}}</p>\n                            <p class="icec-nogroup-scope">{{item.scope}}</p>\n                            <p class="ice-center-time">到期时间：{{item.endTime}}</p>\n                        </div>\n                        <div class="ice-center-group" ms-if="item.isGroupFree">\n                            <p class="icec-group-title">{{item.title}}</p>\n                            <p class="ice-center-time">到期时间：{{item.endTime}}</p>\n                        </div>\n                    </div>\n                    <div class="ice-use-btn" ms-class-1="ice-use-btn-1: item.isGroupFree || item.isMall"\n                    ms-class-2="ice-use-btn-2: item.isCategory"\n                    ms-class-3="ice-use-btn-3: item.isApp">\n                        <span ms-text="item.useText"></span>\n                    </div>\n                </li>\n                <div class="ice-count-only" ms-if="couponCount==1"></div>\n                <p class="ice-count-tip" ms-if="couponCount!=1 && couponCount<10">仅显示1周内过期的优惠券</p>\n                <div class="ice-count-more" ms-if="couponCount>=10" ms-click="goCoupons">\n                    <p>查看更多</p>\n                </div>\n            </ul>\n        </div>\n    </div>\n    <div id="cfgp-cover-mask" class="cfgp-cover-mask"></div>\n</div>\n'},760:function(e,o){"use strict";"usr strict";e.exports={CouponType:{Bound:1,Cash:3,FreeGroup:7,Mall:8,Category:17,App:19,AppMobileFare:20},CouponScope:{Bound:"全场通用",Mall:"仅限{0}",MobileFare:"仅限话费商品使用",Cash:"满{0}可用",App:"仅限拼多多App内可用",AppMobileFare:"仅限App内购买话费商品可用"},CouponTitle:{GroupFree:"团长免费开团",Bound:"满{0}减{1}",Cash:"无金额门槛"},CouponName:{Bound:"通用券",Category:"类目券",App:"App专享券",Mall:"店铺券"},CouponUseText:{GroupFree:"免费开团",Bound:"去使用"},API_URL:"coupon/v2/query_validity_coupons?page=1&size=10&fc_version=1.0&sort_rule=coupon_end_time&coupon_endtime_before={0}",ForwardURL:{GroupFree:"tzfree_list/tzfree_list.html?refer_page_name=index&refer_page_section=popup&refer_page_element=coupon",Mall:"mall_page.html?mall_id={0}&refer_page_name=index&refer_page_section=popup&refer_page_element=coupon",Bound:"coupon_convert.html?discount={0}&min_amount={1}&expired={2}&coupon_id={3}&refer_page_name=index&refer_page_section=future_expire_coupon_popup&refer_page_element=coupon",MobileFare:"coupon_convert.html?discount={0}&min_amount={1}&expired={2}&goods_type={3}&refer_page_name=index&refer_page_section=future_expire_coupon_popup&refer_page_element=coupon",Coupons:"coupons.html?refer_page_name=index&refer_page_section=future_expire_coupon_popup&refer_page_element=coupon"},COUNT_LIMIT:10,SEVEN_DAY_MILISEC:6048e5}},763:function(e,o){"use strict";e.exports={CouponExpireShow:{op:"event",event:"future_expire_coupon_popup_show",page_name:"index",page_section:"future_expire_coupon_popup"},HideBtnClick:{op:"click",event:"close_btn_clk",page_name:"index",page_section:"future_expire_coupon_popup",page_element:"close_btn"},CouponClick:{op:"click",event:"future_expire_coupon_clk",page_name:"index",page_section:"future_expire_coupon_popup",page_element:"coupon"}}}});