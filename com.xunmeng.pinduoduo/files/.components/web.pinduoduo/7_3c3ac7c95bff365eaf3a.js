webpackJsonp([7],{717:function(e,i,n){"use strict";function o(e){function i(){if(!s.isCurrentVersionInReview()&&v.showing&&!(v.groupOrderID.length<=0)){var i=v.groupOrderID,o=Navigation.GroupUrl+"?group_order_id="+i;n(7).ensureLogin(function(){s.trackingRecord({op:"click",event:"bubble_clk",page_element:"bubble",group_order_id:i,page_name:e},function(){Navigation.forward(o)})},null,o,!0)}}function o(){var e=Date.now();d||(d=e-1);var i=e-d;d=e,m&&m.length&&m[0]&&(m[0].time===u+c?(v.imageURL=m[0].imageURL,v.message=m[0].message,v.groupOrderID=m[0].groupOrderID,v.response=m[0].response,v.showing=!0,v.visible=!0,m[0].time-=i):m[0].time<0||!m[0].time?(m.shift(),v.visible=!1):m[0].time<u?(v.showing&&(v.showing=!1),m[0].time-=i):m[0].time-=i)}var c=5e3,u=1e3,g=n(755),l=s.createNodeFromHTML(g);document.body.appendChild(l);var m=[],d=0,f=!0,v=avalon.define({$id:"notification",visible:!0,showing:!1,isSpec:t.isBubbleNeedSpecTop(),imageURL:"",message:"",groupOrderID:"",response:"",onClickNotification:function(){if(m&&m.length&&m[0]&&m[0].response&&v.showing){var e=v.response;"broadcast"===e?i():"broadcast_coupon"===e?Navigation.forward("/qr_welcome/qr_welcome.html?refer_page_name=shop_msg_barrage"):"broadcast_anniversary"===e&&Navigation.forward("/anniversary.html?inner_from=broadcast")}}});avalon.scan(l),setInterval(o,100),r.onMessage(function(e){function i(){var e={cmd:"unhandshake",version:1};r.request(e)}var n=e.version||0;if(!(n>=2)&&f){var o=e.response;if(!(["broadcast","broadcast_coupon","broadcast_anniversary"].indexOf(o)<0)){e.message_array&&i();var t=e.message;if(null!=t){if("broadcast_coupon"===o&&m&&m.length&&("broadcast"===m[0].response&&(m[0].time=Math.min(u,m[0].time)),m.length>1&&m.splice(1,m.length-1)),p)return;m.push({response:o,imageURL:s.cdnCompress(t.image_url,a.CompressPipe.Notification),message:t.content,groupOrderID:t.group_order_id||"",activity:t.activity||"",time:c+u})}}}}),r.keepAlive(),["click","scroll","touchmove","touchstart"].forEach(function(e){window.addEventListener(e,function(){r.keepAlive()})})}var s=n(1),r=s.Modules.PinSocket,a=n(13),t=(n(22),n(76)),c=!1,p=!1;e.exports={disable:function(){},start:function(e){if(c)p=!1;else{c=!0;var i=5e3;setTimeout(function(){o(e)},i)}}}},755:function(e,i){e.exports='<div class="ws-for-push" ms-class-1="ws-for-push-show:showing" ms-class-2="ws-for-push-top:isSpec" ms-controller="notification" ms-click="onClickNotification" ms-visible="visible">\n    <img ms-src="imageURL"/>\n    <span ms-text="message"></span>\n</div>\n'}});